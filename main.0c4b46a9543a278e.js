(self.webpackChunkng_drone=self.webpackChunkng_drone||[]).push([[179],{5363:(sn,vt,qe)=>{"use strict";function Ee(e){return"function"==typeof e}function ze(e){const t=e(r=>{Error.call(r),r.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const ht=ze(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((r,i)=>`${i+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function p(e,n){if(e){const t=e.indexOf(n);0<=t&&e.splice(t,1)}}class be{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const s of t)s.remove(this);else t.remove(this);const{initialTeardown:r}=this;if(Ee(r))try{r()}catch(s){n=s instanceof ht?s.errors:[s]}const{_finalizers:i}=this;if(i){this._finalizers=null;for(const s of i)try{ft(s)}catch(d){n=n??[],d instanceof ht?n=[...n,...d.errors]:n.push(d)}}if(n)throw new ht(n)}}add(n){var t;if(n&&n!==this)if(this.closed)ft(n);else{if(n instanceof be){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(n)}}_hasParent(n){const{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){const{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&p(t,n)}remove(n){const{_finalizers:t}=this;t&&p(t,n),n instanceof be&&n._removeParent(this)}}be.EMPTY=(()=>{const e=new be;return e.closed=!0,e})();const Xe=be.EMPTY;function dt(e){return e instanceof be||e&&"closed"in e&&Ee(e.remove)&&Ee(e.add)&&Ee(e.unsubscribe)}function ft(e){Ee(e)?e():e.unsubscribe()}const Et={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},rn={setTimeout(e,n,...t){const{delegate:r}=rn;return r?.setTimeout?r.setTimeout(e,n,...t):setTimeout(e,n,...t)},clearTimeout(e){const{delegate:n}=rn;return(n?.clearTimeout||clearTimeout)(e)},delegate:void 0};function Dt(e){rn.setTimeout(()=>{const{onUnhandledError:n}=Et;if(!n)throw e;n(e)})}function mt(){}const Vt=Ne("C",void 0,void 0);function Ne(e,n,t){return{kind:e,value:n,error:t}}let ue=null;function fe(e){if(Et.useDeprecatedSynchronousErrorHandling){const n=!ue;if(n&&(ue={errorThrown:!1,error:null}),e(),n){const{errorThrown:t,error:r}=ue;if(ue=null,t)throw r}}else e()}class Fe extends be{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,dt(n)&&n.add(this)):this.destination=Te}static create(n,t,r){return new ie(n,t,r)}next(n){this.isStopped?Ke(function de(e){return Ne("N",e,void 0)}(n),this):this._next(n)}error(n){this.isStopped?Ke(function hn(e){return Ne("E",void 0,e)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?Ke(Vt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const ce=Function.prototype.bind;function ne(e,n){return ce.call(e,n)}class Me{constructor(n){this.partialObserver=n}next(n){const{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(r){rt(r)}}error(n){const{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(r){rt(r)}else rt(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){rt(t)}}}class ie extends Fe{constructor(n,t,r){let i;if(super(),Ee(n)||!n)i={next:n??void 0,error:t??void 0,complete:r??void 0};else{let s;this&&Et.useDeprecatedNextContext?(s=Object.create(n),s.unsubscribe=()=>this.unsubscribe(),i={next:n.next&&ne(n.next,s),error:n.error&&ne(n.error,s),complete:n.complete&&ne(n.complete,s)}):i=n}this.destination=new Me(i)}}function rt(e){Et.useDeprecatedSynchronousErrorHandling?function he(e){Et.useDeprecatedSynchronousErrorHandling&&ue&&(ue.errorThrown=!0,ue.error=e)}(e):Dt(e)}function Ke(e,n){const{onStoppedNotification:t}=Et;t&&rn.setTimeout(()=>t(e,n))}const Te={closed:!0,next:mt,error:function Ve(e){throw e},complete:mt},Kt="function"==typeof Symbol&&Symbol.observable||"@@observable";function At(e){return e}function at(e){return 0===e.length?At:1===e.length?e[0]:function(t){return e.reduce((r,i)=>i(r),t)}}let Ae=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const r=new e;return r.source=this,r.operator=t,r}subscribe(t,r,i){const s=function Ie(e){return e&&e instanceof Fe||function pt(e){return e&&Ee(e.next)&&Ee(e.error)&&Ee(e.complete)}(e)&&dt(e)}(t)?t:new ie(t,r,i);return fe(()=>{const{operator:d,source:m}=this;s.add(d?d.call(s,m):m?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(r){t.error(r)}}forEach(t,r){return new(r=it(r))((i,s)=>{const d=new ie({next:m=>{try{t(m)}catch(v){s(v),d.unsubscribe()}},error:s,complete:i});this.subscribe(d)})}_subscribe(t){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(t)}[Kt](){return this}pipe(...t){return at(t)(this)}toPromise(t){return new(t=it(t))((r,i)=>{let s;this.subscribe(d=>s=d,d=>i(d),()=>r(s))})}}return e.create=n=>new e(n),e})();function it(e){var n;return null!==(n=e??Et.Promise)&&void 0!==n?n:Promise}const Ut=ze(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let It=(()=>{class e extends Ae{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const r=new yn(this,this);return r.operator=t,r}_throwIfClosed(){if(this.closed)throw new Ut}next(t){fe(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(t)}})}error(t){fe(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:r}=this;for(;r.length;)r.shift().error(t)}})}complete(){fe(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:r,isStopped:i,observers:s}=this;return r||i?Xe:(this.currentObservers=null,s.push(t),new be(()=>{this.currentObservers=null,p(s,t)}))}_checkFinalizedStatuses(t){const{hasError:r,thrownError:i,isStopped:s}=this;r?t.error(i):s&&t.complete()}asObservable(){const t=new Ae;return t.source=this,t}}return e.create=(n,t)=>new yn(n,t),e})();class yn extends It{constructor(n,t){super(),this.destination=n,this.source=t}next(n){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,n)}error(n){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,n)}complete(){var n,t;null===(t=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===t||t.call(n)}_subscribe(n){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(n))&&void 0!==r?r:Xe}}class Mt extends It{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const t=super._subscribe(n);return!t.closed&&n.next(this._value),t}getValue(){const{hasError:n,thrownError:t,_value:r}=this;if(n)throw t;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}}function $n(e){return Ee(e?.lift)}function Nn(e){return n=>{if($n(n))return n.lift(function(t){try{return e(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Dn(e,n,t,r,i){return new gn(e,n,t,r,i)}class gn extends Fe{constructor(n,t,r,i,s,d){super(n),this.onFinalize=s,this.shouldUnsubscribe=d,this._next=t?function(m){try{t(m)}catch(v){n.error(v)}}:super._next,this._error=i?function(m){try{i(m)}catch(v){n.error(v)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(m){n.error(m)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function bn(e,n){return Nn((t,r)=>{let i=0;t.subscribe(Dn(r,s=>{r.next(e.call(n,s,i++))}))})}function kr(e){return this instanceof kr?(this.v=e,this):new kr(e)}function yi(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function Ot(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=e[s]&&function(d){return new Promise(function(m,v){!function i(s,d,m,v){Promise.resolve(v).then(function(w){s({value:w,done:m})},d)}(m,v,(d=e[s](d)).done,d.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Lt=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function fn(e){return Ee(e?.then)}function En(e){return Ee(e[Kt])}function pn(e){return Symbol.asyncIterator&&Ee(e?.[Symbol.asyncIterator])}function Vr(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Ur=function Kr(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Nr(e){return Ee(e?.[Ur])}function Qr(e){return function Fr(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=t.apply(e,n||[]),s=[];return i={},d("next"),d("throw"),d("return"),i[Symbol.asyncIterator]=function(){return this},i;function d(O){r[O]&&(i[O]=function(k){return new Promise(function(Q,X){s.push([O,k,Q,X])>1||m(O,k)})})}function m(O,k){try{!function v(O){O.value instanceof kr?Promise.resolve(O.value.v).then(w,D):N(s[0][2],O)}(r[O](k))}catch(Q){N(s[0][3],Q)}}function w(O){m("next",O)}function D(O){m("throw",O)}function N(O,k){O(k),s.shift(),s.length&&m(s[0][0],s[0][1])}}(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:r,done:i}=yield kr(t.read());if(i)return yield kr(void 0);yield yield kr(r)}}finally{t.releaseLock()}})}function Ro(e){return Ee(e?.getReader)}function Jr(e){if(e instanceof Ae)return e;if(null!=e){if(En(e))return function Br(e){return new Ae(n=>{const t=e[Kt]();if(Ee(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Lt(e))return function _o(e){return new Ae(n=>{for(let t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}(e);if(fn(e))return function $s(e){return new Ae(n=>{e.then(t=>{n.closed||(n.next(t),n.complete())},t=>n.error(t)).then(null,Dt)})}(e);if(pn(e))return Vi(e);if(Nr(e))return function To(e){return new Ae(n=>{for(const t of e)if(n.next(t),n.closed)return;n.complete()})}(e);if(Ro(e))return function Bl(e){return Vi(Qr(e))}(e)}throw Vr(e)}function Vi(e){return new Ae(n=>{(function Cl(e,n){var t,r,i,s;return function We(e,n,t,r){return new(t||(t=Promise))(function(s,d){function m(D){try{w(r.next(D))}catch(N){d(N)}}function v(D){try{w(r.throw(D))}catch(N){d(N)}}function w(D){D.done?s(D.value):function i(s){return s instanceof t?s:new t(function(d){d(s)})}(D.value).then(m,v)}w((r=r.apply(e,n||[])).next())})}(this,void 0,void 0,function*(){try{for(t=yi(e);!(r=yield t.next()).done;)if(n.next(r.value),n.closed)return}catch(d){i={error:d}}finally{try{r&&!r.done&&(s=t.return)&&(yield s.call(t))}finally{if(i)throw i.error}}n.complete()})})(e,n).catch(t=>n.error(t))})}function zl(e,n,t,r=0,i=!1){const s=n.schedule(function(){t(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(s),!i)return s}function Ps(e,n,t=1/0){return Ee(n)?Ps((r,i)=>bn((s,d)=>n(r,s,i,d))(Jr(e(r,i))),t):("number"==typeof n&&(t=n),Nn((r,i)=>function Hr(e,n,t,r,i,s,d,m){const v=[];let w=0,D=0,N=!1;const O=()=>{N&&!v.length&&!w&&n.complete()},k=X=>w<r?Q(X):v.push(X),Q=X=>{s&&n.next(X),w++;let _e=!1;Jr(t(X,D++)).subscribe(Dn(n,le=>{i?.(le),s?k(le):n.next(le)},()=>{_e=!0},void 0,()=>{if(_e)try{for(w--;v.length&&w<r;){const le=v.shift();d?zl(n,d,()=>Q(le)):Q(le)}O()}catch(le){n.error(le)}}))};return e.subscribe(Dn(n,k,()=>{N=!0,O()})),()=>{m?.()}}(r,i,e,t)))}function Fi(e=1/0){return Ps(At,e)}const vi=new Ae(e=>e.complete());function Na(e){return e&&Ee(e.schedule)}function qo(e){return e[e.length-1]}function Tu(e){return Ee(qo(e))?e.pop():void 0}function Hs(e){return Na(qo(e))?e.pop():void 0}function fa(e,n=0){return Nn((t,r)=>{t.subscribe(Dn(r,i=>zl(r,e,()=>r.next(i),n),()=>zl(r,e,()=>r.complete(),n),i=>zl(r,e,()=>r.error(i),n)))})}function Wt(e,n=0){return Nn((t,r)=>{r.add(e.schedule(()=>t.subscribe(r),n))})}function uu(e,n){if(!e)throw new Error("Iterable cannot be null");return new Ae(t=>{zl(t,n,()=>{const r=e[Symbol.asyncIterator]();zl(t,n,()=>{r.next().then(i=>{i.done?t.complete():t.next(i.value)})},0,!0)})})}function ws(e,n){return n?function Ld(e,n){if(null!=e){if(En(e))return function Vl(e,n){return Jr(e).pipe(Wt(n),fa(n))}(e,n);if(Lt(e))return function Bs(e,n){return new Ae(t=>{let r=0;return n.schedule(function(){r===e.length?t.complete():(t.next(e[r++]),t.closed||this.schedule())})})}(e,n);if(fn(e))return function gs(e,n){return Jr(e).pipe(Wt(n),fa(n))}(e,n);if(pn(e))return uu(e,n);if(Nr(e))return function ts(e,n){return new Ae(t=>{let r;return zl(t,n,()=>{r=e[Ur](),zl(t,n,()=>{let i,s;try{({value:i,done:s}=r.next())}catch(d){return void t.error(d)}s?t.complete():t.next(i)},0,!0)}),()=>Ee(r?.return)&&r.return()})}(e,n);if(Ro(e))return function Ul(e,n){return uu(Qr(e),n)}(e,n)}throw Vr(e)}(e,n):Jr(e)}function Rn(...e){return ws(e,Hs(e))}function Mr(e={}){const{connector:n=(()=>new It),resetOnError:t=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=e;return s=>{let d,m,v,w=0,D=!1,N=!1;const O=()=>{m?.unsubscribe(),m=void 0},k=()=>{O(),d=v=void 0,D=N=!1},Q=()=>{const X=d;k(),X?.unsubscribe()};return Nn((X,_e)=>{w++,!N&&!D&&O();const le=v=v??n();_e.add(()=>{w--,0===w&&!N&&!D&&(m=$a(Q,i))}),le.subscribe(_e),!d&&w>0&&(d=new ie({next:K=>le.next(K),error:K=>{N=!0,O(),m=$a(k,t,K),le.error(K)},complete:()=>{D=!0,O(),m=$a(k,r),le.complete()}}),Jr(X).subscribe(d))})(s)}}function $a(e,n,...t){if(!0===n)return void e();if(!1===n)return;const r=new ie({next:()=>{r.unsubscribe(),e()}});return Jr(n(...t)).subscribe(r)}function ur(e,n){return Nn((t,r)=>{let i=null,s=0,d=!1;const m=()=>d&&!i&&r.complete();t.subscribe(Dn(r,v=>{i?.unsubscribe();let w=0;const D=s++;Jr(e(v,D)).subscribe(i=Dn(r,N=>r.next(n?n(v,N,D,w++):N),()=>{i=null,m()}))},()=>{d=!0,m()}))})}function jl(e,n){return e===n}function Ni(e){for(let n in e)if(e[n]===Ni)return n;throw Error("Could not find renamed property on target object.")}function qs(e,n){for(const t in n)n.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function xi(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(xi).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const n=e.toString();if(null==n)return""+n;const t=n.indexOf("\n");return-1===t?n:n.substring(0,t)}function Io(e,n){return null==e||""===e?null===n?"":n:null==n||""===n?e:e+" "+n}const mf=Ni({__forward_ref__:Ni});function $t(e){return e.__forward_ref__=$t,e.toString=function(){return xi(this())},e}function Rr(e){return Pa(e)?e():e}function Pa(e){return"function"==typeof e&&e.hasOwnProperty(mf)&&e.__forward_ref__===$t}function Sl(e){return e&&!!e.\u0275providers}const Rs="https://g.co/ng/security#xss";class en extends Error{constructor(n,t){super(function di(e,n){return`NG0${Math.abs(e)}${n?": "+n:""}`}(n,t)),this.code=n}}function Yn(e){return"string"==typeof e?e:null==e?"":String(e)}function zo(e,n){throw new en(-201,!1)}function Gl(e,n){null==e&&function ti(e,n,t,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${t} ${r} ${n} <=Actual]`))}(n,e,null,"!=")}function Gn(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Ti(e){return{providers:e.providers||[],imports:e.imports||[]}}function Hl(e){return fl(e,Ha)||fl(e,jo)}function fl(e,n){return e.hasOwnProperty(n)?e[n]:null}function oc(e){return e&&(e.hasOwnProperty(sc)||e.hasOwnProperty(er))?e[sc]:null}const Ha=Ni({\u0275prov:Ni}),sc=Ni({\u0275inj:Ni}),jo=Ni({ngInjectableDef:Ni}),er=Ni({ngInjectorDef:Ni});var Kn=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Kn||{});let Qc;function ns(e){const n=Qc;return Qc=e,n}function Iu(e,n,t){const r=Hl(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:t&Kn.Optional?null:void 0!==n?n:void zo(xi(e))}const Eo=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Ei={},ql="__NG_DI_FLAG__",Xs="ngTempTokenPath",ni=/\n/gm,yo="__source";let Wl;function rl(e){const n=Wl;return Wl=e,n}function Ci(e,n=Kn.Default){if(void 0===Wl)throw new en(-203,!1);return null===Wl?Iu(e,void 0,n):Wl.get(e,n&Kn.Optional?null:void 0,n)}function jn(e,n=Kn.Default){return(function pa(){return Qc}()||Ci)(Rr(e),n)}function Vn(e,n=Kn.Default){return jn(e,Uu(n))}function Uu(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function ga(e){const n=[];for(let t=0;t<e.length;t++){const r=Rr(e[t]);if(Array.isArray(r)){if(0===r.length)throw new en(900,!1);let i,s=Kn.Default;for(let d=0;d<r.length;d++){const m=r[d],v=ma(m);"number"==typeof v?-1===v?i=m.token:s|=v:i=m}n.push(jn(i,s))}else n.push(jn(r))}return n}function Ys(e,n){return e[ql]=n,e.prototype[ql]=n,e}function ma(e){return e[ql]}function _a(e){return{toString:e}.toString()}var Ra=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(Ra||{}),oa=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(oa||{});const Wo={},oi=[],pl=Ni({\u0275cmp:Ni}),ju=Ni({\u0275dir:Ni}),il=Ni({\u0275pipe:Ni}),rs=Ni({\u0275mod:Ni}),hu=Ni({\u0275fac:Ni}),du=Ni({__NG_ELEMENT_ID__:Ni}),Ks=Ni({__NG_ENV_ID__:Ni});function ya(e,n,t){let r=e.length;for(;;){const i=e.indexOf(n,t);if(-1===i)return i;if(0===i||e.charCodeAt(i-1)<=32){const s=n.length;if(i+s===r||e.charCodeAt(i+s)<=32)return i}t=i+1}}function qa(e,n,t){let r=0;for(;r<t.length;){const i=t[r];if("number"==typeof i){if(0!==i)break;r++;const s=t[r++],d=t[r++],m=t[r++];e.setAttribute(n,d,m,s)}else{const s=i,d=t[++r];Js(s)?e.setProperty(n,s,d):e.setAttribute(n,s,d),r++}}return r}function ed(e){return 3===e||4===e||6===e}function Js(e){return 64===e.charCodeAt(0)}function eh(e,n){if(null!==n&&0!==n.length)if(null===e||0===e.length)e=n.slice();else{let t=-1;for(let r=0;r<n.length;r++){const i=n[r];"number"==typeof i?t=i:0===t||Ic(e,t,i,null,-1===t||2===t?n[++r]:null)}}return e}function Ic(e,n,t,r,i){let s=0,d=e.length;if(-1===n)d=-1;else for(;s<e.length;){const m=e[s++];if("number"==typeof m){if(m===n){d=-1;break}if(m>n){d=s-1;break}}}for(;s<e.length;){const m=e[s];if("number"==typeof m)break;if(m===t){if(null===r)return void(null!==i&&(e[s+1]=i));if(r===e[s+1])return void(e[s+2]=i)}s++,null!==r&&s++,null!==i&&s++}-1!==d&&(e.splice(d,0,n),s=d+1),e.splice(s++,0,t),null!==r&&e.splice(s++,0,r),null!==i&&e.splice(s++,0,i)}const th="ng-template";function Fd(e,n,t){let r=0,i=!0;for(;r<e.length;){let s=e[r++];if("string"==typeof s&&i){const d=e[r++];if(t&&"class"===s&&-1!==ya(d.toLowerCase(),n,0))return!0}else{if(1===s){for(;r<e.length&&"string"==typeof(s=e[r++]);)if(s.toLowerCase()===n)return!0;return!1}"number"==typeof s&&(i=!1)}}return!1}function Sh(e){return 4===e.type&&e.value!==th}function Mu(e,n,t){return n===(4!==e.type||t?e.value:th)}function fu(e,n,t){let r=4;const i=e.attrs||[],s=function gu(e){for(let n=0;n<e.length;n++)if(ed(e[n]))return n;return e.length}(i);let d=!1;for(let m=0;m<n.length;m++){const v=n[m];if("number"!=typeof v){if(!d)if(4&r){if(r=2|1&r,""!==v&&!Mu(e,v,t)||""===v&&1===n.length){if(vo(r))return!1;d=!0}}else{const w=8&r?v:n[++m];if(8&r&&null!==e.attrs){if(!Fd(e.attrs,w,t)){if(vo(r))return!1;d=!0}continue}const N=Dh(8&r?"class":v,i,Sh(e),t);if(-1===N){if(vo(r))return!1;d=!0;continue}if(""!==w){let O;O=N>s?"":i[N+1].toLowerCase();const k=8&r?O:null;if(k&&-1!==ya(k,w,0)||2&r&&w!==O){if(vo(r))return!1;d=!0}}}}else{if(!d&&!vo(r)&&!vo(v))return!1;if(d&&vo(v))continue;d=!1,r=v|1&r}}return vo(r)||d}function vo(e){return 0==(1&e)}function Dh(e,n,t,r){if(null===n)return-1;let i=0;if(r||!t){let s=!1;for(;i<n.length;){const d=n[i];if(d===e)return i;if(3===d||6===d)s=!0;else{if(1===d||2===d){let m=n[++i];for(;"string"==typeof m;)m=n[++i];continue}if(4===d)break;if(0===d){i+=4;continue}}i+=s?1:2}return-1}return function Bd(e,n){let t=e.indexOf(4);if(t>-1)for(t++;t<e.length;){const r=e[t];if("number"==typeof r)return-1;if(r===n)return t;t++}return-1}(n,e)}function Qs(e,n,t=!1){for(let r=0;r<n.length;r++)if(fu(e,n[r],t))return!0;return!1}function Gu(e,n){e:for(let t=0;t<n.length;t++){const r=n[t];if(e.length===r.length){for(let i=0;i<e.length;i++)if(e[i]!==r[i])continue e;return!0}}return!1}function Au(e,n){return e?":not("+n.trim()+")":n}function gl(e){let n=e[0],t=1,r=2,i="",s=!1;for(;t<e.length;){let d=e[t];if("string"==typeof d)if(2&r){const m=e[++t];i+="["+d+(m.length>0?'="'+m+'"':"")+"]"}else 8&r?i+="."+d:4&r&&(i+=" "+d);else""!==i&&!vo(d)&&(n+=Au(s,i),i=""),r=d,s=s||!vo(r);t++}return""!==i&&(n+=Au(s,i)),n}function Bi(e){return _a(()=>{const n=cc(e),t={...n,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===Ra.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||oa.Emulated,styles:e.styles||oi,_:null,schemas:e.schemas||null,tView:null,id:""};ol(t);const r=e.dependencies;return t.directiveDefs=Zo(r,!1),t.pipeDefs=Zo(r,!0),t.id=function mu(e){let n=0;const t=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const i of t)n=Math.imul(31,n)+i.charCodeAt(0)<<0;return n+=2147483648,"c"+n}(t),t})}function lc(e){return gi(e)||Oi(e)}function Mc(e){return null!==e}function Or(e){return _a(()=>({type:e.type,bootstrap:e.bootstrap||oi,declarations:e.declarations||oi,imports:e.imports||oi,exports:e.exports||oi,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function Ml(e,n){if(null==e)return Wo;const t={};for(const r in e)if(e.hasOwnProperty(r)){let i=e[r],s=i;Array.isArray(i)&&(s=i[1],i=i[0]),t[i]=r,n&&(n[i]=s)}return t}function Mn(e){return _a(()=>{const n=cc(e);return ol(n),n})}function gi(e){return e[pl]||null}function Oi(e){return e[ju]||null}function Ui(e){return e[il]||null}function Si(e,n){const t=e[rs]||null;if(!t&&!0===n)throw new Error(`Type ${xi(e)} does not have '\u0275mod' property.`);return t}function cc(e){const n={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:e.inputs||Wo,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||oi,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Ml(e.inputs,n),outputs:Ml(e.outputs)}}function ol(e){e.features?.forEach(n=>n(e))}function Zo(e,n){if(!e)return null;const t=n?Ui:lc;return()=>("function"==typeof e?e():e).map(r=>t(r)).filter(Mc)}const is=0,Bn=1,Ar=2,mi=3,Ds=4,Ii=5,Oa=6,$u=7,ai=8,va=9,Nu=10,Pr=11,Wa=12,_s=13,os=14,vn=15,Mo=16,hc=17,Za=18,Go=19,xa=20,Us=21,Xl=22,Hu=23,nh=24,Di=25,Kl=1,dc=2,_u=7,La=9,Ls=11;function sr(e){return Array.isArray(e)&&"object"==typeof e[Kl]}function ss(e){return Array.isArray(e)&&!0===e[Kl]}function yu(e){return 0!=(4&e.flags)}function sl(e){return e.componentOffset>-1}function ba(e){return 1==(1&e.flags)}function Al(e){return!!e.template}function ka(e){return 0!=(512&e[Ar])}function Ea(e,n){return e.hasOwnProperty(hu)?e[hu]:null}let xm=Eo.WeakRef??class dy{constructor(n){this.ref=n}deref(){return this.ref}},bm=0,Nc=null,rp=!1;function Fa(e){const n=Nc;return Nc=e,n}class ip{constructor(){this.id=bm++,this.ref=function sg(e){return new xm(e)}(this),this.producers=new Map,this.consumers=new Map,this.trackingVersion=0,this.valueVersion=0}consumerPollProducersForChange(){for(const[n,t]of this.producers){const r=t.producerNode.deref();if(null!=r&&t.atTrackingVersion===this.trackingVersion){if(r.producerPollStatus(t.seenValueVersion))return!0}else this.producers.delete(n),r?.consumers.delete(this.id)}return!1}producerMayHaveChanged(){const n=rp;rp=!0;try{for(const[t,r]of this.consumers){const i=r.consumerNode.deref();null!=i&&i.trackingVersion===r.atTrackingVersion?i.onConsumerDependencyMayHaveChanged():(this.consumers.delete(t),i?.producers.delete(this.id))}}finally{rp=n}}producerAccessed(){if(rp)throw new Error("");if(null===Nc)return;let n=Nc.producers.get(this.id);void 0===n?(n={consumerNode:Nc.ref,producerNode:this.ref,seenValueVersion:this.valueVersion,atTrackingVersion:Nc.trackingVersion},Nc.producers.set(this.id,n),this.consumers.set(Nc.id,n)):(n.seenValueVersion=this.valueVersion,n.atTrackingVersion=Nc.trackingVersion)}get hasProducers(){return this.producers.size>0}get producerUpdatesAllowed(){return!1!==Nc?.consumerAllowSignalWrites}producerPollStatus(n){return this.valueVersion!==n||(this.onProducerUpdateValueVersion(),this.valueVersion!==n)}}let T=null;const ge=()=>{};class De extends ip{constructor(n,t,r){super(),this.watch=n,this.schedule=t,this.dirty=!1,this.cleanupFn=ge,this.registerOnCleanup=i=>{this.cleanupFn=i},this.consumerAllowSignalWrites=r}notify(){this.dirty||this.schedule(this),this.dirty=!0}onConsumerDependencyMayHaveChanged(){this.notify()}onProducerUpdateValueVersion(){}run(){if(this.dirty=!1,0!==this.trackingVersion&&!this.consumerPollProducersForChange())return;const n=Fa(this);this.trackingVersion++;try{this.cleanupFn(),this.cleanupFn=ge,this.watch(this.registerOnCleanup)}finally{Fa(n)}}cleanup(){this.cleanupFn()}}class Re{constructor(n,t,r){this.previousValue=n,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function Ce(){return Le}function Le(e){return e.type.prototype.ngOnChanges&&(e.setInput=Se),te}function te(){const e=He(this),n=e?.current;if(n){const t=e.previous;if(t===Wo)e.previous=n;else for(let r in n)t[r]=n[r];e.current=null,this.ngOnChanges(n)}}function Se(e,n,t,r){const i=this.declaredInputs[t],s=He(e)||function lt(e,n){return e[Ue]=n}(e,{previous:Wo,current:null}),d=s.current||(s.current={}),m=s.previous,v=m[i];d[i]=new Re(v&&v.currentValue,n,m===Wo),e[r]=n}Ce.ngInherit=!0;const Ue="__ngSimpleChanges__";function He(e){return e[Ue]||null}const yt=function(e,n,t){};function Qt(e){for(;Array.isArray(e);)e=e[is];return e}function Jt(e,n){return Qt(n[e])}function Pt(e,n){return Qt(n[e.index])}function Ft(e,n){return e.data[n]}function an(e,n){const t=n[e];return sr(t)?t:t[is]}function br(e,n){return null==n?null:e[n]}function Hn(e){e[hc]=0}function vr(e){1024&e[Ar]||(e[Ar]|=1024,li(e,1))}function ci(e){1024&e[Ar]&&(e[Ar]&=-1025,li(e,-1))}function li(e,n){let t=e[mi];if(null===t)return;t[Ii]+=n;let r=t;for(t=t[mi];null!==t&&(1===n&&1===r[Ii]||-1===n&&0===r[Ii]);)t[Ii]+=n,r=t,t=t[mi]}const qn={lFrame:id(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function pc(){return qn.bindingsEnabled}function ko(){return null!==qn.skipHydrationRootTNode}function cn(){return qn.lFrame.lView}function Li(){return qn.lFrame.tView}function ks(){let e=rh();for(;null!==e&&64===e.type;)e=e.parent;return e}function rh(){return qn.lFrame.currentTNode}function Ru(e,n){const t=qn.lFrame;t.currentTNode=e,t.isParent=n}function nd(){return qn.lFrame.isParent}function vf(){qn.lFrame.isParent=!1}function zd(){return qn.lFrame.bindingIndex++}function Rc(e){const n=qn.lFrame,t=n.bindingIndex;return n.bindingIndex=n.bindingIndex+e,t}function v1(e,n){const t=qn.lFrame;t.bindingIndex=t.bindingRootIndex=e,gy(n)}function gy(e){qn.lFrame.currentDirectiveIndex=e}function b1(){return qn.lFrame.currentQueryIndex}function lg(e){qn.lFrame.currentQueryIndex=e}function ug(e){const n=e[Bn];return 2===n.type?n.declTNode:1===n.type?e[Oa]:null}function xf(e,n,t){if(t&Kn.SkipSelf){let i=n,s=e;for(;!(i=i.parent,null!==i||t&Kn.Host||(i=ug(s),null===i||(s=s[os],10&i.type))););if(null===i)return!1;n=i,e=s}const r=qn.lFrame=Oc();return r.currentTNode=n,r.lView=e,!0}function ih(e){const n=Oc(),t=e[Bn];qn.lFrame=n,n.currentTNode=t.firstChild,n.lView=e,n.tView=t,n.contextLView=e,n.bindingIndex=t.bindingStartIndex,n.inI18n=!1}function Oc(){const e=qn.lFrame,n=null===e?null:e.child;return null===n?id(e):n}function id(e){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=n),n}function od(){const e=qn.lFrame;return qn.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Vd=od;function _y(){const e=od();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Ou(){return qn.lFrame.selectedIndex}function Ud(e){qn.lFrame.selectedIndex=e}function aa(){const e=qn.lFrame;return Ft(e.tView,e.selectedIndex)}let sd=!0;function bf(){return sd}function Xa(e){sd=e}function cg(e,n){for(let t=n.directiveStart,r=n.directiveEnd;t<r;t++){const s=e.data[t].type.prototype,{ngAfterContentInit:d,ngAfterContentChecked:m,ngAfterViewInit:v,ngAfterViewChecked:w,ngOnDestroy:D}=s;d&&(e.contentHooks??=[]).push(-t,d),m&&((e.contentHooks??=[]).push(t,m),(e.contentCheckHooks??=[]).push(t,m)),v&&(e.viewHooks??=[]).push(-t,v),w&&((e.viewHooks??=[]).push(t,w),(e.viewCheckHooks??=[]).push(t,w)),null!=D&&(e.destroyHooks??=[]).push(t,D)}}function Zu(e,n,t){sp(e,n,3,t)}function op(e,n,t,r){(3&e[Ar])===t&&sp(e,n,t,r)}function ad(e,n){let t=e[Ar];(3&t)===n&&(t&=8191,t+=1,e[Ar]=t)}function sp(e,n,t,r){const s=r??-1,d=n.length-1;let m=0;for(let v=void 0!==r?65535&e[hc]:0;v<d;v++)if("number"==typeof n[v+1]){if(m=n[v],null!=r&&m>=r)break}else n[v]<0&&(e[hc]+=65536),(m<s||-1==s)&&(yy(e,t,n,v),e[hc]=(4294901760&e[hc])+v+2),v++}function jd(e,n){yt(4,e,n);const t=Fa(null);try{n.call(e)}finally{Fa(t),yt(5,e,n)}}function yy(e,n,t,r){const i=t[r]<0,s=t[r+1],m=e[i?-t[r]:t[r]];i?e[Ar]>>13<e[hc]>>16&&(3&e[Ar])===n&&(e[Ar]+=8192,jd(m,s)):jd(m,s)}const ld=-1;class ap{constructor(n,t,r){this.factory=n,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}}function vy(e){return e!==ld}function $d(e){return 32767&e}function vu(e,n){let t=function fg(e){return e>>16}(e),r=n;for(;t>0;)r=r[os],t--;return r}let wf=!0;function _l(e){const n=wf;return wf=e,n}const Em=255,ea=5;let S1=0;const Xu={};function Cm(e,n){const t=by(e,n);if(-1!==t)return t;const r=n[Bn];r.firstCreatePass&&(e.injectorIndex=n.length,xy(r.data,e),xy(n,null),xy(r.blueprint,null));const i=Sm(e,n),s=e.injectorIndex;if(vy(i)){const d=$d(i),m=vu(i,n),v=m[Bn].data;for(let w=0;w<8;w++)n[s+w]=m[d+w]|v[d+w]}return n[s+8]=i,s}function xy(e,n){e.push(0,0,0,0,0,0,0,0,n)}function by(e,n){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===n[e.injectorIndex+8]?-1:e.injectorIndex}function Sm(e,n){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let t=0,r=null,i=n;for(;null!==i;){if(r=I1(i),null===r)return ld;if(t++,i=i[os],-1!==r.injectorIndex)return r.injectorIndex|t<<16}return ld}function ud(e,n,t){!function ah(e,n,t){let r;"string"==typeof t?r=t.charCodeAt(0)||0:t.hasOwnProperty(du)&&(r=t[du]),null==r&&(r=t[du]=S1++);const i=r&Em;n.data[e+(i>>ea)]|=1<<i}(e,n,t)}function wy(e,n,t){if(t&Kn.Optional||void 0!==e)return e;zo()}function Ey(e,n,t,r){if(t&Kn.Optional&&void 0===r&&(r=null),!(t&(Kn.Self|Kn.Host))){const i=e[va],s=ns(void 0);try{return i?i.get(n,r,t&Kn.Optional):Iu(n,r,t&Kn.Optional)}finally{ns(s)}}return wy(r,0,t)}function Cy(e,n,t,r=Kn.Default,i){if(null!==e){if(2048&n[Ar]&&!(r&Kn.Self)){const d=function Ih(e,n,t,r,i){let s=e,d=n;for(;null!==s&&null!==d&&2048&d[Ar]&&!(512&d[Ar]);){const m=T1(s,d,t,r|Kn.Self,Xu);if(m!==Xu)return m;let v=s.parent;if(!v){const w=d[xa];if(w){const D=w.get(t,Xu,r);if(D!==Xu)return D}v=I1(d),d=d[os]}s=v}return i}(e,n,t,r,Xu);if(d!==Xu)return d}const s=T1(e,n,t,r,Xu);if(s!==Xu)return s}return Ey(n,t,r,i)}function T1(e,n,t,r,i){const s=function gg(e){if("string"==typeof e)return e.charCodeAt(0)||0;const n=e.hasOwnProperty(du)?e[du]:void 0;return"number"==typeof n?n>=0?n&Em:xu:n}(t);if("function"==typeof s){if(!xf(n,e,r))return r&Kn.Host?wy(i,0,r):Ey(n,t,r,i);try{const d=s(r);if(null!=d||r&Kn.Optional)return d;zo()}finally{Vd()}}else if("number"==typeof s){let d=null,m=by(e,n),v=ld,w=r&Kn.Host?n[vn][Oa]:null;for((-1===m||r&Kn.SkipSelf)&&(v=-1===m?Sm(e,n):n[m+8],v!==ld&&Tm(r,!1)?(d=n[Bn],m=$d(v),n=vu(v,n)):m=-1);-1!==m;){const D=n[Bn];if(Dm(s,m,D.data)){const N=dE(m,n,t,d,r,w);if(N!==Xu)return N}v=n[m+8],v!==ld&&Tm(r,n[Bn].data[m+8]===w)&&Dm(s,m,n)?(d=D,m=$d(v),n=vu(v,n)):m=-1}}return i}function dE(e,n,t,r,i,s){const d=n[Bn],m=d.data[e+8],D=pg(m,d,t,null==r?sl(m)&&wf:r!=d&&0!=(3&m.type),i&Kn.Host&&s===m);return null!==D?Hd(n,d,D,m):Xu}function pg(e,n,t,r,i){const s=e.providerIndexes,d=n.data,m=1048575&s,v=e.directiveStart,D=s>>20,O=i?m+D:e.directiveEnd;for(let k=r?m:m+D;k<O;k++){const Q=d[k];if(k<v&&t===Q||k>=v&&Q.type===t)return k}if(i){const k=d[v];if(k&&Al(k)&&k.type===t)return v}return null}function Hd(e,n,t,r){let i=e[t];const s=n.data;if(function E1(e){return e instanceof ap}(i)){const d=i;d.resolving&&function zs(e,n){const t=n?`. Dependency path: ${n.join(" > ")} > ${e}`:"";throw new en(-200,`Circular dependency in DI detected for ${e}${t}`)}(function si(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Yn(e)}(s[t]));const m=_l(d.canSeeViewProviders);d.resolving=!0;const v=d.injectImpl?ns(d.injectImpl):null;xf(e,r,Kn.Default);try{i=e[t]=d.factory(void 0,s,e,r),n.firstCreatePass&&t>=r.directiveStart&&function w1(e,n,t){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:s}=n.type.prototype;if(r){const d=Le(n);(t.preOrderHooks??=[]).push(e,d),(t.preOrderCheckHooks??=[]).push(e,d)}i&&(t.preOrderHooks??=[]).push(0-e,i),s&&((t.preOrderHooks??=[]).push(e,s),(t.preOrderCheckHooks??=[]).push(e,s))}(t,s[t],n)}finally{null!==v&&ns(v),_l(m),d.resolving=!1,Vd()}}return i}function Dm(e,n,t){return!!(t[n+(e>>ea)]&1<<e)}function Tm(e,n){return!(e&Kn.Self||e&Kn.Host&&n)}class qd{constructor(n,t){this._tNode=n,this._lView=t}get(n,t,r){return Cy(this._tNode,this._lView,n,Uu(r),t)}}function xu(){return new qd(ks(),cn())}function Da(e){return _a(()=>{const n=e.prototype.constructor,t=n[hu]||Im(n),r=Object.prototype;let i=Object.getPrototypeOf(e.prototype).constructor;for(;i&&i!==r;){const s=i[hu]||Im(i);if(s&&s!==t)return s;i=Object.getPrototypeOf(i)}return s=>new s})}function Im(e){return Pa(e)?()=>{const n=Im(Rr(e));return n&&n()}:Ea(e)}function I1(e){const n=e[Bn],t=n.type;return 2===t?n.declTNode:1===t?e[Oa]:null}const eu="__parameters__";function Ef(e,n,t){return _a(()=>{const r=function up(e){return function(...t){if(e){const r=e(...t);for(const i in r)this[i]=r[i]}}}(n);function i(...s){if(this instanceof i)return r.apply(this,s),this;const d=new i(...s);return m.annotation=d,m;function m(v,w,D){const N=v.hasOwnProperty(eu)?v[eu]:Object.defineProperty(v,eu,{value:[]})[eu];for(;N.length<=D;)N.push(null);return(N[D]=N[D]||[]).push(d),v}}return t&&(i.prototype=Object.create(t.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i})}function pp(e,n){e.forEach(t=>Array.isArray(t)?pp(t,n):n(t))}function Cf(e,n,t){n>=e.length?e.push(t):e.splice(n,0,t)}function _g(e,n){return n>=e.length-1?e.pop():e.splice(n,1)[0]}function Sf(e,n){const t=[];for(let r=0;r<e;r++)t.push(n);return t}function Ku(e,n,t){let r=Gi(e,n);return r>=0?e[1|r]=t:(r=~r,function gE(e,n,t,r){let i=e.length;if(i==n)e.push(t,r);else if(1===i)e.push(r,e[0]),e[0]=t;else{for(i--,e.push(e[i-1],e[i]);i>n;)e[i]=e[i-2],i--;e[n]=t,e[n+1]=r}}(e,r,n,t)),r}function Ah(e,n){const t=Gi(e,n);if(t>=0)return e[1|t]}function Gi(e,n){return function lh(e,n,t){let r=0,i=e.length>>t;for(;i!==r;){const s=r+(i-r>>1),d=e[s<<t];if(n===d)return s<<t;d>n?i=s:r=s+1}return~(i<<t)}(e,n,1)}const yg=Ys(Ef("Optional"),8),Pm=Ys(Ef("SkipSelf"),4);function xg(e){return 128==(128&e.flags)}var kc=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(kc||{});const By=new Map;let ME=0;const vp="__ngContext__";function yl(e,n){sr(n)?(e[vp]=n[Go],function zy(e){By.set(e[Go],e)}(n)):e[vp]=n}let Eg;function Hy(e,n){return Eg(e,n)}function Tf(e){const n=e[mi];return ss(n)?n[mi]:n}function U1(e){return G1(e[Wa])}function j1(e){return G1(e[Ds])}function G1(e){for(;null!==e&&!ss(e);)e=e[Ds];return e}function xp(e,n,t,r,i){if(null!=r){let s,d=!1;ss(r)?s=r:sr(r)&&(d=!0,r=r[is]);const m=Qt(r);0===e&&null!==t?null==i?wp(n,t,m):ch(n,t,m,i||null,!0):1===e&&null!==t?ch(n,t,m,i||null,!0):2===e?function Mg(e,n,t){const r=Hm(e,n);r&&function Tg(e,n,t,r){e.removeChild(n,t,r)}(e,r,n,t)}(n,m,d):3===e&&n.destroyNode(m),null!=s&&function Y1(e,n,t,r,i){const s=t[_u];s!==Qt(t)&&xp(n,e,r,s,i);for(let m=Ls;m<t.length;m++){const v=t[m];Oh(v[Bn],v,e,n,r,s)}}(n,e,s,t,i)}}function Sg(e,n,t){return e.createElement(n,t)}function q1(e,n){const t=e[La],r=t.indexOf(n);ci(n),t.splice(r,1)}function Zy(e,n){if(e.length<=Ls)return;const t=Ls+n,r=e[t];if(r){const i=r[Mo];null!==i&&i!==e&&q1(i,r),n>0&&(e[t-1][Ds]=r[Ds]);const s=_g(e,Ls+n);!function bp(e,n){Oh(e,n,n[Pr],2,null,null),n[is]=null,n[Oa]=null}(r[Bn],r);const d=s[Za];null!==d&&d.detachView(s[Bn]),r[mi]=null,r[Ds]=null,r[Ar]&=-129}return r}function W1(e,n){if(!(256&n[Ar])){const t=n[Pr];n[Hu]?.destroy(),n[nh]?.destroy(),t.destroyNode&&Oh(e,n,t,3,null,null),function FE(e){let n=e[Wa];if(!n)return Dg(e[Bn],e);for(;n;){let t=null;if(sr(n))t=n[Wa];else{const r=n[Ls];r&&(t=r)}if(!t){for(;n&&!n[Ds]&&n!==e;)sr(n)&&Dg(n[Bn],n),n=n[mi];null===n&&(n=e),sr(n)&&Dg(n[Bn],n),t=n&&n[Ds]}n=t}}(n)}}function Dg(e,n){if(!(256&n[Ar])){n[Ar]&=-129,n[Ar]|=256,function $m(e,n){let t;if(null!=e&&null!=(t=e.destroyHooks))for(let r=0;r<t.length;r+=2){const i=n[t[r]];if(!(i instanceof ap)){const s=t[r+1];if(Array.isArray(s))for(let d=0;d<s.length;d+=2){const m=i[s[d]],v=s[d+1];yt(4,m,v);try{v.call(m)}finally{yt(5,m,v)}}else{yt(4,i,s);try{s.call(i)}finally{yt(5,i,s)}}}}}(e,n),function Gm(e,n){const t=e.cleanup,r=n[$u];if(null!==t)for(let s=0;s<t.length-1;s+=2)if("string"==typeof t[s]){const d=t[s+3];d>=0?r[d]():r[-d].unsubscribe(),s+=2}else t[s].call(r[t[s+1]]);null!==r&&(n[$u]=null);const i=n[Us];if(null!==i){n[Us]=null;for(let s=0;s<i.length;s++)(0,i[s])()}}(e,n),1===n[Bn].type&&n[Pr].destroy();const t=n[Mo];if(null!==t&&ss(n[mi])){t!==n[mi]&&q1(t,n);const r=n[Za];null!==r&&r.detachView(e)}!function _p(e){By.delete(e[Go])}(n)}}function Xy(e,n,t){return function Z1(e,n,t){let r=n;for(;null!==r&&40&r.type;)r=(n=r).parent;if(null===r)return t[is];{const{componentOffset:i}=r;if(i>-1){const{encapsulation:s}=e.data[r.directiveStart+i];if(s===oa.None||s===oa.Emulated)return null}return Pt(r,t)}}(e,n.parent,t)}function ch(e,n,t,r,i){e.insertBefore(n,t,r,i)}function wp(e,n,t){e.appendChild(n,t)}function Yy(e,n,t,r,i){null!==r?ch(e,n,t,r,i):wp(e,n,t)}function Hm(e,n){return e.parentNode(n)}function Ky(e,n,t){return Qy(e,n,t)}let qm,o0,Xm,Qy=function Jy(e,n,t){return 40&e.type?Pt(e,t):null};function Wm(e,n,t,r){const i=Xy(e,r,n),s=n[Pr],m=Ky(r.parent||n[Oa],r,n);if(null!=i)if(Array.isArray(t))for(let v=0;v<t.length;v++)Yy(s,i,t[v],m,!1);else Yy(s,i,t,m,!1);void 0!==qm&&qm(s,r,n,t,i)}function Ig(e,n){if(null!==n){const t=n.type;if(3&t)return Pt(n,e);if(4&t)return Ep(-1,e[n.index]);if(8&t){const r=n.child;if(null!==r)return Ig(e,r);{const i=e[n.index];return ss(i)?Ep(-1,i):Qt(i)}}if(32&t)return Hy(n,e)()||Qt(e[n.index]);{const r=t0(e,n);return null!==r?Array.isArray(r)?r[0]:Ig(Tf(e[vn]),r):Ig(e,n.next)}}return null}function t0(e,n){return null!==n?e[vn][Oa].projection[n.projection]:null}function Ep(e,n){const t=Ls+e+1;if(t<n.length){const r=n[t],i=r[Bn].firstChild;if(null!==i)return Ig(r,i)}return n[_u]}function If(e,n,t,r,i,s,d){for(;null!=t;){const m=r[t.index],v=t.type;if(d&&0===n&&(m&&yl(Qt(m),r),t.flags|=2),32!=(32&t.flags))if(8&v)If(e,n,t.child,r,i,s,!1),xp(n,e,i,m,s);else if(32&v){const w=Hy(t,r);let D;for(;D=w();)xp(n,e,i,D,s);xp(n,e,i,m,s)}else 16&v?n0(e,n,r,t,i,s):xp(n,e,i,m,s);t=d?t.projectionNext:t.next}}function Oh(e,n,t,r,i,s){If(t,r,e.firstChild,n,i,s,!1)}function n0(e,n,t,r,i,s){const d=t[vn],v=d[Oa].projection[r.projection];if(Array.isArray(v))for(let w=0;w<v.length;w++)xp(n,e,i,v[w],s);else{let w=v;const D=d[mi];xg(r)&&(w.flags|=128),If(e,n,w,D,i,s,!0)}}function K1(e,n,t){""===t?e.removeAttribute(n,"class"):e.setAttribute(n,"class",t)}function J1(e,n,t){const{mergedAttrs:r,classes:i,styles:s}=t;null!==r&&qa(e,n,r),null!==i&&K1(e,n,i),null!==s&&function VE(e,n,t){e.setAttribute(n,"style",t)}(e,n,s)}function ul(e){return function s0(){if(void 0===Xm&&(Xm=null,Eo.trustedTypes))try{Xm=Eo.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Xm}()?.createScriptURL(e)||e}class Fc{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Rs})`}}function Bc(e){return e instanceof Fc?e.changingThisBreaksApplicationSecurity:e}function Pg(e,n){const t=function qE(e){return e instanceof Fc&&e.getTypeName()||null}(e);if(null!=t&&t!==n){if("ResourceURL"===t&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${t} (see ${Rs})`)}return t===n}const ix=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Mf=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(Mf||{});function e_(e){const n=Ip();return n?n.sanitize(Mf.URL,e)||"":Pg(e,"URL")?Bc(e):function c0(e){return(e=String(e)).match(ix)?e:"unsafe:"+e}(Yn(e))}function Lg(e){const n=Ip();if(n)return ul(n.sanitize(Mf.RESOURCE_URL,e)||"");if(Pg(e,"ResourceURL"))return ul(Bc(e));throw new en(904,!1)}function Ip(){const e=cn();return e&&e[Nu].sanitizer}class wr{constructor(n,t){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Gn({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Mp=new wr("ENVIRONMENT_INITIALIZER"),Lh=new wr("INJECTOR",-1),p0=new wr("INJECTOR_DEF_TYPES");class g0{get(n,t=Ei){if(t===Ei){const r=new Error(`NullInjectorError: No provider for ${xi(n)}!`);throw r.name="NullInjectorError",r}return t}}function dx(...e){return{\u0275providers:fx(0,e),\u0275fromNgModule:!0}}function fx(e,...n){const t=[],r=new Set;let i;return pp(n,s=>{const d=s;t_(d,t,[],r)&&(i||=[],i.push(d))}),void 0!==i&&px(i,t),t}function px(e,n){for(let t=0;t<e.length;t++){const{providers:i}=e[t];Af(i,s=>{n.push(s)})}}function t_(e,n,t,r){if(!(e=Rr(e)))return!1;let i=null,s=oc(e);const d=!s&&gi(e);if(s||d){if(d&&!d.standalone)return!1;i=e}else{const v=e.ngModule;if(s=oc(v),!s)return!1;i=v}const m=r.has(i);if(d){if(m)return!1;if(r.add(i),d.dependencies){const v="function"==typeof d.dependencies?d.dependencies():d.dependencies;for(const w of v)t_(w,n,t,r)}}else{if(!s)return!1;{if(null!=s.imports&&!m){let w;r.add(i);try{pp(s.imports,D=>{t_(D,n,t,r)&&(w||=[],w.push(D))})}finally{}void 0!==w&&px(w,n)}if(!m){const w=Ea(i)||(()=>new i);n.push({provide:i,useFactory:w,deps:oi},{provide:p0,useValue:i,multi:!0},{provide:Mp,useValue:()=>jn(i),multi:!0})}const v=s.providers;null==v||m||Af(v,D=>{n.push(D)})}}return i!==e&&void 0!==e.providers}function Af(e,n){for(let t of e)Sl(t)&&(t=t.\u0275providers),Array.isArray(t)?Af(t,n):n(t)}const gx=Ni({provide:String,useValue:Ni});function n_(e){return null!==e&&"object"==typeof e&&gx in e}function Vc(e){return"function"==typeof e}const i_=new wr("Set Injector scope."),Nf={},mx={};let Np;function Pf(){return void 0===Np&&(Np=new g0),Np}class hh{}class _0 extends hh{get destroyed(){return this._destroyed}constructor(n,t,r,i){super(),this.parent=t,this.source=r,this.scopes=i,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,x0(n,d=>this.processProvider(d)),this.records.set(Lh,dh(void 0,this)),i.has("environment")&&this.records.set(hh,dh(void 0,this));const s=this.records.get(i_);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(p0.multi,oi,Kn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();const n=this._onDestroyHooks;this._onDestroyHooks=[];for(const t of n)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();const t=rl(this),r=ns(void 0);try{return n()}finally{rl(t),ns(r)}}get(n,t=Ei,r=Kn.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(Ks))return n[Ks](this);r=Uu(r);const i=rl(this),s=ns(void 0);try{if(!(r&Kn.SkipSelf)){let m=this.records.get(n);if(void 0===m){const v=function _x(e){return"function"==typeof e||"object"==typeof e&&e instanceof wr}(n)&&Hl(n);m=v&&this.injectableDefInScope(v)?dh(y0(n),Nf):null,this.records.set(n,m)}if(null!=m)return this.hydrate(n,m)}return(r&Kn.Self?Pf():this.parent).get(n,t=r&Kn.Optional&&t===Ei?null:t)}catch(d){if("NullInjectorError"===d.name){if((d[Xs]=d[Xs]||[]).unshift(xi(n)),i)throw d;return function og(e,n,t,r){const i=e[Xs];throw n[yo]&&i.unshift(n[yo]),e.message=function ep(e,n,t,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let i=xi(n);if(Array.isArray(n))i=n.map(xi).join(" -> ");else if("object"==typeof n){let s=[];for(let d in n)if(n.hasOwnProperty(d)){let m=n[d];s.push(d+":"+("string"==typeof m?JSON.stringify(m):xi(m)))}i=`{${s.join(", ")}}`}return`${t}${r?"("+r+")":""}[${i}]: ${e.replace(ni,"\n  ")}`}("\n"+e.message,i,t,r),e.ngTokenPath=i,e[Xs]=null,e}(d,n,"R3InjectorError",this.source)}throw d}finally{ns(s),rl(i)}}resolveInjectorInitializers(){const n=rl(this),t=ns(void 0);try{const r=this.get(Mp.multi,oi,Kn.Self);for(const i of r)i()}finally{rl(n),ns(t)}}toString(){const n=[],t=this.records;for(const r of t.keys())n.push(xi(r));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new en(205,!1)}processProvider(n){let t=Vc(n=Rr(n))?n:Rr(n&&n.provide);const r=function oC(e){return n_(e)?dh(void 0,e.useValue):dh(Rf(e),Nf)}(n);if(Vc(n)||!0!==n.multi)this.records.get(t);else{let i=this.records.get(t);i||(i=dh(void 0,Nf,!0),i.factory=()=>ga(i.multi),this.records.set(t,i)),t=n,i.multi.push(n)}this.records.set(t,r)}hydrate(n,t){return t.value===Nf&&(t.value=mx,t.value=t.factory()),"object"==typeof t.value&&t.value&&function sC(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(n){if(!n.providedIn)return!1;const t=Rr(n.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(n){const t=this._onDestroyHooks.indexOf(n);-1!==t&&this._onDestroyHooks.splice(t,1)}}function y0(e){const n=Hl(e),t=null!==n?n.factory:Ea(e);if(null!==t)return t;if(e instanceof wr)throw new en(204,!1);if(e instanceof Function)return function iC(e){const n=e.length;if(n>0)throw Sf(n,"?"),new en(204,!1);const t=function Vs(e){return e&&(e[Ha]||e[jo])||null}(e);return null!==t?()=>t.factory(e):()=>new e}(e);throw new en(204,!1)}function Rf(e,n,t){let r;if(Vc(e)){const i=Rr(e);return Ea(i)||y0(i)}if(n_(e))r=()=>Rr(e.useValue);else if(function r_(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...ga(e.deps||[]));else if(function zc(e){return!(!e||!e.useExisting)}(e))r=()=>jn(Rr(e.useExisting));else{const i=Rr(e&&(e.useClass||e.provide));if(!function v0(e){return!!e.deps}(e))return Ea(i)||y0(i);r=()=>new i(...ga(e.deps))}return r}function dh(e,n,t=!1){return{factory:e,value:n,multi:t?[]:void 0}}function x0(e,n){for(const t of e)Array.isArray(t)?x0(t,n):t&&Sl(t)?x0(t.\u0275providers,n):n(t)}const Pp=new wr("AppId",{providedIn:"root",factory:()=>aC}),aC="ng",Rp=new wr("Platform Initializer"),vc=new wr("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),kg=new wr("CSP nonce",{providedIn:"root",factory:()=>function Ng(){if(void 0!==o0)return o0;if(typeof document<"u")return document;throw new en(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let vx=(e,n)=>null;function E0(e,n){return vx(e,n)}class gC{}class u_{}class mC{resolveComponentFactory(n){throw function Ex(e){const n=Error(`No component factory found for ${xi(e)}.`);return n.ngComponent=e,n}(n)}}let c_=(()=>{class e{}return e.NULL=new mC,e})();function _C(){return Jd(ks(),cn())}function Jd(e,n){return new Yo(Pt(e,n))}let Yo=(()=>{class e{constructor(t){this.nativeElement=t}}return e.__NG_ELEMENT_ID__=_C,e})();function Vg(e){return e instanceof Yo?e.nativeElement:e}class C0{}let Ju=(()=>{class e{constructor(){this.destroyNode=null}}return e.__NG_ELEMENT_ID__=()=>function Cx(){const e=cn(),t=an(ks().index,e);return(sr(t)?t:e)[Pr]}(),e})(),yC=(()=>{class e{}return e.\u0275prov=Gn({token:e,providedIn:"root",factory:()=>null}),e})();class kp{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const Uc=new kp("16.1.6"),jc={};function Gc(e){for(;e;){e[Ar]|=64;const n=Tf(e);if(ka(e)&&!n)return e;e=n}return null}function Fp(e){return e.ngOriginalError}class Qd{constructor(){this._console=console}handleError(n){const t=this._findOriginalError(n);this._console.error("ERROR",n),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(n){let t=n&&Fp(n);for(;t&&Fp(t);)t=Fp(t);return t||null}}const h_=new wr("",{providedIn:"root",factory:()=>!1});function bu(e){return e instanceof Function?e():e}class gh extends ip{constructor(){super(...arguments),this.consumerAllowSignalWrites=!1,this._lView=null}set lView(n){this._lView=n}onConsumerDependencyMayHaveChanged(){Gc(this._lView)}onProducerUpdateValueVersion(){}get hasReadASignal(){return this.hasProducers}runInContext(n,t,r){const i=Fa(this);this.trackingVersion++;try{n(t,r)}finally{Fa(i)}}destroy(){this.trackingVersion++}}let Bp=null;function f_(){return Bp??=new gh,Bp}function $c(e,n){return e[n]??f_()}function ef(e,n){const t=f_();t.hasReadASignal&&(e[n]=Bp,t.lView=e,Bp=new gh)}const fi={};function hr(e){zp(Li(),cn(),Ou()+e,!1)}function zp(e,n,t,r){if(!r)if(3==(3&n[Ar])){const s=e.preOrderCheckHooks;null!==s&&Zu(n,s,t)}else{const s=e.preOrderHooks;null!==s&&op(n,s,0,t)}Ud(t)}function R0(e,n=null,t=null,r){const i=p_(e,n,t,r);return i.resolveInjectorInitializers(),i}function p_(e,n=null,t=null,r,i=new Set){const s=[t||oi,dx(e)];return r=r||("object"==typeof e?void 0:xi(e)),new _0(s,n||Pf(),r||null,i)}let wu=(()=>{class e{static create(t,r){if(Array.isArray(t))return R0({name:""},r,t,"");{const i=t.name??"";return R0({name:i},t.parent,t.providers,i)}}}return e.THROW_IF_NOT_FOUND=Ei,e.NULL=new g0,e.\u0275prov=Gn({token:e,providedIn:"any",factory:()=>jn(Lh)}),e.__NG_ELEMENT_ID__=-1,e})();function wt(e,n=Kn.Default){const t=cn();return null===t?jn(e,n):Cy(ks(),t,Rr(e),n)}function jg(e,n,t,r,i,s,d,m,v,w,D){const N=n.blueprint.slice();return N[is]=i,N[Ar]=140|r,(null!==w||e&&2048&e[Ar])&&(N[Ar]|=2048),Hn(N),N[mi]=N[os]=e,N[ai]=t,N[Nu]=d||e&&e[Nu],N[Pr]=m||e&&e[Pr],N[va]=v||e&&e[va]||null,N[Oa]=s,N[Go]=function AE(){return ME++}(),N[Xl]=D,N[xa]=w,N[vn]=2==n.type?e[vn]:N,N}function a(e,n,t,r,i){let s=e.data[n];if(null===s)s=function o(e,n,t,r,i){const s=rh(),d=nd(),v=e.data[n]=function ve(e,n,t,r,i,s){let d=n?n.injectorIndex:-1,m=0;return ko()&&(m|=128),{type:t,index:r,insertBeforeIndex:null,injectorIndex:d,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:m,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,d?s:s&&s.parent,t,n,r,i);return null===e.firstChild&&(e.firstChild=v),null!==s&&(d?null==s.child&&null!==v.parent&&(s.child=v):null===s.next&&(s.next=v,v.prev=s)),v}(e,n,t,r,i),function rd(){return qn.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=t,s.value=r,s.attrs=i;const d=function gc(){const e=qn.lFrame,n=e.currentTNode;return e.isParent?n:n.parent}();s.injectorIndex=null===d?-1:d.injectorIndex}return Ru(s,!0),s}function u(e,n,t,r){if(0===t)return-1;const i=n.length;for(let s=0;s<t;s++)n.push(r),e.blueprint.push(r),e.data.push(null);return i}function f(e,n,t,r,i){const s=$c(n,Hu),d=Ou(),m=2&r;try{if(Ud(-1),m&&n.length>Di&&zp(e,n,Di,!1),yt(m?2:0,i),m)s.runInContext(t,r,i);else{const w=Fa(null);try{t(r,i)}finally{Fa(w)}}}finally{m&&null===n[Hu]&&ef(n,Hu),Ud(d),yt(m?3:1,i)}}function _(e,n,t){if(yu(n)){const r=Fa(null);try{const s=n.directiveEnd;for(let d=n.directiveStart;d<s;d++){const m=e.data[d];m.contentQueries&&m.contentQueries(1,t[d],d)}}finally{Fa(r)}}}function E(e,n,t){pc()&&(function nn(e,n,t,r){const i=t.directiveStart,s=t.directiveEnd;sl(t)&&function fr(e,n,t){const r=Pt(n,e),i=M(t);let d=16;t.signals?d=4096:t.onPush&&(d=64);const m=Do(e,jg(e,i,null,d,r,n,null,e[Nu].rendererFactory.createRenderer(r,t),null,null,null));e[n.index]=m}(n,t,e.data[i+t.componentOffset]),e.firstCreatePass||Cm(t,n),yl(r,n);const d=t.initialInputs;for(let m=i;m<s;m++){const v=e.data[m],w=Hd(n,e,m,t);yl(w,n),null!==d&&Wr(0,m-i,w,v,0,d),Al(v)&&(an(t.index,n)[ai]=Hd(n,e,m,t))}}(e,n,t,Pt(t,n)),64==(64&t.flags)&&dn(e,n,t))}function S(e,n,t=Pt){const r=n.localNames;if(null!==r){let i=n.index+1;for(let s=0;s<r.length;s+=2){const d=r[s+1],m=-1===d?t(n,e):e[d];e[i++]=m}}}function M(e){const n=e.tView;return null===n||n.incompleteFirstPass?e.tView=P(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):n}function P(e,n,t,r,i,s,d,m,v,w,D){const N=Di+r,O=N+i,k=function R(e,n){const t=[];for(let r=0;r<n;r++)t.push(r<e?null:fi);return t}(N,O),Q="function"==typeof w?w():w;return k[Bn]={type:e,blueprint:k,template:t,queries:null,viewQuery:m,declTNode:n,data:k.slice().fill(null,N),bindingStartIndex:N,expandoStartIndex:O,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof d?d():d,firstChild:null,schemas:v,consts:Q,incompleteFirstPass:!1,ssrId:D}}let G=e=>null;function ke(e,n,t,r){for(let i in e)if(e.hasOwnProperty(i)){t=null===t?{}:t;const s=e[i];null===r?et(t,n,i,s):r.hasOwnProperty(i)&&et(t,n,r[i],s)}return t}function et(e,n,t,r){e.hasOwnProperty(t)?e[t].push(n,r):e[t]=[n,r]}function Xt(e,n,t,r){if(pc()){const i=null===r?null:{"":-1},s=function Zt(e,n){const t=e.directiveRegistry;let r=null,i=null;if(t)for(let s=0;s<t.length;s++){const d=t[s];if(Qs(n,d.selectors,!1))if(r||(r=[]),Al(d))if(null!==d.findHostDirectiveDefs){const m=[];i=i||new Map,d.findHostDirectiveDefs(d,m,i),r.unshift(...m,d),On(e,n,m.length)}else r.unshift(d),On(e,n,0);else i=i||new Map,d.findHostDirectiveDefs?.(d,r,i),r.push(d)}return null===r?null:[r,i]}(e,t);let d,m;null===s?d=m=null:[d,m]=s,null!==d&&_n(e,n,t,d,i,m),i&&function Wn(e,n,t){if(n){const r=e.localNames=[];for(let i=0;i<n.length;i+=2){const s=t[n[i+1]];if(null==s)throw new en(-301,!1);r.push(n[i],s)}}}(t,r,i)}t.mergedAttrs=eh(t.mergedAttrs,t.attrs)}function _n(e,n,t,r,i,s){for(let w=0;w<r.length;w++)ud(Cm(t,n),e,r[w].type);!function qr(e,n,t){e.flags|=1,e.directiveStart=n,e.directiveEnd=n+t,e.providerIndexes=n}(t,e.data.length,r.length);for(let w=0;w<r.length;w++){const D=r[w];D.providersResolver&&D.providersResolver(D)}let d=!1,m=!1,v=u(e,n,r.length,null);for(let w=0;w<r.length;w++){const D=r[w];t.mergedAttrs=eh(t.mergedAttrs,D.hostAttrs),Cn(e,t,n,v,D),kn(v,D,i),null!==D.contentQueries&&(t.flags|=4),(null!==D.hostBindings||null!==D.hostAttrs||0!==D.hostVars)&&(t.flags|=64);const N=D.type.prototype;!d&&(N.ngOnChanges||N.ngOnInit||N.ngDoCheck)&&((e.preOrderHooks??=[]).push(t.index),d=!0),!m&&(N.ngOnChanges||N.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(t.index),m=!0),v++}!function Be(e,n,t){const i=n.directiveEnd,s=e.data,d=n.attrs,m=[];let v=null,w=null;for(let D=n.directiveStart;D<i;D++){const N=s[D],O=t?t.get(N):null,Q=O?O.outputs:null;v=ke(N.inputs,D,v,O?O.inputs:null),w=ke(N.outputs,D,w,Q);const X=null===v||null===d||Sh(n)?null:ls(v,D,d);m.push(X)}null!==v&&(v.hasOwnProperty("class")&&(n.flags|=8),v.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=m,n.inputs=v,n.outputs=w}(e,t,s)}function dn(e,n,t){const r=t.directiveStart,i=t.directiveEnd,s=t.index,d=function x1(){return qn.lFrame.currentDirectiveIndex}();try{Ud(s);for(let m=r;m<i;m++){const v=e.data[m],w=n[m];gy(m),(null!==v.hostBindings||0!==v.hostVars||null!==v.hostAttrs)&&wn(v,w)}}finally{Ud(-1),gy(d)}}function wn(e,n){null!==e.hostBindings&&e.hostBindings(1,n)}function On(e,n,t){n.componentOffset=t,(e.components??=[]).push(n.index)}function kn(e,n,t){if(t){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)t[n.exportAs[r]]=e;Al(n)&&(t[""]=e)}}function Cn(e,n,t,r,i){e.data[r]=i;const s=i.factory||(i.factory=Ea(i.type)),d=new ap(s,Al(i),wt);e.blueprint[r]=d,t[r]=d,function jt(e,n,t,r,i){const s=i.hostBindings;if(s){let d=e.hostBindingOpCodes;null===d&&(d=e.hostBindingOpCodes=[]);const m=~n.index;(function tn(e){let n=e.length;for(;n>0;){const t=e[--n];if("number"==typeof t&&t<0)return t}return 0})(d)!=m&&d.push(m),d.push(t,r,s)}}(e,n,r,u(e,t,i.hostVars,fi),i)}function Dr(e,n,t,r,i,s){const d=Pt(e,n);!function Pi(e,n,t,r,i,s,d){if(null==s)e.removeAttribute(n,i,t);else{const m=null==d?Yn(s):d(s,r||"",i);e.setAttribute(n,i,m,t)}}(n[Pr],d,s,e.value,t,r,i)}function Wr(e,n,t,r,i,s){const d=s[n];if(null!==d)for(let m=0;m<d.length;)xr(r,t,d[m++],d[m++],d[m++])}function xr(e,n,t,r,i){const s=Fa(null);try{const d=e.inputTransforms;null!==d&&d.hasOwnProperty(r)&&(i=d[r].call(n,i)),null!==e.setInput?e.setInput(n,i,t,r):n[r]=i}finally{Fa(s)}}function ls(e,n,t){let r=null,i=0;for(;i<t.length;){const s=t[i];if(0!==s)if(5!==s){if("number"==typeof s)break;if(e.hasOwnProperty(s)){null===r&&(r=[]);const d=e[s];for(let m=0;m<d.length;m+=2)if(d[m]===n){r.push(s,d[m+1],t[i+1]);break}}i+=2}else i+=2;else i+=4}return r}function Zr(e,n,t,r){return[e,!0,!1,n,null,0,r,t,null,null,null]}function Xr(e,n){const t=e.contentQueries;if(null!==t)for(let r=0;r<t.length;r+=2){const s=t[r+1];if(-1!==s){const d=e.data[s];lg(t[r]),d.contentQueries(2,n[s],s)}}}function Do(e,n){return e[Wa]?e[_s][Ds]=n:e[Wa]=n,e[_s]=n,n}function Fo(e,n,t){lg(0);const r=Fa(null);try{n(e,t)}finally{Fa(r)}}function Bo(e){return e[$u]||(e[$u]=[])}function Ts(e){return e.cleanup||(e.cleanup=[])}function la(e,n){const t=e[va],r=t?t.get(Qd,null):null;r&&r.handleError(n)}function Ao(e,n,t,r,i){for(let s=0;s<t.length;){const d=t[s++],m=t[s++];xr(e.data[d],n[d],r,m,i)}}function Ia(e,n){const t=an(n,e),r=t[Bn];!function Gs(e,n){for(let t=n.length;t<e.blueprint.length;t++)n.push(e.blueprint[t])}(r,t);const i=t[is];null!==i&&null===t[Xl]&&(t[Xl]=E0(i,t[va])),ki(r,t,t[ai])}function ki(e,n,t){ih(n);try{const r=e.viewQuery;null!==r&&Fo(1,r,t);const i=e.template;null!==i&&f(e,n,i,1,t),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Xr(e,n),e.staticViewQueries&&Fo(2,e.viewQuery,t);const s=e.components;null!==s&&function Ma(e,n){for(let t=0;t<n.length;t++)Ia(e,n[t])}(n,s)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{n[Ar]&=-5,_y()}}let cl=(()=>{class e{constructor(){this.all=new Set,this.queue=new Map}create(t,r,i){const s=typeof Zone>"u"?null:Zone.current,d=new De(t,w=>{this.all.has(w)&&this.queue.set(w,s)},i);let m;this.all.add(d),d.notify();const v=()=>{d.cleanup(),m?.(),this.all.delete(d),this.queue.delete(d)};return m=r?.onDestroy(v),{destroy:v}}flush(){if(0!==this.queue.size)for(const[t,r]of this.queue)this.queue.delete(t),r?r.run(()=>t.run()):t.run()}get isQueueEmpty(){return 0===this.queue.size}}return e.\u0275prov=Gn({token:e,providedIn:"root",factory:()=>new e}),e})();function vl(e,n,t){let r=t?e.styles:null,i=t?e.classes:null,s=0;if(null!==n)for(let d=0;d<n.length;d++){const m=n[d];"number"==typeof m?s=m:1==s?i=Io(i,m):2==s&&(r=Io(r,m+": "+n[++d]+";"))}t?e.styles=r:e.stylesWithoutHost=r,t?e.classes=i:e.classesWithoutHost=i}function ua(e,n,t,r,i=!1){for(;null!==t;){const s=n[t.index];if(null!==s&&r.push(Qt(s)),ss(s)){for(let m=Ls;m<s.length;m++){const v=s[m],w=v[Bn].firstChild;null!==w&&ua(v[Bn],v,w,r)}s[_u]!==s[is]&&r.push(s[_u])}const d=t.type;if(8&d)ua(e,n,t.child,r);else if(32&d){const m=Hy(t,n);let v;for(;v=m();)r.push(v)}else if(16&d){const m=t0(n,t);if(Array.isArray(m))r.push(...m);else{const v=Tf(n[vn]);ua(v[Bn],v,m,r,!0)}}t=i?t.projectionNext:t.next}return r}function Qu(e,n,t,r=!0){const i=n[Nu].rendererFactory;i.begin&&i.begin();try{Up(e,n,e.template,t)}catch(d){throw r&&la(n,d),d}finally{i.end&&i.end(),n[Nu].effectManager?.flush()}}function Up(e,n,t,r){const i=n[Ar];if(256!=(256&i)){n[Nu].effectManager?.flush(),ih(n);try{Hn(n),function py(e){return qn.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==t&&f(e,n,t,2,r);const d=3==(3&i);if(d){const w=e.preOrderCheckHooks;null!==w&&Zu(n,w,null)}else{const w=e.preOrderHooks;null!==w&&op(n,w,0,null),ad(n,0)}if(function kx(e){for(let n=U1(e);null!==n;n=j1(n)){if(!n[dc])continue;const t=n[La];for(let r=0;r<t.length;r++){vr(t[r])}}}(n),L0(n,2),null!==e.contentQueries&&Xr(e,n),d){const w=e.contentCheckHooks;null!==w&&Zu(n,w)}else{const w=e.contentHooks;null!==w&&op(n,w,1),ad(n,1)}!function O0(e,n){const t=e.hostBindingOpCodes;if(null===t)return;const r=$c(n,nh);try{for(let i=0;i<t.length;i++){const s=t[i];if(s<0)Ud(~s);else{const d=s,m=t[++i],v=t[++i];v1(m,d),r.runInContext(v,2,n[d])}}}finally{null===n[nh]&&ef(n,nh),Ud(-1)}}(e,n);const m=e.components;null!==m&&g_(n,m,0);const v=e.viewQuery;if(null!==v&&Fo(2,v,r),d){const w=e.viewCheckHooks;null!==w&&Zu(n,w)}else{const w=e.viewHooks;null!==w&&op(n,w,2),ad(n,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),n[Ar]&=-73,ci(n)}finally{_y()}}}function L0(e,n){for(let t=U1(e);null!==t;t=j1(t))for(let r=Ls;r<t.length;r++)k0(t[r],n)}function Fx(e,n,t){k0(an(n,e),t)}function k0(e,n){if(!function xn(e){return 128==(128&e[Ar])}(e))return;const t=e[Bn];if(80&e[Ar]&&0===n||1024&e[Ar]||2===n)Up(t,e,t.template,e[ai]);else if(e[Ii]>0){L0(e,1);const i=e[Bn].components;null!==i&&g_(e,i,1)}}function g_(e,n,t){for(let r=0;r<n.length;r++)Fx(e,n[r],t)}class Uf{get rootNodes(){const n=this._lView,t=n[Bn];return ua(t,n,t.firstChild,[])}constructor(n,t){this._lView=n,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[ai]}set context(n){this._lView[ai]=n}get destroyed(){return 256==(256&this._lView[Ar])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[mi];if(ss(n)){const t=n[8],r=t?t.indexOf(this):-1;r>-1&&(Zy(n,r),_g(t,r))}this._attachedToViewContainer=!1}W1(this._lView[Bn],this._lView)}onDestroy(n){!function nr(e,n){if(256==(256&e[Ar]))throw new en(911,!1);null===e[Us]&&(e[Us]=[]),e[Us].push(n)}(this._lView,n)}markForCheck(){Gc(this._cdRefInjectingView||this._lView)}detach(){this._lView[Ar]&=-129}reattach(){this._lView[Ar]|=128}detectChanges(){Qu(this._lView[Bn],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new en(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function kE(e,n){Oh(e,n,n[Pr],2,null,null)}(this._lView[Bn],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new en(902,!1);this._appRef=n}}class zh extends Uf{constructor(n){super(n),this._view=n}detectChanges(){const n=this._view;Qu(n[Bn],n,n[ai],!1)}checkNoChanges(){}get context(){return null}}class F0 extends c_{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const t=gi(n);return new Hc(t,this.ngModule)}}function tf(e){const n=[];for(let t in e)e.hasOwnProperty(t)&&n.push({propName:e[t],templateName:t});return n}class z0{constructor(n,t){this.injector=n,this.parentInjector=t}get(n,t,r){r=Uu(r);const i=this.injector.get(n,jc,r);return i!==jc||t===jc?i:this.parentInjector.get(n,t,r)}}class Hc extends u_{get inputs(){const n=this.componentDef,t=n.inputTransforms,r=tf(n.inputs);if(null!==t)for(const i of r)t.hasOwnProperty(i.propName)&&(i.transform=t[i.propName]);return r}get outputs(){return tf(this.componentDef.outputs)}constructor(n,t){super(),this.componentDef=n,this.ngModule=t,this.componentType=n.type,this.selector=function sa(e){return e.map(gl).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!t}create(n,t,r,i){let s=(i=i||this.ngModule)instanceof hh?i:i?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const d=s?new z0(n,s):n,m=d.get(C0,null);if(null===m)throw new en(407,!1);const D={rendererFactory:m,sanitizer:d.get(yC,null),effectManager:d.get(cl,null)},N=m.createRenderer(null,this.componentDef),O=this.componentDef.selectors[0][0]||"div",k=r?function z(e,n,t,r){const s=r.get(h_,!1)||t===oa.ShadowDom,d=e.selectRootElement(n,s);return function U(e){G(e)}(d),d}(N,r,this.componentDef.encapsulation,d):Sg(N,O,function B0(e){const n=e.toLowerCase();return"svg"===n?"svg":"math"===n?"math":null}(O)),_e=this.componentDef.signals?4608:this.componentDef.onPush?576:528,le=P(0,null,null,1,0,null,null,null,null,null,null),K=jg(null,le,null,_e,null,null,D,N,d,null,null);let me,$e;ih(K);try{const Ze=this.componentDef;let gt,_t=null;Ze.findHostDirectiveDefs?(gt=[],_t=new Map,Ze.findHostDirectiveDefs(Ze,gt,_t),gt.push(Ze)):gt=[Ze];const St=function ec(e,n){const t=e[Bn],r=Di;return e[r]=n,a(t,r,2,"#host",null)}(K,k),Ye=function tc(e,n,t,r,i,s,d){const m=i[Bn];!function Hg(e,n,t,r){for(const i of e)n.mergedAttrs=eh(n.mergedAttrs,i.hostAttrs);null!==n.mergedAttrs&&(vl(n,n.mergedAttrs,!0),null!==t&&J1(r,t,n))}(r,e,n,d);let v=null;null!==n&&(v=E0(n,i[va]));const w=s.rendererFactory.createRenderer(n,t);let D=16;t.signals?D=4096:t.onPush&&(D=64);const N=jg(i,M(t),null,D,i[e.index],e,s,w,null,null,v);return m.firstCreatePass&&On(m,e,r.length-1),Do(i,N),i[e.index]=N}(St,k,Ze,gt,K,D,N);$e=Ft(le,Di),k&&function Bx(e,n,t,r){if(r)qa(e,t,["ng-version",Uc.full]);else{const{attrs:i,classes:s}=function Zl(e){const n=[],t=[];let r=1,i=2;for(;r<e.length;){let s=e[r];if("string"==typeof s)2===i?""!==s&&n.push(s,e[++r]):8===i&&t.push(s);else{if(!vo(i))break;i=s}r++}return{attrs:n,classes:t}}(n.selectors[0]);i&&qa(e,t,i),s&&s.length>0&&K1(e,t,s.join(" "))}}(N,Ze,k,r),void 0!==t&&function jf(e,n,t){const r=e.projection=[];for(let i=0;i<n.length;i++){const s=t[i];r.push(null!=s?Array.from(s):null)}}($e,this.ngContentSelectors,t),me=function U0(e,n,t,r,i,s){const d=ks(),m=i[Bn],v=Pt(d,i);_n(m,i,d,t,null,r);for(let D=0;D<t.length;D++)yl(Hd(i,m,d.directiveStart+D,d),i);dn(m,i,d),v&&yl(v,i);const w=Hd(i,m,d.directiveStart+d.componentOffset,d);if(e[ai]=i[ai]=w,null!==s)for(const D of s)D(w,n);return _(m,d,e),w}(Ye,Ze,gt,_t,K,[XB]),ki(le,K,null)}finally{_y()}return new V0(this.componentType,me,Jd($e,K),K,$e)}}class V0 extends gC{constructor(n,t,r,i,s){super(),this.location=r,this._rootLView=i,this._tNode=s,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new zh(i),this.componentType=n}setInput(n,t){const r=this._tNode.inputs;let i;if(null!==r&&(i=r[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),t))return;const s=this._rootLView;Ao(s[Bn],s,i,n,t),this.previousInputValues.set(n,t),Gc(an(this._tNode.index,s))}}get injector(){return new qd(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function XB(){const e=ks();cg(cn()[Bn],e)}function Is(e){let n=function QI(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),t=!0;const r=[e];for(;n;){let i;if(Al(e))i=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new en(903,!1);i=n.\u0275dir}if(i){if(t){r.push(i);const d=e;d.inputs=zx(e.inputs),d.inputTransforms=zx(e.inputTransforms),d.declaredInputs=zx(e.declaredInputs),d.outputs=zx(e.outputs);const m=i.hostBindings;m&&QB(e,m);const v=i.viewQuery,w=i.contentQueries;if(v&&KB(e,v),w&&JB(e,w),qs(e.inputs,i.inputs),qs(e.declaredInputs,i.declaredInputs),qs(e.outputs,i.outputs),null!==i.inputTransforms&&(null===d.inputTransforms&&(d.inputTransforms={}),qs(d.inputTransforms,i.inputTransforms)),Al(i)&&i.data.animation){const D=e.data;D.animation=(D.animation||[]).concat(i.data.animation)}}const s=i.features;if(s)for(let d=0;d<s.length;d++){const m=s[d];m&&m.ngInherit&&m(e),m===Is&&(t=!1)}}n=Object.getPrototypeOf(n)}!function YB(e){let n=0,t=null;for(let r=e.length-1;r>=0;r--){const i=e[r];i.hostVars=n+=i.hostVars,i.hostAttrs=eh(i.hostAttrs,t=eh(t,i.hostAttrs))}}(r)}function zx(e){return e===Wo?{}:e===oi?[]:e}function KB(e,n){const t=e.viewQuery;e.viewQuery=t?(r,i)=>{n(r,i),t(r,i)}:n}function JB(e,n){const t=e.contentQueries;e.contentQueries=t?(r,i,s)=>{n(r,i,s),t(r,i,s)}:n}function QB(e,n){const t=e.hostBindings;e.hostBindings=t?(r,i)=>{n(r,i),t(r,i)}:n}function rM(e){const n=e.inputConfig,t={};for(const r in n)if(n.hasOwnProperty(r)){const i=n[r];Array.isArray(i)&&i[2]&&(t[r]=i[2])}e.inputTransforms=t}function nc(e,n,t){return!Object.is(e[n],t)&&(e[n]=t,!0)}function Ms(e,n,t,r){const i=cn();return nc(i,zd(),n)&&(Li(),Dr(aa(),i,e,n,t,r)),Ms}let mM=function _M(e,n,t,r){return Xa(!0),n[Pr].createComment("")};function dr(e,n,t){const r=cn();return nc(r,zd(),n)&&function nt(e,n,t,r,i,s,d,m){const v=Pt(n,t);let D,w=n.inputs;!m&&null!=w&&(D=w[r])?(Ao(e,t,D,r,i),sl(n)&&function ot(e,n){const t=an(n,e);16&t[Ar]||(t[Ar]|=64)}(t,n.index)):3&n.type&&(r=function Je(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),i=null!=d?d(i,n.value||"",r):i,s.setProperty(v,r,i))}(Li(),aa(),r,e,n,r[Pr],t,!1),dr}function MC(e,n,t,r,i){const d=i?"class":"style";Ao(e,t,n.inputs[d],d,r)}function Un(e,n,t,r){const i=cn(),s=Li(),d=Di+e,m=i[Pr],v=s.firstCreatePass?function T3(e,n,t,r,i,s){const d=n.consts,v=a(n,e,2,r,br(d,i));return Xt(n,t,v,br(d,s)),null!==v.attrs&&vl(v,v.attrs,!1),null!==v.mergedAttrs&&vl(v,v.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,v),v}(d,s,i,n,t,r):s.data[d],w=yM(s,i,v,m,n,e);i[d]=w;const D=ba(v);return Ru(v,!0),J1(m,w,v),32!=(32&v.flags)&&bf()&&Wm(s,i,w,v),0===function Nl(){return qn.lFrame.elementDepthCount}()&&yl(w,i),function al(){qn.lFrame.elementDepthCount++}(),D&&(E(s,i,v),_(s,v,i)),null!==r&&S(i,v),Un}function Jn(){let e=ks();nd()?vf():(e=e.parent,Ru(e,!1));const n=e;(function $o(e){return qn.skipHydrationRootTNode===e})(n)&&function ys(){qn.skipHydrationRootTNode=null}(),function Wu(){qn.lFrame.elementDepthCount--}();const t=Li();return t.firstCreatePass&&(cg(t,e),yu(e)&&t.queries.elementEnd(e)),null!=n.classesWithoutHost&&function dg(e){return 0!=(8&e.flags)}(n)&&MC(t,n,cn(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function lp(e){return 0!=(16&e.flags)}(n)&&MC(t,n,cn(),n.stylesWithoutHost,!1),Jn}function za(e,n,t,r){return Un(e,n,t,r),Jn(),za}let yM=(e,n,t,r,i,s)=>(Xa(!0),Sg(r,i,function pr(){return qn.lFrame.currentNamespace}()));function W0(e){return!!e&&"function"==typeof e.then}function bM(e){return!!e&&"function"==typeof e.subscribe}function $i(e,n,t,r){const i=cn(),s=Li(),d=ks();return function EM(e,n,t,r,i,s,d){const m=ba(r),w=e.firstCreatePass&&Ts(e),D=n[ai],N=Bo(n);let O=!0;if(3&r.type||d){const X=Pt(r,n),_e=d?d(X):X,le=N.length,K=d?$e=>d(Qt($e[r.index])):r.index;let me=null;if(!d&&m&&(me=function R3(e,n,t,r){const i=e.cleanup;if(null!=i)for(let s=0;s<i.length-1;s+=2){const d=i[s];if(d===t&&i[s+1]===r){const m=n[$u],v=i[s+2];return m.length>v?m[v]:null}"string"==typeof d&&(s+=2)}return null}(e,n,i,r.index)),null!==me)(me.__ngLastListenerFn__||me).__ngNextListenerFn__=s,me.__ngLastListenerFn__=s,O=!1;else{s=SM(r,n,D,s,!1);const $e=t.listen(_e,i,s);N.push(s,$e),w&&w.push(i,K,le,le+1)}}else s=SM(r,n,D,s,!1);const k=r.outputs;let Q;if(O&&null!==k&&(Q=k[i])){const X=Q.length;if(X)for(let _e=0;_e<X;_e+=2){const Ze=n[Q[_e]][Q[_e+1]].subscribe(s),gt=N.length;N.push(s,Ze),w&&w.push(i,r.index,gt,-(gt+1))}}}(s,i,i[Pr],d,e,n,r),$i}function CM(e,n,t,r){try{return yt(6,n,t),!1!==t(r)}catch(i){return la(e,i),!1}finally{yt(7,n,t)}}function SM(e,n,t,r,i){return function s(d){if(d===Function)return r;Gc(e.componentOffset>-1?an(e.index,n):n);let v=CM(n,t,r,d),w=s.__ngNextListenerFn__;for(;w;)v=CM(n,t,w,d)&&v,w=w.__ngNextListenerFn__;return i&&!1===v&&d.preventDefault(),v}}function hi(e=1){return function aE(e){return(qn.lFrame.contextLView=function lE(e,n){for(;e>0;)n=n[os],e--;return n}(e,qn.lFrame.contextLView))[ai]}(e)}function O3(e,n){let t=null;const r=function pu(e){const n=e.attrs;if(null!=n){const t=n.indexOf(5);if(!(1&t))return n[t+1]}return null}(e);for(let i=0;i<n.length;i++){const s=n[i];if("*"!==s){if(null===r?Qs(e,s,!0):Gu(r,s))return i}else t=i}return t}function qx(e,n){return e<<17|n<<2}function jp(e){return e>>17&32767}function RC(e){return 2|e}function Wg(e){return(131068&e)>>2}function OC(e,n){return-131069&e|n<<2}function LC(e){return 1|e}function kM(e,n,t,r,i){const s=e[t+1],d=null===n;let m=r?jp(s):Wg(s),v=!1;for(;0!==m&&(!1===v||d);){const D=e[m+1];V3(e[m],n)&&(v=!0,e[m+1]=r?LC(D):RC(D)),m=r?jp(D):Wg(D)}v&&(e[t+1]=r?RC(s):LC(s))}function V3(e,n){return null===e||null==n||(Array.isArray(e)?e[1]:e)===n||!(!Array.isArray(e)||"string"!=typeof n)&&Gi(e,n)>=0}const iu={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function FM(e){return e.substring(iu.key,iu.keyEnd)}function BM(e,n){const t=iu.textEnd;return t===n?-1:(n=iu.keyEnd=function $3(e,n,t){for(;n<t&&e.charCodeAt(n)>32;)n++;return n}(e,iu.key=n,t),S_(e,n,t))}function S_(e,n,t){for(;n<t&&e.charCodeAt(n)<=32;)n++;return n}function kC(e,n,t){return vd(e,n,t,!1),kC}function hs(e,n){return vd(e,n,null,!0),hs}function Zg(e){!function xd(e,n,t,r){const i=Li(),s=Rc(2);i.firstUpdatePass&&$M(i,null,s,r);const d=cn();if(t!==fi&&nc(d,s,t)){const m=i.data[Ou()];if(ZM(m,r)&&!GM(i,s)){let v=r?m.classesWithoutHost:m.stylesWithoutHost;null!==v&&(t=Io(v,t||"")),MC(i,m,d,t,r)}else!function ez(e,n,t,r,i,s,d,m){i===fi&&(i=oi);let v=0,w=0,D=0<i.length?i[0]:null,N=0<s.length?s[0]:null;for(;null!==D||null!==N;){const O=v<i.length?i[v+1]:void 0,k=w<s.length?s[w+1]:void 0;let X,Q=null;D===N?(v+=2,w+=2,O!==k&&(Q=N,X=k)):null===N||null!==D&&D<N?(v+=2,Q=D):(w+=2,Q=N,X=k),null!==Q&&qM(e,n,t,r,Q,X,d,m),D=v<i.length?i[v]:null,N=w<s.length?s[w]:null}}(i,m,d,d[Pr],d[s+1],d[s+1]=function J3(e,n,t){if(null==t||""===t)return oi;const r=[],i=Bc(t);if(Array.isArray(i))for(let s=0;s<i.length;s++)e(r,i[s],!0);else if("object"==typeof i)for(const s in i)i.hasOwnProperty(s)&&e(r,s,i[s]);else"string"==typeof i&&n(r,i);return r}(e,n,t),r,s)}}(Q3,af,e,!0)}function af(e,n){for(let t=function j3(e){return function VM(e){iu.key=0,iu.keyEnd=0,iu.value=0,iu.valueEnd=0,iu.textEnd=e.length}(e),BM(e,S_(e,0,iu.textEnd))}(n);t>=0;t=BM(n,t))Ku(e,FM(n),!0)}function vd(e,n,t,r){const i=cn(),s=Li(),d=Rc(2);s.firstUpdatePass&&$M(s,e,d,r),n!==fi&&nc(i,d,n)&&qM(s,s.data[Ou()],i,i[Pr],e,i[d+1]=function tz(e,n){return null==e||""===e||("string"==typeof n?e+=n:"object"==typeof e&&(e=xi(Bc(e)))),e}(n,t),r,d)}function GM(e,n){return n>=e.expandoStartIndex}function $M(e,n,t,r){const i=e.data;if(null===i[t+1]){const s=i[Ou()],d=GM(e,t);ZM(s,r)&&null===n&&!d&&(n=!1),n=function Z3(e,n,t,r){const i=function my(e){const n=qn.lFrame.currentDirectiveIndex;return-1===n?null:e[n]}(e);let s=r?n.residualClasses:n.residualStyles;if(null===i)0===(r?n.classBindings:n.styleBindings)&&(t=Z0(t=FC(null,e,n,t,r),n.attrs,r),s=null);else{const d=n.directiveStylingLast;if(-1===d||e[d]!==i)if(t=FC(i,e,n,t,r),null===s){let v=function X3(e,n,t){const r=t?n.classBindings:n.styleBindings;if(0!==Wg(r))return e[jp(r)]}(e,n,r);void 0!==v&&Array.isArray(v)&&(v=FC(null,e,n,v[1],r),v=Z0(v,n.attrs,r),function Y3(e,n,t,r){e[jp(t?n.classBindings:n.styleBindings)]=r}(e,n,r,v))}else s=function K3(e,n,t){let r;const i=n.directiveEnd;for(let s=1+n.directiveStylingLast;s<i;s++)r=Z0(r,e[s].hostAttrs,t);return Z0(r,n.attrs,t)}(e,n,r)}return void 0!==s&&(r?n.residualClasses=s:n.residualStyles=s),t}(i,s,n,r),function B3(e,n,t,r,i,s){let d=s?n.classBindings:n.styleBindings,m=jp(d),v=Wg(d);e[r]=t;let D,w=!1;if(Array.isArray(t)?(D=t[1],(null===D||Gi(t,D)>0)&&(w=!0)):D=t,i)if(0!==v){const O=jp(e[m+1]);e[r+1]=qx(O,m),0!==O&&(e[O+1]=OC(e[O+1],r)),e[m+1]=function k3(e,n){return 131071&e|n<<17}(e[m+1],r)}else e[r+1]=qx(m,0),0!==m&&(e[m+1]=OC(e[m+1],r)),m=r;else e[r+1]=qx(v,0),0===m?m=r:e[v+1]=OC(e[v+1],r),v=r;w&&(e[r+1]=RC(e[r+1])),kM(e,D,r,!0),kM(e,D,r,!1),function z3(e,n,t,r,i){const s=i?e.residualClasses:e.residualStyles;null!=s&&"string"==typeof n&&Gi(s,n)>=0&&(t[r+1]=LC(t[r+1]))}(n,D,e,r,s),d=qx(m,v),s?n.classBindings=d:n.styleBindings=d}(i,s,n,t,d,r)}}function FC(e,n,t,r,i){let s=null;const d=t.directiveEnd;let m=t.directiveStylingLast;for(-1===m?m=t.directiveStart:m++;m<d&&(s=n[m],r=Z0(r,s.hostAttrs,i),s!==e);)m++;return null!==e&&(t.directiveStylingLast=m),r}function Z0(e,n,t){const r=t?1:2;let i=-1;if(null!==n)for(let s=0;s<n.length;s++){const d=n[s];"number"==typeof d?i=d:i===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),Ku(e,d,!!t||n[++s]))}return void 0===e?null:e}function Q3(e,n,t){const r=String(n);""!==r&&!r.includes(" ")&&Ku(e,r,t)}function qM(e,n,t,r,i,s,d,m){if(!(3&n.type))return;const v=e.data,w=v[m+1],D=function F3(e){return 1==(1&e)}(w)?WM(v,n,t,i,Wg(w),d):void 0;Wx(D)||(Wx(s)||function L3(e){return 2==(2&e)}(w)&&(s=WM(v,null,t,i,m,d)),function zE(e,n,t,r,i){if(n)i?e.addClass(t,r):e.removeClass(t,r);else{let s=-1===r.indexOf("-")?void 0:kc.DashCase;null==i?e.removeStyle(t,r,s):("string"==typeof i&&i.endsWith("!important")&&(i=i.slice(0,-10),s|=kc.Important),e.setStyle(t,r,i,s))}}(r,d,Jt(Ou(),t),i,s))}function WM(e,n,t,r,i,s){const d=null===n;let m;for(;i>0;){const v=e[i],w=Array.isArray(v),D=w?v[1]:v,N=null===D;let O=t[i+1];O===fi&&(O=N?oi:void 0);let k=N?Ah(O,r):D===r?O:void 0;if(w&&!Wx(k)&&(k=Ah(v,r)),Wx(k)&&(m=k,d))return m;const Q=e[i+1];i=d?jp(Q):Wg(Q)}if(null!==n){let v=s?n.residualClasses:n.residualStyles;null!=v&&(m=Ah(v,r))}return m}function Wx(e){return void 0!==e}function ZM(e,n){return 0!=(e.flags&(n?8:16))}function ui(e,n=""){const t=cn(),r=Li(),i=e+Di,s=r.firstCreatePass?a(r,i,1,n,null):r.data[i],d=XM(r,t,s,n,e);t[i]=d,bf()&&Wm(r,t,d,s),Ru(s,!1)}let XM=(e,n,t,r,i)=>(Xa(!0),function jm(e,n){return e.createText(n)}(n[Pr],r));function bd(e){return D_("",e,""),bd}function D_(e,n,t){const r=cn(),i=function __(e,n,t,r){return nc(e,zd(),t)?n+Yn(t)+r:fi}(r,e,n,t);return i!==fi&&function cs(e,n,t){const r=Jt(n,e);!function Cg(e,n,t){e.setValue(n,t)}(e[Pr],r,t)}(r,Ou(),i),D_}const I_="en-US";let mA=I_;function VC(e,n,t,r,i){if(e=Rr(e),Array.isArray(e))for(let s=0;s<e.length;s++)VC(e[s],n,t,r,i);else{const s=Li(),d=cn();let m=Vc(e)?e:Rr(e.provide),v=Rf(e);const w=ks(),D=1048575&w.providerIndexes,N=w.directiveStart,O=w.providerIndexes>>20;if(Vc(e)||!e.multi){const k=new ap(v,i,wt),Q=jC(m,n,i?D:D+O,N);-1===Q?(ud(Cm(w,d),s,m),UC(s,e,n.length),n.push(m),w.directiveStart++,w.directiveEnd++,i&&(w.providerIndexes+=1048576),t.push(k),d.push(k)):(t[Q]=k,d[Q]=k)}else{const k=jC(m,n,D+O,N),Q=jC(m,n,D,D+O),_e=Q>=0&&t[Q];if(i&&!_e||!i&&!(k>=0&&t[k])){ud(Cm(w,d),s,m);const le=function x4(e,n,t,r,i){const s=new ap(e,t,wt);return s.multi=[],s.index=n,s.componentProviders=0,UA(s,i,r&&!t),s}(i?v4:y4,t.length,i,r,v);!i&&_e&&(t[Q].providerFactory=le),UC(s,e,n.length,0),n.push(m),w.directiveStart++,w.directiveEnd++,i&&(w.providerIndexes+=1048576),t.push(le),d.push(le)}else UC(s,e,k>-1?k:Q,UA(t[i?Q:k],v,!i&&r));!i&&r&&_e&&t[Q].componentProviders++}}}function UC(e,n,t,r){const i=Vc(n),s=function Ap(e){return!!e.useClass}(n);if(i||s){const v=(s?Rr(n.useClass):n).prototype.ngOnDestroy;if(v){const w=e.destroyHooks||(e.destroyHooks=[]);if(!i&&n.multi){const D=w.indexOf(t);-1===D?w.push(t,[r,v]):w[D+1].push(r,v)}else w.push(t,v)}}}function UA(e,n,t){return t&&e.componentProviders++,e.multi.push(n)-1}function jC(e,n,t,r){for(let i=t;i<r;i++)if(n[i]===e)return i;return-1}function y4(e,n,t,r){return GC(this.multi,[])}function v4(e,n,t,r){const i=this.multi;let s;if(this.providerFactory){const d=this.providerFactory.componentProviders,m=Hd(t,t[Bn],this.providerFactory.index,r);s=m.slice(0,d),GC(i,s);for(let v=d;v<m.length;v++)s.push(m[v])}else s=[],GC(i,s);return s}function GC(e,n){for(let t=0;t<e.length;t++)n.push((0,e[t])());return n}function ta(e,n=[]){return t=>{t.providersResolver=(r,i)=>function _4(e,n,t){const r=Li();if(r.firstCreatePass){const i=Al(e);VC(t,r.data,r.blueprint,i,!0),VC(n,r.data,r.blueprint,i,!1)}}(r,i?i(e):e,n)}}class M_{}class jA{}class $C extends M_{constructor(n,t,r){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new F0(this);const i=Si(n);this._bootstrapComponents=bu(i.bootstrap),this._r3Injector=p_(n,t,[{provide:M_,useValue:this},{provide:c_,useValue:this.componentFactoryResolver},...r],xi(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class HC extends jA{constructor(n){super(),this.moduleType=n}create(n){return new $C(this.moduleType,n,[])}}class GA extends M_{constructor(n){super(),this.componentFactoryResolver=new F0(this),this.instance=null;const t=new _0([...n.providers,{provide:M_,useValue:this},{provide:c_,useValue:this.componentFactoryResolver}],n.parent||Pf(),n.debugName,new Set(["environment"]));this.injector=t,n.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function qC(e,n,t=null){return new GA({providers:e,parent:n,debugName:t,runEnvironmentInitializers:!0}).injector}let E4=(()=>{class e{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const r=fx(0,t.type),i=r.length>0?qC([r],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,i)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}}return e.\u0275prov=Gn({token:e,providedIn:"environment",factory:()=>new e(jn(hh))}),e})();function jh(e){e.getStandaloneInjector=n=>n.get(E4).getOrCreateStandaloneInjector(e)}function ZC(e,n,t){const r=function Ql(){const e=qn.lFrame;let n=e.bindingRootIndex;return-1===n&&(n=e.bindingRootIndex=e.tView.bindingStartIndex),n}()+e,i=cn();return i[r]===fi?function nf(e,n,t){return e[n]=t}(i,r,t?n.call(t):n()):function G0(e,n){return e[n]}(i,r)}function YC(e){return n=>{setTimeout(e,void 0,n)}}const zr=class H4 extends It{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,t,r){let i=n,s=t||(()=>null),d=r;if(n&&"object"==typeof n){const v=n;i=v.next?.bind(v),s=v.error?.bind(v),d=v.complete?.bind(v)}this.__isAsync&&(s=YC(s),i&&(i=YC(i)),d&&(d=YC(d)));const m=super.subscribe({next:i,error:s,complete:d});return n instanceof be&&n.add(m),m}};function q4(){return this._results[Symbol.iterator]()}class KC{get changes(){return this._changes||(this._changes=new zr)}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=KC.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=q4)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,t){return this._results.reduce(n,t)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,t){const r=this;r.dirty=!1;const i=function Yu(e){return e.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function mg(e,n,t){if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++){let i=e[r],s=n[r];if(t&&(i=t(i),s=t(s)),s!==i)return!1}return!0}(r._results,i,t))&&(r._results=i,r.length=i.length,r.last=i[this.length-1],r.first=i[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Ya=(()=>{class e{}return e.__NG_ELEMENT_ID__=X4,e})();const W4=Ya,Z4=class extends W4{constructor(n,t,r){super(),this._declarationLView=n,this._declarationTContainer=t,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,t){return this.createEmbeddedViewImpl(n,t,null)}createEmbeddedViewImpl(n,t,r){const d=this._declarationTContainer.tView,m=jg(this._declarationLView,d,n,4096&this._declarationLView[Ar]?4096:16,null,d.declTNode,null,null,null,t||null,r||null);m[Mo]=this._declarationLView[this._declarationTContainer.index];const w=this._declarationLView[Za];return null!==w&&(m[Za]=w.createEmbeddedView(d)),ki(d,m,n),new Uf(m)}};function X4(){return Jx(ks(),cn())}function Jx(e,n){return 4&e.type?new Z4(n,e,Jd(e,n)):null}let Gh=(()=>{class e{}return e.__NG_ELEMENT_ID__=n5,e})();function n5(){return sN(ks(),cn())}const r5=Gh,iN=class extends r5{constructor(n,t,r){super(),this._lContainer=n,this._hostTNode=t,this._hostLView=r}get element(){return Jd(this._hostTNode,this._hostLView)}get injector(){return new qd(this._hostTNode,this._hostLView)}get parentInjector(){const n=Sm(this._hostTNode,this._hostLView);if(vy(n)){const t=vu(n,this._hostLView),r=$d(n);return new qd(t[Bn].data[r+8],t)}return new qd(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const t=oN(this._lContainer);return null!==t&&t[n]||null}get length(){return this._lContainer.length-Ls}createEmbeddedView(n,t,r){let i,s;"number"==typeof r?i=r:null!=r&&(i=r.index,s=r.injector);const m=n.createEmbeddedViewImpl(t||{},s,null);return this.insertImpl(m,i,false),m}createComponent(n,t,r,i,s){const d=n&&!function fp(e){return"function"==typeof e}(n);let m;if(d)m=t;else{const X=t||{};m=X.index,r=X.injector,i=X.projectableNodes,s=X.environmentInjector||X.ngModuleRef}const v=d?n:new Hc(gi(n)),w=r||this.parentInjector;if(!s&&null==v.ngModule){const _e=(d?w:this.parentInjector).get(hh,null);_e&&(s=_e)}gi(v.componentType??{});const k=v.create(w,i,null,s);return this.insertImpl(k.hostView,m,false),k}insert(n,t){return this.insertImpl(n,t,!1)}insertImpl(n,t,r){const i=n._lView,s=i[Bn];if(function cr(e){return ss(e[mi])}(i)){const v=this.indexOf(n);if(-1!==v)this.detach(v);else{const w=i[mi],D=new iN(w,w[Oa],w[mi]);D.detach(D.indexOf(n))}}const d=this._adjustIndex(t),m=this._lContainer;if(function $1(e,n,t,r){const i=Ls+r,s=t.length;r>0&&(t[i-1][Ds]=n),r<s-Ls?(n[Ds]=t[i],Cf(t,Ls+r,n)):(t.push(n),n[Ds]=null),n[mi]=t;const d=n[Mo];null!==d&&t!==d&&function H1(e,n){const t=e[La];n[vn]!==n[mi][mi][vn]&&(e[dc]=!0),null===t?e[La]=[n]:t.push(n)}(d,n);const m=n[Za];null!==m&&m.insertView(e),n[Ar]|=128}(s,i,m,d),!r){const v=Ep(d,m),w=i[Pr],D=Hm(w,m[_u]);null!==D&&function LE(e,n,t,r,i,s){r[is]=i,r[Oa]=n,Oh(e,r,t,1,i,s)}(s,m[Oa],w,i,D,v)}return n.attachToViewContainerRef(),Cf(QC(m),d,n),n}move(n,t){return this.insert(n,t)}indexOf(n){const t=oN(this._lContainer);return null!==t?t.indexOf(n):-1}remove(n){const t=this._adjustIndex(n,-1),r=Zy(this._lContainer,t);r&&(_g(QC(this._lContainer),t),W1(r[Bn],r))}detach(n){const t=this._adjustIndex(n,-1),r=Zy(this._lContainer,t);return r&&null!=_g(QC(this._lContainer),t)?new Uf(r):null}_adjustIndex(n,t=0){return n??this.length+t}};function oN(e){return e[8]}function QC(e){return e[8]||(e[8]=[])}function sN(e,n){let t;const r=n[e.index];return ss(r)?t=r:(t=Zr(r,n,null,e),n[e.index]=t,Do(n,t)),aN(t,n,e,r),new iN(t,e,n)}let aN=function lN(e,n,t,r){if(e[_u])return;let i;i=8&t.type?Qt(r):function i5(e,n){const t=e[Pr],r=t.createComment(""),i=Pt(n,e);return ch(t,Hm(t,i),r,function X1(e,n){return e.nextSibling(n)}(t,i),!1),r}(n,t),e[_u]=i};class eS{constructor(n){this.queryList=n,this.matches=null}clone(){return new eS(this.queryList)}setDirty(){this.queryList.setDirty()}}class tS{constructor(n=[]){this.queries=n}createEmbeddedView(n){const t=n.queries;if(null!==t){const r=null!==n.contentQueries?n.contentQueries[0]:t.length,i=[];for(let s=0;s<r;s++){const d=t.getByIndex(s);i.push(this.queries[d.indexInDeclarationView].clone())}return new tS(i)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let t=0;t<this.queries.length;t++)null!==fN(n,t).matches&&this.queries[t].setDirty()}}class uN{constructor(n,t,r=null){this.predicate=n,this.flags=t,this.read=r}}class nS{constructor(n=[]){this.queries=n}elementStart(n,t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(n,t)}elementEnd(n){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(n)}embeddedTView(n){let t=null;for(let r=0;r<this.length;r++){const i=null!==t?t.length:0,s=this.getByIndex(r).embeddedTView(n,i);s&&(s.indexInDeclarationView=r,null!==t?t.push(s):t=[s])}return null!==t?new nS(t):null}template(n,t){for(let r=0;r<this.queries.length;r++)this.queries[r].template(n,t)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class rS{constructor(n,t=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(n,t){this.isApplyingToNode(t)&&this.matchTNode(n,t)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,t){this.elementStart(n,t)}embeddedTView(n,t){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,t),new rS(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let r=n.parent;for(;null!==r&&8&r.type&&r.index!==t;)r=r.parent;return t===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(n,t){const r=this.metadata.predicate;if(Array.isArray(r))for(let i=0;i<r.length;i++){const s=r[i];this.matchTNodeWithReadOption(n,t,a5(t,s)),this.matchTNodeWithReadOption(n,t,pg(t,n,s,!1,!1))}else r===Ya?4&t.type&&this.matchTNodeWithReadOption(n,t,-1):this.matchTNodeWithReadOption(n,t,pg(t,n,r,!1,!1))}matchTNodeWithReadOption(n,t,r){if(null!==r){const i=this.metadata.read;if(null!==i)if(i===Yo||i===Gh||i===Ya&&4&t.type)this.addMatch(t.index,-2);else{const s=pg(t,n,i,!1,!1);null!==s&&this.addMatch(t.index,s)}else this.addMatch(t.index,r)}}addMatch(n,t){null===this.matches?this.matches=[n,t]:this.matches.push(n,t)}}function a5(e,n){const t=e.localNames;if(null!==t)for(let r=0;r<t.length;r+=2)if(t[r]===n)return t[r+1];return null}function u5(e,n,t,r){return-1===t?function l5(e,n){return 11&e.type?Jd(e,n):4&e.type?Jx(e,n):null}(n,e):-2===t?function c5(e,n,t){return t===Yo?Jd(n,e):t===Ya?Jx(n,e):t===Gh?sN(n,e):void 0}(e,n,r):Hd(e,e[Bn],t,n)}function cN(e,n,t,r){const i=n[Za].queries[r];if(null===i.matches){const s=e.data,d=t.matches,m=[];for(let v=0;v<d.length;v+=2){const w=d[v];m.push(w<0?null:u5(n,s[w],d[v+1],t.metadata.read))}i.matches=m}return i.matches}function iS(e,n,t,r){const i=e.queries.getByIndex(t),s=i.matches;if(null!==s){const d=cN(e,n,i,t);for(let m=0;m<s.length;m+=2){const v=s[m];if(v>0)r.push(d[m/2]);else{const w=s[m+1],D=n[-v];for(let N=Ls;N<D.length;N++){const O=D[N];O[Mo]===O[mi]&&iS(O[Bn],O,w,r)}if(null!==D[La]){const N=D[La];for(let O=0;O<N.length;O++){const k=N[O];iS(k[Bn],k,w,r)}}}}}return r}function As(e){const n=cn(),t=Li(),r=b1();lg(r+1);const i=fN(t,r);if(e.dirty&&function ln(e){return 4==(4&e[Ar])}(n)===(2==(2&i.metadata.flags))){if(null===i.matches)e.reset([]);else{const s=i.crossesNgTemplate?iS(t,n,r,[]):cN(t,n,i,r);e.reset(s,Vg),e.notifyOnChanges()}return!0}return!1}function Gp(e,n,t){const r=Li();r.firstCreatePass&&(dN(r,new uN(e,n,t),-1),2==(2&n)&&(r.staticViewQueries=!0)),hN(r,cn(),n)}function Ns(){return function h5(e,n){return e[Za].queries[n].queryList}(cn(),b1())}function hN(e,n,t){const r=new KC(4==(4&t));(function re(e,n,t,r){const i=Bo(n);i.push(t),e.firstCreatePass&&Ts(e).push(r,i.length-1)})(e,n,r,r.destroy),null===n[Za]&&(n[Za]=new tS),n[Za].queries.push(new eS(r))}function dN(e,n,t){null===e.queries&&(e.queries=new nS),e.queries.track(new rS(n,t))}function fN(e,n){return e.queries.getByIndex(n)}const cS=new wr("Application Initializer");let hS=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,r)=>{this.resolve=t,this.reject=r}),this.appInits=Vn(cS,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const t=[];for(const i of this.appInits){const s=i();if(W0(s))t.push(s);else if(bM(s)){const d=new Promise((m,v)=>{s.subscribe({complete:m,error:v})});t.push(d)}}const r=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{r()}).catch(i=>{this.reject(i)}),0===t.length&&r(),this.initialized=!0}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),AN=(()=>{class e{log(t){console.log(t)}warn(t){console.warn(t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const Ed=new wr("LocaleId",{providedIn:"root",factory:()=>Vn(Ed,Kn.Optional|Kn.SkipSelf)||function R5(){return typeof $localize<"u"&&$localize.locale||I_}()});let NN=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Mt(!1)}add(){this.hasPendingTasks.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class k5{constructor(n,t){this.ngModuleFactory=n,this.componentFactories=t}}let PN=(()=>{class e{compileModuleSync(t){return new HC(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const r=this.compileModuleSync(t),s=bu(Si(t).declarations).reduce((d,m)=>{const v=gi(m);return v&&d.push(new Hc(v)),d},[]);return new k5(r,s)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function LN(...e){}class ds{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new zr(!1),this.onMicrotaskEmpty=new zr(!1),this.onStable=new zr(!1),this.onError=new zr(!1),typeof Zone>"u")throw new en(908,!1);Zone.assertZonePatched();const i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!r&&t,i.shouldCoalesceRunChangeDetection=r,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=function z5(){const e="function"==typeof Eo.requestAnimationFrame;let n=Eo[e?"requestAnimationFrame":"setTimeout"],t=Eo[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&n&&t){const r=n[Zone.__symbol__("OriginalDelegate")];r&&(n=r);const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function j5(e){const n=()=>{!function U5(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Eo,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,fS(e),e.isCheckStableRunning=!0,dS(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),fS(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,i,s,d,m)=>{try{return kN(e),t.invokeTask(i,s,d,m)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||e.shouldCoalesceRunChangeDetection)&&n(),FN(e)}},onInvoke:(t,r,i,s,d,m,v)=>{try{return kN(e),t.invoke(i,s,d,m,v)}finally{e.shouldCoalesceRunChangeDetection&&n(),FN(e)}},onHasTask:(t,r,i,s)=>{t.hasTask(i,s),r===i&&("microTask"==s.change?(e._hasPendingMicrotasks=s.microTask,fS(e),dS(e)):"macroTask"==s.change&&(e.hasPendingMacrotasks=s.macroTask))},onHandleError:(t,r,i,s)=>(t.handleError(i,s),e.runOutsideAngular(()=>e.onError.emit(s)),!1)})}(i)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ds.isInAngularZone())throw new en(909,!1)}static assertNotInAngularZone(){if(ds.isInAngularZone())throw new en(909,!1)}run(n,t,r){return this._inner.run(n,t,r)}runTask(n,t,r,i){const s=this._inner,d=s.scheduleEventTask("NgZoneEvent: "+i,n,V5,LN,LN);try{return s.runTask(d,t,r)}finally{s.cancelTask(d)}}runGuarded(n,t,r){return this._inner.runGuarded(n,t,r)}runOutsideAngular(n){return this._outer.run(n)}}const V5={};function dS(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function fS(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function kN(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function FN(e){e._nesting--,dS(e)}class G5{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new zr,this.onMicrotaskEmpty=new zr,this.onStable=new zr,this.onError=new zr}run(n,t,r){return n.apply(t,r)}runGuarded(n,t,r){return n.apply(t,r)}runOutsideAngular(n){return n()}runTask(n,t,r,i){return n.apply(t,r)}}const BN=new wr("",{providedIn:"root",factory:zN});function zN(){const e=Vn(ds);let n=!0;return function on(...e){const n=Hs(e),t=function da(e,n){return"number"==typeof qo(e)?e.pop():n}(e,1/0),r=e;return r.length?1===r.length?Jr(r[0]):Fi(t)(ws(r,n)):vi}(new Ae(i=>{n=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{i.next(n),i.complete()})}),new Ae(i=>{let s;e.runOutsideAngular(()=>{s=e.onStable.subscribe(()=>{ds.assertNotInAngularZone(),queueMicrotask(()=>{!n&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(n=!0,i.next(!0))})})});const d=e.onUnstable.subscribe(()=>{ds.assertInAngularZone(),n&&(n=!1,e.runOutsideAngular(()=>{i.next(!1)}))});return()=>{s.unsubscribe(),d.unsubscribe()}}).pipe(Mr()))}const VN=new wr(""),eb=new wr("");let mS,pS=(()=>{class e{constructor(t,r,i){this._ngZone=t,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,mS||(function $5(e){mS=e}(i),i.addToWindow(r)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ds.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(t)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,r,i){let s=-1;r&&r>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(d=>d.timeoutId!==s),t(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:t,timeoutId:s,updateCb:i})}whenStable(t,r,i){if(i&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,r,i),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,r,i){return[]}}return e.\u0275fac=function(t){return new(t||e)(jn(ds),jn(gS),jn(eb))},e.\u0275prov=Gn({token:e,factory:e.\u0275fac}),e})(),gS=(()=>{class e{constructor(){this._applications=new Map}registerApplication(t,r){this._applications.set(t,r)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,r=!0){return mS?.findTestabilityInTree(this,t,r)??null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})(),$p=null;const UN=new wr("AllowMultipleToken"),_S=new wr("PlatformDestroyListeners"),yS=new wr("appBootstrapListener");class GN{constructor(n,t){this.name=n,this.token=t}}function HN(e,n,t=[]){const r=`Platform: ${n}`,i=new wr(r);return(s=[])=>{let d=vS();if(!d||d.injector.get(UN,!1)){const m=[...t,...s,{provide:i,useValue:!0}];e?e(m):function W5(e){if($p&&!$p.get(UN,!1))throw new en(400,!1);(function jN(){!function L(e){T=e}(()=>{throw new en(600,!1)})})(),$p=e;const n=e.get(WN);(function $N(e){e.get(Rp,null)?.forEach(t=>t())})(e)}(function qN(e=[],n){return wu.create({name:n,providers:[{provide:i_,useValue:"platform"},{provide:_S,useValue:new Set([()=>$p=null])},...e]})}(m,r))}return function X5(e){const n=vS();if(!n)throw new en(401,!1);return n}()}}function vS(){return $p?.get(WN)??null}let WN=(()=>{class e{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,r){const i=function Y5(e="zone.js",n){return"noop"===e?new G5:"zone.js"===e?new ds(n):e}(r?.ngZone,function ZN(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:r?.ngZoneEventCoalescing,runCoalescing:r?.ngZoneRunCoalescing}));return i.run(()=>{const s=function w4(e,n,t){return new $C(e,n,t)}(t.moduleType,this.injector,function QN(e){return[{provide:ds,useFactory:e},{provide:Mp,multi:!0,useFactory:()=>{const n=Vn(J5,{optional:!0});return()=>n.initialize()}},{provide:JN,useFactory:K5},{provide:BN,useFactory:zN}]}(()=>i)),d=s.injector.get(Qd,null);return i.runOutsideAngular(()=>{const m=i.onError.subscribe({next:v=>{d.handleError(v)}});s.onDestroy(()=>{tb(this._modules,s),m.unsubscribe()})}),function XN(e,n,t){try{const r=t();return W0(r)?r.catch(i=>{throw n.runOutsideAngular(()=>e.handleError(i)),i}):r}catch(r){throw n.runOutsideAngular(()=>e.handleError(r)),r}}(d,i,()=>{const m=s.injector.get(hS);return m.runInitializers(),m.donePromise.then(()=>(function _A(e){Gl(e,"Expected localeId to be defined"),"string"==typeof e&&(mA=e.toLowerCase().replace(/_/g,"-"))}(s.injector.get(Ed,I_)||I_),this._moduleDoBootstrap(s),s))})})}bootstrapModule(t,r=[]){const i=YN({},r);return function H5(e,n,t){const r=new HC(t);return Promise.resolve(r)}(0,0,t).then(s=>this.bootstrapModuleFactory(s,i))}_moduleDoBootstrap(t){const r=t.injector.get(Hp);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(i=>r.bootstrap(i));else{if(!t.instance.ngDoBootstrap)throw new en(-403,!1);t.instance.ngDoBootstrap(r)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new en(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const t=this._injector.get(_S,null);t&&(t.forEach(r=>r()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(t){return new(t||e)(jn(wu))},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();function YN(e,n){return Array.isArray(n)?n.reduce(YN,e):{...e,...n}}let Hp=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Vn(JN),this.zoneIsStable=Vn(BN),this.componentTypes=[],this.components=[],this.isStable=Vn(NN).hasPendingTasks.pipe(ur(t=>t?Rn(!1):this.zoneIsStable),function ei(e,n=At){return e=e??jl,Nn((t,r)=>{let i,s=!0;t.subscribe(Dn(r,d=>{const m=n(d);(s||!e(i,m))&&(s=!1,i=m,r.next(d))}))})}(),Mr()),this._injector=Vn(hh)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,r){const i=t instanceof u_;if(!this._injector.get(hS).done)throw!i&&function uc(e){const n=gi(e)||Oi(e)||Ui(e);return null!==n&&n.standalone}(t),new en(405,!1);let d;d=i?t:this._injector.get(c_).resolveComponentFactory(t),this.componentTypes.push(d.componentType);const m=function q5(e){return e.isBoundToModule}(d)?void 0:this._injector.get(M_),w=d.create(wu.NULL,[],r||d.selector,m),D=w.location.nativeElement,N=w.injector.get(VN,null);return N?.registerApplication(D),w.onDestroy(()=>{this.detachView(w.hostView),tb(this.components,w),N?.unregisterApplication(D)}),this._loadComponent(w),w}tick(){if(this._runningTick)throw new en(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this.internalErrorHandler(t)}finally{this._runningTick=!1}}attachView(t){const r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){const r=t;tb(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const r=this._injector.get(yS,[]);r.push(...this._bootstrapListeners),r.forEach(i=>i(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>tb(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new en(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function tb(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}const JN=new wr("",{providedIn:"root",factory:()=>Vn(Qd).handleError.bind(void 0)});function K5(){const e=Vn(ds),n=Vn(Qd);return t=>e.runOutsideAngular(()=>n.handleError(t))}let J5=(()=>{class e{constructor(){this.zone=Vn(ds),this.applicationRef=Vn(Hp)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();let Sd=(()=>{class e{}return e.__NG_ELEMENT_ID__=eV,e})();function eV(e){return function tV(e,n,t){if(sl(e)&&!t){const r=an(e.index,n);return new Uf(r,r)}return 47&e.type?new Uf(n[vn],n):null}(ks(),cn(),16==(16&e))}const pV=HN(null,"core",[]);let gV=(()=>{class e{constructor(t){}}return e.\u0275fac=function(t){return new(t||e)(jn(Hp))},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})();function P_(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}function DS(e,n){const t=gi(e),r=n.elementInjector||Pf();return new Hc(t).create(r,n.projectableNodes,n.hostElement,n.environmentInjector)}let TS=null;function qp(){return TS}class TV{}const ou=new wr("DocumentToken");let IS=(()=>{class e{historyGo(t){throw new Error("Not implemented")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:function(){return Vn(MV)},providedIn:"platform"}),e})();const IV=new wr("Location Initialized");let MV=(()=>{class e extends IS{constructor(){super(),this._doc=Vn(ou),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return qp().getBaseHref(this._doc)}onPopState(t){const r=qp().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){const r=qp().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,r,i){this._history.pushState(t,r,i)}replaceState(t,r,i){this._history.replaceState(t,r,i)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:function(){return new e},providedIn:"platform"}),e})();function MS(e,n){if(0==e.length)return n;if(0==n.length)return e;let t=0;return e.endsWith("/")&&t++,n.startsWith("/")&&t++,2==t?e+n.substring(1):1==t?e+n:e+"/"+n}function gP(e){const n=e.match(/#|\?|$/),t=n&&n.index||e.length;return e.slice(0,t-("/"===e[t-1]?1:0))+e.slice(t)}function Gf(e){return e&&"?"!==e[0]?"?"+e:e}let Wp=(()=>{class e{historyGo(t){throw new Error("Not implemented")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:function(){return Vn(_P)},providedIn:"root"}),e})();const mP=new wr("appBaseHref");let _P=(()=>{class e extends Wp{constructor(t,r){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??Vn(ou).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return MS(this._baseHref,t)}path(t=!1){const r=this._platformLocation.pathname+Gf(this._platformLocation.search),i=this._platformLocation.hash;return i&&t?`${r}${i}`:r}pushState(t,r,i,s){const d=this.prepareExternalUrl(i+Gf(s));this._platformLocation.pushState(t,r,d)}replaceState(t,r,i,s){const d=this.prepareExternalUrl(i+Gf(s));this._platformLocation.replaceState(t,r,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return e.\u0275fac=function(t){return new(t||e)(jn(IS),jn(mP,8))},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),yP=(()=>{class e extends Wp{constructor(t,r){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(t){const r=MS(this._baseHref,t);return r.length>0?"#"+r:r}pushState(t,r,i,s){let d=this.prepareExternalUrl(i+Gf(s));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.pushState(t,r,d)}replaceState(t,r,i,s){let d=this.prepareExternalUrl(i+Gf(s));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.replaceState(t,r,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return e.\u0275fac=function(t){return new(t||e)(jn(IS),jn(mP,8))},e.\u0275prov=Gn({token:e,factory:e.\u0275fac}),e})(),AS=(()=>{class e{constructor(t){this._subject=new zr,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const r=this._locationStrategy.getBaseHref();this._basePath=function PV(e){if(new RegExp("^(https?:)?//").test(e)){const[,t]=e.split(/\/\/[^\/]+/);return t}return e}(gP(vP(r))),this._locationStrategy.onPopState(i=>{this._subject.emit({url:this.path(!0),pop:!0,state:i.state,type:i.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+Gf(r))}normalize(t){return e.stripTrailingSlash(function NV(e,n){if(!e||!n.startsWith(e))return n;const t=n.substring(e.length);return""===t||["/",";","?","#"].includes(t[0])?t:n}(this._basePath,vP(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,r="",i=null){this._locationStrategy.pushState(i,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Gf(r)),i)}replaceState(t,r="",i=null){this._locationStrategy.replaceState(i,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Gf(r)),i)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(i=>i(t,r))}subscribe(t,r,i){return this._subject.subscribe({next:t,error:r,complete:i})}}return e.normalizeQueryParams=Gf,e.joinWithSlash=MS,e.stripTrailingSlash=gP,e.\u0275fac=function(t){return new(t||e)(jn(Wp))},e.\u0275prov=Gn({token:e,factory:function(){return function AV(){return new AS(jn(Wp))}()},providedIn:"root"}),e})();function vP(e){return e.replace(/\/index.html$/,"")}let Xp=(()=>{class e{constructor(t,r){this._viewContainer=t,this._context=new _U,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){RP("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){RP("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,r){return!0}}return e.\u0275fac=function(t){return new(t||e)(wt(Gh),wt(Ya))},e.\u0275dir=Mn({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),e})();class _U{constructor(){this.$implicit=null,this.ngIf=null}}function RP(e,n){if(n&&!n.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${xi(n)}'.`)}let kP=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})();function BP(e){return"server"===e}let WU=(()=>{class e{}return e.\u0275prov=Gn({token:e,providedIn:"root",factory:()=>new ZU(jn(ou),window)}),e})();class ZU{constructor(n,t){this.document=n,this.window=t,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(n){this.supportsScrolling()&&this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){if(!this.supportsScrolling())return;const t=function XU(e,n){const t=e.getElementById(n)||e.getElementsByName(n)[0];if(t)return t;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let i=r.currentNode;for(;i;){const s=i.shadowRoot;if(s){const d=s.getElementById(n)||s.querySelector(`[name="${n}"]`);if(d)return d}i=r.nextNode()}}return null}(this.document,n);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(n){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=n)}}scrollToElement(n){const t=n.getBoundingClientRect(),r=t.left+this.window.pageXOffset,i=t.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(r-s[0],i-s[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const n=zP(this.window.history)||zP(Object.getPrototypeOf(this.window.history));return!(!n||!n.writable&&!n.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function zP(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class v6 extends TV{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class ZS extends v6{static makeCurrent(){!function DV(e){TS||(TS=e)}(new ZS)}onAndCancel(n,t,r){return n.addEventListener(t,r),()=>{n.removeEventListener(t,r)}}dispatchEvent(n,t){n.dispatchEvent(t)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,t){return(t=t||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,t){return"window"===t?window:"document"===t?n:"body"===t?n.body:null}getBaseHref(n){const t=function x6(){return cv=cv||document.querySelector("base"),cv?cv.getAttribute("href"):null}();return null==t?null:function b6(e){yb=yb||document.createElement("a"),yb.setAttribute("href",e);const n=yb.pathname;return"/"===n.charAt(0)?n:`/${n}`}(t)}resetBaseElement(){cv=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return function fU(e,n){n=encodeURIComponent(n);for(const t of e.split(";")){const r=t.indexOf("="),[i,s]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(i.trim()===n)return decodeURIComponent(s)}return null}(document.cookie,n)}}let yb,cv=null,E6=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:e.\u0275fac}),e})();const XS=new wr("EventManagerPlugins");let $P=(()=>{class e{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(i=>{i.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,r,i){return this._findPluginFor(r).addEventListener(t,r,i)}getZone(){return this._zone}_findPluginFor(t){let r=this._eventNameToPlugin.get(t);if(r)return r;if(r=this._plugins.find(s=>s.supports(t)),!r)throw new en(5101,!1);return this._eventNameToPlugin.set(t,r),r}}return e.\u0275fac=function(t){return new(t||e)(jn(XS),jn(ds))},e.\u0275prov=Gn({token:e,factory:e.\u0275fac}),e})();class HP{constructor(n){this._doc=n}}const YS="ng-app-id";let qP=(()=>{class e{constructor(t,r,i,s={}){this.doc=t,this.appId=r,this.nonce=i,this.platformId=s,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=BP(s),this.resetHostNodes()}addStyles(t){for(const r of t)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(t){for(const r of t)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){const t=this.styleNodesInDOM;t&&(t.forEach(r=>r.remove()),t.clear());for(const r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const r of this.getAllStyles())this.addStyleToHost(t,r)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(const r of this.hostNodes)this.addStyleToHost(r,t)}onStyleRemoved(t){const r=this.styleRef;r.get(t)?.elements?.forEach(i=>i.remove()),r.delete(t)}collectServerRenderedStyles(){const t=this.doc.head?.querySelectorAll(`style[${YS}="${this.appId}"]`);if(t?.length){const r=new Map;return t.forEach(i=>{null!=i.textContent&&r.set(i.textContent,i)}),r}return null}changeUsageCount(t,r){const i=this.styleRef;if(i.has(t)){const s=i.get(t);return s.usage+=r,s.usage}return i.set(t,{usage:r,elements:[]}),r}getStyleElement(t,r){const i=this.styleNodesInDOM,s=i?.get(r);if(s?.parentNode===t)return i.delete(r),s.removeAttribute(YS),s;{const d=this.doc.createElement("style");return this.nonce&&d.setAttribute("nonce",this.nonce),d.textContent=r,this.platformIsServer&&d.setAttribute(YS,this.appId),d}}addStyleToHost(t,r){const i=this.getStyleElement(t,r);t.appendChild(i);const s=this.styleRef,d=s.get(r)?.elements;d?d.push(i):s.set(r,{elements:[i],usage:1})}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}}return e.\u0275fac=function(t){return new(t||e)(jn(ou),jn(Pp),jn(kg,8),jn(vc))},e.\u0275prov=Gn({token:e,factory:e.\u0275fac}),e})();const KS={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},JS=/%COMP%/g,T6=new wr("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function ZP(e,n){return n.map(t=>t.replace(JS,e))}let XP=(()=>{class e{constructor(t,r,i,s,d,m,v,w=null){this.eventManager=t,this.sharedStylesHost=r,this.appId=i,this.removeStylesOnCompDestroy=s,this.doc=d,this.platformId=m,this.ngZone=v,this.nonce=w,this.rendererByCompId=new Map,this.platformIsServer=BP(m),this.defaultRenderer=new QS(t,d,v,this.platformIsServer)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===oa.ShadowDom&&(r={...r,encapsulation:oa.Emulated});const i=this.getOrCreateRenderer(t,r);return i instanceof KP?i.applyToHost(t):i instanceof eD&&i.applyStyles(),i}getOrCreateRenderer(t,r){const i=this.rendererByCompId;let s=i.get(r.id);if(!s){const d=this.doc,m=this.ngZone,v=this.eventManager,w=this.sharedStylesHost,D=this.removeStylesOnCompDestroy,N=this.platformIsServer;switch(r.encapsulation){case oa.Emulated:s=new KP(v,w,r,this.appId,D,d,m,N);break;case oa.ShadowDom:return new N6(v,w,t,r,d,m,this.nonce,N);default:s=new eD(v,w,r,D,d,m,N)}i.set(r.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}}return e.\u0275fac=function(t){return new(t||e)(jn($P),jn(qP),jn(Pp),jn(T6),jn(ou),jn(vc),jn(ds),jn(kg))},e.\u0275prov=Gn({token:e,factory:e.\u0275fac}),e})();class QS{constructor(n,t,r,i){this.eventManager=n,this.doc=t,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(n,t){return t?this.doc.createElementNS(KS[t]||t,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,t){(YP(n)?n.content:n).appendChild(t)}insertBefore(n,t,r){n&&(YP(n)?n.content:n).insertBefore(t,r)}removeChild(n,t){n&&n.removeChild(t)}selectRootElement(n,t){let r="string"==typeof n?this.doc.querySelector(n):n;if(!r)throw new en(-5104,!1);return t||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,t,r,i){if(i){t=i+":"+t;const s=KS[i];s?n.setAttributeNS(s,t,r):n.setAttribute(t,r)}else n.setAttribute(t,r)}removeAttribute(n,t,r){if(r){const i=KS[r];i?n.removeAttributeNS(i,t):n.removeAttribute(`${r}:${t}`)}else n.removeAttribute(t)}addClass(n,t){n.classList.add(t)}removeClass(n,t){n.classList.remove(t)}setStyle(n,t,r,i){i&(kc.DashCase|kc.Important)?n.style.setProperty(t,r,i&kc.Important?"important":""):n.style[t]=r}removeStyle(n,t,r){r&kc.DashCase?n.style.removeProperty(t):n.style[t]=""}setProperty(n,t,r){n[t]=r}setValue(n,t){n.nodeValue=t}listen(n,t,r){if("string"==typeof n&&!(n=qp().getGlobalEventTarget(this.doc,n)))throw new Error(`Unsupported event target ${n} for event ${t}`);return this.eventManager.addEventListener(n,t,this.decoratePreventDefault(r))}decoratePreventDefault(n){return t=>{if("__ngUnwrap__"===t)return n;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>n(t)):n(t))&&t.preventDefault()}}}function YP(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class N6 extends QS{constructor(n,t,r,i,s,d,m,v){super(n,s,d,v),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const w=ZP(i.id,i.styles);for(const D of w){const N=document.createElement("style");m&&N.setAttribute("nonce",m),N.textContent=D,this.shadowRoot.appendChild(N)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,t){return super.appendChild(this.nodeOrShadowRoot(n),t)}insertBefore(n,t,r){return super.insertBefore(this.nodeOrShadowRoot(n),t,r)}removeChild(n,t){return super.removeChild(this.nodeOrShadowRoot(n),t)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class eD extends QS{constructor(n,t,r,i,s,d,m,v){super(n,s,d,m),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i,this.styles=v?ZP(v,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class KP extends eD{constructor(n,t,r,i,s,d,m,v){const w=i+"-"+r.id;super(n,t,r,s,d,m,v,w),this.contentAttr=function I6(e){return"_ngcontent-%COMP%".replace(JS,e)}(w),this.hostAttr=function M6(e){return"_nghost-%COMP%".replace(JS,e)}(w)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,t){const r=super.createElement(n,t);return super.setAttribute(r,this.contentAttr,""),r}}let P6=(()=>{class e extends HP{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,i){return t.addEventListener(r,i,!1),()=>this.removeEventListener(t,r,i)}removeEventListener(t,r,i){return t.removeEventListener(r,i)}}return e.\u0275fac=function(t){return new(t||e)(jn(ou))},e.\u0275prov=Gn({token:e,factory:e.\u0275fac}),e})();const JP=["alt","control","meta","shift"],R6={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},O6={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let L6=(()=>{class e extends HP{constructor(t){super(t)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,r,i){const s=e.parseEventName(r),d=e.eventCallback(s.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>qp().onAndCancel(t,s.domEventName,d))}static parseEventName(t){const r=t.toLowerCase().split("."),i=r.shift();if(0===r.length||"keydown"!==i&&"keyup"!==i)return null;const s=e._normalizeKey(r.pop());let d="",m=r.indexOf("code");if(m>-1&&(r.splice(m,1),d="code."),JP.forEach(w=>{const D=r.indexOf(w);D>-1&&(r.splice(D,1),d+=w+".")}),d+=s,0!=r.length||0===s.length)return null;const v={};return v.domEventName=i,v.fullKey=d,v}static matchEventFullKeyCode(t,r){let i=R6[t.key]||t.key,s="";return r.indexOf("code.")>-1&&(i=t.code,s="code."),!(null==i||!i)&&(i=i.toLowerCase()," "===i?i="space":"."===i&&(i="dot"),JP.forEach(d=>{d!==i&&(0,O6[d])(t)&&(s+=d+".")}),s+=i,s===r)}static eventCallback(t,r,i){return s=>{e.matchEventFullKeyCode(s,t)&&i.runGuarded(()=>r(s))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return e.\u0275fac=function(t){return new(t||e)(jn(ou))},e.\u0275prov=Gn({token:e,factory:e.\u0275fac}),e})();const z6=HN(pV,"browser",[{provide:vc,useValue:"browser"},{provide:Rp,useValue:function k6(){ZS.makeCurrent()},multi:!0},{provide:ou,useFactory:function B6(){return function GE(e){o0=e}(document),document},deps:[]}]),V6=new wr(""),t2=[{provide:eb,useClass:class w6{addToWindow(n){Eo.getAngularTestability=(r,i=!0)=>{const s=n.findTestabilityInTree(r,i);if(null==s)throw new en(5103,!1);return s},Eo.getAllAngularTestabilities=()=>n.getAllTestabilities(),Eo.getAllAngularRootElements=()=>n.getAllRootElements(),Eo.frameworkStabilizers||(Eo.frameworkStabilizers=[]),Eo.frameworkStabilizers.push(r=>{const i=Eo.getAllAngularTestabilities();let s=i.length,d=!1;const m=function(v){d=d||v,s--,0==s&&r(d)};i.forEach(v=>{v.whenStable(m)})})}findTestabilityInTree(n,t,r){return null==t?null:n.getTestability(t)??(r?qp().isShadowRoot(t)?this.findTestabilityInTree(n,t.host,!0):this.findTestabilityInTree(n,t.parentElement,!0):null)}},deps:[]},{provide:VN,useClass:pS,deps:[ds,gS,eb]},{provide:pS,useClass:pS,deps:[ds,gS,eb]}],n2=[{provide:i_,useValue:"root"},{provide:Qd,useFactory:function F6(){return new Qd},deps:[]},{provide:XS,useClass:P6,multi:!0,deps:[ou,ds,vc]},{provide:XS,useClass:L6,multi:!0,deps:[ou]},XP,qP,$P,{provide:C0,useExisting:XP},{provide:class YU{},useClass:E6,deps:[]},[]];let U6=(()=>{class e{constructor(t){}static withServerTransition(t){return{ngModule:e,providers:[{provide:Pp,useValue:t.appId}]}}}return e.\u0275fac=function(t){return new(t||e)(jn(V6,12))},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({providers:[...n2,...t2],imports:[kP,gV]}),e})(),r2=(()=>{class e{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}}return e.\u0275fac=function(t){return new(t||e)(jn(ou))},e.\u0275prov=Gn({token:e,factory:function(t){let r=null;return r=t?new t:function G6(){return new r2(jn(ou))}(),r},providedIn:"root"}),e})();typeof window<"u"&&window;const{isArray:X6}=Array,{getPrototypeOf:Y6,prototype:K6,keys:J6}=Object;function a2(e){if(1===e.length){const n=e[0];if(X6(n))return{args:n,keys:null};if(function Q6(e){return e&&"object"==typeof e&&Y6(e)===K6}(n)){const t=J6(n);return{args:t.map(r=>n[r]),keys:t}}}return{args:e,keys:null}}const{isArray:ej}=Array;function nD(e){return bn(n=>function tj(e,n){return ej(n)?e(...n):e(n)}(e,n))}function l2(e,n){return e.reduce((t,r,i)=>(t[r]=n[i],t),{})}function rD(...e){const n=Hs(e),t=Tu(e),{args:r,keys:i}=a2(e);if(0===r.length)return ws([],n);const s=new Ae(function nj(e,n,t=At){return r=>{u2(n,()=>{const{length:i}=e,s=new Array(i);let d=i,m=i;for(let v=0;v<i;v++)u2(n,()=>{const w=ws(e[v],n);let D=!1;w.subscribe(Dn(r,N=>{s[v]=N,D||(D=!0,m--),m||r.next(t(s.slice()))},()=>{--d||r.complete()}))},r)},r)}}(r,n,i?d=>l2(i,d):At));return t?s.pipe(nD(t)):s}function u2(e,n,t){e?zl(t,e,n):n()}const vb=ze(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function hv(...e){return function rj(){return Fi(1)}()(ws(e,Hs(e)))}function c2(e){return new Ae(n=>{Jr(e()).subscribe(n)})}function dv(e,n){const t=Ee(e)?e:()=>e,r=i=>i.error(t());return new Ae(n?i=>n.schedule(r,0,i):r)}function iD(){return Nn((e,n)=>{let t=null;e._refCount++;const r=Dn(n,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(t=null);const i=e._connection,s=t;t=null,i&&(!s||i===s)&&i.unsubscribe(),n.unsubscribe()});e.subscribe(r),r.closed||(t=e.connect())})}class h2 extends Ae{constructor(n,t){super(),this.source=n,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,$n(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new be;const t=this.getSubject();n.add(this.source.subscribe(Dn(t,void 0,()=>{this._teardown(),t.complete()},r=>{this._teardown(),t.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=be.EMPTY)}return n}refCount(){return iD()(this)}}function Lu(e){return e<=0?()=>vi:Nn((n,t)=>{let r=0;n.subscribe(Dn(t,i=>{++r<=e&&(t.next(i),e<=r&&t.complete())}))})}function Su(e,n){return Nn((t,r)=>{let i=0;t.subscribe(Dn(r,s=>e.call(n,s,i++)&&r.next(s)))})}function xb(e){return Nn((n,t)=>{let r=!1;n.subscribe(Dn(t,i=>{r=!0,t.next(i)},()=>{r||t.next(e),t.complete()}))})}function f2(e=ij){return Nn((n,t)=>{let r=!1;n.subscribe(Dn(t,i=>{r=!0,t.next(i)},()=>r?t.complete():t.error(e())))})}function ij(){return new vb}function Kg(e,n){const t=arguments.length>=2;return r=>r.pipe(e?Su((i,s)=>e(i,s,r)):At,Lu(1),t?xb(n):f2(()=>new vb))}function fv(e,n){return Ee(n)?Ps(e,n,1):Ps(e,1)}function ku(e,n,t){const r=Ee(e)||n||t?{next:e,error:n,complete:t}:e;return r?Nn((i,s)=>{var d;null===(d=r.subscribe)||void 0===d||d.call(r);let m=!0;i.subscribe(Dn(s,v=>{var w;null===(w=r.next)||void 0===w||w.call(r,v),s.next(v)},()=>{var v;m=!1,null===(v=r.complete)||void 0===v||v.call(r),s.complete()},v=>{var w;m=!1,null===(w=r.error)||void 0===w||w.call(r,v),s.error(v)},()=>{var v,w;m&&(null===(v=r.unsubscribe)||void 0===v||v.call(r)),null===(w=r.finalize)||void 0===w||w.call(r)}))}):At}function Jg(e){return Nn((n,t)=>{let s,r=null,i=!1;r=n.subscribe(Dn(t,void 0,void 0,d=>{s=Jr(e(d,Jg(e)(n))),r?(r.unsubscribe(),r=null,s.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(t))})}function oD(e){return e<=0?()=>vi:Nn((n,t)=>{let r=[];n.subscribe(Dn(t,i=>{r.push(i),e<r.length&&r.shift()},()=>{for(const i of r)t.next(i);t.complete()},void 0,()=>{r=null}))})}function sD(e){return Nn((n,t)=>{try{n.subscribe(t)}finally{t.add(e)}})}const Ri="primary",pv=Symbol("RouteTitle");class lj{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t[0]:t}return null}getAll(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function L_(e){return new lj(e)}function uj(e,n,t){const r=t.path.split("/");if(r.length>e.length||"full"===t.pathMatch&&(n.hasChildren()||r.length<e.length))return null;const i={};for(let s=0;s<r.length;s++){const d=r[s],m=e[s];if(d.startsWith(":"))i[d.substring(1)]=m;else if(d!==m.path)return null}return{consumed:e.slice(0,r.length),posParams:i}}function lf(e,n){const t=e?Object.keys(e):void 0,r=n?Object.keys(n):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!g2(e[i],n[i]))return!1;return!0}function g2(e,n){if(Array.isArray(e)&&Array.isArray(n)){if(e.length!==n.length)return!1;const t=[...e].sort(),r=[...n].sort();return t.every((i,s)=>r[s]===i)}return e===n}function m2(e){return e.length>0?e[e.length-1]:null}function Kp(e){return function Z6(e){return!!e&&(e instanceof Ae||Ee(e.lift)&&Ee(e.subscribe))}(e)?e:W0(e)?ws(Promise.resolve(e)):Rn(e)}const hj={exact:function v2(e,n,t){if(!Qg(e.segments,n.segments)||!bb(e.segments,n.segments,t)||e.numberOfChildren!==n.numberOfChildren)return!1;for(const r in n.children)if(!e.children[r]||!v2(e.children[r],n.children[r],t))return!1;return!0},subset:x2},_2={exact:function dj(e,n){return lf(e,n)},subset:function fj(e,n){return Object.keys(n).length<=Object.keys(e).length&&Object.keys(n).every(t=>g2(e[t],n[t]))},ignored:()=>!0};function y2(e,n,t){return hj[t.paths](e.root,n.root,t.matrixParams)&&_2[t.queryParams](e.queryParams,n.queryParams)&&!("exact"===t.fragment&&e.fragment!==n.fragment)}function x2(e,n,t){return b2(e,n,n.segments,t)}function b2(e,n,t,r){if(e.segments.length>t.length){const i=e.segments.slice(0,t.length);return!(!Qg(i,t)||n.hasChildren()||!bb(i,t,r))}if(e.segments.length===t.length){if(!Qg(e.segments,t)||!bb(e.segments,t,r))return!1;for(const i in n.children)if(!e.children[i]||!x2(e.children[i],n.children[i],r))return!1;return!0}{const i=t.slice(0,e.segments.length),s=t.slice(e.segments.length);return!!(Qg(e.segments,i)&&bb(e.segments,i,r)&&e.children[Ri])&&b2(e.children[Ri],n,s,r)}}function bb(e,n,t){return n.every((r,i)=>_2[t](e[i].parameters,r.parameters))}class k_{constructor(n=new Fs([],{}),t={},r=null){this.root=n,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=L_(this.queryParams)),this._queryParamMap}toString(){return mj.serialize(this)}}class Fs{constructor(n,t){this.segments=n,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return wb(this)}}class gv{constructor(n,t){this.path=n,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=L_(this.parameters)),this._parameterMap}toString(){return C2(this)}}function Qg(e,n){return e.length===n.length&&e.every((t,r)=>t.path===n[r].path)}let mv=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:function(){return new aD},providedIn:"root"}),e})();class aD{parse(n){const t=new Tj(n);return new k_(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(n){const t=`/${_v(n.root,!0)}`,r=function vj(e){const n=Object.keys(e).map(t=>{const r=e[t];return Array.isArray(r)?r.map(i=>`${Eb(t)}=${Eb(i)}`).join("&"):`${Eb(t)}=${Eb(r)}`}).filter(t=>!!t);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${t}${r}${"string"==typeof n.fragment?`#${function _j(e){return encodeURI(e)}(n.fragment)}`:""}`}}const mj=new aD;function wb(e){return e.segments.map(n=>C2(n)).join("/")}function _v(e,n){if(!e.hasChildren())return wb(e);if(n){const t=e.children[Ri]?_v(e.children[Ri],!1):"",r=[];return Object.entries(e.children).forEach(([i,s])=>{i!==Ri&&r.push(`${i}:${_v(s,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}{const t=function gj(e,n){let t=[];return Object.entries(e.children).forEach(([r,i])=>{r===Ri&&(t=t.concat(n(i,r)))}),Object.entries(e.children).forEach(([r,i])=>{r!==Ri&&(t=t.concat(n(i,r)))}),t}(e,(r,i)=>i===Ri?[_v(e.children[Ri],!1)]:[`${i}:${_v(r,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[Ri]?`${wb(e)}/${t[0]}`:`${wb(e)}/(${t.join("//")})`}}function w2(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Eb(e){return w2(e).replace(/%3B/gi,";")}function lD(e){return w2(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Cb(e){return decodeURIComponent(e)}function E2(e){return Cb(e.replace(/\+/g,"%20"))}function C2(e){return`${lD(e.path)}${function yj(e){return Object.keys(e).map(n=>`;${lD(n)}=${lD(e[n])}`).join("")}(e.parameters)}`}const xj=/^[^\/()?;#]+/;function uD(e){const n=e.match(xj);return n?n[0]:""}const bj=/^[^\/()?;=#]+/,Ej=/^[^=?&#]+/,Sj=/^[^&#]+/;class Tj{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Fs([],{}):new Fs([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(t).length>0)&&(r[Ri]=new Fs(n,t)),r}parseSegment(){const n=uD(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new en(4009,!1);return this.capture(n),new gv(Cb(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const t=function wj(e){const n=e.match(bj);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const i=uD(this.remaining);i&&(r=i,this.capture(r))}n[Cb(t)]=Cb(r)}parseQueryParam(n){const t=function Cj(e){const n=e.match(Ej);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const d=function Dj(e){const n=e.match(Sj);return n?n[0]:""}(this.remaining);d&&(r=d,this.capture(r))}const i=E2(t),s=E2(r);if(n.hasOwnProperty(i)){let d=n[i];Array.isArray(d)||(d=[d],n[i]=d),d.push(s)}else n[i]=s}parseParens(n){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=uD(this.remaining),i=this.remaining[r.length];if("/"!==i&&")"!==i&&";"!==i)throw new en(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):n&&(s=Ri);const d=this.parseChildren();t[s]=1===Object.keys(d).length?d[Ri]:new Fs([],d),this.consumeOptional("//")}return t}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new en(4011,!1)}}function S2(e){return e.segments.length>0?new Fs([],{[Ri]:e}):e}function D2(e){const n={};for(const r of Object.keys(e.children)){const s=D2(e.children[r]);if(r===Ri&&0===s.segments.length&&s.hasChildren())for(const[d,m]of Object.entries(s.children))n[d]=m;else(s.segments.length>0||s.hasChildren())&&(n[r]=s)}return function Ij(e){if(1===e.numberOfChildren&&e.children[Ri]){const n=e.children[Ri];return new Fs(e.segments.concat(n.segments),n.children)}return e}(new Fs(e.segments,n))}function em(e){return e instanceof k_}function T2(e){let n;const i=S2(function t(s){const d={};for(const v of s.children){const w=t(v);d[v.outlet]=w}const m=new Fs(s.url,d);return s===e&&(n=m),m}(e.root));return n??i}function I2(e,n,t,r){let i=e;for(;i.parent;)i=i.parent;if(0===n.length)return cD(i,i,i,t,r);const s=function Aj(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new A2(!0,0,e);let n=0,t=!1;const r=e.reduce((i,s,d)=>{if("object"==typeof s&&null!=s){if(s.outlets){const m={};return Object.entries(s.outlets).forEach(([v,w])=>{m[v]="string"==typeof w?w.split("/"):w}),[...i,{outlets:m}]}if(s.segmentPath)return[...i,s.segmentPath]}return"string"!=typeof s?[...i,s]:0===d?(s.split("/").forEach((m,v)=>{0==v&&"."===m||(0==v&&""===m?t=!0:".."===m?n++:""!=m&&i.push(m))}),i):[...i,s]},[]);return new A2(t,n,r)}(n);if(s.toRoot())return cD(i,i,new Fs([],{}),t,r);const d=function Nj(e,n,t){if(e.isAbsolute)return new Db(n,!0,0);if(!t)return new Db(n,!1,NaN);if(null===t.parent)return new Db(t,!0,0);const r=Sb(e.commands[0])?0:1;return function Pj(e,n,t){let r=e,i=n,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new en(4005,!1);i=r.segments.length}return new Db(r,!1,i-s)}(t,t.segments.length-1+r,e.numberOfDoubleDots)}(s,i,e),m=d.processChildren?vv(d.segmentGroup,d.index,s.commands):N2(d.segmentGroup,d.index,s.commands);return cD(i,d.segmentGroup,m,t,r)}function Sb(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function yv(e){return"object"==typeof e&&null!=e&&e.outlets}function cD(e,n,t,r,i){let d,s={};r&&Object.entries(r).forEach(([v,w])=>{s[v]=Array.isArray(w)?w.map(D=>`${D}`):`${w}`}),d=e===n?t:M2(e,n,t);const m=S2(D2(d));return new k_(m,s,i)}function M2(e,n,t){const r={};return Object.entries(e.children).forEach(([i,s])=>{r[i]=s===n?t:M2(s,n,t)}),new Fs(e.segments,r)}class A2{constructor(n,t,r){if(this.isAbsolute=n,this.numberOfDoubleDots=t,this.commands=r,n&&r.length>0&&Sb(r[0]))throw new en(4003,!1);const i=r.find(yv);if(i&&i!==m2(r))throw new en(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Db{constructor(n,t,r){this.segmentGroup=n,this.processChildren=t,this.index=r}}function N2(e,n,t){if(e||(e=new Fs([],{})),0===e.segments.length&&e.hasChildren())return vv(e,n,t);const r=function Oj(e,n,t){let r=0,i=n;const s={match:!1,pathIndex:0,commandIndex:0};for(;i<e.segments.length;){if(r>=t.length)return s;const d=e.segments[i],m=t[r];if(yv(m))break;const v=`${m}`,w=r<t.length-1?t[r+1]:null;if(i>0&&void 0===v)break;if(v&&w&&"object"==typeof w&&void 0===w.outlets){if(!R2(v,w,d))return s;r+=2}else{if(!R2(v,{},d))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(e,n,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const s=new Fs(e.segments.slice(0,r.pathIndex),{});return s.children[Ri]=new Fs(e.segments.slice(r.pathIndex),e.children),vv(s,0,i)}return r.match&&0===i.length?new Fs(e.segments,{}):r.match&&!e.hasChildren()?hD(e,n,t):r.match?vv(e,0,i):hD(e,n,t)}function vv(e,n,t){if(0===t.length)return new Fs(e.segments,{});{const r=function Rj(e){return yv(e[0])?e[0].outlets:{[Ri]:e}}(t),i={};if(!r[Ri]&&e.children[Ri]&&1===e.numberOfChildren&&0===e.children[Ri].segments.length){const s=vv(e.children[Ri],n,t);return new Fs(e.segments,s.children)}return Object.entries(r).forEach(([s,d])=>{"string"==typeof d&&(d=[d]),null!==d&&(i[s]=N2(e.children[s],n,d))}),Object.entries(e.children).forEach(([s,d])=>{void 0===r[s]&&(i[s]=d)}),new Fs(e.segments,i)}}function hD(e,n,t){const r=e.segments.slice(0,n);let i=0;for(;i<t.length;){const s=t[i];if(yv(s)){const v=Lj(s.outlets);return new Fs(r,v)}if(0===i&&Sb(t[0])){r.push(new gv(e.segments[n].path,P2(t[0]))),i++;continue}const d=yv(s)?s.outlets[Ri]:`${s}`,m=i<t.length-1?t[i+1]:null;d&&m&&Sb(m)?(r.push(new gv(d,P2(m))),i+=2):(r.push(new gv(d,{})),i++)}return new Fs(r,{})}function Lj(e){const n={};return Object.entries(e).forEach(([t,r])=>{"string"==typeof r&&(r=[r]),null!==r&&(n[t]=hD(new Fs([],{}),0,r))}),n}function P2(e){const n={};return Object.entries(e).forEach(([t,r])=>n[t]=`${r}`),n}function R2(e,n,t){return e==t.path&&lf(n,t.parameters)}const xv="imperative";class uf{constructor(n,t){this.id=n,this.url=t}}class dD extends uf{constructor(n,t,r="imperative",i=null){super(n,t),this.type=0,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class tm extends uf{constructor(n,t,r){super(n,t),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Tb extends uf{constructor(n,t,r,i){super(n,t),this.reason=r,this.code=i,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class bv extends uf{constructor(n,t,r,i){super(n,t),this.reason=r,this.code=i,this.type=16}}class fD extends uf{constructor(n,t,r,i){super(n,t),this.error=r,this.target=i,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class kj extends uf{constructor(n,t,r,i){super(n,t),this.urlAfterRedirects=r,this.state=i,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Fj extends uf{constructor(n,t,r,i){super(n,t),this.urlAfterRedirects=r,this.state=i,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Bj extends uf{constructor(n,t,r,i,s){super(n,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class zj extends uf{constructor(n,t,r,i){super(n,t),this.urlAfterRedirects=r,this.state=i,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Vj extends uf{constructor(n,t,r,i){super(n,t),this.urlAfterRedirects=r,this.state=i,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Uj{constructor(n){this.route=n,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class jj{constructor(n){this.route=n,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Gj{constructor(n){this.snapshot=n,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class $j{constructor(n){this.snapshot=n,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Hj{constructor(n){this.snapshot=n,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class qj{constructor(n){this.snapshot=n,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class O2{constructor(n,t,r){this.routerEvent=n,this.position=t,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class Wj{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new wv,this.attachRef=null}}let wv=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(t,r){const i=this.getOrCreateContext(t);i.outlet=r,this.contexts.set(t,i)}onChildOutletDestroyed(t){const r=this.getContext(t);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let r=this.getContext(t);return r||(r=new Wj,this.contexts.set(t,r)),r}getContext(t){return this.contexts.get(t)||null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class L2{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const t=this.pathFromRoot(n);return t.length>1?t[t.length-2]:null}children(n){const t=pD(n,this._root);return t?t.children.map(r=>r.value):[]}firstChild(n){const t=pD(n,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(n){const t=gD(n,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==n)}pathFromRoot(n){return gD(n,this._root).map(t=>t.value)}}function pD(e,n){if(e===n.value)return n;for(const t of n.children){const r=pD(e,t);if(r)return r}return null}function gD(e,n){if(e===n.value)return[n];for(const t of n.children){const r=gD(e,t);if(r.length)return r.unshift(n),r}return[]}class qf{constructor(n,t){this.value=n,this.children=t}toString(){return`TreeNode(${this.value})`}}function F_(e){const n={};return e&&e.children.forEach(t=>n[t.value.outlet]=t),n}class k2 extends L2{constructor(n,t){super(n),this.snapshot=t,mD(this,n)}toString(){return this.snapshot.toString()}}function F2(e,n){const t=function Zj(e,n){const d=new Ib([],{},{},"",{},Ri,n,null,{});return new z2("",new qf(d,[]))}(0,n),r=new Mt([new gv("",{})]),i=new Mt({}),s=new Mt({}),d=new Mt({}),m=new Mt(""),v=new B_(r,i,d,m,s,Ri,n,t.root);return v.snapshot=t.root,new k2(new qf(v,[]),t)}class B_{constructor(n,t,r,i,s,d,m,v){this.urlSubject=n,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=s,this.outlet=d,this.component=m,this._futureSnapshot=v,this.title=this.dataSubject?.pipe(bn(w=>w[pv]))??Rn(void 0),this.url=n,this.params=t,this.queryParams=r,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(bn(n=>L_(n)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(bn(n=>L_(n)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function B2(e,n="emptyOnly"){const t=e.pathFromRoot;let r=0;if("always"!==n)for(r=t.length-1;r>=1;){const i=t[r],s=t[r-1];if(i.routeConfig&&""===i.routeConfig.path)r--;else{if(s.component)break;r--}}return function Xj(e){return e.reduce((n,t)=>({params:{...n.params,...t.params},data:{...n.data,...t.data},resolve:{...t.data,...n.resolve,...t.routeConfig?.data,...t._resolvedData}}),{params:{},data:{},resolve:{}})}(t.slice(r))}class Ib{get title(){return this.data?.[pv]}constructor(n,t,r,i,s,d,m,v,w){this.url=n,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=d,this.component=m,this.routeConfig=v,this._resolve=w}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=L_(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=L_(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class z2 extends L2{constructor(n,t){super(t),this.url=n,mD(this,t)}toString(){return V2(this._root)}}function mD(e,n){n.value._routerState=e,n.children.forEach(t=>mD(e,t))}function V2(e){const n=e.children.length>0?` { ${e.children.map(V2).join(", ")} } `:"";return`${e.value}${n}`}function _D(e){if(e.snapshot){const n=e.snapshot,t=e._futureSnapshot;e.snapshot=t,lf(n.queryParams,t.queryParams)||e.queryParamsSubject.next(t.queryParams),n.fragment!==t.fragment&&e.fragmentSubject.next(t.fragment),lf(n.params,t.params)||e.paramsSubject.next(t.params),function cj(e,n){if(e.length!==n.length)return!1;for(let t=0;t<e.length;++t)if(!lf(e[t],n[t]))return!1;return!0}(n.url,t.url)||e.urlSubject.next(t.url),lf(n.data,t.data)||e.dataSubject.next(t.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function yD(e,n){const t=lf(e.params,n.params)&&function pj(e,n){return Qg(e,n)&&e.every((t,r)=>lf(t.parameters,n[r].parameters))}(e.url,n.url);return t&&!(!e.parent!=!n.parent)&&(!e.parent||yD(e.parent,n.parent))}let vD=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=Ri,this.activateEvents=new zr,this.deactivateEvents=new zr,this.attachEvents=new zr,this.detachEvents=new zr,this.parentContexts=Vn(wv),this.location=Vn(Gh),this.changeDetector=Vn(Sd),this.environmentInjector=Vn(hh),this.inputBinder=Vn(Mb,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){const{firstChange:r,previousValue:i}=t.name;if(r)return;this.isTrackedInParentContexts(i)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(i)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new en(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new en(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new en(4012,!1);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new en(4013,!1);this._activatedRoute=t;const i=this.location,d=t.snapshot.component,m=this.parentContexts.getOrCreateContext(this.name).children,v=new Yj(t,m,i.injector);this.activated=i.createComponent(d,{index:i.length,injector:v,environmentInjector:r??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=Mn({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Ce]}),e})();class Yj{constructor(n,t,r){this.route=n,this.childContexts=t,this.parent=r}get(n,t){return n===B_?this.route:n===wv?this.childContexts:this.parent.get(n,t)}}const Mb=new wr("");let U2=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){const{activatedRoute:r}=t,i=rD([r.queryParams,r.params,r.data]).pipe(ur(([s,d,m],v)=>(m={...s,...d,...m},0===v?Rn(m):Promise.resolve(m)))).subscribe(s=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==r||null===r.component)return void this.unsubscribeFromRouteData(t);const d=function SV(e){const n=gi(e);if(!n)return null;const t=new Hc(n);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}(r.component);if(d)for(const{templateName:m}of d.inputs)t.activatedComponentRef.setInput(m,s[m]);else this.unsubscribeFromRouteData(t)});this.outletDataSubscriptions.set(t,i)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:e.\u0275fac}),e})();function Ev(e,n,t){if(t&&e.shouldReuseRoute(n.value,t.value.snapshot)){const r=t.value;r._futureSnapshot=n.value;const i=function Jj(e,n,t){return n.children.map(r=>{for(const i of t.children)if(e.shouldReuseRoute(r.value,i.value.snapshot))return Ev(e,r,i);return Ev(e,r)})}(e,n,t);return new qf(r,i)}{if(e.shouldAttach(n.value)){const s=e.retrieve(n.value);if(null!==s){const d=s.route;return d.value._futureSnapshot=n.value,d.children=n.children.map(m=>Ev(e,m)),d}}const r=function Qj(e){return new B_(new Mt(e.url),new Mt(e.params),new Mt(e.queryParams),new Mt(e.fragment),new Mt(e.data),e.outlet,e.component,e)}(n.value),i=n.children.map(s=>Ev(e,s));return new qf(r,i)}}const xD="ngNavigationCancelingError";function j2(e,n){const{redirectTo:t,navigationBehaviorOptions:r}=em(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,i=G2(!1,0,n);return i.url=t,i.navigationBehaviorOptions=r,i}function G2(e,n,t){const r=new Error("NavigationCancelingError: "+(e||""));return r[xD]=!0,r.cancellationCode=n,t&&(r.url=t),r}function $2(e){return H2(e)&&em(e.url)}function H2(e){return e&&e[xD]}let q2=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Bi({type:e,selectors:[["ng-component"]],standalone:!0,features:[jh],decls:1,vars:0,template:function(t,r){1&t&&za(0,"router-outlet")},dependencies:[vD],encapsulation:2}),e})();function bD(e){const n=e.children&&e.children.map(bD),t=n?{...e,children:n}:{...e};return!t.component&&!t.loadComponent&&(n||t.loadChildren)&&t.outlet&&t.outlet!==Ri&&(t.component=q2),t}function Id(e){return e.outlet||Ri}function Cv(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let n=e.parent;n;n=n.parent){const t=n.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class sG{constructor(n,t,r,i,s){this.routeReuseStrategy=n,this.futureState=t,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=s}activate(n){const t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,n),_D(this.futureState.root),this.activateChildRoutes(t,r,n)}deactivateChildRoutes(n,t,r){const i=F_(t);n.children.forEach(s=>{const d=s.value.outlet;this.deactivateRoutes(s,i[d],r),delete i[d]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(n,t,r){const i=n.value,s=t?t.value:null;if(i===s)if(i.component){const d=r.getContext(i.outlet);d&&this.deactivateChildRoutes(n,t,d.children)}else this.deactivateChildRoutes(n,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(n,t){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,t):this.deactivateRouteAndOutlet(n,t)}detachAndStoreRouteSubtree(n,t){const r=t.getContext(n.value.outlet),i=r&&n.value.component?r.children:t,s=F_(n);for(const d of Object.keys(s))this.deactivateRouteAndItsChildren(s[d],i);if(r&&r.outlet){const d=r.outlet.detach(),m=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:d,route:n,contexts:m})}}deactivateRouteAndOutlet(n,t){const r=t.getContext(n.value.outlet),i=r&&n.value.component?r.children:t,s=F_(n);for(const d of Object.keys(s))this.deactivateRouteAndItsChildren(s[d],i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(n,t,r){const i=F_(t);n.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new qj(s.value.snapshot))}),n.children.length&&this.forwardEvent(new $j(n.value.snapshot))}activateRoutes(n,t,r){const i=n.value,s=t?t.value:null;if(_D(i),i===s)if(i.component){const d=r.getOrCreateContext(i.outlet);this.activateChildRoutes(n,t,d.children)}else this.activateChildRoutes(n,t,r);else if(i.component){const d=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){const m=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),d.children.onOutletReAttached(m.contexts),d.attachRef=m.componentRef,d.route=m.route.value,d.outlet&&d.outlet.attach(m.componentRef,m.route.value),_D(m.route.value),this.activateChildRoutes(n,null,d.children)}else{const m=Cv(i.snapshot);d.attachRef=null,d.route=i,d.injector=m,d.outlet&&d.outlet.activateWith(i,d.injector),this.activateChildRoutes(n,null,d.children)}}else this.activateChildRoutes(n,null,r)}}class W2{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class Ab{constructor(n,t){this.component=n,this.route=t}}function aG(e,n,t){const r=e._root;return Sv(r,n?n._root:null,t,[r.value])}function z_(e,n){const t=Symbol(),r=n.get(e,t);return r===t?"function"!=typeof e||function ra(e){return null!==Hl(e)}(e)?n.get(e):e:r}function Sv(e,n,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=F_(n);return e.children.forEach(d=>{(function uG(e,n,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=e.value,d=n?n.value:null,m=t?t.getContext(e.value.outlet):null;if(d&&s.routeConfig===d.routeConfig){const v=function cG(e,n,t){if("function"==typeof t)return t(e,n);switch(t){case"pathParamsChange":return!Qg(e.url,n.url);case"pathParamsOrQueryParamsChange":return!Qg(e.url,n.url)||!lf(e.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!yD(e,n)||!lf(e.queryParams,n.queryParams);default:return!yD(e,n)}}(d,s,s.routeConfig.runGuardsAndResolvers);v?i.canActivateChecks.push(new W2(r)):(s.data=d.data,s._resolvedData=d._resolvedData),Sv(e,n,s.component?m?m.children:null:t,r,i),v&&m&&m.outlet&&m.outlet.isActivated&&i.canDeactivateChecks.push(new Ab(m.outlet.component,d))}else d&&Dv(n,m,i),i.canActivateChecks.push(new W2(r)),Sv(e,null,s.component?m?m.children:null:t,r,i)})(d,s[d.value.outlet],t,r.concat([d.value]),i),delete s[d.value.outlet]}),Object.entries(s).forEach(([d,m])=>Dv(m,t.getContext(d),i)),i}function Dv(e,n,t){const r=F_(e),i=e.value;Object.entries(r).forEach(([s,d])=>{Dv(d,i.component?n?n.children.getContext(s):null:n,t)}),t.canDeactivateChecks.push(new Ab(i.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,i))}function Tv(e){return"function"==typeof e}function Z2(e){return e instanceof vb||"EmptyError"===e?.name}const Nb=Symbol("INITIAL_VALUE");function V_(){return ur(e=>rD(e.map(n=>n.pipe(Lu(1),function d2(...e){const n=Hs(e);return Nn((t,r)=>{(n?hv(e,t,n):hv(e,t)).subscribe(r)})}(Nb)))).pipe(bn(n=>{for(const t of n)if(!0!==t){if(t===Nb)return Nb;if(!1===t||t instanceof k_)return t}return!0}),Su(n=>n!==Nb),Lu(1)))}function X2(e){return function we(...e){return at(e)}(ku(n=>{if(em(n))throw j2(0,n)}),bn(n=>!0===n))}class Pb{constructor(n){this.segmentGroup=n||null}}class Y2{constructor(n){this.urlTree=n}}function U_(e){return dv(new Pb(e))}function K2(e){return dv(new Y2(e))}class AG{constructor(n,t){this.urlSerializer=n,this.urlTree=t}noMatchError(n){return new en(4002,!1)}lineralizeSegments(n,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),0===i.numberOfChildren)return Rn(r);if(i.numberOfChildren>1||!i.children[Ri])return dv(new en(4e3,!1));i=i.children[Ri]}}applyRedirectCommands(n,t,r){return this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),n,r)}applyRedirectCreateUrlTree(n,t,r,i){const s=this.createSegmentGroup(n,t.root,r,i);return new k_(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(n,t){const r={};return Object.entries(n).forEach(([i,s])=>{if("string"==typeof s&&s.startsWith(":")){const m=s.substring(1);r[i]=t[m]}else r[i]=s}),r}createSegmentGroup(n,t,r,i){const s=this.createSegments(n,t.segments,r,i);let d={};return Object.entries(t.children).forEach(([m,v])=>{d[m]=this.createSegmentGroup(n,v,r,i)}),new Fs(s,d)}createSegments(n,t,r,i){return t.map(s=>s.path.startsWith(":")?this.findPosParam(n,s,i):this.findOrReturn(s,r))}findPosParam(n,t,r){const i=r[t.path.substring(1)];if(!i)throw new en(4001,!1);return i}findOrReturn(n,t){let r=0;for(const i of t){if(i.path===n.path)return t.splice(r),i;r++}return n}}const wD={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function NG(e,n,t,r,i){const s=ED(e,n,t);return s.matched?(r=function eG(e,n){return e.providers&&!e._injector&&(e._injector=qC(e.providers,n,`Route: ${e.path}`)),e._injector??n}(n,r),function TG(e,n,t,r){const i=n.canMatch;return i&&0!==i.length?Rn(i.map(d=>{const m=z_(d,e);return Kp(function mG(e){return e&&Tv(e.canMatch)}(m)?m.canMatch(n,t):e.runInContext(()=>m(n,t)))})).pipe(V_(),X2()):Rn(!0)}(r,n,t).pipe(bn(d=>!0===d?s:{...wD}))):Rn(s)}function ED(e,n,t){if(""===n.path)return"full"===n.pathMatch&&(e.hasChildren()||t.length>0)?{...wD}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const i=(n.matcher||uj)(t,e,n);if(!i)return{...wD};const s={};Object.entries(i.posParams??{}).forEach(([m,v])=>{s[m]=v.path});const d=i.consumed.length>0?{...s,...i.consumed[i.consumed.length-1].parameters}:s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:d,positionalParamSegments:i.posParams??{}}}function J2(e,n,t,r){return t.length>0&&function OG(e,n,t){return t.some(r=>Rb(e,n,r)&&Id(r)!==Ri)}(e,t,r)?{segmentGroup:new Fs(n,RG(r,new Fs(t,e.children))),slicedSegments:[]}:0===t.length&&function LG(e,n,t){return t.some(r=>Rb(e,n,r))}(e,t,r)?{segmentGroup:new Fs(e.segments,PG(e,0,t,r,e.children)),slicedSegments:t}:{segmentGroup:new Fs(e.segments,e.children),slicedSegments:t}}function PG(e,n,t,r,i){const s={};for(const d of r)if(Rb(e,t,d)&&!i[Id(d)]){const m=new Fs([],{});s[Id(d)]=m}return{...i,...s}}function RG(e,n){const t={};t[Ri]=n;for(const r of e)if(""===r.path&&Id(r)!==Ri){const i=new Fs([],{});t[Id(r)]=i}return t}function Rb(e,n,t){return(!(e.hasChildren()||n.length>0)||"full"!==t.pathMatch)&&""===t.path}class zG{constructor(n,t,r,i,s,d,m){this.injector=n,this.configLoader=t,this.rootComponentType=r,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=d,this.urlSerializer=m,this.allowRedirects=!0,this.applyRedirects=new AG(this.urlSerializer,this.urlTree)}noMatchError(n){return new en(4002,!1)}recognize(){const n=J2(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,n,Ri).pipe(Jg(t=>{if(t instanceof Y2)return this.allowRedirects=!1,this.urlTree=t.urlTree,this.match(t.urlTree);throw t instanceof Pb?this.noMatchError(t):t}),bn(t=>{const r=new Ib([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Ri,this.rootComponentType,null,{}),i=new qf(r,t),s=new z2("",i),d=function Mj(e,n,t=null,r=null){return I2(T2(e),n,t,r)}(r,[],this.urlTree.queryParams,this.urlTree.fragment);return d.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(d),this.inheritParamsAndData(s._root),{state:s,tree:d}}))}match(n){return this.processSegmentGroup(this.injector,this.config,n.root,Ri).pipe(Jg(r=>{throw r instanceof Pb?this.noMatchError(r):r}))}inheritParamsAndData(n){const t=n.value,r=B2(t,this.paramsInheritanceStrategy);t.params=Object.freeze(r.params),t.data=Object.freeze(r.data),n.children.forEach(i=>this.inheritParamsAndData(i))}processSegmentGroup(n,t,r,i){return 0===r.segments.length&&r.hasChildren()?this.processChildren(n,t,r):this.processSegment(n,t,r,r.segments,i,!0)}processChildren(n,t,r){const i=[];for(const s of Object.keys(r.children))"primary"===s?i.unshift(s):i.push(s);return ws(i).pipe(fv(s=>{const d=r.children[s],m=function iG(e,n){const t=e.filter(r=>Id(r)===n);return t.push(...e.filter(r=>Id(r)!==n)),t}(t,s);return this.processSegmentGroup(n,m,d,s)}),function sj(e,n){return Nn(function oj(e,n,t,r,i){return(s,d)=>{let m=t,v=n,w=0;s.subscribe(Dn(d,D=>{const N=w++;v=m?e(v,D,N):(m=!0,D),r&&d.next(v)},i&&(()=>{m&&d.next(v),d.complete()})))}}(e,n,arguments.length>=2,!0))}((s,d)=>(s.push(...d),s)),xb(null),function aj(e,n){const t=arguments.length>=2;return r=>r.pipe(e?Su((i,s)=>e(i,s,r)):At,oD(1),t?xb(n):f2(()=>new vb))}(),Ps(s=>{if(null===s)return U_(r);const d=Q2(s);return function VG(e){e.sort((n,t)=>n.value.outlet===Ri?-1:t.value.outlet===Ri?1:n.value.outlet.localeCompare(t.value.outlet))}(d),Rn(d)}))}processSegment(n,t,r,i,s,d){return ws(t).pipe(fv(m=>this.processSegmentAgainstRoute(m._injector??n,t,m,r,i,s,d).pipe(Jg(v=>{if(v instanceof Pb)return Rn(null);throw v}))),Kg(m=>!!m),Jg(m=>{if(Z2(m))return function FG(e,n,t){return 0===n.length&&!e.children[t]}(r,i,s)?Rn([]):U_(r);throw m}))}processSegmentAgainstRoute(n,t,r,i,s,d,m){return function kG(e,n,t,r){return!!(Id(e)===r||r!==Ri&&Rb(n,t,e))&&("**"===e.path||ED(n,e,t).matched)}(r,i,s,d)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(n,i,r,s,d,m):m&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(n,i,t,r,s,d):U_(i):U_(i)}expandSegmentAgainstRouteUsingRedirect(n,t,r,i,s,d){return"**"===i.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(n,r,i,d):this.expandRegularSegmentAgainstRouteUsingRedirect(n,t,r,i,s,d)}expandWildCardWithParamsAgainstRouteUsingRedirect(n,t,r,i){const s=this.applyRedirects.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?K2(s):this.applyRedirects.lineralizeSegments(r,s).pipe(Ps(d=>{const m=new Fs(d,{});return this.processSegment(n,t,m,d,i,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(n,t,r,i,s,d){const{matched:m,consumedSegments:v,remainingSegments:w,positionalParamSegments:D}=ED(t,i,s);if(!m)return U_(t);const N=this.applyRedirects.applyRedirectCommands(v,i.redirectTo,D);return i.redirectTo.startsWith("/")?K2(N):this.applyRedirects.lineralizeSegments(i,N).pipe(Ps(O=>this.processSegment(n,r,t,O.concat(w),d,!1)))}matchSegmentAgainstRoute(n,t,r,i,s,d){let m;if("**"===r.path){const v=i.length>0?m2(i).parameters:{};m=Rn({snapshot:new Ib(i,v,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,eR(r),Id(r),r.component??r._loadedComponent??null,r,tR(r)),consumedSegments:[],remainingSegments:[]}),t.children={}}else m=NG(t,r,i,n).pipe(bn(({matched:v,consumedSegments:w,remainingSegments:D,parameters:N})=>v?{snapshot:new Ib(w,N,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,eR(r),Id(r),r.component??r._loadedComponent??null,r,tR(r)),consumedSegments:w,remainingSegments:D}:null));return m.pipe(ur(v=>null===v?U_(t):this.getChildConfig(n=r._injector??n,r,i).pipe(ur(({routes:w})=>{const D=r._loadedInjector??n,{snapshot:N,consumedSegments:O,remainingSegments:k}=v,{segmentGroup:Q,slicedSegments:X}=J2(t,O,k,w);if(0===X.length&&Q.hasChildren())return this.processChildren(D,w,Q).pipe(bn(le=>null===le?null:[new qf(N,le)]));if(0===w.length&&0===X.length)return Rn([new qf(N,[])]);const _e=Id(r)===s;return this.processSegment(D,w,Q,X,_e?Ri:s,!0).pipe(bn(le=>[new qf(N,le)]))}))))}getChildConfig(n,t,r){return t.children?Rn({routes:t.children,injector:n}):t.loadChildren?void 0!==t._loadedRoutes?Rn({routes:t._loadedRoutes,injector:t._loadedInjector}):function DG(e,n,t,r){const i=n.canLoad;return void 0===i||0===i.length?Rn(!0):Rn(i.map(d=>{const m=z_(d,e);return Kp(function dG(e){return e&&Tv(e.canLoad)}(m)?m.canLoad(n,t):e.runInContext(()=>m(n,t)))})).pipe(V_(),X2())}(n,t,r).pipe(Ps(i=>i?this.configLoader.loadChildren(n,t).pipe(ku(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):function MG(e){return dv(G2(!1,3))}())):Rn({routes:[],injector:n})}}function UG(e){const n=e.value.routeConfig;return n&&""===n.path}function Q2(e){const n=[],t=new Set;for(const r of e){if(!UG(r)){n.push(r);continue}const i=n.find(s=>r.value.routeConfig===s.value.routeConfig);void 0!==i?(i.children.push(...r.children),t.add(i)):n.push(r)}for(const r of t){const i=Q2(r.children);n.push(new qf(r.value,i))}return n.filter(r=>!t.has(r))}function eR(e){return e.data||{}}function tR(e){return e.resolve||{}}function GG(e,n){return Ps(t=>{const{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return Rn(t);let s=0;return ws(i).pipe(fv(d=>function $G(e,n,t,r){const i=e.routeConfig,s=e._resolve;return void 0!==i?.title&&!nR(i)&&(s[pv]=i.title),function HG(e,n,t,r){const i=function qG(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===i.length)return Rn({});const s={};return ws(i).pipe(Ps(d=>function WG(e,n,t,r){const i=Cv(n)??r,s=z_(e,i);return Kp(s.resolve?s.resolve(n,t):i.runInContext(()=>s(n,t)))}(e[d],n,t,r).pipe(Kg(),ku(m=>{s[d]=m}))),oD(1),function p2(e){return bn(()=>e)}(s),Jg(d=>Z2(d)?vi:dv(d)))}(s,e,n,r).pipe(bn(d=>(e._resolvedData=d,e.data=B2(e,t).resolve,i&&nR(i)&&(e.data[pv]=i.title),null)))}(d.route,r,e,n)),ku(()=>s++),oD(1),Ps(d=>s===i.length?Rn(t):vi))})}function nR(e){return"string"==typeof e.title||null===e.title}function CD(e){return ur(n=>{const t=e(n);return t?ws(t).pipe(bn(()=>n)):Rn(n)})}const j_=new wr("ROUTES");let SD=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Vn(PN)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return Rn(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const r=Kp(t.loadComponent()).pipe(bn(rR),ku(s=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=s}),sD(()=>{this.componentLoaders.delete(t)})),i=new h2(r,()=>new It).pipe(iD());return this.componentLoaders.set(t,i),i}loadChildren(t,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Rn({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const s=this.loadModuleFactoryOrRoutes(r.loadChildren).pipe(bn(m=>{this.onLoadEndListener&&this.onLoadEndListener(r);let v,w;return Array.isArray(m)?w=m:(v=m.create(t).injector,w=v.get(j_,[],Kn.Self|Kn.Optional).flat()),{routes:w.map(bD),injector:v}}),sD(()=>{this.childrenLoaders.delete(r)})),d=new h2(s,()=>new It).pipe(iD());return this.childrenLoaders.set(r,d),d}loadModuleFactoryOrRoutes(t){return Kp(t()).pipe(bn(rR),Ps(r=>r instanceof jA||Array.isArray(r)?Rn(r):ws(this.compiler.compileModuleAsync(r))))}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function rR(e){return function ZG(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let Ob=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new It,this.configLoader=Vn(SD),this.environmentInjector=Vn(hh),this.urlSerializer=Vn(mv),this.rootContexts=Vn(wv),this.inputBindingEnabled=null!==Vn(Mb,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Rn(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=i=>this.events.next(new jj(i)),this.configLoader.onLoadStartListener=i=>this.events.next(new Uj(i))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:r})}setupNavigations(t){return this.transitions=new Mt({id:0,currentUrlTree:t.currentUrlTree,currentRawUrl:t.currentUrlTree,extractedUrl:t.urlHandlingStrategy.extract(t.currentUrlTree),urlAfterRedirects:t.urlHandlingStrategy.extract(t.currentUrlTree),rawUrl:t.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:xv,restoredState:null,currentSnapshot:t.routerState.snapshot,targetSnapshot:null,currentRouterState:t.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Su(r=>0!==r.id),bn(r=>({...r,extractedUrl:t.urlHandlingStrategy.extract(r.rawUrl)})),ur(r=>{let i=!1,s=!1;return Rn(r).pipe(ku(d=>{this.currentNavigation={id:d.id,initialUrl:d.rawUrl,extractedUrl:d.extractedUrl,trigger:d.source,extras:d.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),ur(d=>{const m=t.browserUrlTree.toString(),v=!t.navigated||d.extractedUrl.toString()!==m||m!==t.currentUrlTree.toString();if(!v&&"reload"!==(d.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const D="";return this.events.next(new bv(d.id,t.serializeUrl(r.rawUrl),D,0)),t.rawUrlTree=d.rawUrl,d.resolve(null),vi}if(t.urlHandlingStrategy.shouldProcessUrl(d.rawUrl))return iR(d.source)&&(t.browserUrlTree=d.extractedUrl),Rn(d).pipe(ur(D=>{const N=this.transitions?.getValue();return this.events.next(new dD(D.id,this.urlSerializer.serialize(D.extractedUrl),D.source,D.restoredState)),N!==this.transitions?.getValue()?vi:Promise.resolve(D)}),function jG(e,n,t,r,i,s){return Ps(d=>function BG(e,n,t,r,i,s,d="emptyOnly"){return new zG(e,n,t,r,i,d,s).recognize()}(e,n,t,r,d.extractedUrl,i,s).pipe(bn(({state:m,tree:v})=>({...d,targetSnapshot:m,urlAfterRedirects:v}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,t.paramsInheritanceStrategy),ku(D=>{if(r.targetSnapshot=D.targetSnapshot,r.urlAfterRedirects=D.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:D.urlAfterRedirects},"eager"===t.urlUpdateStrategy){if(!D.extras.skipLocationChange){const O=t.urlHandlingStrategy.merge(D.urlAfterRedirects,D.rawUrl);t.setBrowserUrl(O,D)}t.browserUrlTree=D.urlAfterRedirects}const N=new kj(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects),D.targetSnapshot);this.events.next(N)}));if(v&&t.urlHandlingStrategy.shouldProcessUrl(t.rawUrlTree)){const{id:D,extractedUrl:N,source:O,restoredState:k,extras:Q}=d,X=new dD(D,this.urlSerializer.serialize(N),O,k);this.events.next(X);const _e=F2(0,this.rootComponentType).snapshot;return Rn(r={...d,targetSnapshot:_e,urlAfterRedirects:N,extras:{...Q,skipLocationChange:!1,replaceUrl:!1}})}{const D="";return this.events.next(new bv(d.id,t.serializeUrl(r.extractedUrl),D,1)),t.rawUrlTree=d.rawUrl,d.resolve(null),vi}}),ku(d=>{const m=new Fj(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(m)}),bn(d=>r={...d,guards:aG(d.targetSnapshot,d.currentSnapshot,this.rootContexts)}),function yG(e,n){return Ps(t=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:d}}=t;return 0===d.length&&0===s.length?Rn({...t,guardsResult:!0}):function vG(e,n,t,r){return ws(e).pipe(Ps(i=>function SG(e,n,t,r,i){const s=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return s&&0!==s.length?Rn(s.map(m=>{const v=Cv(n)??i,w=z_(m,v);return Kp(function gG(e){return e&&Tv(e.canDeactivate)}(w)?w.canDeactivate(e,n,t,r):v.runInContext(()=>w(e,n,t,r))).pipe(Kg())})).pipe(V_()):Rn(!0)}(i.component,i.route,t,n,r)),Kg(i=>!0!==i,!0))}(d,r,i,e).pipe(Ps(m=>m&&function hG(e){return"boolean"==typeof e}(m)?function xG(e,n,t,r){return ws(n).pipe(fv(i=>hv(function wG(e,n){return null!==e&&n&&n(new Gj(e)),Rn(!0)}(i.route.parent,r),function bG(e,n){return null!==e&&n&&n(new Hj(e)),Rn(!0)}(i.route,r),function CG(e,n,t){const r=n[n.length-1],s=n.slice(0,n.length-1).reverse().map(d=>function lG(e){const n=e.routeConfig?e.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:e,guards:n}:null}(d)).filter(d=>null!==d).map(d=>c2(()=>Rn(d.guards.map(v=>{const w=Cv(d.node)??t,D=z_(v,w);return Kp(function pG(e){return e&&Tv(e.canActivateChild)}(D)?D.canActivateChild(r,e):w.runInContext(()=>D(r,e))).pipe(Kg())})).pipe(V_())));return Rn(s).pipe(V_())}(e,i.path,t),function EG(e,n,t){const r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||0===r.length)return Rn(!0);const i=r.map(s=>c2(()=>{const d=Cv(n)??t,m=z_(s,d);return Kp(function fG(e){return e&&Tv(e.canActivate)}(m)?m.canActivate(n,e):d.runInContext(()=>m(n,e))).pipe(Kg())}));return Rn(i).pipe(V_())}(e,i.route,t))),Kg(i=>!0!==i,!0))}(r,s,e,n):Rn(m)),bn(m=>({...t,guardsResult:m})))})}(this.environmentInjector,d=>this.events.next(d)),ku(d=>{if(r.guardsResult=d.guardsResult,em(d.guardsResult))throw j2(0,d.guardsResult);const m=new Bj(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot,!!d.guardsResult);this.events.next(m)}),Su(d=>!!d.guardsResult||(t.restoreHistory(d),this.cancelNavigationTransition(d,"",3),!1)),CD(d=>{if(d.guards.canActivateChecks.length)return Rn(d).pipe(ku(m=>{const v=new zj(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot);this.events.next(v)}),ur(m=>{let v=!1;return Rn(m).pipe(GG(t.paramsInheritanceStrategy,this.environmentInjector),ku({next:()=>v=!0,complete:()=>{v||(t.restoreHistory(m),this.cancelNavigationTransition(m,"",2))}}))}),ku(m=>{const v=new Vj(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot);this.events.next(v)}))}),CD(d=>{const m=v=>{const w=[];v.routeConfig?.loadComponent&&!v.routeConfig._loadedComponent&&w.push(this.configLoader.loadComponent(v.routeConfig).pipe(ku(D=>{v.component=D}),bn(()=>{})));for(const D of v.children)w.push(...m(D));return w};return rD(m(d.targetSnapshot.root)).pipe(xb(),Lu(1))}),CD(()=>this.afterPreactivation()),bn(d=>{const m=function Kj(e,n,t){const r=Ev(e,n._root,t?t._root:void 0);return new k2(r,n)}(t.routeReuseStrategy,d.targetSnapshot,d.currentRouterState);return r={...d,targetRouterState:m}}),ku(d=>{t.currentUrlTree=d.urlAfterRedirects,t.rawUrlTree=t.urlHandlingStrategy.merge(d.urlAfterRedirects,d.rawUrl),t.routerState=d.targetRouterState,"deferred"===t.urlUpdateStrategy&&(d.extras.skipLocationChange||t.setBrowserUrl(t.rawUrlTree,d),t.browserUrlTree=d.urlAfterRedirects)}),((e,n,t,r)=>bn(i=>(new sG(n,i.targetRouterState,i.currentRouterState,t,r).activate(e),i)))(this.rootContexts,t.routeReuseStrategy,d=>this.events.next(d),this.inputBindingEnabled),Lu(1),ku({next:d=>{i=!0,this.lastSuccessfulNavigation=this.currentNavigation,t.navigated=!0,this.events.next(new tm(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(t.currentUrlTree))),t.titleStrategy?.updateTitle(d.targetRouterState.snapshot),d.resolve(!0)},complete:()=>{i=!0}}),sD(()=>{i||s||this.cancelNavigationTransition(r,"",1),this.currentNavigation?.id===r.id&&(this.currentNavigation=null)}),Jg(d=>{if(s=!0,H2(d)){$2(d)||(t.navigated=!0,t.restoreHistory(r,!0));const m=new Tb(r.id,this.urlSerializer.serialize(r.extractedUrl),d.message,d.cancellationCode);if(this.events.next(m),$2(d)){const v=t.urlHandlingStrategy.merge(d.url,t.rawUrlTree),w={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===t.urlUpdateStrategy||iR(r.source)};t.scheduleNavigation(v,xv,null,w,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{t.restoreHistory(r,!0);const m=new fD(r.id,this.urlSerializer.serialize(r.extractedUrl),d,r.targetSnapshot??void 0);this.events.next(m);try{r.resolve(t.errorHandler(d))}catch(v){r.reject(v)}}return vi}))}))}cancelNavigationTransition(t,r,i){const s=new Tb(t.id,this.urlSerializer.serialize(t.extractedUrl),r,i);this.events.next(s),t.resolve(!1)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function iR(e){return e!==xv}let oR=(()=>{class e{buildTitle(t){let r,i=t.root;for(;void 0!==i;)r=this.getResolvedTitleForRoute(i)??r,i=i.children.find(s=>s.outlet===Ri);return r}getResolvedTitleForRoute(t){return t.data[pv]}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:function(){return Vn(XG)},providedIn:"root"}),e})(),XG=(()=>{class e extends oR{constructor(t){super(),this.title=t}updateTitle(t){const r=this.buildTitle(t);void 0!==r&&this.title.setTitle(r)}}return e.\u0275fac=function(t){return new(t||e)(jn(r2))},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),YG=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:function(){return Vn(JG)},providedIn:"root"}),e})();class KG{shouldDetach(n){return!1}store(n,t){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,t){return n.routeConfig===t.routeConfig}}let JG=(()=>{class e extends KG{}return e.\u0275fac=function(){let n;return function(r){return(n||(n=Da(e)))(r||e)}}(),e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Lb=new wr("",{providedIn:"root",factory:()=>({})});let QG=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:function(){return Vn(e8)},providedIn:"root"}),e})(),e8=(()=>{class e{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,r){return t}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var Iv=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(Iv||{});function sR(e,n){e.events.pipe(Su(t=>t instanceof tm||t instanceof Tb||t instanceof fD||t instanceof bv),bn(t=>t instanceof tm||t instanceof bv?Iv.COMPLETE:t instanceof Tb&&(0===t.code||1===t.code)?Iv.REDIRECTING:Iv.FAILED),Su(t=>t!==Iv.REDIRECTING),Lu(1)).subscribe(()=>{n()})}function t8(e){throw e}function n8(e,n,t){return n.parse("/")}const r8={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},i8={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let qh=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=Vn(AN),this.isNgZoneEnabled=!1,this.options=Vn(Lb,{optional:!0})||{},this.pendingTasks=Vn(NN),this.errorHandler=this.options.errorHandler||t8,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||n8,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=Vn(QG),this.routeReuseStrategy=Vn(YG),this.titleStrategy=Vn(oR),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=Vn(j_,{optional:!0})?.flat()??[],this.navigationTransitions=Vn(Ob),this.urlSerializer=Vn(mv),this.location=Vn(AS),this.componentInputBindingEnabled=!!Vn(Mb,{optional:!0}),this.isNgZoneEnabled=Vn(ds)instanceof ds&&ds.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new k_,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=F2(0,null),this.navigationTransitions.setupNavigations(this).subscribe(t=>{this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId??0},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)})}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const t=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),xv,t)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const r="popstate"===t.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{this.navigateToSyncWithBrowser(t.url,r,t.state)},0)}))}navigateToSyncWithBrowser(t,r,i){const s={replaceUrl:!0},d=i?.navigationId?i:null;if(i){const v={...i};delete v.navigationId,delete v.\u0275routerPageId,0!==Object.keys(v).length&&(s.state=v)}const m=this.parseUrl(t);this.scheduleNavigation(m,r,d,s)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(bD),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(t,r={}){const{relativeTo:i,queryParams:s,fragment:d,queryParamsHandling:m,preserveFragment:v}=r,w=v?this.currentUrlTree.fragment:d;let N,D=null;switch(m){case"merge":D={...this.currentUrlTree.queryParams,...s};break;case"preserve":D=this.currentUrlTree.queryParams;break;default:D=s||null}null!==D&&(D=this.removeEmptyProps(D));try{N=T2(i?i.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof t[0]||!t[0].startsWith("/"))&&(t=[]),N=this.currentUrlTree.root}return I2(N,t,D,w??null)}navigateByUrl(t,r={skipLocationChange:!1}){const i=em(t)?t:this.parseUrl(t),s=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(s,xv,null,r)}navigate(t,r={skipLocationChange:!1}){return function o8(e){for(let n=0;n<e.length;n++)if(null==e[n])throw new en(4008,!1)}(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let r;try{r=this.urlSerializer.parse(t)}catch(i){r=this.malformedUriErrorHandler(i,this.urlSerializer,t)}return r}isActive(t,r){let i;if(i=!0===r?{...r8}:!1===r?{...i8}:r,em(t))return y2(this.currentUrlTree,t,i);const s=this.parseUrl(t);return y2(this.currentUrlTree,s,i)}removeEmptyProps(t){return Object.keys(t).reduce((r,i)=>{const s=t[i];return null!=s&&(r[i]=s),r},{})}scheduleNavigation(t,r,i,s,d){if(this.disposed)return Promise.resolve(!1);let m,v,w;d?(m=d.resolve,v=d.reject,w=d.promise):w=new Promise((N,O)=>{m=N,v=O});const D=this.pendingTasks.add();return sR(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(D))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:s,resolve:m,reject:v,promise:w,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),w.catch(N=>Promise.reject(N))}setBrowserUrl(t,r){const i=this.urlSerializer.serialize(t);if(this.location.isCurrentPathEqualTo(i)||r.extras.replaceUrl){const d={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId)};this.location.replaceState(i,"",d)}else{const s={...r.extras.state,...this.generateNgRouterState(r.id,(this.browserPageId??0)+1)};this.location.go(i,"",s)}}restoreHistory(t,r=!1){if("computed"===this.canceledNavigationResolution){const s=this.currentPageId-(this.browserPageId??this.currentPageId);0!==s?this.location.historyGo(s):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===s&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,r){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),kb=(()=>{class e{constructor(t,r,i,s,d,m){this.router=t,this.route=r,this.tabIndexAttribute=i,this.renderer=s,this.el=d,this.locationStrategy=m,this.href=null,this.commands=null,this.onChanges=new It,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const v=d.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===v||"area"===v,this.isAnchorElement?this.subscription=t.events.subscribe(w=>{w instanceof tm&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(t){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(t){null!=t?(this.commands=Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(t,r,i,s,d){return!!(null===this.urlTree||this.isAnchorElement&&(0!==t||r||i||s||d||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const t=null===this.href?null:function f0(e,n,t){return function tC(e,n){return"src"===n&&("embed"===e||"frame"===e||"iframe"===e||"media"===e||"script"===e)||"href"===n&&("base"===e||"link"===e)?Lg:e_}(n,t)(e)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",t)}applyAttributeValue(t,r){const i=this.renderer,s=this.el.nativeElement;null!==r?i.setAttribute(s,t,r):i.removeAttribute(s,t)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return e.\u0275fac=function(t){return new(t||e)(wt(qh),wt(B_),function mc(e){return function D1(e,n){if("class"===n)return e.classes;if("style"===n)return e.styles;const t=e.attrs;if(t){const r=t.length;let i=0;for(;i<r;){const s=t[i];if(ed(s))break;if(0===s)i+=2;else if("number"==typeof s)for(i++;i<r&&"string"==typeof t[i];)i++;else{if(s===n)return t[i+1];i+=2}}}return null}(ks(),e)}("tabindex"),wt(Ju),wt(Yo),wt(Wp))},e.\u0275dir=Mn({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(t,r){1&t&&$i("click",function(s){return r.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),2&t&&Ms("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",P_],skipLocationChange:["skipLocationChange","skipLocationChange",P_],replaceUrl:["replaceUrl","replaceUrl",P_],routerLink:"routerLink"},standalone:!0,features:[rM,Ce]}),e})(),aR=(()=>{class e{get isActive(){return this._isActive}constructor(t,r,i,s,d){this.router=t,this.element=r,this.renderer=i,this.cdr=s,this.link=d,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new zr,this.routerEventsSubscription=t.events.subscribe(m=>{m instanceof tm&&this.update()})}ngAfterContentInit(){Rn(this.links.changes,Rn(null)).pipe(Fi()).subscribe(t=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const t=[...this.links.toArray(),this.link].filter(r=>!!r).map(r=>r.onChanges);this.linkInputChangesSubscription=ws(t).pipe(Fi()).subscribe(r=>{this._isActive!==this.isLinkActive(this.router)(r)&&this.update()})}set routerLinkActive(t){const r=Array.isArray(t)?t:t.split(" ");this.classes=r.filter(i=>!!i)}ngOnChanges(t){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{const t=this.hasActiveLinks();this._isActive!==t&&(this._isActive=t,this.cdr.markForCheck(),this.classes.forEach(r=>{t?this.renderer.addClass(this.element.nativeElement,r):this.renderer.removeClass(this.element.nativeElement,r)}),t&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(t))})}isLinkActive(t){const r=function s8(e){return!!e.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return i=>!!i.urlTree&&t.isActive(i.urlTree,r)}hasActiveLinks(){const t=this.isLinkActive(this.router);return this.link&&t(this.link)||this.links.some(t)}}return e.\u0275fac=function(t){return new(t||e)(wt(qh),wt(Yo),wt(Ju),wt(Sd),wt(kb,8))},e.\u0275dir=Mn({type:e,selectors:[["","routerLinkActive",""]],contentQueries:function(t,r,i){if(1&t&&function Ka(e,n,t,r){const i=Li();if(i.firstCreatePass){const s=ks();dN(i,new uN(n,t,r),s.index),function d5(e,n){const t=e.contentQueries||(e.contentQueries=[]);n!==(t.length?t[t.length-1]:-1)&&t.push(e.queries.length-1,n)}(i,e),2==(2&t)&&(i.staticContentQueries=!0)}hN(i,cn(),t)}(i,kb,5),2&t){let s;As(s=Ns())&&(r.links=s)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[Ce]}),e})();class lR{}let a8=(()=>{class e{constructor(t,r,i,s,d){this.router=t,this.injector=i,this.preloadingStrategy=s,this.loader=d}setUpPreloading(){this.subscription=this.router.events.pipe(Su(t=>t instanceof tm),fv(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,r){const i=[];for(const s of r){s.providers&&!s._injector&&(s._injector=qC(s.providers,t,`Route: ${s.path}`));const d=s._injector??t,m=s._loadedInjector??d;(s.loadChildren&&!s._loadedRoutes&&void 0===s.canLoad||s.loadComponent&&!s._loadedComponent)&&i.push(this.preloadConfig(d,s)),(s.children||s._loadedRoutes)&&i.push(this.processRoutes(m,s.children??s._loadedRoutes))}return ws(i).pipe(Fi())}preloadConfig(t,r){return this.preloadingStrategy.preload(r,()=>{let i;i=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(t,r):Rn(null);const s=i.pipe(Ps(d=>null===d?Rn(void 0):(r._loadedRoutes=d.routes,r._loadedInjector=d.injector,this.processRoutes(d.injector??t,d.routes))));return r.loadComponent&&!r._loadedComponent?ws([s,this.loader.loadComponent(r)]).pipe(Fi()):s})}}return e.\u0275fac=function(t){return new(t||e)(jn(qh),jn(PN),jn(hh),jn(lR),jn(SD))},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const DD=new wr("");let uR=(()=>{class e{constructor(t,r,i,s,d={}){this.urlSerializer=t,this.transitions=r,this.viewportScroller=i,this.zone=s,this.options=d,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},d.scrollPositionRestoration=d.scrollPositionRestoration||"disabled",d.anchorScrolling=d.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof dD?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof tm?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof bv&&0===t.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof O2&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new O2(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return e.\u0275fac=function(t){!function Vp(){throw new Error("invalid")}()},e.\u0275prov=Gn({token:e,factory:e.\u0275fac}),e})();function Wf(e,n){return{\u0275kind:e,\u0275providers:n}}function hR(){const e=Vn(wu);return n=>{const t=e.get(Hp);if(n!==t.components[0])return;const r=e.get(qh),i=e.get(dR);1===e.get(TD)&&r.initialNavigation(),e.get(fR,null,Kn.Optional)?.setUpPreloading(),e.get(DD,null,Kn.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}const dR=new wr("",{factory:()=>new It}),TD=new wr("",{providedIn:"root",factory:()=>1}),fR=new wr("");function h8(e){return Wf(0,[{provide:fR,useExisting:a8},{provide:lR,useExisting:e}])}const pR=new wr("ROUTER_FORROOT_GUARD"),f8=[AS,{provide:mv,useClass:aD},qh,wv,{provide:B_,useFactory:function cR(e){return e.routerState.root},deps:[qh]},SD,[]];function p8(){return new GN("Router",qh)}let Fb=(()=>{class e{constructor(t){}static forRoot(t,r){return{ngModule:e,providers:[f8,[],{provide:j_,multi:!0,useValue:t},{provide:pR,useFactory:y8,deps:[[qh,new yg,new Pm]]},{provide:Lb,useValue:r||{}},r?.useHash?{provide:Wp,useClass:yP}:{provide:Wp,useClass:_P},{provide:DD,useFactory:()=>{const e=Vn(WU),n=Vn(ds),t=Vn(Lb),r=Vn(Ob),i=Vn(mv);return t.scrollOffset&&e.setOffset(t.scrollOffset),new uR(i,r,e,n,t)}},r?.preloadingStrategy?h8(r.preloadingStrategy).\u0275providers:[],{provide:GN,multi:!0,useFactory:p8},r?.initialNavigation?v8(r):[],r?.bindToComponentInputs?Wf(8,[U2,{provide:Mb,useExisting:U2}]).\u0275providers:[],[{provide:gR,useFactory:hR},{provide:yS,multi:!0,useExisting:gR}]]}}static forChild(t){return{ngModule:e,providers:[{provide:j_,multi:!0,useValue:t}]}}}return e.\u0275fac=function(t){return new(t||e)(jn(pR,8))},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})();function y8(e){return"guarded"}function v8(e){return["disabled"===e.initialNavigation?Wf(3,[{provide:cS,multi:!0,useFactory:()=>{const n=Vn(qh);return()=>{n.setUpLocationChangeListener()}}},{provide:TD,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?Wf(2,[{provide:TD,useValue:0},{provide:cS,multi:!0,deps:[wu],useFactory:n=>{const t=n.get(IV,Promise.resolve());return()=>t.then(()=>new Promise(r=>{const i=n.get(qh),s=n.get(dR);sR(i,()=>{r(!0)}),n.get(Ob).afterPreactivation=()=>(r(!0),s.closed?Rn(void 0):s),i.initialNavigation()}))}}]).\u0275providers:[]]}const gR=new wr("");let b8=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Bi({type:e,selectors:[["app-about"]],decls:36,vars:0,consts:[[1,"container","mt-4"],[1,"text-primary"],[1,"list-group"],[1,"list-group-item"]],template:function(t,r){1&t&&(Un(0,"div",0)(1,"h2",1),ui(2,"Seeking a challenging position within an organization wherein I could showcase my technical expertise and contribute to company\u2019s success"),Jn(),za(3,"hr"),Un(4,"h3",1),ui(5,"AT A GLANCE"),Jn(),Un(6,"ul",2)(7,"li",3),ui(8,"Experience of 10+ Years as a UI/Web Developer."),Jn(),Un(9,"li",3),ui(10,"Currently working as a Senior Angular/UI Developer at Insight."),Jn(),Un(11,"li",3),ui(12,"Expertise in several programming Languages/Tools/Frameworks:"),Jn(),Un(13,"ul",2)(14,"li",3),ui(15,"Angular 2/12+, NgRx, RxJS, Javascript, ES6, Typescript, Vue, Vuex, Html 5, Responsive Web Development, Microsoft Excel Javascript API, Css3, LESS/SASS, Flexbox, Bootstrap 3, Jquery, HandlebarJs, KnockoutJs, BackboneJs, Karma, Jasmine, Docker, REST APIs, AJAX, JSON, Core Java, Angular CLI, Adobe CQ5, AEM, Grunt, NPM, Git, SVN, Bitbucket, Photoshop, Animate CSS."),Jn()(),Un(16,"li",3),ui(17,"Working extensively with Onsite-Offshore, where in the main responsibilities include interacting with client and understanding the requirements for development of web-based applications with rich user interfaces components in Angular."),Jn(),Un(18,"li",3),ui(19,"Created and developed Front-end UI framework used by teams on HomeDepot, B2B. Assurant, MCD, CARM E2E HSBC, Hershey\u2019s Applications & T-Mobile, GSK, Pfizer, Applications."),Jn(),Un(20,"li",3),ui(21,"Involved in Estimates, Story walkthrough & Code Review."),Jn(),Un(22,"li",3),ui(23,"Angular Trainer/Ramping-Up of the resources onboarded to the project."),Jn(),Un(24,"li",3),ui(25,"Mentored Front-end developers on UI development best practices."),Jn(),Un(26,"li",3),ui(27,"Implemented pre-build tasks for JavaScript, HTML and CSS files to ensure code compliance, web standards and code optimized for production."),Jn(),Un(28,"li",3),ui(29,"Worked in many projects and phases of SDLC/Agile/Kanban."),Jn(),Un(30,"li",3),ui(31,"Strong Object Oriented Concepts & 3-Tier Architecture."),Jn(),Un(32,"li",3),ui(33,"A quick learner ready to learn new technologies."),Jn(),Un(34,"li",3),ui(35,"Have good communication skills as well as interpersonal skills."),Jn()()())},styles:[".container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}h2[_ngcontent-%COMP%]{text-align:center}hr[_ngcontent-%COMP%]{border-top:2px solid #007bff}.list-group[_ngcontent-%COMP%]{margin-top:20px}.list-group-item[_ngcontent-%COMP%]{background-color:#f8f9fa;color:#212529;border-color:#007bff}.lead[_ngcontent-%COMP%]{font-size:1.2rem;color:#6c757d;font-style:italic}"]}),e})();function mR(e,n,t,r,i,s,d){try{var m=e[s](d),v=m.value}catch(w){return void t(w)}m.done?n(v):Promise.resolve(v).then(r,i)}function Bb(e){return function(){var n=this,t=arguments;return new Promise(function(r,i){var s=e.apply(n,t);function d(v){mR(s,r,i,d,m,"next",v)}function m(v){mR(s,r,i,d,m,"throw",v)}d(void 0)})}}var zb=qe(2574);const Vb_mapbox_accessToken="pk.eyJ1IjoiYW1pcnJlc2hpIiwiYSI6ImNsazNrdjk5MTAzOWEzb3J5OGl3M2RieXQifQ.v8wu8rkdjtneC55UE5eSrA";let w8=(()=>{class e{constructor(t){this.elementRef=t}ngOnInit(){this.initializeMap(),this.buildMap()}initializeMap(){this.start=[-122.662324,45.523696],this.newEnd=[-122.61597,45.537218]}setEnd(t){const r={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:t}}]};this.map.getLayer("end")?this.map.getSource("end").setData(r):this.map.addLayer({id:"end",type:"circle",source:{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:t}}]}},paint:{"circle-radius":10,"circle-color":"#f30"}})}buildMap(){this.map=new zb.Map({accessToken:Vb_mapbox_accessToken,container:"map",style:"mapbox://styles/mapbox/streets-v12",center:[-122.65987585271547,45.52324468315331],zoom:12}),this.map.on("load",()=>{this.getRoute(this.start),this.map.addLayer({id:"point",type:"circle",source:{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:this.start}}]}},paint:{"circle-radius":10,"circle-color":"#3887be"}}),this.map.on("click",t=>{const r=t.lngLat,i=Object.keys(r).map(s=>r[s]);this.setEnd(i),this.getRoute(i)})})}loadMap(){}getRoute(t){var r=this;return Bb(function*(){const v={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:(yield(yield fetch(`https://api.mapbox.com/directions/v5/mapbox/cycling/${r.start[0]},${r.start[1]};${t[0]},${t[1]}?steps=true&geometries=geojson&access_token=${Vb_mapbox_accessToken}`,{method:"GET"})).json()).routes[0].geometry.coordinates}};r.map.getSource("route")?r.map.getSource("route").setData(v):r.map.addLayer({id:"route",type:"line",source:{type:"geojson",data:v},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3887be","line-width":5,"line-opacity":.75}})})()}simulateMapClick(){this.map.fire("click",{lngLat:this.newEnd})}}return e.\u0275fac=function(t){return new(t||e)(wt(Yo))},e.\u0275cmp=Bi({type:e,selectors:[["app-map"]],decls:4,vars:0,consts:[["id","map",1,"match-parent"],["id","amir",3,"click"],["id","instructions"]],template:function(t,r){1&t&&(za(0,"div",0),Un(1,"button",1),$i("click",function(){return r.simulateMapClick()}),ui(2,"draw route"),Jn(),za(3,"div",2))},styles:['#map[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:100%}.match-parent[_ngcontent-%COMP%]{width:100%;height:100%}button[_ngcontent-%COMP%]{position:absolute;margin:20px}#pause[_ngcontent-%COMP%]:after{content:"Pause"}#pause.pause[_ngcontent-%COMP%]:after{content:"Play"}']}),e})();var wc=6371008.8,_R={centimeters:100*wc,centimetres:100*wc,degrees:wc/111325,feet:3.28084*wc,inches:39.37*wc,kilometers:wc/1e3,kilometres:wc/1e3,meters:wc,metres:wc,miles:wc/1609.344,millimeters:1e3*wc,millimetres:1e3*wc,nauticalmiles:wc/1852,radians:1,yards:1.0936*wc};function Zf(e,n,t){void 0===t&&(t={});var r={type:"Feature"};return(0===t.id||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=n||{},r.geometry=e,r}function nm(e,n,t){if(void 0===t&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!AD(e[0])||!AD(e[1]))throw new Error("coordinates must contain numbers");return Zf({type:"Point",coordinates:e},n,t)}function Ub(e,n,t){void 0===t&&(t={});for(var r=0,i=e;r<i.length;r++){var s=i[r];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var d=0;d<s[s.length-1].length;d++)if(s[s.length-1][d]!==s[0][d])throw new Error("First and last Position are not equivalent.")}return Zf({type:"Polygon",coordinates:e},n,t)}function Mv(e,n,t){if(void 0===t&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return Zf({type:"LineString",coordinates:e},n,t)}function jb(e){return e%(2*Math.PI)*180/Math.PI}function Md(e){return e%360*Math.PI/180}function AD(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function Av(e,n,t){if(null!==e)for(var r,i,s,d,m,v,w,O,D=0,N=0,k=e.type,Q="FeatureCollection"===k,X="Feature"===k,_e=Q?e.features.length:1,le=0;le<_e;le++){m=(O=!!(w=Q?e.features[le].geometry:X?e.geometry:e)&&"GeometryCollection"===w.type)?w.geometries.length:1;for(var K=0;K<m;K++){var me=0,$e=0;if(null!==(d=O?w.geometries[K]:w)){v=d.coordinates;var Ze=d.type;switch(D=!t||"Polygon"!==Ze&&"MultiPolygon"!==Ze?0:1,Ze){case null:break;case"Point":if(!1===n(v,N,le,me,$e))return!1;N++,me++;break;case"LineString":case"MultiPoint":for(r=0;r<v.length;r++){if(!1===n(v[r],N,le,me,$e))return!1;N++,"MultiPoint"===Ze&&me++}"LineString"===Ze&&me++;break;case"Polygon":case"MultiLineString":for(r=0;r<v.length;r++){for(i=0;i<v[r].length-D;i++){if(!1===n(v[r][i],N,le,me,$e))return!1;N++}"MultiLineString"===Ze&&me++,"Polygon"===Ze&&$e++}"Polygon"===Ze&&me++;break;case"MultiPolygon":for(r=0;r<v.length;r++){for($e=0,i=0;i<v[r].length;i++){for(s=0;s<v[r][i].length-D;s++){if(!1===n(v[r][i][s],N,le,me,$e))return!1;N++}$e++}me++}break;case"GeometryCollection":for(r=0;r<d.geometries.length;r++)if(!1===Av(d.geometries[r],n,t))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Gb(e,n){!function bR(e,n){var t,r,i,s,d,m,v,w,D,N,O=0,k="FeatureCollection"===e.type,Q="Feature"===e.type,X=k?e.features.length:1;for(t=0;t<X;t++){for(w=k?e.features[t].properties:Q?e.properties:{},D=k?e.features[t].bbox:Q?e.bbox:void 0,N=k?e.features[t].id:Q?e.id:void 0,d=(v=!!(m=k?e.features[t].geometry:Q?e.geometry:e)&&"GeometryCollection"===m.type)?m.geometries.length:1,i=0;i<d;i++)if(null!==(s=v?m.geometries[i]:m))switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===n(s,O,w,D,N))return!1;break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===n(s.geometries[r],O,w,D,N))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===n(null,O,w,D,N))return!1;O++}}(e,function(t,r,i,s,d){var v,m=null===t?null:t.type;switch(m){case null:case"Point":case"LineString":case"Polygon":return!1!==n(Zf(t,i,{bbox:s,id:d}),r,0)&&void 0}switch(m){case"MultiPoint":v="Point";break;case"MultiLineString":v="LineString";break;case"MultiPolygon":v="Polygon"}for(var w=0;w<t.coordinates.length;w++)if(!1===n(Zf({type:v,coordinates:t.coordinates[w]},i),r,w))return!1})}function ND(e){var n=[1/0,1/0,-1/0,-1/0];return Av(e,function(t){n[0]>t[0]&&(n[0]=t[0]),n[1]>t[1]&&(n[1]=t[1]),n[2]<t[0]&&(n[2]=t[0]),n[3]<t[1]&&(n[3]=t[1])}),n}ND.default=ND;const N8=ND;function G_(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function wR(e){return"Feature"===e.type?e.geometry:e}function DR(e,n,t){if(void 0===t&&(t={}),!e)throw new Error("point is required");if(!n)throw new Error("polygon is required");var r=G_(e),i=wR(n),s=i.type,d=n.bbox,m=i.coordinates;if(d&&!1===function G8(e,n){return n[0]<=e[0]&&n[1]<=e[1]&&n[2]>=e[0]&&n[3]>=e[1]}(r,d))return!1;"Polygon"===s&&(m=[m]);for(var v=!1,w=0;w<m.length&&!v;w++)if(TR(r,m[w][0],t.ignoreBoundary)){for(var D=!1,N=1;N<m[w].length&&!D;)TR(r,m[w][N],!t.ignoreBoundary)&&(D=!0),N++;D||(v=!0)}return v}function TR(e,n,t){var r=!1;n[0][0]===n[n.length-1][0]&&n[0][1]===n[n.length-1][1]&&(n=n.slice(0,n.length-1));for(var i=0,s=n.length-1;i<n.length;s=i++){var d=n[i][0],m=n[i][1],v=n[s][0],w=n[s][1];if(e[1]*(d-v)+m*(v-e[0])+w*(e[0]-d)==0&&(d-e[0])*(v-e[0])<=0&&(m-e[1])*(w-e[1])<=0)return!t;m>e[1]!=w>e[1]&&e[0]<(v-d)*(e[1]-m)/(w-m)+d&&(r=!r)}return r}qe(4772),qe(3664);const IR=function $8(e,n,t){void 0===t&&(t={});var r=G_(e),i=G_(n),s=Md(i[1]-r[1]),d=Md(i[0]-r[0]),m=Md(r[1]),v=Md(i[1]),w=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(d/2),2)*Math.cos(m)*Math.cos(v);return function xR(e,n){void 0===n&&(n="kilometers");var t=_R[n];if(!t)throw new Error(n+" units is invalid");return e*t}(2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w)),t.units)};var AR=new ArrayBuffer(16);new Float64Array(AR),new Uint32Array(AR),qe(7861),function(){function e(n){this.points=n.points||[],this.duration=n.duration||1e4,this.sharpness=n.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=n.stepLength||60,this.length=this.points.length,this.delay=0;for(var t=0;t<this.length;t++)this.points[t].z=this.points[t].z||0;for(t=0;t<this.length-1;t++){var r=this.points[t],i=this.points[t+1];this.centers.push({x:(r.x+i.x)/2,y:(r.y+i.y)/2,z:(r.z+i.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),t=0;t<this.centers.length-1;t++){var s=this.points[t+1].x-(this.centers[t].x+this.centers[t+1].x)/2,d=this.points[t+1].y-(this.centers[t].y+this.centers[t+1].y)/2,m=this.points[t+1].z-(this.centers[t].y+this.centers[t+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[t+1].x+this.sharpness*(this.centers[t].x+s),y:(1-this.sharpness)*this.points[t+1].y+this.sharpness*(this.centers[t].y+d),z:(1-this.sharpness)*this.points[t+1].z+this.sharpness*(this.centers[t].z+m)},{x:(1-this.sharpness)*this.points[t+1].x+this.sharpness*(this.centers[t+1].x+s),y:(1-this.sharpness)*this.points[t+1].y+this.sharpness*(this.centers[t+1].y+d),z:(1-this.sharpness)*this.points[t+1].z+this.sharpness*(this.centers[t+1].z+m)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}e.prototype.cacheSteps=function(n){var t=[],r=this.pos(0);t.push(0);for(var i=0;i<this.duration;i+=10){var s=this.pos(i);Math.sqrt((s.x-r.x)*(s.x-r.x)+(s.y-r.y)*(s.y-r.y)+(s.z-r.z)*(s.z-r.z))>n&&(t.push(i),r=s)}return t},e.prototype.vector=function(n){var t=this.pos(n+10),r=this.pos(n-10);return{angle:180*Math.atan2(t.y-r.y,t.x-r.x)/3.14,speed:Math.sqrt((r.x-t.x)*(r.x-t.x)+(r.y-t.y)*(r.y-t.y)+(r.z-t.z)*(r.z-t.z))}},e.prototype.pos=function(n){var t=n-this.delay;t<0&&(t=0),t>this.duration&&(t=this.duration-1);var r=t/this.duration;if(r>=1)return this.points[this.length-1];var i=Math.floor((this.points.length-1)*r);return function s$(e,n,t,r,i){var s=function a$(e){var n=e*e;return[n*e,3*n*(1-e),3*e*(1-e)*(1-e),(1-e)*(1-e)*(1-e)]}(e);return{x:i.x*s[0]+r.x*s[1]+t.x*s[2]+n.x*s[3],y:i.y*s[0]+r.y*s[1]+t.y*s[2]+n.y*s[3],z:i.z*s[0]+r.z*s[1]+t.z*s[2]+n.z*s[3]}}((this.length-1)*r-i,this.points[i],this.controls[i][1],this.controls[i+1][0],this.points[i+1])}}();function d$(e,n,t,r){void 0===r&&(r={});var i=G_(e),s=Md(i[0]),d=Md(i[1]),m=Md(t),v=function MD(e,n){void 0===n&&(n="kilometers");var t=_R[n];if(!t)throw new Error(n+" units is invalid");return e/t}(n,r.units),w=Math.asin(Math.sin(d)*Math.cos(v)+Math.cos(d)*Math.sin(v)*Math.cos(m));return nm([jb(s+Math.atan2(Math.sin(m)*Math.sin(v)*Math.cos(d),Math.cos(v)-Math.sin(d)*Math.sin(w))),jb(w)],r.properties)}function kR(e,n,t){if(void 0===t&&(t={}),!0===t.final)return function f$(e,n){var t=kR(n,e);return t=(t+180)%360}(e,n);var r=G_(e),i=G_(n),s=Md(r[0]),d=Md(i[0]),m=Md(r[1]),v=Md(i[1]),w=Math.sin(d-s)*Math.cos(v),D=Math.cos(m)*Math.sin(v)-Math.sin(m)*Math.cos(v)*Math.cos(d-s);return jb(Math.atan2(w,D))}qe(9145),qe(5665);var ZR=Math.PI/180,XR=180/Math.PI,Rv=function(e,n){this.lon=e,this.lat=n,this.x=ZR*e,this.y=ZR*n};Rv.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},Rv.prototype.antipode=function(){return new Rv(this.lon<0?180+this.lon:-1*(180-this.lon),-1*this.lat)};var YR=function(){this.coords=[],this.length=0};YR.prototype.move_to=function(e){this.length++,this.coords.push(e)};var zD=function(e){this.properties=e||{},this.geometries=[]};zD.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var e=[],n=0;n<this.geometries.length;n++)e.push(this.geometries[n].coords);return{geometry:{type:"MultiLineString",coordinates:e},type:"Feature",properties:this.properties}},zD.prototype.wkt=function(){for(var e="",n="LINESTRING(",t=function(s){n+=s[0]+" "+s[1]+","},r=0;r<this.geometries.length;r++){if(0===this.geometries[r].coords.length)return"LINESTRING(empty)";this.geometries[r].coords.forEach(t),e+=n.substring(0,n.length-1)+")"}return e};var VD=function(e,n,t){if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!n||void 0===n.x||void 0===n.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new Rv(e.x,e.y),this.end=new Rv(n.x,n.y),this.properties=t||{};var r=this.start.x-this.end.x,s=Math.pow(Math.sin((this.start.y-this.end.y)/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(r/2),2);if(this.g=2*Math.asin(Math.sqrt(s)),this.g===Math.PI)throw new Error("it appears "+e.view()+" and "+n.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+e+" and "+n)};VD.prototype.interpolate=function(e){var n=Math.sin((1-e)*this.g)/Math.sin(this.g),t=Math.sin(e*this.g)/Math.sin(this.g),r=n*Math.cos(this.start.y)*Math.cos(this.start.x)+t*Math.cos(this.end.y)*Math.cos(this.end.x),i=n*Math.cos(this.start.y)*Math.sin(this.start.x)+t*Math.cos(this.end.y)*Math.sin(this.end.x),s=n*Math.sin(this.start.y)+t*Math.sin(this.end.y),d=XR*Math.atan2(s,Math.sqrt(Math.pow(r,2)+Math.pow(i,2)));return[XR*Math.atan2(i,r),d]},VD.prototype.Arc=function(e,n){var t=[];if(!e||e<=2)t.push([this.start.lon,this.start.lat]),t.push([this.end.lon,this.end.lat]);else for(var r=1/(e-1),i=0;i<e;++i){var d=this.interpolate(r*i);t.push(d)}for(var m=!1,v=0,w=n&&n.offset?n.offset:10,D=180-w,N=-180+w,O=360-w,k=1;k<t.length;++k){var Q=t[k-1][0],X=t[k][0],_e=Math.abs(X-Q);_e>O&&(X>D&&Q<N||Q>D&&X<N)?m=!0:_e>v&&(v=_e)}var le=[];if(m&&v<w){var K=[];le.push(K);for(var me=0;me<t.length;++me){var $e=parseFloat(t[me][0]);if(me>0&&Math.abs($e-t[me-1][0])>O){var Ze=parseFloat(t[me-1][0]),gt=parseFloat(t[me-1][1]),_t=parseFloat(t[me][0]),St=parseFloat(t[me][1]);if(Ze>-180&&Ze<N&&180===_t&&me+1<t.length&&t[me-1][0]>-180&&t[me-1][0]<N){K.push([-180,t[me][1]]),me++,K.push([t[me][0],t[me][1]]);continue}if(Ze>D&&Ze<180&&-180===_t&&me+1<t.length&&t[me-1][0]>D&&t[me-1][0]<180){K.push([180,t[me][1]]),me++,K.push([t[me][0],t[me][1]]);continue}if(Ze<N&&_t>D){var Ye=Ze;Ze=_t,_t=Ye;var Qn=gt;gt=St,St=Qn}if(Ze>D&&_t<N&&(_t+=360),Ze<=180&&_t>=180&&Ze<_t){var Fn=(180-Ze)/(_t-Ze),Tr=Fn*St+(1-Fn)*gt;K.push([t[me-1][0]>D?180:-180,Tr]),(K=[]).push([t[me-1][0]>D?-180:180,Tr]),le.push(K)}else le.push(K=[]);K.push([$e,t[me][1]])}else K.push([t[me][0],t[me][1]])}}else{var Ir=[];le.push(Ir);for(var An=0;An<t.length;++An)Ir.push([t[An][0],t[An][1]])}for(var yr=new zD(this.properties),Xn=0;Xn<le.length;++Xn){var _i=new YR;yr.geometries.push(_i);for(var zi=le[Xn],ri=0;ri<zi.length;++ri)_i.move_to(zi[ri])}return yr},qe(3970);var Hi=[],qi=[],Wi=[],Zi=[],Xi=[],Yi=[],Ki=[],Ji=[],Qi=[],eo=[],to=[],no=[],ro=[],io=[],oo=[],so=[],ao=[],lo=[],uo=[],co=[],ho=[],fo=[],po=[],go=[];Ki[85]=eo[85]=-1,Ji[85]=to[85]=0,Qi[85]=no[85]=1,uo[85]=fo[85]=1,co[85]=po[85]=0,ho[85]=go[85]=1,Hi[85]=Zi[85]=0,qi[85]=Xi[85]=-1,Wi[85]=oo[85]=0,so[85]=ro[85]=0,ao[85]=io[85]=1,Yi[85]=lo[85]=1,fo[1]=fo[169]=0,po[1]=po[169]=-1,go[1]=go[169]=0,ro[1]=ro[169]=-1,io[1]=io[169]=0,oo[1]=oo[169]=0,eo[4]=eo[166]=0,to[4]=to[166]=-1,no[4]=no[166]=1,so[4]=so[166]=1,ao[4]=ao[166]=0,lo[4]=lo[166]=0,Ki[16]=Ki[154]=0,Ji[16]=Ji[154]=1,Qi[16]=Qi[154]=1,Zi[16]=Zi[154]=1,Xi[16]=Xi[154]=0,Yi[16]=Yi[154]=1,uo[64]=uo[106]=0,co[64]=co[106]=1,ho[64]=ho[106]=0,Hi[64]=Hi[106]=-1,qi[64]=qi[106]=0,Wi[64]=Wi[106]=1,uo[2]=uo[168]=0,co[2]=co[168]=-1,ho[2]=ho[168]=1,fo[2]=fo[168]=0,po[2]=po[168]=-1,go[2]=go[168]=0,ro[2]=ro[168]=-1,io[2]=io[168]=0,oo[2]=oo[168]=0,so[2]=so[168]=-1,ao[2]=ao[168]=0,lo[2]=lo[168]=1,Ki[8]=Ki[162]=0,Ji[8]=Ji[162]=-1,Qi[8]=Qi[162]=0,eo[8]=eo[162]=0,to[8]=to[162]=-1,no[8]=no[162]=1,ro[8]=ro[162]=1,io[8]=io[162]=0,oo[8]=oo[162]=1,so[8]=so[162]=1,ao[8]=ao[162]=0,lo[8]=lo[162]=0,Ki[32]=Ki[138]=0,Ji[32]=Ji[138]=1,Qi[32]=Qi[138]=1,eo[32]=eo[138]=0,to[32]=to[138]=1,no[32]=no[138]=0,Hi[32]=Hi[138]=1,qi[32]=qi[138]=0,Wi[32]=Wi[138]=0,Zi[32]=Zi[138]=1,Xi[32]=Xi[138]=0,Yi[32]=Yi[138]=1,fo[128]=fo[42]=0,po[128]=po[42]=1,go[128]=go[42]=1,uo[128]=uo[42]=0,co[128]=co[42]=1,ho[128]=ho[42]=0,Hi[128]=Hi[42]=-1,qi[128]=qi[42]=0,Wi[128]=Wi[42]=1,Zi[128]=Zi[42]=-1,Xi[128]=Xi[42]=0,Yi[128]=Yi[42]=0,eo[5]=eo[165]=-1,to[5]=to[165]=0,no[5]=no[165]=0,fo[5]=fo[165]=1,po[5]=po[165]=0,go[5]=go[165]=0,so[20]=so[150]=0,ao[20]=ao[150]=1,lo[20]=lo[150]=1,Zi[20]=Zi[150]=0,Xi[20]=Xi[150]=-1,Yi[20]=Yi[150]=1,Ki[80]=Ki[90]=-1,Ji[80]=Ji[90]=0,Qi[80]=Qi[90]=1,uo[80]=uo[90]=1,co[80]=co[90]=0,ho[80]=ho[90]=1,ro[65]=ro[105]=0,io[65]=io[105]=1,oo[65]=oo[105]=0,Hi[65]=Hi[105]=0,qi[65]=qi[105]=-1,Wi[65]=Wi[105]=0,Ki[160]=Ki[10]=-1,Ji[160]=Ji[10]=0,Qi[160]=Qi[10]=1,eo[160]=eo[10]=-1,to[160]=to[10]=0,no[160]=no[10]=0,fo[160]=fo[10]=1,po[160]=po[10]=0,go[160]=go[10]=0,uo[160]=uo[10]=1,co[160]=co[10]=0,ho[160]=ho[10]=1,so[130]=so[40]=0,ao[130]=ao[40]=1,lo[130]=lo[40]=1,ro[130]=ro[40]=0,io[130]=io[40]=1,oo[130]=oo[40]=0,Hi[130]=Hi[40]=0,qi[130]=qi[40]=-1,Wi[130]=Wi[40]=0,Zi[130]=Zi[40]=0,Xi[130]=Xi[40]=-1,Yi[130]=Yi[40]=1,eo[37]=eo[133]=0,to[37]=to[133]=1,no[37]=no[133]=1,fo[37]=fo[133]=0,po[37]=po[133]=1,go[37]=go[133]=0,Hi[37]=Hi[133]=-1,qi[37]=qi[133]=0,Wi[37]=Wi[133]=0,Zi[37]=Zi[133]=1,Xi[37]=Xi[133]=0,Yi[37]=Yi[133]=0,so[148]=so[22]=-1,ao[148]=ao[22]=0,lo[148]=lo[22]=0,fo[148]=fo[22]=0,po[148]=po[22]=-1,go[148]=go[22]=1,uo[148]=uo[22]=0,co[148]=co[22]=1,ho[148]=ho[22]=1,Zi[148]=Zi[22]=-1,Xi[148]=Xi[22]=0,Yi[148]=Yi[22]=1,Ki[82]=Ki[88]=0,Ji[82]=Ji[88]=-1,Qi[82]=Qi[88]=1,so[82]=so[88]=1,ao[82]=ao[88]=0,lo[82]=lo[88]=1,ro[82]=ro[88]=-1,io[82]=io[88]=0,oo[82]=oo[88]=1,uo[82]=uo[88]=0,co[82]=co[88]=-1,ho[82]=ho[88]=0,Ki[73]=Ki[97]=0,Ji[73]=Ji[97]=1,Qi[73]=Qi[97]=0,eo[73]=eo[97]=0,to[73]=to[97]=-1,no[73]=no[97]=0,ro[73]=ro[97]=1,io[73]=io[97]=0,oo[73]=oo[97]=0,Hi[73]=Hi[97]=1,qi[73]=qi[97]=0,Wi[73]=Wi[97]=1,Ki[145]=Ki[25]=0,Ji[145]=Ji[25]=-1,Qi[145]=Qi[25]=0,ro[145]=ro[25]=1,io[145]=io[25]=0,oo[145]=oo[25]=1,fo[145]=fo[25]=0,po[145]=po[25]=1,go[145]=go[25]=1,Zi[145]=Zi[25]=-1,Xi[145]=Xi[25]=0,Yi[145]=Yi[25]=0,eo[70]=eo[100]=0,to[70]=to[100]=1,no[70]=no[100]=0,so[70]=so[100]=-1,ao[70]=ao[100]=0,lo[70]=lo[100]=1,uo[70]=uo[100]=0,co[70]=co[100]=-1,ho[70]=ho[100]=1,Hi[70]=Hi[100]=1,qi[70]=qi[100]=0,Wi[70]=Wi[100]=0,eo[101]=eo[69]=0,to[101]=to[69]=1,no[101]=no[69]=0,Hi[101]=Hi[69]=1,qi[101]=qi[69]=0,Wi[101]=Wi[69]=0,fo[149]=fo[21]=0,po[149]=po[21]=1,go[149]=go[21]=1,Zi[149]=Zi[21]=-1,Xi[149]=Xi[21]=0,Yi[149]=Yi[21]=0,so[86]=so[84]=-1,ao[86]=ao[84]=0,lo[86]=lo[84]=1,uo[86]=uo[84]=0,co[86]=co[84]=-1,ho[86]=ho[84]=1,Ki[89]=Ki[81]=0,Ji[89]=Ji[81]=-1,Qi[89]=Qi[81]=0,ro[89]=ro[81]=1,io[89]=io[81]=0,oo[89]=oo[81]=1,Ki[96]=Ki[74]=0,Ji[96]=Ji[74]=1,Qi[96]=Qi[74]=0,eo[96]=eo[74]=-1,to[96]=to[74]=0,no[96]=no[74]=1,uo[96]=uo[74]=1,co[96]=co[74]=0,ho[96]=ho[74]=0,Hi[96]=Hi[74]=1,qi[96]=qi[74]=0,Wi[96]=Wi[74]=1,Ki[24]=Ki[146]=0,Ji[24]=Ji[146]=-1,Qi[24]=Qi[146]=1,so[24]=so[146]=1,ao[24]=ao[146]=0,lo[24]=lo[146]=1,ro[24]=ro[146]=0,io[24]=io[146]=1,oo[24]=oo[146]=1,Zi[24]=Zi[146]=0,Xi[24]=Xi[146]=-1,Yi[24]=Yi[146]=0,eo[6]=eo[164]=-1,to[6]=to[164]=0,no[6]=no[164]=1,so[6]=so[164]=-1,ao[6]=ao[164]=0,lo[6]=lo[164]=0,fo[6]=fo[164]=0,po[6]=po[164]=-1,go[6]=go[164]=1,uo[6]=uo[164]=1,co[6]=co[164]=0,ho[6]=ho[164]=0,ro[129]=ro[41]=0,io[129]=io[41]=1,oo[129]=oo[41]=1,fo[129]=fo[41]=0,po[129]=po[41]=1,go[129]=go[41]=0,Hi[129]=Hi[41]=-1,qi[129]=qi[41]=0,Wi[129]=Wi[41]=0,Zi[129]=Zi[41]=0,Xi[129]=Xi[41]=-1,Yi[129]=Yi[41]=0,so[66]=so[104]=0,ao[66]=ao[104]=1,lo[66]=lo[104]=0,ro[66]=ro[104]=-1,io[66]=io[104]=0,oo[66]=oo[104]=1,uo[66]=uo[104]=0,co[66]=co[104]=-1,ho[66]=ho[104]=0,Hi[66]=Hi[104]=0,qi[66]=qi[104]=-1,Wi[66]=Wi[104]=1,Ki[144]=Ki[26]=-1,Ji[144]=Ji[26]=0,Qi[144]=Qi[26]=0,fo[144]=fo[26]=1,po[144]=po[26]=0,go[144]=go[26]=1,uo[144]=uo[26]=0,co[144]=co[26]=1,ho[144]=ho[26]=1,Zi[144]=Zi[26]=-1,Xi[144]=Xi[26]=0,Yi[144]=Yi[26]=1,eo[36]=eo[134]=0,to[36]=to[134]=1,no[36]=no[134]=1,so[36]=so[134]=0,ao[36]=ao[134]=1,lo[36]=lo[134]=0,Hi[36]=Hi[134]=0,qi[36]=qi[134]=-1,Wi[36]=Wi[134]=1,Zi[36]=Zi[134]=1,Xi[36]=Xi[134]=0,Yi[36]=Yi[134]=0,Ki[9]=Ki[161]=-1,Ji[9]=Ji[161]=0,Qi[9]=Qi[161]=0,eo[9]=eo[161]=0,to[9]=to[161]=-1,no[9]=no[161]=0,ro[9]=ro[161]=1,io[9]=io[161]=0,oo[9]=oo[161]=0,fo[9]=fo[161]=1,po[9]=po[161]=0,go[9]=go[161]=1,Ki[136]=0,Ji[136]=1,Qi[136]=1,eo[136]=0,to[136]=1,no[136]=0,so[136]=-1,ao[136]=0,lo[136]=1,ro[136]=-1,io[136]=0,oo[136]=0,fo[136]=0,po[136]=-1,go[136]=0,uo[136]=0,co[136]=-1,ho[136]=1,Hi[136]=1,qi[136]=0,Wi[136]=0,Zi[136]=1,Xi[136]=0,Yi[136]=1,Ki[34]=0,Ji[34]=-1,Qi[34]=0,eo[34]=0,to[34]=-1,no[34]=1,so[34]=1,ao[34]=0,lo[34]=0,ro[34]=1,io[34]=0,oo[34]=1,fo[34]=0,po[34]=1,go[34]=1,uo[34]=0,co[34]=1,ho[34]=0,Hi[34]=-1,qi[34]=0,Wi[34]=1,Zi[34]=-1,Xi[34]=0,Yi[34]=0,Ki[35]=0,Ji[35]=1,Qi[35]=1,eo[35]=0,to[35]=-1,no[35]=1,so[35]=1,ao[35]=0,lo[35]=0,ro[35]=-1,io[35]=0,oo[35]=0,fo[35]=0,po[35]=-1,go[35]=0,uo[35]=0,co[35]=1,ho[35]=0,Hi[35]=-1,qi[35]=0,Wi[35]=1,Zi[35]=1,Xi[35]=0,Yi[35]=1,Ki[153]=0,Ji[153]=1,Qi[153]=1,ro[153]=-1,io[153]=0,oo[153]=0,fo[153]=0,po[153]=-1,go[153]=0,Zi[153]=1,Xi[153]=0,Yi[153]=1,eo[102]=0,to[102]=-1,no[102]=1,so[102]=1,ao[102]=0,lo[102]=0,uo[102]=0,co[102]=1,ho[102]=0,Hi[102]=-1,qi[102]=0,Wi[102]=1,Ki[155]=0,Ji[155]=-1,Qi[155]=0,ro[155]=1,io[155]=0,oo[155]=1,fo[155]=0,po[155]=1,go[155]=1,Zi[155]=-1,Xi[155]=0,Yi[155]=0,eo[103]=0,to[103]=1,no[103]=0,so[103]=-1,ao[103]=0,lo[103]=1,uo[103]=0,co[103]=-1,ho[103]=1,Hi[103]=1,qi[103]=0,Wi[103]=0,Ki[152]=0,Ji[152]=1,Qi[152]=1,so[152]=-1,ao[152]=0,lo[152]=1,ro[152]=-1,io[152]=0,oo[152]=0,fo[152]=0,po[152]=-1,go[152]=0,uo[152]=0,co[152]=-1,ho[152]=1,Zi[152]=1,Xi[152]=0,Yi[152]=1,Ki[156]=0,Ji[156]=-1,Qi[156]=1,so[156]=1,ao[156]=0,lo[156]=1,ro[156]=-1,io[156]=0,oo[156]=0,fo[156]=0,po[156]=-1,go[156]=0,uo[156]=0,co[156]=1,ho[156]=1,Zi[156]=-1,Xi[156]=0,Yi[156]=1,Ki[137]=0,Ji[137]=1,Qi[137]=1,eo[137]=0,to[137]=1,no[137]=0,ro[137]=-1,io[137]=0,oo[137]=0,fo[137]=0,po[137]=-1,go[137]=0,Hi[137]=1,qi[137]=0,Wi[137]=0,Zi[137]=1,Xi[137]=0,Yi[137]=1,Ki[139]=0,Ji[139]=1,Qi[139]=1,eo[139]=0,to[139]=-1,no[139]=0,ro[139]=1,io[139]=0,oo[139]=0,fo[139]=0,po[139]=1,go[139]=0,Hi[139]=-1,qi[139]=0,Wi[139]=0,Zi[139]=1,Xi[139]=0,Yi[139]=1,Ki[98]=0,Ji[98]=-1,Qi[98]=0,eo[98]=0,to[98]=-1,no[98]=1,so[98]=1,ao[98]=0,lo[98]=0,ro[98]=1,io[98]=0,oo[98]=1,uo[98]=0,co[98]=1,ho[98]=0,Hi[98]=-1,qi[98]=0,Wi[98]=1,Ki[99]=0,Ji[99]=1,Qi[99]=0,eo[99]=0,to[99]=-1,no[99]=1,so[99]=1,ao[99]=0,lo[99]=0,ro[99]=-1,io[99]=0,oo[99]=1,uo[99]=0,co[99]=-1,ho[99]=0,Hi[99]=1,qi[99]=0,Wi[99]=1,eo[38]=0,to[38]=-1,no[38]=1,so[38]=1,ao[38]=0,lo[38]=0,fo[38]=0,po[38]=1,go[38]=1,uo[38]=0,co[38]=1,ho[38]=0,Hi[38]=-1,qi[38]=0,Wi[38]=1,Zi[38]=-1,Xi[38]=0,Yi[38]=0,eo[39]=0,to[39]=1,no[39]=1,so[39]=-1,ao[39]=0,lo[39]=0,fo[39]=0,po[39]=-1,go[39]=1,uo[39]=0,co[39]=1,ho[39]=0,Hi[39]=-1,qi[39]=0,Wi[39]=1,Zi[39]=1,Xi[39]=0,Yi[39]=0;var $D=function(e){return[[e.bottomleft,0],[0,0],[0,e.leftbottom]]},HD=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0]]},qD=function(e){return[[e.topright,1],[1,1],[1,e.righttop]]},WD=function(e){return[[0,e.lefttop],[0,1],[e.topleft,1]]},ZD=function(e){return[[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop]]},XD=function(e){return[[e.bottomright,0],[e.bottomleft,0],[1,e.righttop],[1,e.rightbottom]]},YD=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.topleft,1],[e.topright,1]]},KD=function(e){return[[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},ar=[],rr=[],Lr=[],Er=[],Yr=[],$r=[],mo=[],bo=[];Er[1]=Yr[1]=18,Er[169]=Yr[169]=18,Lr[4]=rr[4]=12,Lr[166]=rr[166]=12,ar[16]=bo[16]=4,ar[154]=bo[154]=4,$r[64]=mo[64]=22,$r[106]=mo[106]=22,Lr[2]=$r[2]=17,Er[2]=Yr[2]=18,Lr[168]=$r[168]=17,Er[168]=Yr[168]=18,ar[8]=Er[8]=9,rr[8]=Lr[8]=12,ar[162]=Er[162]=9,rr[162]=Lr[162]=12,ar[32]=bo[32]=4,rr[32]=mo[32]=1,ar[138]=bo[138]=4,rr[138]=mo[138]=1,Yr[128]=bo[128]=21,$r[128]=mo[128]=22,Yr[42]=bo[42]=21,$r[42]=mo[42]=22,rr[5]=Yr[5]=14,rr[165]=Yr[165]=14,Lr[20]=bo[20]=6,Lr[150]=bo[150]=6,ar[80]=$r[80]=11,ar[90]=$r[90]=11,Er[65]=mo[65]=3,Er[105]=mo[105]=3,ar[160]=$r[160]=11,rr[160]=Yr[160]=14,ar[10]=$r[10]=11,rr[10]=Yr[10]=14,Lr[130]=bo[130]=6,Er[130]=mo[130]=3,Lr[40]=bo[40]=6,Er[40]=mo[40]=3,rr[101]=mo[101]=1,rr[69]=mo[69]=1,Yr[149]=bo[149]=21,Yr[21]=bo[21]=21,Lr[86]=$r[86]=17,Lr[84]=$r[84]=17,ar[89]=Er[89]=9,ar[81]=Er[81]=9,ar[96]=mo[96]=0,rr[96]=$r[96]=15,ar[74]=mo[74]=0,rr[74]=$r[74]=15,ar[24]=Lr[24]=8,Er[24]=bo[24]=7,ar[146]=Lr[146]=8,Er[146]=bo[146]=7,rr[6]=$r[6]=15,Lr[6]=Yr[6]=16,rr[164]=$r[164]=15,Lr[164]=Yr[164]=16,Er[129]=bo[129]=7,Yr[129]=mo[129]=20,Er[41]=bo[41]=7,Yr[41]=mo[41]=20,Lr[66]=mo[66]=2,Er[66]=$r[66]=19,Lr[104]=mo[104]=2,Er[104]=$r[104]=19,ar[144]=Yr[144]=10,$r[144]=bo[144]=23,ar[26]=Yr[26]=10,$r[26]=bo[26]=23,rr[36]=bo[36]=5,Lr[36]=mo[36]=2,rr[134]=bo[134]=5,Lr[134]=mo[134]=2,ar[9]=Yr[9]=10,rr[9]=Er[9]=13,ar[161]=Yr[161]=10,rr[161]=Er[161]=13,rr[37]=bo[37]=5,Yr[37]=mo[37]=20,rr[133]=bo[133]=5,Yr[133]=mo[133]=20,Lr[148]=Yr[148]=16,$r[148]=bo[148]=23,Lr[22]=Yr[22]=16,$r[22]=bo[22]=23,ar[82]=Lr[82]=8,Er[82]=$r[82]=19,ar[88]=Lr[88]=8,Er[88]=$r[88]=19,ar[73]=mo[73]=0,rr[73]=Er[73]=13,ar[97]=mo[97]=0,rr[97]=Er[97]=13,ar[145]=Er[145]=9,Yr[145]=bo[145]=21,ar[25]=Er[25]=9,Yr[25]=bo[25]=21,rr[70]=mo[70]=1,Lr[70]=$r[70]=17,rr[100]=mo[100]=1,Lr[100]=$r[100]=17,ar[34]=Er[34]=9,rr[34]=Lr[34]=12,Yr[34]=bo[34]=21,$r[34]=mo[34]=22,ar[136]=bo[136]=4,rr[136]=mo[136]=1,Lr[136]=$r[136]=17,Er[136]=Yr[136]=18,ar[35]=bo[35]=4,rr[35]=Lr[35]=12,Er[35]=Yr[35]=18,$r[35]=mo[35]=22,ar[153]=bo[153]=4,Er[153]=Yr[153]=18,rr[102]=Lr[102]=12,$r[102]=mo[102]=22,ar[155]=Er[155]=9,Yr[155]=bo[155]=23,rr[103]=mo[103]=1,Lr[103]=$r[103]=17,ar[152]=bo[152]=4,Lr[152]=$r[152]=17,Er[152]=Yr[152]=18,ar[156]=Lr[156]=8,Er[156]=Yr[156]=18,$r[156]=bo[156]=23,ar[137]=bo[137]=4,rr[137]=mo[137]=1,Er[137]=Yr[137]=18,ar[139]=bo[139]=4,rr[139]=Er[139]=13,Yr[139]=mo[139]=20,ar[98]=Er[98]=9,rr[98]=Lr[98]=12,$r[98]=mo[98]=22,ar[99]=mo[99]=0,rr[99]=Lr[99]=12,Er[99]=$r[99]=19,rr[38]=Lr[38]=12,Yr[38]=bo[38]=21,$r[38]=mo[38]=22,rr[39]=bo[39]=5,Lr[39]=Yr[39]=16,$r[39]=mo[39]=22;var Zn=[];function eT(e,n,t){return function KH(e){return(e>0)-(e<0)||+e}((n[0]-e[0])*(t[1]-n[1])-(t[0]-n[0])*(n[1]-e[1]))}function dO(e,n){return n.geometry.coordinates[0].every(function(t){return DR(nm(t),e)})}Zn[1]=Zn[169]=$D,Zn[4]=Zn[166]=HD,Zn[16]=Zn[154]=qD,Zn[64]=Zn[106]=WD,Zn[168]=Zn[2]=ZD,Zn[162]=Zn[8]=XD,Zn[138]=Zn[32]=YD,Zn[42]=Zn[128]=KD,Zn[5]=Zn[165]=function(e){return[[0,0],[0,e.leftbottom],[1,e.rightbottom],[1,0]]},Zn[20]=Zn[150]=function(e){return[[1,0],[e.bottomright,0],[e.topright,1],[1,1]]},Zn[80]=Zn[90]=function(e){return[[1,1],[1,e.righttop],[0,e.lefttop],[0,1]]},Zn[65]=Zn[105]=function(e){return[[e.bottomleft,0],[0,0],[0,1],[e.topleft,1]]},Zn[160]=Zn[10]=function(e){return[[1,e.righttop],[1,e.rightbottom],[0,e.leftbottom],[0,e.lefttop]]},Zn[130]=Zn[40]=function(e){return[[e.topleft,1],[e.topright,1],[e.bottomright,0],[e.bottomleft,0]]},Zn[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},Zn[101]=Zn[69]=function(e){return[[1,e.rightbottom],[1,0],[0,0],[0,1],[e.topleft,1]]},Zn[149]=Zn[21]=function(e){return[[e.topright,1],[1,1],[1,0],[0,0],[0,e.leftbottom]]},Zn[86]=Zn[84]=function(e){return[[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[1,1]]},Zn[89]=Zn[81]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,1]]},Zn[96]=Zn[74]=function(e){return[[1,e.righttop],[1,e.rightbottom],[0,e.lefttop],[0,1],[e.topleft,1]]},Zn[24]=Zn[146]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[e.topright,1]]},Zn[6]=Zn[164]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop]]},Zn[129]=Zn[41]=function(e){return[[e.topright,1],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topleft,1]]},Zn[66]=Zn[104]=function(e){return[[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1],[e.topleft,1]]},Zn[144]=Zn[26]=function(e){return[[1,1],[1,e.righttop],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},Zn[36]=Zn[134]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[e.topleft,1],[e.topright,1]]},Zn[9]=Zn[161]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,e.leftbottom]]},Zn[37]=Zn[133]=function(e){return[[1,e.rightbottom],[1,0],[0,0],[0,e.leftbottom],[e.topleft,1],[e.topright,1]]},Zn[148]=Zn[22]=function(e){return[[1,1],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},Zn[82]=Zn[88]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1]]},Zn[73]=Zn[97]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,1],[e.topleft,1]]},Zn[145]=Zn[25]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topright,1]]},Zn[70]=Zn[100]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[e.topleft,1]]},Zn[34]=function(e){return[KD(e),XD(e)]},Zn[35]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},Zn[136]=function(e){return[YD(e),ZD(e)]},Zn[153]=function(e){return[qD(e),$D(e)]},Zn[102]=function(e){return[HD(e),WD(e)]},Zn[155]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topright,1]]},Zn[103]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[e.topleft,1]]},Zn[152]=function(e){return[qD(e),ZD(e)]},Zn[156]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},Zn[137]=function(e){return[YD(e),$D(e)]},Zn[139]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topleft,1],[e.topright,1]]},Zn[98]=function(e){return[XD(e),WD(e)]},Zn[99]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1],[e.topleft,1]]},Zn[38]=function(e){return[HD(e),KD(e)]},Zn[39]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]};const fO=function(){function e(n){this.id=e.buildId(n),this.coordinates=n,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return e.buildId=function(n){return n.join(",")},e.prototype.removeInnerEdge=function(n){this.innerEdges=this.innerEdges.filter(function(t){return t.from.id!==n.from.id})},e.prototype.removeOuterEdge=function(n){this.outerEdges=this.outerEdges.filter(function(t){return t.to.id!==n.to.id})},e.prototype.addOuterEdge=function(n){this.outerEdges.push(n),this.outerEdgesSorted=!1},e.prototype.sortOuterEdges=function(){var n=this;this.outerEdgesSorted||(this.outerEdges.sort(function(t,r){var i=t.to,s=r.to;if(i.coordinates[0]-n.coordinates[0]>=0&&s.coordinates[0]-n.coordinates[0]<0)return 1;if(i.coordinates[0]-n.coordinates[0]<0&&s.coordinates[0]-n.coordinates[0]>=0)return-1;if(i.coordinates[0]-n.coordinates[0]==0&&s.coordinates[0]-n.coordinates[0]==0)return i.coordinates[1]-n.coordinates[1]>=0||s.coordinates[1]-n.coordinates[1]>=0?i.coordinates[1]-s.coordinates[1]:s.coordinates[1]-i.coordinates[1];var d=eT(n.coordinates,i.coordinates,s.coordinates);return d<0?1:d>0?-1:Math.pow(i.coordinates[0]-n.coordinates[0],2)+Math.pow(i.coordinates[1]-n.coordinates[1],2)-(Math.pow(s.coordinates[0]-n.coordinates[0],2)+Math.pow(s.coordinates[1]-n.coordinates[1],2))}),this.outerEdgesSorted=!0)},e.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},e.prototype.getOuterEdge=function(n){return this.sortOuterEdges(),this.outerEdges[n]},e.prototype.addInnerEdge=function(n){this.innerEdges.push(n)},e}(),nq=function(){function e(n,t){this.from=n,this.to=t,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return e.prototype.getSymetric=function(){return this.symetric||(this.symetric=new e(this.to,this.from),this.symetric.symetric=this),this.symetric},e.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},e.prototype.isEqual=function(n){return this.from.id===n.from.id&&this.to.id===n.to.id},e.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},e.prototype.toLineString=function(){return Mv([this.from.coordinates,this.to.coordinates])},e.prototype.compareTo=function(n){return eT(n.from.coordinates,n.to.coordinates,this.to.coordinates)},e}(),iq=function(){function e(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return e.prototype.push=function(n){this.edges.push(n),this.polygon=this.envelope=void 0},e.prototype.get=function(n){return this.edges[n]},Object.defineProperty(e.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),e.prototype.forEach=function(n){this.edges.forEach(n)},e.prototype.map=function(n){return this.edges.map(n)},e.prototype.some=function(n){return this.edges.some(n)},e.prototype.isValid=function(){return!0},e.prototype.isHole=function(){var n=this,t=this.edges.reduce(function(d,m,v){return m.from.coordinates[1]>n.edges[d].from.coordinates[1]&&(d=v),d},0),r=(0===t?this.length:t)-1,i=(t+1)%this.length,s=eT(this.edges[r].from.coordinates,this.edges[t].from.coordinates,this.edges[i].from.coordinates);return 0===s?this.edges[r].from.coordinates[0]>this.edges[i].from.coordinates[0]:s>0},e.prototype.toMultiPoint=function(){return function vR(e,n,t){return void 0===t&&(t={}),Zf({type:"MultiPoint",coordinates:e},n,t)}(this.edges.map(function(n){return n.from.coordinates}))},e.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var n=this.edges.map(function(t){return t.from.coordinates});return n.push(this.edges[0].from.coordinates),this.polygon=Ub([n])},e.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=function c$(e){return function u$(e,n){void 0===n&&(n={});var t=Number(e[0]),r=Number(e[1]),i=Number(e[2]),s=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var d=[t,r];return Ub([[d,[i,r],[i,s],[t,s],d]],n.properties,{bbox:e,id:n.id})}(N8(e))}(this.toPolygon())},e.findEdgeRingContaining=function(n,t){var i,s,r=n.getEnvelope();return t.forEach(function(d){var m=d.getEnvelope();if(s&&(i=s.getEnvelope()),!function JH(e,n){var t=e.geometry.coordinates[0].map(function(d){return d[0]}),r=e.geometry.coordinates[0].map(function(d){return d[1]}),i=n.geometry.coordinates[0].map(function(d){return d[0]}),s=n.geometry.coordinates[0].map(function(d){return d[1]});return Math.max.apply(null,t)===Math.max.apply(null,i)&&Math.max.apply(null,r)===Math.max.apply(null,s)&&Math.min.apply(null,t)===Math.min.apply(null,i)&&Math.min.apply(null,r)===Math.min.apply(null,s)}(m,r)&&dO(m,r)){for(var v=n.map(function(Q){return Q.from.coordinates}),w=void 0,D=function(Q){d.some(function(X){return function QH(e,n){return e[0]===n[0]&&e[1]===n[1]}(Q,X.from.coordinates)})||(w=Q)},N=0,O=v;N<O.length;N++)D(O[N]);w&&d.inside(nm(w))&&(!s||dO(i,m))&&(s=d)}}),s},e.prototype.inside=function(n){return DR(n,this.toPolygon())},e}();function wO(e){for(var n=e,t=[];n.parent;)t.unshift(n),n=n.parent;return t}!function(){function e(){this.edges=[],this.nodes={}}e.fromGeoJson=function(n){!function oq(e){if(!e)throw new Error("No geojson passed");if("FeatureCollection"!==e.type&&"GeometryCollection"!==e.type&&"MultiLineString"!==e.type&&"LineString"!==e.type&&"Feature"!==e.type)throw new Error("Invalid input type '"+e.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(n);var t=new e;return Gb(n,function(r){(function R8(e,n,t){if(!e)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!e||"Feature"!==e.type||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==n)throw new Error("Invalid input to "+t+": must be a "+n+", given "+e.geometry.type)})(r,"LineString","Graph::fromGeoJson"),function S8(e,n,t,r){var i=t;Av(e,function(s,d,m,v,w){i=0===d&&void 0===t?s:n(i,s,d,m,v,w)},r)}(r,function(i,s){if(i){var d=t.getNode(i),m=t.getNode(s);t.addEdge(d,m)}return s})}),t},e.prototype.getNode=function(n){var t=fO.buildId(n),r=this.nodes[t];return r||(r=this.nodes[t]=new fO(n)),r},e.prototype.addEdge=function(n,t){var r=new nq(n,t),i=r.getSymetric();this.edges.push(r),this.edges.push(i)},e.prototype.deleteDangles=function(){var n=this;Object.keys(this.nodes).map(function(t){return n.nodes[t]}).forEach(function(t){return n._removeIfDangle(t)})},e.prototype._removeIfDangle=function(n){var t=this;if(n.innerEdges.length<=1){var r=n.getOuterEdges().map(function(i){return i.to});this.removeNode(n),r.forEach(function(i){return t._removeIfDangle(i)})}},e.prototype.deleteCutEdges=function(){var n=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(t){t.label===t.symetric.label&&(n.removeEdge(t.symetric),n.removeEdge(t))})},e.prototype._computeNextCWEdges=function(n){var t=this;typeof n>"u"?Object.keys(this.nodes).forEach(function(r){return t._computeNextCWEdges(t.nodes[r])}):n.getOuterEdges().forEach(function(r,i){n.getOuterEdge((0===i?n.getOuterEdges().length:i)-1).symetric.next=r})},e.prototype._computeNextCCWEdges=function(n,t){for(var i,s,r=n.getOuterEdges(),d=r.length-1;d>=0;--d){var m=r[d],v=m.symetric,w=void 0,D=void 0;m.label===t&&(w=m),v.label===t&&(D=v),w&&D&&(D&&(s=D),w&&(s&&(s.next=w,s=void 0),i||(i=w)))}s&&(s.next=i)},e.prototype._findLabeledEdgeRings=function(){var n=[],t=0;return this.edges.forEach(function(r){if(!(r.label>=0)){n.push(r);var i=r;do{i.label=t,i=i.next}while(!r.isEqual(i));t++}}),n},e.prototype.getEdgeRings=function(){var n=this;this._computeNextCWEdges(),this.edges.forEach(function(r){r.label=void 0}),this._findLabeledEdgeRings().forEach(function(r){n._findIntersectionNodes(r).forEach(function(i){n._computeNextCCWEdges(i,r.label)})});var t=[];return this.edges.forEach(function(r){r.ring||t.push(n._findEdgeRing(r))}),t},e.prototype._findIntersectionNodes=function(n){var t=[],r=n,i=function(){var s=0;r.from.getOuterEdges().forEach(function(d){d.label===n.label&&++s}),s>1&&t.push(r.from),r=r.next};do{i()}while(!n.isEqual(r));return t},e.prototype._findEdgeRing=function(n){var t=n,r=new iq;do{r.push(t),t.ring=r,t=t.next}while(!n.isEqual(t));return r},e.prototype.removeNode=function(n){var t=this;n.getOuterEdges().forEach(function(r){return t.removeEdge(r)}),n.innerEdges.forEach(function(r){return t.removeEdge(r)}),delete this.nodes[n.id]},e.prototype.removeEdge=function(n){this.edges=this.edges.filter(function(t){return!t.isEqual(n)}),n.deleteEdge()}}(),qe(3198),qe(3367),qe(3282);var Yb={search:function(e,n,t,r){e.cleanDirty();var i=(r=r||{}).heuristic||Yb.heuristics.manhattan,s=r.closest||!1,d=function bq(){return new EO(function(e){return e.f})}(),m=n;for(n.h=i(n,t),d.push(n);d.size()>0;){var v=d.pop();if(v===t)return wO(v);v.closed=!0;for(var w=e.neighbors(v),D=0,N=w.length;D<N;++D){var O=w[D];if(!O.closed&&!O.isWall()){var k=v.g+O.getCost(v),Q=O.visited;(!Q||k<O.g)&&(O.visited=!0,O.parent=v,O.h=O.h||i(O,t),O.g=k,O.f=O.g+O.h,e.markDirty(O),s&&(O.h<m.h||O.h===m.h&&O.g<m.g)&&(m=O),Q?d.rescoreElement(O):d.push(O))}}}return s?wO(m):[]},heuristics:{manhattan:function(e,n){return Math.abs(n.x-e.x)+Math.abs(n.y-e.y)},diagonal:function(e,n){var r=Math.sqrt(2),i=Math.abs(n.x-e.x),s=Math.abs(n.y-e.y);return 1*(i+s)+(r-2)*Math.min(i,s)}},cleanNode:function(e){e.f=0,e.g=0,e.h=0,e.visited=!1,e.closed=!1,e.parent=null}};function H_(e,n){n=n||{},this.nodes=[],this.diagonal=!!n.diagonal,this.grid=[];for(var t=0;t<e.length;t++){this.grid[t]=[];for(var r=0,i=e[t];r<i.length;r++){var s=new Kb(t,r,i[r]);this.grid[t][r]=s,this.nodes.push(s)}}this.init()}function Kb(e,n,t){this.x=e,this.y=n,this.weight=t}function EO(e){this.content=[],this.scoreFunction=e}function nT(){this._=null}function Jb(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function Lv(e,n){var t=n,r=n.R,i=t.U;i?i.L===t?i.L=r:i.R=r:e._=r,r.U=i,t.U=r,t.R=r.L,t.R&&(t.R.U=t),r.L=t}function kv(e,n){var t=n,r=n.L,i=t.U;i?i.L===t?i.L=r:i.R=r:e._=r,r.U=i,t.U=r,t.L=r.R,t.L&&(t.L.U=t),r.R=t}function CO(e){for(;e.L;)e=e.L;return e}H_.prototype.init=function(){this.dirtyNodes=[];for(var e=0;e<this.nodes.length;e++)Yb.cleanNode(this.nodes[e])},H_.prototype.cleanDirty=function(){for(var e=0;e<this.dirtyNodes.length;e++)Yb.cleanNode(this.dirtyNodes[e]);this.dirtyNodes=[]},H_.prototype.markDirty=function(e){this.dirtyNodes.push(e)},H_.prototype.neighbors=function(e){var n=[],t=e.x,r=e.y,i=this.grid;return i[t-1]&&i[t-1][r]&&n.push(i[t-1][r]),i[t+1]&&i[t+1][r]&&n.push(i[t+1][r]),i[t]&&i[t][r-1]&&n.push(i[t][r-1]),i[t]&&i[t][r+1]&&n.push(i[t][r+1]),this.diagonal&&(i[t-1]&&i[t-1][r-1]&&n.push(i[t-1][r-1]),i[t+1]&&i[t+1][r-1]&&n.push(i[t+1][r-1]),i[t-1]&&i[t-1][r+1]&&n.push(i[t-1][r+1]),i[t+1]&&i[t+1][r+1]&&n.push(i[t+1][r+1])),n},H_.prototype.toString=function(){for(var t,r,i,s,e=[],n=this.grid,d=0,m=n.length;d<m;d++){for(t=[],i=0,s=(r=n[d]).length;i<s;i++)t.push(r[i].weight);e.push(t.join(" "))}return e.join("\n")},Kb.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},Kb.prototype.getCost=function(e){return e&&e.x!==this.x&&e.y!==this.y?1.41421*this.weight:this.weight},Kb.prototype.isWall=function(){return 0===this.weight},EO.prototype={push:function(e){this.content.push(e),this.sinkDown(this.content.length-1)},pop:function(){var e=this.content[0],n=this.content.pop();return this.content.length>0&&(this.content[0]=n,this.bubbleUp(0)),e},remove:function(e){var n=this.content.indexOf(e),t=this.content.pop();n!==this.content.length-1&&(this.content[n]=t,this.scoreFunction(t)<this.scoreFunction(e)?this.sinkDown(n):this.bubbleUp(n))},size:function(){return this.content.length},rescoreElement:function(e){this.sinkDown(this.content.indexOf(e))},sinkDown:function(e){for(var n=this.content[e];e>0;){var t=(e+1>>1)-1,r=this.content[t];if(!(this.scoreFunction(n)<this.scoreFunction(r)))break;this.content[t]=n,this.content[e]=r,e=t}},bubbleUp:function(e){for(var n=this.content.length,t=this.content[e],r=this.scoreFunction(t);;){var m,i=e+1<<1,s=i-1,d=null;if(s<n&&(m=this.scoreFunction(this.content[s]))<r&&(d=s),i<n&&this.scoreFunction(this.content[i])<(null===d?r:m)&&(d=i),null===d)break;this.content[e]=this.content[d],this.content[d]=t,e=d}}},nT.prototype={constructor:nT,insert:function(e,n){var t,r,i;if(e){if(n.P=e,n.N=e.N,e.N&&(e.N.P=n),e.N=n,e.R){for(e=e.R;e.L;)e=e.L;e.L=n}else e.R=n;t=e}else this._?(e=CO(this._),n.P=null,n.N=e,e.P=e.L=n,t=e):(n.P=n.N=null,this._=n,t=null);for(n.L=n.R=null,n.U=t,n.C=!0,e=n;t&&t.C;)t===(r=t.U).L?(i=r.R)&&i.C?(t.C=i.C=!1,r.C=!0,e=r):(e===t.R&&(Lv(this,t),t=(e=t).U),t.C=!1,r.C=!0,kv(this,r)):(i=r.L)&&i.C?(t.C=i.C=!1,r.C=!0,e=r):(e===t.L&&(kv(this,t),t=(e=t).U),t.C=!1,r.C=!0,Lv(this,r)),t=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,s,d,n=e.U,r=e.L,i=e.R;if(s=r?i?CO(i):r:i,n?n.L===e?n.L=s:n.R=s:this._=s,r&&i?(d=s.C,s.C=e.C,s.L=r,r.U=s,s!==i?(n=s.U,s.U=e.U,n.L=e=s.R,s.R=i,i.U=s):(s.U=n,n=s,e=s.R)):(d=e.C,e=s),e&&(e.U=n),!d){if(e&&e.C)return void(e.C=!1);do{if(e===this._)break;if(e===n.L){if((t=n.R).C&&(t.C=!1,n.C=!0,Lv(this,n),t=n.R),t.L&&t.L.C||t.R&&t.R.C){(!t.R||!t.R.C)&&(t.L.C=!1,t.C=!0,kv(this,t),t=n.R),t.C=n.C,n.C=t.R.C=!1,Lv(this,n),e=this._;break}}else if((t=n.L).C&&(t.C=!1,n.C=!0,kv(this,n),t=n.L),t.L&&t.L.C||t.R&&t.R.C){(!t.L||!t.L.C)&&(t.R.C=!1,t.C=!0,Lv(this,t),t=n.L),t.C=n.C,n.C=t.L.C=!1,kv(this,n),e=this._;break}t.C=!0,e=n,n=n.U}while(!e.C);e&&(e.C=!1)}}};const SO=nT;function Fv(e,n,t,r){var i=[null,null],s=rc.push(i)-1;return i.left=e,i.right=n,t&&Qb(i,e,n,t),r&&Qb(i,n,e,r),_h[e.index].halfedges.push(s),_h[n.index].halfedges.push(s),i}function Bv(e,n,t){var r=[n,t];return r.left=e,r}function Qb(e,n,t,r){e[0]||e[1]?e.left===t?e[1]=r:e[0]=r:(e[0]=r,e.left=n,e.right=t)}function Eq(e,n,t,r,i){var X,s=e[0],d=e[1],m=s[0],v=s[1],N=0,O=1,k=d[0]-m,Q=d[1]-v;if(X=n-m,k||!(X>0)){if(X/=k,k<0){if(X<N)return;X<O&&(O=X)}else if(k>0){if(X>O)return;X>N&&(N=X)}if(X=r-m,k||!(X<0)){if(X/=k,k<0){if(X>O)return;X>N&&(N=X)}else if(k>0){if(X<N)return;X<O&&(O=X)}if(X=t-v,Q||!(X>0)){if(X/=Q,Q<0){if(X<N)return;X<O&&(O=X)}else if(Q>0){if(X>O)return;X>N&&(N=X)}if(X=i-v,Q||!(X<0)){if(X/=Q,Q<0){if(X>O)return;X>N&&(N=X)}else if(Q>0){if(X<N)return;X<O&&(O=X)}return!(N>0)&&!(O<1)||(N>0&&(e[0]=[m+N*k,v+N*Q]),O<1&&(e[1]=[m+O*k,v+O*Q])),!0}}}}}function Cq(e,n,t,r,i){var s=e[1];if(s)return!0;var X,_e,d=e[0],m=e.left,v=e.right,w=m[0],D=m[1],N=v[0],O=v[1],k=(w+N)/2;if(O===D){if(k<n||k>=r)return;if(w>N){if(d){if(d[1]>=i)return}else d=[k,t];s=[k,i]}else{if(d){if(d[1]<t)return}else d=[k,i];s=[k,t]}}else if(_e=(D+O)/2-(X=(w-N)/(O-D))*k,X<-1||X>1)if(w>N){if(d){if(d[1]>=i)return}else d=[(t-_e)/X,t];s=[(i-_e)/X,i]}else{if(d){if(d[1]<t)return}else d=[(i-_e)/X,i];s=[(t-_e)/X,t]}else if(D<O){if(d){if(d[0]>=r)return}else d=[n,X*n+_e];s=[r,X*r+_e]}else{if(d){if(d[0]<n)return}else d=[r,X*r+_e];s=[n,X*n+_e]}return e[0]=d,e[1]=s,!0}function Tq(e,n){var t=e.site,r=n.left,i=n.right;return t===i&&(i=r,r=t),i?Math.atan2(i[1]-r[1],i[0]-r[0]):(t===r?(r=n[1],i=n[0]):(r=n[0],i=n[1]),Math.atan2(r[0]-i[0],i[1]-r[1]))}function DO(e,n){return n[+(n.left!==e.site)]}function Iq(e,n){return n[+(n.left===e.site)]}var rT,TO=[];function Nq(){Jb(this),this.x=this.y=this.arc=this.site=this.cy=null}function q_(e){var n=e.P,t=e.N;if(n&&t){var r=n.site,i=e.site,s=t.site;if(r!==s){var d=i[0],m=i[1],v=r[0]-d,w=r[1]-m,D=s[0]-d,N=s[1]-m,O=2*(v*N-w*D);if(!(O>=-kq)){var k=v*v+w*w,Q=D*D+N*N,X=(N*k-w*Q)/O,_e=(v*Q-D*k)/O,le=TO.pop()||new Nq;le.arc=e,le.site=i,le.x=X+d,le.y=(le.cy=_e+m)+Math.sqrt(X*X+_e*_e),e.circle=le;for(var K=null,me=zv._;me;)if(le.y<me.y||le.y===me.y&&le.x<=me.x){if(!me.L){K=me.P;break}me=me.L}else{if(!me.R){K=me;break}me=me.R}zv.insert(K,le),K||(rT=le)}}}}function W_(e){var n=e.circle;n&&(n.P||(rT=n.N),zv.remove(n),TO.push(n),Jb(n),e.circle=null)}var IO=[];function Pq(){Jb(this),this.edge=this.site=this.circle=null}function MO(e){var n=IO.pop()||new Pq;return n.site=e,n}function iT(e){W_(e),Z_.remove(e),IO.push(e),Jb(e)}function Rq(e){var n=e.circle,t=n.x,r=n.cy,i=[t,r],s=e.P,d=e.N,m=[e];iT(e);for(var v=s;v.circle&&Math.abs(t-v.circle.x)<Va&&Math.abs(r-v.circle.cy)<Va;)s=v.P,m.unshift(v),iT(v),v=s;m.unshift(v),W_(v);for(var w=d;w.circle&&Math.abs(t-w.circle.x)<Va&&Math.abs(r-w.circle.cy)<Va;)d=w.N,m.push(w),iT(w),w=d;m.push(w),W_(w);var N,D=m.length;for(N=1;N<D;++N)Qb((w=m[N]).edge,(v=m[N-1]).site,w.site,i);(w=m[D-1]).edge=Fv((v=m[0]).site,w.site,null,i),q_(v),q_(w)}function Oq(e){for(var r,i,s,d,n=e[0],t=e[1],m=Z_._;m;)if((s=AO(m,t)-n)>Va)m=m.L;else{if(!((d=n-Lq(m,t))>Va)){s>-Va?(r=m.P,i=m):d>-Va?(r=m,i=m.N):r=i=m;break}if(!m.R){r=m;break}m=m.R}!function Dq(e){_h[e.index]={site:e,halfedges:[]}}(e);var v=MO(e);if(Z_.insert(r,v),r||i){if(r===i)return W_(r),i=MO(r.site),Z_.insert(v,i),v.edge=i.edge=Fv(r.site,v.site),q_(r),void q_(i);if(!i)return void(v.edge=Fv(r.site,v.site));W_(r),W_(i);var w=r.site,D=w[0],N=w[1],O=e[0]-D,k=e[1]-N,Q=i.site,X=Q[0]-D,_e=Q[1]-N,le=2*(O*_e-k*X),K=O*O+k*k,me=X*X+_e*_e,$e=[(_e*K-k*me)/le+D,(O*me-X*K)/le+N];Qb(i.edge,w,Q,$e),v.edge=Fv(w,e,null,$e),i.edge=Fv(e,Q,null,$e),q_(r),q_(i)}}function AO(e,n){var t=e.site,r=t[0],i=t[1],s=i-n;if(!s)return r;var d=e.P;if(!d)return-1/0;var m=(t=d.site)[0],v=t[1],w=v-n;if(!w)return m;var D=m-r,N=1/s-1/w,O=D/w;return N?(-O+Math.sqrt(O*O-2*N*(D*D/(-2*w)-v+w/2+i-s/2)))/N+r:(r+m)/2}function Lq(e,n){var t=e.N;if(t)return AO(t,n);var r=e.site;return r[1]===n?r[0]:1/0}var Z_,_h,zv,rc,Va=1e-6,kq=1e-12;function Fq(e,n,t){return(e[0]-t[0])*(n[1]-e[1])-(e[0]-n[0])*(t[1]-e[1])}function Bq(e,n){return n[1]-e[1]||n[0]-e[0]}function NO(e,n){var r,i,s,t=e.sort(Bq).pop();for(rc=[],_h=new Array(e.length),Z_=new SO,zv=new SO;;)if(s=rT,t&&(!s||t[1]<s.y||t[1]===s.y&&t[0]<s.x))(t[0]!==r||t[1]!==i)&&(Oq(t),r=t[0],i=t[1]),t=e.pop();else{if(!s)break;Rq(s.arc)}if(function Mq(){for(var t,r,i,s,e=0,n=_h.length;e<n;++e)if((t=_h[e])&&(s=(r=t.halfedges).length)){var d=new Array(s),m=new Array(s);for(i=0;i<s;++i)d[i]=i,m[i]=Tq(t,rc[r[i]]);for(d.sort(function(v,w){return m[w]-m[v]}),i=0;i<s;++i)m[i]=r[d[i]];for(i=0;i<s;++i)r[i]=m[i]}}(),n){var d=+n[0][0],m=+n[0][1],v=+n[1][0],w=+n[1][1];(function Sq(e,n,t,r){for(var s,i=rc.length;i--;)Cq(s=rc[i],e,n,t,r)&&Eq(s,e,n,t,r)&&(Math.abs(s[0][0]-s[1][0])>Va||Math.abs(s[0][1]-s[1][1])>Va)||delete rc[i]})(d,m,v,w),function Aq(e,n,t,r){var s,d,m,v,w,D,N,O,k,Q,X,_e,i=_h.length,le=!0;for(s=0;s<i;++s)if(d=_h[s]){for(m=d.site,v=(w=d.halfedges).length;v--;)rc[w[v]]||w.splice(v,1);for(v=0,D=w.length;v<D;)X=(Q=Iq(d,rc[w[v]]))[0],_e=Q[1],O=(N=DO(d,rc[w[++v%D]]))[0],k=N[1],(Math.abs(X-O)>Va||Math.abs(_e-k)>Va)&&(w.splice(v,0,rc.push(Bv(m,Q,Math.abs(X-e)<Va&&r-_e>Va?[e,Math.abs(O-e)<Va?k:r]:Math.abs(_e-r)<Va&&t-X>Va?[Math.abs(k-r)<Va?O:t,r]:Math.abs(X-t)<Va&&_e-n>Va?[t,Math.abs(O-t)<Va?k:n]:Math.abs(_e-n)<Va&&X-e>Va?[Math.abs(k-n)<Va?O:e,n]:null))-1),++D);D&&(le=!1)}if(le){var K,me,$e,Ze=1/0;for(s=0,le=null;s<i;++s)(d=_h[s])&&($e=(K=(m=d.site)[0]-e)*K+(me=m[1]-n)*me)<Ze&&(Ze=$e,le=d);if(le){var gt=[e,n],_t=[e,r],St=[t,r],Ye=[t,n];le.halfedges.push(rc.push(Bv(m=le.site,gt,_t))-1,rc.push(Bv(m,_t,St))-1,rc.push(Bv(m,St,Ye))-1,rc.push(Bv(m,Ye,gt))-1)}}for(s=0;s<i;++s)(d=_h[s])&&(d.halfedges.length||delete _h[s])}(d,m,v,w)}this.edges=rc,this.cells=_h,Z_=zv=rc=_h=null}function Jp(){return new ew}function ew(){this.reset()}NO.prototype={constructor:NO,polygons:function(){var e=this.edges;return this.cells.map(function(n){var t=n.halfedges.map(function(r){return DO(n,e[r])});return t.data=n.site.data,t})},triangles:function(){var e=[],n=this.edges;return this.cells.forEach(function(t,r){if(m=(s=t.halfedges).length)for(var s,m,v,i=t.site,d=-1,w=n[s[m-1]],D=w.left===i?w.right:w.left;++d<m;)v=D,D=(w=n[s[d]]).left===i?w.right:w.left,v&&D&&r<v.index&&r<D.index&&Fq(i,v,D)<0&&e.push([i.data,v.data,D.data])}),e},links:function(){return this.edges.filter(function(e){return e.right}).map(function(e){return{source:e.left.data,target:e.right.data}})},find:function(e,n,t){for(var i,m,r=this,s=r._found||0,d=r.cells.length;!(m=r.cells[s]);)if(++s>=d)return null;var v=e-m.site[0],w=n-m.site[1],D=v*v+w*w;do{m=r.cells[i=s],s=null,m.halfedges.forEach(function(N){var O=r.edges[N],k=O.left;if(k!==m.site&&k||(k=O.right)){var Q=e-k[0],X=n-k[1],_e=Q*Q+X*X;_e<D&&(D=_e,s=k.index)}})}while(null!==s);return r._found=i,null==t||D<=t*t?m.site:null}},qe(8464),qe(4855),ew.prototype={constructor:ew,reset:function(){this.s=this.t=0},add:function(e){jO(tw,e,this.t),jO(this,tw.s,this.s),this.s?this.t+=tw.t:this.s=tw.t},valueOf:function(){return this.s}};var tw=new ew;function jO(e,n,t){var r=e.s=n+t,i=r-n;e.t=n-(r-i)+(t-i)}var Ja=Math.PI,Wc=Ja/2,X_=2*Ja,Aa=Ja/180,Vv=(Math,Math.atan),Y_=Math.atan2,Qo=Math.cos,wo=(Math,Math,Math,Math,Math,Math.sin),Xf=(Math,Math.sqrt);Math;function K_(e){return e>1?Wc:e<-1?-Wc:Math.asin(e)}function yT(e,n){return[e>Ja?e-X_:e<-Ja?e+X_:e,n]}function gL(e,n){return e<n?-1:e>n?1:e>=n?0:NaN}Jp(),Jp(),Jp(),yT.invert=yT,function m9(e){1===e.length&&(e=function _9(e){return function(n,t){return gL(e(n),t)}}(e))}(gL),Math.sqrt(50),Math.sqrt(10),Math.sqrt(2);Jp();function FT(){}function UL(e){return function(n,t){var r=Qo(n),i=Qo(t),s=e(r*i);return[s*i*wo(n),s*wo(t)]}}function Yv(e){return function(n,t){var r=Xf(n*n+t*t),i=e(r),s=wo(i),d=Qo(i);return[Y_(n*s,r*d),K_(r&&t*s/r)]}}function zT(e,n){return[e,n]}Jp(),Jp(),Jp(),Jp(),function BL(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}(4.5),FT.prototype={constructor:FT,point:function(e,n){this.stream.point(e,n)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},Qo(30*Aa),function zL(e){return function(n){var t=new FT;for(var r in e)t[r]=e[r];return t.stream=n,t}}({point:function(e,n){this.stream.point(e*Aa,n*Aa)}}),UL(function(e){return Xf(2/(1+e))}).invert=Yv(function(e){return 2*K_(e/2)}),UL(function(e){return(e=function Jq(e){return e>1?0:e<-1?Ja:Math.acos(e)}(e))&&e/wo(e)}).invert=Yv(function(e){return e}),zT.invert=zT,Yv(Vv),Yv(K_),Yv(function(e){return 2*Vv(e)});let QL=(()=>{class e{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=i=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}}return e.\u0275fac=function(t){return new(t||e)(wt(Ju),wt(Yo))},e.\u0275dir=Mn({type:e}),e})(),am=(()=>{class e extends QL{}return e.\u0275fac=function(){let n;return function(r){return(n||(n=Da(e)))(r||e)}}(),e.\u0275dir=Mn({type:e,features:[Is]}),e})();const Xh=new wr("NgValueAccessor"),d7={provide:Xh,useExisting:$t(()=>Tw),multi:!0},p7=new wr("CompositionEventMode");let Tw=(()=>{class e extends QL{constructor(t,r,i){super(t,r),this._compositionMode=i,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function f7(){const e=qp()?qp().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}return e.\u0275fac=function(t){return new(t||e)(wt(Ju),wt(Yo),wt(p7,8))},e.\u0275dir=Mn({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(t,r){1&t&&$i("input",function(s){return r._handleInput(s.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(s){return r._compositionEnd(s.target.value)})},features:[ta([d7]),Is]}),e})();function eg(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}function tk(e){return null!=e&&"number"==typeof e.length}const Bu=new wr("NgValidators"),tg=new wr("NgAsyncValidators"),g7=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Kv{static min(n){return function nk(e){return n=>{if(eg(n.value)||eg(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t<e?{min:{min:e,actual:n.value}}:null}}(n)}static max(n){return function rk(e){return n=>{if(eg(n.value)||eg(e))return null;const t=parseFloat(n.value);return!isNaN(t)&&t>e?{max:{max:e,actual:n.value}}:null}}(n)}static required(n){return function ik(e){return eg(e.value)?{required:!0}:null}(n)}static requiredTrue(n){return function ok(e){return!0===e.value?null:{required:!0}}(n)}static email(n){return function sk(e){return eg(e.value)||g7.test(e.value)?null:{email:!0}}(n)}static minLength(n){return function ak(e){return n=>eg(n.value)||!tk(n.value)?null:n.value.length<e?{minlength:{requiredLength:e,actualLength:n.value.length}}:null}(n)}static maxLength(n){return function lk(e){return n=>tk(n.value)&&n.value.length>e?{maxlength:{requiredLength:e,actualLength:n.value.length}}:null}(n)}static pattern(n){return function uk(e){if(!e)return Iw;let n,t;return"string"==typeof e?(t="","^"!==e.charAt(0)&&(t+="^"),t+=e,"$"!==e.charAt(e.length-1)&&(t+="$"),n=new RegExp(t)):(t=e.toString(),n=e),r=>{if(eg(r.value))return null;const i=r.value;return n.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}(n)}static nullValidator(n){return null}static compose(n){return gk(n)}static composeAsync(n){return mk(n)}}function Iw(e){return null}function ck(e){return null!=e}function hk(e){return W0(e)?ws(e):e}function dk(e){let n={};return e.forEach(t=>{n=null!=t?{...n,...t}:n}),0===Object.keys(n).length?null:n}function fk(e,n){return n.map(t=>t(e))}function pk(e){return e.map(n=>function m7(e){return!e.validate}(n)?n:t=>n.validate(t))}function gk(e){if(!e)return null;const n=e.filter(ck);return 0==n.length?null:function(t){return dk(fk(t,n))}}function VT(e){return null!=e?gk(pk(e)):null}function mk(e){if(!e)return null;const n=e.filter(ck);return 0==n.length?null:function(t){return function c7(...e){const n=Tu(e),{args:t,keys:r}=a2(e),i=new Ae(s=>{const{length:d}=t;if(!d)return void s.complete();const m=new Array(d);let v=d,w=d;for(let D=0;D<d;D++){let N=!1;Jr(t[D]).subscribe(Dn(s,O=>{N||(N=!0,w--),m[D]=O},()=>v--,void 0,()=>{(!v||!N)&&(w||s.next(r?l2(r,m):m),s.complete())}))}});return n?i.pipe(nD(n)):i}(fk(t,n).map(hk)).pipe(bn(dk))}}function UT(e){return null!=e?mk(pk(e)):null}function _k(e,n){return null===e?[n]:Array.isArray(e)?[...e,n]:[e,n]}function yk(e){return e._rawValidators}function vk(e){return e._rawAsyncValidators}function jT(e){return e?Array.isArray(e)?e:[e]:[]}function Mw(e,n){return Array.isArray(e)?e.includes(n):e===n}function xk(e,n){const t=jT(n);return jT(e).forEach(i=>{Mw(t,i)||t.push(i)}),t}function bk(e,n){return jT(n).filter(t=>!Mw(e,t))}class wk{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=VT(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=UT(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,t){return!!this.control&&this.control.hasError(n,t)}getError(n,t){return this.control?this.control.getError(n,t):null}}class Dc extends wk{get formDirective(){return null}get path(){return null}}class ng extends wk{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Ek{constructor(n){this._cd=n}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let Ck=(()=>{class e extends Ek{constructor(t){super(t)}}return e.\u0275fac=function(t){return new(t||e)(wt(ng,2))},e.\u0275dir=Mn({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(t,r){2&t&&hs("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},features:[Is]}),e})(),Sk=(()=>{class e extends Ek{constructor(t){super(t)}}return e.\u0275fac=function(t){return new(t||e)(wt(Dc,10))},e.\u0275dir=Mn({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(t,r){2&t&&hs("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)("ng-submitted",r.isSubmitted)},features:[Is]}),e})();const Jv="VALID",Nw="INVALID",ny="PENDING",Qv="DISABLED";function HT(e){return(Pw(e)?e.validators:e)||null}function qT(e,n){return(Pw(n)?n.asyncValidators:e)||null}function Pw(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}function Tk(e,n,t){const r=e.controls;if(!(n?Object.keys(r):r).length)throw new en(1e3,"");if(!r[t])throw new en(1001,"")}function Ik(e,n,t){e._forEachChild((r,i)=>{if(void 0===t[i])throw new en(1002,"")})}class Rw{constructor(n,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(n),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get valid(){return this.status===Jv}get invalid(){return this.status===Nw}get pending(){return this.status==ny}get disabled(){return this.status===Qv}get enabled(){return this.status!==Qv}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(xk(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(xk(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(bk(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(bk(n,this._rawAsyncValidators))}hasValidator(n){return Mw(this._rawValidators,n)}hasAsyncValidator(n){return Mw(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){this.touched=!0,this._parent&&!n.onlySelf&&this._parent.markAsTouched(n)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(n=>n.markAllAsTouched())}markAsUntouched(n={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}markAsDirty(n={}){this.pristine=!1,this._parent&&!n.onlySelf&&this._parent.markAsDirty(n)}markAsPristine(n={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}markAsPending(n={}){this.status=ny,!1!==n.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!n.onlySelf&&this._parent.markAsPending(n)}disable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=Qv,this.errors=null,this._forEachChild(r=>{r.disable({...n,onlySelf:!0})}),this._updateValue(),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...n,skipPristineCheck:t}),this._onDisabledChange.forEach(r=>r(!0))}enable(n={}){const t=this._parentMarkedDirty(n.onlySelf);this.status=Jv,this._forEachChild(r=>{r.enable({...n,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors({...n,skipPristineCheck:t}),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(n){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Jv||this.status===ny)&&this._runAsyncValidator(n.emitEvent)),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(n)}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Qv:Jv}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n){if(this.asyncValidator){this.status=ny,this._hasOwnPendingAsyncValidator=!0;const t=hk(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:n})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(n,t={}){this.errors=n,this._updateControlsErrors(!1!==t.emitEvent)}get(n){let t=n;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(n,t){const r=t?this.get(t):this;return r&&r.errors?r.errors[n]:null}hasError(n,t){return!!this.getError(n,t)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(n)}_initObservables(){this.valueChanges=new zr,this.statusChanges=new zr}_calculateStatus(){return this._allControlsDisabled()?Qv:this.errors?Nw:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ny)?ny:this._anyControlsHaveStatus(Nw)?Nw:Jv}_anyControlsHaveStatus(n){return this._anyControls(t=>t.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n={}){this.pristine=!this._anyControlsDirty(),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}_updateTouched(n={}){this.touched=this._anyControlsTouched(),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){Pw(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=function x7(e){return Array.isArray(e)?VT(e):e||null}(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=function b7(e){return Array.isArray(e)?UT(e):e||null}(this._rawAsyncValidators)}}class e1 extends Rw{constructor(n,t,r){super(HT(t),qT(r,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,t){return this.controls[n]?this.controls[n]:(this.controls[n]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(n,t,r={}){this.registerControl(n,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(n,t={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(n,t,r={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],t&&this.registerControl(n,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,t={}){Ik(this,0,n),Object.keys(n).forEach(r=>{Tk(this,!0,r),this.controls[r].setValue(n[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(Object.keys(n).forEach(r=>{const i=this.controls[r];i&&i.patchValue(n[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n={},t={}){this._forEachChild((r,i)=>{r.reset(n[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(n,t,r)=>(n[r]=t.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(t,r)=>!!r._syncPendingControls()||t);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(t=>{const r=this.controls[t];r&&n(r,t)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const[t,r]of Object.entries(this.controls))if(this.contains(t)&&n(r))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(n,t){let r=n;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}}class Mk extends e1{}const lm=new wr("CallSetDisabledState",{providedIn:"root",factory:()=>t1}),t1="always";function Ow(e,n){return[...n.path,e]}function n1(e,n,t=t1){WT(e,n),n.valueAccessor.writeValue(e.value),(e.disabled||"always"===t)&&n.valueAccessor.setDisabledState?.(e.disabled),function E7(e,n){n.valueAccessor.registerOnChange(t=>{e._pendingValue=t,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&Ak(e,n)})}(e,n),function S7(e,n){const t=(r,i)=>{n.valueAccessor.writeValue(r),i&&n.viewToModelUpdate(r)};e.registerOnChange(t),n._registerOnDestroy(()=>{e._unregisterOnChange(t)})}(e,n),function C7(e,n){n.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&Ak(e,n),"submit"!==e.updateOn&&e.markAsTouched()})}(e,n),function w7(e,n){if(n.valueAccessor.setDisabledState){const t=r=>{n.valueAccessor.setDisabledState(r)};e.registerOnDisabledChange(t),n._registerOnDestroy(()=>{e._unregisterOnDisabledChange(t)})}}(e,n)}function Lw(e,n,t=!0){const r=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(r),n.valueAccessor.registerOnTouched(r)),Fw(e,n),e&&(n._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function kw(e,n){e.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(n)})}function WT(e,n){const t=yk(e);null!==n.validator?e.setValidators(_k(t,n.validator)):"function"==typeof t&&e.setValidators([t]);const r=vk(e);null!==n.asyncValidator?e.setAsyncValidators(_k(r,n.asyncValidator)):"function"==typeof r&&e.setAsyncValidators([r]);const i=()=>e.updateValueAndValidity();kw(n._rawValidators,i),kw(n._rawAsyncValidators,i)}function Fw(e,n){let t=!1;if(null!==e){if(null!==n.validator){const i=yk(e);if(Array.isArray(i)&&i.length>0){const s=i.filter(d=>d!==n.validator);s.length!==i.length&&(t=!0,e.setValidators(s))}}if(null!==n.asyncValidator){const i=vk(e);if(Array.isArray(i)&&i.length>0){const s=i.filter(d=>d!==n.asyncValidator);s.length!==i.length&&(t=!0,e.setAsyncValidators(s))}}}const r=()=>{};return kw(n._rawValidators,r),kw(n._rawAsyncValidators,r),t}function Ak(e,n){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function Rk(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}function Ok(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const i1=class extends Rw{constructor(n=null,t,r){super(HT(t),qT(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(n),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Pw(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=Ok(n)?n.value:n)}setValue(n,t={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(r=>r(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(n,t={}){this.setValue(n,t)}reset(n=this.defaultValue,t={}){this._applyFormState(n),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){Rk(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){Rk(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){Ok(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}};let Lk=(()=>{class e extends Dc{ngOnInit(){this._checkParentType(),this.formDirective.addFormGroup(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormGroup(this)}get control(){return this.formDirective.getFormGroup(this)}get path(){return Ow(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}}return e.\u0275fac=function(){let n;return function(r){return(n||(n=Da(e)))(r||e)}}(),e.\u0275dir=Mn({type:e,features:[Is]}),e})(),zk=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=Mn({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),e})();const O7={provide:Xh,useExisting:$t(()=>JT),multi:!0};let JT=(()=>{class e extends am{writeValue(t){this.setProperty("value",t??"")}registerOnChange(t){this.onChange=r=>{t(""==r?null:parseFloat(r))}}}return e.\u0275fac=function(){let n;return function(r){return(n||(n=Da(e)))(r||e)}}(),e.\u0275dir=Mn({type:e,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(t,r){1&t&&$i("input",function(s){return r.onChange(s.target.value)})("blur",function(){return r.onTouched()})},features:[ta([O7]),Is]}),e})(),Vk=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})();const QT=new wr("NgModelWithFormControlWarning"),z7={provide:Dc,useExisting:$t(()=>Bw)};let Bw=(()=>{class e extends Dc{constructor(t,r,i){super(),this.callSetDisabledState=i,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new zr,this._setValidators(t),this._setAsyncValidators(r)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Fw(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const r=this.form.get(t.path);return n1(r,t,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),r}getControl(t){return this.form.get(t.path)}removeControl(t){Lw(t.control||null,t,!1),function M7(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,r){this.form.get(t.path).setValue(r)}onSubmit(t){return this.submitted=!0,function Pk(e,n){e._syncPendingControls(),n.forEach(t=>{const r=t.control;"submit"===r.updateOn&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}(this.form,this.directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submitted=!1}_updateDomValue(){this.directives.forEach(t=>{const r=t.control,i=this.form.get(t.path);r!==i&&(Lw(r||null,t),(e=>e instanceof i1)(i)&&(n1(i,t,this.callSetDisabledState),t.control=i))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const r=this.form.get(t.path);(function Nk(e,n){WT(e,n)})(r,t),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const r=this.form.get(t.path);r&&function D7(e,n){return Fw(e,n)}(r,t)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){WT(this.form,this),this._oldForm&&Fw(this._oldForm,this)}_checkFormPresent(){}}return e.\u0275fac=function(t){return new(t||e)(wt(Bu,10),wt(tg,10),wt(lm,8))},e.\u0275dir=Mn({type:e,selectors:[["","formGroup",""]],hostBindings:function(t,r){1&t&&$i("submit",function(s){return r.onSubmit(s)})("reset",function(){return r.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[ta([z7]),Is,Ce]}),e})();const V7={provide:Dc,useExisting:$t(()=>zw)};let zw=(()=>{class e extends Lk{constructor(t,r,i){super(),this.name=null,this._parent=t,this._setValidators(r),this._setAsyncValidators(i)}_checkParentType(){$k(this._parent)}}return e.\u0275fac=function(t){return new(t||e)(wt(Dc,13),wt(Bu,10),wt(tg,10))},e.\u0275dir=Mn({type:e,selectors:[["","formGroupName",""]],inputs:{name:["formGroupName","name"]},features:[ta([V7]),Is]}),e})();const U7={provide:Dc,useExisting:$t(()=>eI)};let eI=(()=>{class e extends Dc{constructor(t,r,i){super(),this.name=null,this._parent=t,this._setValidators(r),this._setAsyncValidators(i)}ngOnInit(){this._checkParentType(),this.formDirective.addFormArray(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormArray(this)}get control(){return this.formDirective.getFormArray(this)}get formDirective(){return this._parent?this._parent.formDirective:null}get path(){return Ow(null==this.name?this.name:this.name.toString(),this._parent)}_checkParentType(){$k(this._parent)}}return e.\u0275fac=function(t){return new(t||e)(wt(Dc,13),wt(Bu,10),wt(tg,10))},e.\u0275dir=Mn({type:e,selectors:[["","formArrayName",""]],inputs:{name:["formArrayName","name"]},features:[ta([U7]),Is]}),e})();function $k(e){return!(e instanceof zw||e instanceof Bw||e instanceof eI)}const j7={provide:ng,useExisting:$t(()=>tI)};let tI=(()=>{class e extends ng{set isDisabled(t){}constructor(t,r,i,s,d){super(),this._ngModelWarningConfig=d,this._added=!1,this.name=null,this.update=new zr,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=function YT(e,n){if(!n)return null;let t,r,i;return Array.isArray(n),n.forEach(s=>{s.constructor===Tw?t=s:function I7(e){return Object.getPrototypeOf(e.constructor)===am}(s)?r=s:i=s}),i||r||t||null}(0,s)}ngOnChanges(t){this._added||this._setUpControl(),function XT(e,n){if(!e.hasOwnProperty("model"))return!1;const t=e.model;return!!t.isFirstChange()||!Object.is(n,t.currentValue)}(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return Ow(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}}return e._ngModelWarningSentOnce=!1,e.\u0275fac=function(t){return new(t||e)(wt(Dc,13),wt(Bu,10),wt(tg,10),wt(Xh,10),wt(QT,8))},e.\u0275dir=Mn({type:e,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[ta([j7]),Is,Ce]}),e})(),nF=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({imports:[Vk]}),e})();class rF extends Rw{constructor(n,t,r){super(HT(t),qT(r,t)),this.controls=n,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(n){return this.controls[this._adjustIndex(n)]}push(n,t={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(n,t,r={}){this.controls.splice(n,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(n,t={}){let r=this._adjustIndex(n);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(n,t,r={}){let i=this._adjustIndex(n);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),t&&(this.controls.splice(i,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,t={}){Ik(this,0,n),n.forEach((r,i)=>{Tk(this,!1,i),this.at(i).setValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(n,t={}){null!=n&&(n.forEach((r,i)=>{this.at(i)&&this.at(i).patchValue(r,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(n=[],t={}){this._forEachChild((r,i)=>{r.reset(n[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((t,r)=>!!r._syncPendingControls()||t,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((t,r)=>{n(t,r)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(t=>t.enabled&&n(t))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(const n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}}function iF(e){return!!e&&(void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn)}let rW=(()=>{class e{constructor(){this.useNonNullable=!1}get nonNullable(){const t=new e;return t.useNonNullable=!0,t}group(t,r=null){const i=this._reduceControls(t);let s={};return iF(r)?s=r:null!==r&&(s.validators=r.validator,s.asyncValidators=r.asyncValidator),new e1(i,s)}record(t,r=null){const i=this._reduceControls(t);return new Mk(i,r)}control(t,r,i){let s={};return this.useNonNullable?(iF(r)?s=r:(s.validators=r,s.asyncValidators=i),new i1(t,{...s,nonNullable:!0})):new i1(t,r,i)}array(t,r,i){const s=t.map(d=>this._createControl(d));return new rF(s,r,i)}_reduceControls(t){const r={};return Object.keys(t).forEach(i=>{r[i]=this._createControl(t[i])}),r}_createControl(t){return t instanceof i1||t instanceof Rw?t:Array.isArray(t)?this.control(t[0],t.length>1?t[1]:null,t.length>2?t[2]:null):this.control(t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),iW=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:lm,useValue:t.callSetDisabledState??t1}]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({imports:[nF]}),e})(),oW=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:QT,useValue:t.warnOnNgModelWithFormControl??"always"},{provide:lm,useValue:t.callSetDisabledState??t1}]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({imports:[nF]}),e})();const sW=["mapContainer"];function aW(e,n){if(1&e){const t=function yd(){return cn()}();Un(0,"div",7)(1,"div",8)(2,"div",9)(3,"header")(4,"h4",10),ui(5," Drone details form"),Jn()()()(),Un(6,"div",8)(7,"div",11)(8,"form",12),$i("ngSubmit",function(){!function ll(e){return qn.lFrame.contextLView=e,e[ai]}(t);const i=hi();return function Pl(e){return qn.lFrame.contextLView=null,e}(i.submit(i.droneForm))}),Un(9,"div",8)(10,"div",13),ui(11," Time: "),Jn(),Un(12,"div",14),za(13,"input",15),Un(14,"div",16),ui(15," Time required in ms "),Jn()()(),Un(16,"h4",17),ui(17,"Start coordinates"),Jn(),Un(18,"div",18)(19,"div",8),za(20,"div",19),Un(21,"div",13),ui(22," longitude: "),Jn(),Un(23,"div",20),za(24,"input",21),Un(25,"div",16),ui(26," longitude required "),Jn()()(),Un(27,"div",8),za(28,"div",19),Un(29,"div",13),ui(30," latitude: "),Jn(),Un(31,"div",20),za(32,"input",22),Un(33,"div",16),ui(34," latitude required "),Jn()()()(),Un(35,"div",23)(36,"h4",17),ui(37,"End coordinates"),Jn(),Un(38,"div",8),za(39,"div",19),Un(40,"div",13),ui(41," longitude: "),Jn(),Un(42,"div",20),za(43,"input",21),Un(44,"div",16),ui(45," longitude required "),Jn()()(),Un(46,"div",8),za(47,"div",19),Un(48,"div",13),ui(49," latitude: "),Jn(),Un(50,"div",20),za(51,"input",22),Un(52,"div",16),ui(53," latitude required "),Jn()()()(),Un(54,"div",8)(55,"div",24)(56,"button",25),ui(57,"Submit"),Jn()()()()()()()}if(2&e){const t=hi();let r,i,s,d,m,v,w,D;hr(8),dr("formGroup",t.droneForm),hr(6),dr("hidden",t.f.animationTimeDuration.untouched||t.f.animationTimeDuration.valid),hr(11),dr("hidden",(null==(r=t.droneForm.get("startLngLatCoords"))||null==(i=r.get("longitude"))?null:i.untouched)||(null==(r=t.droneForm.get("startLngLatCoords"))||null==(i=r.get("longitude"))?null:i.valid)),hr(8),dr("hidden",(null==(s=t.droneForm.get("startLngLatCoords"))||null==(d=s.get("latitude"))?null:d.untouched)||(null==(s=t.droneForm.get("startLngLatCoords"))||null==(d=s.get("latitude"))?null:d.valid)),hr(11),dr("hidden",(null==(m=t.droneForm.get("endLngLatCoords"))||null==(v=m.get("longitude"))?null:v.untouched)||(null==(m=t.droneForm.get("startLngLatCoords"))||null==(v=m.get("latitude"))?null:v.valid)),hr(8),dr("hidden",(null==(w=t.droneForm.get("endLngLatCoords"))||null==(D=w.get("latitude"))?null:D.untouched)||(null==(w=t.droneForm.get("startLngLatCoords"))||null==(D=w.get("latitude"))?null:D.valid)),hr(4),dr("disabled",!t.droneForm.valid)}}const lW=[{path:"about",component:b8},{path:"droneAnimation",component:(()=>{class e{get f(){return this.droneForm.controls}constructor(t,r){this.formBuilder=t,this.renderer=r,this.droneForm={},this.submitButtonClicked=!1,this.startText="start",this.animationFrame=null,this.animationPhase=0,this.resetTime=!1,this.pauseButtonText="simulatePause",this.start=null,this.animationTimeDuration="1000",this.marker=null,this.geojson=null,this.popup=null,this.startCoords={longitude:-122.662324,latitude:45.523696},this.endCoords={longitude:-122.61597,latitude:45.537218},this.droneData={startLngLatCoords:{longitude:0,latitude:0},endLngLatCoords:{longitude:0,latitude:0},animationTimeDuration:"0"},this.frame=i=>{const s=this.droneForm.get("animationTimeDuration")?.value,d=Mv(this.geojson.geometry.coordinates),m=function D$(e,n){return void 0===n&&(n={}),function M8(e,n,t){var r=t,i=!1;return function I8(e,n){Gb(e,function(t,r,i){var s=0;if(t.geometry){var d=t.geometry.type;if("Point"!==d&&"MultiPoint"!==d){var m,v=0,w=0,D=0;if(!1===Av(t,function(N,O,k,Q,X){if(void 0===m||r>v||Q>w||X>D)return m=N,v=r,w=Q,D=X,void(s=0);var _e=Mv([m,N],t.properties);if(!1===n(_e,r,i,X,s))return!1;s++,m=N}))return!1}}})}(e,function(s,d,m,v,w){r=!1===i&&void 0===t?s:n(r,s,d,m,v,w),i=!0}),r}(e,function(t,r){var i=r.geometry.coordinates;return t+IR(i[0],i[1],n)},0)}(d);if(this.start||(this.start=i),this.resetTime?(this.animationPhase=(i-this.start)/s,this.resetTime=!1):this.animationPhase=(i-this.start)/s,this.animationPhase>1)return;const v=Math.round(100*this.animationPhase);this.popup.setHTML(v+"% path completed");const w=function S$(e,n,t){void 0===t&&(t={});for(var i=wR(e).coordinates,s=0,d=0;d<i.length&&!(n>=s&&d===i.length-1);d++){if(s>=n){var m=n-s;if(m){var v=kR(i[d],i[d-1])-180;return d$(i[d],m,v,t)}return nm(i[d])}s+=IR(i[d],i[d+1],t)}return nm(i[i.length-1])}(d,m*this.animationPhase).geometry.coordinates;this.marker.setLngLat({lng:w[0],lat:w[1]}),this.map.setBearing((150-40*this.animationPhase)%360),this.animationFrame=window.requestAnimationFrame(this.frame)}}ngOnInit(){this.initializeForm(),this.buildForm(),this.initSubscription()}initializeForm(){this.droneData={startLngLatCoords:this.startCoords,endLngLatCoords:this.endCoords,animationTimeDuration:"5000"}}buildForm(){this.droneForm=this.formBuilder.group({animationTimeDuration:[this.droneData.animationTimeDuration,[Kv.required]],startLngLatCoords:this.formBuilder.group({longitude:[this.droneData.startLngLatCoords.longitude,Kv.required],latitude:[this.droneData.startLngLatCoords.latitude,Kv.required]}),endLngLatCoords:this.formBuilder.group({longitude:[this.droneData.endLngLatCoords.longitude,Kv.required],latitude:[this.droneData.endLngLatCoords.latitude,Kv.required]})})}initSubscription(){}buildMap(){var t=this;this.map=new zb.Map({accessToken:Vb_mapbox_accessToken,container:"map",style:"mapbox://styles/mapbox/streets-v12",center:[this.droneData.startLngLatCoords.longitude,this.droneData.startLngLatCoords.latitude],zoom:13}),this.map.on("load",Bb(function*(){t.map.resize();const s=t.droneForm.value,d=[s.startLngLatCoords.longitude,s.startLngLatCoords.latitude],m=[s.endLngLatCoords.longitude,s.endLngLatCoords.latitude];yield t.getRoute(d),t.map.addLayer({id:"point",type:"circle",source:{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:d}}]}},paint:{"circle-radius":10,"circle-color":"pink"}}),t.setEnd(m),yield t.getRoute(m),t.addMarkerObject(),t.map.on("click",function(){var v=Bb(function*(w){const D=w.lngLat,N=Object.keys(D).map(O=>D[O]);t.popup.remove(),t.resetForm(),t.setEnd(N),yield t.getRoute(N),t.addMarkerObject()});return function(w){return v.apply(this,arguments)}}())}))}setEnd(t){const r={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:t}}]};this.map.getLayer("end")?this.map.getSource("end").setData(r):this.map.addLayer({id:"end",type:"circle",source:{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:t}}]}},paint:{"circle-radius":10,"circle-color":"yellow"}})}getRoute(t){var r=this;return Bb(function*(){const i=r.droneForm.get("startLngLatCoords")?.value,s=[i.longitude,i.latitude],m=yield(yield fetch(`https://api.mapbox.com/directions/v5/mapbox/cycling/${s[0]},${s[1]};${t[0]},${t[1]}?steps=true&geometries=geojson&access_token=${Vb_mapbox_accessToken}`,{method:"GET"})).json();m.message?alert(JSON.stringify(m)):(r.geojson={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:m.routes[0].geometry.coordinates}},r.map.getSource("route")?r.map.getSource("route").setData(r.geojson):r.map.addLayer({id:"route",type:"line",source:{type:"geojson",data:r.geojson},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"blue","line-width":5,"line-opacity":.75}}))})()}toggleAnimation(){const t=this.droneForm.get("animationTimeDuration")?.value;"simulatePause"===this.pauseButtonText?(cancelAnimationFrame(this.animationFrame),this.animationFrame=null,this.pauseButtonText="simulatePlay"):(this.resetTime=!0,this.start=performance.now()-this.animationPhase*t,this.animationFrame=window.requestAnimationFrame(this.frame),this.pauseButtonText="simulatePause")}submit({}){this.submitButtonClicked=!0,this.buildMap()}addMarkerObject(){if(null!==this.popup)return;this.popup=new zb.Popup({closeButton:!1});const t=this.renderer.createElement("div");t.className="marker",this.marker=new zb.Marker(t).setLngLat(this.geojson.geometry.coordinates[0]).setPopup(this.popup).addTo(this.map).togglePopup()}startAnimationBtnClick(){this.resetForm(),null===this.animationFrame&&(this.animationFrame=window.requestAnimationFrame(this.frame))}stopAnimationBtnClick(){this.resetForm()}resetForm(){const r=this.droneForm.value.animationTimeDuration,i=this.droneForm.get("startLngLatCoords")?.value,s=[i.longitude,i.latitude];cancelAnimationFrame(this.animationFrame),this.animationPhase=0,this.pauseButtonText="simulatePause",this.start=null,this.animationFrame=null,this.resetTime=!1,this.start=null,this.animationTimeDuration=r,this.marker.setLngLat(s),this.popup.setHTML("0% path completed")}}return e.\u0275fac=function(t){return new(t||e)(wt(rW),wt(Ju))},e.\u0275cmp=Bi({type:e,selectors:[["app-drone-animation"]],viewQuery:function(t,r){if(1&t&&Gp(sW,5),2&t){let i;As(i=Ns())&&(r.mapContainer=i.first)}},decls:10,vars:11,consts:[["class","container",4,"ngIf"],["id","amir",1,"label",3,"hidden"],["id","map"],["mapContainer",""],["id","playPauseBtn",3,"hidden","click"],["id","startBtn",3,"click"],["id","stopBtn",3,"click"],[1,"container"],[1,"row"],[1,"col-sm-12","p-5"],[1,"text-center"],[1,"col-sm-4"],["novalidate","",1,"login-form",3,"formGroup","ngSubmit"],[1,"col-md-2"],[1,"col-md-10"],["title","Time required in ms","type","number","id","time","name","time","formControlName","animationTimeDuration","inputmode","numeric",1,"form-control"],["data-cy","email-error",1,"alert","alert-danger",3,"hidden"],[1,"pt-4"],["formGroupName","startLngLatCoords"],[1,"col-md-1"],[1,"col-md-9"],["title","Enter longitude","type","number","id","longitude","name","longitude","formControlName","longitude","inputmode","numeric",1,"form-control"],["title","Enter latitude","type","number","id","latitude","name","latitude","formControlName","latitude","inputmode","numeric",1,"form-control"],["formGroupName","endLngLatCoords"],[1,"col-md-12"],["type","submit",1,"btn","btn-success",3,"disabled"]],template:function(t,r){1&t&&(function jr(e,n,t,r,i,s,d,m){const v=cn(),w=Li(),D=e+Di,N=w.firstCreatePass?function E3(e,n,t,r,i,s,d,m,v){const w=n.consts,D=a(n,e,4,d||null,br(w,m));Xt(n,t,D,br(w,v)),cg(n,D);const N=D.tView=P(2,D,r,i,s,n.directiveRegistry,n.pipeRegistry,null,n.schemas,w,null);return null!==n.queries&&(n.queries.template(n,D),N.queries=n.queries.embeddedTView(D)),D}(D,w,v,n,t,r,i,s,d):w.data[D];Ru(N,!1);const O=mM(w,v,N,e);bf()&&Wm(w,v,O,N),yl(O,v),Do(v,v[D]=Zr(O,v,O,N)),ba(N)&&E(w,v,N),null!=d&&S(v,N,m)}(0,aW,58,7,"div",0),Un(1,"div",1),za(2,"div",2,3),Un(4,"button",4),$i("click",function(){return r.toggleAnimation()}),ui(5),Jn(),Un(6,"button",5),$i("click",function(){return r.startAnimationBtnClick()}),ui(7),Jn(),Un(8,"button",6),$i("click",function(){return r.stopAnimationBtnClick()}),ui(9,"Stop"),Jn()()),2&t&&(dr("ngIf",!r.submitButtonClicked),hr(1),kC("position","relative")("height","90vh")("width","100%"),dr("hidden",!(r.droneForm.valid&&r.submitButtonClicked)),hr(3),dr("hidden",!r.start),hr(1),bd(r.pauseButtonText),hr(2),bd(r.startText))},dependencies:[Xp,zk,Tw,JT,Ck,Sk,Bw,tI,zw],styles:["body[_ngcontent-%COMP%]{margin:0;padding:0}#map[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;width:100%}button[_ngcontent-%COMP%]{margin:20px;position:absolute}#playPauseBtn[_ngcontent-%COMP%]{left:60px;top:0}#startBtn[_ngcontent-%COMP%]{left:0;top:0}#stopBtn[_ngcontent-%COMP%]{left:0;top:40px}.mapboxgl-popup[_ngcontent-%COMP%]{max-width:200px}.marker[_ngcontent-%COMP%]{background-image:url(drone.41582edffa842adf.png);width:55px;height:30px;background-size:cover;border-radius:50%;background-position:center top}"]}),e})()},{path:"otherMap",component:w8},{path:"**",pathMatch:"full",redirectTo:"/about"}];let uW=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({imports:[Fb.forRoot(lW),Fb]}),e})();const cW=function(){return["/about"]},hW=function(){return["/droneAnimation"]};let dW=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Bi({type:e,selectors:[["app-navbar"]],decls:15,vars:4,consts:[[1,"navbar","navbar-expand-lg","navbar-light","bg-primary","p-4"],[1,"container-fluid"],["href","#",1,"navbar-brand"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarText","aria-controls","navbarText","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarText",1,"collapse","navbar-collapse"],[1,"navbar-nav","me-auto","mb-2","mb-lg-0"],[1,"nav-item"],["routerLinkActive","active",1,"nav-link",3,"routerLink"]],template:function(t,r){1&t&&(Un(0,"nav",0)(1,"div",1)(2,"a",2)(3,"b"),ui(4,"Drone Launch Demo"),Jn()(),Un(5,"button",3),za(6,"span",4),Jn(),Un(7,"div",5)(8,"ul",6)(9,"li",7)(10,"a",8),ui(11,"About"),Jn()(),Un(12,"li",7)(13,"a",8),ui(14,"Drone"),Jn()()()()()()),2&t&&(hr(10),dr("routerLink",ZC(2,cW)),hr(3),dr("routerLink",ZC(3,hW)))},dependencies:[kb,aR],styles:[".navbar[_ngcontent-%COMP%]   .navbar-brand[_ngcontent-%COMP%]{color:#7fff00}.navbar[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:#fff}"]}),e})(),fW=(()=>{class e{constructor(){this.title="ng-drone"}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=Bi({type:e,selectors:[["app-root"]],decls:2,vars:0,template:function(t,r){1&t&&za(0,"app-navbar")(1,"router-outlet")},dependencies:[vD,dW]}),e})();const pW=["addListener","removeListener"],gW=["addEventListener","removeEventListener"],mW=["on","off"];function zu(e,n,t,r){if(Ee(t)&&(r=t,t=void 0),r)return zu(e,n,t).pipe(nD(r));const[i,s]=function vW(e){return Ee(e.addEventListener)&&Ee(e.removeEventListener)}(e)?gW.map(d=>m=>e[d](n,m,t)):function _W(e){return Ee(e.addListener)&&Ee(e.removeListener)}(e)?pW.map(oF(e,n)):function yW(e){return Ee(e.on)&&Ee(e.off)}(e)?mW.map(oF(e,n)):[];if(!i&&Lt(e))return Ps(d=>zu(d,n,t))(Jr(e));if(!i)throw new TypeError("Invalid event target");return new Ae(d=>{const m=(...v)=>d.next(1<v.length?v:v[0]);return i(m),()=>s(m)})}function oF(e,n){return t=>r=>e[t](n,r)}class xW extends be{constructor(n,t){super()}schedule(n,t=0){return this}}const Vw={setInterval(e,n,...t){const{delegate:r}=Vw;return r?.setInterval?r.setInterval(e,n,...t):setInterval(e,n,...t)},clearInterval(e){const{delegate:n}=Vw;return(n?.clearInterval||clearInterval)(e)},delegate:void 0},sF={now:()=>(sF.delegate||Date).now(),delegate:void 0};class o1{constructor(n,t=o1.now){this.schedulerActionCtor=n,this.now=t}schedule(n,t=0,r){return new this.schedulerActionCtor(this,n).schedule(r,t)}}o1.now=sF.now;const EW=new class wW extends o1{constructor(n,t=o1.now){super(n,t),this.actions=[],this._active=!1}flush(n){const{actions:t}=this;if(this._active)return void t.push(n);let r;this._active=!0;do{if(r=n.execute(n.state,n.delay))break}while(n=t.shift());if(this._active=!1,r){for(;n=t.shift();)n.unsubscribe();throw r}}}(class bW extends xW{constructor(n,t){super(n,t),this.scheduler=n,this.work=t,this.pending=!1}schedule(n,t=0){var r;if(this.closed)return this;this.state=n;const i=this.id,s=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(s,i,t)),this.pending=!0,this.delay=t,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(s,this.id,t),this}requestAsyncId(n,t,r=0){return Vw.setInterval(n.flush.bind(n,this),r)}recycleAsyncId(n,t,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&Vw.clearInterval(t)}execute(n,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(n,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,t){let i,r=!1;try{this.work(n)}catch(s){r=!0,i=s||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){const{id:n,scheduler:t}=this,{actions:r}=t;this.work=this.state=this.scheduler=null,this.pending=!1,p(r,this),null!=n&&(this.id=this.recycleAsyncId(t,n,null)),this.delay=null,super.unsubscribe()}}});const{isArray:SW}=Array;function uF(e){return 1===e.length&&SW(e[0])?e[0]:e}function oI(...e){const n=Tu(e),t=uF(e);return t.length?new Ae(r=>{let i=t.map(()=>[]),s=t.map(()=>!1);r.add(()=>{i=s=null});for(let d=0;!r.closed&&d<t.length;d++)Jr(t[d]).subscribe(Dn(r,m=>{if(i[d].push(m),i.every(v=>v.length)){const v=i.map(w=>w.shift());r.next(n?n(...v):v),i.some((w,D)=>!w.length&&s[D])&&r.complete()}},()=>{s[d]=!0,!i[d].length&&r.complete()}));return()=>{i=s=null}}):vi}function Fl(e){return Nn((n,t)=>{Jr(e).subscribe(Dn(t,()=>t.complete(),mt)),!t.closed&&n.subscribe(t)})}function sI(...e){const n=Tu(e);return Nn((t,r)=>{const i=e.length,s=new Array(i);let d=e.map(()=>!1),m=!1;for(let v=0;v<i;v++)Jr(e[v]).subscribe(Dn(r,w=>{s[v]=w,!m&&!d[v]&&(d[v]=!0,(m=d.every(At))&&(d=null))},mt));t.subscribe(Dn(r,v=>{if(m){const w=[v,...s];r.next(n?n(...w):w)}}))})}Math,Math,Math;const UZ=["*"],_X=["dialog"];function dm(e){return"string"==typeof e}function fm(e){return null!=e}function ay(e){return(e||document.body).getBoundingClientRect()}const PF={animation:!0,transitionTimerDelayMs:5},uY=()=>{},{transitionTimerDelayMs:cY}=PF,d1=new Map,Kc=(e,n,t,r)=>{let i=r.context||{};const s=d1.get(n);if(s)switch(r.runningTransition){case"continue":return vi;case"stop":e.run(()=>s.transition$.complete()),i=Object.assign(s.context,i),d1.delete(n)}const d=t(n,r.animation,i)||uY;if(!r.animation||"none"===window.getComputedStyle(n).transitionProperty)return e.run(()=>d()),Rn(void 0).pipe(function aY(e){return n=>new Ae(t=>n.subscribe({next:d=>e.run(()=>t.next(d)),error:d=>e.run(()=>t.error(d)),complete:()=>e.run(()=>t.complete())}))}(e));const m=new It,v=new It,w=m.pipe(function TW(...e){return n=>hv(n,Rn(...e))}(!0));d1.set(n,{transition$:m,complete:()=>{v.next(),v.complete()},context:i});const D=function lY(e){const{transitionDelay:n,transitionDuration:t}=window.getComputedStyle(e);return 1e3*(parseFloat(n)+parseFloat(t))}(n);return e.runOutsideAngular(()=>{const N=zu(n,"transitionend").pipe(Fl(w),Su(({target:k})=>k===n));(function cF(...e){return 1===(e=uF(e)).length?Jr(e[0]):new Ae(function DW(e){return n=>{let t=[];for(let r=0;t&&!n.closed&&r<e.length;r++)t.push(Jr(e[r]).subscribe(Dn(n,i=>{if(t){for(let s=0;s<t.length;s++)s!==r&&t[s].unsubscribe();t=null}n.next(i)})))}}(e))})(function lF(e=0,n,t=EW){let r=-1;return null!=n&&(Na(n)?t=n:r=n),new Ae(i=>{let s=function CW(e){return e instanceof Date&&!isNaN(e)}(e)?+e-t.now():e;s<0&&(s=0);let d=0;return t.schedule(function(){i.closed||(i.next(d++),0<=r?this.schedule(void 0,r):i.complete())},s)})}(D+cY).pipe(Fl(w)),N,v).pipe(Fl(w)).subscribe(()=>{d1.delete(n),e.run(()=>{d(),m.next(),m.complete()})})}),m.asObservable()};let Hw=(()=>{class e{constructor(){this.animation=PF.animation}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),UF=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})(),jF=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})(),HF=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})(),qF=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})();var na=function(e){return e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Escape=27]="Escape",e[e.Space=32]="Space",e[e.PageUp=33]="PageUp",e[e.PageDown=34]="PageDown",e[e.End=35]="End",e[e.Home=36]="Home",e[e.ArrowLeft=37]="ArrowLeft",e[e.ArrowUp=38]="ArrowUp",e[e.ArrowRight=39]="ArrowRight",e[e.ArrowDown=40]="ArrowDown",e}(na||{});typeof navigator<"u"&&navigator.userAgent&&(/iPad|iPhone|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2||/Android/.test(navigator.userAgent));const QF=["a[href]","button:not([disabled])",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])","[contenteditable]",'[tabindex]:not([tabindex="-1"])'].join(", ");function eB(e){const n=Array.from(e.querySelectorAll(QF)).filter(t=>-1!==t.tabIndex);return[n[0],n[n.length-1]]}new Date(1882,10,12),new Date(2174,10,25);let fB=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})(),mB=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})();class ym{constructor(n,t,r){this.nodes=n,this.viewRef=t,this.componentRef=r}}let uK=(()=>{class e{constructor(t,r){this._el=t,this._zone=r}ngOnInit(){this._zone.onStable.asObservable().pipe(Lu(1)).subscribe(()=>{Kc(this._zone,this._el.nativeElement,(t,r)=>{r&&ay(t),t.classList.add("show")},{animation:this.animation,runningTransition:"continue"})})}hide(){return Kc(this._zone,this._el.nativeElement,({classList:t})=>t.remove("show"),{animation:this.animation,runningTransition:"stop"})}}return e.\u0275fac=function(t){return new(t||e)(wt(Yo),wt(ds))},e.\u0275cmp=Bi({type:e,selectors:[["ngb-modal-backdrop"]],hostAttrs:[2,"z-index","1055"],hostVars:6,hostBindings:function(t,r){2&t&&(Zg("modal-backdrop"+(r.backdropClass?" "+r.backdropClass:"")),hs("show",!r.animation)("fade",r.animation))},inputs:{animation:"animation",backdropClass:"backdropClass"},standalone:!0,features:[jh],decls:0,vars:0,template:function(t,r){},encapsulation:2}),e})();class _B{update(n){}close(n){}dismiss(n){}}const cK=["animation","ariaLabelledBy","ariaDescribedBy","backdrop","centered","fullscreen","keyboard","scrollable","size","windowClass","modalDialogClass"],hK=["animation","backdropClass"];class dK{_applyWindowOptions(n,t){cK.forEach(r=>{fm(t[r])&&(n[r]=t[r])})}_applyBackdropOptions(n,t){hK.forEach(r=>{fm(t[r])&&(n[r]=t[r])})}update(n){this._applyWindowOptions(this._windowCmptRef.instance,n),this._backdropCmptRef&&this._backdropCmptRef.instance&&this._applyBackdropOptions(this._backdropCmptRef.instance,n)}get componentInstance(){if(this._contentRef&&this._contentRef.componentRef)return this._contentRef.componentRef.instance}get closed(){return this._closed.asObservable().pipe(Fl(this._hidden))}get dismissed(){return this._dismissed.asObservable().pipe(Fl(this._hidden))}get hidden(){return this._hidden.asObservable()}get shown(){return this._windowCmptRef.instance.shown.asObservable()}constructor(n,t,r,i){this._windowCmptRef=n,this._contentRef=t,this._backdropCmptRef=r,this._beforeDismiss=i,this._closed=new It,this._dismissed=new It,this._hidden=new It,n.instance.dismissEvent.subscribe(s=>{this.dismiss(s)}),this.result=new Promise((s,d)=>{this._resolve=s,this._reject=d}),this.result.then(null,()=>{})}close(n){this._windowCmptRef&&(this._closed.next(n),this._resolve(n),this._removeModalElements())}_dismiss(n){this._dismissed.next(n),this._reject(n),this._removeModalElements()}dismiss(n){if(this._windowCmptRef)if(this._beforeDismiss){const t=this._beforeDismiss();!function MF(e){return e&&e.then}(t)?!1!==t&&this._dismiss(n):t.then(r=>{!1!==r&&this._dismiss(n)},()=>{})}else this._dismiss(n)}_removeModalElements(){const n=this._windowCmptRef.instance.hide(),t=this._backdropCmptRef?this._backdropCmptRef.instance.hide():Rn(void 0);n.subscribe(()=>{const{nativeElement:r}=this._windowCmptRef.location;r.parentNode.removeChild(r),this._windowCmptRef.destroy(),this._contentRef&&this._contentRef.viewRef&&this._contentRef.viewRef.destroy(),this._windowCmptRef=null,this._contentRef=null}),t.subscribe(()=>{if(this._backdropCmptRef){const{nativeElement:r}=this._backdropCmptRef.location;r.parentNode.removeChild(r),this._backdropCmptRef.destroy(),this._backdropCmptRef=null}}),oI(n,t).subscribe(()=>{this._hidden.next(),this._hidden.complete()})}}var AI=function(e){return e[e.BACKDROP_CLICK=0]="BACKDROP_CLICK",e[e.ESC=1]="ESC",e}(AI||{});let fK=(()=>{class e{constructor(t,r,i){this._document=t,this._elRef=r,this._zone=i,this._closed$=new It,this._elWithFocus=null,this.backdrop=!0,this.keyboard=!0,this.dismissEvent=new zr,this.shown=new It,this.hidden=new It}get fullscreenClass(){return!0===this.fullscreen?" modal-fullscreen":dm(this.fullscreen)?` modal-fullscreen-${this.fullscreen}-down`:""}dismiss(t){this.dismissEvent.emit(t)}ngOnInit(){this._elWithFocus=this._document.activeElement,this._zone.onStable.asObservable().pipe(Lu(1)).subscribe(()=>{this._show()})}ngOnDestroy(){this._disableEventHandling()}hide(){const{nativeElement:t}=this._elRef,r={animation:this.animation,runningTransition:"stop"},d=oI(Kc(this._zone,t,()=>t.classList.remove("show"),r),Kc(this._zone,this._dialogEl.nativeElement,()=>{},r));return d.subscribe(()=>{this.hidden.next(),this.hidden.complete()}),this._disableEventHandling(),this._restoreFocus(),d}_show(){const t={animation:this.animation,runningTransition:"continue"};oI(Kc(this._zone,this._elRef.nativeElement,(s,d)=>{d&&ay(s),s.classList.add("show")},t),Kc(this._zone,this._dialogEl.nativeElement,()=>{},t)).subscribe(()=>{this.shown.next(),this.shown.complete()}),this._enableEventHandling(),this._setFocus()}_enableEventHandling(){const{nativeElement:t}=this._elRef;this._zone.runOutsideAngular(()=>{zu(t,"keydown").pipe(Fl(this._closed$),Su(i=>i.which===na.Escape)).subscribe(i=>{this.keyboard?requestAnimationFrame(()=>{i.defaultPrevented||this._zone.run(()=>this.dismiss(AI.ESC))}):"static"===this.backdrop&&this._bumpBackdrop()});let r=!1;zu(this._dialogEl.nativeElement,"mousedown").pipe(Fl(this._closed$),ku(()=>r=!1),ur(()=>zu(t,"mouseup").pipe(Fl(this._closed$),Lu(1))),Su(({target:i})=>t===i)).subscribe(()=>{r=!0}),zu(t,"click").pipe(Fl(this._closed$)).subscribe(({target:i})=>{t===i&&("static"===this.backdrop?this._bumpBackdrop():!0===this.backdrop&&!r&&this._zone.run(()=>this.dismiss(AI.BACKDROP_CLICK))),r=!1})})}_disableEventHandling(){this._closed$.next()}_setFocus(){const{nativeElement:t}=this._elRef;if(!t.contains(document.activeElement)){const r=t.querySelector("[ngbAutofocus]"),i=eB(t)[0];(r||i||t).focus()}}_restoreFocus(){const t=this._document.body,r=this._elWithFocus;let i;i=r&&r.focus&&t.contains(r)?r:t,this._zone.runOutsideAngular(()=>{setTimeout(()=>i.focus()),this._elWithFocus=null})}_bumpBackdrop(){"static"===this.backdrop&&Kc(this._zone,this._elRef.nativeElement,({classList:t})=>(t.add("modal-static"),()=>t.remove("modal-static")),{animation:this.animation,runningTransition:"continue"})}}return e.\u0275fac=function(t){return new(t||e)(wt(ou),wt(Yo),wt(ds))},e.\u0275cmp=Bi({type:e,selectors:[["ngb-modal-window"]],viewQuery:function(t,r){if(1&t&&Gp(_X,7),2&t){let i;As(i=Ns())&&(r._dialogEl=i.first)}},hostAttrs:["role","dialog","tabindex","-1"],hostVars:7,hostBindings:function(t,r){2&t&&(Ms("aria-modal",!0)("aria-labelledby",r.ariaLabelledBy)("aria-describedby",r.ariaDescribedBy),Zg("modal d-block"+(r.windowClass?" "+r.windowClass:"")),hs("fade",r.animation))},inputs:{animation:"animation",ariaLabelledBy:"ariaLabelledBy",ariaDescribedBy:"ariaDescribedBy",backdrop:"backdrop",centered:"centered",fullscreen:"fullscreen",keyboard:"keyboard",scrollable:"scrollable",size:"size",windowClass:"windowClass",modalDialogClass:"modalDialogClass"},outputs:{dismissEvent:"dismiss"},standalone:!0,features:[jh],ngContentSelectors:UZ,decls:4,vars:2,consts:[["role","document"],["dialog",""],[1,"modal-content"]],template:function(t,r){1&t&&(function DM(e){const n=cn()[vn][Oa];if(!n.projection){const r=n.projection=Sf(e?e.length:1,null),i=r.slice();let s=n.child;for(;null!==s;){const d=e?O3(s,e):0;null!==d&&(i[d]?i[d].projectionNext=s:r[d]=s,i[d]=s),s=s.next}}}(),Un(0,"div",0,1)(2,"div",2),function TM(e,n=0,t){const r=cn(),i=Li(),s=a(i,Di+e,16,null,t||null);null===s.projection&&(s.projection=n),vf(),(!r[Xl]||ko())&&32!=(32&s.flags)&&function Ag(e,n,t){n0(n[Pr],0,n,t,Xy(e,t,n),Ky(t.parent||n[Oa],t,n))}(i,r,s)}(3),Jn()()),2&t&&Zg("modal-dialog"+(r.size?" modal-"+r.size:"")+(r.centered?" modal-dialog-centered":"")+r.fullscreenClass+(r.scrollable?" modal-dialog-scrollable":"")+(r.modalDialogClass?" "+r.modalDialogClass:""))},styles:["ngb-modal-window .component-host-scrollable{display:flex;flex-direction:column;overflow:hidden}\n"],encapsulation:2}),e})(),pK=(()=>{class e{constructor(t){this._document=t}hide(){const t=Math.abs(window.innerWidth-this._document.documentElement.clientWidth),r=this._document.body,i=r.style,{overflow:s,paddingRight:d}=i;if(t>0){const m=parseFloat(window.getComputedStyle(r).paddingRight);i.paddingRight=`${m+t}px`}return i.overflow="hidden",()=>{t>0&&(i.paddingRight=d),i.overflow=s}}}return e.\u0275fac=function(t){return new(t||e)(jn(ou))},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),gK=(()=>{class e{constructor(t,r,i,s,d,m,v){this._applicationRef=t,this._injector=r,this._environmentInjector=i,this._document=s,this._scrollBar=d,this._rendererFactory=m,this._ngZone=v,this._activeWindowCmptHasChanged=new It,this._ariaHiddenValues=new Map,this._scrollBarRestoreFn=null,this._modalRefs=[],this._windowCmpts=[],this._activeInstances=new zr,this._activeWindowCmptHasChanged.subscribe(()=>{if(this._windowCmpts.length){const w=this._windowCmpts[this._windowCmpts.length-1];((e,n,t,r=!1)=>{e.runOutsideAngular(()=>{const i=zu(n,"focusin").pipe(Fl(t),bn(s=>s.target));zu(n,"keydown").pipe(Fl(t),Su(s=>s.which===na.Tab),sI(i)).subscribe(([s,d])=>{const[m,v]=eB(n);(d===m||d===n)&&s.shiftKey&&(v.focus(),s.preventDefault()),d===v&&!s.shiftKey&&(m.focus(),s.preventDefault())}),r&&zu(n,"click").pipe(Fl(t),sI(i),bn(s=>s[1])).subscribe(s=>s.focus())})})(this._ngZone,w.location.nativeElement,this._activeWindowCmptHasChanged),this._revertAriaHidden(),this._setAriaHidden(w.location.nativeElement)}})}_restoreScrollBar(){const t=this._scrollBarRestoreFn;t&&(this._scrollBarRestoreFn=null,t())}_hideScrollBar(){this._scrollBarRestoreFn||(this._scrollBarRestoreFn=this._scrollBar.hide())}open(t,r,i){const s=i.container instanceof HTMLElement?i.container:fm(i.container)?this._document.querySelector(i.container):this._document.body,d=this._rendererFactory.createRenderer(null,null);if(!s)throw new Error(`The specified modal container "${i.container||"body"}" was not found in the DOM.`);this._hideScrollBar();const m=new _B,v=(t=i.injector||t).get(hh,null)||this._environmentInjector,w=this._getContentRef(t,v,r,m,i);let D=!1!==i.backdrop?this._attachBackdrop(s):void 0,N=this._attachWindowComponent(s,w.nodes),O=new dK(N,w,D,i.beforeDismiss);return this._registerModalRef(O),this._registerWindowCmpt(N),O.hidden.pipe(Lu(1)).subscribe(()=>Promise.resolve(!0).then(()=>{this._modalRefs.length||(d.removeClass(this._document.body,"modal-open"),this._restoreScrollBar(),this._revertAriaHidden())})),m.close=k=>{O.close(k)},m.dismiss=k=>{O.dismiss(k)},m.update=k=>{O.update(k)},O.update(i),1===this._modalRefs.length&&d.addClass(this._document.body,"modal-open"),D&&D.instance&&D.changeDetectorRef.detectChanges(),N.changeDetectorRef.detectChanges(),O}get activeInstances(){return this._activeInstances}dismissAll(t){this._modalRefs.forEach(r=>r.dismiss(t))}hasOpenModals(){return this._modalRefs.length>0}_attachBackdrop(t){let r=DS(uK,{environmentInjector:this._applicationRef.injector,elementInjector:this._injector});return this._applicationRef.attachView(r.hostView),t.appendChild(r.location.nativeElement),r}_attachWindowComponent(t,r){let i=DS(fK,{environmentInjector:this._applicationRef.injector,elementInjector:this._injector,projectableNodes:r});return this._applicationRef.attachView(i.hostView),t.appendChild(i.location.nativeElement),i}_getContentRef(t,r,i,s,d){return i?i instanceof Ya?this._createFromTemplateRef(i,s):dm(i)?this._createFromString(i):this._createFromComponent(t,r,i,s,d):new ym([])}_createFromTemplateRef(t,r){const s=t.createEmbeddedView({$implicit:r,close(d){r.close(d)},dismiss(d){r.dismiss(d)}});return this._applicationRef.attachView(s),new ym([s.rootNodes],s)}_createFromString(t){const r=this._document.createTextNode(`${t}`);return new ym([[r]])}_createFromComponent(t,r,i,s,d){const v=DS(i,{environmentInjector:r,elementInjector:wu.create({providers:[{provide:_B,useValue:s}],parent:t})}),w=v.location.nativeElement;return d.scrollable&&w.classList.add("component-host-scrollable"),this._applicationRef.attachView(v.hostView),new ym([[w]],v.hostView,v)}_setAriaHidden(t){const r=t.parentElement;r&&t!==this._document.body&&(Array.from(r.children).forEach(i=>{i!==t&&"SCRIPT"!==i.nodeName&&(this._ariaHiddenValues.set(i,i.getAttribute("aria-hidden")),i.setAttribute("aria-hidden","true"))}),this._setAriaHidden(r))}_revertAriaHidden(){this._ariaHiddenValues.forEach((t,r)=>{t?r.setAttribute("aria-hidden",t):r.removeAttribute("aria-hidden")}),this._ariaHiddenValues.clear()}_registerModalRef(t){const r=()=>{const i=this._modalRefs.indexOf(t);i>-1&&(this._modalRefs.splice(i,1),this._activeInstances.emit(this._modalRefs))};this._modalRefs.push(t),this._activeInstances.emit(this._modalRefs),t.result.then(r,r)}_registerWindowCmpt(t){this._windowCmpts.push(t),this._activeWindowCmptHasChanged.next(),t.onDestroy(()=>{const r=this._windowCmpts.indexOf(t);r>-1&&(this._windowCmpts.splice(r,1),this._activeWindowCmptHasChanged.next())})}}return e.\u0275fac=function(t){return new(t||e)(jn(Hp),jn(wu),jn(hh),jn(ou),jn(pK),jn(C0),jn(ds))},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),mK=(()=>{class e{constructor(t){this._ngbConfig=t,this.backdrop=!0,this.fullscreen=!1,this.keyboard=!0}get animation(){return void 0===this._animation?this._ngbConfig.animation:this._animation}set animation(t){this._animation=t}}return e.\u0275fac=function(t){return new(t||e)(jn(Hw))},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),_K=(()=>{class e{constructor(t,r,i){this._injector=t,this._modalStack=r,this._config=i}open(t,r={}){const i={...this._config,animation:this._config.animation,...r};return this._modalStack.open(this._injector,t,i)}get activeInstances(){return this._modalStack.activeInstances}dismissAll(t){this._modalStack.dismissAll(t)}hasOpenModals(){return this._modalStack.hasOpenModals()}}return e.\u0275fac=function(t){return new(t||e)(jn(wu),jn(gK),jn(mK))},e.\u0275prov=Gn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),yB=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({providers:[_K]}),e})(),bB=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})(),MB=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})(),NB=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})(),PB=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})(),RB=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})(),OB=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})(),LB=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})(),kB=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})(),FB=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})();new wr("live announcer delay",{providedIn:"root",factory:function LK(){return 100}});let BB=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})(),zB=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({}),e})();const FK=[UF,jF,HF,qF,fB,mB,yB,bB,zB,MB,NB,PB,RB,OB,LB,kB,FB,BB];let BK=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({imports:[FK,UF,jF,HF,qF,fB,mB,yB,bB,zB,MB,NB,PB,RB,OB,LB,kB,FB,BB]}),e})(),zK=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e}),e.\u0275inj=Ti({imports:[Fb,kP,Fb]}),e})(),VK=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=Or({type:e,bootstrap:[fW]}),e.\u0275inj=Ti({providers:[{provide:Wp,useClass:yP}],imports:[U6,iW,oW,uW,zK,BK]}),e})();z6().bootstrapModule(VK).catch(e=>console.error(e))},1568:(sn,vt,qe)=>{"use strict";var ze=qe(8570);function ht(p){var be=[1/0,1/0,-1/0,-1/0];return ze.coordEach(p,function(Xe){be[0]>Xe[0]&&(be[0]=Xe[0]),be[1]>Xe[1]&&(be[1]=Xe[1]),be[2]<Xe[0]&&(be[2]=Xe[0]),be[3]<Xe[1]&&(be[3]=Xe[1])}),be}ht.default=ht,vt.Z=ht},621:(sn,vt)=>{"use strict";function qe(Ve,Ke,Te){void 0===Te&&(Te={});var Kt={type:"Feature"};return(0===Te.id||Te.id)&&(Kt.id=Te.id),Te.bbox&&(Kt.bbox=Te.bbox),Kt.properties=Ke||{},Kt.geometry=Ve,Kt}function ze(Ve,Ke,Te){if(void 0===Te&&(Te={}),!Ve)throw new Error("coordinates is required");if(!Array.isArray(Ve))throw new Error("coordinates must be an Array");if(Ve.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ne(Ve[0])||!ne(Ve[1]))throw new Error("coordinates must contain numbers");return qe({type:"Point",coordinates:Ve},Ke,Te)}function p(Ve,Ke,Te){void 0===Te&&(Te={});for(var Kt=0,At=Ve;Kt<At.length;Kt++){var we=At[Kt];if(we.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var at=0;at<we[we.length-1].length;at++)if(we[we.length-1][at]!==we[0][at])throw new Error("First and last Position are not equivalent.")}return qe({type:"Polygon",coordinates:Ve},Ke,Te)}function Xe(Ve,Ke,Te){if(void 0===Te&&(Te={}),Ve.length<2)throw new Error("coordinates must be an array of two or more positions");return qe({type:"LineString",coordinates:Ve},Ke,Te)}function ft(Ve,Ke){void 0===Ke&&(Ke={});var Te={type:"FeatureCollection"};return Ke.id&&(Te.id=Ke.id),Ke.bbox&&(Te.bbox=Ke.bbox),Te.features=Ve,Te}function Et(Ve,Ke,Te){return void 0===Te&&(Te={}),qe({type:"MultiLineString",coordinates:Ve},Ke,Te)}function rn(Ve,Ke,Te){return void 0===Te&&(Te={}),qe({type:"MultiPoint",coordinates:Ve},Ke,Te)}function Dt(Ve,Ke,Te){return void 0===Te&&(Te={}),qe({type:"MultiPolygon",coordinates:Ve},Ke,Te)}function hn(Ve,Ke){void 0===Ke&&(Ke="kilometers");var Te=vt.factors[Ke];if(!Te)throw new Error(Ke+" units is invalid");return Ve*Te}function de(Ve,Ke){void 0===Ke&&(Ke="kilometers");var Te=vt.factors[Ke];if(!Te)throw new Error(Ke+" units is invalid");return Ve/Te}function fe(Ve){return Ve%(2*Math.PI)*180/Math.PI}function ne(Ve){return!isNaN(Ve)&&null!==Ve&&!Array.isArray(Ve)}Object.defineProperty(vt,"__esModule",{value:!0}),vt.earthRadius=6371008.8,vt.factors={centimeters:100*vt.earthRadius,centimetres:100*vt.earthRadius,degrees:vt.earthRadius/111325,feet:3.28084*vt.earthRadius,inches:39.37*vt.earthRadius,kilometers:vt.earthRadius/1e3,kilometres:vt.earthRadius/1e3,meters:vt.earthRadius,metres:vt.earthRadius,miles:vt.earthRadius/1609.344,millimeters:1e3*vt.earthRadius,millimetres:1e3*vt.earthRadius,nauticalmiles:vt.earthRadius/1852,radians:1,yards:1.0936*vt.earthRadius},vt.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/vt.earthRadius,yards:1.0936133},vt.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},vt.feature=qe,vt.geometry=function Ee(Ve,Ke,Te){switch(void 0===Te&&(Te={}),Ve){case"Point":return ze(Ke).geometry;case"LineString":return Xe(Ke).geometry;case"Polygon":return p(Ke).geometry;case"MultiPoint":return rn(Ke).geometry;case"MultiLineString":return Et(Ke).geometry;case"MultiPolygon":return Dt(Ke).geometry;default:throw new Error(Ve+" is invalid")}},vt.point=ze,vt.points=function ht(Ve,Ke,Te){return void 0===Te&&(Te={}),ft(Ve.map(function(Kt){return ze(Kt,Ke)}),Te)},vt.polygon=p,vt.polygons=function be(Ve,Ke,Te){return void 0===Te&&(Te={}),ft(Ve.map(function(Kt){return p(Kt,Ke)}),Te)},vt.lineString=Xe,vt.lineStrings=function dt(Ve,Ke,Te){return void 0===Te&&(Te={}),ft(Ve.map(function(Kt){return Xe(Kt,Ke)}),Te)},vt.featureCollection=ft,vt.multiLineString=Et,vt.multiPoint=rn,vt.multiPolygon=Dt,vt.geometryCollection=function mt(Ve,Ke,Te){return void 0===Te&&(Te={}),qe({type:"GeometryCollection",geometries:Ve},Ke,Te)},vt.round=function Vt(Ve,Ke){if(void 0===Ke&&(Ke=0),Ke&&!(Ke>=0))throw new Error("precision must be a positive number");var Te=Math.pow(10,Ke||0);return Math.round(Ve*Te)/Te},vt.radiansToLength=hn,vt.lengthToRadians=de,vt.lengthToDegrees=function Ne(Ve,Ke){return fe(de(Ve,Ke))},vt.bearingToAzimuth=function ue(Ve){var Ke=Ve%360;return Ke<0&&(Ke+=360),Ke},vt.radiansToDegrees=fe,vt.degreesToRadians=function he(Ve){return Ve%360*Math.PI/180},vt.convertLength=function Fe(Ve,Ke,Te){if(void 0===Ke&&(Ke="kilometers"),void 0===Te&&(Te="kilometers"),!(Ve>=0))throw new Error("length must be a positive number");return hn(de(Ve,Ke),Te)},vt.convertArea=function ce(Ve,Ke,Te){if(void 0===Ke&&(Ke="meters"),void 0===Te&&(Te="kilometers"),!(Ve>=0))throw new Error("area must be a positive number");var Kt=vt.areaFactors[Ke];if(!Kt)throw new Error("invalid original units");var At=vt.areaFactors[Te];if(!At)throw new Error("invalid final units");return Ve/Kt*At},vt.isNumber=ne,vt.isObject=function Me(Ve){return!!Ve&&Ve.constructor===Object},vt.validateBBox=function ie(Ve){if(!Ve)throw new Error("bbox is required");if(!Array.isArray(Ve))throw new Error("bbox must be an Array");if(4!==Ve.length&&6!==Ve.length)throw new Error("bbox must be an Array of 4 or 6 numbers");Ve.forEach(function(Ke){if(!ne(Ke))throw new Error("bbox must only contain numbers")})},vt.validateId=function rt(Ve){if(!Ve)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof Ve))throw new Error("id must be a number or a string")}},8570:(sn,vt,qe)=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});var Ee=qe(621);function ze(he,Fe,ce){if(null!==he)for(var ne,Me,ie,rt,Ve,Ke,Te,we,Kt=0,At=0,at=he.type,Ae="FeatureCollection"===at,it="Feature"===at,pt=Ae?he.features.length:1,Ie=0;Ie<pt;Ie++){Ve=(we=!!(Te=Ae?he.features[Ie].geometry:it?he.geometry:he)&&"GeometryCollection"===Te.type)?Te.geometries.length:1;for(var Ut=0;Ut<Ve;Ut++){var It=0,yn=0;if(null!==(rt=we?Te.geometries[Ut]:Te)){Ke=rt.coordinates;var Mt=rt.type;switch(Kt=!ce||"Polygon"!==Mt&&"MultiPolygon"!==Mt?0:1,Mt){case null:break;case"Point":if(!1===Fe(Ke,At,Ie,It,yn))return!1;At++,It++;break;case"LineString":case"MultiPoint":for(ne=0;ne<Ke.length;ne++){if(!1===Fe(Ke[ne],At,Ie,It,yn))return!1;At++,"MultiPoint"===Mt&&It++}"LineString"===Mt&&It++;break;case"Polygon":case"MultiLineString":for(ne=0;ne<Ke.length;ne++){for(Me=0;Me<Ke[ne].length-Kt;Me++){if(!1===Fe(Ke[ne][Me],At,Ie,It,yn))return!1;At++}"MultiLineString"===Mt&&It++,"Polygon"===Mt&&yn++}"Polygon"===Mt&&It++;break;case"MultiPolygon":for(ne=0;ne<Ke.length;ne++){for(yn=0,Me=0;Me<Ke[ne].length;Me++){for(ie=0;ie<Ke[ne][Me].length-Kt;ie++){if(!1===Fe(Ke[ne][Me][ie],At,Ie,It,yn))return!1;At++}yn++}It++}break;case"GeometryCollection":for(ne=0;ne<rt.geometries.length;ne++)if(!1===ze(rt.geometries[ne],Fe,ce))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function p(he,Fe){var ce;switch(he.type){case"FeatureCollection":for(ce=0;ce<he.features.length&&!1!==Fe(he.features[ce].properties,ce);ce++);break;case"Feature":Fe(he.properties,0)}}function Xe(he,Fe){if("Feature"===he.type)Fe(he,0);else if("FeatureCollection"===he.type)for(var ce=0;ce<he.features.length&&!1!==Fe(he.features[ce],ce);ce++);}function Et(he,Fe){var ce,ne,Me,ie,rt,Ve,Ke,Te,Kt,At,we=0,at="FeatureCollection"===he.type,Ae="Feature"===he.type,it=at?he.features.length:1;for(ce=0;ce<it;ce++){for(Te=at?he.features[ce].properties:Ae?he.properties:{},Kt=at?he.features[ce].bbox:Ae?he.bbox:void 0,At=at?he.features[ce].id:Ae?he.id:void 0,rt=(Ke=!!(Ve=at?he.features[ce].geometry:Ae?he.geometry:he)&&"GeometryCollection"===Ve.type)?Ve.geometries.length:1,Me=0;Me<rt;Me++)if(null!==(ie=Ke?Ve.geometries[Me]:Ve))switch(ie.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===Fe(ie,we,Te,Kt,At))return!1;break;case"GeometryCollection":for(ne=0;ne<ie.geometries.length;ne++)if(!1===Fe(ie.geometries[ne],we,Te,Kt,At))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===Fe(null,we,Te,Kt,At))return!1;we++}}function Dt(he,Fe){Et(he,function(ce,ne,Me,ie,rt){var Ke,Ve=null===ce?null:ce.type;switch(Ve){case null:case"Point":case"LineString":case"Polygon":return!1!==Fe(Ee.feature(ce,Me,{bbox:ie,id:rt}),ne,0)&&void 0}switch(Ve){case"MultiPoint":Ke="Point";break;case"MultiLineString":Ke="LineString";break;case"MultiPolygon":Ke="Polygon"}for(var Te=0;Te<ce.coordinates.length;Te++)if(!1===Fe(Ee.feature({type:Ke,coordinates:ce.coordinates[Te]},Me),ne,Te))return!1})}function Vt(he,Fe){Dt(he,function(ce,ne,Me){var ie=0;if(ce.geometry){var rt=ce.geometry.type;if("Point"!==rt&&"MultiPoint"!==rt){var Ve,Ke=0,Te=0,Kt=0;if(!1===ze(ce,function(At,we,at,Ae,it){if(void 0===Ve||ne>Ke||Ae>Te||it>Kt)return Ve=At,Ke=ne,Te=Ae,Kt=it,void(ie=0);var pt=Ee.lineString([Ve,At],ce.properties);if(!1===Fe(pt,ne,Me,it,ie))return!1;ie++,Ve=At}))return!1}}})}function de(he,Fe){if(!he)throw new Error("geojson is required");Dt(he,function(ce,ne,Me){if(null!==ce.geometry){var rt=ce.geometry.coordinates;switch(ce.geometry.type){case"LineString":if(!1===Fe(ce,ne,Me,0,0))return!1;break;case"Polygon":for(var Ve=0;Ve<rt.length;Ve++)if(!1===Fe(Ee.lineString(rt[Ve],ce.properties),ne,Me,Ve))return!1}}})}vt.coordAll=function ft(he){var Fe=[];return ze(he,function(ce){Fe.push(ce)}),Fe},vt.coordEach=ze,vt.coordReduce=function ht(he,Fe,ce,ne){var Me=ce;return ze(he,function(ie,rt,Ve,Ke,Te){Me=0===rt&&void 0===ce?ie:Fe(Me,ie,rt,Ve,Ke,Te)},ne),Me},vt.featureEach=Xe,vt.featureReduce=function dt(he,Fe,ce){var ne=ce;return Xe(he,function(Me,ie){ne=0===ie&&void 0===ce?Me:Fe(ne,Me,ie)}),ne},vt.findPoint=function fe(he,Fe){if(!Ee.isObject(Fe=Fe||{}))throw new Error("options is invalid");var Ve,ce=Fe.featureIndex||0,ne=Fe.multiFeatureIndex||0,Me=Fe.geometryIndex||0,ie=Fe.coordIndex||0,rt=Fe.properties;switch(he.type){case"FeatureCollection":ce<0&&(ce=he.features.length+ce),rt=rt||he.features[ce].properties,Ve=he.features[ce].geometry;break;case"Feature":rt=rt||he.properties,Ve=he.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":Ve=he;break;default:throw new Error("geojson is invalid")}if(null===Ve)return null;var Ke=Ve.coordinates;switch(Ve.type){case"Point":return Ee.point(Ke,rt,Fe);case"MultiPoint":return ne<0&&(ne=Ke.length+ne),Ee.point(Ke[ne],rt,Fe);case"LineString":return ie<0&&(ie=Ke.length+ie),Ee.point(Ke[ie],rt,Fe);case"Polygon":return Me<0&&(Me=Ke.length+Me),ie<0&&(ie=Ke[Me].length+ie),Ee.point(Ke[Me][ie],rt,Fe);case"MultiLineString":return ne<0&&(ne=Ke.length+ne),ie<0&&(ie=Ke[ne].length+ie),Ee.point(Ke[ne][ie],rt,Fe);case"MultiPolygon":return ne<0&&(ne=Ke.length+ne),Me<0&&(Me=Ke[ne].length+Me),ie<0&&(ie=Ke[ne][Me].length-ie),Ee.point(Ke[ne][Me][ie],rt,Fe)}throw new Error("geojson is invalid")},vt.findSegment=function ue(he,Fe){if(!Ee.isObject(Fe=Fe||{}))throw new Error("options is invalid");var Ve,ce=Fe.featureIndex||0,ne=Fe.multiFeatureIndex||0,Me=Fe.geometryIndex||0,ie=Fe.segmentIndex||0,rt=Fe.properties;switch(he.type){case"FeatureCollection":ce<0&&(ce=he.features.length+ce),rt=rt||he.features[ce].properties,Ve=he.features[ce].geometry;break;case"Feature":rt=rt||he.properties,Ve=he.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":Ve=he;break;default:throw new Error("geojson is invalid")}if(null===Ve)return null;var Ke=Ve.coordinates;switch(Ve.type){case"Point":case"MultiPoint":return null;case"LineString":return ie<0&&(ie=Ke.length+ie-1),Ee.lineString([Ke[ie],Ke[ie+1]],rt,Fe);case"Polygon":return Me<0&&(Me=Ke.length+Me),ie<0&&(ie=Ke[Me].length+ie-1),Ee.lineString([Ke[Me][ie],Ke[Me][ie+1]],rt,Fe);case"MultiLineString":return ne<0&&(ne=Ke.length+ne),ie<0&&(ie=Ke[ne].length+ie-1),Ee.lineString([Ke[ne][ie],Ke[ne][ie+1]],rt,Fe);case"MultiPolygon":return ne<0&&(ne=Ke.length+ne),Me<0&&(Me=Ke[ne].length+Me),ie<0&&(ie=Ke[ne][Me].length-ie-1),Ee.lineString([Ke[ne][Me][ie],Ke[ne][Me][ie+1]],rt,Fe)}throw new Error("geojson is invalid")},vt.flattenEach=Dt,vt.flattenReduce=function mt(he,Fe,ce){var ne=ce;return Dt(he,function(Me,ie,rt){ne=0===ie&&0===rt&&void 0===ce?Me:Fe(ne,Me,ie,rt)}),ne},vt.geomEach=Et,vt.geomReduce=function rn(he,Fe,ce){var ne=ce;return Et(he,function(Me,ie,rt,Ve,Ke){ne=0===ie&&void 0===ce?Me:Fe(ne,Me,ie,rt,Ve,Ke)}),ne},vt.lineEach=de,vt.lineReduce=function Ne(he,Fe,ce){var ne=ce;return de(he,function(Me,ie,rt,Ve){ne=0===ie&&void 0===ce?Me:Fe(ne,Me,ie,rt,Ve)}),ne},vt.propEach=p,vt.propReduce=function be(he,Fe,ce){var ne=ce;return p(he,function(Me,ie){ne=0===ie&&void 0===ce?Me:Fe(ne,Me,ie)}),ne},vt.segmentEach=Vt,vt.segmentReduce=function hn(he,Fe,ce){var ne=ce,Me=!1;return Vt(he,function(ie,rt,Ve,Ke,Te){ne=!1===Me&&void 0===ce?ie:Fe(ne,ie,rt,Ve,Ke,Te),Me=!0}),ne}},1098:(sn,vt,qe)=>{"use strict";var Ee=qe(491),ze=qe(5436),ht=ze(Ee("String.prototype.indexOf"));sn.exports=function(be,Xe){var dt=Ee(be,!!Xe);return"function"==typeof dt&&ht(be,".prototype.")>-1?ze(dt):dt}},5436:(sn,vt,qe)=>{"use strict";var Ee=qe(5333),ze=qe(491),ht=ze("%Function.prototype.apply%"),p=ze("%Function.prototype.call%"),be=ze("%Reflect.apply%",!0)||Ee.call(p,ht),Xe=ze("%Object.getOwnPropertyDescriptor%",!0),dt=ze("%Object.defineProperty%",!0),ft=ze("%Math.max%");if(dt)try{dt({},"a",{value:1})}catch{dt=null}sn.exports=function(Dt){var mt=be(Ee,p,arguments);return Xe&&dt&&Xe(mt,"length").configurable&&dt(mt,"length",{value:1+ft(0,Dt.length-(arguments.length-1))}),mt};var Et=function(){return be(Ee,ht,arguments)};dt?dt(sn.exports,"apply",{value:Et}):sn.exports.apply=Et},3664:(sn,vt,qe)=>{"use strict";var Ee=qe(938),ze=qe(7935),ht=qe(4179),p=qe(6138).orient2d;function be(ce,ne,Me){ne=Math.max(0,void 0===ne?2:ne),Me=Me||0;var ie=function hn(ce){for(var ne=ce[0],Me=ce[0],ie=ce[0],rt=ce[0],Ve=0;Ve<ce.length;Ve++){var Ke=ce[Ve];Ke[0]<ne[0]&&(ne=Ke),Ke[0]>ie[0]&&(ie=Ke),Ke[1]<Me[1]&&(Me=Ke),Ke[1]>rt[1]&&(rt=Ke)}var Te=[ne,Me,ie,rt],Kt=Te.slice();for(Ve=0;Ve<ce.length;Ve++)ht(ce[Ve],Te)||Kt.push(ce[Ve]);return function Fe(ce){ce.sort(he);for(var ne=[],Me=0;Me<ce.length;Me++){for(;ne.length>=2&&Dt(ne[ne.length-2],ne[ne.length-1],ce[Me])<=0;)ne.pop();ne.push(ce[Me])}for(var ie=[],rt=ce.length-1;rt>=0;rt--){for(;ie.length>=2&&Dt(ie[ie.length-2],ie[ie.length-1],ce[rt])<=0;)ie.pop();ie.push(ce[rt])}return ie.pop(),ne.pop(),ne.concat(ie)}(Kt)}(ce),rt=new Ee(16);rt.toBBox=function(yn){return{minX:yn[0],minY:yn[1],maxX:yn[0],maxY:yn[1]}},rt.compareMinX=function(yn,Mt){return yn[0]-Mt[0]},rt.compareMinY=function(yn,Mt){return yn[1]-Mt[1]},rt.load(ce);for(var Te,Ve=[],Ke=0;Ke<ie.length;Ke++){var Kt=ie[Ke];rt.remove(Kt),Te=de(Kt,Te),Ve.push(Te)}var At=new Ee(16);for(Ke=0;Ke<Ve.length;Ke++)At.insert(Vt(Ve[Ke]));for(var we=ne*ne,at=Me*Me;Ve.length;){var Ae=Ve.shift(),it=Ae.p,pt=Ae.next.p,Ie=Ne(it,pt);if(!(Ie<at)){var Ut=Ie/we;(Kt=Xe(rt,Ae.prev.p,it,pt,Ae.next.next.p,Ut,At))&&Math.min(Ne(Kt,it),Ne(Kt,pt))<=Ut&&(Ve.push(Ae),Ve.push(de(Kt,Ae)),rt.remove(Kt),At.remove(Ae),At.insert(Vt(Ae)),At.insert(Vt(Ae.next)))}}Ae=Te;var It=[];do{It.push(Ae.p),Ae=Ae.next}while(Ae!==Te);return It.push(Ae.p),It}function Xe(ce,ne,Me,ie,rt,Ve,Ke){for(var Te=new ze([],dt),Kt=ce.data;Kt;){for(var At=0;At<Kt.children.length;At++){var we=Kt.children[At],at=Kt.leaf?ue(we,Me,ie):ft(Me,ie,we);at>Ve||Te.push({node:we,dist:at})}for(;Te.length&&!Te.peek().node.children;){var Ae=Te.pop(),it=Ae.node,pt=ue(it,ne,Me),Ie=ue(it,ie,rt);if(Ae.dist<pt&&Ae.dist<Ie&&rn(Me,it,Ke)&&rn(ie,it,Ke))return it}(Kt=Te.pop())&&(Kt=Kt.node)}return null}function dt(ce,ne){return ce.dist-ne.dist}function ft(ce,ne,Me){if(Et(ce,Me)||Et(ne,Me))return 0;var ie=fe(ce[0],ce[1],ne[0],ne[1],Me.minX,Me.minY,Me.maxX,Me.minY);if(0===ie)return 0;var rt=fe(ce[0],ce[1],ne[0],ne[1],Me.minX,Me.minY,Me.minX,Me.maxY);if(0===rt)return 0;var Ve=fe(ce[0],ce[1],ne[0],ne[1],Me.maxX,Me.minY,Me.maxX,Me.maxY);if(0===Ve)return 0;var Ke=fe(ce[0],ce[1],ne[0],ne[1],Me.minX,Me.maxY,Me.maxX,Me.maxY);return 0===Ke?0:Math.min(ie,rt,Ve,Ke)}function Et(ce,ne){return ce[0]>=ne.minX&&ce[0]<=ne.maxX&&ce[1]>=ne.minY&&ce[1]<=ne.maxY}function rn(ce,ne,Me){for(var ie=Math.min(ce[0],ne[0]),rt=Math.min(ce[1],ne[1]),Ve=Math.max(ce[0],ne[0]),Ke=Math.max(ce[1],ne[1]),Te=Me.search({minX:ie,minY:rt,maxX:Ve,maxY:Ke}),Kt=0;Kt<Te.length;Kt++)if(mt(Te[Kt].p,Te[Kt].next.p,ce,ne))return!1;return!0}function Dt(ce,ne,Me){return p(ce[0],ce[1],ne[0],ne[1],Me[0],Me[1])}function mt(ce,ne,Me,ie){return ce!==ie&&ne!==Me&&Dt(ce,ne,Me)>0!=Dt(ce,ne,ie)>0&&Dt(Me,ie,ce)>0!=Dt(Me,ie,ne)>0}function Vt(ce){var ne=ce.p,Me=ce.next.p;return ce.minX=Math.min(ne[0],Me[0]),ce.minY=Math.min(ne[1],Me[1]),ce.maxX=Math.max(ne[0],Me[0]),ce.maxY=Math.max(ne[1],Me[1]),ce}function de(ce,ne){var Me={p:ce,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return ne?(Me.next=ne.next,Me.prev=ne,ne.next.prev=Me,ne.next=Me):(Me.prev=Me,Me.next=Me),Me}function Ne(ce,ne){var Me=ce[0]-ne[0],ie=ce[1]-ne[1];return Me*Me+ie*ie}function ue(ce,ne,Me){var ie=ne[0],rt=ne[1],Ve=Me[0]-ie,Ke=Me[1]-rt;if(0!==Ve||0!==Ke){var Te=((ce[0]-ie)*Ve+(ce[1]-rt)*Ke)/(Ve*Ve+Ke*Ke);Te>1?(ie=Me[0],rt=Me[1]):Te>0&&(ie+=Ve*Te,rt+=Ke*Te)}return(Ve=ce[0]-ie)*Ve+(Ke=ce[1]-rt)*Ke}function fe(ce,ne,Me,ie,rt,Ve,Ke,Te){var $n,Nn,Dn,gn,Kt=Me-ce,At=ie-ne,we=Ke-rt,at=Te-Ve,Ae=ce-rt,it=ne-Ve,pt=Kt*Kt+At*At,Ie=Kt*we+At*at,Ut=we*we+at*at,It=Kt*Ae+At*it,yn=we*Ae+at*it,Mt=pt*Ut-Ie*Ie,bn=Mt,un=Mt;0===Mt?(Nn=0,bn=1,gn=yn,un=Ut):(gn=pt*yn-Ie*It,(Nn=Ie*yn-Ut*It)<0?(Nn=0,gn=yn,un=Ut):Nn>bn&&(Nn=bn,gn=yn+Ie,un=Ut)),gn<0?(gn=0,-It<0?Nn=0:-It>pt?Nn=bn:(Nn=-It,bn=pt)):gn>un&&(gn=un,-It+Ie<0?Nn=0:-It+Ie>pt?Nn=bn:(Nn=-It+Ie,bn=pt));var lr=(1-(Dn=0===gn?0:gn/un))*rt+Dn*Ke-((1-($n=0===Nn?0:Nn/bn))*ce+$n*Me),ye=(1-Dn)*Ve+Dn*Te-((1-$n)*ne+$n*ie);return lr*lr+ye*ye}function he(ce,ne){return ce[0]===ne[0]?ce[1]-ne[1]:ce[0]-ne[0]}ze.default&&(ze=ze.default),sn.exports=be,sn.exports.default=be},938:function(sn){sn.exports=function(){"use strict";function vt(de,Ne,ue,fe,he){!function Fe(ce,ne,Me,ie,rt){for(;ie>Me;){if(ie-Me>600){var Ve=ie-Me+1,Ke=ne-Me+1,Te=Math.log(Ve),Kt=.5*Math.exp(2*Te/3),At=.5*Math.sqrt(Te*Kt*(Ve-Kt)/Ve)*(Ke-Ve/2<0?-1:1);Fe(ce,ne,Math.max(Me,Math.floor(ne-Ke*Kt/Ve+At)),Math.min(ie,Math.floor(ne+(Ve-Ke)*Kt/Ve+At)),rt)}var Ae=ce[ne],it=Me,pt=ie;for(qe(ce,Me,ne),rt(ce[ie],Ae)>0&&qe(ce,Me,ie);it<pt;){for(qe(ce,it,pt),it++,pt--;rt(ce[it],Ae)<0;)it++;for(;rt(ce[pt],Ae)>0;)pt--}0===rt(ce[Me],Ae)?qe(ce,Me,pt):qe(ce,++pt,ie),pt<=ne&&(Me=pt+1),ne<=pt&&(ie=pt-1)}}(de,Ne,ue||0,fe||de.length-1,he||Ee)}function qe(de,Ne,ue){var fe=de[Ne];de[Ne]=de[ue],de[ue]=fe}function Ee(de,Ne){return de<Ne?-1:de>Ne?1:0}var ze=function(de){void 0===de&&(de=9),this._maxEntries=Math.max(4,de),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function ht(de,Ne,ue){if(!ue)return Ne.indexOf(de);for(var fe=0;fe<Ne.length;fe++)if(ue(de,Ne[fe]))return fe;return-1}function p(de,Ne){be(de,0,de.children.length,Ne,de)}function be(de,Ne,ue,fe,he){he||(he=Vt(null)),he.minX=1/0,he.minY=1/0,he.maxX=-1/0,he.maxY=-1/0;for(var Fe=Ne;Fe<ue;Fe++){var ce=de.children[Fe];Xe(he,de.leaf?fe(ce):ce)}return he}function Xe(de,Ne){return de.minX=Math.min(de.minX,Ne.minX),de.minY=Math.min(de.minY,Ne.minY),de.maxX=Math.max(de.maxX,Ne.maxX),de.maxY=Math.max(de.maxY,Ne.maxY),de}function dt(de,Ne){return de.minX-Ne.minX}function ft(de,Ne){return de.minY-Ne.minY}function Et(de){return(de.maxX-de.minX)*(de.maxY-de.minY)}function rn(de){return de.maxX-de.minX+(de.maxY-de.minY)}function Dt(de,Ne){return de.minX<=Ne.minX&&de.minY<=Ne.minY&&Ne.maxX<=de.maxX&&Ne.maxY<=de.maxY}function mt(de,Ne){return Ne.minX<=de.maxX&&Ne.minY<=de.maxY&&Ne.maxX>=de.minX&&Ne.maxY>=de.minY}function Vt(de){return{children:de,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function hn(de,Ne,ue,fe,he){for(var Fe=[Ne,ue];Fe.length;)if(!((ue=Fe.pop())-(Ne=Fe.pop())<=fe)){var ce=Ne+Math.ceil((ue-Ne)/fe/2)*fe;vt(de,ce,Ne,ue,he),Fe.push(Ne,ce,ce,ue)}}return ze.prototype.all=function(){return this._all(this.data,[])},ze.prototype.search=function(de){var Ne=this.data,ue=[];if(!mt(de,Ne))return ue;for(var fe=this.toBBox,he=[];Ne;){for(var Fe=0;Fe<Ne.children.length;Fe++){var ce=Ne.children[Fe],ne=Ne.leaf?fe(ce):ce;mt(de,ne)&&(Ne.leaf?ue.push(ce):Dt(de,ne)?this._all(ce,ue):he.push(ce))}Ne=he.pop()}return ue},ze.prototype.collides=function(de){var Ne=this.data;if(!mt(de,Ne))return!1;for(var ue=[];Ne;){for(var fe=0;fe<Ne.children.length;fe++){var he=Ne.children[fe],Fe=Ne.leaf?this.toBBox(he):he;if(mt(de,Fe)){if(Ne.leaf||Dt(de,Fe))return!0;ue.push(he)}}Ne=ue.pop()}return!1},ze.prototype.load=function(de){if(!de||!de.length)return this;if(de.length<this._minEntries){for(var Ne=0;Ne<de.length;Ne++)this.insert(de[Ne]);return this}var ue=this._build(de.slice(),0,de.length-1,0);if(this.data.children.length)if(this.data.height===ue.height)this._splitRoot(this.data,ue);else{if(this.data.height<ue.height){var fe=this.data;this.data=ue,ue=fe}this._insert(ue,this.data.height-ue.height-1,!0)}else this.data=ue;return this},ze.prototype.insert=function(de){return de&&this._insert(de,this.data.height-1),this},ze.prototype.clear=function(){return this.data=Vt([]),this},ze.prototype.remove=function(de,Ne){if(!de)return this;for(var ue,fe,he,Fe=this.data,ce=this.toBBox(de),ne=[],Me=[];Fe||ne.length;){if(Fe||(Fe=ne.pop(),fe=ne[ne.length-1],ue=Me.pop(),he=!0),Fe.leaf){var ie=ht(de,Fe.children,Ne);if(-1!==ie)return Fe.children.splice(ie,1),ne.push(Fe),this._condense(ne),this}he||Fe.leaf||!Dt(Fe,ce)?fe?(ue++,Fe=fe.children[ue],he=!1):Fe=null:(ne.push(Fe),Me.push(ue),ue=0,fe=Fe,Fe=Fe.children[0])}return this},ze.prototype.toBBox=function(de){return de},ze.prototype.compareMinX=function(de,Ne){return de.minX-Ne.minX},ze.prototype.compareMinY=function(de,Ne){return de.minY-Ne.minY},ze.prototype.toJSON=function(){return this.data},ze.prototype.fromJSON=function(de){return this.data=de,this},ze.prototype._all=function(de,Ne){for(var ue=[];de;)de.leaf?Ne.push.apply(Ne,de.children):ue.push.apply(ue,de.children),de=ue.pop();return Ne},ze.prototype._build=function(de,Ne,ue,fe){var he,Fe=ue-Ne+1,ce=this._maxEntries;if(Fe<=ce)return p(he=Vt(de.slice(Ne,ue+1)),this.toBBox),he;fe||(fe=Math.ceil(Math.log(Fe)/Math.log(ce)),ce=Math.ceil(Fe/Math.pow(ce,fe-1))),(he=Vt([])).leaf=!1,he.height=fe;var ne=Math.ceil(Fe/ce),Me=ne*Math.ceil(Math.sqrt(ce));hn(de,Ne,ue,Me,this.compareMinX);for(var ie=Ne;ie<=ue;ie+=Me){var rt=Math.min(ie+Me-1,ue);hn(de,ie,rt,ne,this.compareMinY);for(var Ve=ie;Ve<=rt;Ve+=ne){var Ke=Math.min(Ve+ne-1,rt);he.children.push(this._build(de,Ve,Ke,fe-1))}}return p(he,this.toBBox),he},ze.prototype._chooseSubtree=function(de,Ne,ue,fe){for(;fe.push(Ne),!Ne.leaf&&fe.length-1!==ue;){for(var he=1/0,Fe=1/0,ce=void 0,ne=0;ne<Ne.children.length;ne++){var Me=Ne.children[ne],ie=Et(Me),rt=(Ve=de,Ke=Me,(Math.max(Ke.maxX,Ve.maxX)-Math.min(Ke.minX,Ve.minX))*(Math.max(Ke.maxY,Ve.maxY)-Math.min(Ke.minY,Ve.minY))-ie);rt<Fe?(Fe=rt,he=ie<he?ie:he,ce=Me):rt===Fe&&ie<he&&(he=ie,ce=Me)}Ne=ce||Ne.children[0]}var Ve,Ke;return Ne},ze.prototype._insert=function(de,Ne,ue){var fe=ue?de:this.toBBox(de),he=[],Fe=this._chooseSubtree(fe,this.data,Ne,he);for(Fe.children.push(de),Xe(Fe,fe);Ne>=0&&he[Ne].children.length>this._maxEntries;)this._split(he,Ne),Ne--;this._adjustParentBBoxes(fe,he,Ne)},ze.prototype._split=function(de,Ne){var ue=de[Ne],fe=ue.children.length,he=this._minEntries;this._chooseSplitAxis(ue,he,fe);var Fe=this._chooseSplitIndex(ue,he,fe),ce=Vt(ue.children.splice(Fe,ue.children.length-Fe));ce.height=ue.height,ce.leaf=ue.leaf,p(ue,this.toBBox),p(ce,this.toBBox),Ne?de[Ne-1].children.push(ce):this._splitRoot(ue,ce)},ze.prototype._splitRoot=function(de,Ne){this.data=Vt([de,Ne]),this.data.height=de.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},ze.prototype._chooseSplitIndex=function(de,Ne,ue){for(var fe,he,Fe,ce,ne,Me,ie,rt=1/0,Ve=1/0,Ke=Ne;Ke<=ue-Ne;Ke++){var Te=be(de,0,Ke,this.toBBox),Kt=be(de,Ke,ue,this.toBBox),At=(he=Te,Fe=Kt,void 0,void 0,void 0,void 0,ce=Math.max(he.minX,Fe.minX),ne=Math.max(he.minY,Fe.minY),Me=Math.min(he.maxX,Fe.maxX),ie=Math.min(he.maxY,Fe.maxY),Math.max(0,Me-ce)*Math.max(0,ie-ne)),we=Et(Te)+Et(Kt);At<rt?(rt=At,fe=Ke,Ve=we<Ve?we:Ve):At===rt&&we<Ve&&(Ve=we,fe=Ke)}return fe||ue-Ne},ze.prototype._chooseSplitAxis=function(de,Ne,ue){var fe=de.leaf?this.compareMinX:dt,he=de.leaf?this.compareMinY:ft;this._allDistMargin(de,Ne,ue,fe)<this._allDistMargin(de,Ne,ue,he)&&de.children.sort(fe)},ze.prototype._allDistMargin=function(de,Ne,ue,fe){de.children.sort(fe);for(var he=this.toBBox,Fe=be(de,0,Ne,he),ce=be(de,ue-Ne,ue,he),ne=rn(Fe)+rn(ce),Me=Ne;Me<ue-Ne;Me++){var ie=de.children[Me];Xe(Fe,de.leaf?he(ie):ie),ne+=rn(Fe)}for(var rt=ue-Ne-1;rt>=Ne;rt--){var Ve=de.children[rt];Xe(ce,de.leaf?he(Ve):Ve),ne+=rn(ce)}return ne},ze.prototype._adjustParentBBoxes=function(de,Ne,ue){for(var fe=ue;fe>=0;fe--)Xe(Ne[fe],de)},ze.prototype._condense=function(de){for(var Ne=de.length-1,ue=void 0;Ne>=0;Ne--)0===de[Ne].children.length?Ne>0?(ue=de[Ne-1].children).splice(ue.indexOf(de[Ne]),1):this.clear():p(de[Ne],this.toBBox)},ze}()},3970:(sn,vt,qe)=>{var Ee=qe(7809),ze=qe(8147),ht=qe(314),p=qe(4720),be=qe(1139),Xe=qe(2365),dt=Date.prototype.getTime;function Et(mt){return null==mt}function rn(mt){return!(!mt||"object"!=typeof mt||"number"!=typeof mt.length||"function"!=typeof mt.copy||"function"!=typeof mt.slice||mt.length>0&&"number"!=typeof mt[0])}sn.exports=function ft(mt,Vt,hn){var de=hn||{};return!!(de.strict?ht(mt,Vt):mt===Vt)||(!mt||!Vt||"object"!=typeof mt&&"object"!=typeof Vt?de.strict?ht(mt,Vt):mt==Vt:function Dt(mt,Vt,hn){var de,Ne;if(typeof mt!=typeof Vt||Et(mt)||Et(Vt)||mt.prototype!==Vt.prototype||ze(mt)!==ze(Vt))return!1;var ue=p(mt),fe=p(Vt);if(ue!==fe)return!1;if(ue||fe)return mt.source===Vt.source&&be(mt)===be(Vt);if(Xe(mt)&&Xe(Vt))return dt.call(mt)===dt.call(Vt);var he=rn(mt),Fe=rn(Vt);if(he!==Fe)return!1;if(he||Fe){if(mt.length!==Vt.length)return!1;for(de=0;de<mt.length;de++)if(mt[de]!==Vt[de])return!1;return!0}if(typeof mt!=typeof Vt)return!1;try{var ce=Ee(mt),ne=Ee(Vt)}catch{return!1}if(ce.length!==ne.length)return!1;for(ce.sort(),ne.sort(),de=ce.length-1;de>=0;de--)if(ce[de]!=ne[de])return!1;for(de=ce.length-1;de>=0;de--)if(!ft(mt[Ne=ce[de]],Vt[Ne],hn))return!1;return!0}(mt,Vt,de))}},1648:(sn,vt,qe)=>{"use strict";var Ee=qe(7809),ze="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),ht=Object.prototype.toString,p=Array.prototype.concat,be=Object.defineProperty,dt=qe(2486)(),ft=be&&dt,Et=function(Dt,mt,Vt,hn){if(mt in Dt)if(!0===hn){if(Dt[mt]===Vt)return}else if(!function(Dt){return"function"==typeof Dt&&"[object Function]"===ht.call(Dt)}(hn)||!hn())return;ft?be(Dt,mt,{configurable:!0,enumerable:!1,value:Vt,writable:!0}):Dt[mt]=Vt},rn=function(Dt,mt){var Vt=arguments.length>2?arguments[2]:{},hn=Ee(mt);ze&&(hn=p.call(hn,Object.getOwnPropertySymbols(mt)));for(var de=0;de<hn.length;de+=1)Et(Dt,hn[de],mt[hn[de]],Vt[hn[de]])};rn.supportsDescriptors=!!ft,sn.exports=rn},7649:sn=>{function vt(qe,Ee,ze,ht){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(qe,Ee,ze,ht)}vt.prototype.run=function(qe,Ee,ze,ht){this._init(qe,Ee,ze,ht);for(var p=0;p<this._datasetLength;p++)if(1!==this._visited[p]){this._visited[p]=1;var be=this._regionQuery(p);if(be.length<this.minPts)this.noise.push(p);else{var Xe=this.clusters.length;this.clusters.push([]),this._addToCluster(p,Xe),this._expandCluster(Xe,be)}}return this.clusters},vt.prototype._init=function(qe,Ee,ze,ht){if(qe){if(!(qe instanceof Array))throw Error("Dataset must be of type array, "+typeof qe+" given");this.dataset=qe,this.clusters=[],this.noise=[],this._datasetLength=qe.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}Ee&&(this.epsilon=Ee),ze&&(this.minPts=ze),ht&&(this.distance=ht)},vt.prototype._expandCluster=function(qe,Ee){for(var ze=0;ze<Ee.length;ze++){var ht=Ee[ze];if(1!==this._visited[ht]){this._visited[ht]=1;var p=this._regionQuery(ht);p.length>=this.minPts&&(Ee=this._mergeArrays(Ee,p))}1!==this._assigned[ht]&&this._addToCluster(ht,qe)}},vt.prototype._addToCluster=function(qe,Ee){this.clusters[Ee].push(qe),this._assigned[qe]=1},vt.prototype._regionQuery=function(qe){for(var Ee=[],ze=0;ze<this._datasetLength;ze++)this.distance(this.dataset[qe],this.dataset[ze])<this.epsilon&&Ee.push(ze);return Ee},vt.prototype._mergeArrays=function(qe,Ee){for(var ze=Ee.length,ht=0;ht<ze;ht++){var p=Ee[ht];qe.indexOf(p)<0&&qe.push(p)}return qe},vt.prototype._euclideanDistance=function(qe,Ee){for(var ze=0,ht=Math.min(qe.length,Ee.length);ht--;)ze+=(qe[ht]-Ee[ht])*(qe[ht]-Ee[ht]);return Math.sqrt(ze)},sn.exports&&(sn.exports=vt)},442:sn=>{function vt(qe,Ee,ze){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(qe,Ee,ze)}vt.prototype.init=function(qe,Ee,ze){this.assignments=[],this.centroids=[],typeof qe<"u"&&(this.dataset=qe),typeof Ee<"u"&&(this.k=Ee),typeof ze<"u"&&(this.distance=ze)},vt.prototype.run=function(qe,Ee){this.init(qe,Ee);for(var ze=this.dataset.length,ht=0;ht<this.k;ht++)this.centroids[ht]=this.randomCentroid();for(var p=!0;p;){p=this.assign();for(var be=0;be<this.k;be++){for(var Xe=new Array(rn),dt=0,ft=0;ft<rn;ft++)Xe[ft]=0;for(var Et=0;Et<ze;Et++){var rn=this.dataset[Et].length;if(be===this.assignments[Et]){for(ft=0;ft<rn;ft++)Xe[ft]+=this.dataset[Et][ft];dt++}}if(dt>0){for(ft=0;ft<rn;ft++)Xe[ft]/=dt;this.centroids[be]=Xe}else this.centroids[be]=this.randomCentroid(),p=!0}}return this.getClusters()},vt.prototype.randomCentroid=function(){var Ee,ze,qe=this.dataset.length-1;do{ze=Math.round(Math.random()*qe),Ee=this.dataset[ze]}while(this.centroids.indexOf(Ee)>=0);return Ee},vt.prototype.assign=function(){for(var ze,qe=!1,Ee=this.dataset.length,ht=0;ht<Ee;ht++)(ze=this.argmin(this.dataset[ht],this.centroids,this.distance))!=this.assignments[ht]&&(this.assignments[ht]=ze,qe=!0);return qe},vt.prototype.getClusters=function(){for(var Ee,qe=new Array(this.k),ze=0;ze<this.assignments.length;ze++)typeof qe[Ee=this.assignments[ze]]>"u"&&(qe[Ee]=[]),qe[Ee].push(ze);return qe},vt.prototype.argmin=function(qe,Ee,ze){for(var Xe,ht=Number.MAX_VALUE,p=0,be=Ee.length,dt=0;dt<be;dt++)(Xe=ze(qe,Ee[dt]))<ht&&(ht=Xe,p=dt);return p},vt.prototype.distance=function(qe,Ee){for(var ze=0,ht=Math.min(qe.length,Ee.length);ht--;){var p=qe[ht]-Ee[ht];ze+=p*p}return Math.sqrt(ze)},sn.exports&&(sn.exports=vt)},2195:(sn,vt,qe)=>{if(sn.exports)var Ee=qe(6216);function ze(ht,p,be,Xe){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(ht,p,be,Xe)}ze.prototype.run=function(ht,p,be,Xe){this._init(ht,p,be,Xe);for(var dt=0,ft=this.dataset.length;dt<ft;dt++)if(1!==this._processed[dt]){this._processed[dt]=1,this.clusters.push([dt]);var Et=this.clusters.length-1;this._orderedList.push(dt);var rn=new Ee(null,null,"asc"),Dt=this._regionQuery(dt);void 0!==this._distanceToCore(dt)&&(this._updateQueue(dt,Dt,rn),this._expandCluster(Et,rn))}return this.clusters},ze.prototype.getReachabilityPlot=function(){for(var ht=[],p=0,be=this._orderedList.length;p<be;p++){var Xe=this._orderedList[p];ht.push([Xe,this._reachability[Xe]])}return ht},ze.prototype._init=function(ht,p,be,Xe){if(ht){if(!(ht instanceof Array))throw Error("Dataset must be of type array, "+typeof ht+" given");this.dataset=ht,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}p&&(this.epsilon=p),be&&(this.minPts=be),Xe&&(this.distance=Xe)},ze.prototype._updateQueue=function(ht,p,be){var Xe=this;this._coreDistance=this._distanceToCore(ht),p.forEach(function(dt){if(void 0===Xe._processed[dt]){var ft=Xe.distance(Xe.dataset[ht],Xe.dataset[dt]),Et=Math.max(Xe._coreDistance,ft);void 0===Xe._reachability[dt]?(Xe._reachability[dt]=Et,be.insert(dt,Et)):Et<Xe._reachability[dt]&&(Xe._reachability[dt]=Et,be.remove(dt),be.insert(dt,Et))}})},ze.prototype._expandCluster=function(ht,p){for(var be=p.getElements(),Xe=0,dt=be.length;Xe<dt;Xe++){var ft=be[Xe];if(void 0===this._processed[ft]){var Et=this._regionQuery(ft);this._processed[ft]=1,this.clusters[ht].push(ft),this._orderedList.push(ft),void 0!==this._distanceToCore(ft)&&(this._updateQueue(ft,Et,p),this._expandCluster(ht,p))}}},ze.prototype._distanceToCore=function(ht){for(var p=this.epsilon,be=0;be<p;be++)if(this._regionQuery(ht,be).length>=this.minPts)return be},ze.prototype._regionQuery=function(ht,p){p=p||this.epsilon;for(var be=[],Xe=0,dt=this.dataset.length;Xe<dt;Xe++)this.distance(this.dataset[ht],this.dataset[Xe])<p&&be.push(Xe);return be},ze.prototype._euclideanDistance=function(ht,p){for(var be=0,Xe=Math.min(ht.length,p.length);Xe--;)be+=(ht[Xe]-p[Xe])*(ht[Xe]-p[Xe]);return Math.sqrt(be)},sn.exports&&(sn.exports=ze)},6216:sn=>{function vt(qe,Ee,ze){this._queue=[],this._priorities=[],this._sorting="desc",this._init(qe,Ee,ze)}vt.prototype.insert=function(qe,Ee){for(var ze=this._queue.length,ht=ze;ht--;){var p=this._priorities[ht];"desc"===this._sorting?Ee>p&&(ze=ht):Ee<p&&(ze=ht)}this._insertAt(qe,Ee,ze)},vt.prototype.remove=function(qe){for(var Ee=this._queue.length;Ee--;)if(qe===this._queue[Ee]){this._queue.splice(Ee,1),this._priorities.splice(Ee,1);break}},vt.prototype.forEach=function(qe){this._queue.forEach(qe)},vt.prototype.getElements=function(){return this._queue},vt.prototype.getElementPriority=function(qe){return this._priorities[qe]},vt.prototype.getPriorities=function(){return this._priorities},vt.prototype.getElementsWithPriorities=function(){for(var qe=[],Ee=0,ze=this._queue.length;Ee<ze;Ee++)qe.push([this._queue[Ee],this._priorities[Ee]]);return qe},vt.prototype._init=function(qe,Ee,ze){if(qe&&Ee){if(this._queue=[],this._priorities=[],qe.length!==Ee.length)throw new Error("Arrays must have the same length");for(var ht=0;ht<qe.length;ht++)this.insert(qe[ht],Ee[ht])}ze&&(this._sorting=ze)},vt.prototype._insertAt=function(qe,Ee,ze){this._queue.length===ze?(this._queue.push(qe),this._priorities.push(Ee)):(this._queue.splice(ze,0,qe),this._priorities.splice(ze,0,Ee))},sn.exports&&(sn.exports=vt)},3367:(sn,vt,qe)=>{sn.exports&&(sn.exports={DBSCAN:qe(7649),KMEANS:qe(442),OPTICS:qe(2195),PriorityQueue:qe(6216)})},9145:sn=>{"use strict";function vt(we,at,Ae){Ae=Ae||2;var It,yn,Mt,$n,Nn,Dn,gn,it=at&&at.length,pt=it?at[0]*Ae:we.length,Ie=qe(we,0,pt,Ae,!0),Ut=[];if(!Ie||Ie.next===Ie.prev)return Ut;if(it&&(Ie=function dt(we,at,Ae,it){var Ie,Ut,Mt,pt=[];for(Ie=0,Ut=at.length;Ie<Ut;Ie++)(Mt=qe(we,at[Ie]*it,Ie<Ut-1?at[Ie+1]*it:we.length,it,!1))===Mt.next&&(Mt.steiner=!0),pt.push(de(Mt));for(pt.sort(ft),Ie=0;Ie<pt.length;Ie++)Ae=Et(pt[Ie],Ae);return Ae}(we,at,Ie,Ae)),we.length>80*Ae){It=Mt=we[0],yn=$n=we[1];for(var bn=Ae;bn<pt;bn+=Ae)(Nn=we[bn])<It&&(It=Nn),(Dn=we[bn+1])<yn&&(yn=Dn),Nn>Mt&&(Mt=Nn),Dn>$n&&($n=Dn);gn=0!==(gn=Math.max(Mt-It,$n-yn))?32767/gn:0}return ze(Ie,Ut,Ae,It,yn,gn,0),Ut}function qe(we,at,Ae,it,pt){var Ie,Ut;if(pt===At(we,at,Ae,it)>0)for(Ie=at;Ie<Ae;Ie+=it)Ut=Ke(Ie,we[Ie],we[Ie+1],Ut);else for(Ie=Ae-it;Ie>=at;Ie-=it)Ut=Ke(Ie,we[Ie],we[Ie+1],Ut);return Ut&&he(Ut,Ut.next)&&(Te(Ut),Ut=Ut.next),Ut}function Ee(we,at){if(!we)return we;at||(at=we);var it,Ae=we;do{if(it=!1,Ae.steiner||!he(Ae,Ae.next)&&0!==fe(Ae.prev,Ae,Ae.next))Ae=Ae.next;else{if(Te(Ae),(Ae=at=Ae.prev)===Ae.next)break;it=!0}}while(it||Ae!==at);return at}function ze(we,at,Ae,it,pt,Ie,Ut){if(we){!Ut&&Ie&&function mt(we,at,Ae,it){var pt=we;do{0===pt.z&&(pt.z=hn(pt.x,pt.y,at,Ae,it)),pt.prevZ=pt.prev,pt.nextZ=pt.next,pt=pt.next}while(pt!==we);pt.prevZ.nextZ=null,pt.prevZ=null,function Vt(we){var at,Ae,it,pt,Ie,Ut,It,yn,Mt=1;do{for(Ae=we,we=null,Ie=null,Ut=0;Ae;){for(Ut++,it=Ae,It=0,at=0;at<Mt&&(It++,it=it.nextZ);at++);for(yn=Mt;It>0||yn>0&&it;)0!==It&&(0===yn||!it||Ae.z<=it.z)?(pt=Ae,Ae=Ae.nextZ,It--):(pt=it,it=it.nextZ,yn--),Ie?Ie.nextZ=pt:we=pt,pt.prevZ=Ie,Ie=pt;Ae=it}Ie.nextZ=null,Mt*=2}while(Ut>1)}(pt)}(we,it,pt,Ie);for(var yn,Mt,It=we;we.prev!==we.next;)if(yn=we.prev,Mt=we.next,Ie?p(we,it,pt,Ie):ht(we))at.push(yn.i/Ae|0),at.push(we.i/Ae|0),at.push(Mt.i/Ae|0),Te(we),we=Mt.next,It=Mt.next;else if((we=Mt)===It){Ut?1===Ut?ze(we=be(Ee(we),at,Ae),at,Ae,it,pt,Ie,2):2===Ut&&Xe(we,at,Ae,it,pt,Ie):ze(Ee(we),at,Ae,it,pt,Ie,1);break}}}function ht(we){var at=we.prev,Ae=we,it=we.next;if(fe(at,Ae,it)>=0)return!1;for(var pt=at.x,Ie=Ae.x,Ut=it.x,It=at.y,yn=Ae.y,Mt=it.y,$n=pt<Ie?pt<Ut?pt:Ut:Ie<Ut?Ie:Ut,Nn=It<yn?It<Mt?It:Mt:yn<Mt?yn:Mt,Dn=pt>Ie?pt>Ut?pt:Ut:Ie>Ut?Ie:Ut,gn=It>yn?It>Mt?It:Mt:yn>Mt?yn:Mt,bn=it.next;bn!==at;){if(bn.x>=$n&&bn.x<=Dn&&bn.y>=Nn&&bn.y<=gn&&Ne(pt,It,Ie,yn,Ut,Mt,bn.x,bn.y)&&fe(bn.prev,bn,bn.next)>=0)return!1;bn=bn.next}return!0}function p(we,at,Ae,it){var pt=we.prev,Ie=we,Ut=we.next;if(fe(pt,Ie,Ut)>=0)return!1;for(var It=pt.x,yn=Ie.x,Mt=Ut.x,$n=pt.y,Nn=Ie.y,Dn=Ut.y,gn=It<yn?It<Mt?It:Mt:yn<Mt?yn:Mt,bn=$n<Nn?$n<Dn?$n:Dn:Nn<Dn?Nn:Dn,un=It>yn?It>Mt?It:Mt:yn>Mt?yn:Mt,Ai=$n>Nn?$n>Dn?$n:Dn:Nn>Dn?Nn:Dn,gr=hn(gn,bn,at,Ae,it),ii=hn(un,Ai,at,Ae,it),ir=we.prevZ,lr=we.nextZ;ir&&ir.z>=gr&&lr&&lr.z<=ii;){if(ir.x>=gn&&ir.x<=un&&ir.y>=bn&&ir.y<=Ai&&ir!==pt&&ir!==Ut&&Ne(It,$n,yn,Nn,Mt,Dn,ir.x,ir.y)&&fe(ir.prev,ir,ir.next)>=0||(ir=ir.prevZ,lr.x>=gn&&lr.x<=un&&lr.y>=bn&&lr.y<=Ai&&lr!==pt&&lr!==Ut&&Ne(It,$n,yn,Nn,Mt,Dn,lr.x,lr.y)&&fe(lr.prev,lr,lr.next)>=0))return!1;lr=lr.nextZ}for(;ir&&ir.z>=gr;){if(ir.x>=gn&&ir.x<=un&&ir.y>=bn&&ir.y<=Ai&&ir!==pt&&ir!==Ut&&Ne(It,$n,yn,Nn,Mt,Dn,ir.x,ir.y)&&fe(ir.prev,ir,ir.next)>=0)return!1;ir=ir.prevZ}for(;lr&&lr.z<=ii;){if(lr.x>=gn&&lr.x<=un&&lr.y>=bn&&lr.y<=Ai&&lr!==pt&&lr!==Ut&&Ne(It,$n,yn,Nn,Mt,Dn,lr.x,lr.y)&&fe(lr.prev,lr,lr.next)>=0)return!1;lr=lr.nextZ}return!0}function be(we,at,Ae){var it=we;do{var pt=it.prev,Ie=it.next.next;!he(pt,Ie)&&Fe(pt,it,it.next,Ie)&&ie(pt,Ie)&&ie(Ie,pt)&&(at.push(pt.i/Ae|0),at.push(it.i/Ae|0),at.push(Ie.i/Ae|0),Te(it),Te(it.next),it=we=Ie),it=it.next}while(it!==we);return Ee(it)}function Xe(we,at,Ae,it,pt,Ie){var Ut=we;do{for(var It=Ut.next.next;It!==Ut.prev;){if(Ut.i!==It.i&&ue(Ut,It)){var yn=Ve(Ut,It);return Ut=Ee(Ut,Ut.next),yn=Ee(yn,yn.next),ze(Ut,at,Ae,it,pt,Ie,0),void ze(yn,at,Ae,it,pt,Ie,0)}It=It.next}Ut=Ut.next}while(Ut!==we)}function ft(we,at){return we.x-at.x}function Et(we,at){var Ae=function rn(we,at){var Ut,Ae=at,it=we.x,pt=we.y,Ie=-1/0;do{if(pt<=Ae.y&&pt>=Ae.next.y&&Ae.next.y!==Ae.y){var It=Ae.x+(pt-Ae.y)*(Ae.next.x-Ae.x)/(Ae.next.y-Ae.y);if(It<=it&&It>Ie&&(Ie=It,Ut=Ae.x<Ae.next.x?Ae:Ae.next,It===it))return Ut}Ae=Ae.next}while(Ae!==at);if(!Ut)return null;var Dn,yn=Ut,Mt=Ut.x,$n=Ut.y,Nn=1/0;Ae=Ut;do{it>=Ae.x&&Ae.x>=Mt&&it!==Ae.x&&Ne(pt<$n?it:Ie,pt,Mt,$n,pt<$n?Ie:it,pt,Ae.x,Ae.y)&&(Dn=Math.abs(pt-Ae.y)/(it-Ae.x),ie(Ae,we)&&(Dn<Nn||Dn===Nn&&(Ae.x>Ut.x||Ae.x===Ut.x&&Dt(Ut,Ae)))&&(Ut=Ae,Nn=Dn)),Ae=Ae.next}while(Ae!==yn);return Ut}(we,at);if(!Ae)return at;var it=Ve(Ae,we);return Ee(it,it.next),Ee(Ae,Ae.next)}function Dt(we,at){return fe(we.prev,we,at.prev)<0&&fe(at.next,we,we.next)<0}function hn(we,at,Ae,it,pt){return(we=1431655765&((we=858993459&((we=252645135&((we=16711935&((we=(we-Ae)*pt|0)|we<<8))|we<<4))|we<<2))|we<<1))|(at=1431655765&((at=858993459&((at=252645135&((at=16711935&((at=(at-it)*pt|0)|at<<8))|at<<4))|at<<2))|at<<1))<<1}function de(we){var at=we,Ae=we;do{(at.x<Ae.x||at.x===Ae.x&&at.y<Ae.y)&&(Ae=at),at=at.next}while(at!==we);return Ae}function Ne(we,at,Ae,it,pt,Ie,Ut,It){return(pt-Ut)*(at-It)>=(we-Ut)*(Ie-It)&&(we-Ut)*(it-It)>=(Ae-Ut)*(at-It)&&(Ae-Ut)*(Ie-It)>=(pt-Ut)*(it-It)}function ue(we,at){return we.next.i!==at.i&&we.prev.i!==at.i&&!function Me(we,at){var Ae=we;do{if(Ae.i!==we.i&&Ae.next.i!==we.i&&Ae.i!==at.i&&Ae.next.i!==at.i&&Fe(Ae,Ae.next,we,at))return!0;Ae=Ae.next}while(Ae!==we);return!1}(we,at)&&(ie(we,at)&&ie(at,we)&&function rt(we,at){var Ae=we,it=!1,pt=(we.x+at.x)/2,Ie=(we.y+at.y)/2;do{Ae.y>Ie!=Ae.next.y>Ie&&Ae.next.y!==Ae.y&&pt<(Ae.next.x-Ae.x)*(Ie-Ae.y)/(Ae.next.y-Ae.y)+Ae.x&&(it=!it),Ae=Ae.next}while(Ae!==we);return it}(we,at)&&(fe(we.prev,we,at.prev)||fe(we,at.prev,at))||he(we,at)&&fe(we.prev,we,we.next)>0&&fe(at.prev,at,at.next)>0)}function fe(we,at,Ae){return(at.y-we.y)*(Ae.x-at.x)-(at.x-we.x)*(Ae.y-at.y)}function he(we,at){return we.x===at.x&&we.y===at.y}function Fe(we,at,Ae,it){var pt=ne(fe(we,at,Ae)),Ie=ne(fe(we,at,it)),Ut=ne(fe(Ae,it,we)),It=ne(fe(Ae,it,at));return!!(pt!==Ie&&Ut!==It||0===pt&&ce(we,Ae,at)||0===Ie&&ce(we,it,at)||0===Ut&&ce(Ae,we,it)||0===It&&ce(Ae,at,it))}function ce(we,at,Ae){return at.x<=Math.max(we.x,Ae.x)&&at.x>=Math.min(we.x,Ae.x)&&at.y<=Math.max(we.y,Ae.y)&&at.y>=Math.min(we.y,Ae.y)}function ne(we){return we>0?1:we<0?-1:0}function ie(we,at){return fe(we.prev,we,we.next)<0?fe(we,at,we.next)>=0&&fe(we,we.prev,at)>=0:fe(we,at,we.prev)<0||fe(we,we.next,at)<0}function Ve(we,at){var Ae=new Kt(we.i,we.x,we.y),it=new Kt(at.i,at.x,at.y),pt=we.next,Ie=at.prev;return we.next=at,at.prev=we,Ae.next=pt,pt.prev=Ae,it.next=Ae,Ae.prev=it,Ie.next=it,it.prev=Ie,it}function Ke(we,at,Ae,it){var pt=new Kt(we,at,Ae);return it?(pt.next=it.next,pt.prev=it,it.next.prev=pt,it.next=pt):(pt.prev=pt,pt.next=pt),pt}function Te(we){we.next.prev=we.prev,we.prev.next=we.next,we.prevZ&&(we.prevZ.nextZ=we.nextZ),we.nextZ&&(we.nextZ.prevZ=we.prevZ)}function Kt(we,at,Ae){this.i=we,this.x=at,this.y=Ae,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function At(we,at,Ae,it){for(var pt=0,Ie=at,Ut=Ae-it;Ie<Ae;Ie+=it)pt+=(we[Ut]-we[Ie])*(we[Ie+1]+we[Ut+1]),Ut=Ie;return pt}sn.exports=vt,sn.exports.default=vt,vt.deviation=function(we,at,Ae,it){var pt=at&&at.length,Ut=Math.abs(At(we,0,pt?at[0]*Ae:we.length,Ae));if(pt)for(var It=0,yn=at.length;It<yn;It++)Ut-=Math.abs(At(we,at[It]*Ae,It<yn-1?at[It+1]*Ae:we.length,Ae));var Nn=0;for(It=0;It<it.length;It+=3){var Dn=it[It]*Ae,gn=it[It+1]*Ae,bn=it[It+2]*Ae;Nn+=Math.abs((we[Dn]-we[bn])*(we[gn+1]-we[Dn+1])-(we[Dn]-we[gn])*(we[bn+1]-we[Dn+1]))}return 0===Ut&&0===Nn?0:Math.abs((Nn-Ut)/Ut)},vt.flatten=function(we){for(var at=we[0][0].length,Ae={vertices:[],holes:[],dimensions:at},it=0,pt=0;pt<we.length;pt++){for(var Ie=0;Ie<we[pt].length;Ie++)for(var Ut=0;Ut<at;Ut++)Ae.vertices.push(we[pt][Ie][Ut]);pt>0&&Ae.holes.push(it+=we[pt-1].length)}return Ae}},238:sn=>{"use strict";var qe=Array.prototype.slice,Ee=Object.prototype.toString;sn.exports=function(p){var be=this;if("function"!=typeof be||"[object Function]"!==Ee.call(be))throw new TypeError("Function.prototype.bind called on incompatible "+be);for(var dt,Xe=qe.call(arguments,1),Et=Math.max(0,be.length-Xe.length),rn=[],Dt=0;Dt<Et;Dt++)rn.push("$"+Dt);if(dt=Function("binder","return function ("+rn.join(",")+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof dt){var Vt=be.apply(this,Xe.concat(qe.call(arguments)));return Object(Vt)===Vt?Vt:this}return be.apply(p,Xe.concat(qe.call(arguments)))}),be.prototype){var mt=function(){};mt.prototype=be.prototype,dt.prototype=new mt,mt.prototype=null}return dt}},5333:(sn,vt,qe)=>{"use strict";var Ee=qe(238);sn.exports=Function.prototype.bind||Ee},1552:sn=>{"use strict";var vt=function(){return"string"==typeof function(){}.name},qe=Object.getOwnPropertyDescriptor;if(qe)try{qe([],"length")}catch{qe=null}vt.functionsHaveConfigurableNames=function(){if(!vt()||!qe)return!1;var ht=qe(function(){},"name");return!!ht&&!!ht.configurable};var Ee=Function.prototype.bind;vt.boundFunctionsHaveNames=function(){return vt()&&"function"==typeof Ee&&""!==function(){}.bind().name},sn.exports=vt},3198:(sn,vt,qe)=>{var Ee=qe(3970),ze=function(Xe){this.precision=Xe&&Xe.precision?Xe.precision:17,this.direction=!(!Xe||!Xe.direction)&&Xe.direction,this.pseudoNode=!(!Xe||!Xe.pseudoNode)&&Xe.pseudoNode,this.objectComparator=Xe&&Xe.objectComparator?Xe.objectComparator:be};function ht(Xe){return Xe.coordinates.map(function(dt){return{type:Xe.type.replace("Multi",""),coordinates:dt}})}function p(Xe,dt){return Xe.hasOwnProperty("coordinates")?Xe.coordinates.length===dt.coordinates.length:Xe.length===dt.length}function be(Xe,dt){return Ee(Xe,dt,{strict:!0})}ze.prototype.compare=function(Xe,dt){if(Xe.type!==dt.type||!p(Xe,dt))return!1;switch(Xe.type){case"Point":return this.compareCoord(Xe.coordinates,dt.coordinates);case"LineString":return this.compareLine(Xe.coordinates,dt.coordinates,0,!1);case"Polygon":return this.comparePolygon(Xe,dt);case"Feature":return this.compareFeature(Xe,dt);default:if(0===Xe.type.indexOf("Multi")){var ft=this,Et=ht(Xe),rn=ht(dt);return Et.every(function(Dt){return this.some(function(mt){return ft.compare(Dt,mt)})},rn)}}return!1},ze.prototype.compareCoord=function(Xe,dt){if(Xe.length!==dt.length)return!1;for(var ft=0;ft<Xe.length;ft++)if(Xe[ft].toFixed(this.precision)!==dt[ft].toFixed(this.precision))return!1;return!0},ze.prototype.compareLine=function(Xe,dt,ft,Et){if(!p(Xe,dt))return!1;var rn=this.pseudoNode?Xe:this.removePseudo(Xe),Dt=this.pseudoNode?dt:this.removePseudo(dt);if(!Et||this.compareCoord(rn[0],Dt[0])||(Dt=this.fixStartIndex(Dt,rn))){var mt=this.compareCoord(rn[ft],Dt[ft]);return this.direction||mt?this.comparePath(rn,Dt):!!this.compareCoord(rn[ft],Dt[Dt.length-(1+ft)])&&this.comparePath(rn.slice().reverse(),Dt)}},ze.prototype.fixStartIndex=function(Xe,dt){for(var ft,Et=-1,rn=0;rn<Xe.length;rn++)if(this.compareCoord(Xe[rn],dt[0])){Et=rn;break}return Et>=0&&(ft=[].concat(Xe.slice(Et,Xe.length),Xe.slice(1,Et+1))),ft},ze.prototype.comparePath=function(Xe,dt){var ft=this;return Xe.every(function(Et,rn){return ft.compareCoord(Et,this[rn])},dt)},ze.prototype.comparePolygon=function(Xe,dt){if(this.compareLine(Xe.coordinates[0],dt.coordinates[0],1,!0)){var ft=Xe.coordinates.slice(1,Xe.coordinates.length),Et=dt.coordinates.slice(1,dt.coordinates.length),rn=this;return ft.every(function(Dt){return this.some(function(mt){return rn.compareLine(Dt,mt,1,!0)})},Et)}return!1},ze.prototype.compareFeature=function(Xe,dt){return!(Xe.id!==dt.id||!this.objectComparator(Xe.properties,dt.properties)||!this.compareBBox(Xe,dt))&&this.compare(Xe.geometry,dt.geometry)},ze.prototype.compareBBox=function(Xe,dt){return!!(!Xe.bbox&&!dt.bbox||Xe.bbox&&dt.bbox&&this.compareCoord(Xe.bbox,dt.bbox))},ze.prototype.removePseudo=function(Xe){return Xe},sn.exports=ze},5665:(sn,vt,qe)=>{var Ee=qe(7571),ze=qe(621),ht=qe(8570),p=qe(1568).Z,be=ht.featureEach,ft=ze.featureCollection;function Et(rn){var Dt=new Ee(rn);return Dt.insert=function(mt){if("Feature"!==mt.type)throw new Error("invalid feature");return mt.bbox=mt.bbox?mt.bbox:p(mt),Ee.prototype.insert.call(this,mt)},Dt.load=function(mt){var Vt=[];return Array.isArray(mt)?mt.forEach(function(hn){if("Feature"!==hn.type)throw new Error("invalid features");hn.bbox=hn.bbox?hn.bbox:p(hn),Vt.push(hn)}):be(mt,function(hn){if("Feature"!==hn.type)throw new Error("invalid features");hn.bbox=hn.bbox?hn.bbox:p(hn),Vt.push(hn)}),Ee.prototype.load.call(this,Vt)},Dt.remove=function(mt,Vt){if("Feature"!==mt.type)throw new Error("invalid feature");return mt.bbox=mt.bbox?mt.bbox:p(mt),Ee.prototype.remove.call(this,mt,Vt)},Dt.clear=function(){return Ee.prototype.clear.call(this)},Dt.search=function(mt){var Vt=Ee.prototype.search.call(this,this.toBBox(mt));return ft(Vt)},Dt.collides=function(mt){return Ee.prototype.collides.call(this,this.toBBox(mt))},Dt.all=function(){var mt=Ee.prototype.all.call(this);return ft(mt)},Dt.toJSON=function(){return Ee.prototype.toJSON.call(this)},Dt.fromJSON=function(mt){return Ee.prototype.fromJSON.call(this,mt)},Dt.toBBox=function(mt){var Vt;if(mt.bbox)Vt=mt.bbox;else if(Array.isArray(mt)&&4===mt.length)Vt=mt;else if(Array.isArray(mt)&&6===mt.length)Vt=[mt[0],mt[1],mt[3],mt[4]];else if("Feature"===mt.type)Vt=p(mt);else{if("FeatureCollection"!==mt.type)throw new Error("invalid geojson");Vt=p(mt)}return{minX:Vt[0],minY:Vt[1],maxX:Vt[2],maxY:Vt[3]}},Dt}sn.exports=Et,sn.exports.default=Et},7571:function(sn){sn.exports=function(){"use strict";function vt(de,Ne,ue,fe,he){!function Fe(ce,ne,Me,ie,rt){for(;ie>Me;){if(ie-Me>600){var Ve=ie-Me+1,Ke=ne-Me+1,Te=Math.log(Ve),Kt=.5*Math.exp(2*Te/3),At=.5*Math.sqrt(Te*Kt*(Ve-Kt)/Ve)*(Ke-Ve/2<0?-1:1);Fe(ce,ne,Math.max(Me,Math.floor(ne-Ke*Kt/Ve+At)),Math.min(ie,Math.floor(ne+(Ve-Ke)*Kt/Ve+At)),rt)}var Ae=ce[ne],it=Me,pt=ie;for(qe(ce,Me,ne),rt(ce[ie],Ae)>0&&qe(ce,Me,ie);it<pt;){for(qe(ce,it,pt),it++,pt--;rt(ce[it],Ae)<0;)it++;for(;rt(ce[pt],Ae)>0;)pt--}0===rt(ce[Me],Ae)?qe(ce,Me,pt):qe(ce,++pt,ie),pt<=ne&&(Me=pt+1),ne<=pt&&(ie=pt-1)}}(de,Ne,ue||0,fe||de.length-1,he||Ee)}function qe(de,Ne,ue){var fe=de[Ne];de[Ne]=de[ue],de[ue]=fe}function Ee(de,Ne){return de<Ne?-1:de>Ne?1:0}var ze=function(de){void 0===de&&(de=9),this._maxEntries=Math.max(4,de),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function ht(de,Ne,ue){if(!ue)return Ne.indexOf(de);for(var fe=0;fe<Ne.length;fe++)if(ue(de,Ne[fe]))return fe;return-1}function p(de,Ne){be(de,0,de.children.length,Ne,de)}function be(de,Ne,ue,fe,he){he||(he=Vt(null)),he.minX=1/0,he.minY=1/0,he.maxX=-1/0,he.maxY=-1/0;for(var Fe=Ne;Fe<ue;Fe++){var ce=de.children[Fe];Xe(he,de.leaf?fe(ce):ce)}return he}function Xe(de,Ne){return de.minX=Math.min(de.minX,Ne.minX),de.minY=Math.min(de.minY,Ne.minY),de.maxX=Math.max(de.maxX,Ne.maxX),de.maxY=Math.max(de.maxY,Ne.maxY),de}function dt(de,Ne){return de.minX-Ne.minX}function ft(de,Ne){return de.minY-Ne.minY}function Et(de){return(de.maxX-de.minX)*(de.maxY-de.minY)}function rn(de){return de.maxX-de.minX+(de.maxY-de.minY)}function Dt(de,Ne){return de.minX<=Ne.minX&&de.minY<=Ne.minY&&Ne.maxX<=de.maxX&&Ne.maxY<=de.maxY}function mt(de,Ne){return Ne.minX<=de.maxX&&Ne.minY<=de.maxY&&Ne.maxX>=de.minX&&Ne.maxY>=de.minY}function Vt(de){return{children:de,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function hn(de,Ne,ue,fe,he){for(var Fe=[Ne,ue];Fe.length;)if(!((ue=Fe.pop())-(Ne=Fe.pop())<=fe)){var ce=Ne+Math.ceil((ue-Ne)/fe/2)*fe;vt(de,ce,Ne,ue,he),Fe.push(Ne,ce,ce,ue)}}return ze.prototype.all=function(){return this._all(this.data,[])},ze.prototype.search=function(de){var Ne=this.data,ue=[];if(!mt(de,Ne))return ue;for(var fe=this.toBBox,he=[];Ne;){for(var Fe=0;Fe<Ne.children.length;Fe++){var ce=Ne.children[Fe],ne=Ne.leaf?fe(ce):ce;mt(de,ne)&&(Ne.leaf?ue.push(ce):Dt(de,ne)?this._all(ce,ue):he.push(ce))}Ne=he.pop()}return ue},ze.prototype.collides=function(de){var Ne=this.data;if(!mt(de,Ne))return!1;for(var ue=[];Ne;){for(var fe=0;fe<Ne.children.length;fe++){var he=Ne.children[fe],Fe=Ne.leaf?this.toBBox(he):he;if(mt(de,Fe)){if(Ne.leaf||Dt(de,Fe))return!0;ue.push(he)}}Ne=ue.pop()}return!1},ze.prototype.load=function(de){if(!de||!de.length)return this;if(de.length<this._minEntries){for(var Ne=0;Ne<de.length;Ne++)this.insert(de[Ne]);return this}var ue=this._build(de.slice(),0,de.length-1,0);if(this.data.children.length)if(this.data.height===ue.height)this._splitRoot(this.data,ue);else{if(this.data.height<ue.height){var fe=this.data;this.data=ue,ue=fe}this._insert(ue,this.data.height-ue.height-1,!0)}else this.data=ue;return this},ze.prototype.insert=function(de){return de&&this._insert(de,this.data.height-1),this},ze.prototype.clear=function(){return this.data=Vt([]),this},ze.prototype.remove=function(de,Ne){if(!de)return this;for(var ue,fe,he,Fe=this.data,ce=this.toBBox(de),ne=[],Me=[];Fe||ne.length;){if(Fe||(Fe=ne.pop(),fe=ne[ne.length-1],ue=Me.pop(),he=!0),Fe.leaf){var ie=ht(de,Fe.children,Ne);if(-1!==ie)return Fe.children.splice(ie,1),ne.push(Fe),this._condense(ne),this}he||Fe.leaf||!Dt(Fe,ce)?fe?(ue++,Fe=fe.children[ue],he=!1):Fe=null:(ne.push(Fe),Me.push(ue),ue=0,fe=Fe,Fe=Fe.children[0])}return this},ze.prototype.toBBox=function(de){return de},ze.prototype.compareMinX=function(de,Ne){return de.minX-Ne.minX},ze.prototype.compareMinY=function(de,Ne){return de.minY-Ne.minY},ze.prototype.toJSON=function(){return this.data},ze.prototype.fromJSON=function(de){return this.data=de,this},ze.prototype._all=function(de,Ne){for(var ue=[];de;)de.leaf?Ne.push.apply(Ne,de.children):ue.push.apply(ue,de.children),de=ue.pop();return Ne},ze.prototype._build=function(de,Ne,ue,fe){var he,Fe=ue-Ne+1,ce=this._maxEntries;if(Fe<=ce)return p(he=Vt(de.slice(Ne,ue+1)),this.toBBox),he;fe||(fe=Math.ceil(Math.log(Fe)/Math.log(ce)),ce=Math.ceil(Fe/Math.pow(ce,fe-1))),(he=Vt([])).leaf=!1,he.height=fe;var ne=Math.ceil(Fe/ce),Me=ne*Math.ceil(Math.sqrt(ce));hn(de,Ne,ue,Me,this.compareMinX);for(var ie=Ne;ie<=ue;ie+=Me){var rt=Math.min(ie+Me-1,ue);hn(de,ie,rt,ne,this.compareMinY);for(var Ve=ie;Ve<=rt;Ve+=ne){var Ke=Math.min(Ve+ne-1,rt);he.children.push(this._build(de,Ve,Ke,fe-1))}}return p(he,this.toBBox),he},ze.prototype._chooseSubtree=function(de,Ne,ue,fe){for(;fe.push(Ne),!Ne.leaf&&fe.length-1!==ue;){for(var he=1/0,Fe=1/0,ce=void 0,ne=0;ne<Ne.children.length;ne++){var Me=Ne.children[ne],ie=Et(Me),rt=(Ve=de,Ke=Me,(Math.max(Ke.maxX,Ve.maxX)-Math.min(Ke.minX,Ve.minX))*(Math.max(Ke.maxY,Ve.maxY)-Math.min(Ke.minY,Ve.minY))-ie);rt<Fe?(Fe=rt,he=ie<he?ie:he,ce=Me):rt===Fe&&ie<he&&(he=ie,ce=Me)}Ne=ce||Ne.children[0]}var Ve,Ke;return Ne},ze.prototype._insert=function(de,Ne,ue){var fe=ue?de:this.toBBox(de),he=[],Fe=this._chooseSubtree(fe,this.data,Ne,he);for(Fe.children.push(de),Xe(Fe,fe);Ne>=0&&he[Ne].children.length>this._maxEntries;)this._split(he,Ne),Ne--;this._adjustParentBBoxes(fe,he,Ne)},ze.prototype._split=function(de,Ne){var ue=de[Ne],fe=ue.children.length,he=this._minEntries;this._chooseSplitAxis(ue,he,fe);var Fe=this._chooseSplitIndex(ue,he,fe),ce=Vt(ue.children.splice(Fe,ue.children.length-Fe));ce.height=ue.height,ce.leaf=ue.leaf,p(ue,this.toBBox),p(ce,this.toBBox),Ne?de[Ne-1].children.push(ce):this._splitRoot(ue,ce)},ze.prototype._splitRoot=function(de,Ne){this.data=Vt([de,Ne]),this.data.height=de.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},ze.prototype._chooseSplitIndex=function(de,Ne,ue){for(var fe,he,Fe,ce,ne,Me,ie,rt=1/0,Ve=1/0,Ke=Ne;Ke<=ue-Ne;Ke++){var Te=be(de,0,Ke,this.toBBox),Kt=be(de,Ke,ue,this.toBBox),At=(he=Te,Fe=Kt,void 0,void 0,void 0,void 0,ce=Math.max(he.minX,Fe.minX),ne=Math.max(he.minY,Fe.minY),Me=Math.min(he.maxX,Fe.maxX),ie=Math.min(he.maxY,Fe.maxY),Math.max(0,Me-ce)*Math.max(0,ie-ne)),we=Et(Te)+Et(Kt);At<rt?(rt=At,fe=Ke,Ve=we<Ve?we:Ve):At===rt&&we<Ve&&(Ve=we,fe=Ke)}return fe||ue-Ne},ze.prototype._chooseSplitAxis=function(de,Ne,ue){var fe=de.leaf?this.compareMinX:dt,he=de.leaf?this.compareMinY:ft;this._allDistMargin(de,Ne,ue,fe)<this._allDistMargin(de,Ne,ue,he)&&de.children.sort(fe)},ze.prototype._allDistMargin=function(de,Ne,ue,fe){de.children.sort(fe);for(var he=this.toBBox,Fe=be(de,0,Ne,he),ce=be(de,ue-Ne,ue,he),ne=rn(Fe)+rn(ce),Me=Ne;Me<ue-Ne;Me++){var ie=de.children[Me];Xe(Fe,de.leaf?he(ie):ie),ne+=rn(Fe)}for(var rt=ue-Ne-1;rt>=Ne;rt--){var Ve=de.children[rt];Xe(ce,de.leaf?he(Ve):Ve),ne+=rn(ce)}return ne},ze.prototype._adjustParentBBoxes=function(de,Ne,ue){for(var fe=ue;fe>=0;fe--)Xe(Ne[fe],de)},ze.prototype._condense=function(de){for(var Ne=de.length-1,ue=void 0;Ne>=0;Ne--)0===de[Ne].children.length?Ne>0?(ue=de[Ne-1].children).splice(ue.indexOf(de[Ne]),1):this.clear():p(de[Ne],this.toBBox)},ze}()},491:(sn,vt,qe)=>{"use strict";var Ee,ze=SyntaxError,ht=Function,p=TypeError,be=function(Kt){try{return ht('"use strict"; return ('+Kt+").constructor;")()}catch{}},Xe=Object.getOwnPropertyDescriptor;if(Xe)try{Xe({},"")}catch{Xe=null}var dt=function(){throw new p},ft=Xe?function(){try{return dt}catch{try{return Xe(arguments,"callee").get}catch{return dt}}}():dt,Et=qe(6152)(),rn=qe(9028)(),Dt=Object.getPrototypeOf||(rn?function(Kt){return Kt.__proto__}:null),mt={},Vt=typeof Uint8Array>"u"||!Dt?Ee:Dt(Uint8Array),hn={"%AggregateError%":typeof AggregateError>"u"?Ee:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Ee:ArrayBuffer,"%ArrayIteratorPrototype%":Et&&Dt?Dt([][Symbol.iterator]()):Ee,"%AsyncFromSyncIteratorPrototype%":Ee,"%AsyncFunction%":mt,"%AsyncGenerator%":mt,"%AsyncGeneratorFunction%":mt,"%AsyncIteratorPrototype%":mt,"%Atomics%":typeof Atomics>"u"?Ee:Atomics,"%BigInt%":typeof BigInt>"u"?Ee:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Ee:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Ee:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Ee:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?Ee:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Ee:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Ee:FinalizationRegistry,"%Function%":ht,"%GeneratorFunction%":mt,"%Int8Array%":typeof Int8Array>"u"?Ee:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Ee:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Ee:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Et&&Dt?Dt(Dt([][Symbol.iterator]())):Ee,"%JSON%":"object"==typeof JSON?JSON:Ee,"%Map%":typeof Map>"u"?Ee:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Et||!Dt?Ee:Dt((new Map)[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Ee:Promise,"%Proxy%":typeof Proxy>"u"?Ee:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?Ee:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Ee:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Et||!Dt?Ee:Dt((new Set)[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Ee:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Et&&Dt?Dt(""[Symbol.iterator]()):Ee,"%Symbol%":Et?Symbol:Ee,"%SyntaxError%":ze,"%ThrowTypeError%":ft,"%TypedArray%":Vt,"%TypeError%":p,"%Uint8Array%":typeof Uint8Array>"u"?Ee:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Ee:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Ee:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Ee:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?Ee:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Ee:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Ee:WeakSet};if(Dt)try{null.error}catch(Kt){var de=Dt(Dt(Kt));hn["%Error.prototype%"]=de}var Ne=function Kt(At){var we;if("%AsyncFunction%"===At)we=be("async function () {}");else if("%GeneratorFunction%"===At)we=be("function* () {}");else if("%AsyncGeneratorFunction%"===At)we=be("async function* () {}");else if("%AsyncGenerator%"===At){var at=Kt("%AsyncGeneratorFunction%");at&&(we=at.prototype)}else if("%AsyncIteratorPrototype%"===At){var Ae=Kt("%AsyncGenerator%");Ae&&Dt&&(we=Dt(Ae.prototype))}return hn[At]=we,we},ue={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},fe=qe(5333),he=qe(8533),Fe=fe.call(Function.call,Array.prototype.concat),ce=fe.call(Function.apply,Array.prototype.splice),ne=fe.call(Function.call,String.prototype.replace),Me=fe.call(Function.call,String.prototype.slice),ie=fe.call(Function.call,RegExp.prototype.exec),rt=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Ve=/\\(\\)?/g,Te=function(At,we){var Ae,at=At;if(he(ue,at)&&(at="%"+(Ae=ue[at])[0]+"%"),he(hn,at)){var it=hn[at];if(it===mt&&(it=Ne(at)),typeof it>"u"&&!we)throw new p("intrinsic "+At+" exists, but is not available. Please file an issue!");return{alias:Ae,name:at,value:it}}throw new ze("intrinsic "+At+" does not exist!")};sn.exports=function(At,we){if("string"!=typeof At||0===At.length)throw new p("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof we)throw new p('"allowMissing" argument must be a boolean');if(null===ie(/^%?[^%]*%?$/,At))throw new ze("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var at=function(At){var we=Me(At,0,1),at=Me(At,-1);if("%"===we&&"%"!==at)throw new ze("invalid intrinsic syntax, expected closing `%`");if("%"===at&&"%"!==we)throw new ze("invalid intrinsic syntax, expected opening `%`");var Ae=[];return ne(At,rt,function(it,pt,Ie,Ut){Ae[Ae.length]=Ie?ne(Ut,Ve,"$1"):pt||it}),Ae}(At),Ae=at.length>0?at[0]:"",it=Te("%"+Ae+"%",we),pt=it.name,Ie=it.value,Ut=!1,It=it.alias;It&&(Ae=It[0],ce(at,Fe([0,1],It)));for(var yn=1,Mt=!0;yn<at.length;yn+=1){var $n=at[yn],Nn=Me($n,0,1),Dn=Me($n,-1);if(('"'===Nn||"'"===Nn||"`"===Nn||'"'===Dn||"'"===Dn||"`"===Dn)&&Nn!==Dn)throw new ze("property names with quotes must have matching quotes");if(("constructor"===$n||!Mt)&&(Ut=!0),he(hn,pt="%"+(Ae+="."+$n)+"%"))Ie=hn[pt];else if(null!=Ie){if(!($n in Ie)){if(!we)throw new p("base intrinsic for "+At+" exists, but the property is not available.");return}if(Xe&&yn+1>=at.length){var gn=Xe(Ie,$n);Ie=(Mt=!!gn)&&"get"in gn&&!("originalValue"in gn.get)?gn.get:Ie[$n]}else Mt=he(Ie,$n),Ie=Ie[$n];Mt&&!Ut&&(hn[pt]=Ie)}}return Ie}},2486:(sn,vt,qe)=>{"use strict";var ze=qe(491)("%Object.defineProperty%",!0),ht=function(){if(ze)try{return ze({},"a",{value:1}),!0}catch{return!1}return!1};ht.hasArrayLengthDefineBug=function(){if(!ht())return null;try{return 1!==ze([],"length",{value:1}).length}catch{return!0}},sn.exports=ht},9028:sn=>{"use strict";var vt={foo:{}},qe=Object;sn.exports=function(){return{__proto__:vt}.foo===vt.foo&&!({__proto__:null}instanceof qe)}},6152:(sn,vt,qe)=>{"use strict";var Ee=typeof Symbol<"u"&&Symbol,ze=qe(5441);sn.exports=function(){return"function"==typeof Ee&&"function"==typeof Symbol&&"symbol"==typeof Ee("foo")&&"symbol"==typeof Symbol("bar")&&ze()}},5441:sn=>{"use strict";sn.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var qe={},Ee=Symbol("test"),ze=Object(Ee);if("string"==typeof Ee||"[object Symbol]"!==Object.prototype.toString.call(Ee)||"[object Symbol]"!==Object.prototype.toString.call(ze))return!1;for(Ee in qe[Ee]=42,qe)return!1;if("function"==typeof Object.keys&&0!==Object.keys(qe).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(qe).length)return!1;var p=Object.getOwnPropertySymbols(qe);if(1!==p.length||p[0]!==Ee||!Object.prototype.propertyIsEnumerable.call(qe,Ee))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var be=Object.getOwnPropertyDescriptor(qe,Ee);if(42!==be.value||!0!==be.enumerable)return!1}return!0}},8041:(sn,vt,qe)=>{"use strict";var Ee=qe(5441);sn.exports=function(){return Ee()&&!!Symbol.toStringTag}},8533:(sn,vt,qe)=>{"use strict";var Ee=qe(5333);sn.exports=Ee.call(Function.call,Object.prototype.hasOwnProperty)},8147:(sn,vt,qe)=>{"use strict";var Ee=qe(8041)(),ht=qe(1098)("Object.prototype.toString"),p=function(ft){return!(Ee&&ft&&"object"==typeof ft&&Symbol.toStringTag in ft)&&"[object Arguments]"===ht(ft)},be=function(ft){return!!p(ft)||null!==ft&&"object"==typeof ft&&"number"==typeof ft.length&&ft.length>=0&&"[object Array]"!==ht(ft)&&"[object Function]"===ht(ft.callee)},Xe=function(){return p(arguments)}();p.isLegacyArguments=be,sn.exports=Xe?p:be},2365:(sn,vt,qe)=>{"use strict";var Ee=Date.prototype.getDay,ht=Object.prototype.toString,be=qe(8041)();sn.exports=function(dt){return"object"==typeof dt&&null!==dt&&(be?function(dt){try{return Ee.call(dt),!0}catch{return!1}}(dt):"[object Date]"===ht.call(dt))}},4720:(sn,vt,qe)=>{"use strict";var ht,p,be,Xe,Ee=qe(1098),ze=qe(8041)();if(ze){ht=Ee("Object.prototype.hasOwnProperty"),p=Ee("RegExp.prototype.exec"),be={};var dt=function(){throw be};Xe={toString:dt,valueOf:dt},"symbol"==typeof Symbol.toPrimitive&&(Xe[Symbol.toPrimitive]=dt)}var ft=Ee("Object.prototype.toString"),Et=Object.getOwnPropertyDescriptor;sn.exports=ze?function(mt){if(!mt||"object"!=typeof mt)return!1;var Vt=Et(mt,"lastIndex");if(!Vt||!ht(Vt,"value"))return!1;try{p(mt,Xe)}catch(de){return de===be}}:function(mt){return!(!mt||"object"!=typeof mt&&"function"!=typeof mt)&&"[object RegExp]"===ft(mt)}},2574:function(sn){sn.exports=function(){"use strict";var vt,qe,Ee;function ze(p,be){if(vt)if(qe){var Xe="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+vt+")(sharedChunk); ("+qe+")(sharedChunk); self.onerror = null;",dt={};vt(dt),Ee=be(dt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Ee.workerUrl=window.URL.createObjectURL(new Blob([Xe],{type:"text/javascript"})))}else qe=be;else vt=be}return ze(0,function(p){var be=typeof self<"u"?self:{},Xe="2.15.0";let dt;const ft={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==dt){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{dt=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch{dt=a}}return dt},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ft.API_URL)return null;try{const a=new URL(ft.API_URL);return"api.mapbox.cn"===a.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===a.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Et={supported:!1,testSupport:function(a){!mt&&Dt&&(Vt?hn(a):rn=a)}};let rn,Dt,mt=!1,Vt=!1;function hn(a){const o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Dt),a.isContextLost())return;Et.supported=!0}catch{}a.deleteTexture(o),mt=!0}be.document&&(Dt=be.document.createElement("img"),Dt.onload=function(){rn&&hn(rn),rn=null,Vt=!0},Dt.onerror=function(){mt=!0,rn=null},Dt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const de="01";function Ne(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var ue=fe;function fe(a,o,u,f){this.cx=3*a,this.bx=3*(u-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(f-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=o,this.p2x=u,this.p2y=f}fe.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,o){if(void 0===o&&(o=1e-6),a<0)return 0;if(a>1)return 1;for(var u=a,f=0;f<8;f++){var _=this.sampleCurveX(u)-a;if(Math.abs(_)<o)return u;var E=this.sampleCurveDerivativeX(u);if(Math.abs(E)<1e-6)break;u-=_/E}var S=0,M=1;for(u=a,f=0;f<20&&(_=this.sampleCurveX(u),!(Math.abs(_-a)<o));f++)a>_?S=u:M=u,u=.5*(M-S)+S;return u},solve:function(a,o){return this.sampleCurveY(this.solveCurveX(a,o))}};var he=Ne(ue),Fe=ce;function ce(a,o){this.x=a,this.y=o}ce.prototype={clone:function(){return new ce(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,o){return this.clone()._rotateAround(a,o)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var o=a.x-this.x,u=a.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,o){return Math.atan2(this.x*o-this.y*a,this.x*a+this.y*o)},_matMult:function(a){var o=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=o,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var o=Math.cos(a),u=Math.sin(a),f=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=f,this},_rotateAround:function(a,o){var u=Math.cos(a),f=Math.sin(a),_=o.y+f*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-f*(this.y-o.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ce.convert=function(a){return a instanceof ce?a:Array.isArray(a)?new ce(a[0],a[1]):a};var ne=Ne(Fe);const Me=Math.PI/180,ie=180/Math.PI;function rt(a){return a*Me}function Ve(a){return a*ie}const Ke=[[0,0],[1,0],[1,1],[0,1]];function Te(a){if(a<=0)return 0;if(a>=1)return 1;const o=a*a,u=o*a;return 4*(a<.5?u:3*(a-o)+u-.75)}function Kt(a,o,u,f){const _=new he(a,o,u,f);return function(E){return _.solve(E)}}const At=Kt(.25,.1,.25,1);function we(a,o,u){return Math.min(u,Math.max(o,a))}function at(a,o,u){return(u=we((u-a)/(o-a),0,1))*u*(3-2*u)}function Ae(a,o,u){const f=u-o,_=((a-o)%f+f)%f+o;return _===o?u:_}function it(a,o,u){if(!a.length)return u(null,[]);let f=a.length;const _=new Array(a.length);let E=null;a.forEach((S,M)=>{o(S,(P,R)=>{P&&(E=P),_[M]=R,0==--f&&u(E,_)})})}function pt(a){const o=[];for(const u in a)o.push(a[u]);return o}function Ie(a,...o){for(const u of o)for(const f in u)a[f]=u[f];return a}let Ut=1;function It(){return Ut++}function yn(){return function a(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function Mt(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function $n(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Nn(a,o){a.forEach(u=>{o[u]&&(o[u]=o[u].bind(o))})}function Dn(a,o){return-1!==a.indexOf(o,a.length-o.length)}function gn(a,o,u){const f={};for(const _ in a)f[_]=o.call(u||this,a[_],_,a);return f}function bn(a,o,u){const f={};for(const _ in a)o.call(u||this,a[_],_,a)&&(f[_]=a[_]);return f}function un(a){return Array.isArray(a)?a.map(un):"object"==typeof a&&a?gn(a,un):a}const Ai={};function gr(a){Ai[a]||(typeof console<"u"&&console.warn(a),Ai[a]=!0)}function ii(a,o,u){return(u.y-a.y)*(o.x-a.x)>(o.y-a.y)*(u.x-a.x)}function ir(a){let o=0;for(let u,f,_=0,E=a.length,S=E-1;_<E;S=_++)u=a[_],f=a[S],o+=(f.x-u.x)*(u.y+f.y);return o}function lr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ye(a){const o={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,f,_,E)=>{const S=_||E;return o[f]=!S||S.toLowerCase(),""}),o["max-age"]){const u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}let Z=null;function Y(a){if(null==Z){const o=a.navigator?a.navigator.userAgent:null;Z=!!a.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Z}function J(a){try{const o=be[a];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch{return!1}}function xe(a,o){return[a[4*o],a[4*o+1],a[4*o+2],a[4*o+3]]}const We="mapbox-tiles";let Gt,Ot,Tt=500,Ht=50;function or(){try{return be.caches}catch{}}function _r(){or()&&!Gt&&(Gt=be.caches.open(We))}function Sn(a){const o=a.indexOf("?");if(o<0)return a;const f=function(_){const E=_.indexOf("?");return E>0?_.slice(E+1).split("&"):[]}(a).filter(_=>{const E=_.split("=");return"language"===E[0]||"worldview"===E[0]});return f.length?`${a.slice(0,o)}?${f.join("&")}`:a.slice(0,o)}let Cr=1/0;const kr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(kr);class Fr extends Error{constructor(o,u,f){401===u&&Ct(f)&&(o+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(o),this.status=u,this.url=f}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const mr=lr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===be.location.protocol?be.parent:be).location.href,yi=function(a,o){if(!(/^file:/.test(u=a.url)||/^file:/.test(mr())&&!/^\w+:/.test(u))){if(be.fetch&&be.Request&&be.AbortController&&be.Request.prototype.hasOwnProperty("signal"))return function(f,_){const E=new be.AbortController,S=new be.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:mr(),referrerPolicy:f.referrerPolicy,signal:E.signal});let M=!1,P=!1;const R=(z=S.url).indexOf("sku=")>0&&Ct(z);var z;"json"===f.type&&S.headers.set("Accept","application/json");const U=(q,W,re)=>{if(P)return;if(q&&"SecurityError"!==q.message&&gr(q.toString()),W&&re)return G(W);const ve=Date.now();be.fetch(S).then(ke=>{if(ke.ok){const et=R?ke.clone():null;return G(ke,et,ve)}return _(new Fr(ke.statusText,ke.status,f.url))}).catch(ke=>{"AbortError"!==ke.name&&_(new Error(`${ke.message} ${f.url}`))})},G=(q,W,re)=>{("arrayBuffer"===f.type?q.arrayBuffer():"json"===f.type?q.json():q.text()).then(ve=>{P||(W&&re&&function(ke,et,Be){if(_r(),!Gt)return;const Je={status:et.status,statusText:et.statusText,headers:new be.Headers};et.headers.forEach((zt,Rt)=>Je.headers.set(Rt,zt));const nt=ye(et.headers.get("Cache-Control")||"");if(nt["no-store"])return;nt["max-age"]&&Je.headers.set("Expires",new Date(Be+1e3*nt["max-age"]).toUTCString());const ot=Je.headers.get("Expires");ot&&(new Date(ot).getTime()-Be<42e4||function(zt,Rt){if(void 0===Ot)try{new Response(new ReadableStream),Ot=!0}catch{Ot=!1}Ot?Rt(zt.body):zt.blob().then(Rt)}(et,zt=>{const Rt=new be.Response(zt,Je);_r(),Gt&&Gt.then(Xt=>Xt.put(Sn(ke.url),Rt)).catch(Xt=>gr(Xt.message))}))}(S,W,re),M=!0,_(null,ve,q.headers.get("Cache-Control"),q.headers.get("Expires")))}).catch(ve=>{P||_(new Error(ve.message))})};return R?function(q,W){if(_r(),!Gt)return W(null);const re=Sn(q.url);Gt.then(ve=>{ve.match(re).then(ke=>{const et=function(Be){if(!Be)return!1;const Je=new Date(Be.headers.get("Expires")||0),nt=ye(Be.headers.get("Cache-Control")||"");return Je>Date.now()&&!nt["no-cache"]}(ke);ve.delete(re),et&&ve.put(re,ke.clone()),W(null,ke,et)}).catch(W)}).catch(W)}(S,U):U(null,null),{cancel:()=>{P=!0,M||E.abort()}}}(a,o);if(lr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,o,void 0,!0)}var u;return function(f,_){const E=new be.XMLHttpRequest;E.open(f.method||"GET",f.url,!0),"arrayBuffer"===f.type&&(E.responseType="arraybuffer");for(const S in f.headers)E.setRequestHeader(S,f.headers[S]);return"json"===f.type&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials="include"===f.credentials,E.onerror=()=>{_(new Error(E.statusText))},E.onload=()=>{if((E.status>=200&&E.status<300||0===E.status)&&null!==E.response){let S=E.response;if("json"===f.type)try{S=JSON.parse(E.response)}catch(M){return _(M)}_(null,S,E.getResponseHeader("Cache-Control"),E.getResponseHeader("Expires"))}else _(new Fr(E.statusText,E.status,f.url))},E.send(f.body),{cancel:()=>E.abort()}}(a,o)},Po=function(a,o){return yi(Ie(a,{type:"arrayBuffer"}),o)};function bs(a){const o=be.document.createElement("a");return o.href=a,o.protocol===be.document.location.protocol&&o.host===be.document.location.host}const Ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let se,ae;se=[],ae=0;const je=function(a,o){if(Et.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),ae>=ft.MAX_PARALLEL_IMAGE_REQUESTS){const E={requestParameters:a,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return se.push(E),E}ae++;let u=!1;const f=()=>{if(!u)for(u=!0,ae--;se.length&&ae<ft.MAX_PARALLEL_IMAGE_REQUESTS;){const E=se.shift(),{requestParameters:S,callback:M,cancelled:P}=E;P||(E.cancel=je(S,M).cancel)}},_=Po(a,(E,S,M,P)=>{f(),E?o(E):S&&(be.createImageBitmap?function(R,z){const U=new be.Blob([new Uint8Array(R)],{type:"image/png"});be.createImageBitmap(U).then(G=>{z(null,G)}).catch(G=>{z(new Error(`Could not load image because of ${G.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(S,(R,z)=>o(R,z,M,P)):function(R,z){const U=new be.Image,G=be.URL;U.onload=()=>{z(null,U),G.revokeObjectURL(U.src),U.onload=null,be.requestAnimationFrame(()=>{U.src=Ge})},U.onerror=()=>z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const q=new be.Blob([new Uint8Array(R)],{type:"image/png"});U.src=R.byteLength?G.createObjectURL(q):Ge}(S,(R,z)=>o(R,z,M,P)))});return{cancel:()=>{_.cancel(),f()}}},tt="NO_ACCESS_TOKEN";function Oe(a){return 0===a.indexOf("mapbox:")}function Ct(a){return ft.API_URL_REGEX.test(a)}function bt(a){return ft.API_CDN_URL_REGEX.test(a)}function Qe(a){return ft.API_STYLE_REGEX.test(a)&&!Lt(a)}function Lt(a){return ft.API_SPRITE_REGEX.test(a)}const fn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function En(a){const o=a.match(fn);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function pn(a){const o=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${o}`}const Vr="mapbox.eventData";function Kr(a){if(!a)return null;const o=a.split(".");if(!o||3!==o.length)return null;try{return JSON.parse(decodeURIComponent(be.atob(o[1]).split("").map(u=>"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ur{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const u=Kr(ft.ACCESS_TOKEN);let f="";return f=u&&u.u?be.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,(_,E)=>String.fromCharCode(+("0x"+E)))):ft.ACCESS_TOKEN||"",o?`${Vr}.${o}:${f}`:`${Vr}:${f}`}fetchEventData(){const o=J("localStorage"),u=this.getStorageKey(),f=this.getStorageKey("uuid");if(o)try{const _=be.localStorage.getItem(u);_&&(this.eventData=JSON.parse(_));const E=be.localStorage.getItem(f);E&&(this.anonId=E)}catch{gr("Unable to read from LocalStorage")}}saveEventData(){const o=J("localStorage"),u=this.getStorageKey(),f=this.getStorageKey("uuid");if(o)try{be.localStorage.setItem(f,this.anonId),Object.keys(this.eventData).length>=1&&be.localStorage.setItem(u,JSON.stringify(this.eventData))}catch{gr("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,u,f,_){if(!ft.EVENTS_URL)return;const E=En(ft.EVENTS_URL);E.params.push(`access_token=${_||ft.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(o).toISOString()},M=u?Ie(S,u):S,P={url:pn(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};var z;this.pendingRequest=(z=R=>{this.pendingRequest=null,f(R),this.saveEventData(),this.processRequests(_)},yi(Ie(P,{method:"POST"}),z))}queueRequest(o,u){this.queue.push(o),this.processRequests(u)}}const Nr=new class extends Ur{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,o){ft.EVENTS_URL&&ft.ACCESS_TOKEN&&Array.isArray(a)&&a.some(u=>Oe(u)||Ct(u))&&this.queueRequest(Date.now(),o)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=Kr(ft.ACCESS_TOKEN),u=o?o.u:ft.ACCESS_TOKEN;let f=u!==this.eventData.tokenU;$n(this.anonId)||(this.anonId=yn(),f=!0);const _=this.queue.shift();if(this.eventData.lastSuccess){const E=new Date(this.eventData.lastSuccess),S=new Date(_),M=(_-this.eventData.lastSuccess)/864e5;f=f||M>=1||M<-1||E.getDate()!==S.getDate()}else f=!0;f?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Xe,skuId:de,"enabled.telemetry":!1,userId:this.anonId},E=>{E||(this.eventData.lastSuccess=_,this.eventData.tokenU=u)},a):this.processRequests()}},Qr=Nr.postTurnstileEvent.bind(Nr),Ro=new class extends Ur{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,o,u,f){this.skuToken=o,this.errorCb=f,ft.EVENTS_URL&&(u||ft.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},u):this.errorCb(new Error(tt)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:u}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),$n(this.anonId)||(this.anonId=yn()),this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Xe,skuId:de,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):o&&(this.success[o]=!0)},a))}},Jr=Ro.postMapLoadEvent.bind(Ro),Br=new class extends Ur{constructor(){super("gljs.performance")}postPerformanceEvent(a,o){ft.EVENTS_URL&&(a||ft.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},a)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:o,performanceData:u}=this.queue.shift(),f=function(_){const E=be.performance.getEntriesByType("resource"),S=be.performance.getEntriesByType("mark"),M=function(G){const q={};if(G)for(const W in G)if("other"!==W)for(const re of G[W]){const ve=`${W}ResolveRangeMin`,ke=`${W}ResolveRangeMax`,et=`${W}RequestCount`,Be=`${W}RequestCachedCount`;q[ve]=Math.min(q[ve]||1/0,re.startTime),q[ke]=Math.max(q[ke]||-1/0,re.responseEnd);const Je=nt=>{void 0===q[nt]&&(q[nt]=0),++q[nt]};void 0!==re.transferSize&&0===re.transferSize&&Je(Be),Je(et)}return q}(function(G,q){const W={};if(G)for(const re of G){const ve=q(re);void 0===W[ve]&&(W[ve]=[]),W[ve].push(re)}return W}(E,zl)),P=be.devicePixelRatio,R=be.navigator.connection||be.navigator.mozConnection||be.navigator.webkitConnection,z={counters:[],metadata:[],attributes:[]},U=(G,q,W)=>{null!=W&&G.push({name:q,value:W.toString()})};for(const G in M)U(z.counters,G,M[G]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(U(z.counters,"interactionRangeMin",_.interactionRange[0]),U(z.counters,"interactionRangeMax",_.interactionRange[1])),S)for(const G of Object.keys(Bl)){const q=Bl[G],W=S.find(re=>re.name===q);W&&U(z.counters,q,W.startTime)}return U(z.counters,"visibilityHidden",_.visibilityHidden),U(z.attributes,"style",function(G){if(G)for(const q of G){const W=q.name.split("?")[0];if(Qe(W)){const re=W.split("/").slice(-2);if(2===re.length)return`mapbox://styles/${re[0]}/${re[1]}`}}}(E)),U(z.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),U(z.attributes,"fogEnabled",_.fogEnabled?"true":"false"),U(z.attributes,"projection",_.projection),U(z.attributes,"zoom",_.zoom),U(z.metadata,"devicePixelRatio",P),U(z.metadata,"connectionEffectiveType",R?R.effectiveType:void 0),U(z.metadata,"navigatorUserAgent",be.navigator.userAgent),U(z.metadata,"screenWidth",be.screen.width),U(z.metadata,"screenHeight",be.screen.height),U(z.metadata,"windowWidth",be.innerWidth),U(z.metadata,"windowHeight",be.innerHeight),U(z.metadata,"mapWidth",_.width/P),U(z.metadata,"mapHeight",_.height/P),U(z.metadata,"webglRenderer",_.renderer),U(z.metadata,"webglVendor",_.vendor),U(z.metadata,"sdkVersion",Xe),U(z.metadata,"sdkIdentifier","mapbox-gl-js"),z}(u);for(const _ of f.metadata);for(const _ of f.counters);for(const _ of f.attributes);this.postEvent(o,f,()=>{},a)}},_o=Br.postPerformanceEvent.bind(Br),$s=new class extends Ur{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,o,u,f){if(!ft.API_URL||!ft.SESSION_PATH)return;const _=En(ft.API_URL+ft.SESSION_PATH);_.params.push(`sku=${o||""}`),_.params.push(`access_token=${f||ft.ACCESS_TOKEN||""}`);const E={url:pn(_),headers:{"Content-Type":"text/plain"}};var M;this.pendingRequest=(M=S=>{this.pendingRequest=null,u(S),this.saveEventData(),this.processRequests(f)},yi(Ie(E,{method:"GET"}),M))}getSessionAPI(a,o,u,f){this.skuToken=o,this.errorCb=f,ft.SESSION_PATH&&ft.API_URL&&(u||ft.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},u):this.errorCb(new Error(tt)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:u}=this.queue.shift();o&&this.success[o]||this.getSession(u,this.skuToken,f=>{f?this.errorCb(f):o&&(this.success[o]=!0)},a)}},To=$s.getSessionAPI.bind($s),Vi=new Set,Bl={create:"create",load:"load",fullLoad:"fullLoad"},Cl={mark(a){be.performance.mark(a)},measure(a,o,u){be.performance.measure(a,o,u)}};function zl(a){const o=a.name.split("?")[0];return bt(o)&&o.includes("mapbox-gl.js")?"javascript":bt(o)&&o.includes("mapbox-gl.css")?"css":ft.API_FONTS_REGEX.test(o)?"fontRange":Lt(o)?"sprite":Qe(o)?"style":ft.API_TILEJSON_REGEX.test(o)?"tilejson":"other"}const Hr=be.performance;function Ps(a){const o=a?a.url.toString():void 0;return Hr.getEntriesByName(o)}let Fi,vi,Jc,ps;const Na={now:()=>void 0!==Jc?Jc:be.performance.now(),setNow(a){Jc=a},restoreNow(){Jc=void 0},frame(a){const o=be.requestAnimationFrame(a);return{cancel:()=>be.cancelAnimationFrame(o)}},getImageData(a,o=0){const{width:u,height:f}=a;ps||(ps=be.document.createElement("canvas"));const _=ps.getContext("2d",{willReadFrequently:!0});if(!_)throw new Error("failed to create canvas 2d context");return(u>ps.width||f>ps.height)&&(ps.width=u,ps.height=f),_.clearRect(-o,-o,u+2*o,f+2*o),_.drawImage(a,0,0,u,f),_.getImageData(-o,-o,u+2*o,f+2*o)},resolveURL:a=>(Fi||(Fi=be.document.createElement("a")),Fi.href=a,Fi.href),get devicePixelRatio(){return be.devicePixelRatio},get prefersReducedMotion(){return!!be.matchMedia&&(null==vi&&(vi=be.matchMedia("(prefers-reduced-motion: reduce)")),vi.matches)}};function qo(a,o,u){u[a]&&-1!==u[a].indexOf(o)||(u[a]=u[a]||[],u[a].push(o))}function Tu(a,o,u){if(u&&u[a]){const f=u[a].indexOf(o);-1!==f&&u[a].splice(f,1)}}class Hs{constructor(o,u={}){Ie(this,u),this.type=o}}class da extends Hs{constructor(o,u={}){super("error",Ie({error:o},u))}}class fa{on(o,u){return this._listeners=this._listeners||{},qo(o,u,this._listeners),this}off(o,u){return Tu(o,u,this._listeners),Tu(o,u,this._oneTimeListeners),this}once(o,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},qo(o,u,this._oneTimeListeners),this):new Promise(f=>this.once(o,f))}fire(o,u){"string"==typeof o&&(o=new Hs(o,u||{}));const f=o.type;if(this.listens(f)){o.target=this;const _=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const M of _)M.call(this,o);const E=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const M of E)Tu(f,M,this._oneTimeListeners),M.call(this,o);const S=this._eventedParent;S&&(Ie(o,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),S.fire(o))}else o instanceof da&&console.error(o.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,u){return this._eventedParent=o,this._eventedParentData=u,this}}var Wt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Vl(a,...o){for(const u of o)for(const f in u)a[f]=u[f];return a}function gs(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Bs(a){if(Array.isArray(a))return a.map(Bs);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const o={};for(const u in a)o[u]=Bs(a[u]);return o}return gs(a)}class ts extends Error{constructor(o,u){super(u),this.message=u,this.key=o}}var uu=ts;class Ul{constructor(o,u=[]){this.parent=o,this.bindings={};for(const[f,_]of u)this.bindings[f]=_}concat(o){return new Ul(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}var Ld=Ul;const ws={kind:"null"},on={kind:"number"},Rn={kind:"string"},Mr={kind:"boolean"},$a={kind:"color"},ur={kind:"object"},ei={kind:"value"},jl={kind:"collator"},Ni={kind:"formatted"},qs={kind:"resolvedImage"};function xi(a,o){return{kind:"array",itemType:a,N:o}}function Io(a){if("array"===a.kind){const o=Io(a.itemType);return"number"==typeof a.N?`array<${o}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${o}>`}return a.kind}const mf=[ws,on,Rn,Mr,$a,Ni,ur,xi(ei),qs];function $t(a,o){if("error"===o.kind)return null;if("array"===a.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!$t(a.itemType,o.itemType))&&("number"!=typeof a.N||a.N===o.N))return null}else{if(a.kind===o.kind)return null;if("value"===a.kind)for(const u of mf)if(!$t(u,o))return null}return`Expected ${Io(a)} but found ${Io(o)} instead.`}function Rr(a,o){return o.some(u=>u.kind===a.kind)}function Pa(a,o){return o.some(u=>"null"===u?null===a:"array"===u?Array.isArray(a):"object"===u?a&&!Array.isArray(a)&&"object"==typeof a:u===typeof a)}var Sl,kd={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Rs(a){return(a=Math.round(a))<0?0:a>255?255:a}function en(a){return Rs("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function di(a){return(o="%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))<0?0:o>1?1:o;var o}function Yn(a,o,u){return u<0?u+=1:u>1&&(u-=1),6*u<1?a+(o-a)*u*6:2*u<1?o:3*u<2?a+(o-a)*(2/3-u)*6:a}try{Sl={}.parseCSSColor=function(a){var o,u=a.replace(/ /g,"").toLowerCase();if(u in kd)return kd[u].slice();if("#"===u[0])return 4===u.length?(o=parseInt(u.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:7===u.length&&(o=parseInt(u.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var f=u.indexOf("("),_=u.indexOf(")");if(-1!==f&&_+1===u.length){var E=u.substr(0,f),S=u.substr(f+1,_-(f+1)).split(","),M=1;switch(E){case"rgba":if(4!==S.length)return null;M=di(S.pop());case"rgb":return 3!==S.length?null:[en(S[0]),en(S[1]),en(S[2]),M];case"hsla":if(4!==S.length)return null;M=di(S.pop());case"hsl":if(3!==S.length)return null;var P=(parseFloat(S[0])%360+360)%360/360,R=di(S[1]),z=di(S[2]),U=z<=.5?z*(R+1):z+R-z*R,G=2*z-U;return[Rs(255*Yn(G,U,P+1/3)),Rs(255*Yn(G,U,P)),Rs(255*Yn(G,U,P-1/3)),M];default:return null}}return null}}catch{}class si{constructor(o,u,f,_=1){this.r=o,this.g=u,this.b=f,this.a=_}static parse(o){if(!o)return;if(o instanceof si)return o;if("string"!=typeof o)return;const u=Sl(o);return u?new si(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3]):void 0}toString(){const[o,u,f,_]=this.toArray();return`rgba(${Math.round(o)},${Math.round(u)},${Math.round(f)},${_})`}toArray(){const{r:o,g:u,b:f,a:_}=this;return 0===_?[0,0,0,0]:[255*o/_,255*u/_,255*f/_,_]}toArray01(){const{r:o,g:u,b:f,a:_}=this;return 0===_?[0,0,0,0]:[o/_,u/_,f/_,_]}toArray01PremultipliedAlpha(){const{r:o,g:u,b:f,a:_}=this;return[o,u,f,_]}}si.black=new si(0,0,0,1),si.white=new si(1,1,1,1),si.transparent=new si(0,0,0,0),si.red=new si(1,0,0,1),si.blue=new si(0,0,1,1);var zs=si;class el{constructor(o,u,f){this.sensitivity=o?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,u){return this.collator.compare(o,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Eh{constructor(o,u,f,_,E){this.text=o.normalize?o.normalize():o,this.image=u,this.scale=f,this.fontStack=_,this.textColor=E}}class zo{constructor(o){this.sections=o}static fromString(o){return new zo([new Eh(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.name.length)}static factory(o){return o instanceof zo?o:zo.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const u of this.sections){if(u.image){o.push(["image",u.image.name]);continue}o.push(u.text);const f={};u.fontStack&&(f["text-font"]=["literal",u.fontStack.split(",")]),u.scale&&(f["font-scale"]=u.scale),u.textColor&&(f["text-color"]=["rgba"].concat(u.textColor.toArray())),o.push(f)}return o}}class Sr{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new Sr({name:o,available:!1}):null}serialize(){return["image",this.name]}}function Kh(a,o,u,f){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof u&&u>=0&&u<=255?void 0===f||"number"==typeof f&&f>=0&&f<=1?null:`Invalid rgba value [${[a,o,u,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof f?[a,o,u,f]:[a,o,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Os(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof zs||a instanceof el||a instanceof zo||a instanceof Sr)return!0;if(Array.isArray(a)){for(const o of a)if(!Os(o))return!1;return!0}if("object"==typeof a){for(const o in a)if(!Os(a[o]))return!1;return!0}return!1}function Es(a){if(null===a)return ws;if("string"==typeof a)return Rn;if("boolean"==typeof a)return Mr;if("number"==typeof a)return on;if(a instanceof zs)return $a;if(a instanceof el)return jl;if(a instanceof zo)return Ni;if(a instanceof Sr)return qs;if(Array.isArray(a)){const o=a.length;let u;for(const f of a){const _=Es(f);if(u){if(u===_)continue;u=ei;break}u=_}return xi(u||ei,o)}return ur}function tl(a){const o=typeof a;return null===a?"":"string"===o||"number"===o||"boolean"===o?String(a):a instanceof zs||a instanceof zo||a instanceof Sr?a.toString():JSON.stringify(a)}class Vo{constructor(o,u){this.type=o,this.value=u}static parse(o,u){if(2!==o.length)return u.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Os(o[1]))return u.error("invalid value");const f=o[1];let _=Es(f);const E=u.expectedType;return"array"!==_.kind||0!==_.N||!E||"array"!==E.kind||"number"==typeof E.N&&0!==E.N||(_=E),new Vo(_,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof zs?["rgba"].concat(this.value.toArray()):this.value instanceof zo?this.value.serialize():this.value}}var Ws=Vo,Zs=class{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}};const Dl={string:Rn,number:on,boolean:Mr,object:ur};class cu{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");let f,_=1;const E=o[0];if("array"===E){let M,P;if(o.length>2){const R=o[1];if("string"!=typeof R||!(R in Dl)||"object"===R)return u.error('The item type argument of "array" must be one of string, number, boolean',1);M=Dl[R],_++}else M=ei;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return u.error('The length argument to "array" must be a positive integer literal',2);P=o[2],_++}f=xi(M,P)}else f=Dl[E];const S=[];for(;_<o.length;_++){const M=u.parse(o[_],_,ei);if(!M)return null;S.push(M)}return new cu(f,S)}evaluate(o){for(let u=0;u<this.args.length;u++){const f=this.args[u].evaluate(o);if(!$t(this.type,Es(f)))return f;if(u===this.args.length-1)throw new Zs(`Expected value to be of type ${Io(this.type)}, but found ${Io(Es(f))} instead.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,u=[o.kind];if("array"===o.kind){const f=o.itemType;if("string"===f.kind||"number"===f.kind||"boolean"===f.kind){u.push(f.kind);const _=o.N;("number"==typeof _||this.args.length>1)&&u.push(_)}}return u.concat(this.args.map(f=>f.serialize()))}}var nl=cu;class Tl{constructor(o){this.type=Ni,this.sections=o}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");const f=o[1];if(!Array.isArray(f)&&"object"==typeof f)return u.error("First argument must be an image or text section.");const _=[];let E=!1;for(let S=1;S<=o.length-1;++S){const M=o[S];if(E&&"object"==typeof M&&!Array.isArray(M)){E=!1;let P=null;if(M["font-scale"]&&(P=u.parse(M["font-scale"],1,on),!P))return null;let R=null;if(M["text-font"]&&(R=u.parse(M["text-font"],1,xi(Rn)),!R))return null;let z=null;if(M["text-color"]&&(z=u.parse(M["text-color"],1,$a),!z))return null;const U=_[_.length-1];U.scale=P,U.font=R,U.textColor=z}else{const P=u.parse(o[S],1,ei);if(!P)return null;const R=P.type.kind;if("string"!==R&&"value"!==R&&"null"!==R&&"resolvedImage"!==R)return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,_.push({content:P,scale:null,font:null,textColor:null})}}return new Tl(_)}evaluate(o){return new zo(this.sections.map(u=>{const f=u.content.evaluate(o);return Es(f)===qs?new Eh("",f,null,null,null):new Eh(tl(f),null,u.scale?u.scale.evaluate(o):null,u.font?u.font.evaluate(o).join(","):null,u.textColor?u.textColor.evaluate(o):null)}))}eachChild(o){for(const u of this.sections)o(u.content),u.scale&&o(u.scale),u.font&&o(u.font),u.textColor&&o(u.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const u of this.sections){o.push(u.content.serialize());const f={};u.scale&&(f["font-scale"]=u.scale.serialize()),u.font&&(f["text-font"]=u.font.serialize()),u.textColor&&(f["text-color"]=u.textColor.serialize()),o.push(f)}return o}}class ms{constructor(o){this.type=qs,this.input=o}static parse(o,u){if(2!==o.length)return u.error("Expected two arguments.");const f=u.parse(o[1],1,Rn);return f?new ms(f):u.error("No image name provided.")}evaluate(o){const u=this.input.evaluate(o),f=Sr.fromString(u);return f&&o.availableImages&&(f.available=o.availableImages.indexOf(u)>-1),f}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Gl={"to-boolean":Mr,"to-color":$a,"to-number":on,"to-string":Rn};class ti{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expected at least one argument.");const f=o[0];if(("to-boolean"===f||"to-string"===f)&&2!==o.length)return u.error("Expected one argument.");const _=Gl[f],E=[];for(let S=1;S<o.length;S++){const M=u.parse(o[S],S,ei);if(!M)return null;E.push(M)}return new ti(_,E)}evaluate(o){if("boolean"===this.type.kind)return!!this.args[0].evaluate(o);if("color"===this.type.kind){let u,f;for(const _ of this.args){if(u=_.evaluate(o),f=null,u instanceof zs)return u;if("string"==typeof u){const E=o.parseColor(u);if(E)return E}else if(Array.isArray(u)&&(f=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:Kh(u[0],u[1],u[2],u[3]),!f))return new zs(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new Zs(f||`Could not parse color from value '${"string"==typeof u?u:String(JSON.stringify(u))}'`)}if("number"===this.type.kind){let u=null;for(const f of this.args){if(u=f.evaluate(o),null===u)return 0;const _=Number(u);if(!isNaN(_))return _}throw new Zs(`Could not convert ${JSON.stringify(u)} to number.`)}return"formatted"===this.type.kind?zo.fromString(tl(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?Sr.fromString(tl(this.args[0].evaluate(o))):tl(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Tl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ms(this.args[0]).serialize();const o=[`to-${this.type.kind}`];return this.eachChild(u=>{o.push(u.serialize())}),o}}var Uo=ti;const Oo=["Unknown","Point","LineString","Polygon"];var Jh=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Oo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:u,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*o-a[0])+this.featureDistanceData.bearing[1]*(f*o-a[1])}return 0}parseColor(a){let o=this._parseColorCache[a];return o||(o=this._parseColorCache[a]=zs.parse(a)),o}};class Gn{constructor(o,u,f,_){this.name=o,this.type=u,this._evaluate=f,this.args=_}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,u){const f=o[0],_=Gn.definitions[f];if(!_)return u.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const E=Array.isArray(_)?_[0]:_.type,S=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,M=S.filter(([R])=>!Array.isArray(R)||R.length===o.length-1);let P=null;for(const[R,z]of M){P=new ac(u.registry,u.path,null,u.scope);const U=[];let G=!1;for(let q=1;q<o.length;q++){const W=o[q],re=Array.isArray(R)?R[q-1]:R.type,ve=P.parse(W,1+U.length,re);if(!ve){G=!0;break}U.push(ve)}if(!G)if(Array.isArray(R)&&R.length!==U.length)P.error(`Expected ${R.length} arguments, but found ${U.length} instead.`);else{for(let q=0;q<U.length;q++){const W=Array.isArray(R)?R[q]:R.type,re=U[q];P.concat(q+1).checkSubtype(W,re.type)}if(0===P.errors.length)return new Gn(f,E,z,U)}}if(1===M.length)u.errors.push(...P.errors);else{const R=(M.length?M:S).map(([U])=>{return G=U,Array.isArray(G)?`(${G.map(Io).join(", ")})`:`(${Io(G.type)}...)`;var G}).join(" | "),z=[];for(let U=1;U<o.length;U++){const G=u.parse(o[U],1+z.length);if(!G)return null;z.push(Io(G.type))}u.error(`Expected arguments of type ${R}, but found (${z.join(", ")}) instead.`)}return null}static register(o,u){Gn.definitions=u;for(const f in u)o[f]=Gn}}var $l=Gn;class Ti{constructor(o,u,f){this.type=jl,this.locale=f,this.caseSensitive=o,this.diacriticSensitive=u}static parse(o,u){if(2!==o.length)return u.error("Expected one argument.");const f=o[1];if("object"!=typeof f||Array.isArray(f))return u.error("Collator options argument must be an object.");const _=u.parse(void 0!==f["case-sensitive"]&&f["case-sensitive"],1,Mr);if(!_)return null;const E=u.parse(void 0!==f["diacritic-sensitive"]&&f["diacritic-sensitive"],1,Mr);if(!E)return null;let S=null;return f.locale&&(S=u.parse(f.locale,1,Rn),!S)?null:new Ti(_,E,S)}evaluate(o){return new el(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}const Hl=8192;function ra(a,o){a[0]=Math.min(a[0],o[0]),a[1]=Math.min(a[1],o[1]),a[2]=Math.max(a[2],o[0]),a[3]=Math.max(a[3],o[1])}function fl(a,o){return!(a[0]<=o[0]||a[2]>=o[2]||a[1]<=o[1]||a[3]>=o[3])}function Vs(a,o){const u=(180+a[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,_=Math.pow(2,o.z);return[Math.round(u*_*Hl),Math.round(f*_*Hl)]}function oc(a,o,u){const f=a[0]-o[0],_=a[1]-o[1],E=a[0]-u[0],S=a[1]-u[1];return f*S-E*_==0&&f*E<=0&&_*S<=0}function Ha(a,o){let u=!1;for(let S=0,M=o.length;S<M;S++){const P=o[S];for(let R=0,z=P.length;R<z-1;R++){if(oc(a,P[R],P[R+1]))return!1;(_=P[R])[1]>(f=a)[1]!=(E=P[R+1])[1]>f[1]&&f[0]<(E[0]-_[0])*(f[1]-_[1])/(E[1]-_[1])+_[0]&&(u=!u)}}var f,_,E;return u}function sc(a,o){for(let u=0;u<o.length;u++)if(Ha(a,o[u]))return!0;return!1}function jo(a,o,u,f){const _=f[0]-u[0],E=f[1]-u[1],S=(a[0]-u[0])*E-_*(a[1]-u[1]),M=(o[0]-u[0])*E-_*(o[1]-u[1]);return S>0&&M<0||S<0&&M>0}function er(a,o,u){for(const R of u)for(let z=0;z<R.length-1;++z)if((M=[(S=R[z+1])[0]-(E=R[z])[0],S[1]-E[1]])[0]*(P=[(_=o)[0]-(f=a)[0],_[1]-f[1]])[1]-M[1]*P[0]!=0&&jo(f,_,E,S)&&jo(E,S,f,_))return!0;var f,_,E,S,M,P;return!1}function Kn(a,o){for(let u=0;u<a.length;++u)if(!Ha(a[u],o))return!1;for(let u=0;u<a.length-1;++u)if(er(a[u],a[u+1],o))return!1;return!0}function Qc(a,o){for(let u=0;u<o.length;u++)if(Kn(a,o[u]))return!0;return!1}function pa(a,o,u){const f=[];for(let _=0;_<a.length;_++){const E=[];for(let S=0;S<a[_].length;S++){const M=Vs(a[_][S],u);ra(o,M),E.push(M)}f.push(E)}return f}function ns(a,o,u){const f=[];for(let _=0;_<a.length;_++){const E=pa(a[_],o,u);f.push(E)}return f}function Iu(a,o,u,f){if(a[0]<u[0]||a[0]>u[2]){const _=.5*f;let E=a[0]-u[0]>_?-f:u[0]-a[0]>_?f:0;0===E&&(E=a[0]-u[2]>_?-f:u[2]-a[0]>_?f:0),a[0]+=E}ra(o,a)}function Qh(a,o,u,f){const _=Math.pow(2,f.z)*Hl,E=[f.x*Hl,f.y*Hl],S=[];if(!a)return S;for(const M of a)for(const P of M){const R=[P.x+E[0],P.y+E[1]];Iu(R,o,u,_),S.push(R)}return S}function Eo(a,o,u,f){const _=Math.pow(2,f.z)*Hl,E=[f.x*Hl,f.y*Hl],S=[];if(!a)return S;for(const P of a){const R=[];for(const z of P){const U=[z.x+E[0],z.y+E[1]];ra(o,U),R.push(U)}S.push(R)}if(o[2]-o[0]<=_/2){(M=o)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const P of S)for(const R of P)Iu(R,o,u,_)}var M;return S}class Ch{constructor(o,u){this.type=Mr,this.geojson=o,this.geometries=u}static parse(o,u){if(2!==o.length)return u.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Os(o[1])){const f=o[1];if("FeatureCollection"===f.type)for(let _=0;_<f.features.length;++_){const E=f.features[_].geometry.type;if("Polygon"===E||"MultiPolygon"===E)return new Ch(f,f.features[_].geometry)}else if("Feature"===f.type){const _=f.geometry.type;if("Polygon"===_||"MultiPolygon"===_)return new Ch(f,f.geometry)}else if("Polygon"===f.type||"MultiPolygon"===f.type)return new Ch(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(u,f){const _=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],S=u.canonicalID();if(!S)return!1;if("Polygon"===f.type){const M=pa(f.coordinates,E,S),P=Qh(u.geometry(),_,E,S);if(!fl(_,E))return!1;for(const R of P)if(!Ha(R,M))return!1}if("MultiPolygon"===f.type){const M=ns(f.coordinates,E,S),P=Qh(u.geometry(),_,E,S);if(!fl(_,E))return!1;for(const R of P)if(!sc(R,M))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(u,f){const _=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],S=u.canonicalID();if(!S)return!1;if("Polygon"===f.type){const M=pa(f.coordinates,E,S),P=Eo(u.geometry(),_,E,S);if(!fl(_,E))return!1;for(const R of P)if(!Kn(R,M))return!1}if("MultiPolygon"===f.type){const M=ns(f.coordinates,E,S),P=Eo(u.geometry(),_,E,S);if(!fl(_,E))return!1;for(const R of P)if(!Qc(R,M))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var bi=Ch;function Il(a){if(a instanceof $l&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof bi)return!1;let o=!0;return a.eachChild(u=>{o&&!Il(u)&&(o=!1)}),o}function Ei(a){if(a instanceof $l&&"feature-state"===a.name)return!1;let o=!0;return a.eachChild(u=>{o&&!Ei(u)&&(o=!1)}),o}function ql(a,o){if(a instanceof $l&&o.indexOf(a.name)>=0)return!1;let u=!0;return a.eachChild(f=>{u&&!ql(f,o)&&(u=!1)}),u}class Xs{constructor(o,u){this.type=u.type,this.name=o,this.boundExpression=u}static parse(o,u){if(2!==o.length||"string"!=typeof o[1])return u.error("'var' expression requires exactly one string literal argument.");const f=o[1];return u.scope.has(f)?new Xs(f,u.scope.get(f)):u.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var _f=Xs;class ni{constructor(o,u=[],f,_=new Ld,E=[]){this.registry=o,this.path=u,this.key=u.map(S=>`[${S}]`).join(""),this.scope=_,this.errors=E,this.expectedType=f}parse(o,u,f,_,E={}){return u?this.concat(u,f,_)._parse(o,E):this._parse(o,E)}_parse(o,u){function f(_,E,S){return"assert"===S?new nl(E,[_]):"coerce"===S?new Uo(E,[_]):_}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=o[0];if("string"!=typeof _)return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const E=this.registry[_];if(E){let S=E.parse(o,this);if(!S)return null;if(this.expectedType){const M=this.expectedType,P=S.type;if("string"!==M.kind&&"number"!==M.kind&&"boolean"!==M.kind&&"object"!==M.kind&&"array"!==M.kind||"value"!==P.kind)if("color"!==M.kind&&"formatted"!==M.kind&&"resolvedImage"!==M.kind||"value"!==P.kind&&"string"!==P.kind){if(this.checkSubtype(M,P))return null}else S=f(S,M,u.typeAnnotation||"coerce");else S=f(S,M,u.typeAnnotation||"assert")}if(!(S instanceof Ws)&&"resolvedImage"!==S.type.kind&&yo(S)){const M=new Jh;try{S=new Ws(S.type,S.evaluate(M))}catch(P){return this.error(P.message),null}}return S}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,u,f){const _="number"==typeof o?this.path.concat(o):this.path,E=f?this.scope.concat(f):this.scope;return new ni(this.registry,_,u||null,E,this.errors)}error(o,...u){const f=`${this.key}${u.map(_=>`[${_}]`).join("")}`;this.errors.push(new uu(f,o))}checkSubtype(o,u){const f=$t(o,u);return f&&this.error(f),f}}var ac=ni;function yo(a){if(a instanceof _f)return yo(a.boundExpression);if(a instanceof $l&&"error"===a.name||a instanceof Ti||a instanceof bi)return!1;const o=a instanceof Uo||a instanceof nl;let u=!0;return a.eachChild(f=>{u=o?u&&yo(f):u&&f instanceof Ws}),!!u&&Il(a)&&ql(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Wl(a,o){const u=a.length-1;let f,_,E=0,S=u,M=0;for(;E<=S;)if(M=Math.floor((E+S)/2),f=a[M],_=a[M+1],f<=o){if(M===u||o<_)return M;E=M+1}else{if(!(f>o))throw new Zs("Input is not a number.");S=M-1}return 0}class ia{constructor(o,u,f){this.type=o,this.input=u,this.labels=[],this.outputs=[];for(const[_,E]of f)this.labels.push(_),this.outputs.push(E)}static parse(o,u){if(o.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");const f=u.parse(o[1],1,on);if(!f)return null;const _=[];let E=null;u.expectedType&&"value"!==u.expectedType.kind&&(E=u.expectedType);for(let S=1;S<o.length;S+=2){const M=1===S?-1/0:o[S],P=o[S+1],R=S,z=S+1;if("number"!=typeof M)return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(_.length&&_[_.length-1][0]>=M)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const U=u.parse(P,z,E);if(!U)return null;E=E||U.type,_.push([M,U])}return new ia(E,f,_)}evaluate(o){const u=this.labels,f=this.outputs;if(1===u.length)return f[0].evaluate(o);const _=this.input.evaluate(o);if(_<=u[0])return f[0].evaluate(o);const E=u.length;return _>=u[E-1]?f[E-1].evaluate(o):f[Wl(u,_)].evaluate(o)}eachChild(o){o(this.input);for(const u of this.outputs)o(u)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let u=0;u<this.labels.length;u++)u>0&&o.push(this.labels[u]),o.push(this.outputs[u].serialize());return o}}var rl=ia;function Ci(a,o,u){return a*(1-u)+o*u}var jn=Object.freeze({__proto__:null,array:function(a,o,u){return a.map((f,_)=>Ci(f,o[_],u))},color:function(a,o,u){return new zs(Ci(a.r,o.r,u),Ci(a.g,o.g,u),Ci(a.b,o.b,u),Ci(a.a,o.a,u))},number:Ci});const Uu=4/29,ga=6/29,Ys=3*ga*ga,ma=ga*ga*ga,og=Math.PI/180,ep=180/Math.PI;function _a(a){return a>ma?Math.pow(a,1/3):a/Ys+Uu}function Ra(a){return a>ga?a*a*a:Ys*(a-Uu)}function oa(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Wo(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function oi(a){const o=Wo(a.r),u=Wo(a.g),f=Wo(a.b),_=_a((.4124564*o+.3575761*u+.1804375*f)/.95047),E=_a((.2126729*o+.7151522*u+.072175*f)/1);return{l:116*E-16,a:500*(_-E),b:200*(E-_a((.0193339*o+.119192*u+.9503041*f)/1.08883)),alpha:a.a}}function pl(a){let o=(a.l+16)/116,u=isNaN(a.a)?o:o+a.a/500,f=isNaN(a.b)?o:o-a.b/200;return o=1*Ra(o),u=.95047*Ra(u),f=1.08883*Ra(f),new zs(oa(3.2404542*u-1.5371385*o-.4985314*f),oa(-.969266*u+1.8760108*o+.041556*f),oa(.0556434*u-.2040259*o+1.0572252*f),a.alpha)}function ju(a,o,u){const f=o-a;return a+u*(f>180||f<-180?f-360*Math.round(f/360):f)}const il={forward:oi,reverse:pl,interpolate:function(a,o,u){return{l:Ci(a.l,o.l,u),a:Ci(a.a,o.a,u),b:Ci(a.b,o.b,u),alpha:Ci(a.alpha,o.alpha,u)}}},rs={forward:function(a){const{l:o,a:u,b:f}=oi(a),_=Math.atan2(f,u)*ep;return{h:_<0?_+360:_,c:Math.sqrt(u*u+f*f),l:o,alpha:a.a}},reverse:function(a){const o=a.h*og,u=a.c;return pl({l:a.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:a.alpha})},interpolate:function(a,o,u){return{h:ju(a.h,o.h,u),c:Ci(a.c,o.c,u),l:Ci(a.l,o.l,u),alpha:Ci(a.alpha,o.alpha,u)}}};var hu=Object.freeze({__proto__:null,hcl:rs,lab:il});class du{constructor(o,u,f,_,E){this.type=o,this.operator=u,this.interpolation=f,this.input=_,this.labels=[],this.outputs=[];for(const[S,M]of E)this.labels.push(S),this.outputs.push(M)}static interpolationFactor(o,u,f,_){let E=0;if("exponential"===o.name)E=Ks(u,o.base,f,_);else if("linear"===o.name)E=Ks(u,1,f,_);else if("cubic-bezier"===o.name){const S=o.controlPoints;E=new he(S[0],S[1],S[2],S[3]).solve(Ks(u,1,f,_))}return E}static parse(o,u){let[f,_,E,...S]=o;if(!Array.isArray(_)||0===_.length)return u.error("Expected an interpolation type expression.",1);if("linear"===_[0])_={name:"linear"};else if("exponential"===_[0]){const R=_[1];if("number"!=typeof R)return u.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:R}}else{if("cubic-bezier"!==_[0])return u.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const R=_.slice(1);if(4!==R.length||R.some(z=>"number"!=typeof z||z<0||z>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:R}}}if(o.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(E=u.parse(E,2,on),!E)return null;const M=[];let P=null;"interpolate-hcl"===f||"interpolate-lab"===f?P=$a:u.expectedType&&"value"!==u.expectedType.kind&&(P=u.expectedType);for(let R=0;R<S.length;R+=2){const z=S[R],U=S[R+1],G=R+3,q=R+4;if("number"!=typeof z)return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(M.length&&M[M.length-1][0]>=z)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',G);const W=u.parse(U,q,P);if(!W)return null;P=P||W.type,M.push([z,W])}return"number"===P.kind||"color"===P.kind||"array"===P.kind&&"number"===P.itemType.kind&&"number"==typeof P.N?new du(P,f,_,E,M):u.error(`Type ${Io(P)} is not interpolatable.`)}evaluate(o){const u=this.labels,f=this.outputs;if(1===u.length)return f[0].evaluate(o);const _=this.input.evaluate(o);if(_<=u[0])return f[0].evaluate(o);const E=u.length;if(_>=u[E-1])return f[E-1].evaluate(o);const S=Wl(u,_),M=du.interpolationFactor(this.interpolation,_,u[S],u[S+1]),P=f[S].evaluate(o),R=f[S+1].evaluate(o);return"interpolate"===this.operator?jn[this.type.kind.toLowerCase()](P,R,M):"interpolate-hcl"===this.operator?rs.reverse(rs.interpolate(rs.forward(P),rs.forward(R),M)):il.reverse(il.interpolate(il.forward(P),il.forward(R),M))}eachChild(o){o(this.input);for(const u of this.outputs)o(u)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const u=[this.operator,o,this.input.serialize()];for(let f=0;f<this.labels.length;f++)u.push(this.labels[f],this.outputs[f].serialize());return u}}function Ks(a,o,u,f){const _=f-u,E=a-u;return 0===_?0:1===o?E/_:(Math.pow(o,E)-1)/(Math.pow(o,_)-1)}var ya=du;class qa{constructor(o,u){this.type=o,this.args=u}static parse(o,u){if(o.length<2)return u.error("Expectected at least one argument.");let f=null;const _=u.expectedType;_&&"value"!==_.kind&&(f=_);const E=[];for(const M of o.slice(1)){const P=u.parse(M,1+E.length,f,void 0,{typeAnnotation:"omit"});if(!P)return null;f=f||P.type,E.push(P)}const S=_&&E.some(M=>$t(_,M.type));return new qa(S?ei:f,E)}evaluate(o){let u,f=null,_=0;for(const E of this.args){if(_++,f=E.evaluate(o),f&&f instanceof Sr&&!f.available&&(u||(u=f),f=null,_===this.args.length))return u;if(null!==f)break}return f}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(u=>{o.push(u.serialize())}),o}}var ed=qa;class Js{constructor(o,u){this.type=u.type,this.bindings=[].concat(o),this.result=u}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const u of this.bindings)o(u[1]);o(this.result)}static parse(o,u){if(o.length<4)return u.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const f=[];for(let E=1;E<o.length-1;E+=2){const S=o[E];if("string"!=typeof S)return u.error(`Expected string, but found ${typeof S} instead.`,E);if(/[^a-zA-Z0-9_]/.test(S))return u.error("Variable names must contain only alphanumeric characters or '_'.",E);const M=u.parse(o[E+1],E+1);if(!M)return null;f.push([S,M])}const _=u.parse(o[o.length-1],o.length-1,u.expectedType,f);return _?new Js(f,_):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[u,f]of this.bindings)o.push(u,f.serialize());return o.push(this.result.serialize()),o}}var eh=Js;class Ic{constructor(o,u,f){this.type=o,this.index=u,this.input=f}static parse(o,u){if(3!==o.length)return u.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,on),_=u.parse(o[2],2,xi(u.expectedType||ei));return f&&_?new Ic(_.type.itemType,f,_):null}evaluate(o){const u=this.index.evaluate(o),f=this.input.evaluate(o);if(u<0)throw new Zs(`Array index out of bounds: ${u} < 0.`);if(u>=f.length)throw new Zs(`Array index out of bounds: ${u} > ${f.length-1}.`);if(u!==Math.floor(u))throw new Zs(`Array index must be an integer, but found ${u} instead.`);return f[u]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var th=Ic;class Fd{constructor(o,u){this.type=Mr,this.needle=o,this.haystack=u}static parse(o,u){if(3!==o.length)return u.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,ei),_=u.parse(o[2],2,ei);return f&&_?Rr(f.type,[Mr,Rn,on,ws,ei])?new Fd(f,_):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Io(f.type)} instead`):null}evaluate(o){const u=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(null==f)return!1;if(!Pa(u,["boolean","string","number","null"]))throw new Zs(`Expected first argument to be of type boolean, string, number or null, but found ${Io(Es(u))} instead.`);if(!Pa(f,["string","array"]))throw new Zs(`Expected second argument to be of type array or string, but found ${Io(Es(f))} instead.`);return f.indexOf(u)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Sh=Fd;class Mu{constructor(o,u,f){this.type=on,this.needle=o,this.haystack=u,this.fromIndex=f}static parse(o,u){if(o.length<=2||o.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,ei),_=u.parse(o[2],2,ei);if(!f||!_)return null;if(!Rr(f.type,[Mr,Rn,on,ws,ei]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${Io(f.type)} instead`);if(4===o.length){const E=u.parse(o[3],3,on);return E?new Mu(f,_,E):null}return new Mu(f,_)}evaluate(o){const u=this.needle.evaluate(o),f=this.haystack.evaluate(o);if(!Pa(u,["boolean","string","number","null"]))throw new Zs(`Expected first argument to be of type boolean, string, number or null, but found ${Io(Es(u))} instead.`);if(!Pa(f,["string","array"]))throw new Zs(`Expected second argument to be of type array or string, but found ${Io(Es(f))} instead.`);if(this.fromIndex){const _=this.fromIndex.evaluate(o);return f.indexOf(u,_)}return f.indexOf(u)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var fu=Mu;class vo{constructor(o,u,f,_,E,S){this.inputType=o,this.type=u,this.input=f,this.cases=_,this.outputs=E,this.otherwise=S}static parse(o,u){if(o.length<5)return u.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return u.error("Expected an even number of arguments.");let f,_;u.expectedType&&"value"!==u.expectedType.kind&&(_=u.expectedType);const E={},S=[];for(let R=2;R<o.length-1;R+=2){let z=o[R];const U=o[R+1];Array.isArray(z)||(z=[z]);const G=u.concat(R);if(0===z.length)return G.error("Expected at least one branch label.");for(const W of z){if("number"!=typeof W&&"string"!=typeof W)return G.error("Branch labels must be numbers or strings.");if("number"==typeof W&&Math.abs(W)>Number.MAX_SAFE_INTEGER)return G.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof W&&Math.floor(W)!==W)return G.error("Numeric branch labels must be integer values.");if(f){if(G.checkSubtype(f,Es(W)))return null}else f=Es(W);if(void 0!==E[String(W)])return G.error("Branch labels must be unique.");E[String(W)]=S.length}const q=u.parse(U,R,_);if(!q)return null;_=_||q.type,S.push(q)}const M=u.parse(o[1],1,ei);if(!M)return null;const P=u.parse(o[o.length-1],o.length-1,_);return P?"value"!==M.type.kind&&u.concat(1).checkSubtype(f,M.type)?null:new vo(f,_,M,E,S,P):null}evaluate(o){const u=this.input.evaluate(o);return(Es(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],u=Object.keys(this.cases).sort(),f=[],_={};for(const S of u){const M=_[this.cases[S]];void 0===M?(_[this.cases[S]]=f.length,f.push([this.cases[S],[S]])):f[M][1].push(S)}const E=S=>"number"===this.inputType.kind?Number(S):S;for(const[S,M]of f)o.push(1===M.length?E(M[0]):M.map(E)),o.push(this.outputs[S].serialize());return o.push(this.otherwise.serialize()),o}}var Dh=vo;class Qs{constructor(o,u,f){this.type=o,this.branches=u,this.otherwise=f}static parse(o,u){if(o.length<4)return u.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return u.error("Expected an odd number of arguments.");let f;u.expectedType&&"value"!==u.expectedType.kind&&(f=u.expectedType);const _=[];for(let S=1;S<o.length-1;S+=2){const M=u.parse(o[S],S,Mr);if(!M)return null;const P=u.parse(o[S+1],S+1,f);if(!P)return null;_.push([M,P]),f=f||P.type}const E=u.parse(o[o.length-1],o.length-1,f);return E?new Qs(f,_,E):null}evaluate(o){for(const[u,f]of this.branches)if(u.evaluate(o))return f.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[u,f]of this.branches)o(u),o(f);o(this.otherwise)}outputDefined(){return this.branches.every(([o,u])=>u.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(u=>{o.push(u.serialize())}),o}}var pu=Qs;class gu{constructor(o,u,f,_){this.type=o,this.input=u,this.beginIndex=f,this.endIndex=_}static parse(o,u){if(o.length<=2||o.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const f=u.parse(o[1],1,ei),_=u.parse(o[2],2,on);if(!f||!_)return null;if(!Rr(f.type,[xi(ei),Rn,ei]))return u.error(`Expected first argument to be of type array or string, but found ${Io(f.type)} instead`);if(4===o.length){const E=u.parse(o[3],3,on);return E?new gu(f.type,f,_,E):null}return new gu(f.type,f,_)}evaluate(o){const u=this.input.evaluate(o),f=this.beginIndex.evaluate(o);if(!Pa(u,["string","array"]))throw new Zs(`Expected first argument to be of type array or string, but found ${Io(Es(u))} instead.`);if(this.endIndex){const _=this.endIndex.evaluate(o);return u.slice(f,_)}return u.slice(f)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Bd=gu;function Gu(a,o){return"=="===a||"!="===a?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function Au(a,o,u,f){return 0===f.compare(o,u)}function gl(a,o,u){const f="=="!==a&&"!="!==a;return class ZB{constructor(E,S,M){this.type=Mr,this.lhs=E,this.rhs=S,this.collator=M,this.hasUntypedArgument="value"===E.type.kind||"value"===S.type.kind}static parse(E,S){if(3!==E.length&&4!==E.length)return S.error("Expected two or three arguments.");const M=E[0];let P=S.parse(E[1],1,ei);if(!P)return null;if(!Gu(M,P.type))return S.concat(1).error(`"${M}" comparisons are not supported for type '${Io(P.type)}'.`);let R=S.parse(E[2],2,ei);if(!R)return null;if(!Gu(M,R.type))return S.concat(2).error(`"${M}" comparisons are not supported for type '${Io(R.type)}'.`);if(P.type.kind!==R.type.kind&&"value"!==P.type.kind&&"value"!==R.type.kind)return S.error(`Cannot compare types '${Io(P.type)}' and '${Io(R.type)}'.`);f&&("value"===P.type.kind&&"value"!==R.type.kind?P=new nl(R.type,[P]):"value"!==P.type.kind&&"value"===R.type.kind&&(R=new nl(P.type,[R])));let z=null;if(4===E.length){if("string"!==P.type.kind&&"string"!==R.type.kind&&"value"!==P.type.kind&&"value"!==R.type.kind)return S.error("Cannot use collator to compare non-string types.");if(z=S.parse(E[3],3,jl),!z)return null}return new ZB(P,R,z)}evaluate(E){const S=this.lhs.evaluate(E),M=this.rhs.evaluate(E);if(f&&this.hasUntypedArgument){const P=Es(S),R=Es(M);if(P.kind!==R.kind||"string"!==P.kind&&"number"!==P.kind)throw new Zs(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${P.kind}, ${R.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const P=Es(S),R=Es(M);if("string"!==P.kind||"string"!==R.kind)return o(E,S,M)}return this.collator?u(E,S,M,this.collator.evaluate(E)):o(E,S,M)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}serialize(){const E=[a];return this.eachChild(S=>{E.push(S.serialize())}),E}}}const sa=gl("==",function(a,o,u){return o===u},Au),Zl=gl("!=",function(a,o,u){return o!==u},function(a,o,u,f){return!Au(0,o,u,f)}),Bi=gl("<",function(a,o,u){return o<u},function(a,o,u,f){return f.compare(o,u)<0}),tp=gl(">",function(a,o,u){return o>u},function(a,o,u,f){return f.compare(o,u)>0}),lc=gl("<=",function(a,o,u){return o<=u},function(a,o,u,f){return f.compare(o,u)<=0}),Mc=gl(">=",function(a,o,u){return o>=u},function(a,o,u,f){return f.compare(o,u)>=0});class Or{constructor(o,u,f,_,E,S){this.type=Rn,this.number=o,this.locale=u,this.currency=f,this.unit=_,this.minFractionDigits=E,this.maxFractionDigits=S}static parse(o,u){if(3!==o.length)return u.error("Expected two arguments.");const f=u.parse(o[1],1,on);if(!f)return null;const _=o[2];if("object"!=typeof _||Array.isArray(_))return u.error("NumberFormat options argument must be an object.");let E=null;if(_.locale&&(E=u.parse(_.locale,1,Rn),!E))return null;let S=null;if(_.currency&&(S=u.parse(_.currency,1,Rn),!S))return null;let M=null;if(_.unit&&(M=u.parse(_.unit,1,Rn),!M))return null;let P=null;if(_["min-fraction-digits"]&&(P=u.parse(_["min-fraction-digits"],1,on),!P))return null;let R=null;return _["max-fraction-digits"]&&(R=u.parse(_["max-fraction-digits"],1,on),!R)?null:new Or(f,E,S,M,P,R)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class Cs{constructor(o){this.type=on,this.input=o}static parse(o,u){if(2!==o.length)return u.error(`Expected 1 argument, but found ${o.length-1} instead.`);const f=u.parse(o[1],1);return f?"array"!==f.type.kind&&"string"!==f.type.kind&&"value"!==f.type.kind?u.error(`Expected argument of type string or array, but found ${Io(f.type)} instead.`):new Cs(f):null}evaluate(o){const u=this.input.evaluate(o);if("string"==typeof u||Array.isArray(u))return u.length;throw new Zs(`Expected value to be of type string or array, but found ${Io(Es(u))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(u=>{o.push(u.serialize())}),o}}const Ml={"==":sa,"!=":Zl,">":tp,"<":Bi,">=":Mc,"<=":lc,array:nl,at:th,boolean:nl,case:pu,coalesce:ed,collator:Ti,format:Tl,image:ms,in:Sh,"index-of":fu,interpolate:ya,"interpolate-hcl":ya,"interpolate-lab":ya,length:Cs,let:eh,literal:Ws,match:Dh,number:nl,"number-format":Or,object:nl,slice:Bd,step:rl,string:nl,"to-boolean":Uo,"to-color":Uo,"to-number":Uo,"to-string":Uo,var:_f,within:bi};function Mn(a,[o,u,f,_]){o=o.evaluate(a),u=u.evaluate(a),f=f.evaluate(a);const E=_?_.evaluate(a):1,S=Kh(o,u,f,E);if(S)throw new Zs(S);return new zs(o/255*E,u/255*E,f/255*E,E)}function Ss(a,o){return a in o}function gi(a,o){const u=o[a];return void 0===u?null:u}function Oi(a){return{type:a}}$l.register(Ml,{error:[{kind:"error"},[Rn],(a,[o])=>{throw new Zs(o.evaluate(a))}],typeof:[Rn,[ei],(a,[o])=>Io(Es(o.evaluate(a)))],"to-rgba":[xi(on,4),[$a],(a,[o])=>o.evaluate(a).toArray()],rgb:[$a,[on,on,on],Mn],rgba:[$a,[on,on,on,on],Mn],has:{type:Mr,overloads:[[[Rn],(a,[o])=>Ss(o.evaluate(a),a.properties())],[[Rn,ur],(a,[o,u])=>Ss(o.evaluate(a),u.evaluate(a))]]},get:{type:ei,overloads:[[[Rn],(a,[o])=>gi(o.evaluate(a),a.properties())],[[Rn,ur],(a,[o,u])=>gi(o.evaluate(a),u.evaluate(a))]]},"feature-state":[ei,[Rn],(a,[o])=>gi(o.evaluate(a),a.featureState||{})],properties:[ur,[],a=>a.properties()],"geometry-type":[Rn,[],a=>a.geometryType()],id:[ei,[],a=>a.id()],zoom:[on,[],a=>a.globals.zoom],pitch:[on,[],a=>a.globals.pitch||0],"distance-from-center":[on,[],a=>a.distanceFromCenter()],"heatmap-density":[on,[],a=>a.globals.heatmapDensity||0],"line-progress":[on,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[on,[],a=>a.globals.skyRadialProgress||0],accumulated:[ei,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[on,Oi(on),(a,o)=>{let u=0;for(const f of o)u+=f.evaluate(a);return u}],"*":[on,Oi(on),(a,o)=>{let u=1;for(const f of o)u*=f.evaluate(a);return u}],"-":{type:on,overloads:[[[on,on],(a,[o,u])=>o.evaluate(a)-u.evaluate(a)],[[on],(a,[o])=>-o.evaluate(a)]]},"/":[on,[on,on],(a,[o,u])=>o.evaluate(a)/u.evaluate(a)],"%":[on,[on,on],(a,[o,u])=>o.evaluate(a)%u.evaluate(a)],ln2:[on,[],()=>Math.LN2],pi:[on,[],()=>Math.PI],e:[on,[],()=>Math.E],"^":[on,[on,on],(a,[o,u])=>Math.pow(o.evaluate(a),u.evaluate(a))],sqrt:[on,[on],(a,[o])=>Math.sqrt(o.evaluate(a))],log10:[on,[on],(a,[o])=>Math.log(o.evaluate(a))/Math.LN10],ln:[on,[on],(a,[o])=>Math.log(o.evaluate(a))],log2:[on,[on],(a,[o])=>Math.log(o.evaluate(a))/Math.LN2],sin:[on,[on],(a,[o])=>Math.sin(o.evaluate(a))],cos:[on,[on],(a,[o])=>Math.cos(o.evaluate(a))],tan:[on,[on],(a,[o])=>Math.tan(o.evaluate(a))],asin:[on,[on],(a,[o])=>Math.asin(o.evaluate(a))],acos:[on,[on],(a,[o])=>Math.acos(o.evaluate(a))],atan:[on,[on],(a,[o])=>Math.atan(o.evaluate(a))],min:[on,Oi(on),(a,o)=>Math.min(...o.map(u=>u.evaluate(a)))],max:[on,Oi(on),(a,o)=>Math.max(...o.map(u=>u.evaluate(a)))],abs:[on,[on],(a,[o])=>Math.abs(o.evaluate(a))],round:[on,[on],(a,[o])=>{const u=o.evaluate(a);return u<0?-Math.round(-u):Math.round(u)}],floor:[on,[on],(a,[o])=>Math.floor(o.evaluate(a))],ceil:[on,[on],(a,[o])=>Math.ceil(o.evaluate(a))],"filter-==":[Mr,[Rn,ei],(a,[o,u])=>a.properties()[o.value]===u.value],"filter-id-==":[Mr,[ei],(a,[o])=>a.id()===o.value],"filter-type-==":[Mr,[Rn],(a,[o])=>a.geometryType()===o.value],"filter-<":[Mr,[Rn,ei],(a,[o,u])=>{const f=a.properties()[o.value],_=u.value;return typeof f==typeof _&&f<_}],"filter-id-<":[Mr,[ei],(a,[o])=>{const u=a.id(),f=o.value;return typeof u==typeof f&&u<f}],"filter->":[Mr,[Rn,ei],(a,[o,u])=>{const f=a.properties()[o.value],_=u.value;return typeof f==typeof _&&f>_}],"filter-id->":[Mr,[ei],(a,[o])=>{const u=a.id(),f=o.value;return typeof u==typeof f&&u>f}],"filter-<=":[Mr,[Rn,ei],(a,[o,u])=>{const f=a.properties()[o.value],_=u.value;return typeof f==typeof _&&f<=_}],"filter-id-<=":[Mr,[ei],(a,[o])=>{const u=a.id(),f=o.value;return typeof u==typeof f&&u<=f}],"filter->=":[Mr,[Rn,ei],(a,[o,u])=>{const f=a.properties()[o.value],_=u.value;return typeof f==typeof _&&f>=_}],"filter-id->=":[Mr,[ei],(a,[o])=>{const u=a.id(),f=o.value;return typeof u==typeof f&&u>=f}],"filter-has":[Mr,[ei],(a,[o])=>o.value in a.properties()],"filter-has-id":[Mr,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[Mr,[xi(Rn)],(a,[o])=>o.value.indexOf(a.geometryType())>=0],"filter-id-in":[Mr,[xi(ei)],(a,[o])=>o.value.indexOf(a.id())>=0],"filter-in-small":[Mr,[Rn,xi(ei)],(a,[o,u])=>u.value.indexOf(a.properties()[o.value])>=0],"filter-in-large":[Mr,[Rn,xi(ei)],(a,[o,u])=>function(f,_,E,S){for(;E<=S;){const M=E+S>>1;if(_[M]===f)return!0;_[M]>f?S=M-1:E=M+1}return!1}(a.properties()[o.value],u.value,0,u.value.length-1)],all:{type:Mr,overloads:[[[Mr,Mr],(a,[o,u])=>o.evaluate(a)&&u.evaluate(a)],[Oi(Mr),(a,o)=>{for(const u of o)if(!u.evaluate(a))return!1;return!0}]]},any:{type:Mr,overloads:[[[Mr,Mr],(a,[o,u])=>o.evaluate(a)||u.evaluate(a)],[Oi(Mr),(a,o)=>{for(const u of o)if(u.evaluate(a))return!0;return!1}]]},"!":[Mr,[Mr],(a,[o])=>!o.evaluate(a)],"is-supported-script":[Mr,[Rn],(a,[o])=>{const u=a.globals&&a.globals.isSupportedScript;return!u||u(o.evaluate(a))}],upcase:[Rn,[Rn],(a,[o])=>o.evaluate(a).toUpperCase()],downcase:[Rn,[Rn],(a,[o])=>o.evaluate(a).toLowerCase()],concat:[Rn,Oi(ei),(a,o)=>o.map(u=>tl(u.evaluate(a))).join("")],"resolved-locale":[Rn,[jl],(a,[o])=>o.evaluate(a).resolvedLocale()]});var Ui=Ml;function uc(a){return{result:"success",value:a}}function Si(a){return{result:"error",value:a}}function cc(a){return"data-driven"===a["property-type"]}function ol(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Zo(a){return!!a.expression&&a.expression.interpolated}function Gr(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function mu(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function is(a){return a}function Bn(a,o){const u="color"===o.type,f=a.stops&&"object"==typeof a.stops[0][0],_=f||!(f||void 0!==a.property),E=a.type||(Zo(o)?"exponential":"interval");if(u&&((a=Vl({},a)).stops&&(a.stops=a.stops.map(R=>[R[0],zs.parse(R[1])])),a.default=zs.parse(a.default?a.default:o.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!hu[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let S,M,P;if("exponential"===E)S=Ii;else if("interval"===E)S=Ds;else if("categorical"===E){S=mi,M=Object.create(null);for(const R of a.stops)M[R[0]]=R[1];P=typeof a.stops[0][0]}else{if("identity"!==E)throw new Error(`Unknown function type "${E}"`);S=Oa}if(f){const R={},z=[];for(let q=0;q<a.stops.length;q++){const W=a.stops[q],re=W[0].zoom;void 0===R[re]&&(R[re]={zoom:re,type:a.type,property:a.property,default:a.default,stops:[]},z.push(re)),R[re].stops.push([W[0].value,W[1]])}const U=[];for(const q of z)U.push([R[q].zoom,Bn(R[q],o)]);const G={name:"linear"};return{kind:"composite",interpolationType:G,interpolationFactor:ya.interpolationFactor.bind(void 0,G),zoomStops:U.map(q=>q[0]),evaluate:({zoom:q},W)=>Ii({stops:U,base:a.base},o,q).evaluate(q,W)}}if(_){const R="exponential"===E?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:ya.interpolationFactor.bind(void 0,R),zoomStops:a.stops.map(z=>z[0]),evaluate:({zoom:z})=>S(a,o,z,M,P)}}return{kind:"source",evaluate(R,z){const U=z&&z.properties?z.properties[a.property]:void 0;return void 0===U?Ar(a.default,o.default):S(a,o,U,M,P)}}}function Ar(a,o,u){return void 0!==a?a:void 0!==o?o:void 0!==u?u:void 0}function mi(a,o,u,f,_){return Ar(typeof u===_?f[u]:void 0,a.default,o.default)}function Ds(a,o,u){if("number"!==Gr(u))return Ar(a.default,o.default);const f=a.stops.length;if(1===f||u<=a.stops[0][0])return a.stops[0][1];if(u>=a.stops[f-1][0])return a.stops[f-1][1];const _=Wl(a.stops.map(E=>E[0]),u);return a.stops[_][1]}function Ii(a,o,u){const f=void 0!==a.base?a.base:1;if("number"!==Gr(u))return Ar(a.default,o.default);const _=a.stops.length;if(1===_||u<=a.stops[0][0])return a.stops[0][1];if(u>=a.stops[_-1][0])return a.stops[_-1][1];const E=Wl(a.stops.map(z=>z[0]),u),S=function(z,U,G,q){const W=q-G,re=z-G;return 0===W?0:1===U?re/W:(Math.pow(U,re)-1)/(Math.pow(U,W)-1)}(u,f,a.stops[E][0],a.stops[E+1][0]),M=a.stops[E][1],P=a.stops[E+1][1];let R=jn[o.type]||is;if(a.colorSpace&&"rgb"!==a.colorSpace){const z=hu[a.colorSpace];R=(U,G)=>z.reverse(z.interpolate(z.forward(U),z.forward(G),S))}return"function"==typeof M.evaluate?{evaluate(...z){const U=M.evaluate.apply(void 0,z),G=P.evaluate.apply(void 0,z);if(void 0!==U&&void 0!==G)return R(U,G,S)}}:R(M,P,S)}function Oa(a,o,u){return"color"===o.type?u=zs.parse(u):"formatted"===o.type?u=zo.fromString(u.toString()):"resolvedImage"===o.type?u=Sr.fromString(u.toString()):Gr(u)===o.type||"enum"===o.type&&o.values[u]||(u=void 0),Ar(u,a.default,o.default)}class $u{constructor(o,u){var f;this.expression=o,this._warningHistory={},this._evaluator=new Jh,this._defaultValue=u?"color"===(f=u).type&&(mu(f.default)||Array.isArray(f.default))?new zs(0,0,0,0):"color"===f.type?zs.parse(f.default)||null:void 0===f.default?null:f.default:null,this._enumValues=u&&"enum"===u.type?u.values:null}evaluateWithoutErrorHandling(o,u,f,_,E,S,M,P){return this._evaluator.globals=o,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=_||null,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=S,this._evaluator.featureTileCoord=M||null,this._evaluator.featureDistanceData=P||null,this.expression.evaluate(this._evaluator)}evaluate(o,u,f,_,E,S,M,P){this._evaluator.globals=o,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=_||null,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=S||null,this._evaluator.featureTileCoord=M||null,this._evaluator.featureDistanceData=P||null;try{const R=this.expression.evaluate(this._evaluator);if(null==R||"number"==typeof R&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new Zs(`Expected value to be one of ${Object.keys(this._enumValues).map(z=>JSON.stringify(z)).join(", ")}, but found ${JSON.stringify(R)} instead.`);return R}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console<"u"&&console.warn(R.message)),this._defaultValue}}}function ai(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in Ui}function va(a,o){const u=new ac(Ui,[],o?function(_){const E={color:$a,string:Rn,number:on,enum:Rn,boolean:Mr,formatted:Ni,resolvedImage:qs};return"array"===_.type?xi(E[_.value]||ei,_.length):E[_.type]}(o):void 0),f=u.parse(a,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return f?uc(new $u(f,o)):Si(u.errors)}class Nu{constructor(o,u){this.kind=o,this._styleExpression=u,this.isStateDependent="constant"!==o&&!Ei(u.expression)}evaluateWithoutErrorHandling(o,u,f,_,E,S){return this._styleExpression.evaluateWithoutErrorHandling(o,u,f,_,E,S)}evaluate(o,u,f,_,E,S){return this._styleExpression.evaluate(o,u,f,_,E,S)}}class Pr{constructor(o,u,f,_){this.kind=o,this.zoomStops=f,this._styleExpression=u,this.isStateDependent="camera"!==o&&!Ei(u.expression),this.interpolationType=_}evaluateWithoutErrorHandling(o,u,f,_,E,S){return this._styleExpression.evaluateWithoutErrorHandling(o,u,f,_,E,S)}evaluate(o,u,f,_,E,S){return this._styleExpression.evaluate(o,u,f,_,E,S)}interpolationFactor(o,u,f){return this.interpolationType?ya.interpolationFactor(this.interpolationType,o,u,f):0}}function Wa(a,o){if("error"===(a=va(a,o)).result)return a;const u=a.value.expression,f=Il(u);if(!f&&!cc(o))return Si([new uu("","data expressions not supported")]);const _=ql(u,["zoom","pitch","distance-from-center"]);if(!_&&!ol(o))return Si([new uu("","zoom expressions not supported")]);const E=os(u);return E||_?E instanceof uu?Si([E]):E instanceof ya&&!Zo(o)?Si([new uu("",'"interpolate" expressions cannot be used with this property')]):uc(E?new Pr(f?"camera":"composite",a.value,E.labels,E instanceof ya?E.interpolation:void 0):new Nu(f?"constant":"source",a.value)):Si([new uu("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class _s{constructor(o,u){this._parameters=o,this._specification=u,Vl(this,Bn(this._parameters,this._specification))}static deserialize(o){return new _s(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function os(a){let o=null;if(a instanceof eh)o=os(a.result);else if(a instanceof ed){for(const u of a.args)if(o=os(u),o)break}else(a instanceof rl||a instanceof ya)&&a.input instanceof $l&&"zoom"===a.input.name&&(o=a);return o instanceof uu||a.eachChild(u=>{const f=os(u);f instanceof uu?o=f:!o&&f?o=new uu("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&f&&o!==f&&(o=new uu("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}class vn{constructor(o,u,f,_){this.message=(o?`${o}: `:"")+f,_&&(this.identifier=_),null!=u&&u.__line__&&(this.line=u.__line__)}}function Mo(a){const o=a.key,u=a.value,f=a.valueSpec||{},_=a.objectElementValidators||{},E=a.style,S=a.styleSpec;let M=[];const P=Gr(u);if("object"!==P)return[new vn(o,u,`object expected, ${P} found`)];for(const R in u){const z=R.split(".")[0];let U;_[z]?U=_[z]:f[z]?U=B:_["*"]?U=_["*"]:f["*"]&&(U=B),U?M=M.concat(U({key:(o&&`${o}.`)+R,value:u[R],valueSpec:f[z]||f["*"],style:E,styleSpec:S,object:u,objectKey:R},u)):M.push(new vn(o,u[R],`unknown property "${R}"`))}for(const R in f)_[R]||f[R].required&&void 0===f[R].default&&void 0===u[R]&&M.push(new vn(o,u,`missing required property "${R}"`));return M}function hc(a){const o=a.value,u=a.valueSpec,f=a.style,_=a.styleSpec,E=a.key,S=a.arrayElementValidator||B;if("array"!==Gr(o))return[new vn(E,o,`array expected, ${Gr(o)} found`)];if(u.length&&o.length!==u.length)return[new vn(E,o,`array length ${u.length} expected, length ${o.length} found`)];if(u["min-length"]&&o.length<u["min-length"])return[new vn(E,o,`array length at least ${u["min-length"]} expected, length ${o.length} found`)];let M={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};_.$version<7&&(M.function=u.function),"object"===Gr(u.value)&&(M=u.value);let P=[];for(let R=0;R<o.length;R++)P=P.concat(S({array:o,arrayIndex:R,value:o[R],valueSpec:M,style:f,styleSpec:_,key:`${E}[${R}]`}));return P}function Za(a){const o=a.key,u=a.value,f=a.valueSpec;let _=Gr(u);if("number"===_&&u!=u&&(_="NaN"),"number"!==_)return[new vn(o,u,`number expected, ${_} found`)];if("minimum"in f){let E=f.minimum;if("array"===Gr(f.minimum)&&(E=f.minimum[a.arrayIndex]),u<E)return[new vn(o,u,`${u} is less than the minimum value ${E}`)]}if("maximum"in f){let E=f.maximum;if("array"===Gr(f.maximum)&&(E=f.maximum[a.arrayIndex]),u>E)return[new vn(o,u,`${u} is greater than the maximum value ${E}`)]}return[]}function Go(a){const o=a.valueSpec,u=gs(a.value.type);let f,_,E,S={};const M="categorical"!==u&&void 0===a.value.property,P=!M,R="array"===Gr(a.value.stops)&&"array"===Gr(a.value.stops[0])&&"object"===Gr(a.value.stops[0][0]),z=Mo({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(q){if("identity"===u)return[new vn(q.key,q.value,'identity function may not have a "stops" property')];let W=[];const re=q.value;return W=W.concat(hc({key:q.key,value:re,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:U})),"array"===Gr(re)&&0===re.length&&W.push(new vn(q.key,re,"array must have at least one stop")),W},default:function(q){return B({key:q.key,value:q.value,valueSpec:o,style:q.style,styleSpec:q.styleSpec})}}});return"identity"===u&&M&&z.push(new vn(a.key,a.value,'missing required property "property"')),"identity"===u||a.value.stops||z.push(new vn(a.key,a.value,'missing required property "stops"')),"exponential"===u&&a.valueSpec.expression&&!Zo(a.valueSpec)&&z.push(new vn(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(P&&!cc(a.valueSpec)?z.push(new vn(a.key,a.value,"property functions not supported")):M&&!ol(a.valueSpec)&&z.push(new vn(a.key,a.value,"zoom functions not supported"))),"categorical"!==u&&!R||void 0!==a.value.property||z.push(new vn(a.key,a.value,'"property" property is required')),z;function U(q){let W=[];const re=q.value,ve=q.key;if("array"!==Gr(re))return[new vn(ve,re,`array expected, ${Gr(re)} found`)];if(2!==re.length)return[new vn(ve,re,`array length 2 expected, length ${re.length} found`)];if(R){if("object"!==Gr(re[0]))return[new vn(ve,re,`object expected, ${Gr(re[0])} found`)];if(void 0===re[0].zoom)return[new vn(ve,re,"object stop key must have zoom")];if(void 0===re[0].value)return[new vn(ve,re,"object stop key must have value")];const ke=gs(re[0].zoom);if("number"!=typeof ke)return[new vn(ve,re[0].zoom,"stop zoom values must be numbers")];if(E&&E>ke)return[new vn(ve,re[0].zoom,"stop zoom values must appear in ascending order")];ke!==E&&(E=ke,_=void 0,S={}),W=W.concat(Mo({key:`${ve}[0]`,value:re[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:Za,value:G}}))}else W=W.concat(G({key:`${ve}[0]`,value:re[0],valueSpec:{},style:q.style,styleSpec:q.styleSpec},re));return ai(Bs(re[1]))?W.concat([new vn(`${ve}[1]`,re[1],"expressions are not allowed in function stops.")]):W.concat(B({key:`${ve}[1]`,value:re[1],valueSpec:o,style:q.style,styleSpec:q.styleSpec}))}function G(q,W){const re=Gr(q.value),ve=gs(q.value),ke=null!==q.value?q.value:W;if(f){if(re!==f)return[new vn(q.key,ke,`${re} stop domain type must match previous stop domain type ${f}`)]}else f=re;if("number"!==re&&"string"!==re&&"boolean"!==re&&"number"!=typeof ve&&"string"!=typeof ve&&"boolean"!=typeof ve)return[new vn(q.key,ke,"stop domain value must be a number, string, or boolean")];if("number"!==re&&"categorical"!==u){let et=`number expected, ${re} found`;return cc(o)&&void 0===u&&(et+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new vn(q.key,ke,et)]}return"categorical"!==u||"number"!==re||"number"==typeof ve&&isFinite(ve)&&Math.floor(ve)===ve?"categorical"!==u&&"number"===re&&"number"==typeof ve&&"number"==typeof _&&void 0!==_&&ve<_?[new vn(q.key,ke,"stop domain values must appear in ascending order")]:(_=ve,"categorical"===u&&ve in S?[new vn(q.key,ke,"stop domain values must be unique")]:(S[ve]=!0,[])):[new vn(q.key,ke,`integer expected, found ${String(ve)}`)]}}function xa(a){const o=("property"===a.expressionContext?Wa:va)(Bs(a.value),a.valueSpec);if("error"===o.result)return o.value.map(f=>new vn(`${a.key}${f.key}`,a.value,f.message));const u=o.value.expression||o.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!u.outputDefined())return[new vn(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!Ei(u))return[new vn(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext)return Us(u,a);if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!ql(u,["zoom","feature-state"]))return[new vn(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!Il(u))return[new vn(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Us(a,o){const u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const _ of o.valueSpec.expression.parameters)u.delete(_);if(0===u.size)return[];const f=[];return a instanceof $l&&u.has(a.name)?[new vn(o.key,o.value,`["${a.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(a.eachChild(_=>{f.push(...Us(_,o))}),f)}function Xl(a){const o=a.key,u=a.value,f=a.valueSpec,_=[];return Array.isArray(f.values)?-1===f.values.indexOf(gs(u))&&_.push(new vn(o,u,`expected one of [${f.values.join(", ")}], ${JSON.stringify(u)} found`)):-1===Object.keys(f.values).indexOf(gs(u))&&_.push(new vn(o,u,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(u)} found`)),_}function Hu(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const o of a.slice(1))if(!Hu(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}function nh(a,o="fill"){if(null==a)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Hu(a)||(a=La(a));const u=a;let f=!0;try{f=function(R){if(!Kl(R))return R;let z=Bs(R);return Yl(z),z=Di(z),z}(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(u,null,2)}\n        `)}const _=Wt[`filter_${o}`],E=va(f,_);let S=null;if("error"===E.result)throw new Error(E.value.map(R=>`${R.key}: ${R.message}`).join(", "));S=(R,z,U)=>E.value.evaluate(R,z,{},U);let M=null,P=null;if(f!==u){const R=va(u,_);if("error"===R.result)throw new Error(R.value.map(z=>`${z.key}: ${z.message}`).join(", "));M=(z,U,G,q,W)=>R.value.evaluate(z,U,{},G,void 0,void 0,q,W),P=!Il(R.value.expression)}return{filter:S,dynamicFilter:M||void 0,needGeometry:qu(f),needFeature:!!P}}function Di(a){if(!Array.isArray(a))return a;const o=function(u){if(dc.has(u[0]))for(let f=1;f<u.length;f++)if(Kl(u[f]))return!0;return u}(a);return!0===o?o:o.map(u=>Di(u))}function Yl(a){let o=!1;const u=[];if("case"===a[0]){for(let f=1;f<a.length-1;f+=2)o=o||Kl(a[f]),u.push(a[f+1]);u.push(a[a.length-1])}else if("match"===a[0]){o=o||Kl(a[1]);for(let f=2;f<a.length-1;f+=2)u.push(a[f+1]);u.push(a[a.length-1])}else if("step"===a[0]){o=o||Kl(a[1]);for(let f=1;f<a.length-1;f+=2)u.push(a[f+1])}o&&(a.length=0,a.push("any",...u));for(let f=1;f<a.length;f++)Yl(a[f])}function Kl(a){if(!Array.isArray(a))return!1;if("pitch"===(o=a[0])||"distance-from-center"===o)return!0;var o;for(let u=1;u<a.length;u++)if(Kl(a[u]))return!0;return!1}const dc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function _u(a,o){return a<o?-1:a>o?1:0}function qu(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let o=1;o<a.length;o++)if(qu(a[o]))return!0;return!1}function La(a){if(!a)return!0;const o=a[0];return a.length<=1?"any"!==o:"=="===o?Pu(a[1],a[2],"=="):"!="===o?sr(Pu(a[1],a[2],"==")):"<"===o||">"===o||"<="===o||">="===o?Pu(a[1],a[2],o):"any"===o?(u=a.slice(1),["any"].concat(u.map(La))):"all"===o?["all"].concat(a.slice(1).map(La)):"none"===o?["all"].concat(a.slice(1).map(La).map(sr)):"in"===o?Ls(a[1],a.slice(2)):"!in"===o?sr(Ls(a[1],a.slice(2))):"has"===o?fc(a[1]):"!has"===o?sr(fc(a[1])):"within"!==o||a;var u}function Pu(a,o,u){switch(a){case"$type":return[`filter-type-${u}`,o];case"$id":return[`filter-id-${u}`,o];default:return[`filter-${u}`,a,o]}}function Ls(a,o){if(0===o.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(u=>typeof u!=typeof o[0])?["filter-in-large",a,["literal",o.sort(_u)]]:["filter-in-small",a,["literal",o]]}}function fc(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function sr(a){return["!",a]}function ss(a){return Hu(Bs(a.value))?xa(Vl({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${a.layerType||"fill"}`]})):yu(a)}function yu(a){const o=a.value,u=a.key;if("array"!==Gr(o))return[new vn(u,o,`array expected, ${Gr(o)} found`)];const f=a.styleSpec;let _,E=[];if(o.length<1)return[new vn(u,o,"filter array must have at least 1 element")];switch(E=E.concat(Xl({key:`${u}[0]`,value:o[0],valueSpec:f.filter_operator,style:a.style,styleSpec:a.styleSpec})),gs(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&"$type"===gs(o[1])&&E.push(new vn(u,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":3!==o.length&&E.push(new vn(u,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(_=Gr(o[1]),"string"!==_&&E.push(new vn(`${u}[1]`,o[1],`string expected, ${_} found`)));for(let S=2;S<o.length;S++)_=Gr(o[S]),"$type"===gs(o[1])?E=E.concat(Xl({key:`${u}[${S}]`,value:o[S],valueSpec:f.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==_&&"number"!==_&&"boolean"!==_&&E.push(new vn(`${u}[${S}]`,o[S],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let S=1;S<o.length;S++)E=E.concat(yu({key:`${u}[${S}]`,value:o[S],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":_=Gr(o[1]),2!==o.length?E.push(new vn(u,o,`filter array for "${o[0]}" operator must have 2 elements`)):"string"!==_&&E.push(new vn(`${u}[1]`,o[1],`string expected, ${_} found`));break;case"within":_=Gr(o[1]),2!==o.length?E.push(new vn(u,o,`filter array for "${o[0]}" operator must have 2 elements`)):"object"!==_&&E.push(new vn(`${u}[1]`,o[1],`object expected, ${_} found`))}return E}function sl(a,o){const u=a.key,f=a.style,_=a.styleSpec,E=a.value,S=a.objectKey,M=_[`${o}_${a.layerType}`];if(!M)return[];const P=S.match(/^(.*)-transition$/);if("paint"===o&&P&&M[P[1]]&&M[P[1]].transition)return B({key:u,value:E,valueSpec:_.transition,style:f,styleSpec:_});const R=a.valueSpec||M[S];if(!R)return[new vn(u,E,`unknown property "${S}"`)];let z;if("string"===Gr(E)&&cc(R)&&!R.tokens&&(z=/^{([^}]+)}$/.exec(E))){const G=`\`{ "type": "identity", "property": ${z?JSON.stringify(z[1]):'"_"'} }\``;return[new vn(u,E,`"${S}" does not support interpolation syntax\nUse an identity property function instead: ${G}.`)]}const U=[];return"symbol"===a.layerType&&("text-field"===S&&f&&!f.glyphs&&U.push(new vn(u,E,'use of "text-field" requires a style "glyphs" property')),"text-font"===S&&mu(Bs(E))&&"identity"===gs(E.type)&&U.push(new vn(u,E,'"text-font" does not support identity functions'))),U.concat(B({key:a.key,value:E,valueSpec:R,style:f,styleSpec:_,expressionContext:"property",propertyType:o,propertyKey:S}))}function ba(a){return sl(a,"paint")}function Al(a){return sl(a,"layout")}function ka(a){let o=[];const u=a.value,f=a.key,_=a.style,E=a.styleSpec;u.type||u.ref||o.push(new vn(f,u,'either "type" or "ref" is required'));let S=gs(u.type);const M=gs(u.ref);if(u.id){const P=gs(u.id);for(let R=0;R<a.arrayIndex;R++){const z=_.layers[R];gs(z.id)===P&&o.push(new vn(f,u.id,`duplicate layer id "${u.id}", previously used at line ${z.id.__line__}`))}}if("ref"in u){let P;["type","source","source-layer","filter","layout"].forEach(R=>{R in u&&o.push(new vn(f,u[R],`"${R}" is prohibited for ref layers`))}),_.layers.forEach(R=>{gs(R.id)===M&&(P=R)}),P?P.ref?o.push(new vn(f,u.ref,"ref cannot reference another ref layer")):S=gs(P.type):"string"==typeof M&&o.push(new vn(f,u.ref,`ref layer "${M}" not found`))}else if("background"!==S&&"sky"!==S)if(u.source){const P=_.sources&&_.sources[u.source],R=P&&gs(P.type);P?"vector"===R&&"raster"===S?o.push(new vn(f,u.source,`layer "${u.id}" requires a raster source`)):"raster"===R&&"raster"!==S?o.push(new vn(f,u.source,`layer "${u.id}" requires a vector source`)):"vector"!==R||u["source-layer"]?"raster-dem"===R&&"hillshade"!==S?o.push(new vn(f,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==S||!u.paint||!u.paint["line-gradient"]&&!u.paint["line-trim-offset"]||"geojson"===R&&P.lineMetrics||o.push(new vn(f,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new vn(f,u,`layer "${u.id}" must specify a "source-layer"`)):o.push(new vn(f,u.source,`source "${u.source}" not found`))}else o.push(new vn(f,u,'missing required property "source"'));return o=o.concat(Mo({key:f,value:u,valueSpec:E.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>B({key:`${f}.type`,value:u.type,valueSpec:E.layer.type,style:a.style,styleSpec:a.styleSpec,object:u,objectKey:"type"}),filter:P=>ss(Vl({layerType:S},P)),layout:P=>Mo({layer:u,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":R=>Al(Vl({layerType:S},R))}}),paint:P=>Mo({layer:u,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":R=>ba(Vl({layerType:S},R))}})}})),o}function Co(a){const o=a.value,u=a.key,f=Gr(o);return"string"!==f?[new vn(u,o,`string expected, ${f} found`)]:[]}const yf={promoteId:function({key:a,value:o}){if("string"===Gr(o))return Co({key:a,value:o});{const u=[];for(const f in o)u.push(...Co({key:`${a}.${f}`,value:o[f]}));return u}}};function td(a){const o=a.value,u=a.key,f=a.styleSpec,_=a.style;if(!o.type)return[new vn(u,o,'"type" is required')];const E=gs(o.type);let S;switch(E){case"vector":case"raster":case"raster-dem":return S=Mo({key:u,value:o,valueSpec:f[`source_${E.replace("-","_")}`],style:a.style,styleSpec:f,objectElementValidators:yf}),S;case"geojson":if(S=Mo({key:u,value:o,valueSpec:f.source_geojson,style:_,styleSpec:f,objectElementValidators:yf}),o.cluster)for(const M in o.clusterProperties){const[P,R]=o.clusterProperties[M],z="string"==typeof P?[P,["accumulated"],["get",M]]:P;S.push(...xa({key:`${u}.${M}.map`,value:R,expressionContext:"cluster-map"})),S.push(...xa({key:`${u}.${M}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return S;case"video":return Mo({key:u,value:o,valueSpec:f.source_video,style:_,styleSpec:f});case"image":return Mo({key:u,value:o,valueSpec:f.source_image,style:_,styleSpec:f});case"canvas":return[new vn(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xl({key:`${u}.type`,value:o.type,valueSpec:{values:l(f)},style:_,styleSpec:f})}}function l(a){return a.source.reduce((o,u)=>{const f=a[u];return"enum"===f.type.type&&(o=o.concat(Object.keys(f.type.values))),o},[])}function h(a){const o=a.value,u=a.styleSpec,f=u.light,_=a.style;let E=[];const S=Gr(o);if(void 0===o)return E;if("object"!==S)return E=E.concat([new vn("light",o,`object expected, ${S} found`)]),E;for(const M in o){const P=M.match(/^(.*)-transition$/);E=E.concat(P&&f[P[1]]&&f[P[1]].transition?B({key:M,value:o[M],valueSpec:u.transition,style:_,styleSpec:u}):f[M]?B({key:M,value:o[M],valueSpec:f[M],style:_,styleSpec:u}):[new vn(M,o[M],`unknown property "${M}"`)])}return E}function y(a){const o=a.value,u=a.key,f=a.style,_=a.styleSpec,E=_.terrain;let S=[];const M=Gr(o);if(void 0===o)return S;if("object"!==M)return S=S.concat([new vn("terrain",o,`object expected, ${M} found`)]),S;for(const P in o){const R=P.match(/^(.*)-transition$/);S=S.concat(R&&E[R[1]]&&E[R[1]].transition?B({key:P,value:o[P],valueSpec:_.transition,style:f,styleSpec:_}):E[P]?B({key:P,value:o[P],valueSpec:E[P],style:f,styleSpec:_}):[new vn(P,o[P],`unknown property "${P}"`)])}if(o.source){const P=f.sources&&f.sources[o.source],R=P&&gs(P.type);P?"raster-dem"!==R&&S.push(new vn(u,o.source,`terrain cannot be used with a source of type ${String(R)}, it only be used with a "raster-dem" source type`)):S.push(new vn(u,o.source,`source "${o.source}" not found`))}else S.push(new vn(u,o,'terrain is missing required property "source"'));return S}function b(a){const o=a.value,u=a.style,f=a.styleSpec,_=f.fog;let E=[];const S=Gr(o);if(void 0===o)return E;if("object"!==S)return E=E.concat([new vn("fog",o,`object expected, ${S} found`)]),E;for(const M in o){const P=M.match(/^(.*)-transition$/);E=E.concat(P&&_[P[1]]&&_[P[1]].transition?B({key:M,value:o[M],valueSpec:f.transition,style:u,styleSpec:f}):_[M]?B({key:M,value:o[M],valueSpec:_[M],style:u,styleSpec:f}):[new vn(M,o[M],`unknown property "${M}"`)])}return E}const I={"*":()=>[],array:hc,boolean:function(a){const o=a.value,u=a.key,f=Gr(o);return"boolean"!==f?[new vn(u,o,`boolean expected, ${f} found`)]:[]},number:Za,color:function(a){const o=a.key,u=a.value,f=Gr(u);return"string"!==f?[new vn(o,u,`color expected, ${f} found`)]:null===Sl(u)?[new vn(o,u,`color expected, "${u}" found`)]:[]},enum:Xl,filter:ss,function:Go,layer:ka,object:Mo,source:td,light:h,terrain:y,fog:b,string:Co,formatted:function(a){return 0===Co(a).length?[]:xa(a)},resolvedImage:function(a){return 0===Co(a).length?[]:xa(a)},projection:function(a){const o=a.value,u=a.styleSpec,f=u.projection,_=a.style;let E=[];const S=Gr(o);if("object"===S)for(const M in o)E=E.concat(B({key:M,value:o[M],valueSpec:f[M],style:_,styleSpec:u}));else"string"!==S&&(E=E.concat([new vn("projection",o,`object or string expected, ${S} found`)]));return E}};function B(a){const o=a.value,u=a.valueSpec,f=a.styleSpec;return u.expression&&mu(gs(o))?Go(a):u.expression&&ai(Bs(o))?xa(a):u.type&&I[u.type]?I[u.type](a):Mo(Vl({},a,{valueSpec:u.type?f[u.type]:u}))}function j(a){const o=a.value,u=a.key,f=Co(a);return f.length||(-1===o.indexOf("{fontstack}")&&f.push(new vn(u,o,'"glyphs" url must include a "{fontstack}" token')),-1===o.indexOf("{range}")&&f.push(new vn(u,o,'"glyphs" url must include a "{range}" token'))),f}function oe(a,o=Wt){return kt(B({key:"",value:a,valueSpec:o.$root,styleSpec:o,style:a,objectElementValidators:{glyphs:j,"*":()=>[]}}))}const Pe=a=>kt(ba(a)),st=a=>kt(Al(a));function kt(a){return a.slice().sort((o,u)=>o.line&&u.line?o.line-u.line:0)}function qt(a,o){let u=!1;if(o&&o.length)for(const f of o)a.fire(new da(new Error(f.message))),u=!0;return u}var Pn=zn,In=3;function zn(a,o,u){var f=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var _=new Int32Array(this.arrayBuffer);a=_[0],this.d=(o=_[1])+2*(u=_[2]);for(var E=0;E<this.d*this.d;E++){var S=_[In+E],M=_[In+E+1];f.push(S===M?null:_.subarray(S,M))}var P=_[In+f.length+1];this.keys=_.subarray(_[In+f.length],P),this.bboxes=_.subarray(P),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var R=0;R<this.d*this.d;R++)f.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=a,this.padding=u,this.scale=o/a,this.uid=0;var z=u/o*a;this.min=-z,this.max=a+z}zn.prototype.insert=function(a,o,u,f,_){this._forEachCell(o,u,f,_,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(_)},zn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},zn.prototype._insertCell=function(a,o,u,f,_,E){this.cells[_].push(E)},zn.prototype.query=function(a,o,u,f,_){var E=this.min,S=this.max;if(a<=E&&o<=E&&S<=u&&S<=f&&!_)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(a,o,u,f,this._queryCell,M,{},_),M},zn.prototype._queryCell=function(a,o,u,f,_,E,S,M){var P=this.cells[_];if(null!==P)for(var R=this.keys,z=this.bboxes,U=0;U<P.length;U++){var G=P[U];if(void 0===S[G]){var q=4*G;(M?M(z[q+0],z[q+1],z[q+2],z[q+3]):a<=z[q+2]&&o<=z[q+3]&&u>=z[q+0]&&f>=z[q+1])?(S[G]=!0,E.push(R[G])):S[G]=!1}}},zn.prototype._forEachCell=function(a,o,u,f,_,E,S,M){for(var P=this._convertToCellCoord(a),R=this._convertToCellCoord(o),z=this._convertToCellCoord(u),U=this._convertToCellCoord(f),G=P;G<=z;G++)for(var q=R;q<=U;q++){var W=this.d*q+G;if((!M||M(this._convertFromCellCoord(G),this._convertFromCellCoord(q),this._convertFromCellCoord(G+1),this._convertFromCellCoord(q+1)))&&_.call(this,a,o,u,f,W,E,S,M))return}},zn.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},zn.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},zn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,o=In+this.cells.length+1+1,u=0,f=0;f<this.cells.length;f++)u+=this.cells[f].length;var _=new Int32Array(o+u+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var E=o,S=0;S<a.length;S++){var M=a[S];_[In+S]=E,_.set(M,E),E+=M.length}return _[In+a.length]=E,_.set(this.keys,E),_[In+a.length+1]=E+=this.keys.length,_.set(this.bboxes,E),E+=this.bboxes.length,_.buffer};var tr=Ne(Pn);const Mi={};function Tn(a,o,u={}){Object.defineProperty(a,"_classRegistryKey",{value:o,writeable:!1}),Mi[o]={klass:a,omit:u.omit||[]}}Tn(Object,"Object"),tr.serialize=function(a,o){const u=a.toArrayBuffer();return o&&o.push(u),{buffer:u}},tr.deserialize=function(a){return new tr(a.buffer)},Object.defineProperty(tr,"name",{value:"Grid"}),Tn(tr,"Grid"),Tn(zs,"Color"),Tn(Error,"Error"),Tn(Fr,"AJAXError"),Tn(Sr,"ResolvedImage"),Tn(_s,"StylePropertyFunction"),Tn($u,"StyleExpression",{omit:["_evaluator"]}),Tn(Pr,"ZoomDependentExpression"),Tn(Nu,"ZoomConstantExpression"),Tn($l,"CompoundExpression",{omit:["_evaluate"]});for(const a in Ui)Mi[Ui[a]._classRegistryKey]||Tn(Ui[a],`Expression${a}`);function wa(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function Ea(a){return be.ImageBitmap&&a instanceof be.ImageBitmap}function ml(a,o){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(wa(a)||Ea(a))return o&&o.push(a),a;if(ArrayBuffer.isView(a)){const u=a;return o&&o.push(u.buffer),u}if(a instanceof be.ImageData)return o&&o.push(a.data.buffer),a;if(Array.isArray(a)){const u=[];for(const f of a)u.push(ml(f,o));return u}if("object"==typeof a){const u=a.constructor,f=u._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${f}`);const _=u.serialize?u.serialize(a,o):{};if(!u.serialize){for(const E in a)a.hasOwnProperty(E)&&(Mi[f].omit.indexOf(E)>=0||(_[E]=ml(a[E],o)));a instanceof Error&&(_.message=a.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==f&&(_.$name=f),_}throw new Error("can't serialize object of type "+typeof a)}function Ac(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||wa(a)||Ea(a)||ArrayBuffer.isView(a)||a instanceof be.ImageData)return a;if(Array.isArray(a))return a.map(Ac);if("object"==typeof a){const o=a.$name||"Object",{klass:u}=Mi[o];if(!u)throw new Error(`can't deserialize unregistered class ${o}`);if(u.deserialize)return u.deserialize(a);const f=Object.create(u.prototype);for(const _ of Object.keys(a))"$name"!==_&&(f[_]=Ac(a[_]));return f}throw new Error("can't deserialize object of type "+typeof a)}const Ln={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function np(a){for(const o of a)if(sg(o.charCodeAt(0)))return!0;return!1}function dy(a){for(const o of a)if(!xm(o.charCodeAt(0)))return!1;return!0}function xm(a){return!(Ln.Arabic(a)||Ln["Arabic Supplement"](a)||Ln["Arabic Extended-A"](a)||Ln["Arabic Presentation Forms-A"](a)||Ln["Arabic Presentation Forms-B"](a))}function sg(a){return!(746!==a&&747!==a&&(a<4352||!(Ln["Bopomofo Extended"](a)||Ln.Bopomofo(a)||Ln["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Ln["CJK Compatibility Ideographs"](a)||Ln["CJK Compatibility"](a)||Ln["CJK Radicals Supplement"](a)||Ln["CJK Strokes"](a)||!(!Ln["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||Ln["CJK Unified Ideographs Extension A"](a)||Ln["CJK Unified Ideographs"](a)||Ln["Enclosed CJK Letters and Months"](a)||Ln["Hangul Compatibility Jamo"](a)||Ln["Hangul Jamo Extended-A"](a)||Ln["Hangul Jamo Extended-B"](a)||Ln["Hangul Jamo"](a)||Ln["Hangul Syllables"](a)||Ln.Hiragana(a)||Ln["Ideographic Description Characters"](a)||Ln.Kanbun(a)||Ln["Kangxi Radicals"](a)||Ln["Katakana Phonetic Extensions"](a)||Ln.Katakana(a)&&12540!==a||!(!Ln["Halfwidth and Fullwidth Forms"](a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!Ln["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Ln["Unified Canadian Aboriginal Syllabics"](a)||Ln["Unified Canadian Aboriginal Syllabics Extended"](a)||Ln["Vertical Forms"](a)||Ln["Yijing Hexagram Symbols"](a)||Ln["Yi Syllables"](a)||Ln["Yi Radicals"](a))))}function fy(a){return!(sg(a)||(o=a,Ln["Latin-1 Supplement"](o)&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||Ln["General Punctuation"](o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||Ln["Letterlike Symbols"](o)||Ln["Number Forms"](o)||Ln["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||Ln["Control Pictures"](o)&&9251!==o||Ln["Optical Character Recognition"](o)||Ln["Enclosed Alphanumerics"](o)||Ln["Geometric Shapes"](o)||Ln["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Ln["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Ln["CJK Symbols and Punctuation"](o)||Ln.Katakana(o)||Ln["Private Use Area"](o)||Ln["CJK Compatibility Forms"](o)||Ln["Small Form Variants"](o)||Ln["Halfwidth and Fullwidth Forms"](o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o}function bm(a){return a>=1424&&a<=2303||Ln["Arabic Presentation Forms-A"](a)||Ln["Arabic Presentation Forms-B"](a)}function Nc(a,o){return!(!o&&bm(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Ln.Khmer(a))}function rp(a){for(const o of a)if(bm(o.charCodeAt(0)))return!0;return!1}const Fa="deferred",ip="loading",wm="loaded";let Th=null,x="unavailable",c=null;const g=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(x="error"),Th&&Th(a)};function C(){T.fire(new Hs("pluginStateChange",{pluginStatus:x,pluginURL:c}))}const T=new fa,A=function(){return x},L=function(){if(x!==Fa||!c)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");x=ip,C(),c&&Po({url:c},a=>{a?g(a):(x=wm,C())})},F={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>x===wm||null!=F.applyArabicShaping,isLoading:()=>x===ip,setState(a){x=a.pluginStatus,c=a.pluginURL},isParsed:()=>null!=F.applyArabicShaping&&null!=F.processBidirectionalText&&null!=F.processStyledBidirectionalText,getPluginURL:()=>c};class V{constructor(o,u){this.zoom=o,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.transition=u.transition,this.pitch=u.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(o){return function(u,f){for(const _ of u)if(!Nc(_.charCodeAt(0),f))return!1;return!0}(o,F.isLoaded())}}class H{constructor(o,u){this.property=o,this.value=u,this.expression=function(f,_){if(mu(f))return new _s(f,_);if(ai(f)){const E=Wa(f,_);if("error"===E.result)throw new Error(E.value.map(S=>`${S.key}: ${S.message}`).join(", "));return E.value}{let E=f;return"string"==typeof f&&"color"===_.type&&(E=zs.parse(f)),{kind:"constant",evaluate:()=>E}}}(void 0===u?o.specification.default:u,o.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,u,f){return this.property.possiblyEvaluate(this,o,u,f)}}class ${constructor(o){this.property=o,this.value=new H(o,void 0)}transitioned(o,u){return new ge(this.property,this.value,u,Ie({},o.transition,this.transition),o.now)}untransitioned(){return new ge(this.property,this.value,null,{},0)}}class ee{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return un(this._values[o].value.value)}setValue(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new $(this._values[o].property)),this._values[o].value=new H(this._values[o].property,null===u?void 0:un(u))}getTransition(o){return un(this._values[o].transition)}setTransition(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new $(this._values[o].property)),this._values[o].transition=un(u)||void 0}serialize(){const o={};for(const u of Object.keys(this._values)){const f=this.getValue(u);void 0!==f&&(o[u]=f);const _=this.getTransition(u);void 0!==_&&(o[`${u}-transition`]=_)}return o}transitioned(o,u){const f=new De(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].transitioned(o,u._values[_]);return f}untransitioned(){const o=new De(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].untransitioned();return o}}class ge{constructor(o,u,f,_,E){const S=_.delay||0,M=_.duration||0;E=E||0,this.property=o,this.value=u,this.begin=E+S,this.end=this.begin+M,o.specification.transition&&(_.delay||_.duration)&&(this.prior=f)}possiblyEvaluate(o,u,f){const _=o.now||0,E=this.value.possiblyEvaluate(o,u,f),S=this.prior;if(S){if(_>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(_<this.begin)return S.possiblyEvaluate(o,u,f);{const M=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(o,u,f),E,Te(M))}}return E}}class De{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,u,f){const _=new Le(this._properties);for(const E of Object.keys(this._values))_._values[E]=this._values[E].possiblyEvaluate(o,u,f);return _}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class Re{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return un(this._values[o].value)}setValue(o,u){this._values[o]=new H(this._values[o].property,null===u?void 0:un(u))}serialize(){const o={};for(const u of Object.keys(this._values)){const f=this.getValue(u);void 0!==f&&(o[u]=f)}return o}possiblyEvaluate(o,u,f){const _=new Le(this._properties);for(const E of Object.keys(this._values))_._values[E]=this._values[E].possiblyEvaluate(o,u,f);return _}}class Ce{constructor(o,u,f){this.property=o,this.value=u,this.parameters=f}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,u,f,_){return this.property.evaluate(this.value,this.parameters,o,u,f,_)}}class Le{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class te{constructor(o){this.specification=o}possiblyEvaluate(o,u){return o.expression.evaluate(u)}interpolate(o,u,f){const _=jn[this.specification.type];return _?_(o,u,f):o}}class Se{constructor(o,u){this.specification=o,this.overrides=u}possiblyEvaluate(o,u,f,_){return new Ce(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(u,null,{},f,_)}:o.expression,u)}interpolate(o,u,f){if("constant"!==o.value.kind||"constant"!==u.value.kind)return o;if(void 0===o.value.value||void 0===u.value.value)return new Ce(this,{kind:"constant",value:void 0},o.parameters);const _=jn[this.specification.type];return _?new Ce(this,{kind:"constant",value:_(o.value.value,u.value.value,f)},o.parameters):o}evaluate(o,u,f,_,E,S){return"constant"===o.kind?o.value:o.evaluate(u,f,_,E,S)}}class Ue{constructor(o){this.specification=o}possiblyEvaluate(o,u,f,_){return!!o.expression.evaluate(u,null,{},f,_)}interpolate(){return!1}}class He{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const u=new V(0,{});for(const f in o){const _=o[f];_.specification.overridable&&this.overridableProperties.push(f);const E=this.defaultPropertyValues[f]=new H(_,void 0),S=this.defaultTransitionablePropertyValues[f]=new $(_);this.defaultTransitioningPropertyValues[f]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=E.possiblyEvaluate(u)}}}function lt(a,o){return 256*(a=we(Math.floor(a),0,255))+we(Math.floor(o),0,255)}Tn(Se,"DataDrivenProperty"),Tn(te,"DataConstantProperty"),Tn(Ue,"ColorRampProperty");const ut={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ct{constructor(o,u){this._structArray=o,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class yt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,u){return o._trim(),u&&(o.isTransferred=!0,u.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const u=Object.create(this.prototype);return u.arrayBuffer=o.arrayBuffer,u.length=o.length,u.capacity=o.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function xt(a,o=1){let u=0,f=0;return{members:a.map(_=>{const E=ut[_.type].BYTES_PER_ELEMENT,S=u=Bt(u,Math.max(o,E)),M=_.components||1;return f=Math.max(f,E),u+=E*M,{name:_.name,type:_.type,components:M,offset:S}}),size:Bt(u,Math.max(f,o)),alignment:o}}function Bt(a,o){return Math.ceil(a/o)*o}class Qt extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,u)}emplace(o,u,f){const _=2*o;return this.int16[_+0]=u,this.int16[_+1]=f,o}}Qt.prototype.bytesPerElement=4,Tn(Qt,"StructArrayLayout2i4");class Nt extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f){const _=this.length;return this.resize(_+1),this.emplace(_,o,u,f)}emplace(o,u,f,_){const E=3*o;return this.int16[E+0]=u,this.int16[E+1]=f,this.int16[E+2]=_,o}}Nt.prototype.bytesPerElement=6,Tn(Nt,"StructArrayLayout3i6");class Jt extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,_){const E=this.length;return this.resize(E+1),this.emplace(E,o,u,f,_)}emplace(o,u,f,_,E){const S=4*o;return this.int16[S+0]=u,this.int16[S+1]=f,this.int16[S+2]=_,this.int16[S+3]=E,o}}Jt.prototype.bytesPerElement=8,Tn(Jt,"StructArrayLayout4i8");class Pt extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,_,E,S,M){const P=this.length;return this.resize(P+1),this.emplace(P,o,u,f,_,E,S,M)}emplace(o,u,f,_,E,S,M,P){const R=6*o,z=12*o,U=3*o;return this.int16[R+0]=u,this.int16[R+1]=f,this.uint8[z+4]=_,this.uint8[z+5]=E,this.uint8[z+6]=S,this.uint8[z+7]=M,this.float32[U+2]=P,o}}Pt.prototype.bytesPerElement=12,Tn(Pt,"StructArrayLayout2i4ub1f12");class mn extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,_){const E=this.length;return this.resize(E+1),this.emplace(E,o,u,f,_)}emplace(o,u,f,_,E){const S=4*o;return this.float32[S+0]=u,this.float32[S+1]=f,this.float32[S+2]=_,this.float32[S+3]=E,o}}mn.prototype.bytesPerElement=16,Tn(mn,"StructArrayLayout4f16");class Ft extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,_,E){const S=this.length;return this.resize(S+1),this.emplace(S,o,u,f,_,E)}emplace(o,u,f,_,E,S){const M=6*o,P=3*o;return this.uint16[M+0]=u,this.uint16[M+1]=f,this.uint16[M+2]=_,this.uint16[M+3]=E,this.float32[P+2]=S,o}}Ft.prototype.bytesPerElement=12,Tn(Ft,"StructArrayLayout4ui1f12");class Yt extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,_){const E=this.length;return this.resize(E+1),this.emplace(E,o,u,f,_)}emplace(o,u,f,_,E){const S=4*o;return this.uint16[S+0]=u,this.uint16[S+1]=f,this.uint16[S+2]=_,this.uint16[S+3]=E,o}}Yt.prototype.bytesPerElement=8,Tn(Yt,"StructArrayLayout4ui8");class an extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,_,E,S){const M=this.length;return this.resize(M+1),this.emplace(M,o,u,f,_,E,S)}emplace(o,u,f,_,E,S,M){const P=6*o;return this.int16[P+0]=u,this.int16[P+1]=f,this.int16[P+2]=_,this.int16[P+3]=E,this.int16[P+4]=S,this.int16[P+5]=M,o}}an.prototype.bytesPerElement=12,Tn(an,"StructArrayLayout6i12");class ln extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,_,E,S,M,P,R,z,U,G){const q=this.length;return this.resize(q+1),this.emplace(q,o,u,f,_,E,S,M,P,R,z,U,G)}emplace(o,u,f,_,E,S,M,P,R,z,U,G,q){const W=12*o;return this.int16[W+0]=u,this.int16[W+1]=f,this.int16[W+2]=_,this.int16[W+3]=E,this.uint16[W+4]=S,this.uint16[W+5]=M,this.uint16[W+6]=P,this.uint16[W+7]=R,this.int16[W+8]=z,this.int16[W+9]=U,this.int16[W+10]=G,this.int16[W+11]=q,o}}ln.prototype.bytesPerElement=24,Tn(ln,"StructArrayLayout4i4ui4i24");class xn extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,_,E,S){const M=this.length;return this.resize(M+1),this.emplace(M,o,u,f,_,E,S)}emplace(o,u,f,_,E,S,M){const P=10*o,R=5*o;return this.int16[P+0]=u,this.int16[P+1]=f,this.int16[P+2]=_,this.float32[R+2]=E,this.float32[R+3]=S,this.float32[R+4]=M,o}}xn.prototype.bytesPerElement=20,Tn(xn,"StructArrayLayout3i3f20");class cr extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.uint32[1*o+0]=u,o}}cr.prototype.bytesPerElement=4,Tn(cr,"StructArrayLayout1ul4");class br extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,_,E,S,M,P,R,z,U,G,q){const W=this.length;return this.resize(W+1),this.emplace(W,o,u,f,_,E,S,M,P,R,z,U,G,q)}emplace(o,u,f,_,E,S,M,P,R,z,U,G,q,W){const re=20*o,ve=10*o;return this.int16[re+0]=u,this.int16[re+1]=f,this.int16[re+2]=_,this.int16[re+3]=E,this.int16[re+4]=S,this.float32[ve+3]=M,this.float32[ve+4]=P,this.float32[ve+5]=R,this.float32[ve+6]=z,this.int16[re+14]=U,this.uint32[ve+8]=G,this.uint16[re+18]=q,this.uint16[re+19]=W,o}}br.prototype.bytesPerElement=40,Tn(br,"StructArrayLayout5i4f1i1ul2ui40");class Hn extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,_,E,S,M){const P=this.length;return this.resize(P+1),this.emplace(P,o,u,f,_,E,S,M)}emplace(o,u,f,_,E,S,M,P){const R=8*o;return this.int16[R+0]=u,this.int16[R+1]=f,this.int16[R+2]=_,this.int16[R+4]=E,this.int16[R+5]=S,this.int16[R+6]=M,this.int16[R+7]=P,o}}Hn.prototype.bytesPerElement=16,Tn(Hn,"StructArrayLayout3i2i2i16");class vr extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,u,f,_,E){const S=this.length;return this.resize(S+1),this.emplace(S,o,u,f,_,E)}emplace(o,u,f,_,E,S){const M=4*o,P=8*o;return this.float32[M+0]=u,this.float32[M+1]=f,this.float32[M+2]=_,this.int16[P+6]=E,this.int16[P+7]=S,o}}vr.prototype.bytesPerElement=16,Tn(vr,"StructArrayLayout2f1f2i16");class ci extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,_){const E=this.length;return this.resize(E+1),this.emplace(E,o,u,f,_)}emplace(o,u,f,_,E){const S=12*o,M=3*o;return this.uint8[S+0]=u,this.uint8[S+1]=f,this.float32[M+1]=_,this.float32[M+2]=E,o}}ci.prototype.bytesPerElement=12,Tn(ci,"StructArrayLayout2ub2f12");class li extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f){const _=this.length;return this.resize(_+1),this.emplace(_,o,u,f)}emplace(o,u,f,_){const E=3*o;return this.float32[E+0]=u,this.float32[E+1]=f,this.float32[E+2]=_,o}}li.prototype.bytesPerElement=12,Tn(li,"StructArrayLayout3f12");class nr extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f){const _=this.length;return this.resize(_+1),this.emplace(_,o,u,f)}emplace(o,u,f,_){const E=3*o;return this.uint16[E+0]=u,this.uint16[E+1]=f,this.uint16[E+2]=_,o}}nr.prototype.bytesPerElement=6,Tn(nr,"StructArrayLayout3ui6");class So extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,u,f,_,E,S,M,P,R,z,U,G,q,W,re,ve,ke,et,Be,Je,nt){const ot=this.length;return this.resize(ot+1),this.emplace(ot,o,u,f,_,E,S,M,P,R,z,U,G,q,W,re,ve,ke,et,Be,Je,nt)}emplace(o,u,f,_,E,S,M,P,R,z,U,G,q,W,re,ve,ke,et,Be,Je,nt,ot){const zt=30*o,Rt=15*o,Xt=60*o;return this.int16[zt+0]=u,this.int16[zt+1]=f,this.int16[zt+2]=_,this.float32[Rt+2]=E,this.float32[Rt+3]=S,this.uint16[zt+8]=M,this.uint16[zt+9]=P,this.uint32[Rt+5]=R,this.uint32[Rt+6]=z,this.uint32[Rt+7]=U,this.uint16[zt+16]=G,this.uint16[zt+17]=q,this.uint16[zt+18]=W,this.float32[Rt+10]=re,this.float32[Rt+11]=ve,this.uint8[Xt+48]=ke,this.uint8[Xt+49]=et,this.uint8[Xt+50]=Be,this.uint32[Rt+13]=Je,this.int16[zt+28]=nt,this.uint8[Xt+58]=ot,o}}So.prototype.bytesPerElement=60,Tn(So,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class qn extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,u,f,_,E,S,M,P,R,z,U,G,q,W,re,ve,ke,et,Be,Je,nt,ot,zt,Rt,Xt,_n,jt,tn,nn,dn){const wn=this.length;return this.resize(wn+1),this.emplace(wn,o,u,f,_,E,S,M,P,R,z,U,G,q,W,re,ve,ke,et,Be,Je,nt,ot,zt,Rt,Xt,_n,jt,tn,nn,dn)}emplace(o,u,f,_,E,S,M,P,R,z,U,G,q,W,re,ve,ke,et,Be,Je,nt,ot,zt,Rt,Xt,_n,jt,tn,nn,dn,wn){const Zt=38*o,On=19*o;return this.int16[Zt+0]=u,this.int16[Zt+1]=f,this.int16[Zt+2]=_,this.float32[On+2]=E,this.float32[On+3]=S,this.int16[Zt+8]=M,this.int16[Zt+9]=P,this.int16[Zt+10]=R,this.int16[Zt+11]=z,this.int16[Zt+12]=U,this.int16[Zt+13]=G,this.uint16[Zt+14]=q,this.uint16[Zt+15]=W,this.uint16[Zt+16]=re,this.uint16[Zt+17]=ve,this.uint16[Zt+18]=ke,this.uint16[Zt+19]=et,this.uint16[Zt+20]=Be,this.uint16[Zt+21]=Je,this.uint16[Zt+22]=nt,this.uint16[Zt+23]=ot,this.uint16[Zt+24]=zt,this.uint16[Zt+25]=Rt,this.uint16[Zt+26]=Xt,this.uint16[Zt+27]=_n,this.uint16[Zt+28]=jt,this.uint32[On+15]=tn,this.float32[On+16]=nn,this.float32[On+17]=dn,this.float32[On+18]=wn,o}}qn.prototype.bytesPerElement=76,Tn(qn,"StructArrayLayout3i2f6i15ui1ul3f76");class Lo extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.float32[1*o+0]=u,o}}Lo.prototype.bytesPerElement=4,Tn(Lo,"StructArrayLayout1f4");class Xo extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u,f,_,E){const S=this.length;return this.resize(S+1),this.emplace(S,o,u,f,_,E)}emplace(o,u,f,_,E,S){const M=5*o;return this.float32[M+0]=u,this.float32[M+1]=f,this.float32[M+2]=_,this.float32[M+3]=E,this.float32[M+4]=S,o}}Xo.prototype.bytesPerElement=20,Tn(Xo,"StructArrayLayout5f20");class Nl extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u,f,_){const E=this.length;return this.resize(E+1),this.emplace(E,o,u,f,_)}emplace(o,u,f,_,E){const S=6*o;return this.uint32[3*o+0]=u,this.uint16[S+2]=f,this.uint16[S+3]=_,this.uint16[S+4]=E,o}}Nl.prototype.bytesPerElement=12,Tn(Nl,"StructArrayLayout1ul3ui12");class al extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,u)}emplace(o,u,f){const _=2*o;return this.uint16[_+0]=u,this.uint16[_+1]=f,o}}al.prototype.bytesPerElement=4,Tn(al,"StructArrayLayout2ui4");class Wu extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const u=this.length;return this.resize(u+1),this.emplace(u,o)}emplace(o,u){return this.uint16[1*o+0]=u,o}}Wu.prototype.bytesPerElement=2,Tn(Wu,"StructArrayLayout1ui2");class pc extends yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,u){const f=this.length;return this.resize(f+1),this.emplace(f,o,u)}emplace(o,u,f){const _=2*o;return this.float32[_+0]=u,this.float32[_+1]=f,o}}pc.prototype.bytesPerElement=8,Tn(pc,"StructArrayLayout2f8");class ko extends ct{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ko.prototype.size=40;class $o extends br{get(o){return new ko(this,o)}}Tn($o,"CollisionBoxArray");class ji extends ct{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}ji.prototype.size=60;class Ca extends So{get(o){return new ji(this,o)}}Tn(Ca,"PlacedSymbolArray");class Jl extends ct{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(o){this._structArray.uint32[this._pos4+15]=o}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Jl.prototype.size=76;class ys extends qn{get(o){return new Jl(this,o)}}Tn(ys,"SymbolInstanceArray");class cn extends Lo{getoffsetX(o){return this.float32[1*o+0]}}Tn(cn,"GlyphOffsetArray");class Li extends Qt{getx(o){return this.int16[2*o+0]}gety(o){return this.int16[2*o+1]}}Tn(Li,"SymbolLineVertexArray");class ll extends ct{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ll.prototype.size=12;class Pl extends Nl{get(o){return new ll(this,o)}}Tn(Pl,"FeatureIndexArray");class ks extends al{geta_centroid_pos0(o){return this.uint16[2*o+0]}geta_centroid_pos1(o){return this.uint16[2*o+1]}}Tn(ks,"FillExtrusionCentroidArray");const rh=xt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),gc=xt([{name:"a_dash",components:4,type:"Uint16"}]);var Ru={exports:{}},sE=function(a,o){var u,f,_,E,S,M,P,R;for(f=a.length-(u=3&a.length),_=o,S=3432918353,M=461845907,R=0;R<f;)P=255&a.charCodeAt(R)|(255&a.charCodeAt(++R))<<8|(255&a.charCodeAt(++R))<<16|(255&a.charCodeAt(++R))<<24,++R,_=27492+(65535&(E=5*(65535&(_=(_^=P=(65535&(P=(P=(65535&P)*S+(((P>>>16)*S&65535)<<16)&4294967295)<<15|P>>>17))*M+(((P>>>16)*M&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(P=0,u){case 3:P^=(255&a.charCodeAt(R+2))<<16;case 2:P^=(255&a.charCodeAt(R+1))<<8;case 1:_^=P=(65535&(P=(P=(65535&(P^=255&a.charCodeAt(R)))*S+(((P>>>16)*S&65535)<<16)&4294967295)<<15|P>>>17))*M+(((P>>>16)*M&65535)<<16)&4294967295}return _^=a.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0},y1=function(a,o){for(var u,f=a.length,_=o^f,E=0;f>=4;)u=1540483477*(65535&(u=255&a.charCodeAt(E)|(255&a.charCodeAt(++E))<<8|(255&a.charCodeAt(++E))<<16|(255&a.charCodeAt(++E))<<24))+((1540483477*(u>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++E;switch(f){case 3:_^=(255&a.charCodeAt(E+2))<<16;case 2:_^=(255&a.charCodeAt(E+1))<<8;case 1:_=1540483477*(65535&(_^=255&a.charCodeAt(E)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0};Ru.exports=sE,Ru.exports.murmur3=sE,Ru.exports.murmur2=y1;var Ql=Ne(Ru.exports);class Pc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,u,f,_){this.ids.push(py(o)),this.positions.push(u,f,_)}getPositions(o){const u=py(o);let f=0,_=this.ids.length-1;for(;f<_;){const S=f+_>>1;this.ids[S]>=u?_=S:f=S+1}const E=[];for(;this.ids[f]===u;)E.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return E}static serialize(o,u){const f=new Float64Array(o.ids),_=new Uint32Array(o.positions);return zd(f,_,0,f.length-1),u&&u.push(f.buffer,_.buffer),{ids:f,positions:_}}static deserialize(o){const u=new Pc;return u.ids=o.ids,u.positions=o.positions,u.indexed=!0,u}}function py(a){const o=+a;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:Ql(String(a))}function zd(a,o,u,f){for(;u<f;){const _=a[u+f>>1];let E=u-1,S=f+1;for(;;){do{E++}while(a[E]<_);do{S--}while(a[S]>_);if(E>=S)break;Rc(a,E,S),Rc(o,3*E,3*S),Rc(o,3*E+1,3*S+1),Rc(o,3*E+2,3*S+2)}S-u<f-S?(zd(a,o,u,S),u=S+1):(zd(a,o,S+1,f),f=S)}}function Rc(a,o,u){const f=a[o];a[o]=a[u],a[u]=f}Tn(Pc,"FeaturePositionMap");class rd{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,u){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,u),this.initialized=!0),!!this.location}}class ag extends rd{constructor(o){super(o),this.current=0}set(o,u,f){this.fetchUniformLocation(o,u)&&this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))}}class v1 extends rd{constructor(o){super(o),this.current=[0,0,0,0]}set(o,u,f){this.fetchUniformLocation(o,u)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3])))}}class x1 extends rd{constructor(o){super(o),this.current=zs.transparent}set(o,u,f){this.fetchUniformLocation(o,u)&&(f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a)))}}const gy=new Float32Array(16),my=new Float32Array(9),b1=new Float32Array(4);function lg(a){return[lt(255*a.r,255*a.g),lt(255*a.b,255*a.a)]}class ug{constructor(o,u,f){this.value=o,this.uniformNames=u.map(_=>`u_${_}`),this.type=f}setUniform(o,u,f,_,E){u.set(o,E,_.constantOr(this.value))}getBinding(o,u){return"color"===this.type?new x1(o):new ag(o)}}class xf{constructor(o,u){this.uniformNames=u.map(f=>`u_${f}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(o){this.pixelRatio=o.pixelRatio||1,this.pattern=o.tl.concat(o.br)}setUniform(o,u,f,_,E){const S="u_pattern"===E||"u_dash"===E?this.pattern:"u_pixel_ratio"===E?this.pixelRatio:null;S&&u.set(o,E,S)}getBinding(o,u){return"u_pattern"===u||"u_dash"===u?new v1(o):new ag(o)}}class ih{constructor(o,u,f,_){this.expression=o,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(E=>({name:`a_${E}`,type:"Float32",components:"color"===f?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(o,u,f,_,E,S){const M=this.paintVertexArray.length,P=this.expression.evaluate(new V(0),u,{},E,_,S);this.paintVertexArray.resize(o),this._setPaintValue(M,o,P)}updatePaintArray(o,u,f,_,E){const S=this.expression.evaluate({zoom:0},f,_,void 0,E);this._setPaintValue(o,u,S)}_setPaintValue(o,u,f){if("color"===this.type){const _=lg(f);for(let E=o;E<u;E++)this.paintVertexArray.emplace(E,_[0],_[1])}else{for(let _=o;_<u;_++)this.paintVertexArray.emplace(_,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Oc{constructor(o,u,f,_,E,S){this.expression=o,this.uniformNames=u.map(M=>`u_${M}_t`),this.type=f,this.useIntegerZoom=_,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=u.map(M=>({name:`a_${M}`,type:"Float32",components:"color"===f?4:2,offset:0})),this.paintVertexArray=new S}populatePaintArray(o,u,f,_,E,S){const M=this.expression.evaluate(new V(this.zoom),u,{},E,_,S),P=this.expression.evaluate(new V(this.zoom+1),u,{},E,_,S),R=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(R,o,M,P)}updatePaintArray(o,u,f,_,E){const S=this.expression.evaluate({zoom:this.zoom},f,_,void 0,E),M=this.expression.evaluate({zoom:this.zoom+1},f,_,void 0,E);this._setPaintValue(o,u,S,M)}_setPaintValue(o,u,f,_){if("color"===this.type){const E=lg(f),S=lg(_);for(let M=o;M<u;M++)this.paintVertexArray.emplace(M,E[0],E[1],S[0],S[1])}else{for(let E=o;E<u;E++)this.paintVertexArray.emplace(E,f,_);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(_))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,u,f,_,E){const S=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,M=we(this.expression.interpolationFactor(S,this.zoom,this.zoom+1),0,1);u.set(o,E,M)}getBinding(o,u){return new ag(o)}}class id{constructor(o,u,f,_,E){this.expression=o,this.layerId=E,this.paintVertexAttributes=("array"===f?gc:rh).members;for(let S=0;S<u.length;++S);this.paintVertexArray=new _}populatePaintArray(o,u,f){const _=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValues(_,o,u.patterns&&u.patterns[this.layerId],f)}updatePaintArray(o,u,f,_,E,S){this._setPaintValues(o,u,f.patterns&&f.patterns[this.layerId],S)}_setPaintValues(o,u,f,_){if(!_||!f)return;const E=_[f];if(!E)return;const{tl:S,br:M,pixelRatio:P}=E;for(let R=o;R<u;R++)this.paintVertexArray.emplace(R,S[0],S[1],M[0],M[1],P)}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class od{constructor(o,u,f=(()=>!0)){this.binders={},this._buffers=[];const _=[];for(const E in o.paint._values){if(!f(E))continue;const S=o.paint.get(E);if(!(S instanceof Ce&&cc(S.property.specification)))continue;const M=aE(E,o.type),P=S.value,R=S.property.specification.type,z=!!S.property.useIntegerZoom,U="line-dasharray"===E||E.endsWith("pattern"),G="line-dasharray"===E&&"constant"!==o.layout.get("line-cap").value.kind;if("constant"!==P.kind||G)if("source"===P.kind||G||U){const q=Ud(E,R,"source");this.binders[E]=U?new id(P,M,R,q,o.id):new ih(P,M,R,q),_.push(`/a_${E}`)}else{const q=Ud(E,R,"composite");this.binders[E]=new Oc(P,M,R,z,u,q),_.push(`/z_${E}`)}else this.binders[E]=U?new xf(P.value,M):new ug(P.value,M,R),_.push(`/u_${E}`)}this.cacheKey=_.sort().join("")}getMaxValue(o){const u=this.binders[o];return u instanceof ih||u instanceof Oc?u.maxValue:0}populatePaintArrays(o,u,f,_,E,S){for(const M in this.binders){const P=this.binders[M];(P instanceof ih||P instanceof Oc||P instanceof id)&&P.populatePaintArray(o,u,f,_,E,S)}}setConstantPatternPositions(o){for(const u in this.binders){const f=this.binders[u];f instanceof xf&&f.setConstantPatternPositions(o)}}updatePaintArrays(o,u,f,_,E,S){let M=!1;for(const P in o){const R=u.getPositions(P);for(const z of R){const U=f.feature(z.index);for(const G in this.binders){const q=this.binders[G];if((q instanceof ih||q instanceof Oc||q instanceof id)&&!0===q.expression.isStateDependent){const W=_.paint.get(G);q.expression=W.value,q.updatePaintArray(z.start,z.end,U,o[P],E,S),M=!0}}}}return M}defines(){const o=[];for(const u in this.binders){const f=this.binders[u];(f instanceof ug||f instanceof xf)&&o.push(...f.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return o}getBinderAttributes(){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof ih||f instanceof Oc||f instanceof id)for(let _=0;_<f.paintVertexAttributes.length;_++)o.push(f.paintVertexAttributes[_].name)}return o}getBinderUniforms(){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof ug||f instanceof xf||f instanceof Oc)for(const _ of f.uniformNames)o.push(_)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const u=[];for(const f in this.binders){const _=this.binders[f];if(_ instanceof ug||_ instanceof xf||_ instanceof Oc)for(const E of _.uniformNames)u.push({name:E,property:f,binding:_.getBinding(o,E)})}return u}setUniforms(o,u,f,_,E){for(const{name:S,property:M,binding:P}of f)this.binders[M].setUniform(o,P,E,_.get(M),S)}updatePaintBuffers(){this._buffers=[];for(const o in this.binders){const u=this.binders[o];(u instanceof ih||u instanceof Oc||u instanceof id)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(o){for(const u in this.binders){const f=this.binders[u];(f instanceof ih||f instanceof Oc||f instanceof id)&&f.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const u=this.binders[o];(u instanceof ih||u instanceof Oc||u instanceof id)&&u.destroy()}}}class Vd{constructor(o,u,f=(()=>!0)){this.programConfigurations={};for(const _ of o)this.programConfigurations[_.id]=new od(_,u,f);this.needsUpload=!1,this._featureMap=new Pc,this._bufferOffset=0}populatePaintArrays(o,u,f,_,E,S,M){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(o,u,_,E,S,M);void 0!==u.id&&this._featureMap.add(u.id,f,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,u,f,_,E){for(const S of f)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(o,this._featureMap,u,S,_,E)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const _y={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function aE(a,o){return _y[a]||[a.replace(`${o}-`,"").replace(/-/g,"_")]}const lE={"line-pattern":{source:Ft,composite:Ft},"fill-pattern":{source:Ft,composite:Ft},"fill-extrusion-pattern":{source:Ft,composite:Ft},"line-dasharray":{source:Yt,composite:Yt}},Ou={color:{source:pc,composite:mn},number:{source:Lo,composite:pc}};function Ud(a,o,u){const f=lE[a];return f&&f[u]||Ou[o][u]}Tn(ug,"ConstantBinder"),Tn(xf,"PatternConstantBinder"),Tn(ih,"SourceExpressionBinder"),Tn(id,"PatternCompositeBinder"),Tn(Oc,"CompositeExpressionBinder"),Tn(od,"ProgramConfiguration",{omit:["_buffers"]}),Tn(Vd,"ProgramConfigurationSet");const aa="-transition";class oh extends fa{constructor(o,u){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==o.type&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,"background"!==o.type&&"sky"!==o.type&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),u.layout&&(this._unevaluatedLayout=new Re(u.layout)),u.paint)){this._transitionablePaint=new ee(u.paint);for(const f in o.paint)this.setPaintProperty(f,o.paint[f],{validate:!1});for(const f in o.layout)this.setLayoutProperty(f,o.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Le(u.paint)}}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,u,f={}){null!=u&&this._validate(st,`layers.${this.id}.layout.${o}`,o,u,f)||("visibility"!==o?this._unevaluatedLayout.setValue(o,u):this.visibility=u)}getPaintProperty(o){return Dn(o,aa)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,u,f={}){if(null!=u&&this._validate(Pe,`layers.${this.id}.paint.${o}`,o,u,f))return!1;if(Dn(o,aa))return this._transitionablePaint.setTransition(o.slice(0,-11),u||void 0),!1;{const _=this._transitionablePaint._values[o],E=_.value.isDataDriven(),S=_.value;this._transitionablePaint.setValue(o,u),this._handleSpecialPaintPropertyUpdate(o);const M=this._transitionablePaint._values[o].value,P=M.isDataDriven(),R=Dn(o,"pattern")||"line-dasharray"===o;return P||E||R||this._handleOverridablePaintPropertyUpdate(o,S,M)}}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getProgramConfiguration(o){return null}_handleOverridablePaintPropertyUpdate(o,u,f){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,u){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,u)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),bn(o,(u,f)=>!(void 0===u||"layout"===f&&!Object.keys(u).length||"paint"===f&&!Object.keys(u).length))}_validate(o,u,f,_,E={}){return(!E||!1!==E.validate)&&qt(this,o.call(oe,{key:u,layerType:this.type,objectKey:f,value:_,styleSpec:Wt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const u=this.paint.get(o);if(u instanceof Ce&&cc(u.property.specification)&&("source"===u.value.kind||"composite"===u.value.kind)&&u.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=nh(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const uE=xt([{name:"a_pos",components:2,type:"Int16"}],4),cE=xt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Sa{constructor(o=[]){this.segments=o}prepareSegment(o,u,f,_){let E=this.segments[this.segments.length-1];return o>Sa.MAX_VERTEX_ARRAY_LENGTH&&gr(`Max vertices per segment is ${Sa.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!E||E.vertexLength+o>Sa.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==_)&&(E={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},void 0!==_&&(E.sortKey=_),this.segments.push(E)),E}get(){return this.segments}destroy(){for(const o of this.segments)for(const u in o.vaos)o.vaos[u].destroy()}static simpleSegment(o,u,f,_){return new Sa([{vertexOffset:o,primitiveOffset:u,vertexLength:f,primitiveLength:_,vaos:{},sortKey:0}])}}Sa.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Tn(Sa,"SegmentVector");var pr=8192;class sd{constructor(o,u){o&&(u?this.setSouthWest(o).setNorthEast(u):4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof Gi?new Gi(o.lng,o.lat):Gi.convert(o),this}setSouthWest(o){return this._sw=o instanceof Gi?new Gi(o.lng,o.lat):Gi.convert(o),this}extend(o){const u=this._sw,f=this._ne;let _,E;if(o instanceof Gi)_=o,E=o;else{if(!(o instanceof sd))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(sd.convert(o)):this.extend(Gi.convert(o)):"object"==typeof o&&null!==o&&o.hasOwnProperty("lat")&&(o.hasOwnProperty("lon")||o.hasOwnProperty("lng"))?this.extend(Gi.convert(o)):this;if(_=o._sw,E=o._ne,!_||!E)return this}return u||f?(u.lng=Math.min(_.lng,u.lng),u.lat=Math.min(_.lat,u.lat),f.lng=Math.max(E.lng,f.lng),f.lat=Math.max(E.lat,f.lat)):(this._sw=new Gi(_.lng,_.lat),this._ne=new Gi(E.lng,E.lat)),this}getCenter(){return new Gi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Gi(this.getWest(),this.getNorth())}getSouthEast(){return new Gi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:u,lat:f}=Gi.convert(o);let _=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&_}static convert(o){return!o||o instanceof sd?o:new sd(o)}}var bf=1e-6,Xa=typeof Float32Array<"u"?Float32Array:Array;function w1(){var a=new Xa(9);return Xa!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function cg(a,o,u){var f=o[0],_=o[1],E=o[2],S=o[3],M=o[4],P=o[5],R=o[6],z=o[7],U=o[8],G=u[0],q=u[1],W=u[2],re=u[3],ve=u[4],ke=u[5],et=u[6],Be=u[7],Je=u[8];return a[0]=G*f+q*S+W*R,a[1]=G*_+q*M+W*z,a[2]=G*E+q*P+W*U,a[3]=re*f+ve*S+ke*R,a[4]=re*_+ve*M+ke*z,a[5]=re*E+ve*P+ke*U,a[6]=et*f+Be*S+Je*R,a[7]=et*_+Be*M+Je*z,a[8]=et*E+Be*P+Je*U,a}function Zu(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function op(a,o){var u=o[0],f=o[1],_=o[2],E=o[3],S=o[4],M=o[5],P=o[6],R=o[7],z=o[8],U=o[9],G=o[10],q=o[11],W=o[12],re=o[13],ve=o[14],ke=o[15],et=u*M-f*S,Be=u*P-_*S,Je=u*R-E*S,nt=f*P-_*M,ot=f*R-E*M,zt=_*R-E*P,Rt=z*re-U*W,Xt=z*ve-G*W,_n=z*ke-q*W,jt=U*ve-G*re,tn=U*ke-q*re,nn=G*ke-q*ve,dn=et*nn-Be*tn+Je*jt+nt*_n-ot*Xt+zt*Rt;return dn?(a[0]=(M*nn-P*tn+R*jt)*(dn=1/dn),a[1]=(_*tn-f*nn-E*jt)*dn,a[2]=(re*zt-ve*ot+ke*nt)*dn,a[3]=(G*ot-U*zt-q*nt)*dn,a[4]=(P*_n-S*nn-R*Xt)*dn,a[5]=(u*nn-_*_n+E*Xt)*dn,a[6]=(ve*Je-W*zt-ke*Be)*dn,a[7]=(z*zt-G*Je+q*Be)*dn,a[8]=(S*tn-M*_n+R*Rt)*dn,a[9]=(f*_n-u*tn-E*Rt)*dn,a[10]=(W*ot-re*Je+ke*et)*dn,a[11]=(U*Je-z*ot-q*et)*dn,a[12]=(M*Xt-S*jt-P*Rt)*dn,a[13]=(u*jt-f*Xt+_*Rt)*dn,a[14]=(re*Be-W*nt-ve*et)*dn,a[15]=(z*nt-U*Be+G*et)*dn,a):null}function ad(a,o,u){var f=o[0],_=o[1],E=o[2],S=o[3],M=o[4],P=o[5],R=o[6],z=o[7],U=o[8],G=o[9],q=o[10],W=o[11],re=o[12],ve=o[13],ke=o[14],et=o[15],Be=u[0],Je=u[1],nt=u[2],ot=u[3];return a[0]=Be*f+Je*M+nt*U+ot*re,a[1]=Be*_+Je*P+nt*G+ot*ve,a[2]=Be*E+Je*R+nt*q+ot*ke,a[3]=Be*S+Je*z+nt*W+ot*et,a[4]=(Be=u[4])*f+(Je=u[5])*M+(nt=u[6])*U+(ot=u[7])*re,a[5]=Be*_+Je*P+nt*G+ot*ve,a[6]=Be*E+Je*R+nt*q+ot*ke,a[7]=Be*S+Je*z+nt*W+ot*et,a[8]=(Be=u[8])*f+(Je=u[9])*M+(nt=u[10])*U+(ot=u[11])*re,a[9]=Be*_+Je*P+nt*G+ot*ve,a[10]=Be*E+Je*R+nt*q+ot*ke,a[11]=Be*S+Je*z+nt*W+ot*et,a[12]=(Be=u[12])*f+(Je=u[13])*M+(nt=u[14])*U+(ot=u[15])*re,a[13]=Be*_+Je*P+nt*G+ot*ve,a[14]=Be*E+Je*R+nt*q+ot*ke,a[15]=Be*S+Je*z+nt*W+ot*et,a}function sp(a,o,u){var f,_,E,S,M,P,R,z,U,G,q,W,re=u[0],ve=u[1],ke=u[2];return o===a?(a[12]=o[0]*re+o[4]*ve+o[8]*ke+o[12],a[13]=o[1]*re+o[5]*ve+o[9]*ke+o[13],a[14]=o[2]*re+o[6]*ve+o[10]*ke+o[14],a[15]=o[3]*re+o[7]*ve+o[11]*ke+o[15]):(_=o[1],E=o[2],S=o[3],M=o[4],P=o[5],R=o[6],z=o[7],U=o[8],G=o[9],q=o[10],W=o[11],a[0]=f=o[0],a[1]=_,a[2]=E,a[3]=S,a[4]=M,a[5]=P,a[6]=R,a[7]=z,a[8]=U,a[9]=G,a[10]=q,a[11]=W,a[12]=f*re+M*ve+U*ke+o[12],a[13]=_*re+P*ve+G*ke+o[13],a[14]=E*re+R*ve+q*ke+o[14],a[15]=S*re+z*ve+W*ke+o[15]),a}function jd(a,o,u){var f=u[0],_=u[1],E=u[2];return a[0]=o[0]*f,a[1]=o[1]*f,a[2]=o[2]*f,a[3]=o[3]*f,a[4]=o[4]*_,a[5]=o[5]*_,a[6]=o[6]*_,a[7]=o[7]*_,a[8]=o[8]*E,a[9]=o[9]*E,a[10]=o[10]*E,a[11]=o[11]*E,a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15],a}function yy(a,o,u){var f=Math.sin(u),_=Math.cos(u),E=o[4],S=o[5],M=o[6],P=o[7],R=o[8],z=o[9],U=o[10],G=o[11];return o!==a&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[4]=E*_+R*f,a[5]=S*_+z*f,a[6]=M*_+U*f,a[7]=P*_+G*f,a[8]=R*_-E*f,a[9]=z*_-S*f,a[10]=U*_-M*f,a[11]=G*_-P*f,a}function ld(a,o,u){var f=Math.sin(u),_=Math.cos(u),E=o[0],S=o[1],M=o[2],P=o[3],R=o[8],z=o[9],U=o[10],G=o[11];return o!==a&&(a[4]=o[4],a[5]=o[5],a[6]=o[6],a[7]=o[7],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=E*_-R*f,a[1]=S*_-z*f,a[2]=M*_-U*f,a[3]=P*_-G*f,a[8]=E*f+R*_,a[9]=S*f+z*_,a[10]=M*f+U*_,a[11]=P*f+G*_,a}function ap(a,o){return a[0]=o[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=o[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function E1(a,o,u){var f,_,E,S=u[0],M=u[1],P=u[2],R=Math.hypot(S,M,P);return R<bf?null:(S*=R=1/R,M*=R,P*=R,f=Math.sin(o),_=Math.cos(o),a[0]=S*S*(E=1-_)+_,a[1]=M*S*E+P*f,a[2]=P*S*E-M*f,a[3]=0,a[4]=S*M*E-P*f,a[5]=M*M*E+_,a[6]=P*M*E+S*f,a[7]=0,a[8]=S*P*E+M*f,a[9]=M*P*E-S*f,a[10]=P*P*E+_,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}Math.hypot||(Math.hypot=function(){for(var a=0,o=arguments.length;o--;)a+=arguments[o]*arguments[o];return Math.sqrt(a)});var kI=ad;function hg(){var a=new Xa(3);return Xa!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function hE(a){var o=new Xa(3);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o}function dg(a){return Math.hypot(a[0],a[1],a[2])}function lp(a,o,u){var f=new Xa(3);return f[0]=a,f[1]=o,f[2]=u,f}function Gd(a,o,u){return a[0]=o[0]+u[0],a[1]=o[1]+u[1],a[2]=o[2]+u[2],a}function C1(a,o,u){return a[0]=o[0]-u[0],a[1]=o[1]-u[1],a[2]=o[2]-u[2],a}function vy(a,o,u){return a[0]=o[0]*u[0],a[1]=o[1]*u[1],a[2]=o[2]*u[2],a}function $d(a,o,u){return a[0]=Math.min(o[0],u[0]),a[1]=Math.min(o[1],u[1]),a[2]=Math.min(o[2],u[2]),a}function fg(a,o,u){return a[0]=Math.max(o[0],u[0]),a[1]=Math.max(o[1],u[1]),a[2]=Math.max(o[2],u[2]),a}function vu(a,o,u){return a[0]=o[0]*u,a[1]=o[1]*u,a[2]=o[2]*u,a}function wf(a,o,u,f){return a[0]=o[0]+u[0]*f,a[1]=o[1]+u[1]*f,a[2]=o[2]+u[2]*f,a}function _l(a,o){var u=o[0],f=o[1],_=o[2],E=u*u+f*f+_*_;return E>0&&(E=1/Math.sqrt(E)),a[0]=o[0]*E,a[1]=o[1]*E,a[2]=o[2]*E,a}function sh(a,o){return a[0]*o[0]+a[1]*o[1]+a[2]*o[2]}function Em(a,o,u){var f=o[0],_=o[1],E=o[2],S=u[0],M=u[1],P=u[2];return a[0]=_*P-E*M,a[1]=E*S-f*P,a[2]=f*M-_*S,a}function ea(a,o,u){var f=o[0],_=o[1],E=o[2],S=u[3]*f+u[7]*_+u[11]*E+u[15];return a[0]=(u[0]*f+u[4]*_+u[8]*E+u[12])/(S=S||1),a[1]=(u[1]*f+u[5]*_+u[9]*E+u[13])/S,a[2]=(u[2]*f+u[6]*_+u[10]*E+u[14])/S,a}function S1(a,o,u){var f=u[0],_=u[1],E=u[2],S=o[0],M=o[1],P=o[2],R=_*P-E*M,z=E*S-f*P,U=f*M-_*S,G=_*U-E*z,q=E*R-f*U,W=f*z-_*R,re=2*u[3];return z*=re,U*=re,q*=2,W*=2,a[0]=S+(R*=re)+(G*=2),a[1]=M+z+q,a[2]=P+U+W,a}var Xu,ah=C1,Cm=vy,xy=dg;function by(a,o,u){return a[0]=o[0]*u,a[1]=o[1]*u,a[2]=o[2]*u,a[3]=o[3]*u,a}function Sm(a,o){var u=o[0],f=o[1],_=o[2],E=o[3],S=u*u+f*f+_*_+E*E;return S>0&&(S=1/Math.sqrt(S)),a[0]=u*S,a[1]=f*S,a[2]=_*S,a[3]=E*S,a}function ud(a,o,u){var f=o[0],_=o[1],E=o[2],S=o[3];return a[0]=u[0]*f+u[4]*_+u[8]*E+u[12]*S,a[1]=u[1]*f+u[5]*_+u[9]*E+u[13]*S,a[2]=u[2]*f+u[6]*_+u[10]*E+u[14]*S,a[3]=u[3]*f+u[7]*_+u[11]*E+u[15]*S,a}function D1(){var a=new Xa(4);return Xa!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function wy(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Ey(a,o,u){u*=.5;var f=o[0],_=o[1],E=o[2],S=o[3],M=Math.sin(u),P=Math.cos(u);return a[0]=f*P+S*M,a[1]=_*P+E*M,a[2]=E*P-_*M,a[3]=S*P-f*M,a}function Cy(a,o,u){u*=.5;var f=o[0],_=o[1],E=o[2],S=o[3],M=Math.sin(u),P=Math.cos(u);return a[0]=f*P-E*M,a[1]=_*P+S*M,a[2]=E*P+f*M,a[3]=S*P-_*M,a}hg(),Xu=new Xa(4),Xa!=Float32Array&&(Xu[0]=0,Xu[1]=0,Xu[2]=0,Xu[3]=0);var T1=Sm;hg(),lp(1,0,0),lp(0,1,0),D1(),D1(),w1();const dE=xt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:pg}=dE,Hd=xt([{name:"a_pos_3",components:3,type:"Int16"}]);var gg=xt([{name:"a_pos",type:"Int16",components:2}]);class Dm{constructor(o,u){this.pos=o,this.dir=u}intersectsPlane(o,u,f){const _=sh(u,this.dir);if(Math.abs(_)<1e-6)return!1;const E=((o[0]-this.pos[0])*u[0]+(o[1]-this.pos[1])*u[1]+(o[2]-this.pos[2])*u[2])/_;return f[0]=this.pos[0]+this.dir[0]*E,f[1]=this.pos[1]+this.dir[1]*E,f[2]=this.pos[2]+this.dir[2]*E,!0}closestPointOnSphere(o,u,f){if(re=(q=this.pos)[0],ve=q[1],ke=q[2],et=(W=o)[0],Be=W[1],Je=W[2],Math.abs(re-et)<=bf*Math.max(1,Math.abs(re),Math.abs(et))&&Math.abs(ve-Be)<=bf*Math.max(1,Math.abs(ve),Math.abs(Be))&&Math.abs(ke-Je)<=bf*Math.max(1,Math.abs(ke),Math.abs(Je))||0===u)return f[0]=f[1]=f[2]=0,!1;var q,W,re,ve,ke,et,Be,Je;const[_,E,S]=this.dir,M=this.pos[0]-o[0],P=this.pos[1]-o[1],R=this.pos[2]-o[2],z=_*_+E*E+S*S,U=2*(M*_+P*E+R*S),G=U*U-4*z*(M*M+P*P+R*R-u*u);if(G<0){const q=Math.max(-U/2,0),W=M+_*q,re=P+E*q,ve=R+S*q,ke=Math.hypot(W,re,ve);return f[0]=W*u/ke,f[1]=re*u/ke,f[2]=ve*u/ke,!1}{const q=(-U-Math.sqrt(G))/(2*z);if(q<0){const W=Math.hypot(M,P,R);return f[0]=M*u/W,f[1]=P*u/W,f[2]=R*u/W,!1}return f[0]=M+_*q,f[1]=P+E*q,f[2]=R+S*q,!0}}}class Tm{constructor(o,u,f,_,E){this.TL=o,this.TR=u,this.BR=f,this.BL=_,this.horizon=E}static fromInvProjectionMatrix(o,u,f){const _=[-1,1,1],E=[1,1,1],S=[1,-1,1],M=[-1,-1,1],P=ea(_,_,o),R=ea(E,E,o),z=ea(S,S,o),U=ea(M,M,o);return new Tm(P,R,z,U,u/f)}}class qd{constructor(o,u){this.points=o,this.planes=u}static fromInvProjectionMatrix(o,u,f,_){const E=Math.pow(2,f),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const R=ud([],P,o),z=1/R[3]/u*E;return(U=R)[0]=(G=R)[0]*(q=[z,z,_?1/R[3]:z,z])[0],U[1]=G[1]*q[1],U[2]=G[2]*q[2],U[3]=G[3]*q[3],U;var U,G,q}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const R=_l([],Em([],ah([],S[P[0]],S[P[1]]),ah([],S[P[2]],S[P[1]]))),z=-sh(R,S[P[1]]);return R.concat(z)});return new qd(S,M)}}class xu{static fromPoints(o){const u=[1/0,1/0,1/0],f=[-1/0,-1/0,-1/0];for(const _ of o)$d(u,u,_),fg(f,f,_);return new xu(u,f)}static applyTransform(o,u){const f=o.getCorners();for(let _=0;_<f.length;++_)ea(f[_],f[_],u);return xu.fromPoints(f)}constructor(o,u){this.min=o,this.max=u,this.center=vu([],Gd([],this.min,this.max),.5)}quadrant(o){const u=[o%2==0,o<2],f=hE(this.min),_=hE(this.max);for(let E=0;E<u.length;E++)f[E]=u[E]?this.min[E]:this.center[E],_[E]=u[E]?this.center[E]:this.max[E];return _[2]=this.max[2],new xu(f,_)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,u=this.max;return[[o[0],o[1],o[2]],[u[0],o[1],o[2]],[u[0],u[1],o[2]],[o[0],u[1],o[2]],[o[0],o[1],u[2]],[u[0],o[1],u[2]],[u[0],u[1],u[2]],[o[0],u[1],u[2]]]}intersects(o){const u=this.getCorners();let f=!0;for(let _=0;_<o.planes.length;_++){const E=o.planes[_];let S=0;for(let M=0;M<u.length;M++)S+=sh(E,u[M])+E[3]>=0;if(0===S)return 0;S!==u.length&&(f=!1)}if(f)return 2;for(let _=0;_<3;_++){let E=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let M=0;M<o.points.length;M++){const P=o.points[M][_]-this.min[_];E=Math.min(E,P),S=Math.max(S,P)}if(S<0||E>this.max[_]-this.min[_])return 0}return 1}}const Da=5,Im=6,Ih=pr/Math.PI/2,I1=16383,Mh=[64,32,16],eu=-Ih,tu=Ih,M1=[new xu([eu,eu,eu],[tu,tu,tu]),new xu([eu,eu,eu],[0,0,tu]),new xu([0,eu,eu],[tu,0,tu]),new xu([eu,0,eu],[0,tu,tu]),new xu([0,0,eu],[tu,tu,tu])];function up(a){return a*Ih/Am}function Ef(a,o,u,f=!0){const _=vu([],a._camera.position,a.worldSize),E=[o,u,1,1];ud(E,E,a.pixelMatrixInverse),by(E,E,1/E[3]);const S=_l([],ah([],E,_)),M=a.globeMatrix,P=[M[12],M[13],M[14]],R=ah([],P,_),z=dg(R),U=_l([],R),G=a.worldSize/(2*Math.PI),q=sh(U,S),W=Math.asin(G/z);if(W<Math.acos(q)){if(!f)return null;const _n=[],jt=[];vu(_n,S,z/q),_l(jt,ah(jt,_n,R)),_l(S,Gd(S,R,vu(S,jt,Math.tan(W)*z)))}const re=[];new Dm(_,S).closestPointOnSphere(P,G,re);const ve=_l([],xe(M,0)),ke=_l([],xe(M,1)),et=_l([],xe(M,2)),Be=sh(ve,re),Je=sh(ke,re),nt=sh(et,re),ot=Ve(Math.asin(-Je/G));let zt=Ve(Math.atan2(Be,nt));zt=a.center.lng+function(_n,jt){const tn=(jt-_n+180)%360-180;return tn<-180?tn+360:tn}(a.center.lng,zt);const Rt=lh(zt),Xt=we(Nh(ot),0,1);return new hd(Rt,Xt)}class FI{constructor(o,u,f){this.a=ah([],o,f),this.b=ah([],u,f),this.center=f;const _=_l([],this.a),E=_l([],this.b);this.angle=Math.acos(sh(_,E))}}function Sy(a,o){if(0===a.angle)return null;let u;return u=0===a.a[o]?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[o]/a.a[o]/Math.sin(a.angle)-1/Math.tan(a.angle)),u<0||u>1?null:function(f,_,E,S){const M=Math.sin(E);return f*(Math.sin((1-S)*E)/M)+_*(Math.sin(S*E)/M)}(a.a[o],a.b[o],a.angle,we(u,0,1))+a.center[o]}function cd(a){if(a.z<=1)return M1[a.z+2*a.y+a.x];const o=Wd(Dy(a));return xu.fromPoints(o)}function cp(a,o,u){return vu(a,a,1-u),wf(a,a,o,u)}function fE(a,o){const u=Cf(o.zoom);if(0===u)return cd(a);const f=Dy(a),_=Wd(f),E=lh(f.getWest())*o.worldSize,S=lh(f.getEast())*o.worldSize,M=Nh(f.getNorth())*o.worldSize,P=Nh(f.getSouth())*o.worldSize,R=[E,M,0],z=[S,M,0],U=[E,P,0],G=[S,P,0],q=op([],o.globeMatrix);return ea(R,R,q),ea(z,z,q),ea(U,U,q),ea(G,G,q),_[0]=cp(_[0],U,u),_[1]=cp(_[1],G,u),_[2]=cp(_[2],z,u),_[3]=cp(_[3],R,u),xu.fromPoints(_)}function pE(a,o,u){for(const f of a)ea(f,f,o),vu(f,f,u)}function Dy({x:a,y:o,z:u}){const f=1/(1<<u),_=new Gi(_c(a*f),Rl((o+1)*f)),E=new Gi(_c((a+1)*f),Rl(o*f));return new sd(_,E)}function Wd(a){const o=rt(a.getNorth()),u=rt(a.getSouth()),f=Math.cos(o),_=Math.cos(u),E=Math.sin(o),S=Math.sin(u),M=a.getWest(),P=a.getEast();return[hp(_,S,M),hp(_,S,P),hp(f,E,P),hp(f,E,M)]}function hp(a,o,u,f=Ih){return u=rt(u),[a*Math.sin(u)*f,-o*f,a*Math.cos(u)*f]}function dp(a,o,u){return hp(Math.cos(rt(a)),Math.sin(rt(a)),o,u)}function Ta(a,o,u,f){const _=1<<u.z,E=(a/pr+u.x)/_;return dp(Rl((o/pr+u.y)/_),_c(E),f)}function Mm({min:a,max:o}){return I1/Math.max(o[0]-a[0],o[1]-a[1],o[2]-a[2])}const fp=new Float64Array(16);function mg(a){const o=Mm(a),u=ap(fp,[o,o,o]);return sp(u,u,((f=[])[0]=-(_=a.min)[0],f[1]=-_[1],f[2]=-_[2],f));var f,_}function Yu(a){const o=(f=a.min,(u=fp)[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=f[0],u[13]=f[1],u[14]=f[2],u[15]=1,u);var u,f;const _=1/Mm(a);return jd(o,o,[_,_,_])}function pp(a,o,u,f,_){const E=function(P){const R=pr/(2*Math.PI);return P/(2*Math.PI)/R}(u),S=[a,o,-u/(2*Math.PI)],M=Zu(new Float64Array(16));return sp(M,M,S),jd(M,M,[E,E,E]),yy(M,M,rt(-_)),ld(M,M,rt(-f)),M}function Cf(a){return at(Da,Im,a)}function _g(a,o){const u=dp(o.lat,o.lng);return S=(_=C1([],function(W){const re=dp(W._center.lat,W._center.lng);let ve=Em([],lp(0,1,0),re);const ke=E1([],-W.angle,re);ve=ea(ve,ve,ke),E1(ke,-W._pitch,ve);const et=_l([],re);return vu(et,et,up(W.cameraToCenterDistance/W.pixelsPerMeter)),ea(et,et,ke),Gd([],re,et)}(a),u))[0],M=_[1],P=_[2],R=(E=u)[0],z=E[1],U=E[2],q=(G=Math.sqrt(S*S+M*M+P*P)*Math.sqrt(R*R+z*z+U*U))&&sh(_,E)/G,Math.acos(Math.min(Math.max(q,-1),1));var _,E,S,M,P,R,z,U,G,q}function Sf(a,o){return _g(a,o)>Math.PI/2*1.01}const A1=rt(85),zI=Math.cos(A1),gE=Math.sin(A1),Am=6371008.8,Ku=2*Math.PI*Am;class Ah{constructor(o,u){if(isNaN(o)||isNaN(u))throw new Error(`Invalid LngLat object: (${o}, ${u})`);if(this.lng=+o,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ah(Ae(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const u=Math.PI/180,f=this.lat*u,_=o.lat*u,E=Math.sin(f)*Math.sin(_)+Math.cos(f)*Math.cos(_)*Math.cos((o.lng-this.lng)*u);return Am*Math.acos(Math.min(E,1))}toBounds(o=0){const u=360*o/40075017,f=u/Math.cos(Math.PI/180*this.lat);return new sd(new Ah(this.lng-f,this.lat-u),new Ah(this.lng+f,this.lat+u))}toEcef(o){const u=up(o);return dp(this.lat,this.lng,Ih+u)}static convert(o){if(o instanceof Ah)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new Ah(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new Ah(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Gi=Ah;function N1(a){return Ku*Math.cos(a*Math.PI/180)}function lh(a){return(180+a)/360}function Nh(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function uh(a,o){return a/N1(o)}function _c(a){return 360*a-180}function Rl(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function P1(a,o){return a*N1(Rl(o))}const Ol=85.051129;function Nm(a){return 1/Math.cos(a*Math.PI/180)}class hd{constructor(o,u,f=0){this.x=+o,this.y=+u,this.z=+f}static fromLngLat(o,u=0){const f=Gi.convert(o);return new hd(lh(f.lng),Nh(f.lat),uh(u,f.lat))}toLngLat(){return new Gi(_c(this.x),Rl(this.y))}toAltitude(){return P1(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ku*Nm(Rl(this.y))}}function Ty(a,o,u,f,_,E,S,M,P){const R=(o+f)/2,z=(u+_)/2,U=new ne(R,z);M(U),function(G,q,W,re,ve,ke){const et=W-ve,Be=re-ke;return Math.abs((re-q)*et-(W-G)*Be)/Math.hypot(et,Be)}(U.x,U.y,E.x,E.y,S.x,S.y)>=P?(Ty(a,o,u,R,z,E,U,M,P),Ty(a,R,z,f,_,U,S,M,P)):a.push(S)}function yg(a,o,u){let f=a[0],_=f.x,E=f.y;o(f);const S=[f];for(let M=1;M<a.length;M++){const P=a[M],{x:R,y:z}=P;o(P),Ty(S,_,E,R,z,f,P,o,u),_=R,E=z,f=P}return S}function Iy(a,o,u,f){if(f(o,u)){const _=o.add(u)._mult(.5);Iy(a,o,_,f),Iy(a,_,u,f)}else a.push(u)}function Pm(a,o){let u=a[0];const f=[u];for(let _=1;_<a.length;_++){const E=a[_];Iy(f,u,E,o),u=E}return f}const My=Math.pow(2,14)-1,Ay=-My-1;function Ny(a,o){const u=Math.round(a.x*o),f=Math.round(a.y*o);return a.x=we(u,Ay,My),a.y=we(f,Ay,My),(u<a.x||u>a.x+1||f<a.y||f>a.y+1)&&gr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function Lc(a,o,u){const f=a.loadGeometry(),_=a.extent,E=pr/_;if(o&&u&&u.projection.isReprojectedInTileSpace){const S=1<<o.z,{scale:M,x:P,y:R,projection:z}=u,U=G=>{const q=_c((o.x+G.x/_)/S),W=Rl((o.y+G.y/_)/S),re=z.project(q,W);G.x=(re.x*M-P)*_,G.y=(re.y*M-R)*_};for(let G=0;G<f.length;G++)if(1!==a.type)f[G]=yg(f[G],U,1);else{const q=[];for(const W of f[G])W.x<0||W.x>=_||W.y<0||W.y>=_||(U(W),q.push(W));f[G]=q}}for(const S of f)for(const M of S)Ny(M,E);return f}function Zd(a,o){return{type:a.type,id:a.id,properties:a.properties,geometry:o?Lc(a):[]}}function Rm(a,o,u,f,_){a.emplaceBack(2*o+(f+1)/2,2*u+(_+1)/2)}function Om(a,o,u){a.emplaceBack(o.x,o.y,o.z,16384*u[0],16384*u[1],16384*u[2])}class Xd{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new Qt,this.indexArray=new nr,this.segments=new Sa,this.programConfigurations=new Vd(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,f,_){const E=this.layers[0],S=[];let M=null;"circle"===E.type&&(M=E.layout.get("circle-sort-key"));for(const{feature:R,id:z,index:U,sourceLayerIndex:G}of o){const q=this.layers[0]._featureFilter.needGeometry,W=Zd(R,q);if(!this.layers[0]._featureFilter.filter(new V(this.zoom),W,f))continue;const re=M?M.evaluate(W,{},f):void 0,ve={id:z,properties:R.properties,type:R.type,sourceLayerIndex:G,index:U,geometry:q?W.geometry:Lc(R,f,_),patterns:{},sortKey:re};S.push(ve)}M&&S.sort((R,z)=>R.sortKey-z.sortKey);let P=null;"globe"===_.projection.name&&(this.globeExtVertexArray=new an,P=_.projection);for(const R of S){const{geometry:z,index:U,sourceLayerIndex:G}=R,q=o[U].feature;this.addFeature(R,z,U,u.availableImages,f,P),u.featureIndex.insert(q,z,U,G,this.index)}}update(o,u,f,_){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f,_)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,uE.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,cE.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,u,f,_,E,S){for(const M of u)for(const P of M){const R=P.x,z=P.y;if(R<0||R>=pr||z<0||z>=pr)continue;if(S){const q=S.projectTilePoint(R,z,E),W=S.upVector(E,R,z),re=this.globeExtVertexArray;Om(re,q,W),Om(re,q,W),Om(re,q,W),Om(re,q,W)}const U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),G=U.vertexLength;Rm(this.layoutVertexArray,R,z,-1,-1),Rm(this.layoutVertexArray,R,z,1,-1),Rm(this.layoutVertexArray,R,z,1,1),Rm(this.layoutVertexArray,R,z,-1,1),this.indexArray.emplaceBack(G,G+1,G+2),this.indexArray.emplaceBack(G,G+2,G+3),U.vertexLength+=4,U.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,{},_,E)}}function gp(a,o){for(let u=0;u<a.length;u++)if(Ph(o,a[u]))return!0;for(let u=0;u<o.length;u++)if(Ph(a,o[u]))return!0;return!!Py(a,o)}function mE(a,o,u){return!!Ph(a,o)||!!Ry(o,a,u)}function _E(a,o){if(1===a.length)return L1(o,a[0]);for(let u=0;u<o.length;u++){const f=o[u];for(let _=0;_<f.length;_++)if(Ph(a,f[_]))return!0}for(let u=0;u<a.length;u++)if(L1(o,a[u]))return!0;for(let u=0;u<o.length;u++)if(Py(a,o[u]))return!0;return!1}function R1(a,o,u){if(a.length>1){if(Py(a,o))return!0;for(let f=0;f<o.length;f++)if(Ry(o[f],a,u))return!0}for(let f=0;f<a.length;f++)if(Ry(a[f],o,u))return!0;return!1}function Py(a,o){if(0===a.length||0===o.length)return!1;for(let u=0;u<a.length-1;u++){const f=a[u],_=a[u+1];for(let E=0;E<o.length-1;E++)if(VI(f,_,o[E],o[E+1]))return!0}return!1}function VI(a,o,u,f){return ii(a,u,f)!==ii(o,u,f)&&ii(a,o,u)!==ii(a,o,f)}function Ry(a,o,u){const f=u*u;if(1===o.length)return a.distSqr(o[0])<f;for(let _=1;_<o.length;_++)if(O1(a,o[_-1],o[_])<f)return!0;return!1}function O1(a,o,u){const f=o.distSqr(u);if(0===f)return a.distSqr(o);const _=((a.x-o.x)*(u.x-o.x)+(a.y-o.y)*(u.y-o.y))/f;return a.distSqr(_<0?o:_>1?u:u.sub(o)._mult(_)._add(o))}function L1(a,o){let u,f,_,E=!1;for(let S=0;S<a.length;S++){u=a[S];for(let M=0,P=u.length-1;M<u.length;P=M++)f=u[M],_=u[P],f.y>o.y!=_.y>o.y&&o.x<(_.x-f.x)*(o.y-f.y)/(_.y-f.y)+f.x&&(E=!E)}return E}function Ph(a,o){let u=!1;for(let f=0,_=a.length-1;f<a.length;_=f++){const E=a[f],S=a[_];E.y>o.y!=S.y>o.y&&o.x<(S.x-E.x)*(o.y-E.y)/(S.y-E.y)+E.x&&(u=!u)}return u}function Oy(a,o,u,f,_){for(const S of a)if(o<=S.x&&u<=S.y&&f>=S.x&&_>=S.y)return!0;const E=[new ne(o,u),new ne(o,_),new ne(f,_),new ne(f,u)];if(a.length>2)for(const S of E)if(Ph(a,S))return!0;for(let S=0;S<a.length-1;S++)if(yE(a[S],a[S+1],E))return!0;return!1}function yE(a,o,u){const f=u[0],_=u[2];if(a.x<f.x&&o.x<f.x||a.x>_.x&&o.x>_.x||a.y<f.y&&o.y<f.y||a.y>_.y&&o.y>_.y)return!1;const E=ii(a,o,u[0]);return E!==ii(a,o,u[1])||E!==ii(a,o,u[2])||E!==ii(a,o,u[3])}function Df(a,o,u){const f=o.paint.get(a).value;return"constant"===f.kind?f.value:u.programConfigurations.get(o.id).getMaxValue(a)}function Ly(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function ky(a,o,u,f,_){if(!o[0]&&!o[1])return a;const E=ne.convert(o)._mult(_);"viewport"===u&&E._rotate(-f);const S=[];for(let M=0;M<a.length;M++)S.push(a[M].sub(E));return S}function vE(a,o,u,f){const _=ne.convert(a)._mult(f);return"viewport"===o&&_._rotate(-u),_}Tn(Xd,"CircleBucket",{omit:["layers"]});const xE=new He({"circle-sort-key":new Se(Wt.layout_circle["circle-sort-key"])});var bE={paint:new He({"circle-radius":new Se(Wt.paint_circle["circle-radius"]),"circle-color":new Se(Wt.paint_circle["circle-color"]),"circle-blur":new Se(Wt.paint_circle["circle-blur"]),"circle-opacity":new Se(Wt.paint_circle["circle-opacity"]),"circle-translate":new te(Wt.paint_circle["circle-translate"]),"circle-translate-anchor":new te(Wt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new te(Wt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new te(Wt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Se(Wt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Se(Wt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Se(Wt.paint_circle["circle-stroke-opacity"])}),layout:xE};function Lm(a,o,u,f,_,E,S,M,P){if(E&&a.queryGeometry.isAboveHorizon)return!1;E&&(P*=a.pixelToTileUnitsFactor);const R=a.tileID.canonical,z=u.projection.upVectorScale(R,u.center.lat,u.worldSize).metersToTile;for(const U of o)for(const G of U){const q=G.add(M),W=_&&u.elevation?u.elevation.exaggeration()*_.getElevationAt(q.x,q.y,!0):0,re=u.projection.projectTilePoint(q.x,q.y,R);if(W>0){const Be=u.projection.upVector(R,q.x,q.y);re.x+=Be[0]*z*W,re.y+=Be[1]*z*W,re.z+=Be[2]*z*W}const ve=E?q:UI(re.x,re.y,re.z,f),ke=E?a.tilespaceRays.map(Be=>jI(Be,W)):a.queryGeometry.screenGeometry,et=ud([],[re.x,re.y,re.z,1],f);if(!S&&E?P*=et[3]/u.cameraToCenterDistance:S&&!E&&(P*=u.cameraToCenterDistance/et[3]),E){const Be=Rl((G.y/pr+R.y)/(1<<R.z));P/=u.projection.pixelsPerMeter(Be,1)/uh(1,Be)}if(mE(ke,ve,P))return!0}return!1}function UI(a,o,u,f){const _=ud([],[a,o,u,1],f);return new ne(_[0]/_[3],_[1]/_[3])}const wE=lp(0,0,0),Fy=lp(0,0,1);function jI(a,o){const u=hg();return wE[2]=o,a.intersectsPlane(wE,Fy,u),new ne(u[0],u[1])}class EE extends Xd{}function CE(a,{width:o,height:u},f,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==o*u*f)throw new RangeError("mismatched image size")}else _=new Uint8Array(o*u*f);return a.width=o,a.height=u,a.data=_,a}function SE(a,o,u){const{width:f,height:_}=o;f===a.width&&_===a.height||(k1(a,o,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,f),height:Math.min(a.height,_)},u),a.width=f,a.height=_,a.data=o.data)}function k1(a,o,u,f,_,E){if(0===_.width||0===_.height)return o;if(_.width>a.width||_.height>a.height||u.x>a.width-_.width||u.y>a.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>o.width||_.height>o.height||f.x>o.width-_.width||f.y>o.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const S=a.data,M=o.data;for(let P=0;P<_.height;P++){const R=((u.y+P)*a.width+u.x)*E,z=((f.y+P)*o.width+f.x)*E;for(let U=0;U<_.width*E;U++)M[z+U]=S[R+U]}return o}Tn(EE,"HeatmapBucket",{omit:["layers"]});class dd{constructor(o,u){CE(this,o,1,u)}resize(o){SE(this,new dd(o),1)}clone(){return new dd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,u,f,_,E){k1(o,u,f,_,E,1)}}class nu{constructor(o,u){CE(this,o,4,u)}resize(o){SE(this,new nu(o),4)}replace(o,u){u?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new nu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,u,f,_,E){k1(o,u,f,_,E,4)}}Tn(dd,"AlphaImage"),Tn(nu,"RGBAImage");var km={paint:new He({"heatmap-radius":new Se(Wt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Se(Wt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new te(Wt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ue(Wt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new te(Wt.paint_heatmap["heatmap-opacity"])})};function Fm(a){const o={},u=a.resolution||256,f=a.clips?a.clips.length:1,_=a.image||new nu({width:u,height:f}),E=(S,M,P)=>{o[a.evaluationKey]=P;const R=a.expression.evaluate(o);_.data[S+M+0]=Math.floor(255*R.r/R.a),_.data[S+M+1]=Math.floor(255*R.g/R.a),_.data[S+M+2]=Math.floor(255*R.b/R.a),_.data[S+M+3]=Math.floor(255*R.a)};if(a.clips)for(let S=0,M=0;S<f;++S,M+=4*u)for(let P=0,R=0;P<u;P++,R+=4){const z=P/(u-1),{start:U,end:G}=a.clips[S];E(M,R,U*(1-z)+G*z)}else for(let S=0,M=0;S<u;S++,M+=4)E(0,M,S/(u-1));return _}var F1={paint:new He({"hillshade-illumination-direction":new te(Wt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new te(Wt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new te(Wt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new te(Wt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new te(Wt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new te(Wt.paint_hillshade["hillshade-accent-color"])})};const B1=xt([{name:"a_pos",components:2,type:"Int16"}],4),{members:mp}=B1;var Bm={exports:{}};function vg(a,o,u){u=u||2;var f,_,E,S,M,P,R,z=o&&o.length,U=z?o[0]*u:a.length,G=xg(a,0,U,u,!0),q=[];if(!G||G.next===G.prev)return q;if(z&&(G=function(re,ve,ke,et){var Be,Je,nt,ot=[];for(Be=0,Je=ve.length;Be<Je;Be++)(nt=xg(re,ve[Be]*et,Be<Je-1?ve[Be+1]*et:re.length,et,!1))===nt.next&&(nt.steiner=!0),ot.push(V1(nt));for(ot.sort(By),Be=0;Be<ot.length;Be++)ke=ME(ot[Be],ke);return ke}(a,o,G,u)),a.length>80*u){f=E=a[0],_=S=a[1];for(var W=u;W<U;W+=u)(M=a[W])<f&&(f=M),(P=a[W+1])<_&&(_=P),M>E&&(E=M),P>S&&(S=P);R=0!==(R=Math.max(E-f,S-_))?32767/R:0}return kc(G,q,u,f,_,R,0),q}function xg(a,o,u,f,_){var E,S;if(_===Gy(a,o,u,f)>0)for(E=o;E<u;E+=f)S=jy(E,a[E],a[E+1],S);else for(E=u-f;E>=o;E-=f)S=jy(E,a[E],a[E+1],S);return S&&yp(S,S.next)&&(bg(S),S=S.next),S}function Rh(a,o){if(!a)return a;o||(o=a);var u,f=a;do{if(u=!1,f.steiner||!yp(f,f.next)&&0!==xo(f.prev,f,f.next))f=f.next;else{if(bg(f),(f=o=f.prev)===f.next)break;u=!0}}while(u||f!==o);return o}function kc(a,o,u,f,_,E,S){if(a){!S&&E&&function(z,U,G,q){var W=z;do{0===W.z&&(W.z=zy(W.x,W.y,U,G,q)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next}while(W!==z);W.prevZ.nextZ=null,W.prevZ=null,function(re){var ve,ke,et,Be,Je,nt,ot,zt,Rt=1;do{for(ke=re,re=null,Je=null,nt=0;ke;){for(nt++,et=ke,ot=0,ve=0;ve<Rt&&(ot++,et=et.nextZ);ve++);for(zt=Rt;ot>0||zt>0&&et;)0!==ot&&(0===zt||!et||ke.z<=et.z)?(Be=ke,ke=ke.nextZ,ot--):(Be=et,et=et.nextZ,zt--),Je?Je.nextZ=Be:re=Be,Be.prevZ=Je,Je=Be;ke=et}Je.nextZ=null,Rt*=2}while(nt>1)}(W)}(a,f,_,E);for(var M,P,R=a;a.prev!==a.next;)if(M=a.prev,P=a.next,E?TE(a,f,_,E):DE(a))o.push(M.i/u|0),o.push(a.i/u|0),o.push(P.i/u|0),bg(a),a=P.next,R=P.next;else if((a=P)===R){S?1===S?kc(a=IE(Rh(a),o,u),o,u,f,_,E,2):2===S&&z1(a,o,u,f,_,E):kc(Rh(a),o,u,f,_,E,1);break}}}function DE(a){var o=a.prev,u=a,f=a.next;if(xo(o,u,f)>=0)return!1;for(var _=o.x,E=u.x,S=f.x,M=o.y,P=u.y,R=f.y,z=_<E?_<S?_:S:E<S?E:S,U=M<P?M<R?M:R:P<R?P:R,G=_>E?_>S?_:S:E>S?E:S,q=M>P?M>R?M:R:P>R?P:R,W=f.next;W!==o;){if(W.x>=z&&W.x<=G&&W.y>=U&&W.y<=q&&_p(_,M,E,P,S,R,W.x,W.y)&&xo(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function TE(a,o,u,f){var _=a.prev,E=a,S=a.next;if(xo(_,E,S)>=0)return!1;for(var M=_.x,P=E.x,R=S.x,z=_.y,U=E.y,G=S.y,q=M<P?M<R?M:R:P<R?P:R,W=z<U?z<G?z:G:U<G?U:G,re=M>P?M>R?M:R:P>R?P:R,ve=z>U?z>G?z:G:U>G?U:G,ke=zy(q,W,o,u,f),et=zy(re,ve,o,u,f),Be=a.prevZ,Je=a.nextZ;Be&&Be.z>=ke&&Je&&Je.z<=et;){if(Be.x>=q&&Be.x<=re&&Be.y>=W&&Be.y<=ve&&Be!==_&&Be!==S&&_p(M,z,P,U,R,G,Be.x,Be.y)&&xo(Be.prev,Be,Be.next)>=0||(Be=Be.prevZ,Je.x>=q&&Je.x<=re&&Je.y>=W&&Je.y<=ve&&Je!==_&&Je!==S&&_p(M,z,P,U,R,G,Je.x,Je.y)&&xo(Je.prev,Je,Je.next)>=0))return!1;Je=Je.nextZ}for(;Be&&Be.z>=ke;){if(Be.x>=q&&Be.x<=re&&Be.y>=W&&Be.y<=ve&&Be!==_&&Be!==S&&_p(M,z,P,U,R,G,Be.x,Be.y)&&xo(Be.prev,Be,Be.next)>=0)return!1;Be=Be.prevZ}for(;Je&&Je.z<=et;){if(Je.x>=q&&Je.x<=re&&Je.y>=W&&Je.y<=ve&&Je!==_&&Je!==S&&_p(M,z,P,U,R,G,Je.x,Je.y)&&xo(Je.prev,Je,Je.next)>=0)return!1;Je=Je.nextZ}return!0}function IE(a,o,u){var f=a;do{var _=f.prev,E=f.next.next;!yp(_,E)&&Vy(_,f,f.next,E)&&fd(_,E)&&fd(E,_)&&(o.push(_.i/u|0),o.push(f.i/u|0),o.push(E.i/u|0),bg(f),bg(f.next),f=a=E),f=f.next}while(f!==a);return Rh(f)}function z1(a,o,u,f,_,E){var S=a;do{for(var M=S.next.next;M!==S.prev;){if(S.i!==M.i&&NE(S,M)){var P=Uy(S,M);return S=Rh(S,S.next),P=Rh(P,P.next),kc(S,o,u,f,_,E,0),void kc(P,o,u,f,_,E,0)}M=M.next}S=S.next}while(S!==a)}function By(a,o){return a.x-o.x}function ME(a,o){var u=function(_,E){var S,M=E,P=_.x,R=_.y,z=-1/0;do{if(R<=M.y&&R>=M.next.y&&M.next.y!==M.y){var U=M.x+(R-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(U<=P&&U>z&&(z=U,S=M.x<M.next.x?M:M.next,U===P))return S}M=M.next}while(M!==E);if(!S)return null;var G,q=S,W=S.x,re=S.y,ve=1/0;M=S;do{P>=M.x&&M.x>=W&&P!==M.x&&_p(R<re?P:z,R,W,re,R<re?z:P,R,M.x,M.y)&&(G=Math.abs(R-M.y)/(P-M.x),fd(M,_)&&(G<ve||G===ve&&(M.x>S.x||M.x===S.x&&AE(S,M)))&&(S=M,ve=G)),M=M.next}while(M!==q);return S}(a,o);if(!u)return o;var f=Uy(u,a);return Rh(f,f.next),Rh(u,u.next)}function AE(a,o){return xo(a.prev,a,o.prev)<0&&xo(o.next,a,a.next)<0}function zy(a,o,u,f,_){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-u)*_|0)|a<<8))|a<<4))|a<<2))|a<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-f)*_|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function V1(a){var o=a,u=a;do{(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next}while(o!==a);return u}function _p(a,o,u,f,_,E,S,M){return(_-S)*(o-M)>=(a-S)*(E-M)&&(a-S)*(f-M)>=(u-S)*(o-M)&&(u-S)*(E-M)>=(_-S)*(f-M)}function NE(a,o){return a.next.i!==o.i&&a.prev.i!==o.i&&!function(u,f){var _=u;do{if(_.i!==u.i&&_.next.i!==u.i&&_.i!==f.i&&_.next.i!==f.i&&Vy(_,_.next,u,f))return!0;_=_.next}while(_!==u);return!1}(a,o)&&(fd(a,o)&&fd(o,a)&&function(u,f){var _=u,E=!1,S=(u.x+f.x)/2,M=(u.y+f.y)/2;do{_.y>M!=_.next.y>M&&_.next.y!==_.y&&S<(_.next.x-_.x)*(M-_.y)/(_.next.y-_.y)+_.x&&(E=!E),_=_.next}while(_!==u);return E}(a,o)&&(xo(a.prev,a,o.prev)||xo(a,o.prev,o))||yp(a,o)&&xo(a.prev,a,a.next)>0&&xo(o.prev,o,o.next)>0)}function xo(a,o,u){return(o.y-a.y)*(u.x-o.x)-(o.x-a.x)*(u.y-o.y)}function yp(a,o){return a.x===o.x&&a.y===o.y}function Vy(a,o,u,f){var _=yl(xo(a,o,u)),E=yl(xo(a,o,f)),S=yl(xo(u,f,a)),M=yl(xo(u,f,o));return _!==E&&S!==M||!(0!==_||!vp(a,u,o))||!(0!==E||!vp(a,f,o))||!(0!==S||!vp(u,a,f))||!(0!==M||!vp(u,o,f))}function vp(a,o,u){return o.x<=Math.max(a.x,u.x)&&o.x>=Math.min(a.x,u.x)&&o.y<=Math.max(a.y,u.y)&&o.y>=Math.min(a.y,u.y)}function yl(a){return a>0?1:a<0?-1:0}function fd(a,o){return xo(a.prev,a,a.next)<0?xo(a,o,a.next)>=0&&xo(a,a.prev,o)>=0:xo(a,o,a.prev)<0||xo(a,a.next,o)<0}function Uy(a,o){var u=new zm(a.i,a.x,a.y),f=new zm(o.i,o.x,o.y),_=a.next,E=o.prev;return a.next=o,o.prev=a,u.next=_,_.prev=u,f.next=u,u.prev=f,E.next=f,f.prev=E,f}function jy(a,o,u,f){var _=new zm(a,o,u);return f?(_.next=f.next,_.prev=f,f.next.prev=_,f.next=_):(_.prev=_,_.next=_),_}function bg(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function zm(a,o,u){this.i=a,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Gy(a,o,u,f){for(var _=0,E=o,S=u-f;E<u;E+=f)_+=(a[S]-a[E])*(a[E+1]+a[S+1]),S=E;return _}Bm.exports=vg,Bm.exports.default=vg,vg.deviation=function(a,o,u,f){var _=o&&o.length,E=Math.abs(Gy(a,0,_?o[0]*u:a.length,u));if(_)for(var S=0,M=o.length;S<M;S++)E-=Math.abs(Gy(a,o[S]*u,S<M-1?o[S+1]*u:a.length,u));var P=0;for(S=0;S<f.length;S+=3){var R=f[S]*u,z=f[S+1]*u,U=f[S+2]*u;P+=Math.abs((a[R]-a[U])*(a[z+1]-a[R+1])-(a[R]-a[z])*(a[U+1]-a[R+1]))}return 0===E&&0===P?0:Math.abs((P-E)/E)},vg.flatten=function(a){for(var o=a[0][0].length,u={vertices:[],holes:[],dimensions:o},f=0,_=0;_<a.length;_++){for(var E=0;E<a[_].length;E++)for(var S=0;S<o;S++)u.vertices.push(a[_][E][S]);_>0&&u.holes.push(f+=a[_-1].length)}return u};var Vm=Ne(Bm.exports);function PE(a,o,u,f,_){$y(a,o,u||0,f||a.length-1,_||RE)}function $y(a,o,u,f,_){for(;f>u;){if(f-u>600){var E=f-u+1,S=o-u+1,M=Math.log(E),P=.5*Math.exp(2*M/3),R=.5*Math.sqrt(M*P*(E-P)/E)*(S-E/2<0?-1:1);$y(a,o,Math.max(u,Math.floor(o-S*P/E+R)),Math.min(f,Math.floor(o+(E-S)*P/E+R)),_)}var z=a[o],U=u,G=f;for(wg(a,u,o),_(a[f],z)>0&&wg(a,u,f);U<G;){for(wg(a,U,G),U++,G--;_(a[U],z)<0;)U++;for(;_(a[G],z)>0;)G--}0===_(a[u],z)?wg(a,u,G):wg(a,++G,f),G<=o&&(u=G+1),o<=G&&(f=G-1)}}function wg(a,o,u){var f=a[o];a[o]=a[u],a[u]=f}function RE(a,o){return a<o?-1:a>o?1:0}function Eg(a,o){const u=a.length;if(u<=1)return[a];const f=[];let _,E;for(let S=0;S<u;S++){const M=ir(a[S]);0!==M&&(a[S].area=Math.abs(M),void 0===E&&(E=M<0),E===M<0?(_&&f.push(_),_=[a[S]]):_.push(a[S]))}if(_&&f.push(_),o>1)for(let S=0;S<f.length;S++)f[S].length<=o||(PE(f[S],o,1,f[S].length-1,Hy),f[S]=f[S].slice(0,o));return f}function Hy(a,o){return o.area-a.area}function qy(a,o,u){const f=u.patternDependencies;let _=!1;for(const E of o){const S=E.paint.get(`${a}-pattern`);S.isConstant()||(_=!0);const M=S.constantOr(null);M&&(_=!0,f[M]=!0)}return _}function Tf(a,o,u,f,_){const E=_.patternDependencies;for(const S of o){const M=S.paint.get(`${a}-pattern`).value;if("constant"!==M.kind){let P=M.evaluate({zoom:f},u,{},_.availableImages);P=P&&P.name?P.name:P,E[P]=!0,u.patterns[S.id]=P}}return u}class Um{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Qt,this.indexArray=new nr,this.indexArray2=new al,this.programConfigurations=new Vd(o.layers,o.zoom),this.segments=new Sa,this.segments2=new Sa,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.projection=o.projection}populate(o,u,f,_){this.hasPattern=qy("fill",this.layers,u);const E=this.layers[0].layout.get("fill-sort-key"),S=[];for(const{feature:M,id:P,index:R,sourceLayerIndex:z}of o){const U=this.layers[0]._featureFilter.needGeometry,G=Zd(M,U);if(!this.layers[0]._featureFilter.filter(new V(this.zoom),G,f))continue;const q=E?E.evaluate(G,{},f,u.availableImages):void 0,W={id:P,properties:M.properties,type:M.type,sourceLayerIndex:z,index:R,geometry:U?G.geometry:Lc(M,f,_),patterns:{},sortKey:q};S.push(W)}E&&S.sort((M,P)=>M.sortKey-P.sortKey);for(const M of S){const{geometry:P,index:R,sourceLayerIndex:z}=M;if(this.hasPattern){const U=Tf("fill",this.layers,M,this.zoom,u);this.patternFeatures.push(U)}else this.addFeature(M,P,R,f,{},u.availableImages);u.featureIndex.insert(o[R].feature,P,R,z,this.index)}}update(o,u,f,_){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f,_)}addFeatures(o,u,f,_,E){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,u,f,_)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,mp),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,u,f,_,E,S=[]){for(const M of Eg(u,500)){let P=0;for(const W of M)P+=W.length;const R=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),z=R.vertexLength,U=[],G=[];for(const W of M){if(0===W.length)continue;W!==M[0]&&G.push(U.length/2);const re=this.segments2.prepareSegment(W.length,this.layoutVertexArray,this.indexArray2),ve=re.vertexLength;this.layoutVertexArray.emplaceBack(W[0].x,W[0].y),this.indexArray2.emplaceBack(ve+W.length-1,ve),U.push(W[0].x),U.push(W[0].y);for(let ke=1;ke<W.length;ke++)this.layoutVertexArray.emplaceBack(W[ke].x,W[ke].y),this.indexArray2.emplaceBack(ve+ke-1,ve+ke),U.push(W[ke].x),U.push(W[ke].y);re.vertexLength+=W.length,re.primitiveLength+=W.length}const q=Vm(U,G);for(let W=0;W<q.length;W+=3)this.indexArray.emplaceBack(z+q[W],z+q[W+1],z+q[W+2]);R.vertexLength+=P,R.primitiveLength+=q.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,E,S,_)}}Tn(Um,"FillBucket",{omit:["layers","patternFeatures"]});const OE=new He({"fill-sort-key":new Se(Wt.layout_fill["fill-sort-key"])});var U1={paint:new He({"fill-antialias":new te(Wt.paint_fill["fill-antialias"]),"fill-opacity":new Se(Wt.paint_fill["fill-opacity"]),"fill-color":new Se(Wt.paint_fill["fill-color"]),"fill-outline-color":new Se(Wt.paint_fill["fill-outline-color"]),"fill-translate":new te(Wt.paint_fill["fill-translate"]),"fill-translate-anchor":new te(Wt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Se(Wt.paint_fill["fill-pattern"])}),layout:OE};const j1=xt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),G1=xt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),xp=xt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:jm}=j1;var Cg={},Wy=Fe,Sg=bp;function bp(a,o,u,f,_){this.properties={},this.extent=u,this.type=0,this._pbf=a,this._geometry=-1,this._keys=f,this._values=_,a.readFields(LE,this,o)}function LE(a,o,u){1==a?o.id=u.readVarint():2==a?function(f,_){for(var E=f.readVarint()+f.pos;f.pos<E;){var S=_._keys[f.readVarint()],M=_._values[f.readVarint()];_.properties[S]=M}}(u,o):3==a?o.type=u.readVarint():4==a&&(o._geometry=u.pos)}function kE(a){for(var o,u,f=0,_=0,E=a.length,S=E-1;_<E;S=_++)f+=((u=a[S]).x-(o=a[_]).x)*(o.y+u.y);return f}bp.types=["Unknown","Point","LineString","Polygon"],bp.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var o,u=a.readVarint()+a.pos,f=1,_=0,E=0,S=0,M=[];a.pos<u;){if(_<=0){var P=a.readVarint();f=7&P,_=P>>3}if(_--,1===f||2===f)E+=a.readSVarint(),S+=a.readSVarint(),1===f&&(o&&M.push(o),o=[]),o.push(new Wy(E,S));else{if(7!==f)throw new Error("unknown command "+f);o&&o.push(o[0].clone())}}return o&&M.push(o),M},bp.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var o=a.readVarint()+a.pos,u=1,f=0,_=0,E=0,S=1/0,M=-1/0,P=1/0,R=-1/0;a.pos<o;){if(f<=0){var z=a.readVarint();u=7&z,f=z>>3}if(f--,1===u||2===u)(_+=a.readSVarint())<S&&(S=_),_>M&&(M=_),(E+=a.readSVarint())<P&&(P=E),E>R&&(R=E);else if(7!==u)throw new Error("unknown command "+u)}return[S,P,M,R]},bp.prototype.toGeoJSON=function(a,o,u){var f,_,E=this.extent*Math.pow(2,u),S=this.extent*a,M=this.extent*o,P=this.loadGeometry(),R=bp.types[this.type];function z(q){for(var W=0;W<q.length;W++){var re=q[W];q[W]=[360*(re.x+S)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(re.y+M)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var U=[];for(f=0;f<P.length;f++)U[f]=P[f][0];z(P=U);break;case 2:for(f=0;f<P.length;f++)z(P[f]);break;case 3:for(P=function(q){var W=q.length;if(W<=1)return[q];for(var re,ve,ke=[],et=0;et<W;et++){var Be=kE(q[et]);0!==Be&&(void 0===ve&&(ve=Be<0),ve===Be<0?(re&&ke.push(re),re=[q[et]]):re.push(q[et]))}return re&&ke.push(re),ke}(P),f=0;f<P.length;f++)for(_=0;_<P[f].length;_++)z(P[f][_])}1===P.length?P=P[0]:R="Multi"+R;var G={type:"Feature",geometry:{type:R,coordinates:P},properties:this.properties};return"id"in this&&(G.id=this.id),G};var FE=Sg,$1=H1;function H1(a,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(q1,this,o),this.length=this._features.length}function q1(a,o,u){15===a?o.version=u.readVarint():1===a?o.name=u.readString():5===a?o.extent=u.readVarint():2===a?o._features.push(u.pos):3===a?o._keys.push(u.readString()):4===a&&o._values.push(function(f){for(var _=null,E=f.readVarint()+f.pos;f.pos<E;){var S=f.readVarint()>>3;_=1===S?f.readString():2===S?f.readFloat():3===S?f.readDouble():4===S?f.readVarint64():5===S?f.readVarint():6===S?f.readSVarint():7===S?f.readBoolean():null}return _}(u))}H1.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var o=this._pbf.readVarint()+this._pbf.pos;return new FE(this._pbf,o,this.extent,this._keys,this._values)};var Zy=$1;function W1(a,o,u){if(3===a){var f=new Zy(u,u.readVarint()+u.pos);f.length&&(o[f.name]=f)}}var Dg=Cg.VectorTile=function(a,o){this.layers=a.readFields(W1,{},o)},Gm=Cg.VectorTileFeature=Sg;function $m(a,o,u,f){const _=[],E=0===f?(S,M,P,R,z,U)=>{S.push(new ne(U,P+(U-M)/(R-M)*(z-P)))}:(S,M,P,R,z,U)=>{S.push(new ne(M+(U-P)/(z-P)*(R-M),U))};for(const S of a){const M=[];for(const P of S){if(P.length<=2)continue;const R=[];for(let G=0;G<P.length-1;G++){const q=P[G].x,W=P[G].y,re=P[G+1].x,ve=P[G+1].y,ke=0===f?q:W,et=0===f?re:ve;ke<o?et>o&&E(R,q,W,re,ve,o):ke>u?et<u&&E(R,q,W,re,ve,u):R.push(P[G]),et<o&&ke>=o&&E(R,q,W,re,ve,o),et>u&&ke<=u&&E(R,q,W,re,ve,u)}let z=P[P.length-1];const U=0===f?z.x:z.y;U>=o&&U<=u&&R.push(z),R.length&&(z=R[R.length-1],R[0].x===z.x&&R[0].y===z.y||R.push(R[0]),M.push(R))}M.length&&_.push(M)}return _}Cg.VectorTileLayer=$1;const Xy=Gm.types,Z1=Math.pow(2,13);function ch(a,o,u,f,_,E,S,M){a.emplaceBack((o<<1)+S,(u<<1)+E,(Math.floor(f*Z1)<<1)+_,Math.round(M))}function wp(a,o,u){a.emplaceBack(o.x,o.y,o.z,16384*u[0],16384*u[1],16384*u[2])}class Yy{constructor(){this.acc=new ne(0,0),this.polyCount=[]}startRing(o){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ne(o.x,o.y),this.max=new ne(o.x,o.y))}append(o,u){this.currentPolyCount.edges++,this.acc._add(o);const f=this.min,_=this.max;o.x<f.x?f.x=o.x:o.x>_.x&&(_.x=o.x),o.y<f.y?f.y=o.y:o.y>_.y&&(_.y=o.y),((0===o.x||o.x===pr)&&o.x===u.x)!=((0===o.y||o.y===pr)&&o.y===u.y)&&this.processBorderOverlap(o,u),u.x<0!=o.x<0&&this.addBorderIntersection(0,Ci(u.y,o.y,(0-u.x)/(o.x-u.x))),u.x>pr!=o.x>pr&&this.addBorderIntersection(1,Ci(u.y,o.y,(pr-u.x)/(o.x-u.x))),u.y<0!=o.y<0&&this.addBorderIntersection(2,Ci(u.x,o.x,(0-u.y)/(o.y-u.y))),u.y>pr!=o.y>pr&&this.addBorderIntersection(3,Ci(u.x,o.x,(pr-u.y)/(o.y-u.y)))}addBorderIntersection(o,u){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const f=this.borders[o];u<f[0]&&(f[0]=u),u>f[1]&&(f[1]=u)}processBorderOverlap(o,u){if(o.x===u.x){if(o.y===u.y)return;const f=0===o.x?0:1;this.addBorderIntersection(f,u.y),this.addBorderIntersection(f,o.y)}else{const f=0===o.y?2:3;this.addBorderIntersection(f,u.x),this.addBorderIntersection(f,o.x)}}centroid(){const o=this.polyCount.reduce((u,f)=>u+f.edges,0);return 0!==o?this.acc.div(o)._round():new ne(0,0)}span(){return new ne(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((o,u)=>o+ +(u[0]!==Number.MAX_VALUE),0)}}class Tg{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.layoutVertexArray=new Jt,this.centroidVertexArray=new ks,this.indexArray=new nr,this.programConfigurations=new Vd(o.layers,o.zoom),this.segments=new Sa,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.enableTerrain=o.enableTerrain}populate(o,u,f,_){this.features=[],this.hasPattern=qy("fill-extrusion",this.layers,u),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(E){const S=Math.exp(Math.PI*(1-E.y/(1<<E.z)*2));return 80150034*S/(S*S+1)/pr/(1<<E.z)}(f),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:E,id:S,index:M,sourceLayerIndex:P}of o){const R=this.layers[0]._featureFilter.needGeometry,z=Zd(E,R);if(!this.layers[0]._featureFilter.filter(new V(this.zoom),z,f))continue;const U={id:S,sourceLayerIndex:P,index:M,geometry:R?z.geometry:Lc(E,f,_),properties:E.properties,type:E.type,patterns:{}},G=this.layoutVertexArray.length;this.hasPattern?this.features.push(Tf("fill-extrusion",this.layers,U,this.zoom,u)):this.addFeature(U,U.geometry,M,f,{},u.availableImages,_),u.featureIndex.insert(E,U.geometry,M,P,this.index,G)}this.sortBorders()}addFeatures(o,u,f,_,E){for(const S of this.features){const{geometry:M}=S;this.addFeature(S,M,S.index,u,f,_,E)}this.sortBorders()}update(o,u,f,_){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f,_)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,jm),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,xp.members,!0))),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,G1.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,u,f,_,E,S,M){const P=[new ne(0,0),new ne(pr,pr)],R=M.projection,z="globe"===R.name,U=this.enableTerrain&&!z?new Yy:null,G="Polygon"===Xy[o.type];z&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new an);const q=Eg(u,500);for(let ke=q.length-1;ke>=0;ke--){const et=q[ke];(0===et.length||(W=et[0]).every(Be=>Be.x<=0)||W.every(Be=>Be.x>=pr)||W.every(Be=>Be.y<=0)||W.every(Be=>Be.y>=pr))&&q.splice(ke,1)}var W;let re;if(z)re=e0(q,P,_);else{re=[];for(const ke of q)re.push({polygon:ke,bounds:P})}const ve=G?this.edgeRadius:0;for(const{polygon:ke,bounds:et}of re){let Be=0,Je=0;for(const ot of ke)G&&!ot[0].equals(ot[ot.length-1])&&ot.push(ot[0]),Je+=G?ot.length-1:ot.length;const nt=this.segments.prepareSegment((G?5:4)*Je,this.layoutVertexArray,this.indexArray);if(G){const ot=[],zt=[];Be=nt.vertexLength;for(const Xt of ke){let _n,jt;Xt.length&&Xt!==ke[0]&&zt.push(ot.length/2),_n=Xt[1].sub(Xt[0])._perp()._unit();for(let tn=1;tn<Xt.length;tn++){const nn=Xt[tn],dn=Xt[tn===Xt.length-1?1:tn+1];let{x:wn,y:Zt}=nn;if(ve){jt=dn.sub(nn)._perp()._unit();const On=_n.add(jt)._unit(),Wn=ve*Math.min(4,1/(_n.x*On.x+_n.y*On.y));wn+=Wn*On.x,Zt+=Wn*On.y,_n=jt}ch(this.layoutVertexArray,wn,Zt,0,0,1,1,0),nt.vertexLength++,ot.push(nn.x,nn.y),z&&wp(this.layoutVertexExtArray,R.projectTilePoint(wn,Zt,_),R.upVector(_,wn,Zt))}}const Rt=Vm(ot,zt);for(let Xt=0;Xt<Rt.length;Xt+=3)this.indexArray.emplaceBack(Be+Rt[Xt],Be+Rt[Xt+2],Be+Rt[Xt+1]),nt.primitiveLength++}for(const ot of ke){U&&ot.length&&U.startRing(ot[0]);let zt,Rt,Xt,_n=ot.length>4&&Jy(ot[ot.length-2],ot[0],ot[1]),jt=ve?Hm(ot[ot.length-2],ot[0],ot[1],ve):0;Rt=ot[1].sub(ot[0])._perp()._unit();let tn=!0;for(let nn=1,dn=0;nn<ot.length;nn++){let wn=ot[nn-1],Zt=ot[nn];const On=ot[nn===ot.length-1?1:nn+1];if(U&&G&&U.currentPolyCount.top++,Ky(Zt,wn,et)){ve&&(Rt=On.sub(Zt)._perp()._unit(),tn=!tn);continue}U&&U.append(Zt,wn);const Wn=Zt.sub(wn)._perp(),kn=Wn.x/(Math.abs(Wn.x)+Math.abs(Wn.y)),qr=Wn.y>0?1:0,Cn=wn.dist(Zt);if(dn+Cn>32768&&(dn=0),ve){Xt=On.sub(Zt)._perp()._unit();let Wr=X1(wn,Zt,On,BE(Rt,Xt),ve);isNaN(Wr)&&(Wr=0);const xr=Zt.sub(wn)._unit();wn=wn.add(xr.mult(jt))._round(),Zt=Zt.add(xr.mult(-Wr))._round(),jt=Wr,Rt=Xt}const fr=nt.vertexLength,Dr=ot.length>4&&Jy(wn,Zt,On);let Pi=Qy(dn,_n,tn);if(ch(this.layoutVertexArray,wn.x,wn.y,kn,qr,0,0,Pi),ch(this.layoutVertexArray,wn.x,wn.y,kn,qr,0,1,Pi),dn+=Cn,Pi=Qy(dn,Dr,!tn),_n=Dr,ch(this.layoutVertexArray,Zt.x,Zt.y,kn,qr,0,0,Pi),ch(this.layoutVertexArray,Zt.x,Zt.y,kn,qr,0,1,Pi),nt.vertexLength+=4,this.indexArray.emplaceBack(fr+0,fr+1,fr+2),this.indexArray.emplaceBack(fr+1,fr+3,fr+2),nt.primitiveLength+=2,ve){const Wr=Be+(1===nn?ot.length-2:nn-2),xr=1===nn?Be:Wr+1;if(this.indexArray.emplaceBack(fr+1,Wr,fr+3),this.indexArray.emplaceBack(Wr,xr,fr+3),nt.primitiveLength+=2,void 0===zt&&(zt=fr),!Ky(On,ot[nn],et)){const ls=nn===ot.length-1?zt:nt.vertexLength;this.indexArray.emplaceBack(fr+2,fr+3,ls),this.indexArray.emplaceBack(fr+3,ls+1,ls),this.indexArray.emplaceBack(fr+3,xr,ls+1),nt.primitiveLength+=3}tn=!tn}if(z){const Wr=this.layoutVertexExtArray,xr=R.projectTilePoint(wn.x,wn.y,_),ls=R.projectTilePoint(Zt.x,Zt.y,_),Zr=R.upVector(_,wn.x,wn.y),Xr=R.upVector(_,Zt.x,Zt.y);wp(Wr,xr,Zr),wp(Wr,xr,Zr),wp(Wr,ls,Xr),wp(Wr,ls,Xr)}}G&&(Be+=ot.length-1)}}if(U&&U.polyCount.length>0){if(U.borders){U.vertexArrayOffset=this.centroidVertexArray.length;const ke=U.borders,et=this.featuresOnBorder.push(U)-1;for(let Be=0;Be<4;Be++)ke[Be][0]!==Number.MAX_VALUE&&this.borders[Be].push(et)}this.encodeCentroid(U.borders?void 0:U.centroid(),U)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,E,S,_)}sortBorders(){for(let o=0;o<4;o++)this.borders[o].sort((u,f)=>this.featuresOnBorder[u].borders[o][0]-this.featuresOnBorder[f].borders[o][0])}encodeCentroid(o,u,f=!0){let _,E;if(o)if(0!==o.y){const M=u.span()._mult(this.tileToMeter);_=(Math.max(o.x,1)<<3)+Math.min(7,Math.round(M.x/10)),E=(Math.max(o.y,1)<<3)+Math.min(7,Math.round(M.y/10))}else _=Math.ceil(7*(o.x+450)),E=0;else _=0,E=+f;let S=f?this.centroidVertexArray.length:u.vertexArrayOffset;for(const M of u.polyCount){f&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*M.edges+M.top);for(let P=0;P<M.top;P++)this.centroidVertexArray.emplace(S++,_,E);for(let P=0;P<2*M.edges;P++)this.centroidVertexArray.emplace(S++,0,E),this.centroidVertexArray.emplace(S++,_,E)}}}function BE(a,o){const u=a.add(o)._unit();return a.x*u.x+a.y*u.y}function Hm(a,o,u,f){const _=o.sub(a)._perp()._unit(),E=u.sub(o)._perp()._unit();return X1(a,o,u,BE(_,E),f)}function X1(a,o,u,f,_){const E=Math.sqrt(1-f*f);return Math.min(a.dist(o)/3,o.dist(u)/3,_*E/f)}function Ky(a,o,u){return a.x<u[0].x&&o.x<u[0].x||a.x>u[1].x&&o.x>u[1].x||a.y<u[0].y&&o.y<u[0].y||a.y>u[1].y&&o.y>u[1].y}function Jy(a,o,u){if(a.x<0||a.x>=pr||o.x<0||o.x>=pr||u.x<0||u.x>=pr)return!1;const f=u.sub(o),_=f.perp(),E=a.sub(o);return(f.x*E.x+f.y*E.y)/Math.sqrt((f.x*f.x+f.y*f.y)*(E.x*E.x+E.y*E.y))>-.866&&_.x*E.x+_.y*E.y<0}function Qy(a,o,u){const f=o?2|a:-3&a;return u?1|f:-2&f}function qm(){const a=Math.PI/32,o=Math.tan(a),u=Am;return u*Math.sqrt(1+2*o*o)-u}function e0(a,o,u){const f=1<<u.z,_=_c(u.x/f),E=_c((u.x+1)/f),S=Rl(u.y/f),M=Rl((u.y+1)/f);return function(P,R,z,U,G=0,q){const W=[];if(!P.length||!z||!U)return W;const re=(ot,zt)=>{for(const Rt of ot)W.push({polygon:Rt,bounds:zt})},ve=Math.ceil(Math.log2(z)),ke=Math.ceil(Math.log2(U)),et=ve-ke,Be=[];for(let ot=0;ot<Math.abs(et);ot++)Be.push(et>0?0:1);for(let ot=0;ot<Math.min(ve,ke);ot++)Be.push(0),Be.push(1);let Je=P;if(Je=$m(Je,R[0].y-G,R[1].y+G,1),Je=$m(Je,R[0].x-G,R[1].x+G,0),!Je.length)return W;const nt=[];for(Be.length?nt.push({polygons:Je,bounds:R,depth:0}):re(Je,R);nt.length;){const ot=nt.pop(),zt=ot.depth,Rt=Be[zt],Xt=ot.bounds[0],_n=ot.bounds[1],jt=0===Rt?Xt.x:Xt.y,tn=0===Rt?_n.x:_n.y,nn=q?q(Rt,jt,tn):.5*(jt+tn),dn=$m(ot.polygons,jt-G,nn+G,Rt),wn=$m(ot.polygons,nn-G,tn+G,Rt);if(dn.length){const Zt=[Xt,new ne(0===Rt?nn:_n.x,1===Rt?nn:_n.y)];Be.length>zt+1?nt.push({polygons:dn,bounds:Zt,depth:zt+1}):re(dn,Zt)}if(wn.length){const Zt=[new ne(0===Rt?nn:Xt.x,1===Rt?nn:Xt.y),_n];Be.length>zt+1?nt.push({polygons:wn,bounds:Zt,depth:zt+1}):re(wn,Zt)}}return W}(a,o,Math.ceil((E-_)/11.25),Math.ceil((S-M)/11.25),1,(P,R,z)=>{if(0===P)return.5*(R+z);{const U=Rl((u.y+R/pr)/f);return(Nh(.5*(Rl((u.y+z/pr)/f)+U))*f-u.y)*pr}})}Tn(Tg,"FillExtrusionBucket",{omit:["layers","features"]}),Tn(Yy,"PartMetadata");const Wm=new He({"fill-extrusion-edge-radius":new te(Wt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Ig={paint:new He({"fill-extrusion-opacity":new te(Wt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Se(Wt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new te(Wt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new te(Wt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Se(Wt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Se(Wt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Se(Wt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new te(Wt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new te(Wt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new te(Wt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new te(Wt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Wm};function t0(a,o,u){var f=2*Math.PI*6378137/256/Math.pow(2,u);return[a*f-2*Math.PI*6378137/2,o*f-2*Math.PI*6378137/2]}class Ep{constructor(o,u,f){this.z=o,this.x=u,this.y=f,this.key=If(0,o,o,u,f)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,u){const f=(S=this.y,M=this.z,P=t0(256*(E=this.x),256*(S=Math.pow(2,M)-S-1),M),R=t0(256*(E+1),256*(S+1),M),P[0]+","+P[1]+","+R[0]+","+R[1]),_=function(E,S,M){let P,R="";for(let z=E;z>0;z--)P=1<<z-1,R+=(S&P?1:0)+(M&P?2:0);return R}(this.z,this.x,this.y);var E,S,M,P,R;return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===u?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",_).replace("{bbox-epsg-3857}",f)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Mg{constructor(o,u){this.wrap=o,this.canonical=u,this.key=If(o,u.z,u.z,u.x,u.y)}}class ru{constructor(o,u,f,_,E){this.overscaledZ=o,this.wrap=u,this.canonical=new Ep(f,+_,+E),this.key=0===u&&o===f?this.canonical.key:If(u,o,f,_,E)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const u=this.canonical.z-o;return o>this.canonical.z?new ru(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ru(o,this.wrap,o,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(o,u=!0){if(this.overscaledZ===o&&u)return this.key;if(o>this.canonical.z)return If(this.wrap*+u,o,this.canonical.z,this.canonical.x,this.canonical.y);{const f=this.canonical.z-o;return If(this.wrap*+u,o,o,this.canonical.x>>f,this.canonical.y>>f)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const u=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>u&&o.canonical.y===this.canonical.y>>u}children(o){if(this.overscaledZ>=o)return[new ru(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,f=2*this.canonical.x,_=2*this.canonical.y;return[new ru(u,this.wrap,u,f,_),new ru(u,this.wrap,u,f+1,_),new ru(u,this.wrap,u,f,_+1),new ru(u,this.wrap,u,f+1,_+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new ru(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new ru(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Mg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function If(a,o,u,f,_){const E=1<<Math.min(u,22);let S=E*(_%E)+f%E;return a&&u<22&&(S+=E*E*((a<0?-2*a-1:2*a)%(1<<2*(22-u)))),16*(32*S+u)+(o-u)}Tn(Ep,"CanonicalTileID"),Tn(ru,"OverscaledTileID",{omit:["projMatrix"]});class Oh extends ne{constructor(o,u,f){super(o,u),this.z=f}}function Ag(a,o){return a.x*o.x+a.y*o.y}function n0(a,o){if(1===a.length){let u=0;const f=o[u++];let _;for(;!_||f.equals(_);)if(_=o[u++],!_)return 1/0;for(;u<o.length;u++){const E=o[u],S=a[0],M=_.sub(f),P=E.sub(f),R=S.sub(f),z=Ag(M,M),U=Ag(M,P),G=Ag(P,P),q=Ag(R,M),W=Ag(R,P),re=z*G-U*U,ve=(G*q-U*W)/re,ke=(z*W-U*q)/re,et=f.z*(1-ve-ke)+_.z*ve+E.z*ke;if(isFinite(et))return et}return 1/0}{let u=1/0;for(const f of o)u=Math.min(u,f.z);return u}}function Y1(a,o,u,f,_,E,S,M){const P=S*_.getElevationAt(a,o,!0,!0),R=0!==E[0],z=R?0===E[1]?S*(E[0]/7-450):S*function(U,G,q){const W=Math.floor(G[0]/8),re=Math.floor(G[1]/8),ve=10*(G[0]-8*W),ke=10*(G[1]-8*re),et=U.getElevationAt(W,re,!0,!0),Be=U.getMeterToDEM(q),Je=Math.floor(.5*(ve*Be-1)),nt=Math.floor(.5*(ke*Be-1)),ot=U.tileCoordToPixel(W,re),zt=2*Je+1,Rt=2*nt+1,Xt=(Wn=zt,kn=Rt,[(wn=U).getElevationAtPixel(Zt=ot.x-Je,On=ot.y-nt,!0),wn.getElevationAtPixel(Zt+kn,On,!0),wn.getElevationAtPixel(Zt,On+kn,!0),wn.getElevationAtPixel(Zt+Wn,On+kn,!0)]),_n=Math.abs(Xt[0]-Xt[1]),jt=Math.abs(Xt[2]-Xt[3]),tn=Math.abs(Xt[0]-Xt[2])+Math.abs(Xt[1]-Xt[3]),nn=Math.min(.25,.5*Be*(_n+jt)/zt),dn=Math.min(.25,.5*Be*tn/Rt);var wn,Zt,On,Wn,kn;return et+Math.max(nn*ve,dn*ke)}(_,E,M):P;return{base:P+(0===u)?-1:u,top:R?Math.max(z+f,P+u+2):P+f}}const zE=xt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:VE}=zE,K1=xt([{name:"a_packed",components:4,type:"Float32"}]),{members:J1}=K1,Zm=Gm.types,r0=Math.cos(Math.PI/180*37.5);class pd{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(u=>u.id),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Pt,this.layoutVertexArray2=new mn,this.indexArray=new nr,this.programConfigurations=new Vd(o.layers,o.zoom),this.segments=new Sa,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(o,u,f,_){this.hasPattern=qy("line",this.layers,u);const E=this.layers[0].layout.get("line-sort-key"),S=[];for(const{feature:z,id:U,index:G,sourceLayerIndex:q}of o){const W=this.layers[0]._featureFilter.needGeometry,re=Zd(z,W);if(!this.layers[0]._featureFilter.filter(new V(this.zoom),re,f))continue;const ve=E?E.evaluate(re,{},f):void 0,ke={id:U,properties:z.properties,type:z.type,sourceLayerIndex:q,index:G,geometry:W?re.geometry:Lc(z,f,_),patterns:{},sortKey:ve};S.push(ke)}E&&S.sort((z,U)=>z.sortKey-U.sortKey);const{lineAtlas:M,featureIndex:P}=u,R=this.addConstantDashes(M);for(const z of S){const{geometry:U,index:G,sourceLayerIndex:q}=z;if(R&&this.addFeatureDashes(z,M),this.hasPattern){const W=Tf("line",this.layers,z,this.zoom,u);this.patternFeatures.push(W)}else this.addFeature(z,U,G,f,M.positions,u.availableImages);P.insert(o[G].feature,U,G,q,this.index)}}addConstantDashes(o){let u=!1;for(const f of this.layers){const _=f.paint.get("line-dasharray").value,E=f.layout.get("line-cap").value;if("constant"!==_.kind||"constant"!==E.kind)u=!0;else{const S=E.value,M=_.value;if(!M)continue;o.addDash(M,S)}}return u}addFeatureDashes(o,u){const f=this.zoom;for(const _ of this.layers){const E=_.paint.get("line-dasharray").value,S=_.layout.get("line-cap").value;if("constant"===E.kind&&"constant"===S.kind)continue;let M,P;if("constant"===E.kind){if(M=E.value,!M)continue}else M=E.evaluate({zoom:f},o);P="constant"===S.kind?S.value:S.evaluate({zoom:f},o),u.addDash(M,P),o.patterns[_.id]=u.getKey(M,P)}}update(o,u,f,_){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,f,_)}addFeatures(o,u,f,_,E){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,u,f,_)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,J1)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,VE),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,u,f,_,E,S){const M=this.layers[0].layout,P=M.get("line-join").evaluate(o,{}),R=M.get("line-cap").evaluate(o,{}),z=M.get("line-miter-limit"),U=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const G of u)this.addLine(G,o,P,R,z,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,f,E,S,_)}addLine(o,u,f,_,E,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ke=0;ke<o.length-1;ke++)this.totalDistance+=o[ke].dist(o[ke+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M="Polygon"===Zm[u.type];let P=o.length;for(;P>=2&&o[P-1].equals(o[P-2]);)P--;let R=0;for(;R<P-1&&o[R].equals(o[R+1]);)R++;if(P<(M?3:2))return;"bevel"===f&&(E=1.05);const z=this.overscaling<=16?15*pr/(512*this.overscaling):0,U=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let G,q,W,re,ve;this.e1=this.e2=-1,M&&(G=o[P-2],ve=o[R].sub(G)._unit()._perp());for(let ke=R;ke<P;ke++){if(W=ke===P-1?M?o[R+1]:void 0:o[ke+1],W&&o[ke].equals(W))continue;ve&&(re=ve),G&&(q=G),G=o[ke],ve=W?W.sub(G)._unit()._perp():re,re=re||ve;let et=re.add(ve);0===et.x&&0===et.y||et._unit();const Be=re.x*ve.x+re.y*ve.y,Je=et.x*ve.x+et.y*ve.y,nt=0!==Je?1/Je:1/0,ot=2*Math.sqrt(2-2*Je),zt=Je<r0&&q&&W,Rt=re.x*ve.y-re.y*ve.x>0;if(zt&&ke>R){const jt=G.dist(q);if(jt>2*z){const tn=G.sub(G.sub(q)._mult(z/jt)._round());this.updateDistance(q,tn),this.addCurrentVertex(tn,re,0,0,U),q=tn}}const Xt=q&&W;let _n=Xt?f:M?"butt":_;if(Xt&&"round"===_n&&(nt<S?_n="miter":nt<=2&&(_n="fakeround")),"miter"===_n&&nt>E&&(_n="bevel"),"bevel"===_n&&(nt>2&&(_n="flipbevel"),nt<E&&(_n="miter")),q&&this.updateDistance(q,G),"miter"===_n)et._mult(nt),this.addCurrentVertex(G,et,0,0,U);else if("flipbevel"===_n){if(nt>100)et=ve.mult(-1);else{const jt=nt*re.add(ve).mag()/re.sub(ve).mag();et._perp()._mult(jt*(Rt?-1:1))}this.addCurrentVertex(G,et,0,0,U),this.addCurrentVertex(G,et.mult(-1),0,0,U)}else if("bevel"===_n||"fakeround"===_n){const jt=-Math.sqrt(nt*nt-1),tn=Rt?jt:0,nn=Rt?0:jt;if(q&&this.addCurrentVertex(G,re,tn,nn,U),"fakeround"===_n){const dn=Math.round(180*ot/Math.PI/20);for(let wn=1;wn<dn;wn++){let Zt=wn/dn;if(.5!==Zt){const Wn=Zt-.5;Zt+=Zt*Wn*(Zt-1)*((1.0904+Be*(Be*(3.55645-1.43519*Be)-3.2452))*Wn*Wn+(.848013+Be*(.215638*Be-1.06021)))}const On=ve.sub(re)._mult(Zt)._add(re)._unit()._mult(Rt?-1:1);this.addHalfVertex(G,On.x,On.y,!1,Rt,0,U)}}W&&this.addCurrentVertex(G,ve,-tn,-nn,U)}else if("butt"===_n)this.addCurrentVertex(G,et,0,0,U);else if("square"===_n){const jt=q?1:-1;q||this.addCurrentVertex(G,et,jt,jt,U),this.addCurrentVertex(G,et,0,0,U),q&&this.addCurrentVertex(G,et,jt,jt,U)}else"round"===_n&&(q&&(this.addCurrentVertex(G,re,0,0,U),this.addCurrentVertex(G,re,1,1,U,!0)),W&&(this.addCurrentVertex(G,ve,-1,-1,U,!0),this.addCurrentVertex(G,ve,0,0,U)));if(zt&&ke<P-1){const jt=G.dist(W);if(jt>2*z){const tn=G.add(W.sub(G)._mult(z/jt)._round());this.updateDistance(G,tn),this.addCurrentVertex(tn,ve,0,0,U),G=tn}}}}addCurrentVertex(o,u,f,_,E,S=!1){const M=u.y*_-u.x,P=-u.y-u.x*_;this.addHalfVertex(o,u.x+u.y*f,u.y-u.x*f,S,!1,f,E),this.addHalfVertex(o,M,P,S,!0,-_,E)}addHalfVertex({x:o,y:u},f,_,E,S,M,P){this.layoutVertexArray.emplaceBack((o<<1)+(E?1:0),(u<<1)+(S?1:0),Math.round(63*f)+128,Math.round(63*_)+128,1+(0===M?0:M<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const R=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),P.primitiveLength++),S?this.e2=R:this.e1=R}updateScaledDistance(){if(this.lineClips){const o=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=o*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(o,u){this.distance+=o.dist(u),this.updateScaledDistance()}}Tn(pd,"LineBucket",{omit:["layers","patternFeatures"]});const UE=new He({"line-cap":new Se(Wt.layout_line["line-cap"]),"line-join":new Se(Wt.layout_line["line-join"]),"line-miter-limit":new te(Wt.layout_line["line-miter-limit"]),"line-round-limit":new te(Wt.layout_line["line-round-limit"]),"line-sort-key":new Se(Wt.layout_line["line-sort-key"])});var Q1={paint:new He({"line-opacity":new Se(Wt.paint_line["line-opacity"]),"line-color":new Se(Wt.paint_line["line-color"]),"line-translate":new te(Wt.paint_line["line-translate"]),"line-translate-anchor":new te(Wt.paint_line["line-translate-anchor"]),"line-width":new Se(Wt.paint_line["line-width"]),"line-gap-width":new Se(Wt.paint_line["line-gap-width"]),"line-offset":new Se(Wt.paint_line["line-offset"]),"line-blur":new Se(Wt.paint_line["line-blur"]),"line-dasharray":new Se(Wt.paint_line["line-dasharray"]),"line-pattern":new Se(Wt.paint_line["line-pattern"]),"line-gradient":new Ue(Wt.paint_line["line-gradient"]),"line-trim-offset":new te(Wt.paint_line["line-trim-offset"])}),layout:UE};const jE=new class extends Se{possiblyEvaluate(a,o){return o=new V(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(a,o)}evaluate(a,o,u,f){return o=Ie({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(a,o,u,f)}}(Q1.paint.properties["line-width"].specification);function ex(a,o){return o>0?o+2*a:a}jE.useIntegerZoom=!0;const o0=xt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),GE=xt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Ng=xt([{name:"a_projected_pos",components:4,type:"Float32"}],4);xt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Xm=xt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),s0=xt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);xt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const a0=xt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),tx=xt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);xt([{name:"triangle",components:3,type:"Uint16"}]),xt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),xt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),xt([{type:"Float32",name:"offsetX"}]),xt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ul=24;const Fc=128;function l0(a,o){const{expression:u}=o;if("constant"===u.kind)return{kind:"constant",layoutSize:u.evaluate(new V(a+1))};if("source"===u.kind)return{kind:"source"};{const{zoomStops:f,interpolationType:_}=u;let E=0;for(;E<f.length&&f[E]<=a;)E++;E=Math.max(0,E-1);let S=E;for(;S<f.length&&f[S]<a+1;)S++;S=Math.min(f.length-1,S);const M=f[E],P=f[S];return"composite"===u.kind?{kind:"composite",minZoom:M,maxZoom:P,interpolationType:_}:{kind:"camera",minZoom:M,maxZoom:P,minSize:u.evaluate(new V(M)),maxSize:u.evaluate(new V(P)),interpolationType:_}}}function Ym(a,{uSize:o,uSizeT:u},{lowerSize:f,upperSize:_}){return"source"===a.kind?f/Fc:"composite"===a.kind?Ci(f/Fc,_/Fc,u):o}function Cp(a,o){let u=0,f=0;if("constant"===a.kind)f=a.layoutSize;else if("source"!==a.kind){const{interpolationType:_,minZoom:E,maxZoom:S}=a,M=_?we(ya.interpolationFactor(_,o,E,S),0,1):0;"camera"===a.kind?f=Ci(a.minSize,a.maxSize,M):u=M}return{uSizeT:u,uSize:f}}var $E=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Fc,evaluateSizeForFeature:Ym,evaluateSizeForZoom:Cp,getSizeData:l0});function HE(a,o,u){return a.sections.forEach(f=>{f.text=function(_,E,S){const M=E.layout.get("text-transform").evaluate(S,{});return"uppercase"===M?_=_.toLocaleUpperCase():"lowercase"===M&&(_=_.toLocaleLowerCase()),F.applyArabicShaping&&(_=F.applyArabicShaping(_)),_}(f.text,o,u)}),a}const Bc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function Pg(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function qE(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var WE=as,ZE=function(a,o,u,f,_){var E,S,M=8*_-f-1,P=(1<<M)-1,R=P>>1,z=-7,U=u?_-1:0,G=u?-1:1,q=a[o+U];for(U+=G,E=q&(1<<-z)-1,q>>=-z,z+=M;z>0;E=256*E+a[o+U],U+=G,z-=8);for(S=E&(1<<-z)-1,E>>=-z,z+=f;z>0;S=256*S+a[o+U],U+=G,z-=8);if(0===E)E=1-R;else{if(E===P)return S?NaN:1/0*(q?-1:1);S+=Math.pow(2,f),E-=R}return(q?-1:1)*S*Math.pow(2,E-f)},XE=function(a,o,u,f,_,E){var S,M,P,R=8*E-_-1,z=(1<<R)-1,U=z>>1,G=23===_?Math.pow(2,-24)-Math.pow(2,-77):0,q=f?0:E-1,W=f?1:-1,re=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(M=isNaN(o)?1:0,S=z):(S=Math.floor(Math.log(o)/Math.LN2),o*(P=Math.pow(2,-S))<1&&(S--,P*=2),(o+=S+U>=1?G/P:G*Math.pow(2,1-U))*P>=2&&(S++,P/=2),S+U>=z?(M=0,S=z):S+U>=1?(M=(o*P-1)*Math.pow(2,_),S+=U):(M=o*Math.pow(2,U-1)*Math.pow(2,_),S=0));_>=8;a[u+q]=255&M,q+=W,M/=256,_-=8);for(S=S<<_|M,R+=_;R>0;a[u+q]=255&S,q+=W,S/=256,R-=8);a[u+q-W]|=128*re};function as(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}as.Varint=0,as.Fixed64=1,as.Bytes=2,as.Fixed32=5;var nx=4294967296,u0=1/nx,rx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function gd(a){return a.type===as.Bytes?a.readVarint()+a.pos:a.pos+1}function ix(a,o,u){var f=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(f);for(var _=u.pos-1;_>=a;_--)u.buf[_+f]=u.buf[_]}function c0(a,o){for(var u=0;u<a.length;u++)o.writeVarint(a[u])}function md(a,o){for(var u=0;u<a.length;u++)o.writeSVarint(a[u])}function Rg(a,o){for(var u=0;u<a.length;u++)o.writeFloat(a[u])}function ox(a,o){for(var u=0;u<a.length;u++)o.writeDouble(a[u])}function sx(a,o){for(var u=0;u<a.length;u++)o.writeBoolean(a[u])}function ax(a,o){for(var u=0;u<a.length;u++)o.writeFixed32(a[u])}function GI(a,o){for(var u=0;u<a.length;u++)o.writeSFixed32(a[u])}function $I(a,o){for(var u=0;u<a.length;u++)o.writeFixed64(a[u])}function HI(a,o){for(var u=0;u<a.length;u++)o.writeSFixed64(a[u])}function Dp(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+16777216*a[o+3]}function Yd(a,o,u){a[u]=o,a[u+1]=o>>>8,a[u+2]=o>>>16,a[u+3]=o>>>24}function YE(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+(a[o+3]<<24)}as.prototype={destroy:function(){this.buf=null},readFields:function(a,o,u){for(u=u||this.length;this.pos<u;){var f=this.readVarint(),_=f>>3,E=this.pos;this.type=7&f,a(_,o,this),this.pos===E&&this.skip(f)}return o},readMessage:function(a,o){return this.readFields(a,o,this.readVarint()+this.pos)},readFixed32:function(){var a=Dp(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=YE(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Dp(this.buf,this.pos)+Dp(this.buf,this.pos+4)*nx;return this.pos+=8,a},readSFixed64:function(){var a=Dp(this.buf,this.pos)+YE(this.buf,this.pos+4)*nx;return this.pos+=8,a},readFloat:function(){var a=ZE(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=ZE(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var o,u,f=this.buf;return o=127&(u=f[this.pos++]),u<128?o:(o|=(127&(u=f[this.pos++]))<<7,u<128?o:(o|=(127&(u=f[this.pos++]))<<14,u<128?o:(o|=(127&(u=f[this.pos++]))<<21,u<128?o:function(_,E,S){var M,P,R=S.buf;if(M=(112&(P=R[S.pos++]))>>4,P<128||(M|=(127&(P=R[S.pos++]))<<3,P<128)||(M|=(127&(P=R[S.pos++]))<<10,P<128)||(M|=(127&(P=R[S.pos++]))<<17,P<128)||(M|=(127&(P=R[S.pos++]))<<24,P<128)||(M|=(1&(P=R[S.pos++]))<<31,P<128))return function Sp(a,o,u){return u?4294967296*o+(a>>>0):4294967296*(o>>>0)+(a>>>0)}(_,M,E);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=f[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,o=this.pos;return this.pos=a,a-o>=12&&rx?rx.decode(this.buf.subarray(o,a)):function(u,f,_){for(var E="",S=f;S<_;){var M,P,R,z=u[S],U=null,G=z>239?4:z>223?3:z>191?2:1;if(S+G>_)break;1===G?z<128&&(U=z):2===G?128==(192&(M=u[S+1]))&&(U=(31&z)<<6|63&M)<=127&&(U=null):3===G?(P=u[S+2],128==(192&(M=u[S+1]))&&128==(192&P)&&((U=(15&z)<<12|(63&M)<<6|63&P)<=2047||U>=55296&&U<=57343)&&(U=null)):4===G&&(P=u[S+2],R=u[S+3],128==(192&(M=u[S+1]))&&128==(192&P)&&128==(192&R)&&((U=(15&z)<<18|(63&M)<<12|(63&P)<<6|63&R)<=65535||U>=1114112)&&(U=null)),null===U?(U=65533,G=1):U>65535&&(U-=65536,E+=String.fromCharCode(U>>>10&1023|55296),U=56320|1023&U),E+=String.fromCharCode(U),S+=G}return E}(this.buf,o,a)},readBytes:function(){var a=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,a);return this.pos=a,o},readPackedVarint:function(a,o){if(this.type!==as.Bytes)return a.push(this.readVarint(o));var u=gd(this);for(a=a||[];this.pos<u;)a.push(this.readVarint(o));return a},readPackedSVarint:function(a){if(this.type!==as.Bytes)return a.push(this.readSVarint());var o=gd(this);for(a=a||[];this.pos<o;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==as.Bytes)return a.push(this.readBoolean());var o=gd(this);for(a=a||[];this.pos<o;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==as.Bytes)return a.push(this.readFloat());var o=gd(this);for(a=a||[];this.pos<o;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==as.Bytes)return a.push(this.readDouble());var o=gd(this);for(a=a||[];this.pos<o;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==as.Bytes)return a.push(this.readFixed32());var o=gd(this);for(a=a||[];this.pos<o;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==as.Bytes)return a.push(this.readSFixed32());var o=gd(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==as.Bytes)return a.push(this.readFixed64());var o=gd(this);for(a=a||[];this.pos<o;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==as.Bytes)return a.push(this.readSFixed64());var o=gd(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed64());return a},skip:function(a){var o=7&a;if(o===as.Varint)for(;this.buf[this.pos++]>127;);else if(o===as.Bytes)this.pos=this.readVarint()+this.pos;else if(o===as.Fixed32)this.pos+=4;else{if(o!==as.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(a,o){this.writeVarint(a<<3|o)},realloc:function(a){for(var o=this.length||16;o<this.pos+a;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Yd(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Yd(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Yd(this.buf,-1&a,this.pos),Yd(this.buf,Math.floor(a*u0),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Yd(this.buf,-1&a,this.pos),Yd(this.buf,Math.floor(a*u0),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(o,u){var f,_,E,M;if(o>=0?(f=o%4294967296|0,_=o/4294967296|0):(_=~(-o/4294967296),4294967295^(f=~(-o%4294967296))?f=f+1|0:(f=0,_=_+1|0)),o>=0x10000000000000000||o<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),E=f,(M=u).buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,M.buf[M.pos]=127&(E>>>=7),function(E,S){var M=(7&E)<<4;S.buf[S.pos++]|=M|((E>>>=3)?128:0),E&&(S.buf[S.pos++]=127&E|((E>>>=7)?128:0),E&&(S.buf[S.pos++]=127&E|((E>>>=7)?128:0),E&&(S.buf[S.pos++]=127&E|((E>>>=7)?128:0),E&&(S.buf[S.pos++]=127&E|((E>>>=7)?128:0),E&&(S.buf[S.pos++]=127&E)))))}(_,u)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var o=this.pos;this.pos=function(f,_,E){for(var S,M,P=0;P<_.length;P++){if((S=_.charCodeAt(P))>55295&&S<57344){if(!M){S>56319||P+1===_.length?(f[E++]=239,f[E++]=191,f[E++]=189):M=S;continue}if(S<56320){f[E++]=239,f[E++]=191,f[E++]=189,M=S;continue}S=M-55296<<10|S-56320|65536,M=null}else M&&(f[E++]=239,f[E++]=191,f[E++]=189,M=null);S<128?f[E++]=S:(S<2048?f[E++]=S>>6|192:(S<65536?f[E++]=S>>12|224:(f[E++]=S>>18|240,f[E++]=S>>12&63|128),f[E++]=S>>6&63|128),f[E++]=63&S|128)}return E}(this.buf,a,this.pos);var u=this.pos-o;u>=128&&ix(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(a){this.realloc(4),XE(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),XE(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var o=a.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=a[u]},writeRawMessage:function(a,o){this.pos++;var u=this.pos;a(o,this);var f=this.pos-u;f>=128&&ix(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeMessage:function(a,o,u){this.writeTag(a,as.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(a,o){o.length&&this.writeMessage(a,c0,o)},writePackedSVarint:function(a,o){o.length&&this.writeMessage(a,md,o)},writePackedBoolean:function(a,o){o.length&&this.writeMessage(a,sx,o)},writePackedFloat:function(a,o){o.length&&this.writeMessage(a,Rg,o)},writePackedDouble:function(a,o){o.length&&this.writeMessage(a,ox,o)},writePackedFixed32:function(a,o){o.length&&this.writeMessage(a,ax,o)},writePackedSFixed32:function(a,o){o.length&&this.writeMessage(a,GI,o)},writePackedFixed64:function(a,o){o.length&&this.writeMessage(a,$I,o)},writePackedSFixed64:function(a,o){o.length&&this.writeMessage(a,HI,o)},writeBytesField:function(a,o){this.writeTag(a,as.Bytes),this.writeBytes(o)},writeFixed32Field:function(a,o){this.writeTag(a,as.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(a,o){this.writeTag(a,as.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(a,o){this.writeTag(a,as.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(a,o){this.writeTag(a,as.Fixed64),this.writeSFixed64(o)},writeVarintField:function(a,o){this.writeTag(a,as.Varint),this.writeVarint(o)},writeSVarintField:function(a,o){this.writeTag(a,as.Varint),this.writeSVarint(o)},writeStringField:function(a,o){this.writeTag(a,as.Bytes),this.writeString(o)},writeFloatField:function(a,o){this.writeTag(a,as.Fixed32),this.writeFloat(o)},writeDoubleField:function(a,o){this.writeTag(a,as.Fixed64),this.writeDouble(o)},writeBooleanField:function(a,o){this.writeVarintField(a,!!o)}};var h0=Ne(WE);const Km=3;function KE(a,o,u){o.glyphs=[],1===a&&u.readMessage(JE,o)}function JE(a,o,u){if(3===a){const{id:f,bitmap:_,width:E,height:S,left:M,top:P,advance:R}=u.readMessage(QE,{});o.glyphs.push({id:f,bitmap:new dd({width:E+2*Km,height:S+2*Km},_),metrics:{width:E,height:S,left:M,top:P,advance:R}})}else 4===a?o.ascender=u.readSVarint():5===a&&(o.descender=u.readSVarint())}function QE(a,o,u){1===a?o.id=u.readVarint():2===a?o.bitmap=u.readBytes():3===a?o.width=u.readVarint():4===a?o.height=u.readVarint():5===a?o.left=u.readSVarint():6===a?o.top=u.readSVarint():7===a&&(o.advance=u.readVarint())}const lx=Km;function Jm(a){let o=0,u=0;for(const S of a)o+=S.w*S.h,u=Math.max(u,S.w);a.sort((S,M)=>M.h-S.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}];let _=0,E=0;for(const S of a)for(let M=f.length-1;M>=0;M--){const P=f[M];if(!(S.w>P.w||S.h>P.h)){if(S.x=P.x,S.y=P.y,E=Math.max(E,S.y+S.h),_=Math.max(_,S.x+S.w),S.w===P.w&&S.h===P.h){const R=f.pop();M<f.length&&(f[M]=R)}else S.h===P.h?(P.x+=S.w,P.w-=S.w):S.w===P.w?(P.y+=S.h,P.h-=S.h):(f.push({x:P.x+S.w,y:P.y,w:P.w-S.w,h:S.h}),P.y+=S.h,P.h-=S.h);break}}return{w:_,h:E,fill:o/(_*E)||0}}const Ll=1;class d0{constructor(o,{pixelRatio:u,version:f,stretchX:_,stretchY:E,content:S}){this.paddedRect=o,this.pixelRatio=u,this.stretchX=_,this.stretchY=E,this.content=S,this.version=f}get tl(){return[this.paddedRect.x+Ll,this.paddedRect.y+Ll]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ll,this.paddedRect.y+this.paddedRect.h-Ll]}get displaySize(){return[(this.paddedRect.w-2*Ll)/this.pixelRatio,(this.paddedRect.h-2*Ll)/this.pixelRatio]}}class Qm{constructor(o,u){const f={},_={};this.haveRenderCallbacks=[];const E=[];this.addImages(o,f,E),this.addImages(u,_,E);const{w:S,h:M}=Jm(E),P=new nu({width:S||1,height:M||1});for(const R in o){const z=o[R],U=f[R].paddedRect;nu.copy(z.data,P,{x:0,y:0},{x:U.x+Ll,y:U.y+Ll},z.data)}for(const R in u){const z=u[R],U=_[R].paddedRect,G=U.x+Ll,q=U.y+Ll,W=z.data.width,re=z.data.height;nu.copy(z.data,P,{x:0,y:0},{x:G,y:q},z.data),nu.copy(z.data,P,{x:0,y:re-1},{x:G,y:q-1},{width:W,height:1}),nu.copy(z.data,P,{x:0,y:0},{x:G,y:q+re},{width:W,height:1}),nu.copy(z.data,P,{x:W-1,y:0},{x:G-1,y:q},{width:1,height:re}),nu.copy(z.data,P,{x:0,y:0},{x:G+W,y:q},{width:1,height:re})}this.image=P,this.iconPositions=f,this.patternPositions=_}addImages(o,u,f){for(const _ in o){const E=o[_],S={x:0,y:0,w:E.data.width+2*Ll,h:E.data.height+2*Ll};f.push(S),u[_]=new d0(S,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(o,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>o.hasImage(f)),o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in o.updatedImages)this.patchUpdatedImage(this.iconPositions[f],o.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],o.getImage(f),u)}patchUpdatedImage(o,u,f){if(!o||!u||o.version===u.version)return;o.version=u.version;const[_,E]=o.tl;f.update(u.data,void 0,{x:_,y:E})}}Tn(d0,"ImagePosition"),Tn(Qm,"ImageAtlas");const yc={horizontal:1,vertical:2,horizontalOnly:3},Mf=-17;class Og{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,u){const f=new Og;return f.scale=o||1,f.fontStack=u,f}static forImage(o){const u=new Og;return u.imageName=o,u}}class Tp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,u){const f=new Tp;for(let _=0;_<o.sections.length;_++){const E=o.sections[_];E.image?f.addImageSection(E):f.addTextSection(E,u)}return f}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(o){this.text=function(u,f){let _="";for(let E=0;E<u.length;E++){const S=u.charCodeAt(E+1)||null,M=u.charCodeAt(E-1)||null;_+=!f&&(S&&fy(S)&&!Bc[u[E+1]]||M&&fy(M)&&!Bc[u[E-1]])||!Bc[u[E]]?u[E]:Bc[u[E]]}return _}(this.text,o)}trim(){let o=0;for(let f=0;f<this.text.length&&Lg[this.text.charCodeAt(f)];f++)o++;let u=this.text.length;for(let f=this.text.length-1;f>=0&&f>=o&&Lg[this.text.charCodeAt(f)];f--)u--;this.text=this.text.substring(o,u),this.sectionIndex=this.sectionIndex.slice(o,u)}substring(o,u){const f=new Tp;return f.text=this.text.substring(o,u),f.sectionIndex=this.sectionIndex.slice(o,u),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,u)=>Math.max(o,this.sections[u].scale),0)}addTextSection(o,u){this.text+=o.text,this.sections.push(Og.forText(o.scale,o.fontStack||u));const f=this.sections.length-1;for(let _=0;_<o.text.length;++_)this.sectionIndex.push(f)}addImageSection(o){const u=o.image?o.image.name:"";if(0===u.length)return void gr("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Og.forImage(u)),this.sectionIndex.push(this.sections.length-1)):gr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function e_(a,o,u,f,_,E,S,M,P,R,z,U,G,q,W){const re=Tp.fromFeature(a,_);U===yc.vertical&&re.verticalizePunctuation(G);let ve=[];const ke=function(ot,zt,Rt,Xt,_n,jt){if(!ot)return[];const tn=[],nn=function(On,Wn,kn,qr,Cn,fr){let Dr=0;for(let Pi=0;Pi<On.length();Pi++){const Wr=On.getSection(Pi);Dr+=ux(On.getCharCode(Pi),Wr,qr,Cn,Wn,fr)}return Dr/Math.max(1,Math.ceil(Dr/kn))}(ot,zt,Rt,Xt,_n,jt),dn=ot.text.indexOf("\u200b")>=0;let wn=0;for(let On=0;On<ot.length();On++){const Wn=ot.getSection(On),kn=ot.getCharCode(On);if(Lg[kn]||(wn+=ux(kn,Wn,Xt,_n,zt,jt)),On<ot.length()-1){const qr=!((Zt=kn)<11904||!(Ln["Bopomofo Extended"](Zt)||Ln.Bopomofo(Zt)||Ln["CJK Compatibility Forms"](Zt)||Ln["CJK Compatibility Ideographs"](Zt)||Ln["CJK Compatibility"](Zt)||Ln["CJK Radicals Supplement"](Zt)||Ln["CJK Strokes"](Zt)||Ln["CJK Symbols and Punctuation"](Zt)||Ln["CJK Unified Ideographs Extension A"](Zt)||Ln["CJK Unified Ideographs"](Zt)||Ln["Enclosed CJK Letters and Months"](Zt)||Ln["Halfwidth and Fullwidth Forms"](Zt)||Ln.Hiragana(Zt)||Ln["Ideographic Description Characters"](Zt)||Ln["Kangxi Radicals"](Zt)||Ln["Katakana Phonetic Extensions"](Zt)||Ln.Katakana(Zt)||Ln["Vertical Forms"](Zt)||Ln["Yi Radicals"](Zt)||Ln["Yi Syllables"](Zt)));(eC[kn]||qr||Wn.imageName)&&tn.push(f0(On+1,wn,nn,tn,tC(kn,ot.getCharCode(On+1),qr&&dn),!1))}}var Zt;return nC(f0(ot.length(),wn,nn,tn,0,!0))}(re,R,E,o,f,q),{processBidirectionalText:et,processStyledBidirectionalText:Be}=F;if(et&&1===re.sections.length){const ot=et(re.toString(),ke);for(const zt of ot){const Rt=new Tp;Rt.text=zt,Rt.sections=re.sections;for(let Xt=0;Xt<zt.length;Xt++)Rt.sectionIndex.push(0);ve.push(Rt)}}else if(Be){const ot=Be(re.text,re.sectionIndex,ke);for(const zt of ot){const Rt=new Tp;Rt.text=zt[0],Rt.sectionIndex=zt[1],Rt.sections=re.sections,ve.push(Rt)}}else ve=function(ot,zt){const Rt=[],Xt=ot.text;let _n=0;for(const jt of zt)Rt.push(ot.substring(_n,jt)),_n=jt;return _n<Xt.length&&Rt.push(ot.substring(_n,Xt.length)),Rt}(re,ke);const Je=[],nt={positionedLines:Je,text:re.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:U,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ot,zt,Rt,Xt,_n,jt,tn,nn,dn,wn,Zt,On){let Wn=0,kn=0,qr=0;const Cn="right"===nn?1:"left"===nn?0:.5;let fr=!1;for(const Zr of _n){const Xr=Zr.getSections();for(const Do of Xr){if(Do.imageName)continue;const Fo=zt[Do.fontStack];if(Fo&&(fr=void 0!==Fo.ascender&&void 0!==Fo.descender,!fr))break}if(!fr)break}let Dr=0;for(const Zr of _n){Zr.trim();const Xr=Zr.getMaxScale(),Do=(Xr-1)*ul,Fo={positionedGlyphs:[],lineOffset:0};ot.positionedLines[Dr]=Fo;const us=Fo.positionedGlyphs;let Bo=0;if(!Zr.length()){kn+=jt,++Dr;continue}let Ts=0,js=0;for(let Ao=0;Ao<Zr.length();Ao++){const cs=Zr.getSection(Ao),Ia=Zr.getSectionIndex(Ao),Gs=Zr.getCharCode(Ao);let ki=cs.scale,Ma=null,Ko=null,Eu=null,Ba=ul,cl=0;const hl=!(dn===yc.horizontal||!Zt&&!sg(Gs)||Zt&&(Lg[Gs]||(Pi=Gs,Ln.Arabic(Pi)||Ln["Arabic Supplement"](Pi)||Ln["Arabic Extended-A"](Pi)||Ln["Arabic Presentation Forms-A"](Pi)||Ln["Arabic Presentation Forms-B"](Pi))));if(cs.imageName){const vl=Xt[cs.imageName];if(!vl)continue;Eu=cs.imageName,ot.iconsInText=ot.iconsInText||!0,Ko=vl.paddedRect;const ua=vl.displaySize;ki=ki*ul/On,Ma={width:ua[0],height:ua[1],left:Ll,top:-lx,advance:hl?ua[1]:ua[0],localGlyph:!1},cl=fr?-Ma.height*ki:Mf+Xr*ul-ua[1]*ki,Ba=Ma.advance;const Qu=(hl?ua[0]:ua[1])*ki-ul*Xr;Qu>0&&Qu>Bo&&(Bo=Qu)}else{const vl=Rt[cs.fontStack];if(!vl)continue;vl[Gs]&&(Ko=vl[Gs]);const ua=zt[cs.fontStack];if(!ua)continue;const Qu=ua.glyphs[Gs];if(!Qu)continue;if(Ma=Qu.metrics,Ba=8203!==Gs?ul:0,fr){const Gg=void 0!==ua.ascender?Math.abs(ua.ascender):0,$g=void 0!==ua.descender?Math.abs(ua.descender):0,Up=(Gg+$g)*ki;Ts<Up&&(Ts=Up,js=(Gg-$g)/2*ki),cl=-Gg*ki}else cl=Mf+(Xr-ki)*ul}hl?(ot.verticalizable=!0,us.push({glyph:Gs,imageName:Eu,x:Wn,y:kn+cl,vertical:hl,scale:ki,localGlyph:Ma.localGlyph,fontStack:cs.fontStack,sectionIndex:Ia,metrics:Ma,rect:Ko}),Wn+=Ba*ki+wn):(us.push({glyph:Gs,imageName:Eu,x:Wn,y:kn+cl,vertical:hl,scale:ki,localGlyph:Ma.localGlyph,fontStack:cs.fontStack,sectionIndex:Ia,metrics:Ma,rect:Ko}),Wn+=Ma.advance*ki+wn)}0!==us.length&&(qr=Math.max(Wn-wn,qr),fr?Ip(us,Cn,Bo,js,jt*Xr/2):Ip(us,Cn,Bo,0,jt/2)),Wn=0;const la=jt*Xr+Bo;Fo.lineOffset=Math.max(Bo,Do),kn+=la,++Dr}var Pi;const Wr=kn,{horizontalAlign:xr,verticalAlign:ls}=hx(tn);(function(Zr,Xr,Do,Fo,us,Bo){const Ts=(Xr-Do)*us,js=-Bo*Fo;for(const la of Zr)for(const Ao of la.positionedGlyphs)Ao.x+=Ts,Ao.y+=js})(ot.positionedLines,Cn,xr,ls,qr,Wr),ot.top+=-ls*Wr,ot.bottom=ot.top+Wr,ot.left+=-xr*qr,ot.right=ot.left+qr,ot.hasBaseline=fr}(nt,o,u,f,ve,S,M,P,U,R,G,W),!function(ot){for(const zt of ot)if(0!==zt.positionedGlyphs.length)return!1;return!0}(Je)&&nt}const Lg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},eC={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ux(a,o,u,f,_,E){if(o.imageName){const S=f[o.imageName];return S?S.displaySize[0]*o.scale*ul/E+_:0}{const S=u[o.fontStack],M=S&&S.glyphs[a];return M?M.metrics.advance*o.scale+_:0}}function cx(a,o,u,f){const _=Math.pow(a-o,2);return f?a<o?_/2:2*_:_+Math.abs(u)*u}function tC(a,o,u){let f=0;return 10===a&&(f-=1e4),u&&(f+=150),40!==a&&65288!==a||(f+=50),41!==o&&65289!==o||(f+=50),f}function f0(a,o,u,f,_,E){let S=null,M=cx(o,u,_,E);for(const P of f){const R=cx(o-P.x,u,_,E)+P.badness;R<=M&&(S=P,M=R)}return{index:a,x:o,priorBreak:S,badness:M}}function nC(a){return a?nC(a.priorBreak).concat(a.index):[]}function hx(a){let o=.5,u=.5;switch(a){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function Ip(a,o,u,f,_){if(!(o||u||f||_))return;const E=a.length-1,S=a[E],M=(S.x+S.metrics.advance*S.scale)*o;for(let P=0;P<=E;P++)a[P].x-=M,a[P].y+=u+f+_}function wr(a,o,u){const{horizontalAlign:f,verticalAlign:_}=hx(u),E=o[0]-a.displaySize[0]*f,S=o[1]-a.displaySize[1]*_;return{image:a,top:S,bottom:S+a.displaySize[1],left:E,right:E+a.displaySize[0]}}function Mp(a,o,u,f,_,E){const S=a.image;let M;if(S.content){const ve=S.content,ke=S.pixelRatio||1;M=[ve[0]/ke,ve[1]/ke,S.displaySize[0]-ve[2]/ke,S.displaySize[1]-ve[3]/ke]}const P=o.left*E,R=o.right*E;let z,U,G,q;"width"===u||"both"===u?(q=_[0]+P-f[3],U=_[0]+R+f[1]):(q=_[0]+(P+R-S.displaySize[0])/2,U=q+S.displaySize[0]);const W=o.top*E,re=o.bottom*E;return"height"===u||"both"===u?(z=_[1]+W-f[0],G=_[1]+re+f[2]):(z=_[1]+(W+re-S.displaySize[1])/2,G=z+S.displaySize[1]),{image:S,top:z,right:U,bottom:G,left:q,collisionPadding:M}}class Lh extends ne{constructor(o,u,f,_,E){super(o,u),this.angle=_,this.z=f,void 0!==E&&(this.segment=E)}clone(){return new Lh(this.x,this.y,this.z,this.angle,this.segment)}}function p0(a,o,u,f,_){if(void 0===o.segment)return!0;let E=o,S=o.segment+1,M=0;for(;M>-u/2;){if(S--,S<0)return!1;M-=a[S].dist(E),E=a[S]}M+=a[S].dist(a[S+1]),S++;const P=[];let R=0;for(;M<u/2;){const z=a[S],U=a[S+1];if(!U)return!1;let G=a[S-1].angleTo(z)-z.angleTo(U);for(G=Math.abs((G+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:M,angleDelta:G}),R+=G;M-P[0].distance>f;)R-=P.shift().angleDelta;if(R>_)return!1;S++,M+=z.dist(U)}return!0}function g0(a){let o=0;for(let u=0;u<a.length-1;u++)o+=a[u].dist(a[u+1]);return o}function m0(a,o,u){return a?.6*o*u:0}function dx(a,o){return Math.max(a?a.right-a.left:0,o?o.right-o.left:0)}function fx(a,o,u,f,_,E){const S=m0(u,_,E),M=dx(u,f)*E;let P=0;const R=g0(a)/2;for(let z=0;z<a.length-1;z++){const U=a[z],G=a[z+1],q=U.dist(G);if(P+q>R){const W=(R-P)/q,re=Ci(U.x,G.x,W),ve=Ci(U.y,G.y,W),ke=new Lh(re,ve,0,G.angleTo(U),z);return!S||p0(a,ke,M,S,o)?ke:void 0}P+=q}}function px(a,o,u,f,_,E,S,M,P){const R=m0(f,E,S),z=dx(f,_),U=z*S,G=0===a[0].x||a[0].x===P||0===a[0].y||a[0].y===P;return o-U<o/4&&(o=U+o/4),t_(a,G?o/2*M%o:(z/2+2*E)*S*M%o,o,R,u,U,G,!1,P)}function t_(a,o,u,f,_,E,S,M,P){const R=E/2,z=g0(a);let U=0,G=o-u,q=[];for(let W=0;W<a.length-1;W++){const re=a[W],ve=a[W+1],ke=re.dist(ve),et=ve.angleTo(re);for(;G+u<U+ke;){G+=u;const Be=(G-U)/ke,Je=Ci(re.x,ve.x,Be),nt=Ci(re.y,ve.y,Be);if(Je>=0&&Je<P&&nt>=0&&nt<P&&G-R>=0&&G+R<=z){const ot=new Lh(Je,nt,0,et,W);ot._round(),f&&!p0(a,ot,E,f,_)||q.push(ot)}}U+=ke}return M||q.length||S||(q=t_(a,U/2,u,f,_,E,S,!0,P)),q}function rC(a,o,u,f,_){const E=[];for(let S=0;S<a.length;S++){const M=a[S];let P;for(let R=0;R<M.length-1;R++){let z=M[R],U=M[R+1];z.x<o&&U.x<o||(z.x<o?z=new ne(o,z.y+(o-z.x)/(U.x-z.x)*(U.y-z.y))._round():U.x<o&&(U=new ne(o,z.y+(o-z.x)/(U.x-z.x)*(U.y-z.y))._round()),z.y<u&&U.y<u||(z.y<u?z=new ne(z.x+(u-z.y)/(U.y-z.y)*(U.x-z.x),u)._round():U.y<u&&(U=new ne(z.x+(u-z.y)/(U.y-z.y)*(U.x-z.x),u)._round()),z.x>=f&&U.x>=f||(z.x>=f?z=new ne(f,z.y+(f-z.x)/(U.x-z.x)*(U.y-z.y))._round():U.x>=f&&(U=new ne(f,z.y+(f-z.x)/(U.x-z.x)*(U.y-z.y))._round()),z.y>=_&&U.y>=_||(z.y>=_?z=new ne(z.x+(_-z.y)/(U.y-z.y)*(U.x-z.x),_)._round():U.y>=_&&(U=new ne(z.x+(_-z.y)/(U.y-z.y)*(U.x-z.x),_)._round()),P&&z.equals(P[P.length-1])||(P=[z],E.push(P)),P.push(U)))))}}return E}Tn(Lh,"Anchor");const Af=1e20;function gx(a,o,u,f,_,E,S,M,P){for(let R=o;R<o+f;R++)n_(a,u*E+R,E,_,S,M,P);for(let R=u;R<u+_;R++)n_(a,R*E+o,1,f,S,M,P)}function n_(a,o,u,f,_,E,S){E[0]=0,S[0]=-Af,S[1]=Af,_[0]=a[o];for(let M=1,P=0,R=0;M<f;M++){_[M]=a[o+M*u];const z=M*M;do{const U=E[P];R=(_[M]-_[U]+z-U*U)/(M-U)/2}while(R<=S[P]&&--P>-1);P++,E[P]=M,S[P]=R,S[P+1]=Af}for(let M=0,P=0;M<f;M++){for(;S[P+1]<M;)P++;const R=E[P],z=M-R;a[o+M*u]=_[R]+z*z}}const zc=2,r_={none:0,ideographs:1,all:2};class Vc{constructor(o,u,f){this.requestManager=o,this.localGlyphMode=u,this.localFontFamily=f,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,u){const f=[];for(const _ in o)for(const E of o[_])f.push({stack:_,id:E});it(f,({stack:_,id:E},S)=>{let M=this.entries[_];M||(M=this.entries[_]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let P=M.glyphs[E];if(void 0!==P)return void S(null,{stack:_,id:E,glyph:P});if(P=this._tinySDF(M,_,E),P)return M.glyphs[E]=P,void S(null,{stack:_,id:E,glyph:P});const R=Math.floor(E/256);if(256*R>65535)return void S(new Error("glyphs > 65535 not supported"));if(M.ranges[R])return void S(null,{stack:_,id:E,glyph:P});let z=M.requests[R];z||(z=M.requests[R]=[],Vc.loadGlyphRange(_,R,this.url,this.requestManager,(U,G)=>{if(G){M.ascender=G.ascender,M.descender=G.descender;for(const q in G.glyphs)this._doesCharSupportLocalGlyph(+q)||(M.glyphs[+q]=G.glyphs[+q]);M.ranges[R]=!0}for(const q of z)q(U,G);delete M.requests[R]})),z.push((U,G)=>{U?S(U):G&&S(null,{stack:_,id:E,glyph:G.glyphs[E]||null})})},(_,E)=>{if(_)u(_);else if(E){const S={};for(const{stack:M,id:P,glyph:R}of E)void 0===S[M]&&(S[M]={}),void 0===S[M].glyphs&&(S[M].glyphs={}),S[M].glyphs[P]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics},S[M].ascender=this.entries[M].ascender,S[M].descender=this.entries[M].descender;u(null,S)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==r_.none&&(this.localGlyphMode===r_.all?!!this.localFontFamily:!!this.localFontFamily&&(Ln["CJK Unified Ideographs"](o)||Ln["Hangul Syllables"](o)||Ln.Hiragana(o)||Ln.Katakana(o)||Ln["CJK Symbols and Punctuation"](o)))}_tinySDF(o,u,f){const _=this.localFontFamily;if(!_||!this._doesCharSupportLocalGlyph(f))return;let E=o.tinySDF;if(!E){let re="400";/bold/i.test(u)?re="900":/medium/i.test(u)?re="500":/light/i.test(u)&&(re="200"),E=o.tinySDF=new Vc.TinySDF({fontFamily:_,fontWeight:re,fontSize:24*zc,buffer:3*zc,radius:8*zc}),E.fontWeight=re}if(this.localGlyphs[E.fontWeight][f])return this.localGlyphs[E.fontWeight][f];const S=String.fromCharCode(f),{data:M,width:P,height:R,glyphWidth:z,glyphHeight:U,glyphLeft:G,glyphTop:q,glyphAdvance:W}=E.draw(S);return this.localGlyphs[E.fontWeight][f]={id:f,bitmap:new dd({width:P,height:R},M),metrics:{width:z/zc,height:U/zc,left:G/zc,top:q/zc-27,advance:W/zc,localGlyph:!0}}}}Vc.loadGlyphRange=function(a,o,u,f,_){const E=256*o,S=E+255,M=f.transformRequest(f.normalizeGlyphsURL(u).replace("{fontstack}",a).replace("{range}",`${E}-${S}`),kr.Glyphs);Po(M,(P,R)=>{if(P)_(P);else if(R){const z={},U=new h0(R).readFields(KE,{});for(const G of U.glyphs)z[G.id]=G;_(null,{glyphs:z,ascender:U.ascender,descender:U.descender})}})},Vc.TinySDF=class{constructor({fontSize:a=24,buffer:o=3,radius:u=8,cutoff:f=.25,fontFamily:_="sans-serif",fontWeight:E="normal",fontStyle:S="normal"}={}){this.buffer=o,this.cutoff=f,this.radius=u;const M=this.size=a+4*o,P=this._createCanvas(M),R=this.ctx=P.getContext("2d",{willReadFrequently:!0});R.font=`${S} ${E} ${a}px ${_}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(a){const o=document.createElement("canvas");return o.width=o.height=a,o}draw(a){const{width:o,actualBoundingBoxAscent:u,actualBoundingBoxDescent:f,actualBoundingBoxLeft:_,actualBoundingBoxRight:E}=this.ctx.measureText(a),S=Math.ceil(u),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(E-_))),P=Math.min(this.size-this.buffer,S+Math.ceil(f)),R=M+2*this.buffer,z=P+2*this.buffer,U=Math.max(R*z,0),G=new Uint8ClampedArray(U),q={data:G,width:R,height:z,glyphWidth:M,glyphHeight:P,glyphTop:S,glyphLeft:0,glyphAdvance:o};if(0===M||0===P)return q;const{ctx:W,buffer:re,gridInner:ve,gridOuter:ke}=this;W.clearRect(re,re,M,P),W.fillText(a,re,re+S);const et=W.getImageData(re,re,M,P);ke.fill(Af,0,U),ve.fill(0,0,U);for(let Be=0;Be<P;Be++)for(let Je=0;Je<M;Je++){const nt=et.data[4*(Be*M+Je)+3]/255;if(0===nt)continue;const ot=(Be+re)*R+Je+re;if(1===nt)ke[ot]=0,ve[ot]=Af;else{const zt=.5-nt;ke[ot]=zt>0?zt*zt:0,ve[ot]=zt<0?zt*zt:0}}gx(ke,0,0,R,z,R,this.f,this.v,this.z),gx(ve,re,re,M,P,R,this.f,this.v,this.z);for(let Be=0;Be<U;Be++){const Je=Math.sqrt(ke[Be])-Math.sqrt(ve[Be]);G[Be]=Math.round(255-255*(Je/this.radius+this.cutoff))}return q}};const Ap=Ll;function i_(a,o,u,f){const _=[],E=a.image,S=E.pixelRatio,M=E.paddedRect.w-2*Ap,P=E.paddedRect.h-2*Ap,R=a.right-a.left,z=a.bottom-a.top,U=E.stretchX||[[0,M]],G=E.stretchY||[[0,P]],q=(jt,tn)=>jt+tn[1]-tn[0],W=U.reduce(q,0),re=G.reduce(q,0),ve=M-W,ke=P-re;let et=0,Be=W,Je=0,nt=re,ot=0,zt=ve,Rt=0,Xt=ke;if(E.content&&f){const jt=E.content;et=Nf(U,0,jt[0]),Je=Nf(G,0,jt[1]),Be=Nf(U,jt[0],jt[2]),nt=Nf(G,jt[1],jt[3]),ot=jt[0]-et,Rt=jt[1]-Je,zt=jt[2]-jt[0]-Be,Xt=jt[3]-jt[1]-nt}const _n=(jt,tn,nn,dn)=>{const wn=Np(jt.stretch-et,Be,R,a.left),Zt=Pf(jt.fixed-ot,zt,jt.stretch,W),On=Np(tn.stretch-Je,nt,z,a.top),Wn=Pf(tn.fixed-Rt,Xt,tn.stretch,re),kn=Np(nn.stretch-et,Be,R,a.left),qr=Pf(nn.fixed-ot,zt,nn.stretch,W),Cn=Np(dn.stretch-Je,nt,z,a.top),fr=Pf(dn.fixed-Rt,Xt,dn.stretch,re),Dr=new ne(wn,On),Pi=new ne(kn,On),Wr=new ne(kn,Cn),xr=new ne(wn,Cn),ls=new ne(Zt/S,Wn/S),Zr=new ne(qr/S,fr/S),Xr=o*Math.PI/180;if(Xr){const us=Math.sin(Xr),Bo=Math.cos(Xr),Ts=[Bo,-us,us,Bo];Dr._matMult(Ts),Pi._matMult(Ts),xr._matMult(Ts),Wr._matMult(Ts)}const Do=jt.stretch+jt.fixed,Fo=tn.stretch+tn.fixed;return{tl:Dr,tr:Pi,bl:xr,br:Wr,tex:{x:E.paddedRect.x+Ap+Do,y:E.paddedRect.y+Ap+Fo,w:nn.stretch+nn.fixed-Do,h:dn.stretch+dn.fixed-Fo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ls,pixelOffsetBR:Zr,minFontScaleX:zt/S/R,minFontScaleY:Xt/S/z,isSDF:u}};if(f&&(E.stretchX||E.stretchY)){const jt=mx(U,ve,W),tn=mx(G,ke,re);for(let nn=0;nn<jt.length-1;nn++){const dn=jt[nn],wn=jt[nn+1];for(let Zt=0;Zt<tn.length-1;Zt++)_.push(_n(dn,tn[Zt],wn,tn[Zt+1]))}}else _.push(_n({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:P+1}));return _}function Nf(a,o,u){let f=0;for(const _ of a)f+=Math.max(o,Math.min(u,_[1]))-Math.max(o,Math.min(u,_[0]));return f}function mx(a,o,u){const f=[{fixed:-Ap,stretch:0}];for(const[_,E]of a){const S=f[f.length-1];f.push({fixed:_-S.stretch,stretch:S.stretch}),f.push({fixed:_-S.stretch,stretch:S.stretch+(E-_)})}return f.push({fixed:o+Ap,stretch:u}),f}function Np(a,o,u,f){return a/o*u+f}function Pf(a,o,u,f){return a-o*u/f}function hh(a,o,u,f){const _=o+a.positionedLines[f].lineOffset;return 0===f?u+_/2:u+(_+(o+a.positionedLines[f-1].lineOffset))/2}class _0{constructor(o=[],u=y0){if(this.data=o,this.length=this.data.length,this.compare=u,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const o=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:u,compare:f}=this,_=u[o];for(;o>0;){const E=o-1>>1,S=u[E];if(f(_,S)>=0)break;u[o]=S,o=E}u[o]=_}_down(o){const{data:u,compare:f}=this,_=this.length>>1,E=u[o];for(;o<_;){let S=1+(o<<1),M=u[S];const P=S+1;if(P<this.length&&f(u[P],M)<0&&(S=P,M=u[P]),f(M,E)>=0)break;u[o]=M,o=S}u[o]=E}}function y0(a,o){return a<o?-1:a>o?1:0}function iC(a,o=1,u=!1){let f=1/0,_=1/0,E=-1/0,S=-1/0;const M=a[0];for(let q=0;q<M.length;q++){const W=M[q];(!q||W.x<f)&&(f=W.x),(!q||W.y<_)&&(_=W.y),(!q||W.x>E)&&(E=W.x),(!q||W.y>S)&&(S=W.y)}const P=Math.min(E-f,S-_);let R=P/2;const z=new _0([],oC);if(0===P)return new ne(f,_);for(let q=f;q<E;q+=P)for(let W=_;W<S;W+=P)z.push(new Rf(q+R,W+R,R,a));let U=function(q){let W=0,re=0,ve=0;const ke=q[0];for(let et=0,Be=ke.length,Je=Be-1;et<Be;Je=et++){const nt=ke[et],ot=ke[Je],zt=nt.x*ot.y-ot.x*nt.y;re+=(nt.x+ot.x)*zt,ve+=(nt.y+ot.y)*zt,W+=3*zt}return new Rf(re/W,ve/W,0,q)}(a),G=z.length;for(;z.length;){const q=z.pop();(q.d>U.d||!U.d)&&(U=q,u&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,G)),q.max-U.d<=o||(R=q.h/2,z.push(new Rf(q.p.x-R,q.p.y-R,R,a)),z.push(new Rf(q.p.x+R,q.p.y-R,R,a)),z.push(new Rf(q.p.x-R,q.p.y+R,R,a)),z.push(new Rf(q.p.x+R,q.p.y+R,R,a)),G+=4)}return u&&(console.log(`num probes: ${G}`),console.log(`best distance: ${U.d}`)),U.p}function oC(a,o){return o.max-a.max}class Rf{constructor(o,u,f,_){this.p=new ne(o,u),this.h=f,this.d=function(E,S){let M=!1,P=1/0;for(let R=0;R<S.length;R++){const z=S[R];for(let U=0,G=z.length,q=G-1;U<G;q=U++){const W=z[U],re=z[q];W.y>E.y!=re.y>E.y&&E.x<(re.x-W.x)*(E.y-W.y)/(re.y-W.y)+W.x&&(M=!M),P=Math.min(P,O1(E,W,re))}}return(M?1:-1)*Math.sqrt(P)}(this.p,_),this.max=this.d+this.h*Math.SQRT2}}const dh=7,v0=Number.POSITIVE_INFINITY,sC=Math.sqrt(2);function _x(a,[o,u]){let f=0,_=0;if(u===v0){o<0&&(o=0);const E=o/sC;switch(a){case"top-right":case"top-left":_=E-dh;break;case"bottom-right":case"bottom-left":_=-E+dh;break;case"bottom":_=-o+dh;break;case"top":_=o-dh}switch(a){case"top-right":case"bottom-right":f=-E;break;case"top-left":case"bottom-left":f=E;break;case"left":f=o;break;case"right":f=-o}}else{switch(o=Math.abs(o),u=Math.abs(u),a){case"top-right":case"top-left":case"top":_=u-dh;break;case"bottom-right":case"bottom-left":case"bottom":_=-u+dh}switch(a){case"top-right":case"bottom-right":case"right":f=-o;break;case"top-left":case"bottom-left":case"left":f=o}}return[f,_]}function x0(a,o,u,f,_,E,S,M,P,R){a.createArrays(),a.tilePixelRatio=pr/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const z=a.layers[0].layout,U=a.layers[0]._unevaluatedLayout._values,G={};if("composite"===a.textSizeData.kind){const{minZoom:re,maxZoom:ve}=a.textSizeData;G.compositeTextSizes=[U["text-size"].possiblyEvaluate(new V(re),M),U["text-size"].possiblyEvaluate(new V(ve),M)]}if("composite"===a.iconSizeData.kind){const{minZoom:re,maxZoom:ve}=a.iconSizeData;G.compositeIconSizes=[U["icon-size"].possiblyEvaluate(new V(re),M),U["icon-size"].possiblyEvaluate(new V(ve),M)]}G.layoutTextSize=U["text-size"].possiblyEvaluate(new V(P+1),M),G.layoutIconSize=U["icon-size"].possiblyEvaluate(new V(P+1),M),G.textMaxSize=U["text-size"].possiblyEvaluate(new V(18),M);const q="map"===z.get("text-rotation-alignment")&&"point"!==z.get("symbol-placement"),W=z.get("text-size");for(const re of a.features){const ve=z.get("text-font").evaluate(re,{},M).join(","),ke=W.evaluate(re,{},M),et=G.layoutTextSize.evaluate(re,{},M),Be=(G.layoutIconSize.evaluate(re,{},M),{horizontal:{},vertical:void 0}),Je=re.text;let nt,ot=[0,0];if(Je){const Xt=Je.toString(),_n=z.get("text-letter-spacing").evaluate(re,{},M)*ul,jt=z.get("text-line-height").evaluate(re,{},M)*ul,tn=dy(Xt)?_n:0,nn=z.get("text-anchor").evaluate(re,{},M),dn=z.get("text-variable-anchor");if(!dn){const kn=z.get("text-radial-offset").evaluate(re,{},M);ot=kn?_x(nn,[kn*ul,v0]):z.get("text-offset").evaluate(re,{},M).map(qr=>qr*ul)}let wn=q?"center":z.get("text-justify").evaluate(re,{},M);const Zt="point"===z.get("symbol-placement"),On=Zt?z.get("text-max-width").evaluate(re,{},M)*ul:1/0,Wn=kn=>{a.allowVerticalPlacement&&np(Xt)&&(Be.vertical=e_(Je,o,u,_,ve,On,jt,nn,kn,tn,ot,yc.vertical,!0,et,ke))};if(!q&&dn){const kn="auto"===wn?dn.map(Cn=>Pp(Cn)):[wn];let qr=!1;for(let Cn=0;Cn<kn.length;Cn++){const fr=kn[Cn];if(!Be.horizontal[fr])if(qr)Be.horizontal[fr]=Be.horizontal[0];else{const Dr=e_(Je,o,u,_,ve,On,jt,"center",fr,tn,ot,yc.horizontal,!1,et,ke);Dr&&(Be.horizontal[fr]=Dr,qr=1===Dr.positionedLines.length)}}Wn("left")}else{if("auto"===wn&&(wn=Pp(nn)),Zt||z.get("text-writing-mode").indexOf("horizontal")>=0||!np(Xt)){const kn=e_(Je,o,u,_,ve,On,jt,nn,wn,tn,ot,yc.horizontal,!1,et,ke);kn&&(Be.horizontal[wn]=kn)}Wn(Zt?"left":wn)}}let zt=!1;if(re.icon&&re.icon.name){const Xt=f[re.icon.name];Xt&&(nt=wr(_[re.icon.name],z.get("icon-offset").evaluate(re,{},M),z.get("icon-anchor").evaluate(re,{},M)),zt=Xt.sdf,void 0===a.sdfIcons?a.sdfIcons=Xt.sdf:a.sdfIcons!==Xt.sdf&&gr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Xt.pixelRatio!==a.pixelRatio||0!==z.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const Rt=uC(Be.horizontal)||Be.vertical;a.iconsInText||(a.iconsInText=!!Rt&&Rt.iconsInText),(Rt||nt)&&aC(a,re,Be,nt,f,G,et,0,ot,zt,S,M,R)}E&&a.generateCollisionDebugBuffers(P,a.collisionBoxArray)}function Pp(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function aC(a,o,u,f,_,E,S,M,P,R,z,U,G){let q=E.textMaxSize.evaluate(o,{},U);void 0===q&&(q=S);const W=a.layers[0].layout,re=W.get("icon-offset").evaluate(o,{},U),ve=uC(u.horizontal)||u.vertical,ke="globe"===G.name,et=ul,Be=S/et,Je=a.tilePixelRatio*q/et,nt=(nn=a.overscaling,a.zoom>18&&nn>2&&(nn>>=1),Math.max(pr/(512*nn),1)*W.get("symbol-spacing")),ot=W.get("text-padding")*a.tilePixelRatio,zt=W.get("icon-padding")*a.tilePixelRatio,Rt=rt(W.get("text-max-angle")),Xt="map"===W.get("text-rotation-alignment")&&"point"!==W.get("symbol-placement"),_n="map"===W.get("icon-rotation-alignment")&&"point"!==W.get("symbol-placement"),jt=W.get("symbol-placement"),tn=nt/2;var nn;const dn=W.get("icon-text-fit");let wn;f&&"none"!==dn&&(a.allowVerticalPlacement&&u.vertical&&(wn=Mp(f,u.vertical,dn,W.get("icon-text-fit-padding"),re,Be)),ve&&(f=Mp(f,ve,dn,W.get("icon-text-fit-padding"),re,Be)));const Zt=(On,Wn,kn)=>{if(Wn.x<0||Wn.x>=pr||Wn.y<0||Wn.y>=pr)return;let qr=null;if(ke){const{x:Cn,y:fr,z:Dr}=G.projectTilePoint(Wn.x,Wn.y,kn);qr={anchor:new Lh(Cn,fr,Dr,0,void 0),up:G.upVector(kn,Wn.x,Wn.y)}}!function(Cn,fr,Dr,Pi,Wr,xr,ls,Zr,Xr,Do,Fo,us,Bo,Ts,js,la,Ao,cs,Ia,Gs,ki,Ma,Ko,Eu,Ba){const cl=Cn.addToLineVertexArray(fr,Pi);let hl,vl,ua,Qu,Gg,$g,Up,L0=0,kx=0,Fx=0,k0=0,g_=-1,Uf=-1;const zh={};let F0=Ql("");const tf=Dr?Dr.anchor:fr;let B0=0,z0=0;if(void 0===Xr._unevaluatedLayout.getValue("text-radial-offset")?[B0,z0]=Xr.layout.get("text-offset").evaluate(ki,{},Ba).map(ec=>ec*ul):(B0=Xr.layout.get("text-radial-offset").evaluate(ki,{},Ba)*ul,z0=v0),Cn.allowVerticalPlacement&&Wr.vertical){const ec=Wr.vertical;if(js)$g=b0(ec),Zr&&(Up=b0(Zr));else{const tc=Xr.layout.get("text-rotate").evaluate(ki,{},Ba)+90;ua=kg(Do,tf,fr,Fo,us,Bo,ec,Ts,tc,la),Zr&&(Qu=kg(Do,tf,fr,Fo,us,Bo,Zr,cs,tc))}}if(xr){const ec=Xr.layout.get("icon-rotate").evaluate(ki,{},Ba),tc="none"!==Xr.layout.get("icon-text-fit"),Hg=i_(xr,ec,Ko,tc),U0=Zr?i_(Zr,ec,Ko,tc):void 0;vl=kg(Do,tf,fr,Fo,us,Bo,xr,cs,ec),L0=4*Hg.length;const Bx=Cn.iconSizeData;let jf=null;"source"===Bx.kind?(jf=[Fc*Xr.layout.get("icon-size").evaluate(ki,{},Ba)],jf[0]>vc&&gr(`${Cn.layerIds[0]}: Value for "icon-size" is >= ${Rp}. Reduce your "icon-size".`)):"composite"===Bx.kind&&(jf=[Fc*Ma.compositeIconSizes[0].evaluate(ki,{},Ba),Fc*Ma.compositeIconSizes[1].evaluate(ki,{},Ba)],(jf[0]>vc||jf[1]>vc)&&gr(`${Cn.layerIds[0]}: Value for "icon-size" is >= ${Rp}. Reduce your "icon-size".`)),Cn.addSymbols(Cn.icon,Hg,jf,Gs,Ia,ki,!1,Dr,fr,cl.lineStartIndex,cl.lineLength,-1,Eu,Ba),g_=Cn.icon.placedSymbolArray.length-1,U0&&(kx=4*U0.length,Cn.addSymbols(Cn.icon,U0,jf,Gs,Ia,ki,yc.vertical,Dr,fr,cl.lineStartIndex,cl.lineLength,-1,Eu,Ba),Uf=Cn.icon.placedSymbolArray.length-1)}for(const ec in Wr.horizontal){const tc=Wr.horizontal[ec];hl||(F0=Ql(tc.text),js?Gg=b0(tc):hl=kg(Do,tf,fr,Fo,us,Bo,tc,Ts,Xr.layout.get("text-rotate").evaluate(ki,{},Ba),la));const Hg=1===tc.positionedLines.length;if(Fx+=lC(Cn,Dr,fr,tc,ls,Xr,js,ki,la,cl,Wr.vertical?yc.horizontal:yc.horizontalOnly,Hg?Object.keys(Wr.horizontal):[ec],zh,g_,Ma,Eu,Ba),Hg)break}Wr.vertical&&(k0+=lC(Cn,Dr,fr,Wr.vertical,ls,Xr,js,ki,la,cl,yc.vertical,["vertical"],zh,Uf,Ma,Eu,Ba));let Hc=-1;const V0=(ec,tc)=>ec?Math.max(ec,tc):tc;Hc=V0(Gg,Hc),Hc=V0($g,Hc),Hc=V0(Up,Hc);const JI=Hc>-1?1:0;Cn.glyphOffsetArray.length>=fh.MAX_GLYPHS&&gr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==ki.sortKey&&Cn.addToSortKeyRanges(Cn.symbolInstances.length,ki.sortKey),Cn.symbolInstances.emplaceBack(tf.x,tf.y,tf.z,fr.x,fr.y,zh.right>=0?zh.right:-1,zh.center>=0?zh.center:-1,zh.left>=0?zh.left:-1,zh.vertical>=0?zh.vertical:-1,g_,Uf,F0,void 0!==hl?hl:Cn.collisionBoxArray.length,void 0!==hl?hl+1:Cn.collisionBoxArray.length,void 0!==ua?ua:Cn.collisionBoxArray.length,void 0!==ua?ua+1:Cn.collisionBoxArray.length,void 0!==vl?vl:Cn.collisionBoxArray.length,void 0!==vl?vl+1:Cn.collisionBoxArray.length,Qu||Cn.collisionBoxArray.length,Qu?Qu+1:Cn.collisionBoxArray.length,Fo,Fx,k0,L0,kx,JI,0,B0,z0,Hc)}(a,Wn,qr,On,u,f,_,wn,a.layers[0],a.collisionBoxArray,o.index,o.sourceLayerIndex,a.index,ot,Xt,P,0,zt,_n,re,o,E,R,z,U)};if("line"===jt)for(const On of rC(o.geometry,0,0,pr,pr)){const Wn=px(On,nt,Rt,u.vertical||ve,f,et,Je,a.overscaling,pr);for(const kn of Wn)ve&&qI(a,ve.text,tn,kn)||Zt(On,kn,U)}else if("line-center"===jt){for(const On of o.geometry)if(On.length>1){const Wn=fx(On,Rt,u.vertical||ve,f,et,Je);Wn&&Zt(On,Wn,U)}}else if("Polygon"===o.type)for(const On of Eg(o.geometry,0)){const Wn=iC(On,16);Zt(On[0],new Lh(Wn.x,Wn.y,0,0,void 0),U)}else if("LineString"===o.type)for(const On of o.geometry)Zt(On,new Lh(On[0].x,On[0].y,0,0,void 0),U);else if("Point"===o.type)for(const On of o.geometry)for(const Wn of On)Zt([Wn],new Lh(Wn.x,Wn.y,0,0,void 0),U)}const Rp=255,vc=Rp*Fc;function lC(a,o,u,f,_,E,S,M,P,R,z,U,G,q,W,re,ve){const ke=function(Je,nt,ot,zt,Rt,Xt,_n,jt){const tn=[];if(0===nt.positionedLines.length)return tn;const nn=zt.layout.get("text-rotate").evaluate(Xt,{})*Math.PI/180,dn=function(kn){const qr=kn[0],Cn=kn[1],fr=qr*Cn;return fr>0?[qr,-Cn]:fr<0?[-qr,Cn]:0===qr?[Cn,qr]:[Cn,-qr]}(ot);let wn=Math.abs(nt.top-nt.bottom);for(const kn of nt.positionedLines)wn-=kn.lineOffset;const Zt=nt.positionedLines.length,On=wn/Zt;let Wn=nt.top-ot[1];for(let kn=0;kn<Zt;++kn){const qr=nt.positionedLines[kn];Wn=hh(nt,On,Wn,kn);for(const Cn of qr.positionedGlyphs){if(!Cn.rect)continue;const fr=Cn.rect||{};let Dr=lx+1,Pi=!0,Wr=1,xr=0;if(Cn.imageName){const Ko=_n[Cn.imageName];if(!Ko)continue;if(Ko.sdf){gr("SDF images are not supported in formatted text and will be ignored.");continue}Pi=!1,Wr=Ko.pixelRatio,Dr=Ll/Wr}const ls=(Rt||jt)&&Cn.vertical,Zr=Cn.metrics.advance*Cn.scale/2,Xr=Cn.metrics,Do=Cn.rect;if(null===Do)continue;jt&&nt.verticalizable&&(xr=Cn.imageName?Zr-Cn.metrics.width*Cn.scale/2:0);const Fo=Rt?[Cn.x+Zr,Cn.y]:[0,0];let us=[0,0],Bo=[0,0],Ts=!1;Rt||(ls?(Bo=[Cn.x+Zr+dn[0],Cn.y+dn[1]-xr],Ts=!0):us=[Cn.x+Zr+ot[0],Cn.y+ot[1]-xr]);const js=Do.w*Cn.scale/(Wr*(Cn.localGlyph?zc:1)),la=Do.h*Cn.scale/(Wr*(Cn.localGlyph?zc:1));let Ao,cs,Ia,Gs;if(ls){const Ko=Cn.y-Wn,Eu=new ne(-Zr,Zr-Ko),Ba=-Math.PI/2,cl=new ne(...Bo);Ao=new ne(-Zr+us[0],us[1]),Ao._rotateAround(Ba,Eu)._add(cl),Ao.x+=-Ko+Zr,Ao.y-=(Xr.left-Dr)*Cn.scale;const hl=Cn.imageName?Xr.advance*Cn.scale:ul*Cn.scale,vl=String.fromCharCode(Cn.glyph);Pg(vl)?Ao.x+=(1-Dr)*Cn.scale:qE(vl)?Ao.x+=hl-Xr.height*Cn.scale+(-Dr-1)*Cn.scale:Ao.x+=Cn.imageName||Xr.width+2*Dr===Do.w&&Xr.height+2*Dr===Do.h?(hl-la)/2:(hl-(Xr.height+2*Dr)*Cn.scale)/2,cs=new ne(Ao.x,Ao.y-js),Ia=new ne(Ao.x+la,Ao.y),Gs=new ne(Ao.x+la,Ao.y-js)}else{const Ko=(Xr.left-Dr)*Cn.scale-Zr+us[0],Eu=(-Xr.top-Dr)*Cn.scale+us[1],Ba=Ko+js,cl=Eu+la;Ao=new ne(Ko,Eu),cs=new ne(Ba,Eu),Ia=new ne(Ko,cl),Gs=new ne(Ba,cl)}if(nn){let Ko;Ko=Rt?new ne(0,0):Ts?new ne(dn[0],dn[1]):new ne(ot[0],ot[1]),Ao._rotateAround(nn,Ko),cs._rotateAround(nn,Ko),Ia._rotateAround(nn,Ko),Gs._rotateAround(nn,Ko)}const ki=new ne(0,0),Ma=new ne(0,0);tn.push({tl:Ao,tr:cs,bl:Ia,br:Gs,tex:fr,writingMode:nt.writingMode,glyphOffset:Fo,sectionIndex:Cn.sectionIndex,isSDF:Pi,pixelOffsetTL:ki,pixelOffsetBR:Ma,minFontScaleX:0,minFontScaleY:0})}}return tn}(0,f,P,E,S,M,_,a.allowVerticalPlacement),et=a.textSizeData;let Be=null;"source"===et.kind?(Be=[Fc*E.layout.get("text-size").evaluate(M,{},ve)],Be[0]>vc&&gr(`${a.layerIds[0]}: Value for "text-size" is >= ${Rp}. Reduce your "text-size".`)):"composite"===et.kind&&(Be=[Fc*W.compositeTextSizes[0].evaluate(M,{},ve),Fc*W.compositeTextSizes[1].evaluate(M,{},ve)],(Be[0]>vc||Be[1]>vc)&&gr(`${a.layerIds[0]}: Value for "text-size" is >= ${Rp}. Reduce your "text-size".`)),a.addSymbols(a.text,ke,Be,P,S,M,z,o,u,R.lineStartIndex,R.lineLength,q,re,ve);for(const Je of U)G[Je]=a.text.placedSymbolArray.length-1;return 4*ke.length}function uC(a){for(const o in a)return a[o];return null}function kg(a,o,u,f,_,E,S,M,P,R){let z=S.top,U=S.bottom,G=S.left,q=S.right;const W=S.collisionPadding;if(W&&(G-=W[0],z-=W[1],q+=W[2],U+=W[3]),P){const re=new ne(G,z),ve=new ne(q,z),ke=new ne(G,U),et=new ne(q,U),Be=rt(P);let Je=new ne(0,0);R&&(Je=new ne(R[0],R[1])),re._rotateAround(Be,Je),ve._rotateAround(Be,Je),ke._rotateAround(Be,Je),et._rotateAround(Be,Je),G=Math.min(re.x,ve.x,ke.x,et.x),q=Math.max(re.x,ve.x,ke.x,et.x),z=Math.min(re.y,ve.y,ke.y,et.y),U=Math.max(re.y,ve.y,ke.y,et.y)}return a.emplaceBack(o.x,o.y,o.z,u.x,u.y,G,z,q,U,M,f,_,E),a.length-1}function b0(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const o=a.bottom-a.top;return o>0?Math.max(10,o):null}function qI(a,o,u,f){const _=a.compareText;if(o in _){const E=_[o];for(let S=E.length-1;S>=0;S--)if(f.dist(E[S])<u)return!0}else _[o]=[];return _[o].push(f),!1}function cC(a,o){const u=a.fovAboveCenter,f=a.elevation?a.elevation.getMinElevationBelowMSL()*o:0,_=(a._camera.position[2]*a.worldSize-f)/Math.cos(a._pitch),E=Math.sin(u)*_/Math.sin(Math.max(Math.PI/2-a._pitch-u,.01)),S=Math.sin(a._pitch)*E+_;return Math.min(1.01*S,_*(1/a._horizonShift))}function kh(a,o){if(!o.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:o};const u=Math.pow(2,-a.z),f=a.x*u,_=(a.x+1)*u,E=a.y*u,S=(a.y+1)*u,M=_c(f),P=_c(_),R=Rl(E),z=Rl(S),U=o.project(M,R),G=o.project(P,R),q=o.project(P,z),W=o.project(M,z);let re=Math.min(U.x,G.x,q.x,W.x),ve=Math.min(U.y,G.y,q.y,W.y),ke=Math.max(U.x,G.x,q.x,W.x),et=Math.max(U.y,G.y,q.y,W.y);const Be=u/16;function Je(ot,zt,Rt,Xt,_n,jt){const tn=(Rt+_n)/2,nn=(Xt+jt)/2,dn=o.project(_c(tn),Rl(nn)),wn=Math.max(0,re-dn.x,ve-dn.y,dn.x-ke,dn.y-et);re=Math.min(re,dn.x),ke=Math.max(ke,dn.x),ve=Math.min(ve,dn.y),et=Math.max(et,dn.y),wn>Be&&(Je(ot,dn,Rt,Xt,tn,nn),Je(dn,zt,tn,nn,_n,jt))}Je(U,G,f,E,_,E),Je(G,q,_,E,_,S),Je(q,W,_,S,f,S),Je(W,U,f,S,f,E),re-=Be,ve-=Be,ke+=Be,et+=Be;const nt=1/Math.max(ke-re,et-ve);return{scale:nt,x:re*nt,y:ve*nt,x2:ke*nt,y2:et*nt,projection:o}}const hC=Zu(new Float32Array(16));class Fh{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,u){return{x:0,y:0,z:0}}unproject(o,u){return new Gi(0,0)}projectTilePoint(o,u,f){return{x:o,y:u,z:0}}locationPoint(o,u,f=!0){return o._coordinatePoint(o.locationCoordinate(u),f)}pixelsPerMeter(o,u){return uh(1,o)*u}pixelSpaceConversion(o,u,f){return 1}farthestPixelDistance(o){return cC(o,o.pixelsPerMeter)}pointCoordinate(o,u,f,_){const E=o.horizonLineFromTop(!1),S=new ne(u,Math.max(E,f));return o.rayIntersectionCoordinate(o.pointRayIntersection(S,_))}pointCoordinate3D(o,u,f){const _=new ne(u,f);if(o.elevation)return o.elevation.pointCoordinate(_);{const E=this.pointCoordinate(o,_.x,_.y,0);return[E.x,E.y,E.z]}}isPointAboveHorizon(o,u){if(o.elevation)return!this.pointCoordinate3D(o,u.x,u.y);const f=o.horizonLineFromTop();return u.y<f}createInversionMatrix(o,u){return hC}createTileMatrix(o,u,f){let _,E,S;const M=f.canonical,P=Zu(new Float64Array(16));if(this.isReprojectedInTileSpace){const R=kh(M,this);_=1,E=R.x+f.wrap*R.scale,S=R.y,jd(P,P,[_/R.scale,_/R.scale,o.pixelsPerMeter/u])}else _=u/o.zoomScale(M.z),E=(M.x+Math.pow(2,M.z)*f.wrap)*_,S=M.y*_;return sp(P,P,[E,S,0]),jd(P,P,[_/pr,_/pr,1]),P}upVector(o,u,f){return[0,0,1]}upVectorScale(o,u,f){return{metersToTile:1}}}class w0 extends Fh{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[u,f]=this.parallels=o.parallels||[29.5,45.5],_=Math.sin(rt(u));this.n=(_+Math.sin(rt(f)))/2,this.c=1+_*(2*this.n-_),this.r0=Math.sqrt(this.c)/this.n}project(o,u){const{n:f,c:_,r0:E}=this,S=rt(o-this.center[0]),M=rt(u),P=Math.sqrt(_-2*f*Math.sin(M))/f;return{x:P*Math.sin(S*f),y:P*Math.cos(S*f)-E,z:0}}unproject(o,u){const{n:f,c:_,r0:E}=this,S=E+u;let M=Math.atan2(o,Math.abs(S))*Math.sign(S);S*f<0&&(M-=Math.PI*Math.sign(o)*Math.sign(S));const P=rt(this.center[0])*f;M=Ae(M,-Math.PI-P,Math.PI-P);const R=we(Ve(M/f)+this.center[0],-180,180),z=Math.asin(we((_-(o*o+S*S)*f*f)/(2*f),-1,1)),U=we(Ve(z),-Ol,Ol);return new Gi(R,U)}}const Bh=1.340264,Of=-.081106,Lf=893e-6,_d=.003796,kf=Math.sqrt(3)/2;class Fg extends Fh{project(o,u){u=u/180*Math.PI,o=o/180*Math.PI;const f=Math.asin(kf*Math.sin(u)),_=f*f,E=_*_*_;return{x:.5*(o*Math.cos(f)/(kf*(Bh+3*Of*_+E*(7*Lf+9*_d*_)))/Math.PI+.5),y:1-.5*(f*(Bh+Of*_+E*(Lf+_d*_))/Math.PI+1),z:0}}unproject(o,u){o=(2*o-.5)*Math.PI;let f=u=(2*(1-u)-1)*Math.PI,_=f*f,E=_*_*_;for(let z,U,G,q=0;q<12&&(U=f*(Bh+Of*_+E*(Lf+_d*_))-u,G=Bh+3*Of*_+E*(7*Lf+9*_d*_),z=U/G,f=we(f-z,-Math.PI/3,Math.PI/3),_=f*f,E=_*_*_,!(Math.abs(z)<1e-12));++q);const S=kf*o*(Bh+3*Of*_+E*(7*Lf+9*_d*_))/Math.cos(f),M=Math.asin(Math.sin(f)/kf),P=we(180*S/Math.PI,-180,180),R=we(180*M/Math.PI,-Ol,Ol);return new Gi(P,R)}}class yx extends Fh{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,u){return{x:.5+o/360,y:.5-u/360,z:0}}unproject(o,u){const f=360*(o-.5),_=we(360*(.5-u),-Ol,Ol);return new Gi(f,_)}}const Kd=Math.PI/2;function Ff(a){return Math.tan((Kd+a)/2)}class WI extends Fh{constructor(o){super(o),this.center=o.center||[0,30];const[u,f]=this.parallels=o.parallels||[30,30];let _=rt(u),E=rt(f);this.southernCenter=_+E<0,this.southernCenter&&(_=-_,E=-E);const S=Math.cos(_),M=Ff(_);this.n=_===E?Math.sin(_):Math.log(S/Math.cos(E))/Math.log(Ff(E)/M),this.f=S*Math.pow(Ff(_),this.n)/this.n}project(o,u){u=rt(u),this.southernCenter&&(u=-u),o=rt(o-this.center[0]);const f=1e-6,{n:_,f:E}=this;E>0?u<-Kd+f&&(u=-Kd+f):u>Kd-f&&(u=Kd-f);const S=E/Math.pow(Ff(u),_);let M=S*Math.sin(_*o),P=E-S*Math.cos(_*o);return M=.5*(M/Math.PI+.5),P=.5*(P/Math.PI+.5),{x:M,y:this.southernCenter?P:1-P,z:0}}unproject(o,u){o=(2*o-.5)*Math.PI,this.southernCenter&&(u=1-u),u=(2*(1-u)-.5)*Math.PI;const{n:f,f:_}=this,E=_-u,S=Math.sign(E),M=Math.sign(f)*Math.sqrt(o*o+E*E);let P=Math.atan2(o,Math.abs(E))*S;E*f<0&&(P-=Math.PI*Math.sign(o)*S);const R=we(Ve(P/f)+this.center[0],-180,180),z=we(Ve(2*Math.atan(Math.pow(_/M,1/f))-Kd),-Ol,Ol);return new Gi(R,this.southernCenter?-z:z)}}class o_ extends Fh{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,u){return{x:lh(o),y:Nh(u),z:0}}unproject(o,u){const f=_c(o),_=Rl(u);return new Gi(f,_)}}const s_=rt(Ol);class vx extends Fh{project(o,u){const f=(u=rt(u))*u,_=f*f;return{x:.5*((o=rt(o))*(.8707-.131979*f+_*(_*(.003971*f-.001529*_)-.013791))/Math.PI+.5),y:1-.5*(u*(1.007226+f*(.015085+_*(.028874*f-.044475-.005916*_)))/Math.PI+1),z:0}}unproject(o,u){o=(2*o-.5)*Math.PI;let f=u=(2*(1-u)-1)*Math.PI,_=25,E=0,S=f*f;do{S=f*f;const R=S*S;E=(f*(1.007226+S*(.015085+R*(.028874*S-.044475-.005916*R)))-u)/(1.007226+S*(.045255+R*(.259866*S-.311325-.005916*11*R))),f=we(f-E,-s_,s_)}while(Math.abs(E)>1e-6&&--_>0);S=f*f;const M=we(Ve(o/(.8707+S*(S*(S*S*S*(.003971-.001529*S)-.013791)-.131979))),-180,180),P=Ve(f);return new Gi(M,P)}}const xx=rt(Ol);class dC extends Fh{project(o,u){u=rt(u),o=rt(o);const f=Math.cos(u),_=2/Math.PI,E=Math.acos(f*Math.cos(o/2)),S=Math.sin(E)/E,M=.5*(o*_+2*f*Math.sin(o/2)/S)||0,P=.5*(u+Math.sin(u)/S)||0;return{x:.5*(M/Math.PI+.5),y:1-.5*(P/Math.PI+1),z:0}}unproject(o,u){let f=o=(2*o-.5)*Math.PI,_=u=(2*(1-u)-1)*Math.PI,E=25;const S=1e-6;let M=0,P=0;do{const R=Math.cos(_),z=Math.sin(_),U=2*z*R,G=z*z,q=R*R,W=Math.cos(f/2),re=Math.sin(f/2),ve=2*W*re,ke=re*re,et=1-q*W*W,Be=et?1/et:0,Je=et?Math.acos(R*W)*Math.sqrt(1/et):0,nt=.5*(2*Je*R*re+2*f/Math.PI)-o,ot=.5*(Je*z+_)-u,zt=.5*Be*(q*ke+Je*R*W*G)+1/Math.PI,Rt=Be*(ve*U/4-Je*z*re),Xt=.125*Be*(U*re-Je*z*q*ve),_n=.5*Be*(G*W+Je*ke*R)+.5,jt=Rt*Xt-_n*zt;M=(ot*Rt-nt*_n)/jt,P=(nt*Xt-ot*zt)/jt,f=we(f-M,-Math.PI,Math.PI),_=we(_-P,-xx,xx)}while((Math.abs(M)>S||Math.abs(P)>S)&&--E>0);return new Gi(Ve(f),Ve(_))}}class E0 extends Fh{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(rt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,u){const{scale:f,cosPhi:_}=this;return{x:rt(o)*_*f+.5,y:-Math.sin(rt(u))/_*f+.5,z:0}}unproject(o,u){const{scale:f,cosPhi:_}=this,E=-(u-.5)/f,S=we(Ve((o-.5)/f)/_,-180,180),M=Math.asin(we(E*_,-1,1)),P=we(Ve(M),-Ol,Ol);return new Gi(S,P)}}class bx extends o_{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(o,u,f){const _=Ta(o,u,f);return ea(_,_,mg(cd(f))),{x:_[0],y:_[1],z:_[2]}}locationPoint(o,u){const f=dp(u.lat,u.lng),_=_l([],f),E=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(u),o._centerAltitude):o._centerAltitude;wf(f,f,_,uh(1,0)*pr*E);const S=Zu(new Float64Array(16));return ad(S,o.pixelMatrix,o.globeMatrix),ea(f,f,S),new ne(f[0],f[1])}pixelsPerMeter(o,u){return uh(1,0)*u}pixelSpaceConversion(o,u,f){const _=uh(1,o)*u,E=Ci(uh(1,45)*u,_,f);return this.pixelsPerMeter(o,u)/E}createTileMatrix(o,u,f){const _=Yu(cd(f.canonical));return ad(new Float64Array(16),o.globeMatrix,_)}createInversionMatrix(o,u){const{center:f}=o,_=mg(cd(u));return ld(_,_,rt(f.lng)),yy(_,_,rt(f.lat)),jd(_,_,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(_)}pointCoordinate(o,u,f,_){return Ef(o,u,f,!0)||new hd(0,0)}pointCoordinate3D(o,u,f){const _=this.pointCoordinate(o,u,f,0);return[_.x,_.y,_.z]}isPointAboveHorizon(o,u){return!Ef(o,u.x,u.y,!1)}farthestPixelDistance(o){const u=function(_,E){const S=_.cameraToCenterDistance,M=_._centerAltitude*E,P=_._camera,R=_._camera.forward(),z=Gd([],vu([],R,-S),[0,0,M]),U=_.worldSize/(2*Math.PI),G=[0,0,-U],q=_.width/_.height,W=Math.tan(_.fovAboveCenter),re=vu([],P.up(),W),ve=vu([],P.right(),W*q),ke=_l([],Gd([],Gd([],R,re),ve)),et=[];let Be;if(new Dm(z,ke).closestPointOnSphere(G,U,et)){const Je=Gd([],et,G),nt=ah([],Je,z);Be=Math.cos(_.fovAboveCenter)*dg(nt)}else{const Je=ah([],z,G),nt=ah([],G,z);_l(nt,nt);const ot=dg(Je)-U;Be=Math.sqrt(ot*(ot+2*U));const zt=Math.acos(Be/(U+ot))-Math.acos(sh(R,nt));Be*=Math.cos(zt)}return 1.01*Be}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),f=Cf(o.zoom);if(f>0){const _=cC(o,uh(1,o.center.lat)*o.worldSize),E=o.worldSize/(2*Math.PI),S=Math.max(o.width,o.height)/o.worldSize*Math.PI;return Ci(u,_+E*(1-Math.cos(S)),Math.pow(f,10))}return u}upVector(o,u,f){return Ta(u,f,o,1)}upVectorScale(o){return{metersToTile:up(Mm(cd(o)))}}}function wx(a){const o=a.parallels,u=!!o&&Math.abs(o[0]+o[1])<.01;switch(a.name){case"mercator":return new o_(a);case"equirectangular":return new yx(a);case"naturalEarth":return new vx(a);case"equalEarth":return new Fg(a);case"winkelTripel":return new dC(a);case"albers":return u?new E0(a):new w0(a);case"lambertConformalConic":return u?new E0(a):new WI(a);case"globe":return new bx(a)}throw new Error(`Invalid projection name: ${a.name}`)}const fC=Gm.types,ZI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function a_(a,o,u,f,_,E,S,M,P,R,z,U,G){const q=M?Math.min(vc,Math.round(M[0])):0,W=M?Math.min(vc,Math.round(M[1])):0;a.emplaceBack(o,u,Math.round(32*f),Math.round(32*_),E,S,(q<<1)+(P?1:0),W,16*R,16*z,256*U,256*G)}function Op(a,o,u,f,_,E,S){a.emplaceBack(o,u,f,_,E,S)}function Lp(a,o,u,f,_){a.emplaceBack(o,u,f,_),a.emplaceBack(o,u,f,_),a.emplaceBack(o,u,f,_),a.emplaceBack(o,u,f,_)}function pC(a){for(const o of a.sections)if(rp(o.text))return!0;return!1}class l_{constructor(o){this.layoutVertexArray=new ln,this.indexArray=new nr,this.programConfigurations=o,this.segments=new Sa,this.dynamicLayoutVertexArray=new mn,this.opacityVertexArray=new cr,this.placedSymbolArray=new Ca,this.globeExtVertexArray=new xn}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(o,u,f,_){this.isEmpty()||(f&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,o0.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,Ng.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,ZI,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,GE.members,!0)),this.opacityVertexBuffer.itemSize=1),(f||_)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Tn(l_,"SymbolBuffers");class Bg{constructor(o,u,f){this.layoutVertexArray=new o,this.layoutAttributes=u,this.indexArray=new f,this.segments=new Sa,this.collisionVertexArray=new ci,this.collisionVertexArrayExt=new li}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,Xm.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,s0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Tn(Bg,"CollisionBuffers");class fh{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(S=>S.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Zu([]),this.placementViewportMatrix=Zu([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=l0(this.zoom,u["text-size"]),this.iconSizeData=l0(this.zoom,u["icon-size"]);const f=this.layers[0].layout,_=f.get("symbol-sort-key"),E=f.get("symbol-z-order");this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==E&&void 0!==_.constantOr(1),this.sortFeaturesByY=("viewport-y"===E||"auto"===E&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=f.get("text-writing-mode").map(S=>yc[S]),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.sourceID=o.sourceID,this.projection=o.projection}createArrays(){this.text=new l_(new Vd(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new l_(new Vd(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new cn,this.lineVertexArray=new Li,this.symbolInstances=new ys}calculateGlyphDependencies(o,u,f,_,E){for(let S=0;S<o.length;S++)if(u[o.charCodeAt(S)]=!0,_&&E){const M=Bc[o.charAt(S)];M&&(u[M.charCodeAt(0)]=!0)}}populate(o,u,f,_){const E=this.layers[0],S=E.layout,M="globe"===this.projection.name,P=S.get("text-font"),R=S.get("text-field"),z=S.get("icon-image"),U=("constant"!==R.value.kind||R.value.value instanceof zo&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&("constant"!==P.value.kind||P.value.value.length>0),G="constant"!==z.value.kind||!!z.value.value||Object.keys(z.parameters).length>0,q=S.get("symbol-sort-key");if(this.features=[],!U&&!G)return;const W=u.iconDependencies,re=u.glyphDependencies,ve=u.availableImages,ke=new V(this.zoom);for(const{feature:et,id:Be,index:Je,sourceLayerIndex:nt}of o){const ot=E._featureFilter.needGeometry,zt=Zd(et,ot);if(!E._featureFilter.filter(ke,zt,f))continue;if(ot||(zt.geometry=Lc(et,f,_)),M&&1!==et.type&&f.z<=5){const jt=zt.geometry,tn=.98078528056,nn=(dn,wn)=>sh(Ta(dn.x,dn.y,f,1),Ta(wn.x,wn.y,f,1))<tn;for(let dn=0;dn<jt.length;dn++)jt[dn]=Pm(jt[dn],nn)}let Rt,Xt;if(U){const jt=E.getValueAndResolveTokens("text-field",zt,f,ve),tn=zo.factory(jt);pC(tn)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===A()||this.hasRTLText&&F.isParsed())&&(Rt=HE(tn,E,zt))}if(G){const jt=E.getValueAndResolveTokens("icon-image",zt,f,ve);Xt=jt instanceof Sr?jt:Sr.fromString(jt)}if(!Rt&&!Xt)continue;const _n=this.sortFeaturesByKey?q.evaluate(zt,{},f):void 0;if(this.features.push({id:Be,text:Rt,icon:Xt,index:Je,sourceLayerIndex:nt,geometry:zt.geometry,properties:et.properties,type:fC[et.type],sortKey:_n}),Xt&&(W[Xt.name]=!0),Rt){const jt=P.evaluate(zt,{},f).join(","),tn="map"===S.get("text-rotation-alignment")&&"point"!==S.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(yc.vertical)>=0;for(const nn of Rt.sections)if(nn.image)W[nn.image.name]=!0;else{const dn=np(Rt.toString()),wn=nn.fontStack||jt,Zt=re[wn]=re[wn]||{};this.calculateGlyphDependencies(nn.text,Zt,tn,this.allowVerticalPlacement,dn)}}}"line"===S.get("symbol-placement")&&(this.features=function(et){const Be={},Je={},nt=[];let ot=0;function zt(jt){nt.push(et[jt]),ot++}function Rt(jt,tn,nn){const dn=Je[jt];return delete Je[jt],Je[tn]=dn,nt[dn].geometry[0].pop(),nt[dn].geometry[0]=nt[dn].geometry[0].concat(nn[0]),dn}function Xt(jt,tn,nn){const dn=Be[tn];return delete Be[tn],Be[jt]=dn,nt[dn].geometry[0].shift(),nt[dn].geometry[0]=nn[0].concat(nt[dn].geometry[0]),dn}function _n(jt,tn,nn){const dn=nn?tn[0][tn[0].length-1]:tn[0][0];return`${jt}:${dn.x}:${dn.y}`}for(let jt=0;jt<et.length;jt++){const tn=et[jt],nn=tn.geometry,dn=tn.text?tn.text.toString():null;if(!dn){zt(jt);continue}const wn=_n(dn,nn),Zt=_n(dn,nn,!0);if(wn in Je&&Zt in Be&&Je[wn]!==Be[Zt]){const On=Xt(wn,Zt,nn),Wn=Rt(wn,Zt,nt[On].geometry);delete Be[wn],delete Je[Zt],Je[_n(dn,nt[Wn].geometry,!0)]=Wn,nt[On].geometry=null}else wn in Je?Rt(wn,Zt,nn):Zt in Be?Xt(wn,Zt,nn):(zt(jt),Be[wn]=ot-1,Je[Zt]=ot-1)}return nt.filter(jt=>jt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((et,Be)=>et.sortKey-Be.sortKey)}update(o,u,f,_){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,u,this.layers,f,_),this.icon.programConfigurations.updatePaintArrays(o,u,this.layers,f,_))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=wx(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,u){const f=this.lineVertexArray.length;if(void 0!==o.segment)for(const{x:_,y:E}of u)this.lineVertexArray.emplaceBack(_,E);return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(o,u,f,_,E,S,M,P,R,z,U,G,q,W){const re=o.indexArray,ve=o.layoutVertexArray,ke=o.globeExtVertexArray,et=o.segments.prepareSegment(4*u.length,ve,re,this.canOverlap?S.sortKey:void 0),Be=this.glyphOffsetArray.length,Je=et.vertexLength,nt=this.allowVerticalPlacement&&M===yc.vertical?Math.PI/2:0,ot=S.text&&S.text.sections;for(let Rt=0;Rt<u.length;Rt++){const{tl:Xt,tr:_n,bl:jt,br:tn,tex:nn,pixelOffsetTL:dn,pixelOffsetBR:wn,minFontScaleX:Zt,minFontScaleY:On,glyphOffset:Wn,isSDF:kn,sectionIndex:qr}=u[Rt],Cn=et.vertexLength,fr=Wn[1];if(a_(ve,R.x,R.y,Xt.x,fr+Xt.y,nn.x,nn.y,f,kn,dn.x,dn.y,Zt,On),a_(ve,R.x,R.y,_n.x,fr+_n.y,nn.x+nn.w,nn.y,f,kn,wn.x,dn.y,Zt,On),a_(ve,R.x,R.y,jt.x,fr+jt.y,nn.x,nn.y+nn.h,f,kn,dn.x,wn.y,Zt,On),a_(ve,R.x,R.y,tn.x,fr+tn.y,nn.x+nn.w,nn.y+nn.h,f,kn,wn.x,wn.y,Zt,On),P){const{x:Dr,y:Pi,z:Wr}=P.anchor,[xr,ls,Zr]=P.up;Op(ke,Dr,Pi,Wr,xr,ls,Zr),Op(ke,Dr,Pi,Wr,xr,ls,Zr),Op(ke,Dr,Pi,Wr,xr,ls,Zr),Op(ke,Dr,Pi,Wr,xr,ls,Zr),Lp(o.dynamicLayoutVertexArray,Dr,Pi,Wr,nt)}else Lp(o.dynamicLayoutVertexArray,R.x,R.y,R.z,nt);re.emplaceBack(Cn,Cn+1,Cn+2),re.emplaceBack(Cn+1,Cn+2,Cn+3),et.vertexLength+=4,et.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Wn[0]),Rt!==u.length-1&&qr===u[Rt+1].sectionIndex||o.programConfigurations.populatePaintArrays(ve.length,S,S.index,{},q,W,ot&&ot[qr])}const zt=P?P.anchor:R;o.placedSymbolArray.emplaceBack(zt.x,zt.y,zt.z,R.x,R.y,Be,this.glyphOffsetArray.length-Be,Je,z,U,R.segment,f?f[0]:0,f?f[1]:0,_[0],_[1],M,0,!1,0,G,0)}_commitLayoutVertex(o,u,f,_,E,S,M){o.emplaceBack(u,f,_,E,S,Math.round(M.x),Math.round(M.y))}_addCollisionDebugVertices(o,u,f,_,E,S,M){const P=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),R=P.vertexLength,z=M.tileAnchorX,U=M.tileAnchorY;for(let q=0;q<4;q++)f.collisionVertexArray.emplaceBack(0,0,0,0);f.collisionVertexArrayExt.emplaceBack(u,-o.padding,-o.padding),f.collisionVertexArrayExt.emplaceBack(u,o.padding,-o.padding),f.collisionVertexArrayExt.emplaceBack(u,o.padding,o.padding),f.collisionVertexArrayExt.emplaceBack(u,-o.padding,o.padding),this._commitLayoutVertex(f.layoutVertexArray,_,E,S,z,U,new ne(o.x1,o.y1)),this._commitLayoutVertex(f.layoutVertexArray,_,E,S,z,U,new ne(o.x2,o.y1)),this._commitLayoutVertex(f.layoutVertexArray,_,E,S,z,U,new ne(o.x2,o.y2)),this._commitLayoutVertex(f.layoutVertexArray,_,E,S,z,U,new ne(o.x1,o.y2)),P.vertexLength+=4;const G=f.indexArray;G.emplaceBack(R,R+1),G.emplaceBack(R+1,R+2),G.emplaceBack(R+2,R+3),G.emplaceBack(R+3,R),P.primitiveLength+=4}_addTextDebugCollisionBoxes(o,u,f,_,E,S){for(let M=_;M<E;M++){const P=f.get(M),R=this.getSymbolInstanceTextSize(o,S,u,M);this._addCollisionDebugVertices(P,R,this.textCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,S)}}_addIconDebugCollisionBoxes(o,u,f,_,E,S){for(let M=_;M<E;M++){const P=f.get(M),R=this.getSymbolInstanceIconSize(o,u,S.placedIconSymbolIndex);this._addCollisionDebugVertices(P,R,this.iconCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,S)}}generateCollisionDebugBuffers(o,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Bg(Hn,a0.members,al),this.iconCollisionBox=new Bg(Hn,a0.members,al);const f=Cp(this.iconSizeData,o),_=Cp(this.textSizeData,o);for(let E=0;E<this.symbolInstances.length;E++){const S=this.symbolInstances.get(E);this._addTextDebugCollisionBoxes(_,o,u,S.textBoxStartIndex,S.textBoxEndIndex,S),this._addTextDebugCollisionBoxes(_,o,u,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S),this._addIconDebugCollisionBoxes(f,o,u,S.iconBoxStartIndex,S.iconBoxEndIndex,S),this._addIconDebugCollisionBoxes(f,o,u,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S)}}getSymbolInstanceTextSize(o,u,f,_){const E=this.text.placedSymbolArray.get(u.rightJustifiedTextSymbolIndex>=0?u.rightJustifiedTextSymbolIndex:u.centerJustifiedTextSymbolIndex>=0?u.centerJustifiedTextSymbolIndex:u.leftJustifiedTextSymbolIndex>=0?u.leftJustifiedTextSymbolIndex:u.verticalPlacedTextSymbolIndex>=0?u.verticalPlacedTextSymbolIndex:_),S=Ym(this.textSizeData,o,E)/ul;return this.tilePixelRatio*S}getSymbolInstanceIconSize(o,u,f){const _=this.icon.placedSymbolArray.get(f),E=Ym(this.iconSizeData,o,_);return this.tilePixelRatio*E}_commitDebugCollisionVertexUpdate(o,u,f){o.emplaceBack(u,-f,-f),o.emplaceBack(u,f,-f),o.emplaceBack(u,f,f),o.emplaceBack(u,-f,f)}_updateTextDebugCollisionBoxes(o,u,f,_,E,S){for(let M=_;M<E;M++){const P=f.get(M),R=this.getSymbolInstanceTextSize(o,S,u,M);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,R,P.padding)}}_updateIconDebugCollisionBoxes(o,u,f,_,E,S){for(let M=_;M<E;M++){const P=f.get(M),R=this.getSymbolInstanceIconSize(o,u,S);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,R,P.padding)}}updateCollisionDebugBuffers(o,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=Cp(this.iconSizeData,o),_=Cp(this.textSizeData,o);for(let E=0;E<this.symbolInstances.length;E++){const S=this.symbolInstances.get(E);this._updateTextDebugCollisionBoxes(_,o,u,S.textBoxStartIndex,S.textBoxEndIndex,S),this._updateTextDebugCollisionBoxes(_,o,u,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S),this._updateIconDebugCollisionBoxes(f,o,u,S.iconBoxStartIndex,S.iconBoxEndIndex,S.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(f,o,u,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,u,f,_,E,S,M,P,R){const z={};if(u<f){const{x1:U,y1:G,x2:q,y2:W,padding:re,projectedAnchorX:ve,projectedAnchorY:ke,projectedAnchorZ:et,tileAnchorX:Be,tileAnchorY:Je,featureIndex:nt}=o.get(u);z.textBox={x1:U,y1:G,x2:q,y2:W,padding:re,projectedAnchorX:ve,projectedAnchorY:ke,projectedAnchorZ:et,tileAnchorX:Be,tileAnchorY:Je},z.textFeatureIndex=nt}if(_<E){const{x1:U,y1:G,x2:q,y2:W,padding:re,projectedAnchorX:ve,projectedAnchorY:ke,projectedAnchorZ:et,tileAnchorX:Be,tileAnchorY:Je,featureIndex:nt}=o.get(_);z.verticalTextBox={x1:U,y1:G,x2:q,y2:W,padding:re,projectedAnchorX:ve,projectedAnchorY:ke,projectedAnchorZ:et,tileAnchorX:Be,tileAnchorY:Je},z.verticalTextFeatureIndex=nt}if(S<M){const{x1:U,y1:G,x2:q,y2:W,padding:re,projectedAnchorX:ve,projectedAnchorY:ke,projectedAnchorZ:et,tileAnchorX:Be,tileAnchorY:Je,featureIndex:nt}=o.get(S);z.iconBox={x1:U,y1:G,x2:q,y2:W,padding:re,projectedAnchorX:ve,projectedAnchorY:ke,projectedAnchorZ:et,tileAnchorX:Be,tileAnchorY:Je},z.iconFeatureIndex=nt}if(P<R){const{x1:U,y1:G,x2:q,y2:W,padding:re,projectedAnchorX:ve,projectedAnchorY:ke,projectedAnchorZ:et,tileAnchorX:Be,tileAnchorY:Je,featureIndex:nt}=o.get(P);z.verticalIconBox={x1:U,y1:G,x2:q,y2:W,padding:re,projectedAnchorX:ve,projectedAnchorY:ke,projectedAnchorZ:et,tileAnchorX:Be,tileAnchorY:Je},z.verticalIconFeatureIndex=nt}return z}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,u){const f=o.placedSymbolArray.get(u),_=f.vertexStartIndex+4*f.numGlyphs;for(let E=f.vertexStartIndex;E<_;E+=4)o.indexArray.emplaceBack(E,E+1,E+2),o.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const u=Math.sin(o),f=Math.cos(o),_=[],E=[],S=[];for(let M=0;M<this.symbolInstances.length;++M){S.push(M);const P=this.symbolInstances.get(M);_.push(0|Math.round(u*P.tileAnchorX+f*P.tileAnchorY)),E.push(P.featureIndex)}return S.sort((M,P)=>_[M]-_[P]||E[P]-E[M]),S}addToSortKeyRanges(o,u){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const f=this.symbolInstances.get(u);this.featureSortOrder.push(f.featureIndex);const{rightJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:E,leftJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:M,placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:R}=f;_>=0&&this.addIndicesForPlacedSymbol(this.text,_),E>=0&&E!==_&&this.addIndicesForPlacedSymbol(this.text,E),S>=0&&S!==E&&S!==_&&this.addIndicesForPlacedSymbol(this.text,S),M>=0&&this.addIndicesForPlacedSymbol(this.text,M),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P),R>=0&&this.addIndicesForPlacedSymbol(this.icon,R)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Tn(fh,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),fh.MAX_GLYPHS=65535,fh.addDynamicAttributes=Lp;const gC=new He({"symbol-placement":new te(Wt.layout_symbol["symbol-placement"]),"symbol-spacing":new te(Wt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new te(Wt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Se(Wt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new te(Wt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new te(Wt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new te(Wt.layout_symbol["icon-ignore-placement"]),"icon-optional":new te(Wt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new te(Wt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Se(Wt.layout_symbol["icon-size"]),"icon-text-fit":new te(Wt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new te(Wt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Se(Wt.layout_symbol["icon-image"]),"icon-rotate":new Se(Wt.layout_symbol["icon-rotate"]),"icon-padding":new te(Wt.layout_symbol["icon-padding"]),"icon-keep-upright":new te(Wt.layout_symbol["icon-keep-upright"]),"icon-offset":new Se(Wt.layout_symbol["icon-offset"]),"icon-anchor":new Se(Wt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new te(Wt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new te(Wt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new te(Wt.layout_symbol["text-rotation-alignment"]),"text-field":new Se(Wt.layout_symbol["text-field"]),"text-font":new Se(Wt.layout_symbol["text-font"]),"text-size":new Se(Wt.layout_symbol["text-size"]),"text-max-width":new Se(Wt.layout_symbol["text-max-width"]),"text-line-height":new Se(Wt.layout_symbol["text-line-height"]),"text-letter-spacing":new Se(Wt.layout_symbol["text-letter-spacing"]),"text-justify":new Se(Wt.layout_symbol["text-justify"]),"text-radial-offset":new Se(Wt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new te(Wt.layout_symbol["text-variable-anchor"]),"text-anchor":new Se(Wt.layout_symbol["text-anchor"]),"text-max-angle":new te(Wt.layout_symbol["text-max-angle"]),"text-writing-mode":new te(Wt.layout_symbol["text-writing-mode"]),"text-rotate":new Se(Wt.layout_symbol["text-rotate"]),"text-padding":new te(Wt.layout_symbol["text-padding"]),"text-keep-upright":new te(Wt.layout_symbol["text-keep-upright"]),"text-transform":new Se(Wt.layout_symbol["text-transform"]),"text-offset":new Se(Wt.layout_symbol["text-offset"]),"text-allow-overlap":new te(Wt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new te(Wt.layout_symbol["text-ignore-placement"]),"text-optional":new te(Wt.layout_symbol["text-optional"])});var u_={paint:new He({"icon-opacity":new Se(Wt.paint_symbol["icon-opacity"]),"icon-color":new Se(Wt.paint_symbol["icon-color"]),"icon-halo-color":new Se(Wt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Se(Wt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Se(Wt.paint_symbol["icon-halo-blur"]),"icon-translate":new te(Wt.paint_symbol["icon-translate"]),"icon-translate-anchor":new te(Wt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Se(Wt.paint_symbol["text-opacity"]),"text-color":new Se(Wt.paint_symbol["text-color"],{runtimeType:$a,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Se(Wt.paint_symbol["text-halo-color"]),"text-halo-width":new Se(Wt.paint_symbol["text-halo-width"]),"text-halo-blur":new Se(Wt.paint_symbol["text-halo-blur"]),"text-translate":new te(Wt.paint_symbol["text-translate"]),"text-translate-anchor":new te(Wt.paint_symbol["text-translate-anchor"])}),layout:gC};class Ex{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:ws,this.defaultValue=o}evaluate(o){if(o.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(o.formattedSection))return u.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Tn(Ex,"FormatSectionOverride",{omit:["defaultValue"]});class zg extends oh{constructor(o){super(o,u_)}recalculate(o,u){super.recalculate(o,u),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const f=this.layout.get("text-writing-mode");if(f){const _=[];for(const E of f)_.indexOf(E)<0&&_.push(E);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(o,u,f,_){const E=this.layout.get(o).evaluate(u,{},f,_),S=this._unevaluatedLayout._values[o];return S.isDataDriven()||ai(S.value)||!E?E:(M=u.properties,E.replace(/{([^{}]+)}/g,(R,z)=>z in M?String(M[z]):""));var M}createBucket(o){return new fh(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of u_.paint.overridableProperties){if(!zg.hasPaintOverride(this.layout,o))continue;const u=this.paint.get(o),f=new Ex(u),_=new $u(f,u.property.specification);let E=null;E="constant"===u.value.kind||"source"===u.value.kind?new Nu("source",_):new Pr("composite",_,u.value.zoomStops,u.value._interpolationType),this.paint._values[o]=new Ce(u.property,E,u.parameters)}}_handleOverridablePaintPropertyUpdate(o,u,f){return!(!this.layout||u.isDataDriven()||f.isDataDriven())&&zg.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,u){const f=o.get("text-field"),_=u_.paint.properties[u];let E=!1;const S=M=>{for(const P of M)if(_.overrides&&_.overrides.hasOverride(P))return void(E=!0)};if("constant"===f.value.kind&&f.value.value instanceof zo)S(f.value.value.sections);else if("source"===f.value.kind){const M=R=>{E||(R instanceof Ws&&Es(R.value)===Ni?S(R.value.sections):R instanceof Tl?S(R.sections):R.eachChild(M))},P=f.value;P._styleExpression&&M(P._styleExpression.expression)}return E}getProgramConfiguration(o){return new od(this,o)}}var XI={paint:new He({"background-color":new te(Wt.paint_background["background-color"]),"background-pattern":new te(Wt.paint_background["background-pattern"]),"background-opacity":new te(Wt.paint_background["background-opacity"])})},mC={paint:new He({"raster-opacity":new te(Wt.paint_raster["raster-opacity"]),"raster-hue-rotate":new te(Wt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new te(Wt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new te(Wt.paint_raster["raster-brightness-max"]),"raster-saturation":new te(Wt.paint_raster["raster-saturation"]),"raster-contrast":new te(Wt.paint_raster["raster-contrast"]),"raster-resampling":new te(Wt.paint_raster["raster-resampling"]),"raster-fade-duration":new te(Wt.paint_raster["raster-fade-duration"])})};class c_ extends oh{constructor(o){super(o,{}),this.implementation=o}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}var _C={paint:new He({"sky-type":new te(Wt.paint_sky["sky-type"]),"sky-atmosphere-sun":new te(Wt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new te(Wt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new te(Wt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new te(Wt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ue(Wt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new te(Wt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new te(Wt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new te(Wt.paint_sky["sky-opacity"])})};function Jd(a,o,u){const f=[0,0,1],_=wy([]);return Cy(_,_,u?-rt(a)+Math.PI:rt(a)),Ey(_,_,-rt(o)),S1(f,f,_),_l(f,f)}const Yo={circle:class extends oh{constructor(a){super(a,bE)}createBucket(a){return new Xd(a)}queryRadius(a){const o=a;return Df("circle-radius",this,o)+Df("circle-stroke-width",this,o)+Ly(this.paint.get("circle-translate"))}queryIntersectsFeature(a,o,u,f,_,E,S,M){const P=vE(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),E.angle,a.pixelToTileUnitsFactor),R=this.paint.get("circle-radius").evaluate(o,u)+this.paint.get("circle-stroke-width").evaluate(o,u);return Lm(a,f,E,S,M,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),P,R)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new od(this,a)}},heatmap:class extends oh{createBucket(a){return new EE(a)}constructor(a){super(a,km),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Fm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Df("heatmap-radius",this,a)}queryIntersectsFeature(a,o,u,f,_,E,S,M){const P=this.paint.get("heatmap-radius").evaluate(o,u);return Lm(a,f,E,S,M,!0,!0,new ne(0,0),P)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new od(this,a)}},hillshade:class extends oh{constructor(a){super(a,F1)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends oh{constructor(a){super(a,U1)}getProgramIds(){const a=this.paint.get("fill-pattern"),o=a&&a.constantOr(1),u=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&u.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),u}getProgramConfiguration(a){return new od(this,a)}recalculate(a,o){super.recalculate(a,o);const u=this.paint._values["fill-outline-color"];"constant"===u.value.kind&&void 0===u.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Um(a)}queryRadius(){return Ly(this.paint.get("fill-translate"))}queryIntersectsFeature(a,o,u,f,_,E){return!a.queryGeometry.isAboveHorizon&&_E(ky(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),E.angle,a.pixelToTileUnitsFactor),f)}isTileClipped(){return!0}},"fill-extrusion":class extends oh{constructor(a){super(a,Ig)}createBucket(a){return new Tg(a)}queryRadius(){return Ly(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new od(this,a)}queryIntersectsFeature(a,o,u,f,_,E,S,M,P){const R=vE(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),E.angle,a.pixelToTileUnitsFactor),z=this.paint.get("fill-extrusion-height").evaluate(o,u),U=this.paint.get("fill-extrusion-base").evaluate(o,u),G=[0,0],q=M&&E.elevation,W=E.elevation?E.elevation.exaggeration():1,re=a.tile.getBucket(this);if(q&&re instanceof Tg){const Je=re.centroidVertexArray,nt=P+1;nt<Je.length&&(G[0]=Je.geta_centroid_pos0(nt),G[1]=Je.geta_centroid_pos1(nt))}if(0===G[0]&&1===G[1])return!1;"globe"===E.projection.name&&(f=e0([f],[new ne(0,0),new ne(pr,pr)],a.tileID.canonical).map(Je=>Je.polygon).flat());const ve=q?M:null,[ke,et]=(nt=f,ot=U,zt=z,Rt=R,Xt=S,_n=ve,jt=G,tn=W,nn=E.center.lat,"globe"===(Je=E).projection.name?function(wn,Zt,On,Wn,kn,qr,Cn,fr,Dr,Pi,Wr){const xr=[],ls=[],Zr=wn.projection.upVectorScale(Wr,wn.center.lat,wn.worldSize).metersToTile,Xr=[0,0,0,1],Do=[0,0,0,1],Fo=(Bo,Ts,js,la)=>{Bo[0]=Ts,Bo[1]=js,Bo[2]=la,Bo[3]=1},us=qm();On>0&&(On+=us),Wn+=us;for(const Bo of Zt){const Ts=[],js=[];for(const la of Bo){const Ao=la.x+kn.x,cs=la.y+kn.y,Ia=wn.projection.projectTilePoint(Ao,cs,Wr),Gs=wn.projection.upVector(Wr,la.x,la.y);let ki=On,Ma=Wn;if(Cn){const Ko=Y1(Ao,cs,On,Wn,Cn,fr,Dr,Pi);ki+=Ko.base,Ma+=Ko.top}0!==On?Fo(Xr,Ia.x+Gs[0]*Zr*ki,Ia.y+Gs[1]*Zr*ki,Ia.z+Gs[2]*Zr*ki):Fo(Xr,Ia.x,Ia.y,Ia.z),Fo(Do,Ia.x+Gs[0]*Zr*Ma,Ia.y+Gs[1]*Zr*Ma,Ia.z+Gs[2]*Zr*Ma),ea(Xr,Xr,qr),ea(Do,Do,qr),Ts.push(new Oh(Xr[0],Xr[1],Xr[2])),js.push(new Oh(Do[0],Do[1],Do[2]))}xr.push(Ts),ls.push(js)}return[xr,ls]}(Je,nt,ot,zt,Rt,Xt,_n,jt,tn,nn,a.tileID.canonical):_n?function(wn,Zt,On,Wn,kn,qr,Cn,fr,Dr){const Pi=[],Wr=[],xr=[0,0,0,1];for(const ls of wn){const Zr=[],Xr=[];for(const Do of ls){const Fo=Do.x+Wn.x,us=Do.y+Wn.y,Bo=Y1(Fo,us,Zt,On,qr,Cn,fr,Dr);xr[0]=Fo,xr[1]=us,xr[2]=Bo.base,xr[3]=1,ud(xr,xr,kn),xr[3]=Math.max(xr[3],1e-5);const Ts=new Oh(xr[0]/xr[3],xr[1]/xr[3],xr[2]/xr[3]);xr[0]=Fo,xr[1]=us,xr[2]=Bo.top,xr[3]=1,ud(xr,xr,kn),xr[3]=Math.max(xr[3],1e-5);const js=new Oh(xr[0]/xr[3],xr[1]/xr[3],xr[2]/xr[3]);Zr.push(Ts),Xr.push(js)}Pi.push(Zr),Wr.push(Xr)}return[Pi,Wr]}(nt,ot,zt,Rt,Xt,_n,jt,tn,nn):function(wn,Zt,On,Wn,kn){const qr=[],Cn=[],fr=kn[8]*Zt,Dr=kn[9]*Zt,Pi=kn[10]*Zt,Wr=kn[11]*Zt,xr=kn[8]*On,ls=kn[9]*On,Zr=kn[10]*On,Xr=kn[11]*On;for(const Do of wn){const Fo=[],us=[];for(const Bo of Do){const Ts=Bo.x+Wn.x,js=Bo.y+Wn.y,la=kn[0]*Ts+kn[4]*js+kn[12],Ao=kn[1]*Ts+kn[5]*js+kn[13],cs=kn[2]*Ts+kn[6]*js+kn[14],Ia=kn[3]*Ts+kn[7]*js+kn[15],Gs=la+fr,ki=Ao+Dr,Ma=cs+Pi,Ko=Math.max(Ia+Wr,1e-5),Eu=la+xr,Ba=Ao+ls,cl=cs+Zr,hl=Math.max(Ia+Xr,1e-5);Fo.push(new Oh(Gs/Ko,ki/Ko,Ma/Ko)),us.push(new Oh(Eu/hl,Ba/hl,cl/hl))}qr.push(Fo),Cn.push(us)}return[qr,Cn]}(nt,ot,zt,Rt,Xt)),Be=a.queryGeometry;var Je,nt,ot,zt,Rt,Xt,_n,jt,tn,nn;return function(Je,nt,ot){let zt=1/0;_E(ot,nt)&&(zt=n0(ot,nt[0]));for(let Rt=0;Rt<nt.length;Rt++){const Xt=nt[Rt],_n=Je[Rt];for(let jt=0;jt<Xt.length-1;jt++){const tn=Xt[jt],nn=[tn,Xt[jt+1],_n[jt+1],_n[jt],tn];gp(ot,nn)&&(zt=Math.min(zt,n0(ot,nn)))}}return zt!==1/0&&zt}(ke,et,Be.isPointQuery()?Be.screenBounds:Be.screenGeometry)}},line:class extends oh{constructor(a){super(a,Q1),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof rl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,o){super.recalculate(a,o),this.paint._values["line-floorwidth"]=jE.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new pd(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new od(this,a)}queryRadius(a){const o=a,u=ex(Df("line-width",this,o),Df("line-gap-width",this,o)),f=Df("line-offset",this,o);return u/2+Math.abs(f)+Ly(this.paint.get("line-translate"))}queryIntersectsFeature(a,o,u,f,_,E){if(a.queryGeometry.isAboveHorizon)return!1;const S=ky(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),E.angle,a.pixelToTileUnitsFactor),M=a.pixelToTileUnitsFactor/2*ex(this.paint.get("line-width").evaluate(o,u),this.paint.get("line-gap-width").evaluate(o,u)),P=this.paint.get("line-offset").evaluate(o,u);return P&&(f=function(R,z){const U=[],G=new ne(0,0);for(let q=0;q<R.length;q++){const W=R[q],re=[];for(let ve=0;ve<W.length;ve++){const ke=W[ve],et=W[ve+1],Be=0===ve?G:ke.sub(W[ve-1])._unit()._perp(),Je=ve===W.length-1?G:et.sub(ke)._unit()._perp(),nt=Be._add(Je)._unit();nt._mult(1/(nt.x*Je.x+nt.y*Je.y)),re.push(nt._mult(z)._add(ke))}U.push(re)}return U}(f,P*a.pixelToTileUnitsFactor)),function(R,z,U){for(let G=0;G<z.length;G++){const q=z[G];if(R.length>=3)for(let W=0;W<q.length;W++)if(Ph(R,q[W]))return!0;if(R1(R,q,U))return!0}return!1}(S,f,M)}isTileClipped(){return!0}},symbol:zg,background:class extends oh{constructor(a){super(a,XI)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends oh{constructor(a){super(a,mC)}getProgramIds(){return["raster"]}},sky:class extends oh{constructor(a){super(a,_C),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Fm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(a,o){if("atmosphere"===this.paint.get("sky-type")){const f=this.paint.get("sky-atmosphere-sun"),_=!f,E=a.style.light,S=E.properties.get("position");return _&&"viewport"===E.properties.get("anchor")&&gr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),_?Jd(S.azimuthal,90-S.polar,o):Jd(f[0],90-f[1],o)}const u=this.paint.get("sky-gradient-center");return Jd(u[0],90-u[1],o)}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}};class Vg{constructor(o,u,f,_){this.context=o,this.format=f,this.texture=o.gl.createTexture(),this.update(u,_)}update(o,u,f){const{width:_,height:E}=o,{context:S}=this,{gl:M}=S,{HTMLImageElement:P,HTMLCanvasElement:R,HTMLVideoElement:z,ImageData:U,ImageBitmap:G}=be;if(M.bindTexture(M.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!u||!1!==u.premultiply)),f||this.size&&this.size[0]===_&&this.size[1]===E){const{x:q,y:W}=f||{x:0,y:0};o instanceof P||o instanceof R||o instanceof z||o instanceof U||G&&o instanceof G?M.texSubImage2D(M.TEXTURE_2D,0,q,W,M.RGBA,M.UNSIGNED_BYTE,o):M.texSubImage2D(M.TEXTURE_2D,0,q,W,_,E,M.RGBA,M.UNSIGNED_BYTE,o.data)}else this.size=[_,E],o instanceof P||o instanceof R||o instanceof z||o instanceof U||G&&o instanceof G?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,o):M.texImage2D(M.TEXTURE_2D,0,this.format,_,E,0,this.format,M.UNSIGNED_BYTE,o.data);this.useMipmap=!!(u&&u.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&M.generateMipmap(M.TEXTURE_2D)}bind(o,u){const{context:f}=this,{gl:_}=f;_.bindTexture(_.TEXTURE_2D,this.texture),o!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,o),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap?o===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_NEAREST:o),this.filter=o),u!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,u),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class C0{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Ju{constructor(){this.tasks={},this.taskQueue=[],Nn(["process"],this),this.invoker=new C0(this.process),this.nextId=0}add(o,u){const f=this.nextId++,_=function({type:E,isSymbolTile:S,zoom:M}){return M=M||0,"message"===E?0:"maybePrepare"!==E||S?"parseTile"!==E||S?"parseTile"===E&&S?300-M:"maybePrepare"===E&&S?400-M:500:200-M:100-M}(u);if(0===_){lr();try{o()}finally{}return{cancel:()=>{}}}return this.tasks[f]={fn:o,metadata:u,priority:_,id:f},this.taskQueue.push(f),this.invoker.trigger(),{cancel:()=>{delete this.tasks[f]}}}process(){lr();try{if(this.taskQueue=this.taskQueue.filter(f=>!!this.tasks[f]),!this.taskQueue.length)return;const o=this.pick();if(null===o)return;const u=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!u)return;u.fn()}finally{}}pick(){let o=null,u=1/0;for(let _=0;_<this.taskQueue.length;_++){const E=this.tasks[this.taskQueue[_]];E.priority<u&&(u=E.priority,o=_)}if(null===o)return null;const f=this.taskQueue[o];return this.taskQueue.splice(o,1),f}remove(){this.invoker.remove()}}class Cx{constructor(o){this._stringToNumber={},this._numberToString=[];for(let u=0;u<o.length;u++){const f=o[u];this._stringToNumber[f]=u,this._numberToString[u]=f}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const yC=["tile","layer","source","sourceLayer","state"];class kp{constructor(o,u,f,_,E){this.type="Feature",this._vectorTileFeature=o,this._z=u,this._x=f,this._y=_,this.properties=o.properties,this.id=E}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(o.id=this.id);for(const u of yC)void 0!==this[u]&&(o[u]=this[u]);return o}}const Gc=new Uint16Array(8184);for(let a=0;a<2046;a++){let o=a+2,u=0,f=0,_=0,E=0,S=0,M=0;for(1&o?_=E=S=32:u=f=M=32;(o>>=1)>1;){const R=u+_>>1,z=f+E>>1;1&o?(_=u,E=f,u=S,f=M):(u=_,f=E,_=S,E=M),S=R,M=z}const P=4*a;Gc[P+0]=u,Gc[P+1]=f,Gc[P+2]=_,Gc[P+3]=E}const ph=new Uint16Array(2178),Bf=new Uint8Array(1089),Fp=new Uint16Array(1089);function Qd(a){return 0===a?-.03125:32===a?.03125:0}var Ug=xt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const S0={type:2,extent:pr,loadGeometry:()=>[[new ne(0,0),new ne(pr+1,0),new ne(pr+1,pr+1),new ne(0,pr+1),new ne(0,0)]]};class h_{constructor(o,u,f,_,E){this.tileID=o,this.uid=It(),this.uses=0,this.tileSize=u,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=E,this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection)}registerFadeDuration(o){const u=o+this.timeAdded;u<Na.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=kh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,u,f){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(_,E){const S={};if(!E)return S;for(const M of _){const P=M.layerIds.map(R=>E.getLayer(R)).filter(Boolean);if(0!==P.length){M.layers=P,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(R=>P.filter(z=>z.id===R)[0]));for(const R of P)S[R.id]=M}}return S}(o.buckets,u.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const E=this.buckets[_];if(E instanceof fh){if(this.hasSymbolBuckets=!0,!f)break;E.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const E=this.buckets[_];if(E instanceof fh&&E.hasRTLText){this.hasRTLText=!0,F.isLoading()||F.isLoaded()||"deferred"!==A()||L();break}}this.queryPadding=0;for(const _ in this.buckets){const E=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(_).queryRadius(E))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas)}else this.collisionBoxArray=new $o}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(o){return this.buckets[o.id]}upload(o){for(const f in this.buckets){const _=this.buckets[f];_.uploadPending()&&_.upload(o)}const u=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Vg(o,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Vg(o,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Vg(o,this.lineAtlas.image,u.ALPHA),this.lineAtlas.uploaded=!0)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,u,f,_,E,S,M,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:_,pixelPosMatrix:M,transform:S,params:E,tileTransform:this.tileTransform},o,u,f):{}}querySourceFeatures(o,u){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const _=f.loadVTLayers(),E=u?u.sourceLayer:"",S=_._geojsonTileLayer||_[E];if(!S)return;const M=nh(u&&u.filter),{z:P,x:R,y:z}=this.tileID.canonical,U={z:P,x:R,y:z};for(let G=0;G<S.length;G++){const q=S.feature(G);if(M.needGeometry){const ve=Zd(q,!0);if(!M.filter(new V(this.tileID.overscaledZ),ve,this.tileID.canonical))continue}else if(!M.filter(new V(this.tileID.overscaledZ),q))continue;const W=f.getId(q,E),re=new kp(q,P,R,z,W);re.tile=U,o.push(re)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const u=this.expirationTime;if(o.cacheControl){const f=ye(o.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const f=Date.now();let _=!1;if(this.expirationTime>f)_=!1;else if(u)if(this.expirationTime<u)_=!0;else{const E=this.expirationTime-u;E?this.expirationTime=f+Math.max(E,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length||!u)return;const f=this.latestFeatureIndex.loadVTLayers(),_=u.style.listImages();for(const E in this.buckets){if(!u.style.hasLayer(E))continue;const S=this.buckets[E],M=S.layers[0].sourceLayer||"_geojsonTileLayer",P=f[M],R=o[M];if(!P||!R||0===Object.keys(R).length)continue;if(S.update(R,P,_,this.imageAtlas&&this.imageAtlas.patternPositions||{}),S instanceof pd||S instanceof Um){const U=u.style._getSourceCache(S.layers[0].source);u._terrain&&u._terrain.enabled&&U&&S.programConfigurations.needsUpload&&u._terrain._clearRenderCacheForTile(U.id,this.tileID)}const z=u&&u.style&&u.style.getLayer(E);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(S)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Na.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=Na.now()+o}setTexture(o,u){const f=u.context,_=f.gl;this.texture=this.texture||u.getTileTexture(o.width),this.texture?this.texture.update(o,{useMipmap:!0}):(this.texture=new Vg(f,o,_.RGBA,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(o,u){const f={};for(const _ of u)f[_]=!0;this.dependencies[o]=f}hasDependency(o,u){for(const f of o){const _=this.dependencies[f];if(_)for(const E of u)if(_[E])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,u){if(!u||"mercator"===u.name||this._tileDebugBuffer)return;const f=Lc(S0,this.tileID.canonical,this.tileTransform)[0],_=new Qt,E=new Wu;for(let S=0;S<f.length;S++){const{x:M,y:P}=f[S];_.emplaceBack(M,P),E.emplaceBack(S)}E.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(E),this._tileDebugBuffer=o.createVertexBuffer(_,gg.members),this._tileDebugSegments=Sa.simpleSegment(0,0,_.length,E.length)}_makeTileBoundsBuffers(o,u){if(this._tileBoundsBuffer||!u||"mercator"===u.name)return;const f=Lc(S0,this.tileID.canonical,this.tileTransform)[0];let _,E;if(this.isRaster){const S=function(M,P){const R=kh(M,P),z=Math.pow(2,M.z);for(let ve=0;ve<33;ve++)for(let ke=0;ke<33;ke++){const et=_c((M.x+(ke+Qd(ke))/32)/z),Be=Rl((M.y+(ve+Qd(ve))/32)/z),Je=P.project(et,Be),nt=33*ve+ke;ph[2*nt+0]=Math.round((Je.x*R.scale-R.x)*pr),ph[2*nt+1]=Math.round((Je.y*R.scale-R.y)*pr)}Bf.fill(0),Fp.fill(0);for(let ve=2045;ve>=0;ve--){const ke=4*ve,et=Gc[ke+0],Be=Gc[ke+1],Je=Gc[ke+2],nt=Gc[ke+3],ot=et+Je>>1,zt=Be+nt>>1,Rt=ot+zt-Be,Xt=zt+et-ot,_n=33*Be+et,jt=33*nt+Je,tn=33*zt+ot,nn=Math.hypot((ph[2*_n+0]+ph[2*jt+0])/2-ph[2*tn+0],(ph[2*_n+1]+ph[2*jt+1])/2-ph[2*tn+1])>=16;Bf[tn]=Bf[tn]||(nn?1:0),ve<1022&&(Bf[tn]=Bf[tn]||Bf[33*(Be+Xt>>1)+(et+Rt>>1)]||Bf[33*(nt+Xt>>1)+(Je+Rt>>1)])}const U=new Jt,G=new nr;let q=0;function W(ve,ke){const et=33*ke+ve;return 0===Fp[et]&&(U.emplaceBack(ph[2*et+0],ph[2*et+1],ve*pr/32,ke*pr/32),Fp[et]=++q),Fp[et]-1}function re(ve,ke,et,Be,Je,nt){const ot=ve+et>>1,zt=ke+Be>>1;if(Math.abs(ve-Je)+Math.abs(ke-nt)>1&&Bf[33*zt+ot])re(Je,nt,ve,ke,ot,zt),re(et,Be,Je,nt,ot,zt);else{const Rt=W(ve,ke),Xt=W(et,Be),_n=W(Je,nt);G.emplaceBack(Rt,Xt,_n)}}return re(0,0,32,32,32,0),re(32,32,0,0,0,32),{vertices:U,indices:G}}(this.tileID.canonical,u);_=S.vertices,E=S.indices}else{_=new Jt,E=new nr;for(const{x:M,y:P}of f)_.emplaceBack(M,P,0,0);const S=Vm(_.int16,void 0,4);for(let M=0;M<S.length;M+=3)E.emplaceBack(S[M],S[M+1],S[M+2])}this._tileBoundsBuffer=o.createVertexBuffer(_,Ug.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(E),this._tileBoundsSegments=Sa.simpleSegment(0,0,_.length,E.length)}_makeGlobeTileDebugBuffers(o,u){const f=u.projection;if(!f||"globe"!==f.name||u.freezeTileCoverage)return;const _=this.tileID.canonical,E=mg(fE(_,u)),S=Cf(u.zoom);let M;S>0&&(M=op(new Float64Array(16),u.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,_,u,E,M,S),this._makeGlobeTileDebugTextBuffer(o,_,u,E,M,S)}_globePoint(o,u,f,_,E,S,M){let P=Ta(o,u,f);if(S){const R=1<<f.z,z=lh(_.center.lng),U=Nh(_.center.lat),G=(f.x+.5)/R-z;let q=0;G>.5?q=-1:G<-.5&&(q=1);let W=(o/pr+f.x)/R+q,re=(u/pr+f.y)/R;W=(W-z)*_._pixelsPerMercatorPixel+z,re=(re-U)*_._pixelsPerMercatorPixel+U;const ve=[W*_.worldSize,re*_.worldSize,0];ea(ve,ve,S),P=cp(P,ve,M)}return ea(P,P,E)}_makeGlobeTileDebugBorderBuffer(o,u,f,_,E,S){const M=new Qt,P=new Wu,R=new Nt,z=(G,q,W,re,ve)=>{const ke=(W-G)/(ve-1),et=(re-q)/(ve-1),Be=M.length;for(let Je=0;Je<ve;Je++){const nt=G+Je*ke,ot=q+Je*et;M.emplaceBack(nt,ot);const zt=this._globePoint(nt,ot,u,f,_,E,S);R.emplaceBack(zt[0],zt[1],zt[2]),P.emplaceBack(Be+Je)}},U=pr;z(0,0,U,0,16),z(U,0,U,U,16),z(U,U,0,U,16),z(0,U,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(P),this._tileDebugBuffer=o.createVertexBuffer(M,gg.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(R,Hd.members),this._tileDebugSegments=Sa.simpleSegment(0,0,M.length,P.length)}_makeGlobeTileDebugTextBuffer(o,u,f,_,E,S){const M=pr/4,P=new Qt,R=new nr,z=new Nt,U=25;R.reserve(32),P.reserve(U),z.reserve(U);const G=(q,W)=>U*q+W;for(let q=0;q<U;q++){const W=q*M;for(let re=0;re<U;re++){const ve=re*M;P.emplaceBack(ve,W);const ke=this._globePoint(ve,W,u,f,_,E,S);z.emplaceBack(ke[0],ke[1],ke[2])}}for(let q=0;q<4;q++)for(let W=0;W<4;W++){const re=G(q,W),ve=G(q,W+1),ke=G(q+1,W),et=G(q+1,W+1);R.emplaceBack(re,ve,ke),R.emplaceBack(ke,ve,et)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(R),this._tileDebugTextBuffer=o.createVertexBuffer(P,gg.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(z,Hd.members),this._tileDebugTextSegments=Sa.simpleSegment(0,0,U,32)}}class vC{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,u,f){const _=String(u);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][_]=this.stateChanges[o][_]||{},Ie(this.stateChanges[o][_],f),null===this.deletedStates[o]){this.deletedStates[o]={};for(const E in this.state[o])E!==_&&(this.deletedStates[o][E]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][_]){this.deletedStates[o][_]={};for(const E in this.state[o][_])f[E]||(this.deletedStates[o][_][E]=null)}else for(const E in f)this.deletedStates[o]&&this.deletedStates[o][_]&&null===this.deletedStates[o][_][E]&&delete this.deletedStates[o][_][E]}removeFeatureState(o,u,f){if(null===this.deletedStates[o])return;const _=String(u);if(this.deletedStates[o]=this.deletedStates[o]||{},f&&void 0!==u)null!==this.deletedStates[o][_]&&(this.deletedStates[o][_]=this.deletedStates[o][_]||{},this.deletedStates[o][_][f]=null);else if(void 0!==u)if(this.stateChanges[o]&&this.stateChanges[o][_])for(f in this.deletedStates[o][_]={},this.stateChanges[o][_])this.deletedStates[o][_][f]=null;else this.deletedStates[o][_]=null;else this.deletedStates[o]=null}getState(o,u){const f=String(u),_=Ie({},(this.state[o]||{})[f],(this.stateChanges[o]||{})[f]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const E=this.deletedStates[o][u];if(null===E)return{};for(const S in E)delete _[S]}return _}initializeTileState(o,u){o.setFeatureState(this.state,u)}coalesceChanges(o,u){const f={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const E={};for(const S in this.stateChanges[_])this.state[_][S]||(this.state[_][S]={}),Ie(this.state[_][S],this.stateChanges[_][S]),E[S]=this.state[_][S];f[_]=E}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const E={};if(null===this.deletedStates[_])for(const S in this.state[_])E[S]={},this.state[_][S]={};else for(const S in this.deletedStates[_]){if(null===this.deletedStates[_][S])this.state[_][S]={};else if(this.state[_][S])for(const M of Object.keys(this.deletedStates[_][S]))delete this.state[_][S][M];E[S]=this.state[_][S]}f[_]=f[_]||{},Ie(f[_],E)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(f).length)for(const _ in o)o[_].setFeatureState(f,u)}}class Sx{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,u){const f=this.toIdx(o,u);return{min:this.minimums[f],max:this.maximums[f]}}isLeaf(o,u){return this.leaves[this.toIdx(o,u)]}toIdx(o,u){return u*this.size+o}}function Dx(a,o,u,f){let _=0,E=Number.MAX_VALUE;for(let S=0;S<3;S++)if(Math.abs(f[S])<1e-15){if(u[S]<a[S]||u[S]>o[S])return null}else{const M=1/f[S];let P=(a[S]-u[S])*M,R=(o[S]-u[S])*M;if(P>R){const z=P;P=R,R=z}if(P>_&&(_=P),R<E&&(E=R),_>E)return null}return _}function Tx(a,o,u,f,_,E,S,M,P,R,z){const U=f-a,G=_-o,q=E-u,W=S-a,re=M-o,ve=P-u,ke=z[1]*ve-z[2]*re,et=z[2]*W-z[0]*ve,Be=z[0]*re-z[1]*W,Je=U*ke+G*et+q*Be;if(Math.abs(Je)<1e-15)return null;const nt=1/Je,ot=R[0]-a,zt=R[1]-o,Rt=R[2]-u,Xt=(ot*ke+zt*et+Rt*Be)*nt;if(Xt<0||Xt>1)return null;const _n=zt*q-Rt*G,jt=Rt*U-ot*q,tn=ot*G-zt*U,nn=(z[0]*_n+z[1]*jt+z[2]*tn)*nt;return nn<0||Xt+nn>1?null:(W*_n+re*jt+ve*tn)*nt}function Ix(a,o,u){return(a-o)/(u-o)}function Mx(a,o,u,f,_,E,S,M,P){const R=1<<u,z=E-f,U=S-_,G=(a+1)/R*z+f,q=(o+0)/R*U+_,W=(o+1)/R*U+_;M[0]=(a+0)/R*z+f,M[1]=q,P[0]=G,P[1]=W}class D0{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const u=function(E){const S=Math.ceil(Math.log2(E.dim/8)),M=[];let P=Math.ceil(Math.pow(2,S));const R=1/P,z=(q,W,re,ve,ke)=>{const et=ve?1:0,Be=(q+1)*re-et,Je=W*re,nt=(W+1)*re-et;ke[0]=q*re,ke[1]=Je,ke[2]=Be,ke[3]=nt};let U=new Sx(P);const G=[];for(let q=0;q<P*P;q++){z(q%P,Math.floor(q/P),R,!1,G);const W=bu(G[0],G[1],E),re=bu(G[2],G[1],E),ve=bu(G[2],G[3],E),ke=bu(G[0],G[3],E);U.minimums.push(Math.min(W,re,ve,ke)),U.maximums.push(Math.max(W,re,ve,ke)),U.leaves.push(1)}for(M.push(U),P/=2;P>=1;P/=2){const q=M[M.length-1];U=new Sx(P);for(let W=0;W<P*P;W++){z(W%P,Math.floor(W/P),2,!0,G);const re=q.getElevation(G[0],G[1]),ve=q.getElevation(G[2],G[1]),ke=q.getElevation(G[2],G[3]),et=q.getElevation(G[0],G[3]),Be=q.isLeaf(G[0],G[1]),Je=q.isLeaf(G[2],G[1]),nt=q.isLeaf(G[2],G[3]),ot=q.isLeaf(G[0],G[3]),zt=Math.min(re.min,ve.min,ke.min,et.min),Rt=Math.max(re.max,ve.max,ke.max,et.max),Xt=Be&&Je&&nt&&ot;U.maximums.push(Rt),U.minimums.push(zt),U.leaves.push(Rt-zt<=5&&Xt?1:0)}M.push(U)}return M}(this.dem),f=u.length-1,_=u[f];this._addNode(_.minimums[0],_.maximums[0],_.leaves[0]),this._construct(u,0,0,f,0)}raycastRoot(o,u,f,_,E,S,M=1){return Dx([o,u,-100],[f,_,this.maximums[0]*M],E,S)}raycast(o,u,f,_,E,S,M=1){if(!this.nodeCount)return null;const P=this.raycastRoot(o,u,f,_,E,S,M);if(null==P)return null;const R=[],z=[],U=[],G=[],q=[{idx:0,t:P,nodex:0,nodey:0,depth:0}];for(;q.length>0;){const{idx:W,t:re,nodex:ve,nodey:ke,depth:et}=q.pop();if(this.leaves[W]){Mx(ve,ke,et,o,u,f,_,U,G);const Je=1<<et,nt=(ve+0)/Je,ot=(ve+1)/Je,zt=(ke+0)/Je,Rt=(ke+1)/Je,Xt=bu(nt,zt,this.dem)*M,_n=bu(ot,zt,this.dem)*M,jt=bu(ot,Rt,this.dem)*M,tn=bu(nt,Rt,this.dem)*M,nn=Tx(U[0],U[1],Xt,G[0],U[1],_n,G[0],G[1],jt,E,S),dn=Tx(G[0],G[1],jt,U[0],G[1],tn,U[0],U[1],Xt,E,S),wn=Math.min(null!==nn?nn:Number.MAX_VALUE,null!==dn?dn:Number.MAX_VALUE);if(wn!==Number.MAX_VALUE)return wn;{const Zt=wf([],E,S,re);if(zf(Xt,_n,tn,jt,Ix(Zt[0],U[0],G[0]),Ix(Zt[1],U[1],G[1]))>=Zt[2])return re}continue}let Be=0;for(let Je=0;Je<this._siblingOffset.length;Je++){Mx((ve<<1)+this._siblingOffset[Je][0],(ke<<1)+this._siblingOffset[Je][1],et+1,o,u,f,_,U,G),U[2]=-100,G[2]=this.maximums[this.childOffsets[W]+Je]*M;const nt=Dx(U,G,E,S);if(null!=nt){const ot=nt;R[Je]=ot;let zt=!1;for(let Rt=0;Rt<Be&&!zt;Rt++)ot>=R[z[Rt]]&&(z.splice(Rt,0,Je),zt=!0);zt||(z[Be]=Je),Be++}}for(let Je=0;Je<Be;Je++){const nt=z[Je];q.push({idx:this.childOffsets[W]+nt,t:R[nt],nodex:(ve<<1)+this._siblingOffset[nt][0],nodey:(ke<<1)+this._siblingOffset[nt][1],depth:et+1})}}return null}_addNode(o,u,f){return this.minimums.push(o),this.maximums.push(u),this.leaves.push(f),this.childOffsets.push(0),this.nodeCount++}_construct(o,u,f,_,E){if(1===o[_].isLeaf(u,f))return;this.childOffsets[E]||(this.childOffsets[E]=this.nodeCount);const S=_-1,M=o[S];let P=0,R=0;for(let z=0;z<this._siblingOffset.length;z++){const U=2*u+this._siblingOffset[z][0],G=2*f+this._siblingOffset[z][1],q=M.getElevation(U,G),W=M.isLeaf(U,G),re=this._addNode(q.min,q.max,W);W&&(P|=1<<z),R||(R=re)}for(let z=0;z<this._siblingOffset.length;z++)P&1<<z||this._construct(o,2*u+this._siblingOffset[z][0],2*f+this._siblingOffset[z][1],S,R+z)}}function zf(a,o,u,f,_,E){return Ci(Ci(a,u,E),Ci(o,f,E),_)}function bu(a,o,u){const f=u.dim,_=we(a*f-.5,0,f-1),E=we(o*f-.5,0,f-1),S=Math.floor(_),M=Math.floor(E),P=Math.min(S+1,f-1),R=Math.min(M+1,f-1);return zf(u.get(S,M),u.get(P,M),u.get(S,R),u.get(P,R),_-S,E-M)}const T0={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function YI(a,o,u){return(256*a*256+256*o+u)/10-1e4}function xC(a,o,u){return 256*a+o+u/256-32768}class I0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,u,f,_=!1,E=!1){if(this.uid=o,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&"mapbox"!==f&&"terrarium"!==f)return gr(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=u.height;const S=this.dim=u.height-2,M=new Uint32Array(u.data.buffer);if(this.pixels=new Uint8Array(u.data.buffer),this.encoding=f||"mapbox",this.borderReady=_,!_){for(let P=0;P<S;P++)M[this._idx(-1,P)]=M[this._idx(0,P)],M[this._idx(S,P)]=M[this._idx(S-1,P)],M[this._idx(P,-1)]=M[this._idx(P,0)],M[this._idx(P,S)]=M[this._idx(P,S-1)];M[this._idx(-1,-1)]=M[this._idx(0,0)],M[this._idx(S,-1)]=M[this._idx(S-1,0)],M[this._idx(-1,S)]=M[this._idx(0,S-1)],M[this._idx(S,S)]=M[this._idx(S-1,S-1)],E&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new D0(this)}get(o,u,f=!1){f&&(o=we(o,-1,this.dim),u=we(u,-1,this.dim));const _=4*this._idx(o,u);return("terrarium"===this.encoding?xC:YI)(this.pixels[_],this.pixels[_+1],this.pixels[_+2])}static getUnpackVector(o){return T0[o]}get unpackVector(){return T0[this.encoding]}_idx(o,u){if(o<-1||o>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(o+1)}static pack(o,u){const f=[0,0,0,0],_=I0.getUnpackVector(u);let E=Math.floor((o+_[3])/_[2]);return f[2]=E%256,E=Math.floor(E/256),f[1]=E%256,E=Math.floor(E/256),f[0]=E,f}getPixels(){return new nu({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,u,f){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let _=u*this.dim,E=u*this.dim+this.dim,S=f*this.dim,M=f*this.dim+this.dim;switch(u){case-1:_=E-1;break;case 1:E=_+1}switch(f){case-1:S=M-1;break;case 1:M=S+1}const P=-u*this.dim,R=-f*this.dim;for(let z=S;z<M;z++)for(let U=_;U<E;U++){const G=4*this._idx(U,z),q=4*this._idx(U+P,z+R);this.pixels[G+0]=o.pixels[q+0],this.pixels[G+1]=o.pixels[q+1],this.pixels[G+2]=o.pixels[q+2],this.pixels[G+3]=o.pixels[q+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Tn(I0,"DEMData"),Tn(D0,"DemMinMaxQuadTree",{omit:["dem"]});class KI{constructor(o,u){this.max=o,this.onRemove=u,this.reset()}reset(){for(const o in this.data)for(const u of this.data[o])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(o,u,f){const _=o.wrapped().key;void 0===this.data[_]&&(this.data[_]=[]);const E={value:u,timeout:void 0};if(void 0!==f&&(E.timeout=setTimeout(()=>{this.remove(o,E)},f)),this.data[_].push(E),this.order.push(_),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const u=this.data[o].shift();return u.timeout&&clearTimeout(u.timeout),0===this.data[o].length&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),u.value}getByKey(o){const u=this.data[o];return u?u[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,u){if(!this.has(o))return this;const f=o.wrapped().key,_=void 0===u?0:this.data[f].indexOf(u),E=this.data[f][_];return this.data[f].splice(_,1),E.timeout&&clearTimeout(E.timeout),0===this.data[f].length&&delete this.data[f],this.onRemove(E.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(o){const u=[];for(const f in this.data)for(const _ of this.data[f])o(_.value)||u.push(_);for(const f of u)this.remove(f.value.tileID,f)}}class Vf{constructor(o,u,f){this.func=o,this.mask=u,this.range=f}}Vf.ReadOnly=!1,Vf.ReadWrite=!0,Vf.disabled=new Vf(519,Vf.ReadOnly,[0,1]);class Ax{constructor(o,u,f,_,E,S){this.test=o,this.ref=u,this.mask=f,this.fail=_,this.depthFail=E,this.pass=S}}Ax.disabled=new Ax({func:519,mask:0},0,0,7680,7680,7680);class gh{constructor(o,u,f){this.blendFunction=o,this.blendColor=u,this.mask=f}}gh.Replace=[1,0],gh.disabled=new gh(gh.Replace,zs.transparent,[!1,!1,!1,!1]),gh.unblended=new gh(gh.Replace,zs.transparent,[!0,!0,!0,!0]),gh.alphaBlended=new gh([1,771],zs.transparent,[!0,!0,!0,!0]);class $c{constructor(o,u,f){this.enable=o,this.mode=u,this.frontFace=f}}$c.disabled=new $c(!1,1029,2305),$c.backCCW=new $c(!0,1029,2305),$c.backCW=new $c(!0,1029,2304),$c.frontCW=new $c(!0,1028,2304),$c.frontCCW=new $c(!0,1028,2305);class ef extends fa{constructor(o,u,f){super(),this.id=o,this._onlySymbols=f,u.on("data",_=>{"source"===_.dataType&&"metadata"===_.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===_.dataType&&"content"===_.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),u.on("error",()=>{this._sourceErrored=!0}),this._source=u,this._tiles={},this._cache=new KI(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new vC,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(o){this.map=o,this._minTileCacheSize=void 0===this._minTileCacheSize&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const u=this._tiles[o];if("loaded"!==u.state&&"errored"!==u.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,u){return o.isSymbolTile=this._onlySymbols,this._source.loadTile(o,u)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o,()=>{})}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const f=this._tiles[u];f.upload(o),f.prepare(this.map.style.imageManager)}}getIds(){return pt(this._tiles).map(o=>o.tileID).sort(fi).map(o=>o.key)}getRenderableIds(o){const u=[];for(const f in this._tiles)this._isIdRenderable(+f,o)&&u.push(this._tiles[f]);return o?u.sort((f,_)=>{const E=f.tileID,S=_.tileID,M=new ne(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),P=new ne(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-S.overscaledZ||P.y-M.y||P.x-M.x}).map(f=>f.tileID.key):u.map(f=>f.tileID).sort(fi).map(f=>f.key)}hasRenderableParent(o){const u=this.findLoadedParent(o,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(o,u){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(u||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)"errored"!==this._tiles[o].state&&this._reloadTile(+o,"reloading")}}_reloadTile(o,u){const f=this._tiles[o];f&&("loading"!==f.state&&(f.state=u),this._loadTile(f,this._tileLoaded.bind(this,f,o,u)))}_tileLoaded(o,u,f,_){if(_)if(o.state="errored",404!==_.status)this._source.fire(new da(_,{tile:o}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const E=this.map.painter.terrain;this.update(this.transform,E.getScaledDemTileSize(),!0),E.resetTileLookupCache(this.id)}else this.update(this.transform);else o.timeAdded=Na.now(),"expired"===f&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(u,o),"raster-dem"===this._source.type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new Hs("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const u=this.getRenderableIds();for(let _=0;_<u.length;_++){const E=u[_];if(o.neighboringTiles&&o.neighboringTiles[E]){const S=this.getTileByID(E);f(o,S),f(S,o)}}function f(_,E){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let S=E.tileID.canonical.x-_.tileID.canonical.x;const M=E.tileID.canonical.y-_.tileID.canonical.y,P=Math.pow(2,_.tileID.canonical.z),R=E.tileID.key;0===S&&0===M||Math.abs(M)>1||(Math.abs(S)>1&&(1===Math.abs(S+P)?S+=P:1===Math.abs(S-P)&&(S-=P)),E.dem&&_.dem&&(_.dem.backfillBorder(E.dem,S,M),_.neighboringTiles&&_.neighboringTiles[R]&&(_.neighboringTiles[R].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,u,f,_){for(const E in this._tiles){let S=this._tiles[E];if(_[E]||!S.hasData()||S.tileID.overscaledZ<=u||S.tileID.overscaledZ>f)continue;let M=S.tileID;for(;S&&S.tileID.overscaledZ>u+1;){const R=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[R.key],S&&S.hasData()&&(M=R)}let P=M;for(;P.overscaledZ>u;)if(P=P.scaledTo(P.overscaledZ-1),o[P.key]){_[M.key]=M;break}}}findLoadedParent(o,u){if(o.key in this._loadedParentTiles){const f=this._loadedParentTiles[o.key];return f&&f.tileID.overscaledZ>=u?f:null}for(let f=o.overscaledZ-1;f>=u;f--){const _=o.scaledTo(f),E=this._getLoadedTile(_);if(E)return E}}_getLoadedTile(o){const u=this._tiles[o.key];return u&&u.hasData()?u:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,u){u=u||this._source.tileSize;const f=Math.ceil(o.width/u)+1,_=Math.ceil(o.height/u)+1,E=Math.floor(f*_*5),S="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,E):E,M="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(M)}handleWrapJump(o){const u=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,u){const f={};for(const _ in this._tiles){const E=this._tiles[_];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+u),f[E.tileID.key]=E}this._tiles=f;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(o,u,f){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;let _;this.updateCacheSize(o,u),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new ru(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(_=o.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(_=_.filter(M=>this._source.hasTile(M)))):_=[];const E=this._updateRetainedTiles(_);if(hr(this._source.type)&&0!==_.length){const M={},P={},R=Object.keys(E);for(const U of R){const G=E[U],q=this._tiles[U];if(!q||q.fadeEndTime&&q.fadeEndTime<=Na.now())continue;const W=this.findLoadedParent(G,Math.max(G.overscaledZ-ef.maxOverzooming,this._source.minzoom));W&&(this._addTile(W.tileID),M[W.tileID.key]=W.tileID),P[U]=G}const z=_[_.length-1].overscaledZ;for(const U in this._tiles){const G=this._tiles[U];if(E[U]||!G.hasData())continue;let q=G.tileID;for(;q.overscaledZ>z;){q=q.scaledTo(q.overscaledZ-1);const W=this._tiles[q.key];if(W&&W.hasData()&&P[q.key]){E[U]=G.tileID;break}}}for(const U in M)E[U]||(this._coveredTiles[U]=!0,E[U]=M[U])}for(const M in E)this._tiles[M].clearFadeHold();const S=function(M,P){const R=[];for(const z in M)z in P||R.push(z);return R}(this._tiles,E);for(const M of S){const P=this._tiles[M];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(+M)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const u={};if(0===o.length)return u;const f={},_=o.reduce((R,z)=>Math.min(R,z.overscaledZ),1/0),E=o[0].overscaledZ,S=Math.max(E-ef.maxOverzooming,this._source.minzoom),M=Math.max(E+ef.maxUnderzooming,this._source.minzoom),P={};for(const R of o){const z=this._addTile(R);u[R.key]=R,z.hasData()||_<this._source.maxzoom&&(P[R.key]=R)}this._retainLoadedChildren(P,_,M,u);for(const R of o){let z=this._tiles[R.key];if(z.hasData())continue;if(R.canonical.z>=this._source.maxzoom){const G=R.children(this._source.maxzoom)[0],q=this.getTile(G);if(q&&q.hasData()){u[G.key]=G;continue}}else{const G=R.children(this._source.maxzoom);if(u[G[0].key]&&u[G[1].key]&&u[G[2].key]&&u[G[3].key])continue}let U=z.wasRequested();for(let G=R.overscaledZ-1;G>=S;--G){const q=R.scaledTo(G);if(f[q.key]||(f[q.key]=!0,z=this.getTile(q),!z&&U&&(z=this._addTile(q)),z&&(u[q.key]=q,U=z.wasRequested(),z.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const u=[];let f,_=this._tiles[o].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){f=this._loadedParentTiles[_.key];break}u.push(_.key);const E=_.scaledTo(_.overscaledZ-1);if(f=this._getLoadedTile(E),f)break;_=E}for(const E of u)this._loadedParentTiles[E]=f}}_addTile(o){let u=this._tiles[o.key];if(u)return u;u=this._cache.getAndRemove(o),u&&(this._setTileReloadTimer(o.key,u),u.tileID=o,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,u)));const f=!!u;if(!f){const _=this.map?this.map.painter:null;u=new h_(o,this._source.tileSize*o.overscaleFactor(),this.transform.tileZoom,_,this._isRaster),this._loadTile(u,this._tileLoaded.bind(this,u,o.key,u.state))}return u?(u.uses++,this._tiles[o.key]=u,f||this._source.fire(new Hs("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u):null}_setTileReloadTimer(o,u){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const f=u.getExpiryTimeout();f&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},f))}_removeTile(o){const u=this._tiles[o];u&&(u.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),u.uses>0||(u.hasData()&&"reloading"!==u.state?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,u,f){const _=[],E=this.transform;if(!E)return _;const S="globe"===E.projection.name,M=lh(E.center.lng);for(const P in this._tiles){const R=this._tiles[P];if(f&&R.clearQueryDebugViz(),R.holdingForFade())continue;let z;if(S){const U=R.tileID.canonical;if(0===U.z){const G=[Math.abs(we(M,...zp(U,-1))-M),Math.abs(we(M,...zp(U,1))-M)];z=[0,2*G.indexOf(Math.min(...G))-1]}else{const G=[Math.abs(we(M,...zp(U,-1))-M),Math.abs(we(M,...zp(U,0))-M),Math.abs(we(M,...zp(U,1))-M)];z=[G.indexOf(Math.min(...G))-1]}}else z=[0];for(const U of z){const G=o.containsTile(R,E,u,U);G&&_.push(G)}}return _}getVisibleCoordinates(o){const u=this.getRenderableIds(o).map(f=>this._tiles[f].tileID);for(const f of u)f.projMatrix=this.transform.calculateProjMatrix(f.toUnwrapped());return u}hasTransition(){if(this._source.hasTransition())return!0;if(hr(this._source.type))for(const o in this._tiles){const u=this._tiles[o];if(void 0!==u.fadeEndTime&&u.fadeEndTime>=Na.now())return!0}return!1}setFeatureState(o,u,f){this._state.updateState(o=o||"_geojsonTileLayer",u,f)}removeFeatureState(o,u,f){this._state.removeFeatureState(o=o||"_geojsonTileLayer",u,f)}getFeatureState(o,u){return this._state.getState(o=o||"_geojsonTileLayer",u)}setDependencies(o,u,f){const _=this._tiles[o];_&&_.setDependencies(u,f)}reloadTilesForDependencies(o,u){for(const f in this._tiles)this._tiles[f].hasDependency(o,u)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(o,u))}_preloadTiles(o,u){if(!this._sourceLoaded){const M=()=>{this._sourceLoaded&&(this._source.off("data",M),this._preloadTiles(o,u))};return void this._source.on("data",M)}const f=new Map,_=Array.isArray(o)?o:[o],E=this.map.painter.terrain,S=this.usedForTerrain&&E?E.getScaledDemTileSize():this._source.tileSize;for(const M of _){const P=M.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const R of P)f.set(R.key,R);this.usedForTerrain&&M.updateElevation(!1)}it(Array.from(f.values()),(M,P)=>{const R=new h_(M,this._source.tileSize*M.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(R,z=>{"raster-dem"===this._source.type&&R.dem&&this._backfillDEM(R),P(z,R)})},u)}}function fi(a,o){const u=Math.abs(2*a.wrap)-+(a.wrap<0),f=Math.abs(2*o.wrap)-+(o.wrap<0);return a.overscaledZ-o.overscaledZ||f-u||o.canonical.y-a.canonical.y||o.canonical.x-a.canonical.x}function hr(a){return"raster"===a||"image"===a||"video"===a||"custom"===a}function zp(a,o){const u=1<<a.z;return[a.x/u+o,(a.x+1)/u+o]}ef.maxOverzooming=10,ef.maxUnderzooming=3;class M0{constructor(o,u,f){this._demTile=o,this._dem=this._demTile.dem,this._scale=u,this._offset=f}static create(o,u,f){const _=f||o.findDEMTileFor(u);if(!_||!_.dem)return;const E=_.dem,S=_.tileID,M=1<<u.canonical.z-S.canonical.z;return new M0(_,_.tileSize/pr/M,[(u.canonical.x/M-S.canonical.x)*E.dim,(u.canonical.y/M-S.canonical.y)*E.dim])}tileCoordToPixel(o,u){const f=u*this._scale+this._offset[1],_=Math.floor(o*this._scale+this._offset[0]),E=Math.floor(f);return new ne(_,E)}getElevationAt(o,u,f,_){const E=o*this._scale+this._offset[0],S=u*this._scale+this._offset[1],M=Math.floor(E),P=Math.floor(S),R=this._dem;return _=!!_,f?Ci(Ci(R.get(M,P,_),R.get(M,P+1,_),S-P),Ci(R.get(M+1,P,_),R.get(M+1,P+1,_),S-P),E-M):R.get(M,P,_)}getElevationAtPixel(o,u,f){return this._dem.get(o,u,!!f)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*uh(1,o)*this._dem.stride}}class Nx{constructor(o,u){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new tr(pr,16,0),this.featureIndexArray=new Pl,this.promoteId=u}insert(o,u,f,_,E,S=0){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,_,E,S);const P=this.grid;for(let R=0;R<u.length;R++){const z=u[R],U=[1/0,1/0,-1/0,-1/0];for(let G=0;G<z.length;G++){const q=z[G];U[0]=Math.min(U[0],q.x),U[1]=Math.min(U[1],q.y),U[2]=Math.max(U[2],q.x),U[3]=Math.max(U[3],q.y)}U[0]<pr&&U[1]<pr&&U[2]>=0&&U[3]>=0&&P.insert(M,U[0],U[1],U[2],U[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Dg(new h0(this.rawTileData)).layers,this.sourceLayerCoder=new Cx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,u,f,_){this.loadVTLayers();const E=o.params||{},S=nh(E.filter),M=o.tileResult,P=o.transform,R=M.bufferedTilespaceBounds,z=this.grid.query(R.min.x,R.min.y,R.max.x,R.max.y,(W,re,ve,ke)=>Oy(M.bufferedTilespaceGeometry,W,re,ve,ke));z.sort(bC);let U=null;P.elevation&&z.length>0&&(U=M0.create(P.elevation,this.tileID));const G={};let q;for(let W=0;W<z.length;W++){const re=z[W];if(re===q)continue;q=re;const ve=this.featureIndexArray.get(re);let ke=null;this.loadMatchingFeature(G,ve,S,E.layers,E.availableImages,u,f,_,(et,Be,Je,nt=0)=>(ke||(ke=Lc(et,this.tileID.canonical,o.tileTransform)),Be.queryIntersectsFeature(M,et,Je,ke,this.z,o.transform,o.pixelPosMatrix,U,nt)))}return G}loadMatchingFeature(o,u,f,_,E,S,M,P,R){const{featureIndex:z,bucketIndex:U,sourceLayerIndex:G,layoutVertexArrayOffset:q}=u,W=this.bucketLayerIDs[U];if(_&&!function(et,Be){for(let Je=0;Je<et.length;Je++)if(Be.indexOf(et[Je])>=0)return!0;return!1}(_,W))return;const re=this.sourceLayerCoder.decode(G),ve=this.vtLayers[re].feature(z);if(f.needGeometry){const et=Zd(ve,!0);if(!f.filter(new V(this.tileID.overscaledZ),et,this.tileID.canonical))return}else if(!f.filter(new V(this.tileID.overscaledZ),ve))return;const ke=this.getId(ve,re);for(let et=0;et<W.length;et++){const Be=W[et];if(_&&_.indexOf(Be)<0)continue;const Je=S[Be];if(!Je)continue;let nt={};void 0!==ke&&P&&(nt=P.getState(Je.sourceLayer||"_geojsonTileLayer",ke));const ot=Ie({},M[Be]);ot.paint=A0(ot.paint,Je.paint,ve,nt,E),ot.layout=A0(ot.layout,Je.layout,ve,nt,E);const zt=!R||R(ve,Je,nt,q);if(!zt)continue;const Rt=new kp(ve,this.z,this.x,this.y,ke);Rt.layer=ot;let Xt=o[Be];void 0===Xt&&(Xt=o[Be]=[]),Xt.push({featureIndex:z,feature:Rt,intersectionZ:zt})}}lookupSymbolFeatures(o,u,f,_,E,S,M,P){const R={};this.loadVTLayers();const z=nh(E);for(const U of o)this.loadMatchingFeature(R,{bucketIndex:f,sourceLayerIndex:_,featureIndex:U,layoutVertexArrayOffset:0},z,S,M,P,u);return R}loadFeature(o){const{featureIndex:u,sourceLayerIndex:f}=o;this.loadVTLayers();const _=this.sourceLayerCoder.decode(f),E=this.vtFeatures[_];if(E[u])return E[u];const S=this.vtLayers[_].feature(u);return E[u]=S,S}hasLayer(o){for(const u of this.bucketLayerIDs)for(const f of u)if(o===f)return!0;return!1}getId(o,u){let f=o.id;if(this.promoteId){const _="string"==typeof this.promoteId?this.promoteId:this.promoteId[u];null!=_&&(f=o.properties[_]),"boolean"==typeof f&&(f=Number(f))}return f}}function A0(a,o,u,f,_){return gn(a,(E,S)=>{const M=o instanceof Le?o.get(S):null;return M&&M.evaluate?M.evaluate(u,f,_):M})}function bC(a,o){return o-a}Tn(Nx,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Px{constructor(o,u){this.width=o,this.height=u,this.nextRow=0,this.image=new dd({width:o,height:u}),this.positions={},this.uploaded=!1}getDash(o,u){const f=this.getKey(o,u);return this.positions[f]}trim(){const o=this.width,u=this.height=Mt(this.nextRow);this.image.resize({width:o,height:u})}getKey(o,u){return o.join(",")+u}getDashRanges(o,u,f){const _=[];let E=o.length%2==1?-o[o.length-1]*f:0,S=o[0]*f,M=!0;_.push({left:E,right:S,isDash:M,zeroLength:0===o[0]});let P=o[0];for(let R=1;R<o.length;R++){M=!M;const z=o[R];E=P*f,P+=z,S=P*f,_.push({left:E,right:S,isDash:M,zeroLength:0===z})}return _}addRoundDash(o,u,f){const _=u/2;for(let E=-f;E<=f;E++){const S=this.width*(this.nextRow+f+E);let M=0,P=o[M];for(let R=0;R<this.width;R++){R/P.right>1&&(P=o[++M]);const z=Math.abs(R-P.left),U=Math.abs(R-P.right),G=Math.min(z,U);let q;const W=E/f*(_+1);if(P.isDash){const re=_-Math.abs(W);q=Math.sqrt(G*G+re*re)}else q=_-Math.sqrt(G*G+W*W);this.image.data[S+R]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(o,u){for(let P=o.length-1;P>=0;--P){const R=o[P],z=o[P+1];R.zeroLength?o.splice(P,1):z&&z.isDash===R.isDash&&(z.left=R.left,o.splice(P,1))}const f=o[0],_=o[o.length-1];f.isDash===_.isDash&&(f.left=_.left-this.width,_.right=f.right+this.width);const E=this.width*this.nextRow;let S=0,M=o[S];for(let P=0;P<this.width;P++){P/M.right>1&&(M=o[++S]);const R=Math.abs(P-M.left),z=Math.abs(P-M.right),U=Math.min(R,z);this.image.data[E+P]=Math.max(0,Math.min(255,(M.isDash?U:-U)+u+128))}}addDash(o,u){const f=this.getKey(o,u);if(this.positions[f])return this.positions[f];const _="round"===u,E=_?7:0,S=2*E+1;if(this.nextRow+S>this.height)return gr("LineAtlas out of space"),null;0===o.length&&o.push(1);let M=0;for(let z=0;z<o.length;z++)o[z]<0&&(gr("Negative value is found in line dasharray, replacing values with 0"),o[z]=0),M+=o[z];if(0!==M){const z=this.width/M,U=this.getDashRanges(o,this.width,z);_?this.addRoundDash(U,z,E):this.addRegularDash(U,"square"===u?.5*z:0)}const P=this.nextRow+E;this.nextRow+=S;const R={tl:[P,E],br:[M,0]};return this.positions[f]=R,R}}Tn(Px,"LineAtlas");const N0=1*zc;class Rx{constructor(o){const u={},f=[];for(const M in o){const P=o[M],R=u[M]={};for(const z in P.glyphs){const U=P.glyphs[+z];if(!U||0===U.bitmap.width||0===U.bitmap.height)continue;const G=U.metrics.localGlyph?N0:1,q={x:0,y:0,w:U.bitmap.width+2*G,h:U.bitmap.height+2*G};f.push(q),R[z]=q}}const{w:_,h:E}=Jm(f),S=new dd({width:_||1,height:E||1});for(const M in o){const P=o[M];for(const R in P.glyphs){const z=P.glyphs[+R];if(!z||0===z.bitmap.width||0===z.bitmap.height)continue;const U=u[M][R],G=z.metrics.localGlyph?N0:1;dd.copy(z.bitmap,S,{x:0,y:0},{x:U.x+G,y:U.y+G},z.bitmap)}}this.image=S,this.positions=u}}Tn(Rx,"GlyphAtlas");class Ox{constructor(o){this.tileID=new ru(o.tileID.overscaledZ,o.tileID.wrap,o.tileID.canonical.z,o.tileID.canonical.x,o.tileID.canonical.y),this.tileZoom=o.tileZoom,this.uid=o.uid,this.zoom=o.zoom,this.canonical=o.tileID.canonical,this.pixelRatio=o.pixelRatio,this.tileSize=o.tileSize,this.source=o.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=o.showCollisionBoxes,this.collectResourceTiming=!!o.collectResourceTiming,this.returnDependencies=!!o.returnDependencies,this.promoteId=o.promoteId,this.enableTerrain=!!o.enableTerrain,this.isSymbolTile=o.isSymbolTile,this.tileTransform=kh(o.tileID.canonical,o.projection),this.projection=o.projection}parse(o,u,f,_,E){this.status="parsing",this.data=o,this.collisionBoxArray=new $o;const S=new Cx(Object.keys(o.layers).sort()),M=new Nx(this.tileID,this.promoteId);M.bucketLayerIDs=[];const P={},R=new Px(256,256),z={featureIndex:M,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:R,availableImages:f},U=u.familiesBySource[this.source];for(const nt in U){const ot=o.layers[nt];if(!ot)continue;let zt=!1,Rt=!1;for(const jt of U[nt])"symbol"===jt[0].type?zt=!0:Rt=!0;if(!0===this.isSymbolTile&&!zt||!1===this.isSymbolTile&&!Rt)continue;1===ot.version&&gr(`Vector tile source "${this.source}" layer "${nt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Xt=S.encode(nt),_n=[];for(let jt=0;jt<ot.length;jt++){const tn=ot.feature(jt),nn=M.getId(tn,nt);_n.push({feature:tn,id:nn,index:jt,sourceLayerIndex:Xt})}for(const jt of U[nt]){const tn=jt[0];void 0!==this.isSymbolTile&&"symbol"===tn.type!==this.isSymbolTile||tn.minzoom&&this.zoom<Math.floor(tn.minzoom)||tn.maxzoom&&this.zoom>=tn.maxzoom||"none"!==tn.visibility&&(P0(jt,this.zoom,f),(P[tn.id]=tn.createBucket({index:M.bucketLayerIDs.length,layers:jt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Xt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:f})).populate(_n,z,this.tileID.canonical,this.tileTransform),M.bucketLayerIDs.push(jt.map(nn=>nn.id)))}}let G,q,W,re;R.trim();const ve={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ke=()=>{if(G)return E(G);if(q&&W&&re){const nt=new Rx(q),ot=new Qm(W,re);for(const zt in P){const Rt=P[zt];Rt instanceof fh?(P0(Rt.layers,this.zoom,f),x0(Rt,q,nt.positions,W,ot.iconPositions,this.showCollisionBoxes,f,this.tileID.canonical,this.tileZoom,this.projection)):Rt.hasPattern&&(Rt instanceof pd||Rt instanceof Um||Rt instanceof Tg)&&(P0(Rt.layers,this.zoom,f),Rt.addFeatures(z,this.tileID.canonical,ot.patternPositions,f,this.tileTransform))}this.status="done",E(null,{buckets:pt(P).filter(zt=>!zt.isEmpty()),featureIndex:M,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:nt.image,lineAtlas:R,imageAtlas:ot,glyphMap:this.returnDependencies?q:null,iconMap:this.returnDependencies?W:null,glyphPositions:this.returnDependencies?nt.positions:null})}},et=gn(z.glyphDependencies,nt=>Object.keys(nt).map(Number));Object.keys(et).length?_.send("getGlyphs",{uid:this.uid,stacks:et},(nt,ot)=>{G||(G=nt,q=ot,ke())},void 0,!1,ve):q={};const Be=Object.keys(z.iconDependencies);Be.length?_.send("getImages",{icons:Be,source:this.source,tileID:this.tileID,type:"icons"},(nt,ot)=>{G||(G=nt,W=ot,ke())},void 0,!1,ve):W={};const Je=Object.keys(z.patternDependencies);Je.length?_.send("getImages",{icons:Je,source:this.source,tileID:this.tileID,type:"patterns"},(nt,ot)=>{G||(G=nt,re=ot,ke())},void 0,!1,ve):re={},ke()}}function P0(a,o,u){const f=new V(o);for(const _ of a)_.recalculate(f,u)}class Lx{constructor(o){this.entries={},this.scheduler=o}request(o,u,f,_){const E=this.entries[o]=this.entries[o]||{callbacks:[]};if(E.result){const[S,M]=E.result;return this.scheduler?this.scheduler.add(()=>{_(S,M)},u):_(S,M),()=>{}}return E.callbacks.push(_),E.cancel||(E.cancel=f((S,M)=>{E.result=[S,M];for(const P of E.callbacks)this.scheduler?this.scheduler.add(()=>{P(S,M)},u):P(S,M);setTimeout(()=>delete this.entries[o],3e3)})),()=>{E.result||(E.callbacks=E.callbacks.filter(S=>S!==_),E.callbacks.length||(E.cancel(),delete this.entries[o]))}}}function wC(a,o,u){const f=JSON.stringify(a.request);return a.data&&(this.deduped.entries[f]={result:[null,a.data]}),this.deduped.request(f,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},_=>{const E=Po(a.request,(S,M,P,R)=>{S?_(S):M&&_(null,{vectorTile:u?void 0:new Dg(new h0(M)),rawData:M,cacheControl:P,expires:R})});return()=>{E.cancel(),_()}},o)}const R0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class p_{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,f]=new Uint8Array(o,0,2);if(219!==u)throw new Error("Data does not appear to be in a KDBush format.");const _=f>>4;if(1!==_)throw new Error(`Got v${_} data when expected v1.`);const E=R0[15&f];if(!E)throw new Error("Unrecognized array type.");const[S]=new Uint16Array(o,2,1),[M]=new Uint32Array(o,4,1);return new p_(M,S,E,o)}constructor(o,u=64,f=Float64Array,_){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=f,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const E=R0.indexOf(this.ArrayType),S=2*o*this.ArrayType.BYTES_PER_ELEMENT,M=o*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-M%8)%8;if(E<0)throw new Error(`Unexpected typed array class: ${f}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+M+P,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+S+M+P),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+M+P,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+E]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=o)}add(o,u){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=o,this.coords[this._pos++]=u,f}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return wu(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,u,f,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:E,coords:S,nodeSize:M}=this,P=[0,E.length-1,0],R=[];for(;P.length;){const z=P.pop()||0,U=P.pop()||0,G=P.pop()||0;if(U-G<=M){for(let ve=G;ve<=U;ve++){const ke=S[2*ve],et=S[2*ve+1];ke>=o&&ke<=f&&et>=u&&et<=_&&R.push(E[ve])}continue}const q=G+U>>1,W=S[2*q],re=S[2*q+1];W>=o&&W<=f&&re>=u&&re<=_&&R.push(E[q]),(0===z?o<=W:u<=re)&&(P.push(G),P.push(q-1),P.push(1-z)),(0===z?f>=W:_>=re)&&(P.push(q+1),P.push(U),P.push(1-z))}return R}within(o,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:E,nodeSize:S}=this,M=[0,_.length-1,0],P=[],R=f*f;for(;M.length;){const z=M.pop()||0,U=M.pop()||0,G=M.pop()||0;if(U-G<=S){for(let ve=G;ve<=U;ve++)jg(E[2*ve],E[2*ve+1],o,u)<=R&&P.push(_[ve]);continue}const q=G+U>>1,W=E[2*q],re=E[2*q+1];jg(W,re,o,u)<=R&&P.push(_[q]),(0===z?o-f<=W:u-f<=re)&&(M.push(G),M.push(q-1),M.push(1-z)),(0===z?o+f>=W:u+f>=re)&&(M.push(q+1),M.push(U),M.push(1-z))}return P}}function wu(a,o,u,f,_,E){if(_-f<=u)return;const S=f+_>>1;wt(a,o,S,f,_,E),wu(a,o,u,f,S-1,1-E),wu(a,o,u,S+1,_,1-E)}function wt(a,o,u,f,_,E){for(;_>f;){if(_-f>600){const R=_-f+1,z=u-f+1,U=Math.log(R),G=.5*Math.exp(2*U/3),q=.5*Math.sqrt(U*G*(R-G)/R)*(z-R/2<0?-1:1);wt(a,o,u,Math.max(f,Math.floor(u-z*G/R+q)),Math.min(_,Math.floor(u+(R-z)*G/R+q)),E)}const S=o[2*u+E];let M=f,P=_;for(Vp(a,o,f,u),o[2*_+E]>S&&Vp(a,o,f,_);M<P;){for(Vp(a,o,M,P),M++,P--;o[2*M+E]<S;)M++;for(;o[2*P+E]>S;)P--}o[2*f+E]===S?Vp(a,o,f,P):(P++,Vp(a,o,P,_)),P<=u&&(f=P+1),u<=P&&(_=P-1)}}function Vp(a,o,u,f){O0(a,u,f),O0(o,2*u,2*f),O0(o,2*u+1,2*f+1)}function O0(a,o,u){const f=a[o];a[o]=a[u],a[u]=f}function jg(a,o,u,f){const _=a-u,E=o-f;return _*_+E*E}p.ARRAY_TYPE=Xa,p.AUTH_ERR_MSG=tt,p.Aabb=xu,p.Actor=class{constructor(a,o,u){this.target=a,this.parent=o,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Nn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=lr()?a:be,this.scheduler=new Ju}send(a,o,u,f,_=!1,E){const S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=E,this.callbacks[S]=u);const M=Y(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:a,hasCallback:!!u,targetMapId:f,mustQueue:_,sourceMapId:this.mapId,data:ml(o,M)},M),{cancel:()=>{u&&delete this.callbacks[S],this.target.postMessage({id:S,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(a){const o=a.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){const f=this.cancelCallbacks[u];delete this.cancelCallbacks[u],f&&f.cancel()}else if(o.mustQueue||lr()){const f=this.callbacks[u];this.cancelCallbacks[u]=this.scheduler.add(()=>this.processTask(u,o),f&&f.metadata||{type:"message"})}else this.processTask(u,o)}processTask(a,o){if("<response>"===o.type){const u=this.callbacks[a];delete this.callbacks[a],u&&(o.error?u(Ac(o.error)):u(null,Ac(o.data)))}else{const u=Y(this.globalScope)?void 0:[],f=o.hasCallback?(E,S)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:E?ml(E):null,data:ml(S,u)},u)}:E=>{},_=Ac(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,_,f);else if(this.parent.getWorkerSource){const E=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,E[0],_.source)[E[1]](_,f)}else f(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=Ep,p.Color=zs,p.ColorMode=gh,p.CullFaceMode=$c,p.DEMData=I0,p.DataConstantProperty=te,p.DedupedRequest=Lx,p.DepthMode=Vf,p.EXTENT=pr,p.Elevation=class{isDataAvailableAtPoint(a){const o=this._source();if(this.isUsingMockSource()||!o||a.y<0||a.y>1)return!1;const u=o.getSource().maxzoom,f=1<<u,_=Math.floor(a.x),E=Math.floor((a.x-_)*f),S=Math.floor(a.y*f),M=this.findDEMTileFor(new ru(u,_,u,E,S));return!(!M||!M.dem)}getAtPointOrZero(a,o=0){return this.getAtPoint(a,o)||0}getAtPoint(a,o,u=!0){if(this.isUsingMockSource())return null;null==o&&(o=null);const f=this._source();if(!f||a.y<0||a.y>1)return o;const _=f.getSource().maxzoom,E=1<<_,S=Math.floor(a.x),M=a.x-S,P=new ru(_,S,_,Math.floor(M*E),Math.floor(a.y*E)),R=this.findDEMTileFor(P);if(!R||!R.dem)return o;const z=R.dem,U=1<<R.tileID.canonical.z,G=(M*U-R.tileID.canonical.x)*z.dim,q=(a.y*U-R.tileID.canonical.y)*z.dim,W=Math.floor(G),re=Math.floor(q);return(u?this.exaggeration():1)*Ci(Ci(z.get(W,re),z.get(W,re+1),q-re),Ci(z.get(W+1,re),z.get(W+1,re+1),q-re),G-W)}getAtTileOffset(a,o,u){const f=1<<a.canonical.z;return this.getAtPointOrZero(new hd(a.wrap+(a.canonical.x+o/pr)/f,(a.canonical.y+u/pr)/f))}getAtTileOffsetFunc(a,o,u,f){return _=>{const E=this.getAtTileOffset(a,_.x,_.y),S=f.upVector(a.canonical,_.x,_.y);return vu(S,S,E*f.upVectorScale(a.canonical,o,u).metersToTile),S}}getForTilePoints(a,o,u,f){if(this.isUsingMockSource())return!1;const _=M0.create(this,a,f);return!!_&&(o.forEach(E=>{E[2]=this.exaggeration()*_.getElevationAt(E[0],E[1],u)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(a);if(!o||!o.dem)return null;const u=o.dem.tree,f=o.tileID,_=1<<a.canonical.z-f.canonical.z;let E=a.canonical.x/_-f.canonical.x,S=a.canonical.y/_-f.canonical.y,M=0;for(let P=0;P<a.canonical.z-f.canonical.z&&!u.leaves[M];P++){E*=2,S*=2;const R=2*Math.floor(S)+Math.floor(E);M=u.childOffsets[M]+R,E%=1,S%=1}return{min:this.exaggeration()*u.minimums[M],max:this.exaggeration()*u.maximums[M]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,o,u){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=da,p.EvaluationParameters=V,p.Event=Hs,p.Evented=fa,p.FillExtrusionBucket=Tg,p.Frustum=qd,p.FrustumCorners=Tm,p.GLOBE_RADIUS=Ih,p.GLOBE_SCALE_MATCH_LATITUDE=45,p.GLOBE_ZOOM_THRESHOLD_MAX=Im,p.GLOBE_ZOOM_THRESHOLD_MIN=Da,p.GlobeSharedBuffers=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const a of this._wireframeSegments)a.destroy()}}_fillGridMeshWithLods(a,o){const u=new Qt,f=new nr,_=[],E=a+1+2,S=o[0]+1,M=o[0]+1+(1+o.length),P=(R,z,U)=>{let G=R===E-1?R-2:0===R?R:R-1;return G+=U?24575:0,[G,z]};for(let R=0;R<E;++R)u.emplaceBack(...P(R,0,!0));for(let R=0;R<S;++R)for(let z=0;z<E;++z)u.emplaceBack(...P(z,R,(0===z||z===E-1)&&!0));for(let R=0;R<o.length;++R){const z=o[R];for(let U=0;U<E;++U)u.emplaceBack(...P(U,z,!0))}for(let R=0;R<o.length;++R){const z=f.length,U=o[R]+1+2,G=new nr;for(let re=0;re<U-1;re++){const ve=re===U-2,ke=ve?E*(M-o.length+R-re):E;for(let et=0;et<E-1;et++){const Be=re*E+et;0===re||ve||0===et||et===E-2?(G.emplaceBack(Be+1,Be,Be+ke),G.emplaceBack(Be+ke,Be+ke+1,Be+1)):(f.emplaceBack(Be+1,Be,Be+ke),f.emplaceBack(Be+ke,Be+ke+1,Be+1))}}const q=Sa.simpleSegment(0,z,u.length,f.length-z);for(let re=0;re<G.uint16.length;re+=3)f.emplaceBack(G.uint16[re],G.uint16[re+1],G.uint16[re+2]);const W=Sa.simpleSegment(0,z,u.length,f.length-z);_.push({withoutSkirts:q,withSkirts:W})}return{vertices:u,indices:f,segments:_}}_createGrid(a){const o=this._fillGridMeshWithLods(64,Mh);this._gridSegments=o.segments,this._gridBuffer=a.createVertexBuffer(o.vertices,gg.members),this._gridIndexBuffer=a.createIndexBuffer(o.indices,!0)}_createPoles(a){const o=new nr;for(let _=0;_<=64;_++)o.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=a.createIndexBuffer(o,!0);const u=new Xo,f=new Xo;this._poleSegments=[];for(let _=0,E=0;_<Da;_++){const S=360/(1<<_);u.emplaceBack(0,-Ih,0,.5,0),f.emplaceBack(0,-Ih,0,.5,1);for(let M=0;M<=64;M++){const P=M/64,R=Ci(0,S,P),[z,U,G]=hp(zI,gE,R,Ih);u.emplaceBack(z,U,G,P,0),f.emplaceBack(z,U,G,P,1)}this._poleSegments.push(Sa.simpleSegment(E,0,66,64)),E+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(u,pg,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(f,pg,!1)}getGridBuffers(a,o){return[this._gridBuffer,this._gridIndexBuffer,o?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}getWirefameBuffers(a,o){if(!this._wireframeSegments){const u=new al,f=64,_=f+1+2,E=1;this._wireframeSegments=[];for(let S=0,M=0;S<Mh.length;S++){const P=Mh[S];for(let z=E;z<P+E;z++)for(let U=E;U<f+E;U++){const G=z*_+U;u.emplaceBack(G,G+1),u.emplaceBack(G,G+_),u.emplaceBack(G,G+_+1)}const R=P*f*3;this._wireframeSegments.push(Sa.simpleSegment(0,M,(P+1)*_,R)),M+=R}this._wireframeIndexBuffer=a.createIndexBuffer(u)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[o]]}},p.GlyphManager=Vc,p.ImagePosition=d0,p.KDBush=p_,p.LivePerformanceUtils=Cl,p.LngLat=Gi,p.LngLatBounds=sd,p.LocalGlyphMode=r_,p.MAX_MERCATOR_LATITUDE=Ol,p.MercatorCoordinate=hd,p.ONE_EM=ul,p.OverscaledTileID=ru,p.PerformanceMarkers=Bl,p.Point=ne,p.Properties=He,p.RGBAImage=nu,p.Ray=Dm,p.RequestManager=class{constructor(a,o,u){this._transformRequestFn=a,this._customAccessToken=o,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const a=function(){let o="";for(let u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",de,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,o){return this._transformRequestFn&&this._transformRequestFn(a,o)||{url:a}}normalizeStyleURL(a,o){if(!Oe(a))return a;const u=En(a);return u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||o)}normalizeGlyphsURL(a,o){if(!Oe(a))return a;const u=En(a);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||o)}normalizeSourceURL(a,o,u,f){if(!Oe(a))return a;const _=En(a);return _.path=`/v4/${_.authority}.json`,_.params.push("secure"),u&&_.params.push(`language=${u}`),f&&_.params.push(`worldview=${f}`),this._makeAPIURL(_,this._customAccessToken||o)}normalizeSpriteURL(a,o,u,f){const _=En(a);return Oe(a)?(_.path=`/styles/v1${_.path}/sprite${o}${u}`,this._makeAPIURL(_,this._customAccessToken||f)):(_.path+=`${o}${u}`,pn(_))}normalizeTileURL(a,o,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!Oe(a))return a;const f=En(a);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||u&&"raster"!==f.authority&&512===u?"@2x":""}${Et.supported?".webp":"$1"}`),"raster"===f.authority?f.path=`/${ft.RASTER_URL_PREFIX}${f.path}`:(f.path=f.path.replace(/^.+\/v4\//,"/"),f.path=`/${ft.TILE_URL_VERSION}${f.path}`);const _=this._customAccessToken||function(E){for(const S of E){const M=S.match(/^access_token=(.*)$/);if(M)return M[1]}return null}(f.params)||ft.ACCESS_TOKEN;return ft.REQUIRE_ACCESS_TOKEN&&_&&this._skuToken&&f.params.push(`sku=${this._skuToken}`),this._makeAPIURL(f,_)}canonicalizeTileURL(a,o){const u=En(a);if(!u.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!u.path.match(/\.[\w]+$/))return a;let f="mapbox://";u.path.match(/^\/raster\/v1\//)?f+=`raster/${u.path.replace(`/${ft.RASTER_URL_PREFIX}/`,"")}`:f+=`tiles/${u.path.replace(`/${ft.TILE_URL_VERSION}/`,"")}`;let _=u.params;return o&&(_=_.filter(E=>!E.match(/^access_token=/))),_.length&&(f+=`?${_.join("&")}`),f}canonicalizeTileset(a,o){const u=!!o&&Oe(o),f=[];for(const _ of a.tiles||[])Ct(_)?f.push(this.canonicalizeTileURL(_,u)):f.push(_);return f}_makeAPIURL(a,o){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",f=En(ft.API_URL);if(a.protocol=f.protocol,a.authority=f.authority,"http"===a.protocol){const _=a.params.indexOf("secure");_>=0&&a.params.splice(_,1)}if("/"!==f.path&&(a.path=`${f.path}${a.path}`),!ft.REQUIRE_ACCESS_TOKEN)return pn(a);if(o=o||ft.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if("s"===o[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return a.params=a.params.filter(_=>-1===_.indexOf("access_token")),a.params.push(`access_token=${o||""}`),pn(a)}},p.ResourceType=kr,p.SegmentVector=Sa,p.SourceCache=ef,p.StencilMode=Ax,p.StructArrayLayout1ui2=Wu,p.StructArrayLayout2f1f2i16=vr,p.StructArrayLayout2i4=Qt,p.StructArrayLayout2ui4=al,p.StructArrayLayout3f12=li,p.StructArrayLayout3ui6=nr,p.StructArrayLayout4i8=Jt,p.StructArrayLayout5f20=Xo,p.Texture=Vg,p.Tile=h_,p.Transitionable=ee,p.Uniform1f=ag,p.Uniform1i=class extends rd{constructor(a){super(a),this.current=0}set(a,o,u){this.fetchUniformLocation(a,o)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},p.Uniform2f=class extends rd{constructor(a){super(a),this.current=[0,0]}set(a,o,u){this.fetchUniformLocation(a,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}},p.Uniform3f=class extends rd{constructor(a){super(a),this.current=[0,0,0]}set(a,o,u){this.fetchUniformLocation(a,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}},p.Uniform4f=v1,p.UniformColor=x1,p.UniformMatrix2f=class extends rd{constructor(a){super(a),this.current=b1}set(a,o,u){if(this.fetchUniformLocation(a,o))for(let f=0;f<4;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}},p.UniformMatrix3f=class extends rd{constructor(a){super(a),this.current=my}set(a,o,u){if(this.fetchUniformLocation(a,o))for(let f=0;f<9;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix3fv(this.location,!1,u);break}}},p.UniformMatrix4f=class extends rd{constructor(a){super(a),this.current=gy}set(a,o,u){if(this.fetchUniformLocation(a,o)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let f=1;f<16;f++)if(u[f]!==this.current[f]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}},p.UnwrappedTileID=Mg,p.ValidationError=vn,p.VectorTileFeature=Gm,p.VectorTileWorkerSource=class extends fa{constructor(a,o,u,f,_){super(),this.actor=a,this.layerIndex=o,this.availableImages=u,this.loadVectorData=_||wC,this.loading={},this.loaded={},this.deduped=new Lx(a.scheduler),this.isSpriteLoaded=f,this.scheduler=a.scheduler}loadTile(a,o){const u=a.uid,f=a&&a.request,_=f&&f.collectResourceTiming,E=this.loading[u]=new Ox(a);E.abort=this.loadVectorData(a,(S,M)=>{const P=!this.loading[u];if(delete this.loading[u],P||S||!M)return E.status="done",P||(this.loaded[u]=E),o(S);const R=M.rawData,z={};M.expires&&(z.expires=M.expires),M.cacheControl&&(z.cacheControl=M.cacheControl),E.vectorTile=M.vectorTile||new Dg(new h0(R));const U=()=>{E.parse(E.vectorTile,this.layerIndex,this.availableImages,this.actor,(G,q)=>{if(G||!q)return o(G);const W={};if(_){const re=Ps(f);re.length>0&&(W.resourceTiming=JSON.parse(JSON.stringify(re)))}o(null,Ie({rawTileData:R.slice(0)},q,z,W))})};this.isSpriteLoaded?U():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(U,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):U()}),this.loaded=this.loaded||{},this.loaded[u]=E})}reloadTile(a,o){const u=this.loaded,f=a.uid,_=this;if(u&&u[f]){const E=u[f];E.showCollisionBoxes=a.showCollisionBoxes,E.enableTerrain=!!a.enableTerrain,E.projection=a.projection,E.tileTransform=kh(a.tileID.canonical,a.projection);const S=(M,P)=>{const R=E.reloadCallback;R&&(delete E.reloadCallback,E.parse(E.vectorTile,_.layerIndex,this.availableImages,_.actor,R)),o(M,P)};"parsing"===E.status?E.reloadCallback=S:"done"===E.status&&(E.vectorTile?E.parse(E.vectorTile,this.layerIndex,this.availableImages,this.actor,S):S())}}abortTile(a,o){const u=a.uid,f=this.loading[u];f&&(f.abort&&f.abort(),delete this.loading[u]),o()}removeTile(a,o){const u=this.loaded,f=a.uid;u&&u[f]&&delete u[f],o()}},p.WritingMode=yc,p.ZoomDependentExpression=Pr,p.add=Gd,p.addDynamicAttributes=Lp,p.adjoint=function(a,o){var u=o[0],f=o[1],_=o[2],E=o[3],S=o[4],M=o[5],P=o[6],R=o[7],z=o[8];return a[0]=S*z-M*R,a[1]=_*R-f*z,a[2]=f*M-_*S,a[3]=M*P-E*z,a[4]=u*z-_*P,a[5]=_*E-u*M,a[6]=E*R-S*P,a[7]=f*P-u*R,a[8]=u*S-f*E,a},p.asyncAll=it,p.bezier=Kt,p.bindAll=Nn,p.boundsAttributes=Ug,p.bufferConvexPolygon=function(a,o){const u=[];for(let f=0;f<a.length;f++){const _=Ae(f-1,-1,a.length-1),E=Ae(f+1,-1,a.length-1),S=a[f],M=a[E],P=a[_].sub(S).unit(),R=M.sub(S).unit(),z=R.angleWithSep(P.x,P.y),U=P.add(R).unit().mult(-1*o/Math.sin(z/2));u.push(S.add(U))}return u},p.cacheEntryPossiblyAdded=function(a){Cr++,Cr>Ht&&(a.getActor().send("enforceCacheSizeLimit",Tt),Cr=0)},p.calculateGlobeLabelMatrix=function(a,o){const{x:u,y:f}=a.point,_=pp(u,f,a.worldSize/a._pixelsPerMercatorPixel,0,0);return ad(_,_,Yu(cd(o)))},p.calculateGlobeMatrix=function(a){const{x:o,y:u}=a.point,{lng:f,lat:_}=a._center;return pp(o,u,a.worldSize,f,_)},p.calculateGlobeMercatorMatrix=function(a){const o=a.pixelsPerMeter,u=o/uh(1,a.center.lat),f=Zu(new Float64Array(16));return sp(f,f,[a.point.x,a.point.y,0]),jd(f,f,[u,u,o]),Float32Array.from(f)},p.circumferenceAtLatitude=N1,p.clamp=we,p.clearTileCache=function(a){if(!or())return;const o=be.caches.delete(We);a&&o.catch(a).then(()=>a())},p.clipLine=rC,p.clone=function(a){var o=new Xa(16);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8],o[9]=a[9],o[10]=a[10],o[11]=a[11],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],o},p.clone$1=un,p.collisionCircleLayout=tx,p.config=ft,p.conjugate=function(a,o){return a[0]=-o[0],a[1]=-o[1],a[2]=-o[2],a[3]=o[3],a},p.create=function(){var a=new Xa(16);return Xa!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},p.create$1=w1,p.createExpression=va,p.createLayout=xt,p.createStyleLayer=function(a){return"custom"===a.type?new c_(a):new Yo[a.type](a)},p.cross=Em,p.degToRad=rt,p.distance=function(a,o){return Math.hypot(o[0]-a[0],o[1]-a[1],o[2]-a[2])},p.div=function(a,o,u){return a[0]=o[0]/u[0],a[1]=o[1]/u[1],a[2]=o[2]/u[2],a},p.dot=sh,p.earthRadius=Am,p.ease=At,p.easeCubicInOut=Te,p.ecefToLatLng=function([a,o,u]){const f=Math.hypot(a,o,u),_=Math.atan2(a,u),E=.5*Math.PI-Math.acos(-o/f);return new Gi(Ve(_),Ve(E))},p.emitValidationErrors=qt,p.endsWith=Dn,p.enforceCacheSizeLimit=function(a){_r(),Gt&&Gt.then(o=>{o.keys().then(u=>{for(let f=0;f<u.length-a;f++)o.delete(u[f])})})},p.evaluateSizeForFeature=Ym,p.evaluateSizeForZoom=Cp,p.evaluateVariableOffset=_x,p.evented=T,p.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]&&a[3]===o[3]},p.exactEquals$1=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]},p.exported=Na,p.exported$1=Et,p.extend=Ie,p.extend$1=Vl,p.fillExtrusionHeightLift=qm,p.filterObject=bn,p.fromMat4=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[4],a[4]=o[5],a[5]=o[6],a[6]=o[8],a[7]=o[9],a[8]=o[10],a},p.fromQuat=function(a,o){var u=o[0],f=o[1],_=o[2],E=o[3],S=u+u,M=f+f,P=_+_,R=u*S,z=f*S,U=f*M,G=_*S,q=_*M,W=_*P,re=E*S,ve=E*M,ke=E*P;return a[0]=1-U-W,a[1]=z+ke,a[2]=G-ve,a[3]=0,a[4]=z-ke,a[5]=1-R-W,a[6]=q+re,a[7]=0,a[8]=G+ve,a[9]=q-re,a[10]=1-R-U,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},p.fromRotation=function(a,o){var u=Math.sin(o),f=Math.cos(o);return a[0]=f,a[1]=u,a[2]=0,a[3]=-u,a[4]=f,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},p.fromScaling=ap,p.furthestTileCorner=function(a){const o=Math.round((a+45+360)%360/90)%4;return Ke[o]},p.getAABBPointSquareDist=function(a,o,u){let f=0;for(let _=0;_<2;++_){const E=u?u[_]:0;a[_]>E&&(f+=(a[_]-E)*(a[_]-E)),o[_]<E&&(f+=(E-o[_])*(E-o[_]))}return f},p.getAnchorAlignment=hx,p.getAnchorJustification=Pp,p.getBounds=function(a){let o=1/0,u=1/0,f=-1/0,_=-1/0;for(const E of a)o=Math.min(o,E.x),u=Math.min(u,E.y),f=Math.max(f,E.x),_=Math.max(_,E.y);return{min:new ne(o,u),max:new ne(f,_)}},p.getColumn=xe,p.getDefaultExportFromCjs=Ne,p.getGridMatrix=function(a,o,u,f){const _=o.getNorth(),E=o.getSouth(),S=o.getWest(),M=o.getEast(),P=1<<a.z,R=M-S,z=_-E,U=R/64,G=-z/Mh[u],q=[0,U,0,G,0,0,_,S,0];if(a.z>0){const W=180/f;cg(q,q,[W/R+1,0,0,0,W/z+1,0,-.5*W/U,.5*W/G,1])}return q[2]=P,q[5]=a.x,q[8]=a.y,q},p.getImage=je,p.getJSON=function(a,o){return yi(Ie(a,{type:"json"}),o)},p.getLatitudinalLod=function(a){const o=Ol-5;a=we(a,-o,o)/o*90;const u=Math.pow(Math.abs(Math.sin(rt(a))),3);return Math.round(u*(Mh.length-1))},p.getMapSessionAPI=To,p.getPerformanceMeasurement=Ps,p.getProjection=wx,p.getRTLTextPluginStatus=A,p.getReferrer=mr,p.getTilePoint=function(a,{x:o,y:u},f=0){return new ne(((o-f)*a.scale-a.x)*pr,(u*a.scale-a.y)*pr)},p.getTileVec3=function(a,o,u=0){return lp(((o.x-u)*a.scale-a.x)*pr,(o.y*a.scale-a.y)*pr,P1(o.z,o.y))},p.getVideo=function(a,o){const u=be.document.createElement("video");u.muted=!0,u.onloadstart=function(){o(null,u)};for(let f=0;f<a.length;f++){const _=be.document.createElement("source");bs(a[f])||(u.crossOrigin="Anonymous"),_.src=a[f],u.appendChild(_)}return{cancel:()=>{}}},p.globeCenterToScreenPoint=function(a){const o=[0,0,0],u=Zu(new Float64Array(16));return ad(u,a.pixelMatrix,a.globeMatrix),ea(o,o,u),new ne(o[0],o[1])},p.globeDenormalizeECEF=Yu,p.globeECEFOrigin=function(a,o){const u=[0,0,0];return ea(u,u,mg(cd(o.canonical))),ea(u,u,a),u},p.globeMetersToEcef=up,p.globeNormalizeECEF=mg,p.globePixelsToTileUnits=function(a,o){return pr/(512*Math.pow(2,a))*Mm(cd(o))},p.globePoleMatrixForTile=function(a,o,u){const f=Zu(new Float64Array(16)),_=(o/(1<<a)-.5)*Math.PI*2;return ld(f,u.globeMatrix,_),Float32Array.from(f)},p.globeTileBounds=cd,p.globeTiltAtLngLat=_g,p.globeToMercatorTransition=Cf,p.globeUseCustomAntiAliasing=function(a,o,u){const f=Cf(u.zoom),_=a.style.map._antialias,E=!!o.extStandardDerivatives,S=o.extStandardDerivativesForceOff||a.terrain&&a.terrain.exaggeration()>0;return 0===f&&!_&&!S&&E},p.identity=Zu,p.identity$1=wy,p.invert=op,p.isFullscreen=function(){return!!be.document.fullscreenElement||!!be.document.webkitFullscreenElement},p.isLngLatBehindGlobe=Sf,p.isMapAuthenticated=function(a){return Vi.has(a)},p.isMapboxURL=Oe,p.isSafariWithAntialiasingBug=function(a){const o=a.navigator?a.navigator.userAgent:null;return!!Y(a)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=Rl,p.latLngToECEF=dp,p.len=xy,p.length=dg,p.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},p.lngFromMercatorX=_c,p.loadVectorTile=wC,p.makeRequest=yi,p.mapValue=function(a,o,u,f,_){return we((a-o)/(u-o)*(_-f)+f,f,_)},p.mercatorScale=Nm,p.mercatorXfromLng=lh,p.mercatorYfromLat=Nh,p.mercatorZfromAltitude=uh,p.mul=kI,p.mul$1=Cm,p.multiply=ad,p.multiply$1=cg,p.multiply$2=vy,p.nextPowerOfTwo=Mt,p.normalize=_l,p.normalize$1=T1,p.normalize$2=Sm,p.number=Ci,p.ortho=function(a,o,u,f,_,E,S){var M=1/(o-u),P=1/(f-_),R=1/(E-S);return a[0]=-2*M,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*P,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*R,a[11]=0,a[12]=(o+u)*M,a[13]=(_+f)*P,a[14]=(S+E)*R,a[15]=1,a},p.pbf=WE,p.perspective=function(a,o,u,f,_){var E,S=1/Math.tan(o/2);return a[0]=S/u,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=S,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=_&&_!==1/0?(a[10]=(_+f)*(E=1/(f-_)),a[14]=2*_*f*E):(a[10]=-1,a[14]=-2*f),a},p.pick=function(a,o){const u={};for(let f=0;f<o.length;f++){const _=o[f];_ in a&&(u[_]=a[_])}return u},p.plugin=F,p.pointGeometry=Fe,p.polesInViewport=function(a){const o=Zu(new Float64Array(16));ad(o,a.pixelMatrix,a.globeMatrix);const u=[0,eu,0],f=[0,tu,0];return ea(u,u,o),ea(f,f,o),[u[0]>0&&u[0]<=a.width&&u[1]>0&&u[1]<=a.height&&!Sf(a,new Gi(a.center.lat,90)),f[0]>0&&f[0]<=a.width&&f[1]>0&&f[1]<=a.height&&!Sf(a,new Gi(a.center.lat,-90))]},p.polygonContainsPoint=Ph,p.polygonIntersectsBox=Oy,p.polygonIntersectsPolygon=gp,p.polygonizeBounds=function(a,o,u=0,f=!0){const _=new ne(u,u),E=a.sub(_),S=o.add(_),M=[E,new ne(S.x,E.y),S,new ne(E.x,S.y)];return f&&M.push(E.clone()),M},p.posAttributes=gg,p.postMapLoadEvent=Jr,p.postPerformanceEvent=_o,p.postTurnstileEvent=Qr,p.potpack=Jm,p.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},p.radToDeg=Ve,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(a){return a({pluginStatus:x,pluginURL:c}),T.on("pluginStateChange",a),a},p.removeAuthState=function(a){Vi.delete(a)},p.renderColorRamp=Fm,p.resample=yg,p.rotateX=yy,p.rotateX$1=Ey,p.rotateY=ld,p.rotateY$1=Cy,p.rotateZ=function(a,o,u){var f=Math.sin(u),_=Math.cos(u),E=o[0],S=o[1],M=o[2],P=o[3],R=o[4],z=o[5],U=o[6],G=o[7];return o!==a&&(a[8]=o[8],a[9]=o[9],a[10]=o[10],a[11]=o[11],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=E*_+R*f,a[1]=S*_+z*f,a[2]=M*_+U*f,a[3]=P*_+G*f,a[4]=R*_-E*f,a[5]=z*_-S*f,a[6]=U*_-M*f,a[7]=G*_-P*f,a},p.rotateZ$1=function(a,o,u){u*=.5;var f=o[0],_=o[1],E=o[2],S=o[3],M=Math.sin(u),P=Math.cos(u);return a[0]=f*P+_*M,a[1]=_*P-f*M,a[2]=E*P+S*M,a[3]=S*P-E*M,a},p.scale=jd,p.scale$1=by,p.scale$2=vu,p.scaleAndAdd=wf,p.set=function(a,o,u,f){return a[0]=o,a[1]=u,a[2]=f,a},p.setCacheLimits=function(a,o){Tt=a,Ht=o},p.setColumn=function(a,o,u){a[4*o+0]=u[0],a[4*o+1]=u[1],a[4*o+2]=u[2],a[4*o+3]=u[3]},p.setRTLTextPlugin=function(a,o,u=!1){if(x===Fa||x===ip||x===wm)throw new Error("setRTLTextPlugin cannot be called multiple times.");c=Na.resolveURL(a),x=Fa,Th=o,C(),u||L()},p.smoothstep=at,p.spec=Wt,p.squaredLength=function(a){var o=a[0],u=a[1],f=a[2];return o*o+u*u+f*f},p.storeAuthState=function(a,o){o?Vi.add(a):Vi.delete(a)},p.sub=ah,p.subtract=C1,p.symbolSize=$E,p.tileAABB=function(a,o,u,f,_,E,S,M,P){if("globe"===P.name)return function BI(a,o,u){const f=o/a.worldSize,_=a.globeMatrix;if(u.z<=1){const Rt=cd(u).getCorners();return pE(Rt,_,f),xu.fromPoints(Rt)}const E=Dy(u),S=Wd(E);pE(S,_,f);const M=Number.MAX_VALUE,P=[-M,-M,-M],R=[M,M,M];if(E.contains(a.center)){for(const _n of S)$d(R,R,_n),fg(P,P,_n);P[2]=0;const Rt=a.point,Xt=[Rt.x*f,Rt.y*f,0];return $d(R,R,Xt),fg(P,P,Xt),new xu(R,P)}const z=[_[12]*f,_[13]*f,_[14]*f],U=E.getCenter(),G=we(a.center.lat,-Ol,Ol),q=we(U.lat,-Ol,Ol),W=lh(a.center.lng),re=Nh(G);let ve=W-lh(U.lng);const ke=re-Nh(q);ve>.5?ve-=1:ve<-.5&&(ve+=1);let et=0;Math.abs(ve)>Math.abs(ke)?et=ve>=0?1:3:(et=ke>=0?0:2,wf(z,z,[_[4]*f,_[5]*f,_[6]*f],-Math.sin(rt(ke>=0?E.getSouth():E.getNorth()))*Ih));const Be=S[et],Je=S[(et+1)%4],nt=new FI(Be,Je,z),ot=[Sy(nt,0)||Be[0],Sy(nt,1)||Be[1],Sy(nt,2)||Be[2]],zt=Cf(a.zoom);if(zt>0){const Rt=function({x:_n,y:jt,z:tn},nn,dn,wn,Zt){const On=1/(1<<tn);let Wn=_n*On,kn=Wn+On,qr=jt*On,Cn=qr+On,fr=0;const Dr=(Wn+kn)/2-wn;return Dr>.5?fr=-1:Dr<-.5&&(fr=1),Wn=((Wn+fr)*nn-(wn*=nn))*dn+wn,kn=((kn+fr)*nn-wn)*dn+wn,qr=(qr*nn-(Zt*=nn))*dn+Zt,Cn=(Cn*nn-Zt)*dn+Zt,[[Wn,Cn,0],[kn,Cn,0],[kn,qr,0],[Wn,qr,0]]}(u,o,a._pixelsPerMercatorPixel,W,re);for(let _n=0;_n<S.length;_n++)cp(S[_n],Rt[_n],zt);const Xt=Gd([],Rt[et],Rt[(et+1)%4]);vu(Xt,Xt,.5),cp(ot,Xt,zt)}for(const Rt of S)$d(R,R,Rt),fg(P,P,Rt);return R[2]=Math.min(Be[2],Je[2]),$d(R,R,ot),fg(P,P,ot),new xu(R,P)}(a,o,new Ep(u,f,_));const R=kh({z:u,x:f,y:_},P);return new xu([(E+R.x/R.scale)*o,o*(R.y/R.scale),S],[(E+R.x2/R.scale)*o,o*(R.y2/R.scale),M])},p.tileCornersToBounds=Dy,p.tileTransform=kh,p.transformMat3=function(a,o,u){var f=o[0],_=o[1],E=o[2];return a[0]=f*u[0]+_*u[3]+E*u[6],a[1]=f*u[1]+_*u[4]+E*u[7],a[2]=f*u[2]+_*u[5]+E*u[8],a},p.transformMat4=ea,p.transformMat4$1=ud,p.transformQuat=S1,p.transitionTileAABBinECEF=fE,p.translate=sp,p.transpose=function(a,o){if(a===o){var u=o[1],f=o[2],_=o[5];a[1]=o[3],a[2]=o[6],a[3]=u,a[5]=o[7],a[6]=f,a[7]=_}else a[0]=o[0],a[1]=o[3],a[2]=o[6],a[3]=o[1],a[4]=o[4],a[5]=o[7],a[6]=o[2],a[7]=o[5],a[8]=o[8];return a},p.triggerPluginCompletionEvent=g,p.uniqueId=It,p.updateGlobeVertexNormal=function(a,o,u,f,_){const E=5*o+2;a.float32[E+0]=u,a.float32[E+1]=f,a.float32[E+2]=_},p.validateCustomStyleLayer=function(a){const o=[],u=a.id;return void 0===u&&o.push({message:`layers.${u}: missing required property "id"`}),void 0===a.render&&o.push({message:`layers.${u}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&o.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),o},p.validateFilter=a=>kt(ss(a)),p.validateFog=a=>kt(b(a)),p.validateLayer=a=>kt(ka(a)),p.validateLight=a=>kt(h(a)),p.validateSource=a=>kt(td(a)),p.validateStyle=oe,p.validateTerrain=a=>kt(y(a)),p.values=pt,p.vectorTile=Cg,p.version=Xe,p.warnOnce=gr,p.window=be,p.wrap=Ae}),ze(0,function(p){function be(Ge){if("number"==typeof Ge||"boolean"==typeof Ge||"string"==typeof Ge||null==Ge)return JSON.stringify(Ge);if(Array.isArray(Ge)){let ae="[";for(const je of Ge)ae+=`${be(je)},`;return`${ae}]`}let se="{";for(const ae of Object.keys(Ge).sort())se+=`${ae}:${be(Ge[ae])},`;return`${se}}`}function Xe(Ge){let se="";for(const ae of p.refProperties)se+=`/${be(Ge[ae])}`;return se}class dt{constructor(se){this.keyCache={},se&&this.replace(se)}replace(se){this._layerConfigs={},this._layers={},this.update(se,[])}update(se,ae){for(const tt of se)this._layerConfigs[tt.id]=tt,(this._layers[tt.id]=p.createStyleLayer(tt)).compileFilter(),this.keyCache[tt.id]&&delete this.keyCache[tt.id];for(const tt of ae)delete this.keyCache[tt],delete this._layerConfigs[tt],delete this._layers[tt];this.familiesBySource={};const je=function(tt,Oe){const Ct={};for(let Qe=0;Qe<tt.length;Qe++){const Lt=Oe&&Oe[tt[Qe].id]||Xe(tt[Qe]);Oe&&(Oe[tt[Qe].id]=Lt);let fn=Ct[Lt];fn||(fn=Ct[Lt]=[]),fn.push(tt[Qe])}const bt=[];for(const Qe in Ct)bt.push(Ct[Qe]);return bt}(p.values(this._layerConfigs),this.keyCache);for(const tt of je){const Oe=tt.map(En=>this._layers[En.id]),Ct=Oe[0];if("none"===Ct.visibility)continue;const bt=Ct.source||"";let Qe=this.familiesBySource[bt];Qe||(Qe=this.familiesBySource[bt]={});const Lt=Ct.sourceLayer||"_geojsonTileLayer";let fn=Qe[Lt];fn||(fn=Qe[Lt]=[]),fn.push(Oe)}}}class ft{loadTile(se,ae){const{uid:je,encoding:tt,rawImageData:Oe,padding:Ct,buildQuadTree:bt}=se,Qe=p.window.ImageBitmap&&Oe instanceof p.window.ImageBitmap?this.getImageData(Oe,Ct):Oe;ae(null,new p.DEMData(je,Qe,tt,Ct<1,bt))}getImageData(se,ae){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(se.width,se.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=se.width,this.offscreenCanvas.height=se.height,this.offscreenCanvasContext.drawImage(se,0,0,se.width,se.height);const je=this.offscreenCanvasContext.getImageData(-ae,-ae,se.width+2*ae,se.height+2*ae);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),je}}function Et(Ge,se){if(0!==Ge.length){rn(Ge[0],se);for(var ae=1;ae<Ge.length;ae++)rn(Ge[ae],!se)}}function rn(Ge,se){for(var ae=0,je=0,tt=0,Oe=Ge.length,Ct=Oe-1;tt<Oe;Ct=tt++){var bt=(Ge[tt][0]-Ge[Ct][0])*(Ge[Ct][1]+Ge[tt][1]),Qe=ae+bt;je+=Math.abs(ae)>=Math.abs(bt)?ae-Qe+bt:bt-Qe+ae,ae=Qe}ae+je>=0!=!!se&&Ge.reverse()}var Dt=p.getDefaultExportFromCjs(function Ge(se,ae){var je,tt=se&&se.type;if("FeatureCollection"===tt)for(je=0;je<se.features.length;je++)Ge(se.features[je],ae);else if("GeometryCollection"===tt)for(je=0;je<se.geometries.length;je++)Ge(se.geometries[je],ae);else if("Feature"===tt)Ge(se.geometry,ae);else if("Polygon"===tt)Et(se.coordinates,ae);else if("MultiPolygon"===tt)for(je=0;je<se.coordinates.length;je++)Et(se.coordinates[je],ae);return se});const mt=p.VectorTileFeature.prototype.toGeoJSON;var Vt={exports:{}},hn=p.pointGeometry,de=p.vectorTile.VectorTileFeature,Ne=ue;function ue(Ge,se){this.options=se||{},this.features=Ge,this.length=Ge.length}function fe(Ge,se){this.id="number"==typeof Ge.id?Ge.id:void 0,this.type=Ge.type,this.rawGeometry=1===Ge.type?[Ge.geometry]:Ge.geometry,this.properties=Ge.tags,this.extent=se||4096}ue.prototype.feature=function(Ge){return new fe(this.features[Ge],this.options.extent)},fe.prototype.loadGeometry=function(){var Ge=this.rawGeometry;this.geometry=[];for(var se=0;se<Ge.length;se++){for(var ae=Ge[se],je=[],tt=0;tt<ae.length;tt++)je.push(new hn(ae[tt][0],ae[tt][1]));this.geometry.push(je)}return this.geometry},fe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ge=this.geometry,se=1/0,ae=-1/0,je=1/0,tt=-1/0,Oe=0;Oe<Ge.length;Oe++)for(var Ct=Ge[Oe],bt=0;bt<Ct.length;bt++){var Qe=Ct[bt];se=Math.min(se,Qe.x),ae=Math.max(ae,Qe.x),je=Math.min(je,Qe.y),tt=Math.max(tt,Qe.y)}return[se,je,ae,tt]},fe.prototype.toGeoJSON=de.prototype.toGeoJSON;var he=p.pbf,Fe=Ne;function ce(Ge){var se=new he;return function(ae,je){for(var tt in ae.layers)je.writeMessage(3,ne,ae.layers[tt])}(Ge,se),se.finish()}function ne(Ge,se){var ae;se.writeVarintField(15,Ge.version||1),se.writeStringField(1,Ge.name||""),se.writeVarintField(5,Ge.extent||4096);var je={keys:[],values:[],keycache:{},valuecache:{}};for(ae=0;ae<Ge.length;ae++)je.feature=Ge.feature(ae),se.writeMessage(2,Me,je);var tt=je.keys;for(ae=0;ae<tt.length;ae++)se.writeStringField(3,tt[ae]);var Oe=je.values;for(ae=0;ae<Oe.length;ae++)se.writeMessage(4,Te,Oe[ae])}function Me(Ge,se){var ae=Ge.feature;void 0!==ae.id&&se.writeVarintField(1,ae.id),se.writeMessage(2,ie,Ge),se.writeVarintField(3,ae.type),se.writeMessage(4,Ke,ae)}function ie(Ge,se){var ae=Ge.feature,je=Ge.keys,tt=Ge.values,Oe=Ge.keycache,Ct=Ge.valuecache;for(var bt in ae.properties){var Qe=ae.properties[bt],Lt=Oe[bt];if(null!==Qe){void 0===Lt&&(je.push(bt),Oe[bt]=Lt=je.length-1),se.writeVarint(Lt);var fn=typeof Qe;"string"!==fn&&"boolean"!==fn&&"number"!==fn&&(Qe=JSON.stringify(Qe));var En=fn+":"+Qe,pn=Ct[En];void 0===pn&&(tt.push(Qe),Ct[En]=pn=tt.length-1),se.writeVarint(pn)}}}function rt(Ge,se){return(se<<3)+(7&Ge)}function Ve(Ge){return Ge<<1^Ge>>31}function Ke(Ge,se){for(var ae=Ge.loadGeometry(),je=Ge.type,tt=0,Oe=0,Ct=ae.length,bt=0;bt<Ct;bt++){var Qe=ae[bt],Lt=1;1===je&&(Lt=Qe.length),se.writeVarint(rt(1,Lt));for(var fn=3===je?Qe.length-1:Qe.length,En=0;En<fn;En++){1===En&&1!==je&&se.writeVarint(rt(2,fn-1));var pn=Qe[En].x-tt,Vr=Qe[En].y-Oe;se.writeVarint(Ve(pn)),se.writeVarint(Ve(Vr)),tt+=pn,Oe+=Vr}3===je&&se.writeVarint(rt(7,1))}}function Te(Ge,se){var ae=typeof Ge;"string"===ae?se.writeStringField(1,Ge):"boolean"===ae?se.writeBooleanField(7,Ge):"number"===ae&&(Ge%1!=0?se.writeDoubleField(3,Ge):Ge<0?se.writeSVarintField(6,Ge):se.writeVarintField(5,Ge))}Vt.exports=ce,Vt.exports.fromVectorTileJs=ce,Vt.exports.fromGeojsonVt=function(Ge,se){se=se||{};var ae={};for(var je in Ge)ae[je]=new Fe(Ge[je].features,se),ae[je].name=je,ae[je].version=se.version,ae[je].extent=se.extent;return ce({layers:ae})},Vt.exports.GeoJSONWrapper=Fe;var Kt=p.getDefaultExportFromCjs(Vt.exports);const At={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ge=>Ge},we=Math.fround||(at=new Float32Array(1),Ge=>(at[0]=+Ge,at[0]));var at;const Ae=3,it=5,pt=6;class Ie{constructor(se){this.options=Object.assign(Object.create(At),se),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(se){const{log:ae,minZoom:je,maxZoom:tt}=this.options;ae&&console.time("total time");const Oe=`prepare ${se.length} points`;ae&&console.time(Oe),this.points=se;const Ct=[];for(let Qe=0;Qe<se.length;Qe++){const Lt=se[Qe];if(!Lt.geometry)continue;const[fn,En]=Lt.geometry.coordinates,pn=we(yn(fn)),Vr=we(Mt(En));Ct.push(pn,Vr,1/0,Qe,-1,1),this.options.reduce&&Ct.push(0)}let bt=this.trees[tt+1]=this._createTree(Ct);ae&&console.timeEnd(Oe);for(let Qe=tt;Qe>=je;Qe--){const Lt=+Date.now();bt=this.trees[Qe]=this._createTree(this._cluster(bt,Qe)),ae&&console.log("z%d: %d clusters in %dms",Qe,bt.numItems,+Date.now()-Lt)}return ae&&console.timeEnd("total time"),this}getClusters(se,ae){let je=((se[0]+180)%360+360)%360-180;const tt=Math.max(-90,Math.min(90,se[1]));let Oe=180===se[2]?180:((se[2]+180)%360+360)%360-180;const Ct=Math.max(-90,Math.min(90,se[3]));if(se[2]-se[0]>=360)je=-180,Oe=180;else if(je>Oe){const En=this.getClusters([je,tt,180,Ct],ae),pn=this.getClusters([-180,tt,Oe,Ct],ae);return En.concat(pn)}const bt=this.trees[this._limitZoom(ae)],Qe=bt.range(yn(je),Mt(Ct),yn(Oe),Mt(tt)),Lt=bt.data,fn=[];for(const En of Qe){const pn=this.stride*En;fn.push(Lt[pn+it]>1?Ut(Lt,pn,this.clusterProps):this.points[Lt[pn+Ae]])}return fn}getChildren(se){const ae=this._getOriginId(se),je=this._getOriginZoom(se),tt="No cluster with the specified id.",Oe=this.trees[je];if(!Oe)throw new Error(tt);const Ct=Oe.data;if(ae*this.stride>=Ct.length)throw new Error(tt);const bt=this.options.radius/(this.options.extent*Math.pow(2,je-1)),Qe=Oe.within(Ct[ae*this.stride],Ct[ae*this.stride+1],bt),Lt=[];for(const fn of Qe){const En=fn*this.stride;Ct[En+4]===se&&Lt.push(Ct[En+it]>1?Ut(Ct,En,this.clusterProps):this.points[Ct[En+Ae]])}if(0===Lt.length)throw new Error(tt);return Lt}getLeaves(se,ae,je){const tt=[];return this._appendLeaves(tt,se,ae=ae||10,je=je||0,0),tt}getTile(se,ae,je){const tt=this.trees[this._limitZoom(se)],Oe=Math.pow(2,se),{extent:Ct,radius:bt}=this.options,Qe=bt/Ct,Lt=(je-Qe)/Oe,fn=(je+1+Qe)/Oe,En={features:[]};return this._addTileFeatures(tt.range((ae-Qe)/Oe,Lt,(ae+1+Qe)/Oe,fn),tt.data,ae,je,Oe,En),0===ae&&this._addTileFeatures(tt.range(1-Qe/Oe,Lt,1,fn),tt.data,Oe,je,Oe,En),ae===Oe-1&&this._addTileFeatures(tt.range(0,Lt,Qe/Oe,fn),tt.data,-1,je,Oe,En),En.features.length?En:null}getClusterExpansionZoom(se){let ae=this._getOriginZoom(se)-1;for(;ae<=this.options.maxZoom;){const je=this.getChildren(se);if(ae++,1!==je.length)break;se=je[0].properties.cluster_id}return ae}_appendLeaves(se,ae,je,tt,Oe){const Ct=this.getChildren(ae);for(const bt of Ct){const Qe=bt.properties;if(Qe&&Qe.cluster?Oe+Qe.point_count<=tt?Oe+=Qe.point_count:Oe=this._appendLeaves(se,Qe.cluster_id,je,tt,Oe):Oe<tt?Oe++:se.push(bt),se.length===je)break}return Oe}_createTree(se){const ae=new p.KDBush(se.length/this.stride|0,this.options.nodeSize,Float32Array);for(let je=0;je<se.length;je+=this.stride)ae.add(se[je],se[je+1]);return ae.finish(),ae.data=se,ae}_addTileFeatures(se,ae,je,tt,Oe,Ct){for(const bt of se){const Qe=bt*this.stride,Lt=ae[Qe+it]>1;let fn,En,pn;if(Lt)fn=It(ae,Qe,this.clusterProps),En=ae[Qe],pn=ae[Qe+1];else{const Ur=this.points[ae[Qe+Ae]];fn=Ur.properties;const[Nr,Qr]=Ur.geometry.coordinates;En=yn(Nr),pn=Mt(Qr)}const Vr={type:1,geometry:[[Math.round(this.options.extent*(En*Oe-je)),Math.round(this.options.extent*(pn*Oe-tt))]],tags:fn};let Kr;Kr=Lt||this.options.generateId?ae[Qe+Ae]:this.points[ae[Qe+Ae]].id,void 0!==Kr&&(Vr.id=Kr),Ct.features.push(Vr)}}_limitZoom(se){return Math.max(this.options.minZoom,Math.min(Math.floor(+se),this.options.maxZoom+1))}_cluster(se,ae){const{radius:je,extent:tt,reduce:Oe,minPoints:Ct}=this.options,bt=je/(tt*Math.pow(2,ae)),Qe=se.data,Lt=[],fn=this.stride;for(let En=0;En<Qe.length;En+=fn){if(Qe[En+2]<=ae)continue;Qe[En+2]=ae;const pn=Qe[En],Vr=Qe[En+1],Kr=se.within(Qe[En],Qe[En+1],bt),Ur=Qe[En+it];let Nr=Ur;for(const Qr of Kr){const Ro=Qr*fn;Qe[Ro+2]>ae&&(Nr+=Qe[Ro+it])}if(Nr>Ur&&Nr>=Ct){let Qr,Ro=pn*Ur,Jr=Vr*Ur,Br=-1;const _o=((En/fn|0)<<5)+(ae+1)+this.points.length;for(const $s of Kr){const To=$s*fn;if(Qe[To+2]<=ae)continue;Qe[To+2]=ae;const Vi=Qe[To+it];Ro+=Qe[To]*Vi,Jr+=Qe[To+1]*Vi,Qe[To+4]=_o,Oe&&(Qr||(Qr=this._map(Qe,En,!0),Br=this.clusterProps.length,this.clusterProps.push(Qr)),Oe(Qr,this._map(Qe,To)))}Qe[En+4]=_o,Lt.push(Ro/Nr,Jr/Nr,1/0,_o,-1,Nr),Oe&&Lt.push(Br)}else{for(let Qr=0;Qr<fn;Qr++)Lt.push(Qe[En+Qr]);if(Nr>1)for(const Qr of Kr){const Ro=Qr*fn;if(!(Qe[Ro+2]<=ae)){Qe[Ro+2]=ae;for(let Jr=0;Jr<fn;Jr++)Lt.push(Qe[Ro+Jr])}}}}return Lt}_getOriginId(se){return se-this.points.length>>5}_getOriginZoom(se){return(se-this.points.length)%32}_map(se,ae,je){if(se[ae+it]>1){const Ct=this.clusterProps[se[ae+pt]];return je?Object.assign({},Ct):Ct}const tt=this.points[se[ae+Ae]].properties,Oe=this.options.map(tt);return je&&Oe===tt?Object.assign({},Oe):Oe}}function Ut(Ge,se,ae){return{type:"Feature",id:Ge[se+Ae],properties:It(Ge,se,ae),geometry:{type:"Point",coordinates:[(je=Ge[se],360*(je-.5)),$n(Ge[se+1])]}};var je}function It(Ge,se,ae){const je=Ge[se+it],tt=je>=1e4?`${Math.round(je/1e3)}k`:je>=1e3?Math.round(je/100)/10+"k":je,Oe=Ge[se+pt],Ct=-1===Oe?{}:Object.assign({},ae[Oe]);return Object.assign(Ct,{cluster:!0,cluster_id:Ge[se+Ae],point_count:je,point_count_abbreviated:tt})}function yn(Ge){return Ge/360+.5}function Mt(Ge){const se=Math.sin(Ge*Math.PI/180),ae=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return ae<0?0:ae>1?1:ae}function $n(Ge){const se=(180-360*Ge)*Math.PI/180;return 360*Math.atan(Math.exp(se))/Math.PI-90}function Nn(Ge,se,ae,je){for(var tt,Oe=je,Ct=ae-se>>1,bt=ae-se,Qe=Ge[se],Lt=Ge[se+1],fn=Ge[ae],En=Ge[ae+1],pn=se+3;pn<ae;pn+=3){var Vr=Dn(Ge[pn],Ge[pn+1],Qe,Lt,fn,En);if(Vr>Oe)tt=pn,Oe=Vr;else if(Vr===Oe){var Kr=Math.abs(pn-Ct);Kr<bt&&(tt=pn,bt=Kr)}}Oe>je&&(tt-se>3&&Nn(Ge,se,tt,je),Ge[tt+2]=Oe,ae-tt>3&&Nn(Ge,tt,ae,je))}function Dn(Ge,se,ae,je,tt,Oe){var Ct=tt-ae,bt=Oe-je;if(0!==Ct||0!==bt){var Qe=((Ge-ae)*Ct+(se-je)*bt)/(Ct*Ct+bt*bt);Qe>1?(ae=tt,je=Oe):Qe>0&&(ae+=Ct*Qe,je+=bt*Qe)}return(Ct=Ge-ae)*Ct+(bt=se-je)*bt}function gn(Ge,se,ae,je){var tt={id:void 0===Ge?null:Ge,type:se,geometry:ae,tags:je,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Oe){var Ct=Oe.geometry,bt=Oe.type;if("Point"===bt||"MultiPoint"===bt||"LineString"===bt)bn(Oe,Ct);else if("Polygon"===bt||"MultiLineString"===bt)for(var Qe=0;Qe<Ct.length;Qe++)bn(Oe,Ct[Qe]);else if("MultiPolygon"===bt)for(Qe=0;Qe<Ct.length;Qe++)for(var Lt=0;Lt<Ct[Qe].length;Lt++)bn(Oe,Ct[Qe][Lt])}(tt),tt}function bn(Ge,se){for(var ae=0;ae<se.length;ae+=3)Ge.minX=Math.min(Ge.minX,se[ae]),Ge.minY=Math.min(Ge.minY,se[ae+1]),Ge.maxX=Math.max(Ge.maxX,se[ae]),Ge.maxY=Math.max(Ge.maxY,se[ae+1])}function un(Ge,se,ae,je){if(se.geometry){var tt=se.geometry.coordinates,Oe=se.geometry.type,Ct=Math.pow(ae.tolerance/((1<<ae.maxZoom)*ae.extent),2),bt=[],Qe=se.id;if(ae.promoteId?Qe=se.properties[ae.promoteId]:ae.generateId&&(Qe=je||0),"Point"===Oe)Ai(tt,bt);else if("MultiPoint"===Oe)for(var Lt=0;Lt<tt.length;Lt++)Ai(tt[Lt],bt);else if("LineString"===Oe)gr(tt,bt,Ct,!1);else if("MultiLineString"===Oe){if(ae.lineMetrics){for(Lt=0;Lt<tt.length;Lt++)gr(tt[Lt],bt=[],Ct,!1),Ge.push(gn(Qe,"LineString",bt,se.properties));return}ii(tt,bt,Ct,!1)}else if("Polygon"===Oe)ii(tt,bt,Ct,!0);else{if("MultiPolygon"!==Oe){if("GeometryCollection"===Oe){for(Lt=0;Lt<se.geometry.geometries.length;Lt++)un(Ge,{id:Qe,geometry:se.geometry.geometries[Lt],properties:se.properties},ae,je);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Lt=0;Lt<tt.length;Lt++){var fn=[];ii(tt[Lt],fn,Ct,!0),bt.push(fn)}}Ge.push(gn(Qe,Oe,bt,se.properties))}}function Ai(Ge,se){se.push(ir(Ge[0])),se.push(lr(Ge[1])),se.push(0)}function gr(Ge,se,ae,je){for(var tt,Oe,Ct=0,bt=0;bt<Ge.length;bt++){var Qe=ir(Ge[bt][0]),Lt=lr(Ge[bt][1]);se.push(Qe),se.push(Lt),se.push(0),bt>0&&(Ct+=je?(tt*Lt-Qe*Oe)/2:Math.sqrt(Math.pow(Qe-tt,2)+Math.pow(Lt-Oe,2))),tt=Qe,Oe=Lt}var fn=se.length-3;se[2]=1,Nn(se,0,fn,ae),se[fn+2]=1,se.size=Math.abs(Ct),se.start=0,se.end=se.size}function ii(Ge,se,ae,je){for(var tt=0;tt<Ge.length;tt++){var Oe=[];gr(Ge[tt],Oe,ae,je),se.push(Oe)}}function ir(Ge){return Ge/360+.5}function lr(Ge){var se=Math.sin(Ge*Math.PI/180),ae=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return ae<0?0:ae>1?1:ae}function ye(Ge,se,ae,je,tt,Oe,Ct,bt){if(je/=se,Oe>=(ae/=se)&&Ct<je)return Ge;if(Ct<ae||Oe>=je)return null;for(var Qe=[],Lt=0;Lt<Ge.length;Lt++){var fn=Ge[Lt],En=fn.geometry,pn=fn.type,Vr=0===tt?fn.minX:fn.minY,Kr=0===tt?fn.maxX:fn.maxY;if(Vr>=ae&&Kr<je)Qe.push(fn);else if(!(Kr<ae||Vr>=je)){var Ur=[];if("Point"===pn||"MultiPoint"===pn)Z(En,Ur,ae,je,tt);else if("LineString"===pn)Y(En,Ur,ae,je,tt,!1,bt.lineMetrics);else if("MultiLineString"===pn)xe(En,Ur,ae,je,tt,!1);else if("Polygon"===pn)xe(En,Ur,ae,je,tt,!0);else if("MultiPolygon"===pn)for(var Nr=0;Nr<En.length;Nr++){var Qr=[];xe(En[Nr],Qr,ae,je,tt,!0),Qr.length&&Ur.push(Qr)}if(Ur.length){if(bt.lineMetrics&&"LineString"===pn){for(Nr=0;Nr<Ur.length;Nr++)Qe.push(gn(fn.id,pn,Ur[Nr],fn.tags));continue}"LineString"!==pn&&"MultiLineString"!==pn||(1===Ur.length?(pn="LineString",Ur=Ur[0]):pn="MultiLineString"),"Point"!==pn&&"MultiPoint"!==pn||(pn=3===Ur.length?"Point":"MultiPoint"),Qe.push(gn(fn.id,pn,Ur,fn.tags))}}}return Qe.length?Qe:null}function Z(Ge,se,ae,je,tt){for(var Oe=0;Oe<Ge.length;Oe+=3){var Ct=Ge[Oe+tt];Ct>=ae&&Ct<=je&&(se.push(Ge[Oe]),se.push(Ge[Oe+1]),se.push(Ge[Oe+2]))}}function Y(Ge,se,ae,je,tt,Oe,Ct){for(var bt,Qe,Lt=J(Ge),fn=0===tt?Tt:Ht,En=Ge.start,pn=0;pn<Ge.length-3;pn+=3){var Vr=Ge[pn],Kr=Ge[pn+1],Ur=Ge[pn+2],Nr=Ge[pn+3],Qr=Ge[pn+4],Ro=0===tt?Vr:Kr,Jr=0===tt?Nr:Qr,Br=!1;Ct&&(bt=Math.sqrt(Math.pow(Vr-Nr,2)+Math.pow(Kr-Qr,2))),Ro<ae?Jr>ae&&(Qe=fn(Lt,Vr,Kr,Nr,Qr,ae),Ct&&(Lt.start=En+bt*Qe)):Ro>je?Jr<je&&(Qe=fn(Lt,Vr,Kr,Nr,Qr,je),Ct&&(Lt.start=En+bt*Qe)):We(Lt,Vr,Kr,Ur),Jr<ae&&Ro>=ae&&(Qe=fn(Lt,Vr,Kr,Nr,Qr,ae),Br=!0),Jr>je&&Ro<=je&&(Qe=fn(Lt,Vr,Kr,Nr,Qr,je),Br=!0),!Oe&&Br&&(Ct&&(Lt.end=En+bt*Qe),se.push(Lt),Lt=J(Ge)),Ct&&(En+=bt)}var _o=Ge.length-3;Vr=Ge[_o],Kr=Ge[_o+1],Ur=Ge[_o+2],(Ro=0===tt?Vr:Kr)>=ae&&Ro<=je&&We(Lt,Vr,Kr,Ur),_o=Lt.length-3,Oe&&_o>=3&&(Lt[_o]!==Lt[0]||Lt[_o+1]!==Lt[1])&&We(Lt,Lt[0],Lt[1],Lt[2]),Lt.length&&se.push(Lt)}function J(Ge){var se=[];return se.size=Ge.size,se.start=Ge.start,se.end=Ge.end,se}function xe(Ge,se,ae,je,tt,Oe){for(var Ct=0;Ct<Ge.length;Ct++)Y(Ge[Ct],se,ae,je,tt,Oe,!1)}function We(Ge,se,ae,je){Ge.push(se),Ge.push(ae),Ge.push(je)}function Tt(Ge,se,ae,je,tt,Oe){var Ct=(Oe-se)/(je-se);return Ge.push(Oe),Ge.push(ae+(tt-ae)*Ct),Ge.push(1),Ct}function Ht(Ge,se,ae,je,tt,Oe){var Ct=(Oe-ae)/(tt-ae);return Ge.push(se+(je-se)*Ct),Ge.push(Oe),Ge.push(1),Ct}function Gt(Ge,se){for(var ae=[],je=0;je<Ge.length;je++){var tt,Oe=Ge[je],Ct=Oe.type;if("Point"===Ct||"MultiPoint"===Ct||"LineString"===Ct)tt=Ot(Oe.geometry,se);else if("MultiLineString"===Ct||"Polygon"===Ct){tt=[];for(var bt=0;bt<Oe.geometry.length;bt++)tt.push(Ot(Oe.geometry[bt],se))}else if("MultiPolygon"===Ct)for(tt=[],bt=0;bt<Oe.geometry.length;bt++){for(var Qe=[],Lt=0;Lt<Oe.geometry[bt].length;Lt++)Qe.push(Ot(Oe.geometry[bt][Lt],se));tt.push(Qe)}ae.push(gn(Oe.id,Ct,tt,Oe.tags))}return ae}function Ot(Ge,se){var ae=[];ae.size=Ge.size,void 0!==Ge.start&&(ae.start=Ge.start,ae.end=Ge.end);for(var je=0;je<Ge.length;je+=3)ae.push(Ge[je]+se,Ge[je+1],Ge[je+2]);return ae}function or(Ge,se){if(Ge.transformed)return Ge;var ae,je,tt,Oe=1<<Ge.z,Ct=Ge.x,bt=Ge.y;for(ae=0;ae<Ge.features.length;ae++){var Qe=Ge.features[ae],Lt=Qe.geometry,fn=Qe.type;if(Qe.geometry=[],1===fn)for(je=0;je<Lt.length;je+=2)Qe.geometry.push(_r(Lt[je],Lt[je+1],se,Oe,Ct,bt));else for(je=0;je<Lt.length;je++){var En=[];for(tt=0;tt<Lt[je].length;tt+=2)En.push(_r(Lt[je][tt],Lt[je][tt+1],se,Oe,Ct,bt));Qe.geometry.push(En)}}return Ge.transformed=!0,Ge}function _r(Ge,se,ae,je,tt,Oe){return[Math.round(ae*(Ge*je-tt)),Math.round(ae*(se*je-Oe))]}function Sn(Ge,se,ae,je,tt){for(var Oe=se===tt.maxZoom?0:tt.tolerance/((1<<se)*tt.extent),Ct={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ae,y:je,z:se,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},bt=0;bt<Ge.length;bt++){Ct.numFeatures++,Cr(Ct,Ge[bt],Oe,tt);var Qe=Ge[bt].minX,Lt=Ge[bt].minY,fn=Ge[bt].maxX,En=Ge[bt].maxY;Qe<Ct.minX&&(Ct.minX=Qe),Lt<Ct.minY&&(Ct.minY=Lt),fn>Ct.maxX&&(Ct.maxX=fn),En>Ct.maxY&&(Ct.maxY=En)}return Ct}function Cr(Ge,se,ae,je){var tt=se.geometry,Oe=se.type,Ct=[];if("Point"===Oe||"MultiPoint"===Oe)for(var bt=0;bt<tt.length;bt+=3)Ct.push(tt[bt]),Ct.push(tt[bt+1]),Ge.numPoints++,Ge.numSimplified++;else if("LineString"===Oe)kr(Ct,tt,Ge,ae,!1,!1);else if("MultiLineString"===Oe||"Polygon"===Oe)for(bt=0;bt<tt.length;bt++)kr(Ct,tt[bt],Ge,ae,"Polygon"===Oe,0===bt);else if("MultiPolygon"===Oe)for(var Qe=0;Qe<tt.length;Qe++){var Lt=tt[Qe];for(bt=0;bt<Lt.length;bt++)kr(Ct,Lt[bt],Ge,ae,!0,0===bt)}if(Ct.length){var fn=se.tags||null;if("LineString"===Oe&&je.lineMetrics){for(var En in fn={},se.tags)fn[En]=se.tags[En];fn.mapbox_clip_start=tt.start/tt.size,fn.mapbox_clip_end=tt.end/tt.size}var pn={geometry:Ct,type:"Polygon"===Oe||"MultiPolygon"===Oe?3:"LineString"===Oe||"MultiLineString"===Oe?2:1,tags:fn};null!==se.id&&(pn.id=se.id),Ge.features.push(pn)}}function kr(Ge,se,ae,je,tt,Oe){var Ct=je*je;if(je>0&&se.size<(tt?Ct:je))ae.numPoints+=se.length/3;else{for(var bt=[],Qe=0;Qe<se.length;Qe+=3)(0===je||se[Qe+2]>Ct)&&(ae.numSimplified++,bt.push(se[Qe]),bt.push(se[Qe+1])),ae.numPoints++;tt&&function(Lt,fn){for(var En=0,pn=0,Vr=Lt.length,Kr=Vr-2;pn<Vr;Kr=pn,pn+=2)En+=(Lt[pn]-Lt[Kr])*(Lt[pn+1]+Lt[Kr+1]);if(En>0===fn)for(pn=0,Vr=Lt.length;pn<Vr/2;pn+=2){var Ur=Lt[pn],Nr=Lt[pn+1];Lt[pn]=Lt[Vr-2-pn],Lt[pn+1]=Lt[Vr-1-pn],Lt[Vr-2-pn]=Ur,Lt[Vr-1-pn]=Nr}}(bt,Oe),Ge.push(bt)}}function Fr(Ge,se){var ae=(se=this.options=function(tt,Oe){for(var Ct in Oe)tt[Ct]=Oe[Ct];return tt}(Object.create(this.options),se)).debug;if(ae&&console.time("preprocess data"),se.maxZoom<0||se.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(se.promoteId&&se.generateId)throw new Error("promoteId and generateId cannot be used together.");var tt,Oe,Ct,bt,Qe,Lt,je=function(tt,Oe){var Ct=[];if("FeatureCollection"===tt.type)for(var bt=0;bt<tt.features.length;bt++)un(Ct,tt.features[bt],Oe,bt);else un(Ct,"Feature"===tt.type?tt:{geometry:tt},Oe);return Ct}(Ge,se);this.tiles={},this.tileCoords=[],ae&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",se.indexMaxZoom,se.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),bt=tt=je,Qe=ye(tt,1,-1-(Ct=(Oe=se).buffer/Oe.extent),Ct,0,-1,2,Oe),Lt=ye(tt,1,1-Ct,2+Ct,0,-1,2,Oe),(Qe||Lt)&&(bt=ye(tt,1,-Ct,1+Ct,0,-1,2,Oe)||[],Qe&&(bt=Gt(Qe,1).concat(bt)),Lt&&(bt=bt.concat(Gt(Lt,-1)))),(je=bt).length&&this.splitTile(je,0,0,0),ae&&(je.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function mr(Ge,se,ae){return 32*((1<<Ge)*ae+se)+Ge}function yi(Ge,se){const ae=Ge.tileID.canonical;if(!this._geoJSONIndex)return se(null,null);const je=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!je)return se(null,null);const tt=new class{constructor(Ct){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=Ct.length,this._features=Ct}feature(Ct){return new class{constructor(bt){this._feature=bt,this.extent=p.EXTENT,this.type=bt.type,this.properties=bt.tags,"id"in bt&&!isNaN(bt.id)&&(this.id=parseInt(bt.id,10))}loadGeometry(){if(1===this._feature.type){const bt=[];for(const Qe of this._feature.geometry)bt.push([new p.Point(Qe[0],Qe[1])]);return bt}{const bt=[];for(const Qe of this._feature.geometry){const Lt=[];for(const fn of Qe)Lt.push(new p.Point(fn[0],fn[1]));bt.push(Lt)}return bt}}toGeoJSON(bt,Qe,Lt){return mt.call(this,bt,Qe,Lt)}}(this._features[Ct])}}(je.features);let Oe=Kt(tt);0===Oe.byteOffset&&Oe.byteLength===Oe.buffer.byteLength||(Oe=new Uint8Array(Oe)),se(null,{vectorTile:tt,rawData:Oe.buffer})}Fr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Fr.prototype.splitTile=function(Ge,se,ae,je,tt,Oe,Ct){for(var bt=[Ge,se,ae,je],Qe=this.options,Lt=Qe.debug;bt.length;){je=bt.pop(),ae=bt.pop(),se=bt.pop(),Ge=bt.pop();var fn=1<<se,En=mr(se,ae,je),pn=this.tiles[En];if(!pn&&(Lt>1&&console.time("creation"),pn=this.tiles[En]=Sn(Ge,se,ae,je,Qe),this.tileCoords.push({z:se,x:ae,y:je}),Lt)){Lt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",se,ae,je,pn.numFeatures,pn.numPoints,pn.numSimplified),console.timeEnd("creation"));var Vr="z"+se;this.stats[Vr]=(this.stats[Vr]||0)+1,this.total++}if(pn.source=Ge,tt){if(se===Qe.maxZoom||se===tt)continue;var Kr=1<<tt-se;if(ae!==Math.floor(Oe/Kr)||je!==Math.floor(Ct/Kr))continue}else if(se===Qe.indexMaxZoom||pn.numPoints<=Qe.indexMaxPoints)continue;if(pn.source=null,0!==Ge.length){Lt>1&&console.time("clipping");var Ur,Nr,Qr,Ro,Jr,Br,_o=.5*Qe.buffer/Qe.extent,$s=.5-_o,To=.5+_o,Vi=1+_o;Ur=Nr=Qr=Ro=null,Jr=ye(Ge,fn,ae-_o,ae+To,0,pn.minX,pn.maxX,Qe),Br=ye(Ge,fn,ae+$s,ae+Vi,0,pn.minX,pn.maxX,Qe),Ge=null,Jr&&(Ur=ye(Jr,fn,je-_o,je+To,1,pn.minY,pn.maxY,Qe),Nr=ye(Jr,fn,je+$s,je+Vi,1,pn.minY,pn.maxY,Qe),Jr=null),Br&&(Qr=ye(Br,fn,je-_o,je+To,1,pn.minY,pn.maxY,Qe),Ro=ye(Br,fn,je+$s,je+Vi,1,pn.minY,pn.maxY,Qe),Br=null),Lt>1&&console.timeEnd("clipping"),bt.push(Ur||[],se+1,2*ae,2*je),bt.push(Nr||[],se+1,2*ae,2*je+1),bt.push(Qr||[],se+1,2*ae+1,2*je),bt.push(Ro||[],se+1,2*ae+1,2*je+1)}}},Fr.prototype.getTile=function(Ge,se,ae){var je=this.options,tt=je.extent,Oe=je.debug;if(Ge<0||Ge>24)return null;var Ct=1<<Ge,bt=mr(Ge,se=(se%Ct+Ct)%Ct,ae);if(this.tiles[bt])return or(this.tiles[bt],tt);Oe>1&&console.log("drilling down to z%d-%d-%d",Ge,se,ae);for(var Qe,Lt=Ge,fn=se,En=ae;!Qe&&Lt>0;)Lt--,fn=Math.floor(fn/2),En=Math.floor(En/2),Qe=this.tiles[mr(Lt,fn,En)];return Qe&&Qe.source?(Oe>1&&console.log("found parent tile z%d-%d-%d",Lt,fn,En),Oe>1&&console.time("drilling down"),this.splitTile(Qe.source,Lt,fn,En,Ge,se,ae),Oe>1&&console.timeEnd("drilling down"),this.tiles[bt]?or(this.tiles[bt],tt):null):null};class Po extends p.VectorTileWorkerSource{constructor(se,ae,je,tt,Oe){super(se,ae,je,tt,yi),Oe&&(this.loadGeoJSON=Oe)}loadData(se,ae){const je=se&&se.request,tt=je&&je.collectResourceTiming;this.loadGeoJSON(se,(Oe,Ct)=>{if(Oe||!Ct)return ae(Oe);if("object"!=typeof Ct)return ae(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));{Dt(Ct,!0);try{if(se.filter){const Qe=p.createExpression(se.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Qe.result)throw new Error(Qe.value.map(fn=>`${fn.key}: ${fn.message}`).join(", "));Ct={type:"FeatureCollection",features:Ct.features.filter(fn=>Qe.value.evaluate({zoom:0},fn))}}this._geoJSONIndex=se.cluster?new Ie(function({superclusterOptions:Qe,clusterProperties:Lt}){if(!Lt||!Qe)return Qe;const fn={},En={},pn={accumulated:null,zoom:0},Vr={properties:null},Kr=Object.keys(Lt);for(const Ur of Kr){const[Nr,Qr]=Lt[Ur],Ro=p.createExpression(Qr),Jr=p.createExpression("string"==typeof Nr?[Nr,["accumulated"],["get",Ur]]:Nr);fn[Ur]=Ro.value,En[Ur]=Jr.value}return Qe.map=Ur=>{Vr.properties=Ur;const Nr={};for(const Qr of Kr)Nr[Qr]=fn[Qr].evaluate(pn,Vr);return Nr},Qe.reduce=(Ur,Nr)=>{Vr.properties=Nr;for(const Qr of Kr)pn.accumulated=Ur[Qr],Ur[Qr]=En[Qr].evaluate(pn,Vr)},Qe}(se)).load(Ct.features):new Fr(Qe=Ct,se.geojsonVtOptions)}catch(Qe){return ae(Qe)}this.loaded={};const bt={};if(tt){const Qe=p.getPerformanceMeasurement(je);Qe&&(bt.resourceTiming={},bt.resourceTiming[se.source]=JSON.parse(JSON.stringify(Qe)))}ae(null,bt)}var Qe})}reloadTile(se,ae){const je=this.loaded;return je&&je[se.uid]?super.reloadTile(se,ae):this.loadTile(se,ae)}loadGeoJSON(se,ae){if(se.request)p.getJSON(se.request,ae);else{if("string"!=typeof se.data)return ae(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));try{return ae(null,JSON.parse(se.data))}catch{return ae(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(se,ae){try{ae(null,this._geoJSONIndex.getClusterExpansionZoom(se.clusterId))}catch(je){ae(je)}}getClusterChildren(se,ae){try{ae(null,this._geoJSONIndex.getChildren(se.clusterId))}catch(je){ae(je)}}getClusterLeaves(se,ae){try{ae(null,this._geoJSONIndex.getLeaves(se.clusterId,se.limit,se.offset))}catch(je){ae(je)}}}class bs{constructor(se){this.self=se,this.actor=new p.Actor(se,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:Po},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ae,je)=>{if(this.workerSourceTypes[ae])throw new Error(`Worker source with name "${ae}" already registered.`);this.workerSourceTypes[ae]=je},this.self.registerRTLTextPlugin=ae=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=ae.applyArabicShaping,p.plugin.processBidirectionalText=ae.processBidirectionalText,p.plugin.processStyledBidirectionalText=ae.processStyledBidirectionalText}}clearCaches(se,ae,je){delete this.layerIndexes[se],delete this.availableImages[se],delete this.workerSources[se],delete this.demWorkerSources[se],je()}checkIfReady(se,ae,je){je()}setReferrer(se,ae){this.referrer=ae}spriteLoaded(se,ae){this.isSpriteLoaded[se]=ae;for(const je in this.workerSources[se]){const tt=this.workerSources[se][je];for(const Oe in tt)tt[Oe]instanceof p.VectorTileWorkerSource&&(tt[Oe].isSpriteLoaded=ae,tt[Oe].fire(new p.Event("isSpriteLoaded")))}}setImages(se,ae,je){this.availableImages[se]=ae;for(const tt in this.workerSources[se]){const Oe=this.workerSources[se][tt];for(const Ct in Oe)Oe[Ct].availableImages=ae}je()}enableTerrain(se,ae,je){this.terrain=ae,je()}setProjection(se,ae){this.projections[se]=p.getProjection(ae)}setLayers(se,ae,je){this.getLayerIndex(se).replace(ae),je()}updateLayers(se,ae,je){this.getLayerIndex(se).update(ae.layers,ae.removedIds),je()}loadTile(se,ae,je){const tt=this.enableTerrain?p.extend({enableTerrain:this.terrain},ae):ae;tt.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,ae.type,ae.source).loadTile(tt,je)}loadDEMTile(se,ae,je){const tt=this.enableTerrain?p.extend({buildQuadTree:this.terrain},ae):ae;this.getDEMWorkerSource(se,ae.source).loadTile(tt,je)}reloadTile(se,ae,je){const tt=this.enableTerrain?p.extend({enableTerrain:this.terrain},ae):ae;tt.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,ae.type,ae.source).reloadTile(tt,je)}abortTile(se,ae,je){this.getWorkerSource(se,ae.type,ae.source).abortTile(ae,je)}removeTile(se,ae,je){this.getWorkerSource(se,ae.type,ae.source).removeTile(ae,je)}removeSource(se,ae,je){if(!this.workerSources[se]||!this.workerSources[se][ae.type]||!this.workerSources[se][ae.type][ae.source])return;const tt=this.workerSources[se][ae.type][ae.source];delete this.workerSources[se][ae.type][ae.source],void 0!==tt.removeSource?tt.removeSource(ae,je):je()}loadWorkerSource(se,ae,je){try{this.self.importScripts(ae.url),je()}catch(tt){je(tt.toString())}}syncRTLPluginState(se,ae,je){try{p.plugin.setState(ae);const tt=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=tt){this.self.importScripts(tt);const Oe=p.plugin.isParsed();je(Oe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${tt}`),Oe)}}catch(tt){je(tt.toString())}}getAvailableImages(se){let ae=this.availableImages[se];return ae||(ae=[]),ae}getLayerIndex(se){let ae=this.layerIndexes[se];return ae||(ae=this.layerIndexes[se]=new dt),ae}getWorkerSource(se,ae,je){return this.workerSources[se]||(this.workerSources[se]={}),this.workerSources[se][ae]||(this.workerSources[se][ae]={}),this.workerSources[se][ae][je]||(this.workerSources[se][ae][je]=new this.workerSourceTypes[ae]({send:(Oe,Ct,bt,Qe,Lt,fn)=>{this.actor.send(Oe,Ct,bt,se,Lt,fn)},scheduler:this.actor.scheduler},this.getLayerIndex(se),this.getAvailableImages(se),this.isSpriteLoaded[se])),this.workerSources[se][ae][je]}getDEMWorkerSource(se,ae){return this.demWorkerSources[se]||(this.demWorkerSources[se]={}),this.demWorkerSources[se][ae]||(this.demWorkerSources[se][ae]=new ft),this.demWorkerSources[se][ae]}enforceCacheSizeLimit(se,ae){p.enforceCacheSizeLimit(ae)}getWorkerPerformanceMetrics(se,ae,je){je(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new bs(self)),bs}),ze(0,function(p){function be(x,c){if(Array.isArray(x)){if(!Array.isArray(c)||x.length!==c.length)return!1;for(let g=0;g<x.length;g++)if(!be(x[g],c[g]))return!1;return!0}if("object"==typeof x&&null!==x&&null!==c){if("object"!=typeof c||Object.keys(x).length!==Object.keys(c).length)return!1;for(const g in x)if(!be(x[g],c[g]))return!1;return!0}return x===c}var Xe=dt;function dt(x){return c=x,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var C,T,A=new Blob([""],{type:"text/javascript"}),L=URL.createObjectURL(A);try{T=new Worker(L),C=!0}catch{C=!1}return T&&T.terminate(),URL.revokeObjectURL(L),C}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var C=document.createElement("canvas");C.width=C.height=1;var T=C.getContext("2d");if(!T)return!1;var A=T.getImageData(0,0,1,1);return A&&A.width===C.width}()||(void 0===ft[g=c&&c.failIfMajorPerformanceCaveat]&&(ft[g]=function(C){var T,L,F,V,A=(L=C,F=document.createElement("canvas"),(V=Object.create(dt.webGLContextAttributes)).failIfMajorPerformanceCaveat=L,F.getContext("webgl",V)||F.getContext("experimental-webgl",V));if(!A)return!1;try{T=A.createShader(A.VERTEX_SHADER)}catch{return!1}return!(!T||A.isContextLost())&&(A.shaderSource(T,"void main() {}"),A.compileShader(T),!0===A.getShaderParameter(T,A.COMPILE_STATUS))}(g)),!ft[g]||document.documentMode));var c,g}var ft={};function Et(x,c,g){const C=p.window.document.createElement(x);return void 0!==c&&(C.className=c),g&&g.appendChild(C),C}function rn(x,c,g){const C=p.window.document.createElementNS("http://www.w3.org/2000/svg",x);for(const T of Object.keys(c))C.setAttributeNS(null,T,c[T]);return g&&g.appendChild(C),C}dt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Dt=p.window.document&&p.window.document.documentElement.style,mt=Dt&&void 0!==Dt.userSelect?"userSelect":"WebkitUserSelect";let Vt;function hn(){Dt&&mt&&(Vt=Dt[mt],Dt[mt]="none")}function de(){Dt&&mt&&(Dt[mt]=Vt)}function Ne(x){x.preventDefault(),x.stopPropagation(),p.window.removeEventListener("click",Ne,!0)}function ue(){p.window.addEventListener("click",Ne,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",Ne,!0)},0)}function fe(x,c){const g=x.getBoundingClientRect();return ce(x,g,c)}function he(x,c){const g=x.getBoundingClientRect(),C=[];for(let T=0;T<c.length;T++)C.push(ce(x,g,c[T]));return C}function Fe(x){return void 0!==p.window.InstallTrigger&&2===x.button&&x.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:x.button}function ce(x,c,g){const C=x.offsetWidth===c.width?1:x.offsetWidth/c.width;return new p.Point((g.clientX-c.left)*C,(g.clientY-c.top)*C)}function ne(x,c){var g=c[0],C=c[1],T=c[2],A=c[3],L=g*A-T*C;return L?(x[0]=A*(L=1/L),x[1]=-C*L,x[2]=-T*L,x[3]=g*L,x):null}function Me(x){const{userImage:c}=x;return!!(c&&c.render&&c.render())&&(x.data.replace(new Uint8Array(c.data.buffer)),!0)}class ie extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:g,callback:C}of this.requestors)this._notify(g,C);this.requestors=[]}}hasImage(c){return!!this.getImage(c)}getImage(c){return this.images[c]}addImage(c,g){this._validate(c,g)&&(this.images[c]=g)}_validate(c,g){let C=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchX" value`))),C=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "stretchY" value`))),C=!1),this._validateContent(g.content,g)||(this.fire(new p.ErrorEvent(new Error(`Image "${c}" has invalid "content" value`))),C=!1),C}_validateStretch(c,g){if(!c)return!0;let C=0;for(const T of c){if(T[0]<C||T[1]<T[0]||g<T[1])return!1;C=T[1]}return!0}_validateContent(c,g){return!(c&&(4!==c.length||c[0]<0||g.data.width<c[0]||c[1]<0||g.data.height<c[1]||c[2]<0||g.data.width<c[2]||c[3]<0||g.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,g){g.version=this.images[c].version+1,this.images[c]=g,this.updatedImages[c]=!0}removeImage(c){const g=this.images[c];delete this.images[c],delete this.patterns[c],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c,g){let C=!0;if(!this.isLoaded())for(const T of c)this.images[T]||(C=!1);this.isLoaded()||C?this._notify(c,g):this.requestors.push({ids:c,callback:g})}_notify(c,g){const C={};for(const T of c){this.images[T]||this.fire(new p.Event("styleimagemissing",{id:T}));const A=this.images[T];A?C[T]={data:A.data.clone(),pixelRatio:A.pixelRatio,sdf:A.sdf,version:A.version,stretchX:A.stretchX,stretchY:A.stretchY,content:A.content,hasRenderCallback:!(!A.userImage||!A.userImage.render)}:p.warnOnce(`Image "${T}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,C)}getPixelSize(){const{width:c,height:g}=this.atlasImage;return{width:c,height:g}}getPattern(c){const g=this.patterns[c],C=this.getImage(c);if(!C)return null;if(g&&g.position.version===C.version)return g.position;if(g)g.position.version=C.version;else{const T={w:C.data.width+2,h:C.data.height+2,x:0,y:0},A=new p.ImagePosition(T,C);this.patterns[c]={bin:T,position:A}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const g=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(c,this.atlasImage,g.RGBA),this.atlasTexture&&this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const A in this.patterns)c.push(this.patterns[A].bin);const{w:g,h:C}=p.potpack(c),T=this.atlasImage;T.resize({width:g||1,height:C||1});for(const A in this.patterns){const{bin:L}=this.patterns[A],F=L.x+1,V=L.y+1,H=this.images[A].data,$=H.width,ee=H.height;p.RGBAImage.copy(H,T,{x:0,y:0},{x:F,y:V},{width:$,height:ee}),p.RGBAImage.copy(H,T,{x:0,y:ee-1},{x:F,y:V-1},{width:$,height:1}),p.RGBAImage.copy(H,T,{x:0,y:0},{x:F,y:V+ee},{width:$,height:1}),p.RGBAImage.copy(H,T,{x:$-1,y:0},{x:F-1,y:V},{width:1,height:ee}),p.RGBAImage.copy(H,T,{x:0,y:0},{x:F+$,y:V},{width:1,height:ee})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const g of c){if(this.callbackDispatchedThisFrame[g])continue;this.callbackDispatchedThisFrame[g]=!0;const C=this.images[g];Me(C)&&this.updateImage(g,C)}}}const rt=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(x,c){return function([g,C,T]){const A=p.degToRad(C+90),L=p.degToRad(T);return{x:g*Math.cos(A)*Math.sin(L),y:g*Math.sin(A)*Math.sin(L),z:g*Math.cos(L),azimuthal:C,polar:T}}(x.expression.evaluate(c))}interpolate(x,c,g){return{x:p.number(x.x,c.x,g),y:p.number(x.y,c.y,g),z:p.number(x.z,c.z,g),azimuthal:p.number(x.azimuthal,c.azimuthal,g),polar:p.number(x.polar,c.polar,g)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)});class Ve extends p.Evented{constructor(c){super(),this._transitionable=new p.Transitionable(rt),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,g={}){if(!this._validate(p.validateLight,c,g))for(const C in c){const T=c[C];p.endsWith(C,"-transition")?this._transitionable.setTransition(C.slice(0,-11),T):this._transitionable.setValue(C,T)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,g,C){return(!C||!1!==C.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const Ke=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)});let Te=class extends p.Evented{constructor(x,c){super(),this._transitionable=new p.Transitionable(Ke),this.set(x),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(x){for(const c in x){const g=x[c];p.endsWith(c,"-transition")?this._transitionable.setTransition(c.slice(0,-11),g):this._transitionable.setValue(c,g)}}updateTransitions(x){this._transitioning=this._transitionable.transitioned(x,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(x){this.properties=this._transitioning.possiblyEvaluate(x)}};function Kt(x,c,g,C){const T=p.smoothstep(45,65,g),[A,L]=At(x,C),F=p.length(c);let V=1-Math.min(1,Math.exp((F-A)/(L-A)*-6));return V*=V*V,V=Math.min(1,1.00747*V),V*T*x.alpha}function At(x,c){const g=.5/Math.tan(.5*c);return[x.range[0]+g,x.range[1]+g]}const we=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"high-color":new p.DataConstantProperty(p.spec.fog["high-color"]),"space-color":new p.DataConstantProperty(p.spec.fog["space-color"]),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"]),"star-intensity":new p.DataConstantProperty(p.spec.fog["star-intensity"])});class at extends p.Evented{constructor(c,g){super(),this._transitionable=new p.Transitionable(we),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=g}get state(){const c=this._transform,g="globe"===c.projection.name,C=p.globeToMercatorTransition(c.zoom),T=this.properties.get("range"),A=[.5,3];return{range:g?[p.number(A[0],T[0],C),p.number(A[1],T[1],C)]:T,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,g={}){if(!this._validate(p.validateFog,c,g)){for(const C of Object.keys(p.spec.fog))c&&void 0===c[C]&&(c[C]=p.spec.fog[C].default);for(const C in c){const T=c[C];p.endsWith(C,"-transition")?this._transitionable.setTransition(C.slice(0,-11),T):this._transitionable.setValue(C,T)}}}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const g=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.smoothstep(45,65,c))*g.a}getOpacityAtLatLng(c,g){return this._transform.projection.supportsFog?function(C,T,A){const L=p.MercatorCoordinate.fromLngLat(T),F=A.elevation?A.elevation.getAtPointOrZero(L):0,V=[L.x,L.y,F];return p.transformMat4(V,V,A.mercatorFogMatrix),Kt(C,V,A.pitch,A._fov)}(this.state,c,g):0}getFovAdjustedRange(c){return this._transform.projection.supportsFog?At(this.state,c):[0,1]}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,g,C){return(!C||!1!==C.validate)&&p.emitValidationErrors(this,c.call(p.validateStyle,p.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class Ae{constructor(c,g){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const C=this.workerPool.acquire(this.id);for(let T=0;T<C.length;T++){const A=new Ae.Actor(C[T],g,this.id);A.name=`Worker ${T}`,this.actors.push(A)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(c,g,C){p.asyncAll(this.actors,(T,A)=>{T.send(c,g,A)},C=C||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(c=>{c.remove()}),this.actors=[],this.workerPool.release(this.id)}}function it(x,c,g){return c*(p.EXTENT/(x.tileSize*Math.pow(2,g-x.tileID.overscaledZ)))}Ae.Actor=p.Actor;class pt{constructor(c,g,C,T){this.screenBounds=c,this.cameraPoint=g,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=C,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,T)}static createFromScreenPoints(c,g){let C,T;if(c instanceof p.Point||"number"==typeof c[0]){const A=p.Point.convert(c);C=[A],T=g.isPointAboveHorizon(A)}else{const A=p.Point.convert(c[0]),L=p.Point.convert(c[1]);C=[A,L],T=p.polygonizeBounds(A,L).every(F=>g.isPointAboveHorizon(F))}return new pt(C,g.getCameraPoint(),T,g)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(c){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const g=this.screenBounds[0],C=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],T=p.polygonizeBounds(g,C,0,!1);return this.cameraPoint.y>C.y&&(this.cameraPoint.x>g.x&&this.cameraPoint.x<C.x?T.splice(3,0,this.cameraPoint):this.cameraPoint.x>=C.x?T[2]=this.cameraPoint:this.cameraPoint.x<=g.x&&(T[3]=this.cameraPoint)),p.bufferConvexPolygon(T,c)}bufferedCameraGeometryGlobe(c){const g=this.screenBounds[0],C=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],T=p.polygonizeBounds(g,C,c),A=this.cameraPoint.clone();switch(3*((A.y>g.y)+(A.y>C.y))+((A.x>g.x)+(A.x>C.x))){case 0:T[0]=A,T[4]=A.clone();break;case 1:T.splice(1,0,A);break;case 2:T[1]=A;break;case 3:T.splice(4,0,A);break;case 5:T.splice(2,0,A);break;case 6:T[3]=A;break;case 7:T.splice(3,0,A);break;case 8:T[2]=A}return T}containsTile(c,g,C,T=0){const A=c.queryPadding/g._pixelsPerMercatorPixel+1,L=C?this._bufferedCameraMercator(A,g):this._bufferedScreenMercator(A,g);let F=c.tileID.wrap+(L.unwrapped?T:0);const V=L.polygon.map(Le=>p.getTilePoint(c.tileTransform,Le,F));if(!p.polygonIntersectsBox(V,0,0,p.EXTENT,p.EXTENT))return;F=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?T:0);const H=this.screenGeometryMercator.polygon.map(Le=>p.getTileVec3(c.tileTransform,Le,F)),$=H.map(Le=>new p.Point(Le[0],Le[1])),ee=g.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),ge=p.getTileVec3(c.tileTransform,ee,F),De=H.map(Le=>{const te=p.sub(Le,Le,ge);return p.normalize(te,te),new p.Ray(ge,te)}),Re=it(c,1,g.zoom)*g._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:$,tilespaceRays:De,bufferedTilespaceGeometry:V,bufferedTilespaceBounds:(Ce=p.getBounds(V),Ce.min.x=p.clamp(Ce.min.x,0,p.EXTENT),Ce.min.y=p.clamp(Ce.min.y,0,p.EXTENT),Ce.max.x=p.clamp(Ce.max.x,0,p.EXTENT),Ce.max.y=p.clamp(Ce.max.y,0,p.EXTENT),Ce),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:Re};var Ce}_bufferedScreenMercator(c,g){const C=It(c);if(this._screenRaycastCache[C])return this._screenRaycastCache[C];{let T;return T="globe"===g.projection.name?this._projectAndResample(this.bufferedScreenGeometry(c),g):{polygon:this.bufferedScreenGeometry(c).map(A=>g.pointCoordinate3D(A)),unwrapped:!0},this._screenRaycastCache[C]=T,T}}_bufferedCameraMercator(c,g){const C=It(c);if(this._cameraRaycastCache[C])return this._cameraRaycastCache[C];{let T;return T="globe"===g.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),g):{polygon:this.bufferedCameraGeometry(c).map(A=>g.pointCoordinate3D(A)),unwrapped:!0},this._cameraRaycastCache[C]=T,T}}_projectAndResample(c,g){const C=function(A,L){const F=p.multiply([],L.pixelMatrix,L.globeMatrix),V=[0,-p.GLOBE_RADIUS,0,1],H=[0,p.GLOBE_RADIUS,0,1],$=[0,0,0,1];p.transformMat4$1(V,V,F),p.transformMat4$1(H,H,F),p.transformMat4$1($,$,F);const ee=new p.Point(V[0]/V[3],V[1]/V[3]),ge=new p.Point(H[0]/H[3],H[1]/H[3]),De=p.polygonContainsPoint(A,ee)&&V[3]<$[3],Re=p.polygonContainsPoint(A,ge)&&H[3]<$[3];if(!De&&!Re)return null;const Ce=function(ct,yt,xt){for(let Bt=1;Bt<ct.length;Bt++){const Qt=Ut(yt.pointCoordinate3D(ct[Bt-1]).x),Nt=Ut(yt.pointCoordinate3D(ct[Bt]).x);if(xt<0){if(Qt<Nt)return{idx:Bt,t:-Qt/(Nt-1-Qt)}}else if(Nt<Qt)return{idx:Bt,t:(1-Qt)/(Nt+1-Qt)}}return null}(A,L,De?-1:1);if(!Ce)return null;const{idx:Le,t:te}=Ce;let Se=Le>1?Ie(A.slice(0,Le),L):[],Ue=Le<A.length?Ie(A.slice(Le),L):[];Se=Se.map(ct=>new p.Point(Ut(ct.x),ct.y)),Ue=Ue.map(ct=>new p.Point(Ut(ct.x),ct.y));const He=[...Se];0===He.length&&He.push(Ue[Ue.length-1]);const lt=p.number(He[He.length-1].y,(0===Ue.length?Se[0]:Ue[0]).y,te);let ut;return ut=De?[new p.Point(0,lt),new p.Point(0,0),new p.Point(1,0),new p.Point(1,lt)]:[new p.Point(1,lt),new p.Point(1,1),new p.Point(0,1),new p.Point(0,lt)],He.push(...ut),0===Ue.length?He.push(Se[0]):He.push(...Ue),{polygon:He.map(ct=>new p.MercatorCoordinate(ct.x,ct.y)),unwrapped:!1}}(c,g);if(C)return C;const T=function(A,L){let F=!1,V=-1/0,H=0;for(let ee=0;ee<A.length-1;ee++)A[ee].x>V&&(V=A[ee].x,H=ee);for(let ee=0;ee<A.length-1;ee++){const ge=(H+ee)%(A.length-1),De=A[ge],Re=A[ge+1];Math.abs(De.x-Re.x)>.5&&(De.x<Re.x?(De.x+=1,0===ge&&(A[A.length-1].x+=1)):(Re.x+=1,ge+1===A.length-1&&(A[0].x+=1)),F=!0)}const $=p.mercatorXfromLng(L.center.lng);return F&&$<Math.abs($-1)&&A.forEach(ee=>{ee.x-=1}),{polygon:A,unwrapped:F}}(Ie(c,g).map(A=>new p.Point(Ut(A.x),A.y)),g);return{polygon:T.polygon.map(A=>new p.MercatorCoordinate(A.x,A.y)),unwrapped:T.unwrapped}}}function Ie(x,c){return p.resample(x,g=>{const C=c.pointCoordinate3D(g);g.x=C.x,g.y=C.y},1/256)}function Ut(x){return x<0?1+x%1:x%1}function It(x){return 100*x|0}function yn(x,c,g,C,T){const A=function(L,F){if(L)return T(L);if(F){x.url&&F.tiles&&x.tiles&&delete x.tiles;const V=p.pick(p.extend(F,x),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);F.vector_layers&&(V.vectorLayers=F.vector_layers,V.vectorLayerIds=V.vectorLayers.map(H=>H.id)),V.tiles=c.canonicalizeTileset(V,x.url),T(null,V)}};return x.url?p.getJSON(c.transformRequest(c.normalizeSourceURL(x.url,null,g,C),p.ResourceType.Source),A):p.exported.frame(()=>A(null,x))}class Mt{constructor(c,g,C){this.bounds=p.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=g||0,this.maxzoom=C||24}validateBounds(c){return Array.isArray(c)&&4===c.length?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const g=Math.pow(2,c.z),C=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*g),T=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*g),A=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*g),L=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*g);return c.x>=C&&c.x<A&&c.y>=T&&c.y<L}}class $n{constructor(c,g,C){this.context=c;const T=c.gl;this.buffer=T.createBuffer(),this.dynamicDraw=!!C,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),T.bufferData(T.ELEMENT_ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||g.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const g=this.context.gl;this.context.unbindVAO(),this.bind(),g.bufferSubData(g.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Nn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Dn{constructor(c,g,C,T){this.length=g.length,this.attributes=C,this.itemSize=g.bytesPerElement,this.dynamicDraw=T,this.context=c;const A=c.gl;this.buffer=A.createBuffer(),c.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||g.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const g=this.context.gl;this.bind(),g.bufferSubData(g.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,g){for(let C=0;C<this.attributes.length;C++){const T=g.attributes[this.attributes[C].name];void 0!==T&&c.enableVertexAttribArray(T)}}setVertexAttribPointers(c,g,C){for(let T=0;T<this.attributes.length;T++){const A=this.attributes[T],L=g.attributes[A.name];void 0!==L&&c.vertexAttribPointer(L,A.components,c[Nn[A.type]],!1,this.itemSize,A.offset+this.itemSize*(C||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class gn{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class bn extends gn{getDefault(){return p.Color.transparent}set(c){const g=this.current;(c.r!==g.r||c.g!==g.g||c.b!==g.b||c.a!==g.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class un extends gn{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class Ai extends gn{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class gr extends gn{getDefault(){return[!0,!0,!0,!0]}set(c){const g=this.current;(c[0]!==g[0]||c[1]!==g[1]||c[2]!==g[2]||c[3]!==g[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class ii extends gn{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class ir extends gn{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class lr extends gn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const g=this.current;(c.func!==g.func||c.ref!==g.ref||c.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class ye extends gn{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const g=this.current;(c[0]!==g[0]||c[1]!==g[1]||c[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class Z extends gn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const g=this.gl;c?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=c,this.dirty=!1}}class Y extends gn{getDefault(){return[0,1]}set(c){const g=this.current;(c[0]!==g[0]||c[1]!==g[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class J extends gn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const g=this.gl;c?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=c,this.dirty=!1}}class xe extends gn{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class We extends gn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const g=this.gl;c?g.enable(g.BLEND):g.disable(g.BLEND),this.current=c,this.dirty=!1}}class Tt extends gn{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const g=this.current;(c[0]!==g[0]||c[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class Ht extends gn{getDefault(){return p.Color.transparent}set(c){const g=this.current;(c.r!==g.r||c.g!==g.g||c.b!==g.b||c.a!==g.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Gt extends gn{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class Ot extends gn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const g=this.gl;c?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=c,this.dirty=!1}}class or extends gn{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class _r extends gn{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}let Sn,Cr=class extends gn{getDefault(){return null}set(x){(x!==this.current||this.dirty)&&(this.gl.useProgram(x),this.current=x,this.dirty=!1)}};class kr extends gn{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class Fr extends gn{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const g=this.current;(c[0]!==g[0]||c[1]!==g[1]||c[2]!==g[2]||c[3]!==g[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class mr extends gn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class yi extends gn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Po extends gn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const g=this.gl;g.bindTexture(g.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class bs extends gn{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class Ge extends gn{getDefault(){return null}set(c){const g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class se extends gn{constructor(c){super(c),this.vao=c.extVertexArrayObject}getDefault(){return null}set(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)}}class ae extends gn{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class je extends gn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class tt extends gn{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class Oe extends gn{constructor(c,g){super(c),this.context=c,this.parent=g}getDefault(){return null}}class Ct extends Oe{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class bt extends Oe{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,this.attachment(),g.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Qe extends bt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Lt{constructor(c,g,C,T){this.context=c,this.width=g,this.height=C;const A=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new Ct(c,A),T&&(this.depthAttachment=new bt(c,A))}destroy(){const c=this.context.gl,g=this.colorAttachment.get();if(g&&c.deleteTexture(g),this.depthAttachment){const C=this.depthAttachment.get();C&&c.deleteRenderbuffer(C)}c.deleteFramebuffer(this.framebuffer)}}class fn{constructor(c,g=!1){if(this.gl=c,this.isWebGL2=g,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),g){const C=c;this.extVertexArrayObject={createVertexArrayOES:C.createVertexArray.bind(c),deleteVertexArrayOES:C.deleteVertexArray.bind(c),bindVertexArrayOES:C.bindVertexArray.bind(c)}}this.clearColor=new bn(this),this.clearDepth=new un(this),this.clearStencil=new Ai(this),this.colorMask=new gr(this),this.depthMask=new ii(this),this.stencilMask=new ir(this),this.stencilFunc=new lr(this),this.stencilOp=new ye(this),this.stencilTest=new Z(this),this.depthRange=new Y(this),this.depthTest=new J(this),this.depthFunc=new xe(this),this.blend=new We(this),this.blendFunc=new Tt(this),this.blendColor=new Ht(this),this.blendEquation=new Gt(this),this.cullFace=new Ot(this),this.cullFaceSide=new or(this),this.frontFace=new _r(this),this.program=new Cr(this),this.activeTexture=new kr(this),this.viewport=new Fr(this),this.bindFramebuffer=new mr(this),this.bindRenderbuffer=new yi(this),this.bindTexture=new Po(this),this.bindVertexBuffer=new bs(this),this.bindElementBuffer=new Ge(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new se(this),this.pixelStoreUnpack=new ae(this),this.pixelStoreUnpackPremultiplyAlpha=new je(this),this.pixelStoreUnpackFlipY=new tt(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),g||(this.extTextureHalfFloat=c.getExtension("OES_texture_half_float")),(g||this.extTextureHalfFloat&&c.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=g||c.getExtension("OES_standard_derivatives"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,g){return new $n(this,c,g)}createVertexBuffer(c,g,C){return new Dn(this,c,g,C)}createRenderbuffer(c,g,C){const T=this.gl,A=T.createRenderbuffer();return this.bindRenderbuffer.set(A),T.renderbufferStorage(T.RENDERBUFFER,c,g,C),this.bindRenderbuffer.set(null),A}createFramebuffer(c,g,C){return new Lt(this,c,g,C)}clear({color:c,depth:g,stencil:C}){const T=this.gl;let A=0;c&&(A|=T.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),void 0!==g&&(A|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(g),this.depthMask.set(!0)),void 0!==C&&(A|=T.STENCIL_BUFFER_BIT,this.clearStencil.set(C),this.stencilMask.set(255)),T.clear(A)}setCullFace(c){!1===c.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){be(c.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class En extends p.Evented{constructor(c,g,C,T){if(super(),this.id=c,this.dispatcher=C,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(g,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(T),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(c){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"}));const g=Array.isArray(this.map._language)?this.map._language.join():this.map._language,C=this.map._worldview;this._tileJSONRequest=yn(this._options,this.map._requestManager,g,C,(T,A)=>{this._tileJSONRequest=null,this._loaded=!0,T?(g&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${g}`),C&&2!==C.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${C}`),this.fire(new p.ErrorEvent(T))):A&&(p.extend(this,A),A.bounds&&(this.tileBounds=new Mt(A.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(A.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(T)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}loadTile(c,g){const C=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),T={request:this.map._requestManager.transformRequest(C,p.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(T.request.collectResourceTiming=this._collectResourceTiming,c.actor&&"expired"!==c.state)"loading"===c.state?c.reloadCallback=g:c.request=c.actor.send("reloadTile",T,A.bind(this));else if(c.actor=this._tileWorkers[C]=this._tileWorkers[C]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",T,A.bind(this),void 0,!0);else{const L=p.loadVectorTile.call({deduped:this._deduped},T,(F,V)=>{F||!V?A.call(this,F):(T.data={cacheControl:V.cacheControl,expires:V.expires,rawData:V.rawData.slice(0)},c.actor&&c.actor.send("loadTile",T,A.bind(this),void 0,!0))},!0);c.request={cancel:L}}function A(L,F){return delete c.request,c.aborted?g(null):L&&404!==L.status?g(L):(F&&F.resourceTiming&&(c.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&c.setExpiryData(F),c.loadVectorData(F,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class pn extends p.Evented{constructor(c,g,C,T){super(),this.id=c,this.dispatcher=C,this.setEventedParent(T),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},g),p.extend(this,p.pick(g,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=yn(this._options,this.map._requestManager,null,null,(g,C)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new p.ErrorEvent(g)):C&&(p.extend(this,C),C.bounds&&(this.tileBounds=new Mt(C.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(C.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),c&&c(g)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,g){const C=p.exported.devicePixelRatio>=2,T=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),C,this.tileSize);c.request=p.getImage(this.map._requestManager.transformRequest(T,p.ResourceType.Tile),(A,L,F,V)=>(delete c.request,c.aborted?(c.state="unloaded",g(null)):A?(c.state="errored",g(A)):L?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:F,expires:V}),c.setTexture(L,this.map.painter),c.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void g(null)):g(null)))}static loadTileData(c,g,C){c.setTexture(g,C)}static unloadTileData(c,g){c.texture&&g.saveTileTexture(c.texture)}abortTile(c,g){c.request&&(c.request.cancel(),delete c.request),g()}unloadTile(c,g){c.texture&&this.map.painter.saveTileTexture(c.texture),g()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Vr(x,c,g,C,T,A,L,F){const V=[x,g,T,c,C,A,1,1,1],H=[L,F,1],$=p.adjoint([],V),[ee,ge,De]=p.transformMat3(H,H,p.transpose($,$));return p.multiply$1(V,[ee,0,0,0,ge,0,0,0,De],V)}class Kr extends p.Evented{constructor(c,g,C,T){super(),this.id=c,this.dispatcher=C,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(T),this.options=g,this._dirty=!1}load(c,g){this._loaded=g||!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(C,T)=>{if(this._imageRequest=null,this._loaded=!0,C)this.fire(new p.ErrorEvent(C));else if(T){const{HTMLImageElement:A}=p.window;this.image=T instanceof A?p.exported.getImageData(T):T,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,c&&(this.coordinates=c),this._finishLoading()}})}loaded(){return this._loaded}updateImage(c){return this.image&&c.url?(this._imageRequest&&c.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=c.url,this.load(c.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(c){this.coordinates=c,this._boundsArray=void 0;const g=c.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(C){let T=1/0,A=1/0,L=-1/0,F=-1/0;for(const ee of C)T=Math.min(T,ee.x),A=Math.min(A,ee.y),L=Math.max(L,ee.x),F=Math.max(F,ee.y);const V=Math.max(L-T,F-A),H=Math.max(0,Math.floor(-Math.log(V)/Math.LN2)),$=Math.pow(2,H);return new p.CanonicalTileID(H,Math.floor((T+L)/2*$),Math.floor((A+F)/2*$))}(g),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(c){for(const V in this.tiles){const H=this.tiles[V];"loaded"!==H.state&&(H.state="loaded",H.texture=this.texture)}if(this._boundsArray)return;const g=p.tileTransform(this.tileID,this.map.transform.projection),[C,T,A,L]=this.coordinates.map(V=>{const H=g.projection.project(V[0],V[1]);return p.getTilePoint(g,H)._round()});this.perspectiveTransform=function(V,H,$,ee,ge,De,Re,Ce,Le,te){const Se=Vr(0,0,V,0,0,H,V,H),Ue=Vr($,ee,ge,De,Re,Ce,Le,te);return p.multiply$1(Ue,p.adjoint(Se,Se),Ue),[Ue[6]/Ue[8]*V/p.EXTENT,Ue[7]/Ue[8]*H/p.EXTENT]}(this.width,this.height,C.x,C.y,T.x,T.y,L.x,L.y,A.x,A.y);const F=this._boundsArray=new p.StructArrayLayout4i8;F.emplaceBack(C.x,C.y,0,0),F.emplaceBack(T.x,T.y,p.EXTENT,0),F.emplaceBack(L.x,L.y,0,p.EXTENT),F.emplaceBack(A.x,A.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=c.createVertexBuffer(F,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const c=this.map.painter.context,g=c.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new p.Texture(c,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(c)}loadTile(c,g){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},g(null)):(c.state="errored",g(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ur={vector:En,raster:pn,"raster-dem":class extends pn{constructor(x,c,g,C){super(x,c,g,C),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(x,c){const g=this.map._requestManager.normalizeTileURL(x.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function C(T,A){T&&(x.state="errored",c(T)),A&&(x.dem=A,x.dem.onDeserialize(),x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0,x.state="loaded",c(null))}x.request=p.getImage(this.map._requestManager.transformRequest(g,p.ResourceType.Tile),function(T,A,L,F){if(delete x.request,x.aborted)x.state="unloaded",c(null);else if(T)x.state="errored",c(T);else if(A){this.map._refreshExpiredTiles&&x.setExpiryData({cacheControl:L,expires:F});const V=p.window.ImageBitmap&&A instanceof p.window.ImageBitmap&&(null==Sn&&(Sn=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),Sn),H=1-(A.width-p.prevPowerOfTwo(A.width))/2;H<1||x.neighboringTiles||(x.neighboringTiles=this._getNeighboringTiles(x.tileID));const $=V?A:p.exported.getImageData(A,H),ee={uid:x.uid,coord:x.tileID,source:this.id,rawImageData:$,encoding:this.encoding,padding:H};x.actor&&"expired"!==x.state||(x.actor=this.dispatcher.getActor(),x.actor.send("loadDEMTile",ee,C.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(x){const c=x.canonical,g=Math.pow(2,c.z),C=(c.x-1+g)%g,T=0===c.x?x.wrap-1:x.wrap,A=(c.x+1+g)%g,L=c.x+1===g?x.wrap+1:x.wrap,F={};return F[new p.OverscaledTileID(x.overscaledZ,T,c.z,C,c.y).key]={backfilled:!1},F[new p.OverscaledTileID(x.overscaledZ,L,c.z,A,c.y).key]={backfilled:!1},c.y>0&&(F[new p.OverscaledTileID(x.overscaledZ,T,c.z,C,c.y-1).key]={backfilled:!1},F[new p.OverscaledTileID(x.overscaledZ,x.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},F[new p.OverscaledTileID(x.overscaledZ,L,c.z,A,c.y-1).key]={backfilled:!1}),c.y+1<g&&(F[new p.OverscaledTileID(x.overscaledZ,T,c.z,C,c.y+1).key]={backfilled:!1},F[new p.OverscaledTileID(x.overscaledZ,x.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},F[new p.OverscaledTileID(x.overscaledZ,L,c.z,A,c.y+1).key]={backfilled:!1}),F}unloadTile(x){x.demTexture&&this.map.painter.saveTileTexture(x.demTexture),x.fbo&&(x.fbo.destroy(),delete x.fbo),x.dem&&delete x.dem,delete x.neighboringTiles,x.state="unloaded"}},geojson:class extends p.Evented{constructor(x,c,g,C){super(),this.id=x,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=g.getActor(),this.setEventedParent(C),this._data=c.data,this._options=p.extend({},c),this._collectResourceTiming=c.collectResourceTiming,void 0!==c.maxzoom&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const T=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(void 0!==c.buffer?c.buffer:128)*T,tolerance:(void 0!==c.tolerance?c.tolerance:.375)*T,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:void 0!==c.clusterMaxZoom?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==c.clusterRadius?c.clusterRadius:50)*T,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(x){this.map=x,this.setData(this._data)}setData(x){return this._data=x,this._updateWorkerData(),this}getClusterExpansionZoom(x,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:x,source:this.id},c),this}getClusterChildren(x,c){return this.actor.send("geojson.getClusterChildren",{clusterId:x,source:this.id},c),this}getClusterLeaves(x,c,g,C){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:x,limit:c,offset:g},C),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const x=p.extend({},this.workerOptions),c=this._data;"string"==typeof c?(x.request=this.map._requestManager.transformRequest(p.exported.resolveURL(c),p.ResourceType.Source),x.request.collectResourceTiming=this._collectResourceTiming):x.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,x,(g,C)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new p.ErrorEvent(g));else{const T={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&C&&C.resourceTiming&&C.resourceTiming[this.id]&&(T.resourceTiming=C.resourceTiming[this.id]),this.fire(new p.Event("data",T)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(x,c){const g=x.actor?"reloadTile":"loadTile";x.actor=this.actor,x.request=this.actor.send(g,{type:this.type,uid:x.uid,tileID:x.tileID,tileZoom:x.tileZoom,zoom:x.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(C,T)=>(delete x.request,x.unloadVectorData(),x.aborted?c(null):C?c(C):(x.loadVectorData(T,this.map.painter,"reloadTile"===g),c(null))),void 0,"loadTile"===g)}abortTile(x){x.request&&(x.request.cancel(),delete x.request),x.aborted=!0}unloadTile(x){x.unloadVectorData(),this.actor.send("removeTile",{uid:x.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Kr{constructor(x,c,g,C){super(x,c,g,C),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const x=this.options;this.urls=[];for(const c of x.urls)this.urls.push(this.map._requestManager.transformRequest(c,p.ResourceType.Source).url);p.getVideo(this.urls,(c,g)=>{this._loaded=!0,c?this.fire(new p.ErrorEvent(c)):g&&(this.video=g,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(x){if(this.video){const c=this.video.seekable;x<c.start(0)||x>c.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=x}}getVideo(){return this.video}onAdd(x){this.map||(this.map=x,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const x=this.map.painter.context,c=x.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(x,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(x)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Kr,canvas:class extends Kr{constructor(x,c,g,C){super(x,c,g,C),c.coordinates?Array.isArray(c.coordinates)&&4===c.coordinates.length&&!c.coordinates.some(T=>!Array.isArray(T)||2!==T.length||T.some(A=>"number"!=typeof A))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${x}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${x}`,null,'missing required property "coordinates"'))),c.animate&&"boolean"!=typeof c.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${x}`,null,'optional "animate" property must be a boolean value'))),c.canvas?"string"==typeof c.canvas||c.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${x}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${x}`,null,'missing required property "canvas"'))),this.options=c,this.animate=void 0===c.animate||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(x){this.map=x,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let x=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,x=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,x=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const c=this.map.painter.context;this.texture?(x||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const x of[this.canvas.width,this.canvas.height])if(isNaN(x)||x<=0)return!0;return!1}},custom:class extends p.Evented{constructor(x,c,g,C){super(),this.id=x,this.type="custom",this._dataType="raster",this._dispatcher=g,this._implementation=c,this.setEventedParent(C),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Mt(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(x){this._map=x,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(x),this.load()}onRemove(x){this._implementation.onRemove&&this._implementation.onRemove(x)}hasTile(x){if(this._implementation.hasTile){const{x:c,y:g,z:C}=x.canonical;return this._implementation.hasTile({x:c,y:g,z:C})}return!this.tileBounds||this.tileBounds.contains(x.canonical)}loadTile(x,c){const{x:g,y:C,z:T}=x.tileID.canonical,A=new p.window.AbortController;x.request=Promise.resolve(this._implementation.loadTile({x:g,y:C,z:T},{signal:A.signal})).then(function(L){return delete x.request,x.aborted?(x.state="unloaded",c(null)):void 0===L?(x.state="errored",c(null)):null===L?(this.loadTileData(x,{width:this.tileSize,height:this.tileSize,data:null}),x.state="loaded",c(null)):(F=L)instanceof p.window.ImageData||F instanceof p.window.HTMLCanvasElement||F instanceof p.window.ImageBitmap||F instanceof p.window.HTMLImageElement?(this.loadTileData(x,L),x.state="loaded",void c(null)):(x.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var F}.bind(this)).catch(L=>{20!==L.code&&(x.state="errored",c(L))}),x.request.cancel=()=>A.abort()}loadTileData(x,c){pn.loadTileData(x,c,this._map.painter)}unloadTileData(x){pn.unloadTileData(x,this._map.painter)}unloadTile(x,c){if(this.unloadTileData(x),this._implementation.unloadTile){const{x:g,y:C,z:T}=x.tileID.canonical;this._implementation.unloadTile({x:g,y:C,z:T})}c()}abortTile(x,c){x.request&&x.request.cancel&&(x.request.cancel(),delete x.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(x=>({x:x.canonical.x,y:x.canonical.y,z:x.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Nr=function(x,c,g,C){const T=new Ur[c.type](x,c,g,C);if(T.id!==x)throw new Error(`Expected Source id to be ${x} instead of ${T.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],T),T};function Qr(x,c){const g=p.identity([]);return p.scale(g,g,[.5*x.width,.5*-x.height,1]),p.translate(g,g,[1,-1,0]),p.multiply(g,g,x.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(g)}function Ro(x,c,g,C,T,A,L,F=!1){const V=x.tilesIn(C,L,F);V.sort(Br);const H=[];for(const ee of V)H.push({wrappedTileID:ee.tile.tileID.wrapped().key,queryResults:ee.tile.queryRenderedFeatures(c,g,x._state,ee,T,A,Qr(x.transform,ee.tile.tileID),F)});const $=function(ee){const ge={},De={};for(const Re of ee){const Ce=Re.queryResults,Le=Re.wrappedTileID,te=De[Le]=De[Le]||{};for(const Se in Ce){const Ue=Ce[Se],He=te[Se]=te[Se]||{},lt=ge[Se]=ge[Se]||[];for(const ut of Ue)He[ut.featureIndex]||(He[ut.featureIndex]=!0,lt.push(ut))}}return ge}(H);for(const ee in $)$[ee].forEach(ge=>{const De=ge.feature,Re=De.layer;Re&&"background"!==Re.type&&"sky"!==Re.type&&(De.source=Re.source,Re["source-layer"]&&(De.sourceLayer=Re["source-layer"]),De.state=void 0!==De.id?x.getFeatureState(Re["source-layer"],De.id):{})});return $}function Jr(x,c){const g=x.getRenderableIds().map(A=>x.getTileByID(A)),C=[],T={};for(let A=0;A<g.length;A++){const L=g[A],F=L.tileID.canonical.key;T[F]||(T[F]=!0,L.querySourceFeatures(C,c))}return C}function Br(x,c){const g=x.tileID,C=c.tileID;return g.overscaledZ-C.overscaledZ||g.canonical.y-C.canonical.y||g.wrap-C.wrap||g.canonical.x-C.canonical.x}function _o(){return null!=Th.workerClass?new Th.workerClass:new p.window.Worker(Th.workerUrl)}const $s="mapboxgl_preloaded_worker_pool";class To{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<To.workerCount;)this.workers.push(new _o);return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],0===this.numActive()&&(this.workers.forEach(g=>{g.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[$s]}numActive(){return Object.keys(this.active).length}}let Vi;function Bl(){return Vi||(Vi=new To),Vi}function Cl(x,c){const g={};for(const C in x)"ref"!==C&&(g[C]=x[C]);return p.refProperties.forEach(C=>{C in c&&(g[C]=c[C])}),g}function zl(x){x=x.slice();const c=Object.create(null);for(let g=0;g<x.length;g++)c[x[g].id]=x[g];for(let g=0;g<x.length;g++)"ref"in x[g]&&(x[g]=Cl(x[g],c[x[g].ref]));return x}To.workerCount=2;const Hr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ps(x,c,g){g.push({command:Hr.addSource,args:[x,c[x]]})}function Fi(x,c,g){c.push({command:Hr.removeSource,args:[x]}),g[x]=!0}function vi(x,c,g,C){Fi(x,g,C),Ps(x,c,g)}function Jc(x,c,g){let C;for(C in x[g])if(x[g].hasOwnProperty(C)&&"data"!==C&&!be(x[g][C],c[g][C]))return!1;for(C in c[g])if(c[g].hasOwnProperty(C)&&"data"!==C&&!be(x[g][C],c[g][C]))return!1;return!0}function ps(x,c,g,C,T,A){let L;for(L in c=c||{},x=x||{})x.hasOwnProperty(L)&&(be(x[L],c[L])||g.push({command:A,args:[C,L,c[L],T]}));for(L in c)c.hasOwnProperty(L)&&!x.hasOwnProperty(L)&&(be(x[L],c[L])||g.push({command:A,args:[C,L,c[L],T]}))}function Na(x){return x.id}function qo(x,c){return x[c.id]=c,x}class Tu{constructor(c,g){this.reset(c,g)}reset(c,g){this.points=c||[],this._distances=[0];for(let C=1;C<this.points.length;C++)this._distances[C]=this._distances[C-1]+this.points[C].dist(this.points[C-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(g||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(1===this.points.length)return this.points[0];c=p.clamp(c,0,1);let g=1,C=this._distances[g];const T=c*this.paddedLength+this.padding;for(;C<T&&g<this._distances.length;)C=this._distances[++g];const A=g-1,L=this._distances[A],F=C-L,V=F>0?(T-L)/F:0;return this.points[A].mult(1-V).add(this.points[g].mult(V))}}class Hs{constructor(c,g,C){const T=this.boxCells=[],A=this.circleCells=[];this.xCellCount=Math.ceil(c/C),this.yCellCount=Math.ceil(g/C);for(let L=0;L<this.xCellCount*this.yCellCount;L++)T.push([]),A.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=g,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/g,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,g,C,T,A){this._forEachCell(g,C,T,A,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(g),this.bboxes.push(C),this.bboxes.push(T),this.bboxes.push(A)}insertCircle(c,g,C,T){this._forEachCell(g-T,C-T,g+T,C+T,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(g),this.circles.push(C),this.circles.push(T)}_insertBoxCell(c,g,C,T,A,L){this.boxCells[A].push(L)}_insertCircleCell(c,g,C,T,A,L){this.circleCells[A].push(L)}_query(c,g,C,T,A,L){if(C<0||c>this.width||T<0||g>this.height)return!A&&[];const F=[];if(c<=0&&g<=0&&this.width<=C&&this.height<=T){if(A)return!0;for(let V=0;V<this.boxKeys.length;V++)F.push({key:this.boxKeys[V],x1:this.bboxes[4*V],y1:this.bboxes[4*V+1],x2:this.bboxes[4*V+2],y2:this.bboxes[4*V+3]});for(let V=0;V<this.circleKeys.length;V++){const H=this.circles[3*V],$=this.circles[3*V+1],ee=this.circles[3*V+2];F.push({key:this.circleKeys[V],x1:H-ee,y1:$-ee,x2:H+ee,y2:$+ee})}return L?F.filter(L):F}return this._forEachCell(c,g,C,T,this._queryCell,F,{hitTest:A,seenUids:{box:{},circle:{}}},L),A?F.length>0:F}_queryCircle(c,g,C,T,A){const L=c-C,F=c+C,V=g-C,H=g+C;if(F<0||L>this.width||H<0||V>this.height)return!T&&[];const $=[];return this._forEachCell(L,V,F,H,this._queryCellCircle,$,{hitTest:T,circle:{x:c,y:g,radius:C},seenUids:{box:{},circle:{}}},A),T?$.length>0:$}query(c,g,C,T,A){return this._query(c,g,C,T,!1,A)}hitTest(c,g,C,T,A){return this._query(c,g,C,T,!0,A)}hitTestCircle(c,g,C,T){return this._queryCircle(c,g,C,!0,T)}_queryCell(c,g,C,T,A,L,F,V){const H=F.seenUids,$=this.boxCells[A];if(null!==$){const ge=this.bboxes;for(const De of $)if(!H.box[De]){H.box[De]=!0;const Re=4*De;if(c<=ge[Re+2]&&g<=ge[Re+3]&&C>=ge[Re+0]&&T>=ge[Re+1]&&(!V||V(this.boxKeys[De]))){if(F.hitTest)return L.push(!0),!0;L.push({key:this.boxKeys[De],x1:ge[Re],y1:ge[Re+1],x2:ge[Re+2],y2:ge[Re+3]})}}}const ee=this.circleCells[A];if(null!==ee){const ge=this.circles;for(const De of ee)if(!H.circle[De]){H.circle[De]=!0;const Re=3*De;if(this._circleAndRectCollide(ge[Re],ge[Re+1],ge[Re+2],c,g,C,T)&&(!V||V(this.circleKeys[De]))){if(F.hitTest)return L.push(!0),!0;{const Ce=ge[Re],Le=ge[Re+1],te=ge[Re+2];L.push({key:this.circleKeys[De],x1:Ce-te,y1:Le-te,x2:Ce+te,y2:Le+te})}}}}}_queryCellCircle(c,g,C,T,A,L,F,V){const H=F.circle,$=F.seenUids,ee=this.boxCells[A];if(null!==ee){const De=this.bboxes;for(const Re of ee)if(!$.box[Re]){$.box[Re]=!0;const Ce=4*Re;if(this._circleAndRectCollide(H.x,H.y,H.radius,De[Ce+0],De[Ce+1],De[Ce+2],De[Ce+3])&&(!V||V(this.boxKeys[Re])))return L.push(!0),!0}}const ge=this.circleCells[A];if(null!==ge){const De=this.circles;for(const Re of ge)if(!$.circle[Re]){$.circle[Re]=!0;const Ce=3*Re;if(this._circlesCollide(De[Ce],De[Ce+1],De[Ce+2],H.x,H.y,H.radius)&&(!V||V(this.circleKeys[Re])))return L.push(!0),!0}}}_forEachCell(c,g,C,T,A,L,F,V){const H=this._convertToXCellCoord(c),$=this._convertToYCellCoord(g),ee=this._convertToXCellCoord(C),ge=this._convertToYCellCoord(T);for(let De=H;De<=ee;De++)for(let Re=$;Re<=ge;Re++)if(A.call(this,c,g,C,T,this.xCellCount*Re+De,L,F,V))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,g,C,T,A,L){const F=T-c,V=A-g,H=C+L;return H*H>F*F+V*V}_circleAndRectCollide(c,g,C,T,A,L,F){const V=(L-T)/2,H=Math.abs(c-(T+V));if(H>V+C)return!1;const $=(F-A)/2,ee=Math.abs(g-(A+$));if(ee>$+C)return!1;if(H<=V||ee<=$)return!0;const ge=H-V,De=ee-$;return ge*ge+De*De<=C*C}}const da={unknown:0,flipRequired:1,flipNotRequired:2},fa=Math.tan(85*Math.PI/180);function Wt(x,c,g,C,T,A,L){const F=p.create();if(g)if("globe"===A.name){const V=p.calculateGlobeLabelMatrix(T,c);p.multiply(F,F,V)}else{const V=ne([],L);F[0]=V[0],F[1]=V[1],F[4]=V[2],F[5]=V[3],C||p.rotateZ(F,F,T.angle)}else p.multiply(F,T.labelPlaneMatrix,x);return F}function Vl(x,c,g,C,T,A,L){const F=Wt(x,c,g,C,T,A,L);return"globe"===A.name&&g||(F[2]=F[6]=F[10]=F[14]=0),F}function gs(x,c,g,C,T,A,L){if(g){if("globe"===A.name){const F=Wt(x,c,g,C,T,A,L);return p.invert(F,F),p.multiply(F,x,F),F}{const F=p.clone(x),V=p.identity([]);return V[0]=L[0],V[1]=L[1],V[4]=L[2],V[5]=L[3],p.multiply(F,F,V),C||p.rotateZ(F,F,-T.angle),F}}return T.glCoordMatrix}function Bs(x,c,g,C){const T=[x,c,g,1];g?p.transformMat4$1(T,T,C):ei(T,T,C);const A=T[3];return T[0]/=A,T[1]/=A,T[2]/=A,T}function ts(x,c){return Math.min(.5+x/c*.5,1.5)}function uu(x,c){const g=x[0]/x[3],C=x[1]/x[3];return g>=-c[0]&&g<=c[0]&&C>=-c[1]&&C<=c[1]}function Ul(x,c,g,C,T,A,L,F,V,H){const $=g.transform,ee=C?x.textSizeData:x.iconSizeData,ge=p.evaluateSizeForZoom(ee,g.transform.zoom),De="globe"===$.projection.name,Re=[256/g.width*2+1,256/g.height*2+1],Ce=C?x.text.dynamicLayoutVertexArray:x.icon.dynamicLayoutVertexArray;Ce.clear();let Le=null;De&&(Le=C?x.text.globeExtVertexArray:x.icon.globeExtVertexArray);const te=x.lineVertexArray,Se=C?x.text.placedSymbolArray:x.icon.placedSymbolArray,Ue=g.transform.width/g.transform.height;let He,lt=!1;for(let ut=0;ut<Se.length;ut++){const ct=Se.get(ut),{numGlyphs:yt,writingMode:xt}=ct;if(xt!==p.WritingMode.vertical||lt||He===p.WritingMode.horizontal||(lt=!0),He=xt,(ct.hidden||xt===p.WritingMode.vertical)&&!lt){ur(yt,Ce);continue}lt=!1;const Bt=new p.Point(ct.tileAnchorX,ct.tileAnchorY);let{x:Qt,y:Nt,z:Jt}=$.projection.projectTilePoint(Bt.x,Bt.y,H.canonical);if(V){const[br,Hn,vr]=V(Bt);Qt+=br,Nt+=Hn,Jt+=vr}const Pt=[Qt,Nt,Jt,1];if(p.transformMat4$1(Pt,Pt,c),!uu(Pt,Re)){ur(yt,Ce);continue}const mn=ts(g.transform.cameraToCenterDistance,Pt[3]),Ft=p.evaluateSizeForFeature(ee,ge,ct),Yt=L?Ft/mn:Ft*mn,an=Bs(Qt,Nt,Jt,T);if(an[3]<=0){ur(yt,Ce);continue}let ln={};const xn=L?null:V,cr=on(ct,Yt,!1,F,c,T,A,x.glyphOffsetArray,te,Ce,Le,an,Bt,ln,Ue,xn,$.projection,H,L);lt=cr.useVertical,xn&&cr.needsFlipping&&(ln={}),(cr.notEnoughRoom||lt||cr.needsFlipping&&on(ct,Yt,!0,F,c,T,A,x.glyphOffsetArray,te,Ce,Le,an,Bt,ln,Ue,xn,$.projection,H,L).notEnoughRoom)&&ur(yt,Ce)}C?(x.text.dynamicLayoutVertexBuffer.updateData(Ce),Le&&x.text.globeExtVertexBuffer.updateData(Le)):(x.icon.dynamicLayoutVertexBuffer.updateData(Ce),Le&&x.icon.globeExtVertexBuffer.updateData(Le))}function Ld(x,c,g,C,T,A,L,F,V,H,$,ee,ge,De,Re,Ce){const{lineStartIndex:Le,glyphStartIndex:te,segment:Se}=F,Ue=te+F.numGlyphs,He=Le+F.lineLength,lt=c.getoffsetX(te),ut=c.getoffsetX(Ue-1),ct=$a(x*lt,g,C,T,A,L,Se,Le,He,V,H,$,ee,ge,!0,De,Re,Ce);if(!ct)return null;const yt=$a(x*ut,g,C,T,A,L,Se,Le,He,V,H,$,ee,ge,!0,De,Re,Ce);return yt?{first:ct,last:yt}:null}function ws(x,c,g,C){return x===p.WritingMode.horizontal&&Math.abs(C)>Math.abs(g)?{useVertical:!0}:x===p.WritingMode.vertical?C>0?{needsFlipping:!0}:null:c!==da.unknown&&(0===(T=g)||Math.abs(C/T)>fa)?c===da.flipRequired?{needsFlipping:!0}:null:g<0?{needsFlipping:!0}:null;var T}function on(x,c,g,C,T,A,L,F,V,H,$,ee,ge,De,Re,Ce,Le,te,Se){const Ue=c/24,He=x.lineOffsetX*Ue,lt=x.lineOffsetY*Ue,{lineStartIndex:ut,glyphStartIndex:ct,numGlyphs:yt,segment:xt,writingMode:Bt,flipState:Qt}=x,Nt=ut+x.lineLength,Jt=Pt=>{if($){const[an,ln,xn]=Pt.up,cr=H.length;p.updateGlobeVertexNormal($,cr+0,an,ln,xn),p.updateGlobeVertexNormal($,cr+1,an,ln,xn),p.updateGlobeVertexNormal($,cr+2,an,ln,xn),p.updateGlobeVertexNormal($,cr+3,an,ln,xn)}const[mn,Ft,Yt]=Pt.point;p.addDynamicAttributes(H,mn,Ft,Yt,Pt.angle)};if(yt>1){const Pt=Ld(Ue,F,He,lt,g,ee,ge,x,V,A,De,Ce,!1,Le,te,Se);if(!Pt)return{notEnoughRoom:!0};if(C&&!g){let[mn,Ft,Yt]=Pt.first.point,[an,ln,xn]=Pt.last.point;[mn,Ft]=Bs(mn,Ft,Yt,L),[an,ln]=Bs(an,ln,xn,L);const cr=ws(Bt,Qt,(an-mn)*Re,ln-Ft);if(x.flipState=cr&&cr.needsFlipping?da.flipRequired:da.flipNotRequired,cr)return cr}Jt(Pt.first);for(let mn=ct+1;mn<ct+yt-1;mn++){const Ft=$a(Ue*F.getoffsetX(mn),He,lt,g,ee,ge,xt,ut,Nt,V,A,De,Ce,!1,!1,Le,te,Se);if(!Ft)return H.length-=4*(mn-ct),{notEnoughRoom:!0};Jt(Ft)}Jt(Pt.last)}else{if(C&&!g){const mn=Bs(ge.x,ge.y,0,T),Ft=ut+xt+1,Yt=new p.Point(V.getx(Ft),V.gety(Ft)),an=Bs(Yt.x,Yt.y,0,T),ln=an[3]>0?an:Mr(ge,Yt,mn,1,T,void 0,Le,te.canonical),xn=ws(Bt,Qt,(ln[0]-mn[0])*Re,ln[1]-mn[1]);if(x.flipState=xn&&xn.needsFlipping?da.flipRequired:da.flipNotRequired,xn)return xn}const Pt=$a(Ue*F.getoffsetX(ct),He,lt,g,ee,ge,xt,ut,Nt,V,A,De,Ce,!1,!1,Le,te,Se);if(!Pt)return{notEnoughRoom:!0};Jt(Pt)}return{}}function Rn(x,c,g,C,T){const{x:A,y:L,z:F}=C.projectTilePoint(x.x,x.y,c);if(!T)return Bs(A,L,F,g);const[V,H,$]=T(x);return Bs(A+V,L+H,F+$,g)}function Mr(x,c,g,C,T,A,L,F){const V=Rn(x.sub(c)._unit()._add(x),F,T,L,A);return p.sub(V,g,V),p.normalize(V,V),p.scaleAndAdd(V,g,V,C)}function $a(x,c,g,C,T,A,L,F,V,H,$,ee,ge,De,Re,Ce,Le,te){const Se=C?x-c:x+c;let Ue=Se>0?1:-1,He=0;C&&(Ue*=-1,He=Math.PI),Ue<0&&(He+=Math.PI);let lt=F+L+(Ue>0?0:1)|0,ut=T,ct=T,yt=0,xt=0;const Bt=Math.abs(Se),Qt=[],Nt=[];let Jt=A,Pt=Jt;const mn=()=>Mr(Pt,Jt,ct,Bt-yt+1,$,ge,Ce,Le.canonical);for(;yt+xt<=Bt;){if(lt+=Ue,lt<F||lt>=V)return null;if(ct=ut,Pt=Jt,Qt.push(ct),De&&Nt.push(Pt),Jt=new p.Point(H.getx(lt),H.gety(lt)),ut=ee[lt],!ut){const vr=Rn(Jt,Le.canonical,$,Ce,ge);ut=vr[3]>0?ee[lt]=vr:mn()}yt+=xt,xt=p.distance(ct,ut)}Re&&ge&&(ee[lt]&&(ut=mn(),xt=p.distance(ct,ut)),ee[lt]=ut);const Ft=(Bt-yt)/xt,Yt=Jt.sub(Pt)._mult(Ft)._add(Pt),an=p.sub([],ut,ct),ln=p.scaleAndAdd([],ct,an,Ft);let xn=[0,0,1],cr=an[0],br=an[1];if(te&&(xn=Ce.upVector(Le.canonical,Yt.x,Yt.y),0!==xn[0]||0!==xn[1]||1!==xn[2])){const vr=[xn[2],0,-xn[0]],ci=p.cross([],xn,vr);p.normalize(vr,vr),p.normalize(ci,ci),cr=p.dot(an,vr),br=p.dot(an,ci)}if(g){const vr=p.cross([],xn,an);p.normalize(vr,vr),p.scaleAndAdd(ln,ln,vr,g*Ue)}const Hn=He+Math.atan2(br,cr);return Qt.push(ln),De&&Nt.push(Yt),{point:ln,angle:Hn,path:Qt,tilePath:Nt,up:xn}}function ur(x,c){const g=c.length,C=g+4*x;c.resize(C),c.float32.fill(-1/0,4*g,4*C)}function ei(x,c,g){const C=c[0],T=c[1];return x[0]=g[0]*C+g[4]*T+g[12],x[1]=g[1]*C+g[5]*T+g[13],x[3]=g[3]*C+g[7]*T+g[15],x}const jl=100;class Ni{constructor(c,g,C=new Hs(c.width+200,c.height+200,25),T=new Hs(c.width+200,c.height+200,25)){this.transform=c,this.grid=C,this.ignoredGrid=T,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+jl,this.screenBottomBoundary=c.height+jl,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=g}placeCollisionBox(c,g,C,T,A,L,F,V){let H=C.projectedAnchorX,$=C.projectedAnchorY,ee=C.projectedAnchorZ;const ge=C.elevation,De=C.tileID,Re=c.getProjection();if(ge&&De){const[ut,ct,yt]=Re.upVector(De.canonical,C.tileAnchorX,C.tileAnchorY),xt=Re.upVectorScale(De.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;H+=ut*ge*xt,$+=ct*ge*xt,ee+=yt*ge*xt}const Ce=this.projectAndGetPerspectiveRatio(F,H,$,ee,C.tileID,"globe"===Re.name||!!ge||this.transform.pitch>0,Re),Le=L*Ce.perspectiveRatio,te=(C.x1*g+T.x-C.padding)*Le+Ce.point.x,Se=(C.y1*g+T.y-C.padding)*Le+Ce.point.y,Ue=(C.x2*g+T.x+C.padding)*Le+Ce.point.x,He=(C.y2*g+T.y+C.padding)*Le+Ce.point.y,lt=Ce.perspectiveRatio<=.55||Ce.occluded;return!this.isInsideGrid(te,Se,Ue,He)||!A&&this.grid.hitTest(te,Se,Ue,He,V)||lt?{box:[],offscreen:!1,occluded:Ce.occluded}:{box:[te,Se,Ue,He],offscreen:this.isOffscreen(te,Se,Ue,He),occluded:!1}}placeCollisionCircles(c,g,C,T,A,L,F,V,H,$,ee,ge,De,Re,Ce){const Le=[],te=this.transform.elevation,Se=c.getProjection(),Ue=te?te.getAtTileOffsetFunc(Ce,this.transform.center.lat,this.transform.worldSize,Se):null,He=new p.Point(C.tileAnchorX,C.tileAnchorY);let{x:lt,y:ut,z:ct}=Se.projectTilePoint(He.x,He.y,Ce.canonical);if(Ue){const[Yt,an,ln]=Ue(He);lt+=Yt,ut+=an,ct+=ln}const yt="globe"===Se.name,xt=this.projectAndGetPerspectiveRatio(F,lt,ut,ct,Ce,yt||!!te||this.transform.pitch>0,Se),{perspectiveRatio:Bt}=xt,Qt=(ee?L/Bt:L*Bt)/p.ONE_EM,Nt=Bs(lt,ut,ct,V),Jt=xt.signedDistanceFromCamera>0?Ld(Qt,A,C.lineOffsetX*Qt,C.lineOffsetY*Qt,!1,Nt,He,C,T,V,{},te&&!ee?Ue:null,ee&&!!te,Se,Ce,ee):null;let Pt=!1,mn=!1,Ft=!0;if(Jt&&!xt.occluded){const Yt=.5*De*Bt+Re,an=new p.Point(-100,-100),ln=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),xn=new Tu,{first:cr,last:br}=Jt,Hn=cr.path.length;let vr=[];for(let nr=Hn-1;nr>=1;nr--)vr.push(cr.path[nr]);for(let nr=1;nr<br.path.length;nr++)vr.push(br.path[nr]);const ci=2.5*Yt;H&&(vr=vr.map(([nr,So,qn],Lo)=>(Ue&&!yt&&(qn=Ue(Lo<Hn-1?cr.tilePath[Hn-1-Lo]:br.tilePath[Lo-Hn+2])[2]),Bs(nr,So,qn,H))),vr.some(nr=>nr[3]<=0)&&(vr=[]));let li=[];if(vr.length>0){let nr=1/0,So=-1/0,qn=1/0,Lo=-1/0;for(const Xo of vr)nr=Math.min(nr,Xo[0]),qn=Math.min(qn,Xo[1]),So=Math.max(So,Xo[0]),Lo=Math.max(Lo,Xo[1]);So>=an.x&&nr<=ln.x&&Lo>=an.y&&qn<=ln.y&&(li=[vr.map(Xo=>new p.Point(Xo[0],Xo[1]))],(nr<an.x||So>ln.x||qn<an.y||Lo>ln.y)&&(li=p.clipLine(li,an.x,an.y,ln.x,ln.y)))}for(const nr of li){xn.reset(nr,.25*Yt);let So=0;So=xn.length<=.5*Yt?1:Math.ceil(xn.paddedLength/ci)+1;for(let qn=0;qn<So;qn++){const Lo=qn/Math.max(So-1,1),Xo=xn.lerp(Lo),Nl=Xo.x+jl,al=Xo.y+jl;Le.push(Nl,al,Yt,0);const Wu=Nl-Yt,pc=al-Yt,ko=Nl+Yt,$o=al+Yt;if(Ft=Ft&&this.isOffscreen(Wu,pc,ko,$o),mn=mn||this.isInsideGrid(Wu,pc,ko,$o),!g&&this.grid.hitTestCircle(Nl,al,Yt,ge)&&(Pt=!0,!$))return{circles:[],offscreen:!1,collisionDetected:Pt,occluded:!1}}}}return{circles:!$&&Pt||!mn?[]:Le,offscreen:Ft,collisionDetected:Pt,occluded:xt.occluded}}queryRenderedSymbols(c){if(0===c.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const g=[];let C=1/0,T=1/0,A=-1/0,L=-1/0;for(const $ of c){const ee=new p.Point($.x+jl,$.y+jl);C=Math.min(C,ee.x),T=Math.min(T,ee.y),A=Math.max(A,ee.x),L=Math.max(L,ee.y),g.push(ee)}const F=this.grid.query(C,T,A,L).concat(this.ignoredGrid.query(C,T,A,L)),V={},H={};for(const $ of F){const ee=$.key;if(void 0===V[ee.bucketInstanceId]&&(V[ee.bucketInstanceId]={}),V[ee.bucketInstanceId][ee.featureIndex])continue;const ge=[new p.Point($.x1,$.y1),new p.Point($.x2,$.y1),new p.Point($.x2,$.y2),new p.Point($.x1,$.y2)];p.polygonIntersectsPolygon(g,ge)&&(V[ee.bucketInstanceId][ee.featureIndex]=!0,void 0===H[ee.bucketInstanceId]&&(H[ee.bucketInstanceId]=[]),H[ee.bucketInstanceId].push(ee.featureIndex))}return H}insertCollisionBox(c,g,C,T,A){(g?this.ignoredGrid:this.grid).insert({bucketInstanceId:C,featureIndex:T,collisionGroupID:A},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,g,C,T,A){const L=g?this.ignoredGrid:this.grid,F={bucketInstanceId:C,featureIndex:T,collisionGroupID:A};for(let V=0;V<c.length;V+=4)L.insertCircle(F,c[V],c[V+1],c[V+2])}projectAndGetPerspectiveRatio(c,g,C,T,A,L,F){const V=[g,C,T,1];let H=!1;T||this.transform.pitch>0?(p.transformMat4$1(V,V,c),this.fogState&&A&&"globe"!==F.name&&(H=function(ge,De,Re,Ce,Le,te){const Se=te.calculateFogTileMatrix(Le),Ue=[De,Re,Ce];return p.transformMat4(Ue,Ue,Se),Kt(ge,Ue,te.pitch,te._fov)}(this.fogState,g,C,T,A.toUnwrapped(),this.transform)>.9)):ei(V,V,c);const $=V[3];return{point:new p.Point((V[0]/$+1)/2*this.transform.width+jl,(-V[1]/$+1)/2*this.transform.height+jl),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(F)/$*.5,1.5),signedDistanceFromCamera:$,occluded:L&&V[2]>$||H}}isOffscreen(c,g,C,T){return C<jl||c>=this.screenRightBoundary||T<jl||g>this.screenBottomBoundary}isInsideGrid(c,g,C,T){return C>=0&&c<this.gridRightBoundary&&T>=0&&g<this.gridBottomBoundary}getViewportMatrix(){const c=p.identity([]);return p.translate(c,c,[-100,-100,0]),c}}function qs(x,c,g){const C=c.createTileMatrix(x,x.worldSize,g.toUnwrapped());return p.multiply(new Float32Array(16),x.projMatrix,C)}function xi(x,c,g){if(c.projection.name===g.projection.name)return x.projMatrix;const C=g.clone();return C.setProjection(c.projection),qs(C,c.getProjection(),x)}function Io(x,c,g){return c.name===g.projection.name?x.projMatrix:qs(g,c,x)}class mf{constructor(c,g,C,T){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?g:-g))):T&&C?1:0,this.placed=C}isHidden(){return 0===this.opacity&&!this.placed}}class $t{constructor(c,g,C,T,A,L=!1){this.text=new mf(c?c.text:null,g,C,A),this.icon=new mf(c?c.icon:null,g,T,A),this.clipped=L}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Rr{constructor(c,g,C,T=!1){this.text=c,this.icon=g,this.skipFade=C,this.clipped=T}}class Pa{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class Sl{constructor(c,g,C,T,A){this.bucketInstanceId=c,this.featureIndex=g,this.sourceLayerIndex=C,this.bucketIndex=T,this.tileID=A}}class kd{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const g=++this.maxGroupID;this.collisionGroups[c]={ID:g,predicate:C=>C.collisionGroupID===g}}return this.collisionGroups[c]}}function Rs(x,c,g,C,T){const{horizontalAlign:A,verticalAlign:L}=p.getAnchorAlignment(x),F=-(A-.5)*c,V=-(L-.5)*g,H=p.evaluateVariableOffset(x,C);return new p.Point(F+H[0]*T,V+H[1]*T)}function en(x,c,g,C,T){const A=new p.Point(x,c);return g&&A._rotate(C?T:-T),A}class di{constructor(c,g,C,T,A){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new Ni(this.transform,A),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new kd(C),this.collisionCircleArrays={},this.prevPlacement=T,T&&(T.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,g,C,T){const A=C.getBucket(g),L=C.latestFeatureIndex;if(!A||!L||g.id!==A.layerIds[0])return;const F=A.layers[0].layout,V=C.collisionBoxArray,H=Math.pow(2,this.transform.zoom-C.tileID.overscaledZ),$=C.tileSize/p.EXTENT,ee=C.tileID.toUnwrapped();this.transform.setProjection(A.projection);const ge=(De=C.tileID,Re=A.getProjection(),Ce=this.transform,Re.name===this.projection?Ce.calculateProjMatrix(De.toUnwrapped()):qs(Ce,Re,De));var De,Re,Ce;const Le="map"===F.get("text-pitch-alignment"),te="map"===F.get("text-rotation-alignment");g.compileFilter();const Se=g.dynamicFilter(),Ue=g.dynamicFilterNeedsFeature(),He=this.transform.calculatePixelsToTileUnitsMatrix(C),lt=Vl(ge,C.tileID.canonical,Le,te,this.transform,A.getProjection(),He);let ut=null;if(Le){const xt=gs(ge,C.tileID.canonical,Le,te,this.transform,A.getProjection(),He);ut=p.multiply([],this.transform.labelPlaneMatrix,xt)}let ct=null;Se&&C.latestFeatureIndex&&(ct={unwrappedTileID:ee,dynamicFilter:Se,dynamicFilterNeedsFeature:Ue,featureIndex:C.latestFeatureIndex}),this.retainedQueryData[A.bucketInstanceId]=new Sl(A.bucketInstanceId,L,A.sourceLayerIndex,A.index,C.tileID);const yt={bucket:A,layout:F,posMatrix:ge,textLabelPlaneMatrix:lt,labelToScreenMatrix:ut,clippingData:ct,scale:H,textPixelRatio:$,holdingForFade:C.holdingForFade(),collisionBoxArray:V,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(A.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(A.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(A.sourceID)};if(T)for(const xt of A.sortKeyRanges){const{sortKey:Bt,symbolInstanceStart:Qt,symbolInstanceEnd:Nt}=xt;c.push({sortKey:Bt,symbolInstanceStart:Qt,symbolInstanceEnd:Nt,parameters:yt})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:yt})}attemptAnchorPlacement(c,g,C,T,A,L,F,V,H,$,ee,ge,De,Re,Ce,Le,te,Se){const{textOffset0:Ue,textOffset1:He,crossTileID:lt}=ge,ut=[Ue,He],ct=Rs(c,C,T,ut,A),yt=this.collisionIndex.placeCollisionBox(Re,A,g,en(ct.x,ct.y,L,F,this.transform.angle),ee,V,H,$.predicate);if(Le){const xt=Re.getSymbolInstanceIconSize(Se,this.transform.zoom,ge.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(Re,xt,Le,en(ct.x,ct.y,L,F,this.transform.angle),ee,V,H,$.predicate).box.length)return}if(yt.box.length>0){let xt;return this.prevPlacement&&this.prevPlacement.variableOffsets[lt]&&this.prevPlacement.placements[lt]&&this.prevPlacement.placements[lt].text&&(xt=this.prevPlacement.variableOffsets[lt].anchor),this.variableOffsets[lt]={textOffset:ut,width:C,height:T,anchor:c,textScale:A,prevAnchor:xt},this.markUsedJustification(Re,c,ge,Ce),Re.allowVerticalPlacement&&(this.markUsedOrientation(Re,Ce,ge),this.placedOrientations[lt]=Ce),{shift:ct,placedGlyphBoxes:yt}}}placeLayerBucketPart(c,g,C,T){const{bucket:A,layout:L,posMatrix:F,textLabelPlaneMatrix:V,labelToScreenMatrix:H,clippingData:$,textPixelRatio:ee,holdingForFade:ge,collisionBoxArray:De,partiallyEvaluatedTextSize:Re,partiallyEvaluatedIconSize:Ce,collisionGroup:Le}=c.parameters,te=L.get("text-optional"),Se=L.get("icon-optional"),Ue=L.get("text-allow-overlap"),He=L.get("icon-allow-overlap"),lt="map"===L.get("text-rotation-alignment"),ut="map"===L.get("text-pitch-alignment"),ct="none"!==L.get("icon-text-fit"),yt="viewport-y"===L.get("symbol-z-order");this.transform.setProjection(A.projection);let xt=Ue&&(He||!A.hasIconData()||Se),Bt=He&&(Ue||!A.hasTextData()||te);!A.collisionArrays&&De&&A.deserializeCollisionBoxes(De),C&&T&&A.updateCollisionDebugBuffers(this.transform.zoom,De);const Qt=(Nt,Jt,Pt)=>{const{crossTileID:mn,numVerticalGlyphVertices:Ft}=Nt;if($){const ko={zoom:this.transform.zoom,pitch:this.transform.pitch};let $o=null;if($.dynamicFilterNeedsFeature){const ji=this.retainedQueryData[A.bucketInstanceId];$o=$.featureIndex.loadFeature({featureIndex:Nt.featureIndex,bucketIndex:ji.bucketIndex,sourceLayerIndex:ji.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,$.dynamicFilter)(ko,$o,this.retainedQueryData[A.bucketInstanceId].tileID.canonical,new p.Point(Nt.tileAnchorX,Nt.tileAnchorY),this.transform.calculateDistanceTileData($.unwrappedTileID)))return this.placements[mn]=new Rr(!1,!1,!1,!0),void g.add(mn)}if(g.has(mn))return;if(ge)return void(this.placements[mn]=new Rr(!1,!1,!1));let Yt=!1,an=!1,ln=!0,xn=!1,cr=!1,br=null,Hn={box:null,offscreen:null,occluded:null},vr={box:null,offscreen:null,occluded:null},ci=null,li=null,nr=null,So=0,qn=0,Lo=0;Pt.textFeatureIndex?So=Pt.textFeatureIndex:Nt.useRuntimeCollisionCircles&&(So=Nt.featureIndex),Pt.verticalTextFeatureIndex&&(qn=Pt.verticalTextFeatureIndex);const Xo=ko=>{ko.tileID=this.retainedQueryData[A.bucketInstanceId].tileID;const $o=this.transform.elevation;($o||ko.elevation)&&(ko.elevation=$o?$o.getAtTileOffset(ko.tileID,ko.tileAnchorX,ko.tileAnchorY):0)},Nl=Pt.textBox;if(Nl){Xo(Nl);const ko=ji=>{let Ca=p.WritingMode.horizontal;if(A.allowVerticalPlacement&&!ji&&this.prevPlacement){const Jl=this.prevPlacement.placedOrientations[mn];Jl&&(this.placedOrientations[mn]=Jl,Ca=Jl,this.markUsedOrientation(A,Ca,Nt))}return Ca},$o=(ji,Ca)=>{if(A.allowVerticalPlacement&&Ft>0&&Pt.verticalTextBox){for(const Jl of A.writingModes)if(Jl===p.WritingMode.vertical?(Hn=Ca(),vr=Hn):Hn=ji(),Hn&&Hn.box&&Hn.box.length)break}else Hn=ji()};if(L.get("text-variable-anchor")){let ji=L.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[mn]){const ys=this.prevPlacement.variableOffsets[mn];ji.indexOf(ys.anchor)>0&&(ji=ji.filter(cn=>cn!==ys.anchor),ji.unshift(ys.anchor))}const Ca=(ys,cn,Li)=>{const ll=A.getSymbolInstanceTextSize(Re,Nt,this.transform.zoom,Jt),Pl=(ys.x2-ys.x1)*ll+2*ys.padding,ks=(ys.y2-ys.y1)*ll+2*ys.padding,rh=ct&&!He?cn:null;rh&&Xo(rh);let gc={box:[],offscreen:!1,occluded:!1};const Ru=Ue?2*ji.length:ji.length;for(let nd=0;nd<Ru;++nd){const vf=this.attemptAnchorPlacement(ji[nd%ji.length],ys,Pl,ks,ll,lt,ut,ee,F,Le,nd>=ji.length,Nt,Jt,A,Li,rh,Re,Ce);if(vf&&(gc=vf.placedGlyphBoxes,gc&&gc.box&&gc.box.length)){Yt=!0,br=vf.shift;break}}return gc};$o(()=>Ca(Nl,Pt.iconBox,p.WritingMode.horizontal),()=>{const ys=Pt.verticalTextBox;return ys&&Xo(ys),A.allowVerticalPlacement&&!(Hn&&Hn.box&&Hn.box.length)&&Ft>0&&ys?Ca(ys,Pt.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Hn&&(Yt=Hn.box,ln=Hn.offscreen,xn=Hn.occluded);const Jl=ko(!(!Hn||!Hn.box));if(!Yt&&this.prevPlacement){const ys=this.prevPlacement.variableOffsets[mn];ys&&(this.variableOffsets[mn]=ys,this.markUsedJustification(A,ys.anchor,Nt,Jl))}}else{const ji=(Ca,Jl)=>{const ys=A.getSymbolInstanceTextSize(Re,Nt,this.transform.zoom,Jt),cn=this.collisionIndex.placeCollisionBox(A,ys,Ca,new p.Point(0,0),Ue,ee,F,Le.predicate);return cn&&cn.box&&cn.box.length&&(this.markUsedOrientation(A,Jl,Nt),this.placedOrientations[mn]=Jl),cn};$o(()=>ji(Nl,p.WritingMode.horizontal),()=>{const Ca=Pt.verticalTextBox;return A.allowVerticalPlacement&&Ft>0&&Ca?(Xo(Ca),ji(Ca,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),ko(!!(Hn&&Hn.box&&Hn.box.length))}}if(ci=Hn,Yt=ci&&ci.box&&ci.box.length>0,ln=ci&&ci.offscreen,xn=ci&&ci.occluded,Nt.useRuntimeCollisionCircles){const ko=A.text.placedSymbolArray.get(Nt.centerJustifiedTextSymbolIndex>=0?Nt.centerJustifiedTextSymbolIndex:Nt.verticalPlacedTextSymbolIndex),$o=p.evaluateSizeForFeature(A.textSizeData,Re,ko),ji=L.get("text-padding");li=this.collisionIndex.placeCollisionCircles(A,Ue,ko,A.lineVertexArray,A.glyphOffsetArray,$o,F,V,H,C,ut,Le.predicate,Nt.collisionCircleDiameter*$o/p.ONE_EM,ji,this.retainedQueryData[A.bucketInstanceId].tileID),Yt=Ue||li.circles.length>0&&!li.collisionDetected,ln=ln&&li.offscreen,xn=li.occluded}if(Pt.iconFeatureIndex&&(Lo=Pt.iconFeatureIndex),Pt.iconBox){const ko=$o=>{Xo($o);const ji=ct&&br?en(br.x,br.y,lt,ut,this.transform.angle):new p.Point(0,0),Ca=A.getSymbolInstanceIconSize(Ce,this.transform.zoom,Nt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(A,Ca,$o,ji,He,ee,F,Le.predicate)};vr&&vr.box&&vr.box.length&&Pt.verticalIconBox?(nr=ko(Pt.verticalIconBox),an=nr.box.length>0):(nr=ko(Pt.iconBox),an=nr.box.length>0),ln=ln&&nr.offscreen,cr=nr.occluded}const al=te||0===Nt.numHorizontalGlyphVertices&&0===Ft,Wu=Se||0===Nt.numIconVertices;if(al||Wu?Wu?al||(an=an&&Yt):Yt=an&&Yt:an=Yt=an&&Yt,Yt&&ci&&ci.box&&this.collisionIndex.insertCollisionBox(ci.box,L.get("text-ignore-placement"),A.bucketInstanceId,vr&&vr.box&&qn?qn:So,Le.ID),an&&nr&&this.collisionIndex.insertCollisionBox(nr.box,L.get("icon-ignore-placement"),A.bucketInstanceId,Lo,Le.ID),li&&(Yt&&this.collisionIndex.insertCollisionCircles(li.circles,L.get("text-ignore-placement"),A.bucketInstanceId,So,Le.ID),C)){const ko=A.bucketInstanceId;let $o=this.collisionCircleArrays[ko];void 0===$o&&($o=this.collisionCircleArrays[ko]=new Pa);for(let ji=0;ji<li.circles.length;ji+=4)$o.circles.push(li.circles[ji+0]),$o.circles.push(li.circles[ji+1]),$o.circles.push(li.circles[ji+2]),$o.circles.push(li.collisionDetected?1:0)}const pc="globe"!==A.projection.name;xt=xt&&(pc||!xn),Bt=Bt&&(pc||!cr),this.placements[mn]=new Rr(Yt||xt,an||Bt,ln||A.justReloaded),g.add(mn)};if(yt){const Nt=A.getSortedSymbolIndexes(this.transform.angle);for(let Jt=Nt.length-1;Jt>=0;--Jt){const Pt=Nt[Jt];Qt(A.symbolInstances.get(Pt),Pt,A.collisionArrays[Pt])}}else for(let Nt=c.symbolInstanceStart;Nt<c.symbolInstanceEnd;Nt++)Qt(A.symbolInstances.get(Nt),Nt,A.collisionArrays[Nt]);if(C&&A.bucketInstanceId in this.collisionCircleArrays){const Nt=this.collisionCircleArrays[A.bucketInstanceId];p.invert(Nt.invProjMatrix,F),Nt.viewportMatrix=this.collisionIndex.getViewportMatrix()}A.justReloaded=!1}markUsedJustification(c,g,C,T){const{leftJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:L,rightJustifiedTextSymbolIndex:F,verticalPlacedTextSymbolIndex:V,crossTileID:H}=C,$=p.getAnchorJustification(g),ee=T===p.WritingMode.vertical?V:"left"===$?A:"center"===$?L:"right"===$?F:-1;A>=0&&(c.text.placedSymbolArray.get(A).crossTileID=ee>=0&&A!==ee?0:H),L>=0&&(c.text.placedSymbolArray.get(L).crossTileID=ee>=0&&L!==ee?0:H),F>=0&&(c.text.placedSymbolArray.get(F).crossTileID=ee>=0&&F!==ee?0:H),V>=0&&(c.text.placedSymbolArray.get(V).crossTileID=ee>=0&&V!==ee?0:H)}markUsedOrientation(c,g,C){const T=g===p.WritingMode.horizontal||g===p.WritingMode.horizontalOnly?g:0,A=g===p.WritingMode.vertical?g:0,{leftJustifiedTextSymbolIndex:L,centerJustifiedTextSymbolIndex:F,rightJustifiedTextSymbolIndex:V,verticalPlacedTextSymbolIndex:H}=C,$=c.text.placedSymbolArray;L>=0&&($.get(L).placedOrientation=T),F>=0&&($.get(F).placedOrientation=T),V>=0&&($.get(V).placedOrientation=T),H>=0&&($.get(H).placedOrientation=A)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const g=this.prevPlacement;let C=!1;this.prevZoomAdjustment=g?g.zoomAdjustment(this.transform.zoom):0;const T=g?g.symbolFadeChange(c):1,A=g?g.opacities:{},L=g?g.variableOffsets:{},F=g?g.placedOrientations:{};for(const V in this.placements){const H=this.placements[V],$=A[V];$?(this.opacities[V]=new $t($,T,H.text,H.icon,null,H.clipped),C=C||H.text!==$.text.placed||H.icon!==$.icon.placed):(this.opacities[V]=new $t(null,T,H.text,H.icon,H.skipFade,H.clipped),C=C||H.text||H.icon)}for(const V in A){const H=A[V];if(!this.opacities[V]){const $=new $t(H,T,!1,!1);$.isHidden()||(this.opacities[V]=$,C=C||H.text.placed||H.icon.placed)}}for(const V in L)this.variableOffsets[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.variableOffsets[V]=L[V]);for(const V in F)this.placedOrientations[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.placedOrientations[V]=F[V]);C?this.lastPlacementChangeTime=c:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=g?g.lastPlacementChangeTime:c)}updateLayerOpacities(c,g){const C=new Set;for(const T of g){const A=T.getBucket(c);A&&T.latestFeatureIndex&&c.id===A.layerIds[0]&&this.updateBucketOpacities(A,C,T.collisionBoxArray)}}updateBucketOpacities(c,g,C){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const T=c.layers[0].layout,A=!!c.layers[0].dynamicFilter(),L=new $t(null,0,!1,!1,!0),F=T.get("text-allow-overlap"),V=T.get("icon-allow-overlap"),H=T.get("text-variable-anchor"),$="map"===T.get("text-rotation-alignment"),ee="map"===T.get("text-pitch-alignment"),ge="none"!==T.get("icon-text-fit"),De=new $t(null,0,F&&(V||!c.hasIconData()||T.get("icon-optional")),V&&(F||!c.hasTextData()||T.get("text-optional")),!0);!c.collisionArrays&&C&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(C);const Re=(Le,te,Se)=>{for(let Ue=0;Ue<te/4;Ue++)Le.opacityVertexArray.emplaceBack(Se)};let Ce=0;for(let Le=0;Le<c.symbolInstances.length;Le++){const te=c.symbolInstances.get(Le),{numHorizontalGlyphVertices:Se,numVerticalGlyphVertices:Ue,crossTileID:He,numIconVertices:lt}=te,ut=g.has(He);let ct=this.opacities[He];ut?ct=L:ct||(ct=De,this.opacities[He]=ct),g.add(He);const yt=Se>0||Ue>0,xt=lt>0,Bt=this.placedOrientations[He],Qt=Bt===p.WritingMode.vertical,Nt=Bt===p.WritingMode.horizontal||Bt===p.WritingMode.horizontalOnly;if(!yt&&!xt||ct.isHidden()||Ce++,yt){const Jt=Os(ct.text);Re(c.text,Se,Qt?Es:Jt),Re(c.text,Ue,Nt?Es:Jt);const Pt=ct.text.isHidden(),{leftJustifiedTextSymbolIndex:mn,centerJustifiedTextSymbolIndex:Ft,rightJustifiedTextSymbolIndex:Yt,verticalPlacedTextSymbolIndex:an}=te,ln=c.text.placedSymbolArray,xn=Pt||Qt?1:0;mn>=0&&(ln.get(mn).hidden=xn),Ft>=0&&(ln.get(Ft).hidden=xn),Yt>=0&&(ln.get(Yt).hidden=xn),an>=0&&(ln.get(an).hidden=Pt||Nt?1:0);const cr=this.variableOffsets[He];cr&&this.markUsedJustification(c,cr.anchor,te,Bt);const br=this.placedOrientations[He];br&&(this.markUsedJustification(c,"left",te,br),this.markUsedOrientation(c,br,te))}if(xt){const Jt=Os(ct.icon),{placedIconSymbolIndex:Pt,verticalPlacedIconSymbolIndex:mn}=te,Ft=c.icon.placedSymbolArray,Yt=ct.icon.isHidden()?1:0;Pt>=0&&(Re(c.icon,lt,Qt?Es:Jt),Ft.get(Pt).hidden=Yt),mn>=0&&(Re(c.icon,te.numVerticalIconVertices,Nt?Es:Jt),Ft.get(mn).hidden=Yt)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const Jt=c.collisionArrays[Le];if(Jt){let Pt=new p.Point(0,0),mn=!0;if(Jt.textBox||Jt.verticalTextBox){if(H){const Yt=this.variableOffsets[He];Yt?(Pt=Rs(Yt.anchor,Yt.width,Yt.height,Yt.textOffset,Yt.textScale),$&&Pt._rotate(ee?this.transform.angle:-this.transform.angle)):mn=!1}A&&(mn=!ct.clipped),Jt.textBox&&Yn(c.textCollisionBox.collisionVertexArray,ct.text.placed,!mn||Qt,Pt.x,Pt.y),Jt.verticalTextBox&&Yn(c.textCollisionBox.collisionVertexArray,ct.text.placed,!mn||Nt,Pt.x,Pt.y)}const Ft=mn&&!(Nt||!Jt.verticalIconBox);Jt.iconBox&&Yn(c.iconCollisionBox.collisionVertexArray,ct.icon.placed,Ft,ge?Pt.x:0,ge?Pt.y:0),Jt.verticalIconBox&&Yn(c.iconCollisionBox.collisionVertexArray,ct.icon.placed,!Ft,ge?Pt.x:0,ge?Pt.y:0)}}}if(c.fullyClipped=0===Ce,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const Le=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=Le.invProjMatrix,c.placementViewportMatrix=Le.viewportMatrix,c.collisionCircleArray=Le.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return 0===this.fadeDuration?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,g){const C=this.zoomAtLastRecencyCheck===g?1-this.zoomAdjustment(g):1;return this.zoomAtLastRecencyCheck=g,this.commitTime+this.fadeDuration*C>c}setStale(){this.stale=!0}}function Yn(x,c,g,C,T){x.emplaceBack(c?1:0,g?1:0,C||0,T||0),x.emplaceBack(c?1:0,g?1:0,C||0,T||0),x.emplaceBack(c?1:0,g?1:0,C||0,T||0),x.emplaceBack(c?1:0,g?1:0,C||0,T||0)}const si=Math.pow(2,25),zs=Math.pow(2,24),el=Math.pow(2,17),Eh=Math.pow(2,16),zo=Math.pow(2,9),Sr=Math.pow(2,8),Kh=Math.pow(2,1);function Os(x){if(0===x.opacity&&!x.placed)return 0;if(1===x.opacity&&x.placed)return 4294967295;const c=x.placed?1:0,g=Math.floor(127*x.opacity);return g*si+c*zs+g*el+c*Eh+g*zo+c*Sr+g*Kh+c}const Es=0;class tl{constructor(c){this._sortAcrossTiles="viewport-y"!==c.layout.get("symbol-z-order")&&void 0!==c.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(c,g,C,T,A){const L=this._bucketParts;for(;this._currentTileIndex<c.length;)if(g.getBucketParts(L,T,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,A())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,L.sort((F,V)=>F.sortKey-V.sortKey));this._currentPartIndex<L.length;){const F=L[this._currentPartIndex];if(g.placeLayerBucketPart(F,this._seenCrossTileIDs,C,0===F.symbolInstanceStart),this._currentPartIndex++,A())return!0}return!1}}class Vo{constructor(c,g,C,T,A,L,F,V){this.placement=new di(c,A,L,F,V),this._currentPlacementIndex=g.length-1,this._forceFullPlacement=C,this._showCollisionBoxes=T,this._done=!1}isDone(){return this._done}continuePlacement(c,g,C){const T=p.exported.now(),A=()=>{const L=p.exported.now()-T;return!this._forceFullPlacement&&L>2};for(;this._currentPlacementIndex>=0;){const L=g[c[this._currentPlacementIndex]],F=this.placement.collisionIndex.transform.zoom;if("symbol"===L.type&&(!L.minzoom||L.minzoom<=F)&&(!L.maxzoom||L.maxzoom>F)){if(this._inProgressLayer||(this._inProgressLayer=new tl(L)),this._inProgressLayer.continuePlacement(C[L.source],this.placement,this._showCollisionBoxes,L,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const Ws=512/p.EXTENT/2;class Zs{constructor(c,g,C){this.tileID=c,this.bucketInstanceId=C,this.index=new p.KDBush(g.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const T=c.canonical.x*p.EXTENT,A=c.canonical.y*p.EXTENT;for(let L=0;L<g.length;L++){const{key:F,crossTileID:V,tileAnchorX:H,tileAnchorY:$}=g.get(L),ee=Math.floor((T+H)*Ws),ge=Math.floor((A+$)*Ws);this.index.add(ee,ge),this.keys.push(F),this.crossTileIDs.push(V)}this.index.finish()}findMatches(c,g,C){const T=this.tileID.canonical.z<g.canonical.z?1:Math.pow(2,this.tileID.canonical.z-g.canonical.z),A=Ws/Math.pow(2,g.canonical.z-this.tileID.canonical.z),L=g.canonical.x*p.EXTENT,F=g.canonical.y*p.EXTENT;for(let V=0;V<c.length;V++){const H=c.get(V);if(H.crossTileID)continue;const{key:$,tileAnchorX:ee,tileAnchorY:ge}=H,De=Math.floor((L+ee)*A),Re=Math.floor((F+ge)*A),Ce=this.index.range(De-T,Re-T,De+T,Re+T);for(const Le of Ce){const te=this.crossTileIDs[Le];if(this.keys[Le]===$&&!C.has(te)){C.add(te),H.crossTileID=te;break}}}}}class Dl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class cu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const g=Math.round((c-this.lng)/360);if(0!==g)for(const C in this.indexes){const T=this.indexes[C],A={};for(const L in T){const F=T[L];F.tileID=F.tileID.unwrapTo(F.tileID.wrap+g),A[F.tileID.key]=F}this.indexes[C]=A}this.lng=c}addBucket(c,g,C){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===g.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let A=0;A<g.symbolInstances.length;A++)g.symbolInstances.get(A).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]=new Set);const T=this.usedCrossTileIDs[c.overscaledZ];for(const A in this.indexes){const L=this.indexes[A];if(Number(A)>c.overscaledZ)for(const F in L){const V=L[F];V.tileID.isChildOf(c)&&V.findMatches(g.symbolInstances,c,T)}else{const F=L[c.scaledTo(Number(A)).key];F&&F.findMatches(g.symbolInstances,c,T)}}for(let A=0;A<g.symbolInstances.length;A++){const L=g.symbolInstances.get(A);L.crossTileID||(L.crossTileID=C.generate(),T.add(L.crossTileID))}return void 0===this.indexes[c.overscaledZ]&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Zs(c,g.symbolInstances,g.bucketInstanceId),!0}removeBucketCrossTileIDs(c,g){for(const C of g.crossTileIDs)this.usedCrossTileIDs[c].delete(C)}removeStaleBuckets(c){let g=!1;for(const C in this.indexes){const T=this.indexes[C];for(const A in T)c[T[A].bucketInstanceId]||(this.removeBucketCrossTileIDs(C,T[A]),delete T[A],g=!0)}return g}}class nl{constructor(){this.layerIndexes={},this.crossTileIDs=new Dl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,g,C,T){let A=this.layerIndexes[c.id];void 0===A&&(A=this.layerIndexes[c.id]=new cu);let L=!1;const F={};"globe"!==T.name&&A.handleWrapJump(C);for(const V of g){const H=V.getBucket(c);H&&c.id===H.layerIds[0]&&(H.bucketInstanceId||(H.bucketInstanceId=++this.maxBucketInstanceId),A.addBucket(V.tileID,H,this.crossTileIDs)&&(L=!0),F[H.bucketInstanceId]=!0)}return A.removeStaleBuckets(F)&&(L=!0),L}pruneUnusedLayers(c){const g={};c.forEach(C=>{g[C]=!0});for(const C in this.layerIndexes)g[C]||delete this.layerIndexes[C]}}const Tl=(x,c)=>p.emitValidationErrors(x,c&&c.filter(g=>"source.canvas"!==g.identifier)),ms=p.pick(Hr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Gl=p.pick(Hr,["setCenter","setZoom","setBearing","setPitch"]),ti={version:8,layers:[],sources:{}},Uo={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Oo extends p.Evented{constructor(c,g={}){super(),this.map=c,this.dispatcher=new Ae(Bl(),this),this.imageManager=new ie,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(c._requestManager,g.localFontFamily?p.LocalGlyphMode.all:g.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,g.localFontFamily||g.localIdeographFontFamily),this.crossTileSymbolIndex=new nl,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const C=this;this._rtlTextPluginCallback=Oo.registerForPluginStateChange(T=>{C.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},(A,L)=>{if(p.triggerPluginCompletionEvent(A),L&&L.every(F=>F))for(const F in C._sourceCaches){const V=C._sourceCaches[F],H=V.getSource().type;"vector"!==H&&"geojson"!==H||V.reload()}})}),this.on("data",T=>{if("source"!==T.dataType||"metadata"!==T.sourceDataType)return;const A=this.getSource(T.sourceId);if(A&&A.vectorLayerIds)for(const L in this._layers){const F=this._layers[L];F.source===A.id&&this._validateLayer(F)}})}loadURL(c,g={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const C="boolean"==typeof g.validate?g.validate:!p.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,g.accessToken);const T=this.map._requestManager.transformRequest(c,p.ResourceType.Style);this._request=p.getJSON(T,(A,L)=>{this._request=null,A?this.fire(new p.ErrorEvent(A)):L&&this._load(L,C)})}loadJSON(c,g={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(c,!1!==g.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(ti,!1)}_updateLayerCount(c,g){const C=g?1:-1;c.is3D()&&(this._num3DLayers+=C),"circle"===c.type&&(this._numCircleLayers+=C),"symbol"===c.type&&(this._numSymbolLayers+=C)}_load(c,g){if(g&&Tl(this,p.validateStyle(c)))return;this._loaded=!0,this.stylesheet=p.clone$1(c),this._updateMapProjection();for(const T in c.sources)this.addSource(T,c.sources[T],{validate:!1});this._changed=!1,c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(c.glyphs);const C=zl(this.stylesheet.layers);this._order=C.map(T=>T.id),this._layers={},this._serializedLayers={};for(const T of C){const A=p.createStyleLayer(T);A.setEventedParent(this,{layer:{id:A.id}}),this._layers[A.id]=A,this._serializedLayers[A.id]=A.serialize(),this._updateLayerCount(A,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ve(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(c){this._spriteRequest=function(g,C,T){let A,L,F;const V=p.exported.devicePixelRatio>1?"@2x":"";let H=p.getJSON(C.transformRequest(C.normalizeSpriteURL(g,V,".json"),p.ResourceType.SpriteJSON),(ge,De)=>{H=null,F||(F=ge,A=De,ee())}),$=p.getImage(C.transformRequest(C.normalizeSpriteURL(g,V,".png"),p.ResourceType.SpriteImage),(ge,De)=>{$=null,F||(F=ge,L=De,ee())});function ee(){if(F)T(F);else if(A&&L){const ge=p.exported.getImageData(L),De={};for(const Re in A){const{width:Ce,height:Le,x:te,y:Se,sdf:Ue,pixelRatio:He,stretchX:lt,stretchY:ut,content:ct}=A[Re],yt=new p.RGBAImage({width:Ce,height:Le});p.RGBAImage.copy(ge,yt,{x:te,y:Se},{x:0,y:0},{width:Ce,height:Le}),De[Re]={data:yt,pixelRatio:He,sdf:Ue,stretchX:lt,stretchY:ut,content:ct}}T(null,De)}}return{cancel(){H&&(H.cancel(),H=null),$&&($.cancel(),$=null)}}}(c,this.map._requestManager,(g,C)=>{if(this._spriteRequest=null,g)this.fire(new p.ErrorEvent(g));else if(C)for(const T in C)this.imageManager.addImage(T,C[T]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(c){const g=this.getSource(c.source);if(!g)return;const C=c.sourceLayer;C&&("geojson"===g.type||g.vectorLayerIds&&-1===g.vectorLayerIds.indexOf(C))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${C}" does not exist on source "${g.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(c){const g=[];for(const C of c){const T=this._layers[C];"custom"!==T.type&&g.push(T.serialize())}return g}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(c){return!!this.terrain&&("function"==typeof c.isLayerDraped?c.isLayerDraped():Uo[c.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(c){if(!this._loaded)return;const g=this._changed;if(this._changed){const T=Object.keys(this._updatedLayers),A=Object.keys(this._removedLayers);(T.length||A.length)&&this._updateWorkerLayers(T,A);for(const L in this._updatedSources){const F=this._updatedSources[L];"reload"===F?this._reloadSource(L):"clear"===F&&this._clearSource(L)}this._updateTilesForChangedImages();for(const L in this._updatedPaintProps)this._layers[L].updateTransitions(c);this.light.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._resetUpdates()}const C={};for(const T in this._sourceCaches){const A=this._sourceCaches[T];C[T]=A.used,A.used=!1}for(const T of this._order){const A=this._layers[T];if(A.recalculate(c,this._availableImages),!A.isHidden(c.zoom)){const F=this._getLayerSourceCache(A);F&&(F.used=!0)}const L=this.map.painter;if(L){const F=A.getProgramIds();if(!F)continue;const V=A.getProgramConfiguration(c.zoom);for(const H of F)L.useProgram(H,V)}}for(const T in C){const A=this._sourceCaches[T];C[T]!==A.used&&A.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const g in this._sourceCaches)this._sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateWorkerLayers(c,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:g})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(c){if(this._checkLoaded(),Tl(this,p.validateStyle(c)))return!1;(c=p.clone$1(c)).layers=zl(c.layers);const g=function(T,A){if(!T)return[{command:Hr.setStyle,args:[A]}];let L=[];try{if(!be(T.version,A.version))return[{command:Hr.setStyle,args:[A]}];be(T.center,A.center)||L.push({command:Hr.setCenter,args:[A.center]}),be(T.zoom,A.zoom)||L.push({command:Hr.setZoom,args:[A.zoom]}),be(T.bearing,A.bearing)||L.push({command:Hr.setBearing,args:[A.bearing]}),be(T.pitch,A.pitch)||L.push({command:Hr.setPitch,args:[A.pitch]}),be(T.sprite,A.sprite)||L.push({command:Hr.setSprite,args:[A.sprite]}),be(T.glyphs,A.glyphs)||L.push({command:Hr.setGlyphs,args:[A.glyphs]}),be(T.transition,A.transition)||L.push({command:Hr.setTransition,args:[A.transition]}),be(T.light,A.light)||L.push({command:Hr.setLight,args:[A.light]}),be(T.fog,A.fog)||L.push({command:Hr.setFog,args:[A.fog]}),be(T.projection,A.projection)||L.push({command:Hr.setProjection,args:[A.projection]});const F={},V=[];!function(ee,ge,De,Re){let Ce;for(Ce in ge=ge||{},ee=ee||{})ee.hasOwnProperty(Ce)&&(ge.hasOwnProperty(Ce)||Fi(Ce,De,Re));for(Ce in ge){if(!ge.hasOwnProperty(Ce))continue;const Le=ge[Ce];ee.hasOwnProperty(Ce)?be(ee[Ce],Le)||("geojson"===ee[Ce].type&&"geojson"===Le.type&&Jc(ee,ge,Ce)?De.push({command:Hr.setGeoJSONSourceData,args:[Ce,Le.data]}):vi(Ce,ge,De,Re)):Ps(Ce,ge,De)}}(T.sources,A.sources,V,F);const H=[];T.layers&&T.layers.forEach(ee=>{ee.source&&F[ee.source]?L.push({command:Hr.removeLayer,args:[ee.id]}):H.push(ee)});let $=T.terrain;$&&F[$.source]&&(L.push({command:Hr.setTerrain,args:[void 0]}),$=void 0),L=L.concat(V),be($,A.terrain)||L.push({command:Hr.setTerrain,args:[A.terrain]}),function(ee,ge,De){ge=ge||[];const Re=(ee=ee||[]).map(Na),Ce=ge.map(Na),Le=ee.reduce(qo,{}),te=ge.reduce(qo,{}),Se=Re.slice(),Ue=Object.create(null);let He,lt,ut,ct,yt,xt,Bt;for(He=0,lt=0;He<Re.length;He++)ut=Re[He],te.hasOwnProperty(ut)?lt++:(De.push({command:Hr.removeLayer,args:[ut]}),Se.splice(Se.indexOf(ut,lt),1));for(He=0,lt=0;He<Ce.length;He++)ut=Ce[Ce.length-1-He],Se[Se.length-1-He]!==ut&&(Le.hasOwnProperty(ut)?(De.push({command:Hr.removeLayer,args:[ut]}),Se.splice(Se.lastIndexOf(ut,Se.length-lt),1)):lt++,xt=Se[Se.length-He],De.push({command:Hr.addLayer,args:[te[ut],xt]}),Se.splice(Se.length-He,0,ut),Ue[ut]=!0);for(He=0;He<Ce.length;He++)if(ut=Ce[He],ct=Le[ut],yt=te[ut],!Ue[ut]&&!be(ct,yt))if(be(ct.source,yt.source)&&be(ct["source-layer"],yt["source-layer"])&&be(ct.type,yt.type)){for(Bt in ps(ct.layout,yt.layout,De,ut,null,Hr.setLayoutProperty),ps(ct.paint,yt.paint,De,ut,null,Hr.setPaintProperty),be(ct.filter,yt.filter)||De.push({command:Hr.setFilter,args:[ut,yt.filter]}),be(ct.minzoom,yt.minzoom)&&be(ct.maxzoom,yt.maxzoom)||De.push({command:Hr.setLayerZoomRange,args:[ut,yt.minzoom,yt.maxzoom]}),ct)ct.hasOwnProperty(Bt)&&"layout"!==Bt&&"paint"!==Bt&&"filter"!==Bt&&"metadata"!==Bt&&"minzoom"!==Bt&&"maxzoom"!==Bt&&(0===Bt.indexOf("paint.")?ps(ct[Bt],yt[Bt],De,ut,Bt.slice(6),Hr.setPaintProperty):be(ct[Bt],yt[Bt])||De.push({command:Hr.setLayerProperty,args:[ut,Bt,yt[Bt]]}));for(Bt in yt)yt.hasOwnProperty(Bt)&&!ct.hasOwnProperty(Bt)&&"layout"!==Bt&&"paint"!==Bt&&"filter"!==Bt&&"metadata"!==Bt&&"minzoom"!==Bt&&"maxzoom"!==Bt&&(0===Bt.indexOf("paint.")?ps(ct[Bt],yt[Bt],De,ut,Bt.slice(6),Hr.setPaintProperty):be(ct[Bt],yt[Bt])||De.push({command:Hr.setLayerProperty,args:[ut,Bt,yt[Bt]]}))}else De.push({command:Hr.removeLayer,args:[ut]}),xt=Se[Se.lastIndexOf(ut)+1],De.push({command:Hr.addLayer,args:[yt,xt]})}(H,A.layers,L)}catch(F){console.warn("Unable to compute style diff:",F),L=[{command:Hr.setStyle,args:[A]}]}return L}(this.serialize(),c).filter(T=>!(T.command in Gl));if(0===g.length)return!1;const C=g.filter(T=>!(T.command in ms));if(C.length>0)throw new Error(`Unimplemented: ${C.map(T=>T.command).join(", ")}.`);return g.forEach(T=>{"setTransition"!==T.command&&"setProjection"!==T.command&&this[T.command].apply(this,T.args)}),this.stylesheet=c,this._updateMapProjection(),!0}addImage(c,g){return this.getImage(c)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,g),this._afterImageUpdated(c),this)}updateImage(c,g){this.imageManager.updateImage(c,g)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c),this._afterImageUpdated(c),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(c,g,C={}){if(this._checkLoaded(),void 0!==this.getSource(c))throw new Error("There is already a source with this ID");if(!g.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(g).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(p.validateSource,`sources.${c}`,g,null,C))return;this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);const T=Nr(c,g,this.dispatcher,this);T.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(c),source:T.serialize(),sourceId:c}));const A=L=>{const F=(L?"symbol:":"other:")+c,V=this._sourceCaches[F]=new p.SourceCache(F,T,L);(L?this._symbolSourceCaches:this._otherSourceCaches)[c]=V,V.style=this,V.onAdd(this.map)};A(!1),"vector"!==g.type&&"geojson"!==g.type||A(!0),T.onAdd&&T.onAdd(this.map),this._changed=!0}removeSource(c){this._checkLoaded();const g=this.getSource(c);if(!g)throw new Error("There is no source with this ID");for(const T in this._layers)if(this._layers[T].source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while layer "${T}" is using it.`)));if(this.terrain&&this.terrain.get().source===c)return this.fire(new p.ErrorEvent(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const C=this._getSourceCaches(c);for(const T of C)delete this._sourceCaches[T.id],delete this._updatedSources[T.id],T.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:T.getSource().id})),T.setEventedParent(null),T.clearTiles();return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],g.setEventedParent(null),g.onRemove&&g.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(c,g){this._checkLoaded(),this.getSource(c).setData(g),this._changed=!0}getSource(c){const g=this._getSourceCache(c);return g&&g.getSource()}_getSources(){const c=[];for(const g in this._otherSourceCaches){const C=this._getSourceCache(g);C&&c.push(C.getSource())}return c}addLayer(c,g,C={}){this._checkLoaded();const T=c.id;if(this.getLayer(T))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${T}" already exists on this map`)));let A;if("custom"===c.type){if(Tl(this,p.validateCustomStyleLayer(c)))return;A=p.createStyleLayer(c)}else{if("object"==typeof c.source&&(this.addSource(T,c.source),c=p.clone$1(c),c=p.extend(c,{source:T})),this._validate(p.validateLayer,`layers.${T}`,c,{arrayIndex:-1},C))return;A=p.createStyleLayer(c),this._validateLayer(A),A.setEventedParent(this,{layer:{id:T}}),this._serializedLayers[A.id]=A.serialize(),this._updateLayerCount(A,!0)}const L=g?this._order.indexOf(g):this._order.length;if(g&&-1===L)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${g}" does not exist on this map.`)));this._order.splice(L,0,T),this._layerOrderChanged=!0,this._layers[T]=A;const F=this._getLayerSourceCache(A);if(this._removedLayers[T]&&A.source&&F&&"custom"!==A.type){const V=this._removedLayers[T];delete this._removedLayers[T],V.type!==A.type?this._updatedSources[A.source]="clear":(this._updatedSources[A.source]="reload",F.pause())}this._updateLayer(A),A.onAdd&&A.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(c,g){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===g)return;const C=this._order.indexOf(c);this._order.splice(C,1);const T=g?this._order.indexOf(g):this._order.length;g&&-1===T?this.fire(new p.ErrorEvent(new Error(`Layer with id "${g}" does not exist on this map.`))):(this._order.splice(T,0,c),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(c){this._checkLoaded();const g=this._layers[c];if(!g)return void this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be removed.`)));g.setEventedParent(null),this._updateLayerCount(g,!1);const C=this._order.indexOf(c);this._order.splice(C,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=g,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],g.onRemove&&g.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(c){return this._layers[c]}hasLayer(c){return c in this._layers}hasLayerType(c){for(const g in this._layers)if(this._layers[g].type===c)return!0;return!1}setLayerZoomRange(c,g,C){this._checkLoaded();const T=this.getLayer(c);T?T.minzoom===g&&T.maxzoom===C||(null!=g&&(T.minzoom=g),null!=C&&(T.maxzoom=C),this._updateLayer(T)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(c,g,C={}){this._checkLoaded();const T=this.getLayer(c);if(T){if(!be(T.filter,g))return null==g?(T.filter=void 0,void this._updateLayer(T)):void(this._validate(p.validateFilter,`layers.${T.id}.filter`,g,{layerType:T.type},C)||(T.filter=p.clone$1(g),this._updateLayer(T)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be filtered.`)))}getFilter(c){const g=this.getLayer(c);return g&&p.clone$1(g.filter)}setLayoutProperty(c,g,C,T={}){this._checkLoaded();const A=this.getLayer(c);A?be(A.getLayoutProperty(g),C)||(A.setLayoutProperty(g,C,T),this._updateLayer(A)):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(c,g){const C=this.getLayer(c);if(C)return C.getLayoutProperty(g);this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style.`)))}setPaintProperty(c,g,C,T={}){this._checkLoaded();const A=this.getLayer(c);A?be(A.getPaintProperty(g),C)||(A.setPaintProperty(g,C,T)&&this._updateLayer(A),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${c}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(c,g){const C=this.getLayer(c);return C&&C.getPaintProperty(g)}setFeatureState(c,g){this._checkLoaded();const C=c.source,T=c.sourceLayer,A=this.getSource(C);if(!A)return void this.fire(new p.ErrorEvent(new Error(`The source '${C}' does not exist in the map's style.`)));const L=A.type;if("geojson"===L&&T)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===L&&!T)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const F=this._getSourceCaches(C);for(const V of F)V.setFeatureState(T,c.id,g)}removeFeatureState(c,g){this._checkLoaded();const C=c.source,T=this.getSource(C);if(!T)return void this.fire(new p.ErrorEvent(new Error(`The source '${C}' does not exist in the map's style.`)));const A=T.type,L="vector"===A?c.sourceLayer:void 0;if("vector"===A&&!L)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(g&&"string"!=typeof c.id&&"number"!=typeof c.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const F=this._getSourceCaches(C);for(const V of F)V.removeFeatureState(L,c.id,g)}getFeatureState(c){this._checkLoaded();const g=c.source,C=c.sourceLayer,T=this.getSource(g);if(T){if("vector"!==T.type||C)return void 0===c.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(g)[0].getFeatureState(C,c.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const c={};for(const g in this._sourceCaches){const C=this._sourceCaches[g].getSource();c[C.id]||(c[C.id]=C.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:c,layers:this._serializeLayers(this._order)},g=>void 0!==g)}_updateLayer(c){this._updatedLayers[c.id]=!0;const g=this._getLayerSourceCache(c);c.source&&!this._updatedSources[c.source]&&g&&"raster"!==g.getSource().type&&(this._updatedSources[c.source]="reload",g.pause()),this._changed=!0,c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const g=L=>"fill-extrusion"===this._layers[L].type,C={},T=[];for(let L=this._order.length-1;L>=0;L--){const F=this._order[L];if(g(F)){C[F]=L;for(const V of c){const H=V[F];if(H)for(const $ of H)T.push($)}}}T.sort((L,F)=>F.intersectionZ-L.intersectionZ);const A=[];for(let L=this._order.length-1;L>=0;L--){const F=this._order[L];if(g(F))for(let V=T.length-1;V>=0;V--){const H=T[V].feature;if(C[H.layer.id]<L)break;A.push(H),T.pop()}else for(const V of c){const H=V[F];if(H)for(const $ of H)A.push($.feature)}}return A}queryRenderedFeatures(c,g,C){g&&g.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",g.filter,null,g);const T={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const V of g.layers){const H=this._layers[V];if(!H)return this.fire(new p.ErrorEvent(new Error(`The layer '${V}' does not exist in the map's style and cannot be queried for features.`))),[];T[H.source]=!0}}const A=[];g.availableImages=this._availableImages;const L=g&&g.layers?g.layers.some(V=>{const H=this.getLayer(V);return H&&H.is3D()}):this.has3DLayers(),F=pt.createFromScreenPoints(c,C);for(const V in this._sourceCaches){const H=this._sourceCaches[V].getSource().id;g.layers&&!T[H]||A.push(Ro(this._sourceCaches[V],this._layers,this._serializedLayers,F,g,C,L,!!this.map._showQueryGeometry))}return this.placement&&A.push(function(V,H,$,ee,ge,De,Re){const Ce={},Le=De.queryRenderedSymbols(ee),te=[];for(const Se of Object.keys(Le).map(Number))te.push(Re[Se]);te.sort(Br);for(const Se of te){const Ue=Se.featureIndex.lookupSymbolFeatures(Le[Se.bucketInstanceId],H,Se.bucketIndex,Se.sourceLayerIndex,ge.filter,ge.layers,ge.availableImages,V);for(const He in Ue){const lt=Ce[He]=Ce[He]||[],ut=Ue[He];ut.sort((ct,yt)=>{const xt=Se.featureSortOrder;if(xt){const Bt=xt.indexOf(ct.featureIndex);return xt.indexOf(yt.featureIndex)-Bt}return yt.featureIndex-ct.featureIndex});for(const ct of ut)lt.push(ct)}}for(const Se in Ce)Ce[Se].forEach(Ue=>{const He=Ue.feature,lt=$(V[Se]);if(!lt)return;const ut=lt.getFeatureState(He.layer["source-layer"],He.id);He.source=He.layer.source,He.layer["source-layer"]&&(He.sourceLayer=He.layer["source-layer"]),He.state=ut});return Ce}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),F.screenGeometry,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(A)}querySourceFeatures(c,g){g&&g.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",g.filter,null,g);const C=this._getSourceCaches(c);let T=[];for(const A of C)T=T.concat(Jr(A,g));return T}addSourceType(c,g,C){return Oo.getSourceType(c)?C(new Error(`A source type called "${c}" already exists.`)):(Oo.setSourceType(c,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:g.workerSourceURL},C):C(null,null))}getLight(){return this.light.getLight()}setLight(c,g={}){this._checkLoaded();const C=this.light.getLight();let T=!1;for(const L in c)if(!be(c[L],C[L])){T=!0;break}if(!T)return;const A=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(c,g),this.light.updateTransitions(A)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,g=1){if(this._checkLoaded(),!c)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let C=c;if(1===g){if("object"==typeof C.source){const T="terrain-dem-src";this.addSource(T,C.source),C=p.clone$1(C),C=p.extend(C,{source:T})}if(this._validate(p.validateTerrain,"terrain",C))return}if(!this.terrain||this.terrain&&g!==this.terrain.drapeRenderMode){if(!C)return;this._createTerrain(C,g)}else{const T=this.terrain,A=T.get();for(const L of Object.keys(p.spec.terrain))!C.hasOwnProperty(L)&&p.spec.terrain[L].default&&(C[L]=p.spec.terrain[L].default);for(const L in C)if(!be(C[L],A[L])){T.set(C),this.stylesheet.terrain=C;const F=this._setTransitionParameters({duration:0});T.updateTransitions(F);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const g=this.fog=new at(c,this.map.transform);this.stylesheet.fog=c;const C=this._setTransitionParameters({duration:0});g.updateTransitions(C)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const g=this.fog,C=g.get();0===Object.keys(c).length&&g.set(c);for(const T in c)if(!be(c[T],C[T])){g.set(c),this.stylesheet.fog=c;const A=this._setTransitionParameters({duration:0});g.updateTransitions(A);break}}else this._createFog(c);this._markersNeedUpdate=!0}_setTransitionParameters(c){return{now:p.exported.now(),transition:p.extend(c,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const c=this._order.filter(C=>this.isLayerDraped(this._layers[C])),g=this._order.filter(C=>!this.isLayerDraped(this._layers[C]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...g)}_createTerrain(c,g){const C=this.terrain=new Te(c,g);this.stylesheet.terrain=c,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const T=this._setTransitionParameters({duration:0});C.updateTransitions(T)}_force3DLayerUpdate(){for(const c in this._layers){const g=this._layers[c];"fill-extrusion"===g.type&&this._updateLayer(g)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const g=this._layers[c];"symbol"===g.type&&this._updateLayer(g)}}_validate(c,g,C,T,A={}){return(!A||!1!==A.validate)&&Tl(this,c.call(p.validateStyle,p.extend({key:g,style:this.serialize(),value:C,styleSpec:p.spec},T)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles(),this._sourceCaches[c].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(c){const g=this._getSourceCaches(c);for(const C of g)C.clearTiles()}_reloadSource(c){const g=this._getSourceCaches(c);for(const C of g)C.resume(),C.reload()}_reloadSources(){for(const c of this._getSources())c.reload&&c.reload()}_updateSources(c){for(const g in this._sourceCaches)this._sourceCaches[g].update(c)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const g=this._sourceCaches[c];g.resume(),g.reload()}}_updatePlacement(c,g,C,T,A=!1){let L=!1,F=!1;const V={};for(const H of this._order){const $=this._layers[H];if("symbol"!==$.type)continue;if(!V[$.source]){const ge=this._getLayerSourceCache($);if(!ge)continue;V[$.source]=ge.getRenderableIds(!0).map(De=>ge.getTileByID(De)).sort((De,Re)=>Re.tileID.overscaledZ-De.tileID.overscaledZ||(De.tileID.isLessThan(Re.tileID)?-1:1))}const ee=this.crossTileSymbolIndex.addLayer($,V[$.source],c.center.lng,c.projection);L=L||ee}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),A=A||this._layerOrderChanged||0===C,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(A||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),c.zoom))&&(this.pauseablePlacement=new Vo(c,this._order,A,g,C,T,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,V),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),F=!0),L&&this.pauseablePlacement.placement.setStale()),F||L)for(const H of this._order){const $=this._layers[H];"symbol"===$.type&&this.placement.updateLayerOpacities($,V[$.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,g,C){this.imageManager.getImages(g.icons,C),this._updateTilesForChangedImages();const T=A=>{A&&A.setDependencies(g.tileID.key,g.type,g.icons)};T(this._otherSourceCaches[g.source]),T(this._symbolSourceCaches[g.source])}getGlyphs(c,g,C){this.glyphManager.getGlyphs(g.stacks,C)}getResource(c,g,C){return p.makeRequest(g,C)}_getSourceCache(c){return this._otherSourceCaches[c]}_getLayerSourceCache(c){return"symbol"===c.type?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}_getSourceCaches(c){const g=[];return this._otherSourceCaches[c]&&g.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&g.push(this._symbolSourceCaches[c]),g}_isSourceCacheLoaded(c){const g=this._getSourceCaches(c);return 0===g.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${c}'`))),!1):g.every(C=>C.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Oo.getSourceType=function(x){return Ur[x]},Oo.setSourceType=function(x,c){Ur[x]=c},Oo.registerForPluginStateChange=p.registerForPluginStateChange;var Jh="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Gn="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",$l="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Ti="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Hl="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let ra={},fl={};const Vs=[];er(Jh,Vs),er($l,Vs),er(Ti,Vs),er(Hl,Vs),ra=Kn("",$l),fl=Kn(Hl,Ti);const oc=Kn("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Ha=Jh,sc="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var jo={background:Kn("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Kn("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Kn("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Kn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Kn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Kn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Kn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Kn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Kn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Kn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Kn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Kn("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Kn("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Kn("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Kn("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Kn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Kn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Kn("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Kn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Kn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Kn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Kn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Kn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Kn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Kn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Kn("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Gn),skyboxGradient:Kn("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Gn),skyboxCapture:Kn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Kn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Kn("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function er(x,c){const g=x.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let C of g)if(C=C.trim(),"#"===C[0]&&C.includes("if")&&!C.includes("endif")){C=C.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const T=C.split(" ");for(const A of T)c.includes(A)||c.push(A)}}function Kn(x,c){const g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,C=c.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),T={},A=[...Vs];return er(x,A),er(c,A),{fragmentSource:x=x.replace(g,(L,F,V,H,$)=>(T[$]=!0,"define"===F?`\n#ifndef HAS_UNIFORM_u_${$}\nvarying ${V} ${H} ${$};\n#else\nuniform ${V} ${H} u_${$};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${$}\n    ${V} ${H} ${$} = u_${$};\n#endif\n`)),vertexSource:c=c.replace(g,(L,F,V,H,$)=>{const ee="float"===H?"vec2":"vec4",ge=$.match(/color/)?"color":ee;return T[$]?"define"===F?`\n#ifndef HAS_UNIFORM_u_${$}\nuniform lowp float u_${$}_t;\nattribute ${V} ${ee} a_${$};\nvarying ${V} ${H} ${$};\n#else\nuniform ${V} ${H} u_${$};\n#endif\n`:"vec4"===ge?`\n#ifndef HAS_UNIFORM_u_${$}\n    ${$} = a_${$};\n#else\n    ${V} ${H} ${$} = u_${$};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${$}\n    ${$} = unpack_mix_${ge}(a_${$}, u_${$}_t);\n#else\n    ${V} ${H} ${$} = u_${$};\n#endif\n`:"define"===F?`\n#ifndef HAS_UNIFORM_u_${$}\nuniform lowp float u_${$}_t;\nattribute ${V} ${ee} a_${$};\n#else\nuniform ${V} ${H} u_${$};\n#endif\n`:"vec4"===ge?`\n#ifndef HAS_UNIFORM_u_${$}\n    ${V} ${H} ${$} = a_${$};\n#else\n    ${V} ${H} ${$} = u_${$};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${$}\n    ${V} ${H} ${$} = unpack_mix_${ge}(a_${$}, u_${$}_t);\n#else\n    ${V} ${H} ${$} = u_${$};\n#endif\n`}),staticAttributes:C,usedDefines:A}}class Qc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,g,C,T,A,L,F){this.context=c;let V=this.boundPaintVertexBuffers.length!==T.length;for(let $=0;!V&&$<T.length;$++)this.boundPaintVertexBuffers[$]!==T[$]&&(V=!0);let H=this.boundDynamicVertexBuffers.length!==F.length;for(let $=0;!H&&$<F.length;$++)this.boundDynamicVertexBuffers[$]!==F[$]&&(H=!0);if(!c.extVertexArrayObject||!this.vao||this.boundProgram!==g||this.boundLayoutVertexBuffer!==C||V||H||this.boundIndexBuffer!==A||this.boundVertexOffset!==L)this.freshBind(g,C,T,A,L,F);else{c.bindVertexArrayOES.set(this.vao);for(const $ of F)$&&$.bind();A&&A.dynamicDraw&&A.bind()}}freshBind(c,g,C,T,A,L){let F;const V=c.numAttributes,H=this.context,$=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),F=0,this.boundProgram=c,this.boundLayoutVertexBuffer=g,this.boundPaintVertexBuffers=C,this.boundIndexBuffer=T,this.boundVertexOffset=A,this.boundDynamicVertexBuffers=L;else{F=H.currentNumAttributes||0;for(let ee=V;ee<F;ee++)$.disableVertexAttribArray(ee)}g.enableAttributes($,c),g.bind(),g.setVertexAttribPointers($,c,A);for(const ee of C)ee.enableAttributes($,c),ee.bind(),ee.setVertexAttribPointers($,c,A);for(const ee of L)ee&&(ee.enableAttributes($,c),ee.bind(),ee.setVertexAttribPointers($,c,A));T&&T.bind(),H.currentNumAttributes=V}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function pa(x,c){const g=Math.pow(2,c.canonical.z),C=c.canonical.y;return[new p.MercatorCoordinate(0,C/g).toLngLat().lat,new p.MercatorCoordinate(0,(C+1)/g).toLngLat().lat]}function ns(x,c,g,C,T,A,L){const F=x.context,V=F.gl,H=g.fbo;if(!H)return;x.prepareDrawTile();const $=x.useProgram("hillshade");F.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,H.colorAttachment.get());const ee=((Ce,Le,te,Se)=>{const Ue=te.paint.get("hillshade-shadow-color"),He=te.paint.get("hillshade-highlight-color"),lt=te.paint.get("hillshade-accent-color");let ut=te.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===te.paint.get("hillshade-illumination-anchor")&&(ut-=Ce.transform.angle);const ct=!Ce.options.moving;return{u_matrix:Se||Ce.transform.calculateProjMatrix(Le.tileID.toUnwrapped(),ct),u_image:0,u_latrange:pa(0,Le.tileID),u_light:[te.paint.get("hillshade-exaggeration"),ut],u_shadow:Ue,u_highlight:He,u_accent:lt}})(x,g,C,x.terrain?c.projMatrix:null);x.prepareDrawProgram(F,$,c.toUnwrapped());const{tileBoundsBuffer:ge,tileBoundsIndexBuffer:De,tileBoundsSegments:Re}=x.getTileBoundsBuffers(g);$.draw(F,V.TRIANGLES,T,A,L,p.CullFaceMode.disabled,ee,C.id,ge,De,Re)}function Iu(x,c,g){if(!c.needsDEMTextureUpload)return;const C=x.context,T=C.gl;C.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||x.getTileTexture(g.stride);const A=g.getPixels();c.demTexture?c.demTexture.update(A,{premultiply:!1}):c.demTexture=new p.Texture(C,A,T.RGBA,{premultiply:!1}),c.needsDEMTextureUpload=!1}function Qh(x,c,g,C,T,A){const L=x.context,F=L.gl;if(!c.dem)return;const V=c.dem;if(L.activeTexture.set(F.TEXTURE1),Iu(x,c,V),!c.demTexture)return;c.demTexture.bind(F.NEAREST,F.CLAMP_TO_EDGE);const H=V.dim;L.activeTexture.set(F.TEXTURE0);let $=c.fbo;if(!$){const Re=new p.Texture(L,{width:H,height:H,data:null},F.RGBA);Re.bind(F.LINEAR,F.CLAMP_TO_EDGE),$=c.fbo=L.createFramebuffer(H,H,!0),$.colorAttachment.set(Re.texture)}L.bindFramebuffer.set($.framebuffer),L.viewport.set([0,0,H,H]);const{tileBoundsBuffer:ee,tileBoundsIndexBuffer:ge,tileBoundsSegments:De}=x.getMercatorTileBoundsBuffers();x.useProgram("hillshadePrepare").draw(L,F.TRIANGLES,C,T,A,p.CullFaceMode.disabled,((Re,Ce)=>{const Le=Ce.stride,te=p.create();return p.ortho(te,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(te,te,[0,-p.EXTENT,0]),{u_matrix:te,u_image:1,u_dimension:[Le,Le],u_zoom:Re.overscaledZ,u_unpack:Ce.unpackVector}})(c.tileID,V),g.id,ee,ge,De),c.needsHillshadePrepare=!1}const Eo=x=>({u_matrix:new p.UniformMatrix4f(x),u_image0:new p.Uniform1i(x),u_skirt_height:new p.Uniform1f(x)}),Ch=(x,c)=>({u_matrix:x,u_image0:0,u_skirt_height:c}),bi=(x,c,g,C,T,A,L,F,V,H,$,ee,ge,De,Re)=>({u_proj_matrix:Float32Array.from(x),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(C),u_merc_matrix:g,u_zoom_transition:T,u_merc_center:A,u_image0:0,u_frustum_tl:L,u_frustum_tr:F,u_frustum_br:V,u_frustum_bl:H,u_globe_pos:$,u_globe_radius:ee,u_viewport:ge,u_grid_matrix:Re?Float32Array.from(Re):new Float32Array(9),u_skirt_height:De});function Il(x,c){return null!=x&&null!=c&&!(!x.hasData()||!c.hasData())&&null!=x.demTexture&&null!=c.demTexture&&x.tileID.key!==c.tileID.key}const Ei=new class{constructor(){this.operations={}}newMorphing(x,c,g,C,T){if(x in this.operations){const A=this.operations[x];A.to.tileID.key!==g.tileID.key&&(A.queued=g)}else this.operations[x]={startTime:C,phase:0,duration:T,from:c,to:g,queued:null}}getMorphValuesForProxy(x){if(!(x in this.operations))return null;const c=this.operations[x];return{from:c.from,to:c.to,phase:c.phase}}update(x){for(const c in this.operations){const g=this.operations[c];for(g.phase=(x-g.startTime)/g.duration;g.phase>=1||!this._validOp(g);)if(!this._nextOp(g,x)){delete this.operations[c];break}}}_nextOp(x,c){return!!x.queued&&(x.from=x.to,x.to=x.queued,x.queued=null,x.phase=0,x.startTime=c,!0)}_validOp(x){return x.from.hasData()&&x.to.hasData()}},ql={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Xs(x){return 6*Math.pow(1.5,22-x)}function _f(x,c){const g=1<<x.z;return!c&&(0===x.x||x.x===g-1)||0===x.y||x.y===g-1}const ni=x=>({u_matrix:x});function ac(x,c,g,C,T){if(T>0){const A=p.exported.now(),L=(A-x.timeAdded)/T,F=c?(A-c.timeAdded)/T:-1,V=g.getSource(),H=C.coveringZoomLevel({tileSize:V.tileSize,roundZoom:V.roundZoom}),$=!c||Math.abs(c.tileID.overscaledZ-H)>Math.abs(x.tileID.overscaledZ-H),ee=$&&x.refreshedUponExpiration?1:p.clamp($?L:1-F,0,1);return x.refreshedUponExpiration&&L>=1&&(x.refreshedUponExpiration=!1),c?{opacity:1,mix:1-ee}:{opacity:ee,mix:0}}return{opacity:1,mix:0}}class yo extends p.SourceCache{constructor(c){const g={type:"raster-dem",maxzoom:c.transform.maxZoom},C=new Ae(Bl(),null),T=Nr("mock-dem",g,C,c.style);super("mock-dem",T,!1),T.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,g){c.state="loaded",g(null)}}class Wl extends p.SourceCache{constructor(c){const g=Nr("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new Ae(Bl(),null),c.style);super("proxy",g,!1),g.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,g,C){if(c.freezeTileCoverage)return;this.transform=c;const T=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((A,L)=>{if(A[L.key]="",!this._tiles[L.key]){const F=new p.Tile(L,this._source.tileSize*L.overscaleFactor(),c.tileZoom);F.state="loaded",this._tiles[L.key]=F}return A},{});for(const A in this._tiles)A in T||(this.freeFBO(A),this._tiles[A].unloadVectorData(),delete this._tiles[A])}freeFBO(c){const g=this.proxyCachedFBO[c];if(void 0!==g){const C=Object.values(g);this.renderCachePool.push(...C),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ia extends p.OverscaledTileID{constructor(c,g,C){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=g,this.projMatrix=C}}class rl extends p.Elevation{constructor(c,g){super(),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[C,T,A]=function(V){const H=new p.StructArrayLayout2i4,$=new p.StructArrayLayout3ui6;H.reserve(17161),$.reserve(33800);const ge=p.EXTENT/128,De=p.EXTENT+ge/2,Re=De+ge;for(let Le=-ge;Le<Re;Le+=ge)for(let te=-ge;te<Re;te+=ge){const Se=te<0||te>De||Le<0||Le>De?24575:0,Ue=p.clamp(Math.round(te),0,p.EXTENT),He=p.clamp(Math.round(Le),0,p.EXTENT);H.emplaceBack(Ue+Se,He)}const Ce=(Le,te)=>{const Se=131*te+Le;$.emplaceBack(Se+1,Se,Se+131),$.emplaceBack(Se+131,Se+131+1,Se+1)};for(let Le=1;Le<129;Le++)for(let te=1;te<129;te++)Ce(te,Le);return[0,129].forEach(Le=>{for(let te=0;te<130;te++)Ce(te,Le),Ce(Le,te)}),[H,$,32768]}(),L=c.context;this.gridBuffer=L.createVertexBuffer(C,p.posAttributes.members),this.gridIndexBuffer=L.createIndexBuffer(T),this.gridSegments=p.SegmentVector.simpleSegment(0,0,C.length,T.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,C.length,A),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Wl(g.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.EXTENT,0,p.EXTENT,0,1);const F=L.gl;this._overlapStencilMode=new p.StencilMode({func:F.GEQUAL,mask:255},0,255,F.KEEP,F.KEEP,F.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=g,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new yo(g.map)}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),c.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=c,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,g,C){if(c&&c.terrain){this._style!==c&&(this.style=c),this.enabled=!0;const T=c.terrain.properties;this.sourceCache=0===c.terrain.drapeRenderMode?this._mockSourceCache:c._getSourceCache(T.get("source")),this._exaggeration=T.get("exaggeration");const A=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const L=this.getScaledDemTileSize();this.sourceCache.update(g,L,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,A(),this._initializing=!0),A(),g.updateElevation(!0,C),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(g),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const c=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==c.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${c.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${c.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(c){c.coord&&"source"===c.dataType?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):"style"===c.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._sourceCaches)this._style._sourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const g=this.proxySourceCache,C=this.painter.transform;this._initializing&&(this._initializing=0===C._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(C.center),-1),this._emptyDEMTextureDirty=!this._initializing);const T=this.proxyCoords=g.getIds().map(V=>{const H=g.getTileByID(V).tileID;return H.projMatrix=C.calculateProjMatrix(H.toUnwrapped()),H});(function(V,H){const $=H.transform.pointCoordinate(H.transform.getCameraPoint()),ee=new p.Point($.x,$.y);V.sort((ge,De)=>{if(De.overscaledZ-ge.overscaledZ)return De.overscaledZ-ge.overscaledZ;const Re=new p.Point(ge.canonical.x+(1<<ge.canonical.z)*ge.wrap,ge.canonical.y),Ce=new p.Point(De.canonical.x+(1<<De.canonical.z)*De.wrap,De.canonical.y),Le=ee.mult(1<<ge.canonical.z);return Le.x-=.5,Le.y-=.5,Le.distSqr(Re)-Le.distSqr(Ce)})})(T,this.painter),this._previousZoom=C.zoom;const A=this.proxyToSource||{};this.proxyToSource={},T.forEach(V=>{this.proxyToSource[V.key]={}}),this.terrainTileForTile={};const L=this._style._sourceCaches;for(const V in L){const H=L[V];if(!H.used||(H!==this.sourceCache&&this.resetTileLookupCache(H.id),this._setupProxiedCoordsForOrtho(H,c[V],A),H.usedForTerrain))continue;const $=c[V];H.getSource().reparseOverscaled&&this._assignTerrainTiles($)}this.proxiedCoords[g.id]=T.map(V=>new ia(V,V.key,this.orthoMatrix)),this._assignTerrainTiles(T),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(A),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const F={};this._visibleDemTiles=[];for(const V of this.proxyCoords){const H=this.terrainTileForTile[V.key];if(!H)continue;const $=H.tileID.key;$ in F||(this._visibleDemTiles.push(H),F[$]=$)}}_assignTerrainTiles(c){this._initializing||c.forEach(g=>{if(this.terrainTileForTile[g.key])return;const C=this._findTileCoveringTileID(g,this.sourceCache);C&&(this.terrainTileForTile[g.key]=C)})}_prepareDEMTextures(){const c=this.painter.context,g=c.gl;for(const C in this.terrainTileForTile){const T=this.terrainTileForTile[C],A=T.dem;!A||T.demTexture&&!T.needsDEMTextureUpload||(c.activeTexture.set(g.TEXTURE1),Iu(this.painter,T,A))}}_prepareDemTileUniforms(c,g,C,T){if(!g||null==g.demTexture)return!1;const A=c.tileID.canonical,L=Math.pow(2,g.tileID.canonical.z-A.z),F=T||"";return C[`u_dem_tl${F}`]=[A.x*L%1,A.y*L%1],C[`u_dem_scale${F}`]=L,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,g=c.gl;if(!this._emptyDepthBufferTexture){const C=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(c,C,g.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const g=this._visibleDemTiles.reduce((C,T)=>{if(!T.dem)return C;const A=T.dem.tree.minimums[0];return A>0&&c++,C+A},0);return c?g/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,g=c.gl;c.activeTexture.set(g.TEXTURE2);const C=this._getLoadedAreaMinimum(),T=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(C,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let A=this._emptyDEMTexture;return A?A.update(T,{premultiply:!1}):A=this._emptyDEMTexture=new p.Texture(c,T,g.RGBA,{premultiply:!1}),A}setupElevationDraw(c,g,C){const T=this.painter.context,A=T.gl,L=(F=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(F),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var F;L.u_dem_size=this.sourceCache.getSource().tileSize,L.u_exaggeration=this.exaggeration();let V=null,H=null,$=1;if(C&&C.morphing&&this._useVertexMorphing){const ee=C.morphing.srcDemTile,ge=C.morphing.dstDemTile;$=C.morphing.phase,ee&&ge&&(this._prepareDemTileUniforms(c,ee,L,"_prev")&&(H=ee),this._prepareDemTileUniforms(c,ge,L)&&(V=ge))}if(H&&V?(T.activeTexture.set(A.TEXTURE2),V.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE,A.NEAREST),T.activeTexture.set(A.TEXTURE4),H.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE,A.NEAREST),L.u_dem_lerp=$):(V=this.terrainTileForTile[c.tileID.key],T.activeTexture.set(A.TEXTURE2),(this._prepareDemTileUniforms(c,V,L)?V.demTexture:this.emptyDEMTexture).bind(A.NEAREST,A.CLAMP_TO_EDGE)),T.activeTexture.set(A.TEXTURE3),C&&C.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE),this._depthFBO&&(L.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE),L.u_depth_size_inv=[1,1]),C&&C.useMeterToDem&&V){const ee=(1<<V.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;L.u_meter_to_dem=ee}if(C&&C.labelPlaneMatrixInv&&(L.u_label_plane_matrix_inv=C.labelPlaneMatrixInv),g.setTerrainUniformValues(T,L),"globe"===this.painter.transform.projection.name){const ee=this.globeUniformValues(this.painter.transform,c.tileID.canonical,C&&C.useDenormalizedUpVectorScale);g.setGlobeUniformValues(T,ee)}}globeUniformValues(c,g,C){const T=c.projection;return{u_tile_tl_up:T.upVector(g,0,0),u_tile_tr_up:T.upVector(g,p.EXTENT,0),u_tile_br_up:T.upVector(g,p.EXTENT,p.EXTENT),u_tile_bl_up:T.upVector(g,0,p.EXTENT),u_tile_up_scale:C?p.globeMetersToEcef(1):T.upVectorScale(g,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const g=this.painter,C=this.painter.context;0!==c.length&&(C.bindFramebuffer.set(null),C.viewport.set([0,0,g.width,g.height]),g.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(T,A,L,F,V){if("globe"===T.transform.projection.name)!function(H,$,ee,ge,De){const Re=H.context,Ce=Re.gl;let Le,te;const Se=H.options.showTerrainWireframe?2:0,Ue=H.transform,He=p.globeUseCustomAntiAliasing(H,Re,Ue),lt=(mn,Ft)=>{if(te===mn)return;const Yt=[ql[mn],"PROJECTION_GLOBE_VIEW"];He&&Yt.push("CUSTOM_ANTIALIASING"),Ft&&Yt.push(ql[Se]),Le=H.useProgram("globeRaster",null,Yt),te=mn},ut=H.colorModeForRenderPass(),ct=new p.DepthMode(Ce.LEQUAL,p.DepthMode.ReadWrite,H.depthRangeFor3D);Ei.update(De);const yt=p.calculateGlobeMercatorMatrix(Ue),xt=[p.mercatorXfromLng(Ue.center.lng),p.mercatorYfromLat(Ue.center.lat)],Bt=Se?[!1,!0]:[!1],Qt=H.globeSharedBuffers,Nt=[Ue.width*p.exported.devicePixelRatio,Ue.height*p.exported.devicePixelRatio],Jt=Float32Array.from(Ue.globeMatrix),Pt={useDenormalizedUpVectorScale:!0};if(Bt.forEach(mn=>{const Ft=H.transform,Yt=Xs(Ft.zoom)*$.exaggeration();te=-1;const an=mn?Ce.LINES:Ce.TRIANGLES;for(const ln of ge){const xn=ee.getTile(ln),cr=p.StencilMode.disabled,br=$.prevTerrainTileForTile[ln.key],Hn=$.terrainTileForTile[ln.key];Il(br,Hn)&&Ei.newMorphing(ln.key,br,Hn,De,250),Re.activeTexture.set(Ce.TEXTURE0),xn.texture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE);const vr=Ei.getMorphValuesForProxy(ln.key),ci=vr?1:0;vr&&p.extend$1(Pt,{morphing:{srcDemTile:vr.from,dstDemTile:vr.to,phase:p.easeCubicInOut(vr.phase)}});const li=p.tileCornersToBounds(ln.canonical),nr=p.getLatitudinalLod(li.getCenter().lat),So=p.getGridMatrix(ln.canonical,li,nr,Ft.worldSize/Ft._pixelsPerMercatorPixel),qn=p.globeNormalizeECEF(p.globeTileBounds(ln.canonical)),Lo=bi(Ft.projMatrix,Jt,yt,qn,p.globeToMercatorTransition(Ft.zoom),xt,Ft.frustumCorners.TL,Ft.frustumCorners.TR,Ft.frustumCorners.BR,Ft.frustumCorners.BL,Ft.globeCenterInViewSpace,Ft.globeRadius,Nt,Yt,So);if(lt(ci,mn),$.setupElevationDraw(xn,Le,Pt),H.prepareDrawProgram(Re,Le,ln.toUnwrapped()),Qt){const[Xo,Nl,al]=mn?Qt.getWirefameBuffers(H.context,nr):Qt.getGridBuffers(nr,0!==Yt);Le.draw(Re,an,ct,cr,ut,p.CullFaceMode.backCCW,Lo,"globe_raster",Xo,Nl,al)}}}),Qt){const mn=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];He&&mn.push("CUSTOM_ANTIALIASING"),Le=H.useProgram("globeRaster",null,mn);for(const Ft of ge){const{x:Yt,y:an,z:ln}=Ft.canonical,xn=0===an,cr=an===(1<<ln)-1,[br,Hn,vr,ci]=Qt.getPoleBuffers(ln);if(ci&&(xn||cr)){const li=ee.getTile(Ft);Re.activeTexture.set(Ce.TEXTURE0),li.texture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE);let nr=p.globePoleMatrixForTile(ln,Yt,Ue);const So=p.globeNormalizeECEF(p.globeTileBounds(Ft.canonical)),qn=(Lo,Xo)=>Lo.draw(Re,Ce.TRIANGLES,ct,p.StencilMode.disabled,ut,p.CullFaceMode.disabled,bi(Ue.projMatrix,nr,nr,So,0,xt,Ue.frustumCorners.TL,Ue.frustumCorners.TR,Ue.frustumCorners.BR,Ue.frustumCorners.BL,Ue.globeCenterInViewSpace,Ue.globeRadius,Nt,0),"globe_pole_raster",Xo,vr,ci);$.setupElevationDraw(li,Le,Pt),H.prepareDrawProgram(Re,Le,Ft.toUnwrapped()),xn&&qn(Le,br),cr&&(nr=p.scale(p.create(),nr,[1,-1,1]),qn(Le,Hn))}}}}(T,A,L,F,V);else{const H=T.context,$=H.gl;let ee,ge;const De=T.options.showTerrainWireframe?2:0,Re=(Ue,He)=>{if(ge===Ue)return;const lt=[ql[Ue]];He&&lt.push(ql[De]),ee=T.useProgram("terrainRaster",null,lt),ge=Ue},Ce=T.colorModeForRenderPass(),Le=new p.DepthMode($.LEQUAL,p.DepthMode.ReadWrite,T.depthRangeFor3D);Ei.update(V);const te=T.transform,Se=Xs(te.zoom)*A.exaggeration();(De?[!1,!0]:[!1]).forEach(Ue=>{ge=-1;const He=Ue?$.LINES:$.TRIANGLES,[lt,ut]=Ue?A.getWirefameBuffer():[A.gridIndexBuffer,A.gridSegments];for(const ct of F){const yt=L.getTile(ct),xt=p.StencilMode.disabled,Bt=A.prevTerrainTileForTile[ct.key],Qt=A.terrainTileForTile[ct.key];Il(Bt,Qt)&&Ei.newMorphing(ct.key,Bt,Qt,V,250),H.activeTexture.set($.TEXTURE0),yt.texture.bind($.LINEAR,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST);const Nt=Ei.getMorphValuesForProxy(ct.key),Jt=Nt?1:0;let Pt;Nt&&(Pt={morphing:{srcDemTile:Nt.from,dstDemTile:Nt.to,phase:p.easeCubicInOut(Nt.phase)}});const mn=Ch(ct.projMatrix,_f(ct.canonical,te.renderWorldCopies)?Se/10:Se);Re(Jt,Ue),A.setupElevationDraw(yt,ee,Pt),T.prepareDrawProgram(H,ee,ct.toUnwrapped()),ee.draw(H,He,Le,xt,Ce,p.CullFaceMode.backCCW,mn,"terrain_raster",A.gridBuffer,lt,ut)}})}}(g,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,g.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(0===this._drapedRenderBatches.length)return c+1;this.renderingToTexture=!0;const g=this.painter,C=this.painter.context,T=this.proxySourceCache,A=this.proxiedCoords[T.id],L=this._drapedRenderBatches.shift(),F=[],V=g.style.order;let H=0;for(const $ of A){const ee=T.getTileByID($.proxyTileKey),ge=T.proxyCachedFBO[$.key]?T.proxyCachedFBO[$.key][c]:void 0,De=void 0!==ge?T.renderCache[ge]:this.pool[H++],Re=void 0!==ge;if(ee.texture=De.tex,Re&&!De.dirty){F.push(ee.tileID);continue}let Ce;C.bindFramebuffer.set(De.fb.framebuffer),this.renderedToTile=!1,De.dirty&&(C.clear({color:p.Color.transparent,stencil:0}),De.dirty=!1);for(let Le=L.start;Le<=L.end;++Le){const te=g.style._layers[V[Le]];if(te.isHidden(g.transform.zoom))continue;const Se=g.style._getLayerSourceCache(te),Ue=Se?this.proxyToSource[$.key][Se.id]:[$];if(!Ue)continue;const He=Ue;C.viewport.set([0,0,De.fb.width,De.fb.height]),Ce!==(Se?Se.id:null)&&(this._setupStencil(De,Ue,te,Se),Ce=Se?Se.id:null),g.renderLayer(g,Se,te,He)}this.renderedToTile?(De.dirty=!0,F.push(ee.tileID)):Re||--H,5===H&&(H=0,this.renderToBackBuffer(F))}return this.renderToBackBuffer(F),this.renderingToTexture=!1,C.bindFramebuffer.set(null),C.viewport.set([0,0,g.width,g.height]),L.end+1}postRender(){}renderCacheEfficiency(c){const g=c.order.length;if(0===g)return{efficiency:100};let C,T=0,A=0,L=!1;for(let F=0;F<g;++F){const V=c._layers[c.order[F]];this._style.isLayerDraped(V)?(L&&++T,++A):L||(L=!0,C=V.id)}return 0===A?{efficiency:100}:{efficiency:100*(1-T/A),firstUndrapedLayer:C}}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(g=>g.dem).forEach(g=>{c=Math.min(c,g.dem.tree.minimums[0])}),0===c?c:(c-30)*this._exaggeration}raycast(c,g,C){if(!this._visibleDemTiles)return null;const T=this._visibleDemTiles.filter(A=>A.dem).map(A=>{const L=A.tileID,F=1<<L.overscaledZ,{x:V,y:H}=L.canonical,$=V/F,ee=(V+1)/F,ge=H/F,De=(H+1)/F;return{minx:$,miny:ge,maxx:ee,maxy:De,t:A.dem.tree.raycastRoot($,ge,ee,De,c,g,C),tile:A}});T.sort((A,L)=>(null!==A.t?A.t:Number.MAX_VALUE)-(null!==L.t?L.t:Number.MAX_VALUE));for(const A of T){if(null==A.t)return null;const L=A.tile.dem.tree.raycast(A.minx,A.miny,A.maxx,A.maxy,c,g,C);if(null!=L)return L}return null}_createFBO(){const c=this.painter.context,g=c.gl,C=this.drapeBufferSize;c.activeTexture.set(g.TEXTURE0);const T=new p.Texture(c,{width:C[0],height:C[1],data:null},g.RGBA);T.bind(g.LINEAR,g.CLAMP_TO_EDGE);const A=c.createFramebuffer(C[0],C[1],!1);return A.colorAttachment.set(T.texture),A.depthAttachment=new Qe(c,A.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,C[0],C[1]),this._stencilRef=0,A.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):A.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&!c.extTextureFilterAnisotropicForceOff&&g.texParameterf(g.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:A,tex:T,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const g=this._style._layers[c],C=g.isHidden(this.painter.transform.zoom);return"custom"===g.type?!C&&g.shouldRedrape():!C&&g.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const C of this._style._getSources())if(C instanceof En){c=!0;break}if(!c)return;const g={};for(let C=0;C<this._style.order.length;++C){const T=this._style._layers[this._style.order[C]],A=this._style._getLayerSourceCache(T);if(A&&!g[A.id]&&!T.isHidden(this.painter.transform.zoom)&&"line"===T.type&&T.widthExpression()instanceof p.ZoomDependentExpression){g[A.id]=!0;for(const L of this.proxyCoords){const F=this.proxyToSource[L.key][A.id];if(F)for(const V of F)this._clearRenderCacheForTile(A.id,V)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const C in this._style._sourceCaches)if(this._style._sourceCaches[C]._source instanceof pn){c=!0;break}if(!c)return;const g={};for(let C=0;C<this._style.order.length;++C){const T=this._style._layers[this._style.order[C]],A=this._style._getLayerSourceCache(T);if(!A||g[A.id]||T.isHidden(this.painter.transform.zoom)||"raster"!==T.type)continue;const L=T.paint.get("raster-fade-duration");for(const F of this.proxyCoords){const V=this.proxyToSource[F.key][A.id];if(V)for(const H of V){const $=ac(A.getTile(H),A.findLoadedParent(H,0),A,this.painter.transform,L);(1!==$.opacity||0!==$.mix)&&this._clearRenderCacheForTile(A.id,H)}}}}_setupDrapedRenderBatches(){const c=this._style.order,g=c.length;if(0===g)return;const C=[];let T,A=0,L=this._style._layers[c[A]];for(;!this._style.isLayerDraped(L)&&L.isHidden(this.painter.transform.zoom)&&++A<g;)L=this._style._layers[c[A]];for(;A<g;++A){const F=this._style._layers[c[A]];F.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(F)?void 0===T&&(T=A):void 0!==T&&(C.push({start:T,end:A-1}),T=void 0))}void 0!==T&&C.push({start:T,end:A-1}),this._drapedRenderBatches=C}_setupRenderCache(c){const g=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,g.renderCache.length>g.renderCachePool.length){const L=Object.values(g.proxyCachedFBO);g.proxyCachedFBO={};for(let F=0;F<L.length;++F){const V=Object.values(L[F]);g.renderCachePool.push(...V)}}return}this._clearRasterLayersFromRenderCache();const C=this.proxyCoords,T=this._tilesDirty;for(let L=C.length-1;L>=0;L--){const F=C[L];if(g.getTileByID(F.key),void 0!==g.proxyCachedFBO[F.key]){const V=c[F.key],H=this.proxyToSource[F.key];let $=0;for(const ee in H){const ge=H[ee],De=V[ee];if(!De||De.length!==ge.length||ge.some((Re,Ce)=>Re!==De[Ce]||T[ee]&&T[ee].hasOwnProperty(Re.key))){$=-1;break}++$}for(const ee in g.proxyCachedFBO[F.key])g.renderCache[g.proxyCachedFBO[F.key][ee]].dirty=$<0||$!==Object.values(V).length}}const A=[...this._drapedRenderBatches];A.sort((L,F)=>F.end-F.start-(L.end-L.start));for(const L of A)for(const F of C){if(g.proxyCachedFBO[F.key])continue;let V=g.renderCachePool.pop();void 0===V&&g.renderCache.length<50&&(V=g.renderCache.length,g.renderCache.push(this._createFBO())),void 0!==V&&(g.proxyCachedFBO[F.key]={},g.proxyCachedFBO[F.key][L.start]=V,g.renderCache[V].dirty=!0)}this._tilesDirty={}}_setupStencil(c,g,C,T){if(!T||!this._sourceTilesOverlap[T.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const A=this.painter.context,L=A.gl;if(g.length<=1)return void(this._overlapStencilType=!1);let F;if(C.isTileClipped())F=g.length,this._overlapStencilMode.test={func:L.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(g[0].overscaledZ>g[g.length-1].overscaledZ))return void(this._overlapStencilType=!1);F=1,this._overlapStencilMode.test={func:L.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+F>255&&(A.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=F,this._overlapStencilMode.ref=this._stencilRef,C.isTileClipped()&&this._renderTileClippingMasks(g,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(c,g){const C=this.painter,T=this.painter.context,A=T.gl;C._tileClippingMaskIDs={},T.setColorMode(p.ColorMode.disabled),T.setDepthMode(p.DepthMode.disabled);const L=C.useProgram("clippingMask");for(const F of c){const V=C._tileClippingMaskIDs[F.key]=--g;L.draw(T,A.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:A.ALWAYS,mask:0},V,255,A.KEEP,A.KEEP,A.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,ni(F.projMatrix),"$clipping",C.tileExtentBuffer,C.quadTriangleIndexBuffer,C.tileExtentSegments)}}pointCoordinate(c){const g=this.painter.transform;if(c.x<0||c.x>g.width||c.y<0||c.y>g.height)return null;const C=[c.x,c.y,1,1];p.transformMat4$1(C,C,g.pixelMatrixInverse),p.scale$1(C,C,1/C[3]),C[0]/=g.worldSize,C[1]/=g.worldSize;const T=g._camera.position,A=p.mercatorZfromAltitude(1,g.center.lat),L=[T[0],T[1],T[2]/A,0],F=p.subtract([],C.slice(0,3),L);p.normalize(F,F);const V=this.raycast(L,F,this._exaggeration);return null!==V&&V?(p.scaleAndAdd(L,L,F,V),L[3]=L[2],L[2]*=A,L):null}drawDepth(){const c=this.painter,g=c.context,C=this.proxySourceCache,T=Math.ceil(c.width),A=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===T&&this._depthFBO.height===A||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const L=g.gl,F=g.createFramebuffer(T,A,!0);g.activeTexture.set(L.TEXTURE0);const V=new p.Texture(g,{width:T,height:A,data:null},L.RGBA);V.bind(L.NEAREST,L.CLAMP_TO_EDGE),F.colorAttachment.set(V.texture);const H=g.createRenderbuffer(g.gl.DEPTH_COMPONENT16,T,A);F.depthAttachment.set(H),this._depthFBO=F,this._depthTexture=V}g.bindFramebuffer.set(this._depthFBO.framebuffer),g.viewport.set([0,0,T,A]),function(L,F,V,H){if("globe"===L.transform.projection.name)return;const $=L.context,ee=$.gl;$.clear({depth:1});const ge=L.useProgram("terrainDepth"),De=new p.DepthMode(ee.LESS,p.DepthMode.ReadWrite,L.depthRangeFor3D);for(const Re of H){const Ce=V.getTile(Re),Le=Ch(Re.projMatrix,0);F.setupElevationDraw(Ce,ge),ge.draw($,ee.TRIANGLES,De,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,Le,"terrain_depth",F.gridBuffer,F.gridIndexBuffer,F.gridNoSkirtSegments)}}(c,this,C,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,g,C){if(c.getSource()instanceof Kr)return this._setupProxiedCoordsForImageSource(c,g,C);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const T=this.proxiedCoords[c.id]=[],A=this.proxyCoords;for(let F=0;F<A.length;F++){const V=A[F],H=this._findTileCoveringTileID(V,c);if(H){const $=this._createProxiedId(V,H,C[V.key]&&C[V.key][c.id]);T.push($),this.proxyToSource[V.key][c.id]=[$]}}let L=!1;for(let F=0;F<g.length;F++){const V=c.getTile(g[F]);if(!V||!V.hasData())continue;const H=this._findTileCoveringTileID(V.tileID,this.proxySourceCache);if(H&&H.tileID.canonical.z!==V.tileID.canonical.z){const $=this.proxyToSource[H.tileID.key][c.id],ee=this._createProxiedId(H.tileID,V,C[H.tileID.key]&&C[H.tileID.key][c.id]);$?$.splice($.length-1,0,ee):this.proxyToSource[H.tileID.key][c.id]=[ee],T.push(ee),L=!0}}this._sourceTilesOverlap[c.id]=L}_setupProxiedCoordsForImageSource(c,g,C){if(!c.getSource().loaded())return;const T=this.proxiedCoords[c.id]=[],A=this.proxyCoords,L=c.getSource(),F=new p.Point(L.tileID.x,L.tileID.y)._div(1<<L.tileID.z),V=L.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce(($,ee)=>($.min.x=Math.min($.min.x,ee.x-F.x),$.min.y=Math.min($.min.y,ee.y-F.y),$.max.x=Math.max($.max.x,ee.x-F.x),$.max.y=Math.max($.max.y,ee.y-F.y),$),{min:new p.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),H=($,ee)=>{const ge=$.wrap+$.canonical.x/(1<<$.canonical.z),De=$.canonical.y/(1<<$.canonical.z),Re=p.EXTENT/(1<<$.canonical.z),Ce=ee.wrap+ee.canonical.x/(1<<ee.canonical.z),Le=ee.canonical.y/(1<<ee.canonical.z);return ge+Re<Ce+V.min.x||ge>Ce+V.max.x||De+Re<Le+V.min.y||De>Le+V.max.y};for(let $=0;$<A.length;$++){const ee=A[$];for(let ge=0;ge<g.length;ge++){const De=c.getTile(g[ge]);if(!De||!De.hasData()||H(ee,De.tileID))continue;const Re=this._createProxiedId(ee,De,C[ee.key]&&C[ee.key][c.id]),Ce=this.proxyToSource[ee.key][c.id];Ce?Ce.push(Re):this.proxyToSource[ee.key][c.id]=[Re],T.push(Re)}}}_createProxiedId(c,g,C){let T=this.orthoMatrix;if(C){const A=C.find(L=>L.key===g.tileID.key);if(A)return A}if(g.tileID.key!==c.key){const A=c.canonical.z-g.tileID.canonical.z;let L,F,V;T=p.create();const H=g.tileID.wrap-c.wrap<<c.overscaledZ;A>0?(L=p.EXTENT>>A,F=L*((g.tileID.canonical.x<<A)-c.canonical.x+H),V=L*((g.tileID.canonical.y<<A)-c.canonical.y)):(L=p.EXTENT<<-A,F=p.EXTENT*(g.tileID.canonical.x-(c.canonical.x+H<<-A)),V=p.EXTENT*(g.tileID.canonical.y-(c.canonical.y<<-A))),p.ortho(T,0,L,0,L,0,1),p.translate(T,T,[F,V,0])}return new ia(g.tileID,c.key,T)}_findTileCoveringTileID(c,g){let C=g.getTile(c);if(C&&C.hasData())return C;const T=this._findCoveringTileCache[g.id],A=T[c.key];if(C=A?g.getTileByID(A):null,C&&C.hasData()||null===A)return C;let L=C?C.tileID:c,F=L.overscaledZ;const V=g.getSource().minzoom,H=[];if(!A){const ee=g.getSource().maxzoom;if(c.canonical.z>=ee){const ge=c.canonical.z-ee;g.getSource().reparseOverscaled?(F=Math.max(c.canonical.z+2,g.transform.tileZoom),L=new p.OverscaledTileID(F,c.wrap,ee,c.canonical.x>>ge,c.canonical.y>>ge)):0!==ge&&(F=ee,L=new p.OverscaledTileID(F,c.wrap,ee,c.canonical.x>>ge,c.canonical.y>>ge))}L.key!==c.key&&(H.push(L.key),C=g.getTile(L))}const $=ee=>{H.forEach(ge=>{T[ge]=ee}),H.length=0};for(F-=1;F>=V&&(!C||!C.hasData());F--){C&&$(C.tileID.key);const ee=L.calculateScaledKey(F);if(C=g.getTileByID(ee),C&&C.hasData())break;const ge=T[ee];if(null===ge)break;void 0===ge?H.push(ee):C=g.getTileByID(ge)}return $(C?C.tileID.key:null),C&&C.hasData()?C:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,g){let C=this._tilesDirty[c];C||(C=this._tilesDirty[c]={}),C[g.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const c=function(g){let C=0;const T=new p.StructArrayLayout2ui4,A=131;for(let L=1;L<129;L++){for(let F=1;F<129;F++)C=L*A+F,T.emplaceBack(C,C+1),T.emplaceBack(C,C+A),T.emplaceBack(C+1,C+A),128===L&&T.emplaceBack(C+A,C+A+1);T.emplaceBack(C+1,C+1+A)}return T}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(c),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,c.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Ci{static cacheKey(c,g,C,T){let A=`${g}${T?T.cacheKey:""}`;for(const L of C)c.usedDefines.includes(L)&&(A+=`/${L}`);return A}constructor(c,g,C,T,A,L){const F=c.gl;this.program=F.createProgram();const V=function(te){const Se=[];for(let Ue=0;Ue<te.length;Ue++){if(null===te[Ue])continue;const He=te[Ue].split(" ");Se.push(He.pop())}return Se}(C.staticAttributes),H=T?T.getBinderAttributes():[],$=V.concat(H);let ee=T?T.defines():[];ee=ee.concat(L.map(te=>`#define ${te}`));const ge=c.isWebGL2?"#version 300 es\n":"",De=ge+ee.concat(c.extStandardDerivatives&&0===ge.length?"#extension GL_OES_standard_derivatives : enable\n".concat(sc):sc,sc,Ha,oc.fragmentSource,fl.fragmentSource,C.fragmentSource).join("\n"),Re=ge+ee.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ha,oc.vertexSource,fl.vertexSource,ra.vertexSource,C.vertexSource).join("\n"),Ce=F.createShader(F.FRAGMENT_SHADER);if(F.isContextLost())return void(this.failedToCreate=!0);F.shaderSource(Ce,De),F.compileShader(Ce),F.attachShader(this.program,Ce);const Le=F.createShader(F.VERTEX_SHADER);if(F.isContextLost())this.failedToCreate=!0;else{F.shaderSource(Le,Re),F.compileShader(Le),F.attachShader(this.program,Le),this.attributes={},this.numAttributes=$.length;for(let te=0;te<this.numAttributes;te++)$[te]&&(F.bindAttribLocation(this.program,te,$[te]),this.attributes[$[te]]=te);F.linkProgram(this.program),F.deleteShader(Le),F.deleteShader(Ce),this.fixedUniforms=A(c),this.binderUniforms=T?T.getUniforms(c):[],L.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(te=c),u_dem_prev:new p.Uniform1i(te),u_dem_unpack:new p.Uniform4f(te),u_dem_tl:new p.Uniform2f(te),u_dem_scale:new p.Uniform1f(te),u_dem_tl_prev:new p.Uniform2f(te),u_dem_scale_prev:new p.Uniform1f(te),u_dem_size:new p.Uniform1f(te),u_dem_lerp:new p.Uniform1f(te),u_exaggeration:new p.Uniform1f(te),u_depth:new p.Uniform1i(te),u_depth_size_inv:new p.Uniform2f(te),u_meter_to_dem:new p.Uniform1f(te),u_label_plane_matrix_inv:new p.UniformMatrix4f(te)}),L.includes("GLOBE")&&(this.globeUniforms=(te=>({u_tile_tl_up:new p.Uniform3f(te),u_tile_tr_up:new p.Uniform3f(te),u_tile_br_up:new p.Uniform3f(te),u_tile_bl_up:new p.Uniform3f(te),u_tile_up_scale:new p.Uniform1f(te)}))(c)),L.includes("FOG")&&(this.fogUniforms=(te=>({u_fog_matrix:new p.UniformMatrix4f(te),u_fog_range:new p.Uniform2f(te),u_fog_color:new p.Uniform4f(te),u_fog_horizon_blend:new p.Uniform1f(te),u_fog_temporal_offset:new p.Uniform1f(te),u_frustum_tl:new p.Uniform3f(te),u_frustum_tr:new p.Uniform3f(te),u_frustum_br:new p.Uniform3f(te),u_frustum_bl:new p.Uniform3f(te),u_globe_pos:new p.Uniform3f(te),u_globe_radius:new p.Uniform1f(te),u_globe_transition:new p.Uniform1f(te),u_is_globe:new p.Uniform1i(te),u_viewport:new p.Uniform2f(te)}))(c))}var te}setTerrainUniformValues(c,g){if(!this.terrainUniforms)return;const C=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const T in g)C[T]&&C[T].set(this.program,T,g[T])}}setGlobeUniformValues(c,g){if(!this.globeUniforms)return;const C=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const T in g)C[T]&&C[T].set(this.program,T,g[T])}}setFogUniformValues(c,g){if(!this.fogUniforms)return;const C=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const T in g)C[T].set(this.program,T,g[T])}}draw(c,g,C,T,A,L,F,V,H,$,ee,ge,De,Re,Ce){const Le=c.gl;if(this.failedToCreate)return;c.program.set(this.program),c.setDepthMode(C),c.setStencilMode(T),c.setColorMode(A),c.setCullFace(L);for(const Se of Object.keys(this.fixedUniforms))this.fixedUniforms[Se].set(this.program,Se,F[Se]);Re&&Re.setUniforms(this.program,c,this.binderUniforms,ge,{zoom:De});const te={[Le.LINES]:2,[Le.TRIANGLES]:3,[Le.LINE_STRIP]:1}[g];for(const Se of ee.get()){const Ue=Se.vaos||(Se.vaos={});(Ue[V]||(Ue[V]=new Qc)).bind(c,this,H,Re?Re.getPaintVertexBuffers():[],$,Se.vertexOffset,Ce||[]),Le.drawElements(g,Se.primitiveLength*te,Le.UNSIGNED_SHORT,Se.primitiveOffset*te*2)}}}function jn(x,c){const g=Math.pow(2,c.tileID.overscaledZ),C=c.tileSize*Math.pow(2,x.transform.tileZoom)/g,T=C*(c.tileID.canonical.x+c.tileID.wrap*g),A=C*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_tile_units_to_pixels:1/it(c,1,x.transform.tileZoom),u_pixel_coord_upper:[T>>16,A>>16],u_pixel_coord_lower:[65535&T,65535&A]}}const wi=p.create(),Vn=(x,c,g,C,T,A,L,F,V,H,$)=>{const ee=c.style.light,ge=ee.properties.get("position"),De=[ge.x,ge.y,ge.z],Re=p.create$1();"viewport"===ee.properties.get("anchor")&&(p.fromRotation(Re,-c.transform.angle),p.transformMat3(De,De,Re));const Ce=ee.properties.get("color"),Le=c.transform,te={u_matrix:x,u_lightpos:De,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[Ce.r,Ce.g,Ce.b],u_vertical_gradient:+g,u_opacity:C,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:wi,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:T,u_edge_radius:A};return"globe"===Le.projection.name&&(te.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],te.u_zoom_transition=V,te.u_inv_rot_matrix=$,te.u_merc_center=H,te.u_up_dir=Le.projection.upVector(new p.CanonicalTileID(0,0,0),H[0]*p.EXTENT,H[1]*p.EXTENT),te.u_height_lift=F),te},Uu=(x,c,g,C,T,A,L,F,V,H,$,ee)=>{const ge=Vn(x,c,g,C,T,A,L,V,H,$,ee),De={u_height_factor:-Math.pow(2,L.overscaledZ)/F.tileSize/8};return p.extend(ge,jn(c,F),De)},ga=x=>({u_matrix:x}),Ys=(x,c,g)=>p.extend(ga(x),jn(c,g)),ma=(x,c)=>({u_matrix:x,u_world:c}),og=(x,c,g,C)=>p.extend(Ys(x,c,g),{u_world:C}),ep=p.create(),_a=(x,c,g,C,T,A)=>{const L=x.transform,F="globe"===L.projection.name;let V;if("map"===A.paint.get("circle-pitch-alignment"))if(F){const $=p.globePixelsToTileUnits(L.zoom,c.canonical)*L._pixelsPerMercatorPixel;V=Float32Array.from([$,0,0,$])}else V=L.calculatePixelsToTileUnitsMatrix(g);else V=new Float32Array([L.pixelsToGLUnits[0],0,0,L.pixelsToGLUnits[1]]);const H={u_camera_to_center_distance:L.cameraToCenterDistance,u_matrix:x.translatePosMatrix(c.projMatrix,g,A.paint.get("circle-translate"),A.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:V,u_inv_rot_matrix:ep,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(F){H.u_inv_rot_matrix=C,H.u_merc_center=T,H.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],H.u_zoom_transition=p.globeToMercatorTransition(L.zoom);const $=T[0]*p.EXTENT,ee=T[1]*p.EXTENT;H.u_up_dir=L.projection.upVector(new p.CanonicalTileID(0,0,0),$,ee)}return H},Ra=x=>{const c=[];return"map"===x.paint.get("circle-pitch-alignment")&&c.push("PITCH_WITH_MAP"),"map"===x.paint.get("circle-pitch-scale")&&c.push("SCALE_WITH_MAP"),c},oa=(x,c,g,C)=>{const T=p.EXTENT/g.tileSize;return{u_matrix:x,u_camera_to_center_distance:c.getCameraToCenterDistance(C),u_extrude_scale:[c.pixelsToGLUnits[0]/T,c.pixelsToGLUnits[1]/T]}},Wo=(x,c,g=1)=>({u_matrix:x,u_color:c,u_overlay:0,u_overlay_scale:g}),oi=p.create(),pl=(x,c,g,C,T,A,L)=>{const F=x.transform,V="globe"===F.projection.name,H=V?p.globePixelsToTileUnits(F.zoom,c.canonical)*F._pixelsPerMercatorPixel:it(g,1,A),$={u_matrix:c.projMatrix,u_extrude_scale:H,u_intensity:L,u_inv_rot_matrix:oi,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(V){$.u_inv_rot_matrix=C,$.u_merc_center=T,$.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],$.u_zoom_transition=p.globeToMercatorTransition(F.zoom);const ee=T[0]*p.EXTENT,ge=T[1]*p.EXTENT;$.u_up_dir=F.projection.upVector(new p.CanonicalTileID(0,0,0),ee,ge)}return $},ju=(x,c,g,C,T,A,L)=>{const F=x.transform,V=F.calculatePixelsToTileUnitsMatrix(c);return{u_matrix:hu(x,c,g,C),u_pixels_to_tile_units:V,u_device_pixel_ratio:A,u_units_to_pixels:[1/F.pixelsToGLUnits[0],1/F.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:T,u_texsize:du(g)?c.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:rs(c,x.transform),u_alpha_discard_threshold:0,u_trim_offset:L}},il=(x,c,g,C,T)=>{const A=x.transform;return{u_matrix:hu(x,c,g,C),u_texsize:c.imageAtlasTexture.size,u_pixels_to_tile_units:A.calculatePixelsToTileUnitsMatrix(c),u_device_pixel_ratio:T,u_image:0,u_tile_units_to_pixels:rs(c,A),u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function rs(x,c){return 1/it(x,1,c.tileZoom)}function hu(x,c,g,C){return x.translatePosMatrix(C||c.tileID.projMatrix,c,g.paint.get("line-translate"),g.paint.get("line-translate-anchor"))}function du(x){const c=x.paint.get("line-dasharray").value;return c.value||"constant"!==c.kind}const Ks=(x,c,g,C,T,A)=>{return{u_matrix:x,u_tl_parent:c,u_scale_parent:g,u_fade_t:C.mix,u_opacity:C.opacity*T.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:T.paint.get("raster-brightness-min"),u_brightness_high:T.paint.get("raster-brightness-max"),u_saturation_factor:(F=T.paint.get("raster-saturation"),F>0?1-1/(1.001-F):-F),u_contrast_factor:(L=T.paint.get("raster-contrast"),L>0?1/(1-L):1+L),u_spin_weights:ya(T.paint.get("raster-hue-rotate")),u_perspective_transform:A};var L,F};function ya(x){x*=Math.PI/180;const c=Math.sin(x),g=Math.cos(x);return[(2*g+1)/3,(-Math.sqrt(3)*c-g+1)/3,(Math.sqrt(3)*c-g+1)/3]}const qa=p.create(),ed=(x,c,g,C,T,A,L,F,V,H,$,ee,ge,De,Re,Ce)=>{const Le=T.transform,te={u_is_size_zoom_constant:+("constant"===x||"source"===x),u_is_size_feature_constant:+("constant"===x||"camera"===x),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:Le.cameraToCenterDistance,u_rotate_symbol:+g,u_aspect_ratio:Le.width/Le.height,u_fade_change:T.options.fadeDuration?T.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:L,u_coord_matrix:F,u_is_text:+V,u_pitch_with_map:+C,u_texsize:H,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:qa,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:qa,u_up_vector:[0,-1,0]};return"globe"===Ce.name&&(te.u_tile_id=[$.canonical.x,$.canonical.y,1<<$.canonical.z],te.u_zoom_transition=ee,te.u_inv_rot_matrix=De,te.u_merc_center=ge,te.u_camera_forward=Le._camera.forward(),te.u_ecef_origin=p.globeECEFOrigin(Le.globeMatrix,$.toUnwrapped()),te.u_tile_matrix=Float32Array.from(Le.globeMatrix),te.u_up_vector=Re),te},Js=(x,c,g,C,T,A,L,F,V,H,$,ee,ge,De,Re,Ce,Le)=>p.extend(ed(x,c,g,C,T,A,L,F,V,H,ee,ge,De,Re,Ce,Le),{u_gamma_scale:C?T.transform.cameraToCenterDistance*Math.cos(T.terrain?0:T.transform._pitch):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+$}),eh=(x,c,g,C,T,A,L,F,V,H,$,ee,ge,De,Re,Ce)=>p.extend(Js(x,c,g,C,T,A,L,F,!0,V,!0,$,ee,ge,De,Re,Ce),{u_texsize_icon:H,u_texture_icon:1}),Ic=(x,c,g)=>({u_matrix:x,u_opacity:c,u_color:g}),th=(x,c,g,C,T)=>p.extend(function(A,L,F){const V=L.imageManager.getPattern(A.toString()),{width:H,height:$}=L.imageManager.getPixelSize(),ee=Math.pow(2,F.tileID.overscaledZ),ge=F.tileSize*Math.pow(2,L.transform.tileZoom)/ee,De=ge*(F.tileID.canonical.x+F.tileID.wrap*ee),Re=ge*F.tileID.canonical.y;return{u_image:0,u_pattern_tl:V.tl,u_pattern_br:V.br,u_texsize:[H,$],u_pattern_size:V.displaySize,u_tile_units_to_pixels:1/it(F,1,L.transform.tileZoom),u_pixel_coord_upper:[De>>16,Re>>16],u_pixel_coord_lower:[65535&De,65535&Re]}}(C,g,T),{u_matrix:x,u_opacity:c}),Fd={fillExtrusion:x=>({u_matrix:new p.UniformMatrix4f(x),u_lightpos:new p.Uniform3f(x),u_lightintensity:new p.Uniform1f(x),u_lightcolor:new p.Uniform3f(x),u_vertical_gradient:new p.Uniform1f(x),u_opacity:new p.Uniform1f(x),u_edge_radius:new p.Uniform1f(x),u_ao:new p.Uniform2f(x),u_tile_id:new p.Uniform3f(x),u_zoom_transition:new p.Uniform1f(x),u_inv_rot_matrix:new p.UniformMatrix4f(x),u_merc_center:new p.Uniform2f(x),u_up_dir:new p.Uniform3f(x),u_height_lift:new p.Uniform1f(x)}),fillExtrusionPattern:x=>({u_matrix:new p.UniformMatrix4f(x),u_lightpos:new p.Uniform3f(x),u_lightintensity:new p.Uniform1f(x),u_lightcolor:new p.Uniform3f(x),u_vertical_gradient:new p.Uniform1f(x),u_height_factor:new p.Uniform1f(x),u_edge_radius:new p.Uniform1f(x),u_ao:new p.Uniform2f(x),u_tile_id:new p.Uniform3f(x),u_zoom_transition:new p.Uniform1f(x),u_inv_rot_matrix:new p.UniformMatrix4f(x),u_merc_center:new p.Uniform2f(x),u_up_dir:new p.Uniform3f(x),u_height_lift:new p.Uniform1f(x),u_image:new p.Uniform1i(x),u_texsize:new p.Uniform2f(x),u_pixel_coord_upper:new p.Uniform2f(x),u_pixel_coord_lower:new p.Uniform2f(x),u_tile_units_to_pixels:new p.Uniform1f(x),u_opacity:new p.Uniform1f(x)}),fill:x=>({u_matrix:new p.UniformMatrix4f(x)}),fillPattern:x=>({u_matrix:new p.UniformMatrix4f(x),u_image:new p.Uniform1i(x),u_texsize:new p.Uniform2f(x),u_pixel_coord_upper:new p.Uniform2f(x),u_pixel_coord_lower:new p.Uniform2f(x),u_tile_units_to_pixels:new p.Uniform1f(x)}),fillOutline:x=>({u_matrix:new p.UniformMatrix4f(x),u_world:new p.Uniform2f(x)}),fillOutlinePattern:x=>({u_matrix:new p.UniformMatrix4f(x),u_world:new p.Uniform2f(x),u_image:new p.Uniform1i(x),u_texsize:new p.Uniform2f(x),u_pixel_coord_upper:new p.Uniform2f(x),u_pixel_coord_lower:new p.Uniform2f(x),u_tile_units_to_pixels:new p.Uniform1f(x)}),circle:x=>({u_camera_to_center_distance:new p.Uniform1f(x),u_extrude_scale:new p.UniformMatrix2f(x),u_device_pixel_ratio:new p.Uniform1f(x),u_matrix:new p.UniformMatrix4f(x),u_inv_rot_matrix:new p.UniformMatrix4f(x),u_merc_center:new p.Uniform2f(x),u_tile_id:new p.Uniform3f(x),u_zoom_transition:new p.Uniform1f(x),u_up_dir:new p.Uniform3f(x)}),collisionBox:x=>({u_matrix:new p.UniformMatrix4f(x),u_camera_to_center_distance:new p.Uniform1f(x),u_extrude_scale:new p.Uniform2f(x)}),collisionCircle:x=>({u_matrix:new p.UniformMatrix4f(x),u_inv_matrix:new p.UniformMatrix4f(x),u_camera_to_center_distance:new p.Uniform1f(x),u_viewport_size:new p.Uniform2f(x)}),debug:x=>({u_color:new p.UniformColor(x),u_matrix:new p.UniformMatrix4f(x),u_overlay:new p.Uniform1i(x),u_overlay_scale:new p.Uniform1f(x)}),clippingMask:x=>({u_matrix:new p.UniformMatrix4f(x)}),heatmap:x=>({u_extrude_scale:new p.Uniform1f(x),u_intensity:new p.Uniform1f(x),u_matrix:new p.UniformMatrix4f(x),u_inv_rot_matrix:new p.UniformMatrix4f(x),u_merc_center:new p.Uniform2f(x),u_tile_id:new p.Uniform3f(x),u_zoom_transition:new p.Uniform1f(x),u_up_dir:new p.Uniform3f(x)}),heatmapTexture:x=>({u_image:new p.Uniform1i(x),u_color_ramp:new p.Uniform1i(x),u_opacity:new p.Uniform1f(x)}),hillshade:x=>({u_matrix:new p.UniformMatrix4f(x),u_image:new p.Uniform1i(x),u_latrange:new p.Uniform2f(x),u_light:new p.Uniform2f(x),u_shadow:new p.UniformColor(x),u_highlight:new p.UniformColor(x),u_accent:new p.UniformColor(x)}),hillshadePrepare:x=>({u_matrix:new p.UniformMatrix4f(x),u_image:new p.Uniform1i(x),u_dimension:new p.Uniform2f(x),u_zoom:new p.Uniform1f(x),u_unpack:new p.Uniform4f(x)}),line:x=>({u_matrix:new p.UniformMatrix4f(x),u_pixels_to_tile_units:new p.UniformMatrix2f(x),u_device_pixel_ratio:new p.Uniform1f(x),u_units_to_pixels:new p.Uniform2f(x),u_dash_image:new p.Uniform1i(x),u_gradient_image:new p.Uniform1i(x),u_image_height:new p.Uniform1f(x),u_texsize:new p.Uniform2f(x),u_tile_units_to_pixels:new p.Uniform1f(x),u_alpha_discard_threshold:new p.Uniform1f(x),u_trim_offset:new p.Uniform2f(x)}),linePattern:x=>({u_matrix:new p.UniformMatrix4f(x),u_texsize:new p.Uniform2f(x),u_pixels_to_tile_units:new p.UniformMatrix2f(x),u_device_pixel_ratio:new p.Uniform1f(x),u_image:new p.Uniform1i(x),u_units_to_pixels:new p.Uniform2f(x),u_tile_units_to_pixels:new p.Uniform1f(x),u_alpha_discard_threshold:new p.Uniform1f(x)}),raster:x=>({u_matrix:new p.UniformMatrix4f(x),u_tl_parent:new p.Uniform2f(x),u_scale_parent:new p.Uniform1f(x),u_fade_t:new p.Uniform1f(x),u_opacity:new p.Uniform1f(x),u_image0:new p.Uniform1i(x),u_image1:new p.Uniform1i(x),u_brightness_low:new p.Uniform1f(x),u_brightness_high:new p.Uniform1f(x),u_saturation_factor:new p.Uniform1f(x),u_contrast_factor:new p.Uniform1f(x),u_spin_weights:new p.Uniform3f(x),u_perspective_transform:new p.Uniform2f(x)}),symbolIcon:x=>({u_is_size_zoom_constant:new p.Uniform1i(x),u_is_size_feature_constant:new p.Uniform1i(x),u_size_t:new p.Uniform1f(x),u_size:new p.Uniform1f(x),u_camera_to_center_distance:new p.Uniform1f(x),u_rotate_symbol:new p.Uniform1i(x),u_aspect_ratio:new p.Uniform1f(x),u_fade_change:new p.Uniform1f(x),u_matrix:new p.UniformMatrix4f(x),u_label_plane_matrix:new p.UniformMatrix4f(x),u_coord_matrix:new p.UniformMatrix4f(x),u_is_text:new p.Uniform1i(x),u_pitch_with_map:new p.Uniform1i(x),u_texsize:new p.Uniform2f(x),u_tile_id:new p.Uniform3f(x),u_zoom_transition:new p.Uniform1f(x),u_inv_rot_matrix:new p.UniformMatrix4f(x),u_merc_center:new p.Uniform2f(x),u_camera_forward:new p.Uniform3f(x),u_tile_matrix:new p.UniformMatrix4f(x),u_up_vector:new p.Uniform3f(x),u_ecef_origin:new p.Uniform3f(x),u_texture:new p.Uniform1i(x)}),symbolSDF:x=>({u_is_size_zoom_constant:new p.Uniform1i(x),u_is_size_feature_constant:new p.Uniform1i(x),u_size_t:new p.Uniform1f(x),u_size:new p.Uniform1f(x),u_camera_to_center_distance:new p.Uniform1f(x),u_rotate_symbol:new p.Uniform1i(x),u_aspect_ratio:new p.Uniform1f(x),u_fade_change:new p.Uniform1f(x),u_matrix:new p.UniformMatrix4f(x),u_label_plane_matrix:new p.UniformMatrix4f(x),u_coord_matrix:new p.UniformMatrix4f(x),u_is_text:new p.Uniform1i(x),u_pitch_with_map:new p.Uniform1i(x),u_texsize:new p.Uniform2f(x),u_texture:new p.Uniform1i(x),u_gamma_scale:new p.Uniform1f(x),u_device_pixel_ratio:new p.Uniform1f(x),u_tile_id:new p.Uniform3f(x),u_zoom_transition:new p.Uniform1f(x),u_inv_rot_matrix:new p.UniformMatrix4f(x),u_merc_center:new p.Uniform2f(x),u_camera_forward:new p.Uniform3f(x),u_tile_matrix:new p.UniformMatrix4f(x),u_up_vector:new p.Uniform3f(x),u_ecef_origin:new p.Uniform3f(x),u_is_halo:new p.Uniform1i(x)}),symbolTextAndIcon:x=>({u_is_size_zoom_constant:new p.Uniform1i(x),u_is_size_feature_constant:new p.Uniform1i(x),u_size_t:new p.Uniform1f(x),u_size:new p.Uniform1f(x),u_camera_to_center_distance:new p.Uniform1f(x),u_rotate_symbol:new p.Uniform1i(x),u_aspect_ratio:new p.Uniform1f(x),u_fade_change:new p.Uniform1f(x),u_matrix:new p.UniformMatrix4f(x),u_label_plane_matrix:new p.UniformMatrix4f(x),u_coord_matrix:new p.UniformMatrix4f(x),u_is_text:new p.Uniform1i(x),u_pitch_with_map:new p.Uniform1i(x),u_texsize:new p.Uniform2f(x),u_texsize_icon:new p.Uniform2f(x),u_texture:new p.Uniform1i(x),u_texture_icon:new p.Uniform1i(x),u_gamma_scale:new p.Uniform1f(x),u_device_pixel_ratio:new p.Uniform1f(x),u_is_halo:new p.Uniform1i(x)}),background:x=>({u_matrix:new p.UniformMatrix4f(x),u_opacity:new p.Uniform1f(x),u_color:new p.UniformColor(x)}),backgroundPattern:x=>({u_matrix:new p.UniformMatrix4f(x),u_opacity:new p.Uniform1f(x),u_image:new p.Uniform1i(x),u_pattern_tl:new p.Uniform2f(x),u_pattern_br:new p.Uniform2f(x),u_texsize:new p.Uniform2f(x),u_pattern_size:new p.Uniform2f(x),u_pixel_coord_upper:new p.Uniform2f(x),u_pixel_coord_lower:new p.Uniform2f(x),u_tile_units_to_pixels:new p.Uniform1f(x)}),terrainRaster:Eo,terrainDepth:Eo,skybox:x=>({u_matrix:new p.UniformMatrix4f(x),u_sun_direction:new p.Uniform3f(x),u_cubemap:new p.Uniform1i(x),u_opacity:new p.Uniform1f(x),u_temporal_offset:new p.Uniform1f(x)}),skyboxGradient:x=>({u_matrix:new p.UniformMatrix4f(x),u_color_ramp:new p.Uniform1i(x),u_center_direction:new p.Uniform3f(x),u_radius:new p.Uniform1f(x),u_opacity:new p.Uniform1f(x),u_temporal_offset:new p.Uniform1f(x)}),skyboxCapture:x=>({u_matrix_3f:new p.UniformMatrix3f(x),u_sun_direction:new p.Uniform3f(x),u_sun_intensity:new p.Uniform1f(x),u_color_tint_r:new p.Uniform4f(x),u_color_tint_m:new p.Uniform4f(x),u_luminance:new p.Uniform1f(x)}),globeRaster:x=>({u_proj_matrix:new p.UniformMatrix4f(x),u_globe_matrix:new p.UniformMatrix4f(x),u_normalize_matrix:new p.UniformMatrix4f(x),u_merc_matrix:new p.UniformMatrix4f(x),u_zoom_transition:new p.Uniform1f(x),u_merc_center:new p.Uniform2f(x),u_image0:new p.Uniform1i(x),u_grid_matrix:new p.UniformMatrix3f(x),u_skirt_height:new p.Uniform1f(x),u_frustum_tl:new p.Uniform3f(x),u_frustum_tr:new p.Uniform3f(x),u_frustum_br:new p.Uniform3f(x),u_frustum_bl:new p.Uniform3f(x),u_globe_pos:new p.Uniform3f(x),u_globe_radius:new p.Uniform1f(x),u_viewport:new p.Uniform2f(x)}),globeAtmosphere:x=>({u_frustum_tl:new p.Uniform3f(x),u_frustum_tr:new p.Uniform3f(x),u_frustum_br:new p.Uniform3f(x),u_frustum_bl:new p.Uniform3f(x),u_horizon:new p.Uniform1f(x),u_transition:new p.Uniform1f(x),u_fadeout_range:new p.Uniform1f(x),u_color:new p.Uniform4f(x),u_high_color:new p.Uniform4f(x),u_space_color:new p.Uniform4f(x),u_star_intensity:new p.Uniform1f(x),u_star_density:new p.Uniform1f(x),u_star_size:new p.Uniform1f(x),u_temporal_offset:new p.Uniform1f(x),u_horizon_angle:new p.Uniform1f(x),u_rotation_matrix:new p.UniformMatrix4f(x)})};let Sh;function Mu(x,c,g,C,T,A,L){const F=x.context,V=F.gl,H=x.transform,$=x.useProgram("collisionBox"),ee=[];let ge=0,De=0;for(let He=0;He<C.length;He++){const lt=C[He],ut=c.getTile(lt),ct=ut.getBucket(g);if(!ct)continue;const yt=xi(lt,ct,H);let xt=yt;0===T[0]&&0===T[1]||(xt=x.translatePosMatrix(yt,ut,T,A));const Bt=L?ct.textCollisionBox:ct.iconCollisionBox,Qt=ct.collisionCircleArray;if(Qt.length>0){const Nt=p.create(),Jt=xt;p.mul(Nt,ct.placementInvProjMatrix,H.glCoordMatrix),p.mul(Nt,Nt,ct.placementViewportMatrix),ee.push({circleArray:Qt,circleOffset:De,transform:Jt,invTransform:Nt,projection:ct.getProjection()}),ge+=Qt.length/4,De=ge}Bt&&(x.terrain&&x.terrain.setupElevationDraw(ut,$),$.draw(F,V.LINES,p.DepthMode.disabled,p.StencilMode.disabled,x.colorModeForRenderPass(),p.CullFaceMode.disabled,oa(xt,H,ut,ct.getProjection()),g.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Bt.segments,null,H.zoom,null,[Bt.collisionVertexBuffer,Bt.collisionVertexBufferExt]))}if(!L||!ee.length)return;const Re=x.useProgram("collisionCircle"),Ce=new p.StructArrayLayout2f1f2i16;Ce.resize(4*ge),Ce._trim();let Le=0;for(const He of ee)for(let lt=0;lt<He.circleArray.length/4;lt++){const ut=4*lt,ct=He.circleArray[ut+0],yt=He.circleArray[ut+1],xt=He.circleArray[ut+2],Bt=He.circleArray[ut+3];Ce.emplace(Le++,ct,yt,xt,Bt,0),Ce.emplace(Le++,ct,yt,xt,Bt,1),Ce.emplace(Le++,ct,yt,xt,Bt,2),Ce.emplace(Le++,ct,yt,xt,Bt,3)}(!Sh||Sh.length<2*ge)&&(Sh=function(He){const lt=2*He,ut=new p.StructArrayLayout3ui6;ut.resize(lt),ut._trim();for(let ct=0;ct<lt;ct++){const yt=6*ct;ut.uint16[yt+0]=4*ct+0,ut.uint16[yt+1]=4*ct+1,ut.uint16[yt+2]=4*ct+2,ut.uint16[yt+3]=4*ct+2,ut.uint16[yt+4]=4*ct+3,ut.uint16[yt+5]=4*ct+0}return ut}(ge));const te=F.createIndexBuffer(Sh,!0),Se=F.createVertexBuffer(Ce,p.collisionCircleLayout.members,!0);for(const He of ee){const lt={u_matrix:He.transform,u_inv_matrix:He.invTransform,u_camera_to_center_distance:(Ue=H).getCameraToCenterDistance(He.projection),u_viewport_size:[Ue.width,Ue.height]};Re.draw(F,V.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,x.colorModeForRenderPass(),p.CullFaceMode.disabled,lt,g.id,Se,te,p.SegmentVector.simpleSegment(0,2*He.circleOffset,He.circleArray.length,He.circleArray.length/2),null,H.zoom)}var Ue;Se.destroy(),te.destroy()}const fu=p.create();function vo({width:x,height:c,anchor:g,textOffset:C,textScale:T},A){const{horizontalAlign:L,verticalAlign:F}=p.getAnchorAlignment(g),V=-(L-.5)*x,H=-(F-.5)*c,$=p.evaluateVariableOffset(g,C);return new p.Point((V/T+$[0])*A,(H/T+$[1])*A)}function Dh(x,c,g,C,T,A,L,F,V,H,$){const ee=x.text.placedSymbolArray,ge=x.text.dynamicLayoutVertexArray,De=x.icon.dynamicLayoutVertexArray,Re={},Ce=x.getProjection(),Le=Io(F,Ce,A),te=A.elevation,Se=Ce.upVectorScale(F.canonical,A.center.lat,A.worldSize).metersToTile;ge.clear();for(let Ue=0;Ue<ee.length;Ue++){const He=ee.get(Ue),{tileAnchorX:lt,tileAnchorY:ut,numGlyphs:ct}=He,yt=He.hidden||!He.crossTileID||x.allowVerticalPlacement&&!He.placedOrientation?null:C[He.crossTileID];if(yt){let xt=0,Bt=0,Qt=0;if(te){const xn=te?te.getAtTileOffset(F,lt,ut):0,[cr,br,Hn]=Ce.upVector(F.canonical,lt,ut);xt=xn*cr*Se,Bt=xn*br*Se,Qt=xn*Hn*Se}let[Nt,Jt,Pt,mn]=Bs(He.projectedAnchorX+xt,He.projectedAnchorY+Bt,He.projectedAnchorZ+Qt,g?Le:L);const Ft=ts(A.getCameraToCenterDistance(Ce),mn);let Yt=T.evaluateSizeForFeature(x.textSizeData,H,He)*Ft/p.ONE_EM;g&&(Yt*=x.tilePixelRatio/V);const an=vo(yt,Yt);g?(({x:Nt,y:Jt,z:Pt}=Ce.projectTilePoint(lt+an.x,ut+an.y,F.canonical)),[Nt,Jt,Pt]=Bs(Nt+xt,Jt+Bt,Pt+Qt,L)):(c&&an._rotate(-A.angle),Nt+=an.x,Jt+=an.y,Pt=0);const ln=x.allowVerticalPlacement&&He.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let xn=0;xn<ct;xn++)p.addDynamicAttributes(ge,Nt,Jt,Pt,ln);$&&He.associatedIconIndex>=0&&(Re[He.associatedIconIndex]={x:Nt,y:Jt,z:Pt,angle:ln})}else ur(ct,ge)}if($){De.clear();const Ue=x.icon.placedSymbolArray;for(let He=0;He<Ue.length;He++){const lt=Ue.get(He),{numGlyphs:ut}=lt,ct=Re[He];if(lt.hidden||!ct)ur(ut,De);else{const{x:yt,y:xt,z:Bt,angle:Qt}=ct;for(let Nt=0;Nt<ut;Nt++)p.addDynamicAttributes(De,yt,xt,Bt,Qt)}}x.icon.dynamicLayoutVertexBuffer.updateData(De)}x.text.dynamicLayoutVertexBuffer.updateData(ge)}function Qs(x,c,g){return g.iconsInText&&c?"symbolTextAndIcon":x?"symbolSDF":"symbolIcon"}function pu(x,c,g,C,T,A,L,F,V,H,$,ee){const ge=x.context,De=ge.gl,Re=x.transform,Ce="map"===F,Le="map"===V,te=Ce&&"point"!==g.layout.get("symbol-placement"),Se=Ce&&!Le&&!te,Ue=void 0!==g.layout.get("symbol-sort-key").constantOr(1);let He=!1;const lt=x.depthModeForSublayer(0,p.DepthMode.ReadOnly),ut=[p.mercatorXfromLng(Re.center.lng),p.mercatorYfromLat(Re.center.lat)],ct=g.layout.get("text-variable-anchor"),yt="globe"===Re.projection.name,xt=[],Bt=[0,-1,0];let Qt=Bt;!yt&&!Re.mercatorFromTransition||Ce||(Qt=function(Nt){const Jt=Nt._camera.getWorldToCamera(Nt.worldSize,1),Pt=p.multiply([],Jt,Nt.globeMatrix);p.invert(Pt,Pt);const mn=[0,0,0],Ft=[0,1,0,0];return p.transformMat4$1(Ft,Ft,Pt),mn[0]=Ft[0],mn[1]=Ft[1],mn[2]=Ft[2],p.normalize(mn,mn),mn}(Re));for(const Nt of C){const Jt=c.getTile(Nt),Pt=Jt.getBucket(g);if(!Pt||"mercator"===Pt.projection.name&&yt)continue;const mn=T?Pt.text:Pt.icon;if(!mn||Pt.fullyClipped||!mn.segments.get().length)continue;const Ft=mn.programConfigurations.get(g.id),Yt=T||Pt.sdfIcons,an=T?Pt.textSizeData:Pt.iconSizeData,ln=Le||0!==Re.pitch,xn=p.evaluateSizeForZoom(an,Re.zoom);let cr,br,Hn,vr,ci=[0,0],li=null;if(T)br=Jt.glyphAtlasTexture,Hn=De.LINEAR,cr=Jt.glyphAtlasTexture.size,Pt.iconsInText&&(ci=Jt.imageAtlasTexture.size,li=Jt.imageAtlasTexture,vr=ln||x.options.rotating||x.options.zooming||"composite"===an.kind||"camera"===an.kind?De.LINEAR:De.NEAREST);else{const ks=1!==g.layout.get("icon-size").constantOr(0)||Pt.iconsNeedLinear;br=Jt.imageAtlasTexture,Hn=Yt||x.options.rotating||x.options.zooming||ks||ln?De.LINEAR:De.NEAREST,cr=Jt.imageAtlasTexture.size}const nr="globe"===Pt.projection.name,So=nr?Qt:Bt,qn=nr?p.globeToMercatorTransition(Re.zoom):0,Lo=Io(Nt,Pt.getProjection(),Re),Xo=Re.calculatePixelsToTileUnitsMatrix(Jt),Nl=Wt(Lo,Jt.tileID.canonical,Le,Ce,Re,Pt.getProjection(),Xo),al=x.terrain&&Le&&te?p.invert(p.create(),Nl):fu,Wu=gs(Lo,Jt.tileID.canonical,Le,Ce,Re,Pt.getProjection(),Xo),pc=ct&&Pt.hasTextData(),ko="none"!==g.layout.get("icon-text-fit")&&pc&&Pt.hasIconData();if(te){const ks=Re.elevation,rh=ks?ks.getAtTileOffsetFunc(Nt,Re.center.lat,Re.worldSize,Pt.getProjection()):null,gc=Vl(Lo,Jt.tileID.canonical,Le,Ce,Re,Pt.getProjection(),Xo);Ul(Pt,Lo,x,T,gc,Wu,Le,H,rh,Nt)}const $o=te||T&&ct||ko,ji=x.translatePosMatrix(Lo,Jt,A,L),Ca=$o?fu:Nl,Jl=x.translatePosMatrix(Wu,Jt,A,L,!0),ys=Pt.getProjection().createInversionMatrix(Re,Nt.canonical),cn=[];x.terrainRenderModeElevated()&&Le&&cn.push("PITCH_WITH_MAP_TERRAIN"),nr&&cn.push("PROJECTION_GLOBE_VIEW"),$o&&cn.push("PROJECTED_POS_ON_VIEWPORT");const Li=Yt&&0!==g.paint.get(T?"text-halo-width":"icon-halo-width").constantOr(1);let ll;ll=Yt?Pt.iconsInText?eh(an.kind,xn,Se,Le,x,ji,Ca,Jl,cr,ci,Nt,qn,ut,ys,So,Pt.getProjection()):Js(an.kind,xn,Se,Le,x,ji,Ca,Jl,T,cr,!0,Nt,qn,ut,ys,So,Pt.getProjection()):ed(an.kind,xn,Se,Le,x,ji,Ca,Jl,T,cr,Nt,qn,ut,ys,So,Pt.getProjection());const Pl={program:x.useProgram(Qs(Yt,T,Pt),Ft,cn),buffers:mn,uniformValues:ll,atlasTexture:br,atlasTextureIcon:li,atlasInterpolation:Hn,atlasInterpolationIcon:vr,isSDF:Yt,hasHalo:Li,tile:Jt,labelPlaneMatrixInv:al};if(Ue&&Pt.canOverlap){He=!0;const ks=mn.segments.get();for(const rh of ks)xt.push({segments:new p.SegmentVector([rh]),sortKey:rh.sortKey,state:Pl})}else xt.push({segments:mn.segments,sortKey:0,state:Pl})}He&&xt.sort((Nt,Jt)=>Nt.sortKey-Jt.sortKey);for(const Nt of xt){const Jt=Nt.state;if(x.terrain&&x.terrain.setupElevationDraw(Jt.tile,Jt.program,{useDepthForOcclusion:!yt,labelPlaneMatrixInv:Jt.labelPlaneMatrixInv}),ge.activeTexture.set(De.TEXTURE0),Jt.atlasTexture.bind(Jt.atlasInterpolation,De.CLAMP_TO_EDGE),Jt.atlasTextureIcon&&(ge.activeTexture.set(De.TEXTURE1),Jt.atlasTextureIcon&&Jt.atlasTextureIcon.bind(Jt.atlasInterpolationIcon,De.CLAMP_TO_EDGE)),Jt.isSDF){const Pt=Jt.uniformValues;Jt.hasHalo&&(Pt.u_is_halo=1,gu(Jt.buffers,Nt.segments,g,x,Jt.program,lt,$,ee,Pt)),Pt.u_is_halo=0}gu(Jt.buffers,Nt.segments,g,x,Jt.program,lt,$,ee,Jt.uniformValues)}}function gu(x,c,g,C,T,A,L,F,V){const H=C.context,$=[x.dynamicLayoutVertexBuffer,x.opacityVertexBuffer,x.globeExtVertexBuffer];T.draw(H,H.gl.TRIANGLES,A,L,F,p.CullFaceMode.disabled,V,g.id,x.layoutVertexBuffer,x.indexBuffer,c,g.paint,C.transform.zoom,x.programConfigurations.get(g.id),$)}function Bd(x,c,g,C,T,A,L){const F=x.context.gl,V=g.paint.get("fill-pattern"),H=V&&V.constantOr(1);let $,ee,ge,De,Re;L?(ee=H&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=F.LINES):(ee=H?"fillPattern":"fill",$=F.TRIANGLES);for(const Ce of C){const Le=c.getTile(Ce);if(H&&!Le.patternsLoaded())continue;const te=Le.getBucket(g);if(!te)continue;x.prepareDrawTile();const Se=te.programConfigurations.get(g.id),Ue=x.useProgram(ee,Se);H&&(x.context.activeTexture.set(F.TEXTURE0),Le.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Se.updatePaintBuffers());const He=V.constantOr(null);if(He&&Le.imageAtlas){const ut=Le.imageAtlas.patternPositions[He.toString()];ut&&Se.setConstantPatternPositions(ut)}const lt=x.translatePosMatrix(Ce.projMatrix,Le,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor"));if(L){De=te.indexBuffer2,Re=te.segments2;const ut=x.terrain&&x.terrain.renderingToTexture?x.terrain.drapeBufferSize:[F.drawingBufferWidth,F.drawingBufferHeight];ge="fillOutlinePattern"===ee&&H?og(lt,x,Le,ut):ma(lt,ut)}else De=te.indexBuffer,Re=te.segments,ge=H?Ys(lt,x,Le):ga(lt);x.prepareDrawProgram(x.context,Ue,Ce.toUnwrapped()),Ue.draw(x.context,$,T,x.stencilModeForClipping(Ce),A,p.CullFaceMode.disabled,ge,g.id,te.layoutVertexBuffer,De,Re,g.paint,x.transform.zoom,Se)}}function Gu(x,c,g,C,T,A,L){const F=x.context,V=F.gl,H=x.transform,$=g.paint.get("fill-extrusion-pattern"),ee=$.constantOr(1),ge=g.paint.get("fill-extrusion-opacity"),De=[g.paint.get("fill-extrusion-ambient-occlusion-intensity"),g.paint.get("fill-extrusion-ambient-occlusion-radius")],Re=g.layout.get("fill-extrusion-edge-radius"),Ce=Re>0&&!g.paint.get("fill-extrusion-rounded-roof"),Le=Ce?0:Re,te="globe"===H.projection.name?p.fillExtrusionHeightLift():0,Se="globe"===H.projection.name,Ue=Se?p.globeToMercatorTransition(H.zoom):0,He=[p.mercatorXfromLng(H.center.lng),p.mercatorYfromLat(H.center.lat)],lt=[];Se&&lt.push("PROJECTION_GLOBE_VIEW"),De[0]>0&&lt.push("FAUX_AO"),Ce&&lt.push("ZERO_ROOF_RADIUS");for(const ut of C){const ct=c.getTile(ut),yt=ct.getBucket(g);if(!yt||yt.projection.name!==H.projection.name)continue;const xt=yt.programConfigurations.get(g.id),Bt=x.useProgram(ee?"fillExtrusionPattern":"fillExtrusion",xt,lt);if(x.terrain){const Yt=x.terrain;if(x.style.terrainSetForDrapingOnly())Yt.setupElevationDraw(ct,Bt,{useMeterToDem:!0});else{if(!yt.enableTerrain)continue;if(Yt.setupElevationDraw(ct,Bt,{useMeterToDem:!0}),Au(F,c,ut,yt,g,Yt),!yt.centroidVertexBuffer){const an=Bt.attributes.a_centroid_pos;void 0!==an&&V.vertexAttrib2f(an,0,0)}}}ee&&(x.context.activeTexture.set(V.TEXTURE0),ct.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),xt.updatePaintBuffers());const Qt=$.constantOr(null);if(Qt&&ct.imageAtlas){const Yt=ct.imageAtlas.patternPositions[Qt.toString()];Yt&&xt.setConstantPatternPositions(Yt)}const Nt=x.translatePosMatrix(ut.projMatrix,ct,g.paint.get("fill-extrusion-translate"),g.paint.get("fill-extrusion-translate-anchor")),Jt=H.projection.createInversionMatrix(H,ut.canonical),Pt=g.paint.get("fill-extrusion-vertical-gradient"),mn=ee?Uu(Nt,x,Pt,ge,De,Le,ut,ct,te,Ue,He,Jt):Vn(Nt,x,Pt,ge,De,Le,ut,te,Ue,He,Jt);x.prepareDrawProgram(F,Bt,ut.toUnwrapped());const Ft=[];x.terrain&&Ft.push(yt.centroidVertexBuffer),Se&&Ft.push(yt.layoutVertexExtBuffer),Bt.draw(F,F.gl.TRIANGLES,T,A,L,p.CullFaceMode.backCCW,mn,g.id,yt.layoutVertexBuffer,yt.indexBuffer,yt.segments,g.paint,x.transform.zoom,xt,Ft)}}function Au(x,c,g,C,T,A){const L=[te=>{let Se=te.canonical.x-1,Ue=te.wrap;return Se<0&&(Se=(1<<te.canonical.z)-1,Ue--),new p.OverscaledTileID(te.overscaledZ,Ue,te.canonical.z,Se,te.canonical.y)},te=>{let Se=te.canonical.x+1,Ue=te.wrap;return Se===1<<te.canonical.z&&(Se=0,Ue++),new p.OverscaledTileID(te.overscaledZ,Ue,te.canonical.z,Se,te.canonical.y)},te=>new p.OverscaledTileID(te.overscaledZ,te.wrap,te.canonical.z,te.canonical.x,(0===te.canonical.y?1<<te.canonical.z:te.canonical.y)-1),te=>new p.OverscaledTileID(te.overscaledZ,te.wrap,te.canonical.z,te.canonical.x,te.canonical.y===(1<<te.canonical.z)-1?0:te.canonical.y+1)],F=te=>{const Se=c.getSource().minzoom,Ue=lt=>{const ut=c.getTileByID(lt);if(ut&&ut.hasData())return ut.getBucket(T)},He=[0,-1,1];for(const lt of He){if(te.overscaledZ+lt<Se)continue;const ut=Ue(te.calculateScaledKey(te.overscaledZ+lt));if(ut)return ut}},V=[0,0,0],H=(te,Se)=>(V[0]=Math.min(te.min.y,Se.min.y),V[1]=Math.max(te.max.y,Se.max.y),V[2]=p.EXTENT-Se.min.x>te.max.x?Se.min.x-p.EXTENT:te.max.x,V),$=(te,Se)=>(V[0]=Math.min(te.min.x,Se.min.x),V[1]=Math.max(te.max.x,Se.max.x),V[2]=p.EXTENT-Se.min.y>te.max.y?Se.min.y-p.EXTENT:te.max.y,V),ee=[(te,Se)=>H(te,Se),(te,Se)=>H(Se,te),(te,Se)=>$(te,Se),(te,Se)=>$(Se,te)],ge=new p.Point(0,0);let De,Re,Ce;const Le=(te,Se,Ue,He,lt)=>{const ut=[[He?Ue:te,He?te:Ue,0],[He?Ue:Se,He?Se:Ue,0]],ct=lt<0?p.EXTENT+lt:lt,yt=[He?ct:(te+Se)/2,He?(te+Se)/2:ct,0];return 0===Ue&&lt<0||0!==Ue&&lt>0?A.getForTilePoints(Ce,[yt],!0,Re):ut.push(yt),A.getForTilePoints(g,ut,!0,De),Math.max(ut[0][2],ut[1][2],yt[2])/A.exaggeration()};for(let te=0;te<4;te++){const Se=(te<2?1:5)-te,Ue=C.borders[te];if(0===Ue.length)continue;const He=Ce=L[te](g),lt=F(He);if(!(lt&&lt instanceof p.FillExtrusionBucket&&lt.enableTerrain)||C.borderDoneWithNeighborZ[te]===lt.canonical.z&&lt.borderDoneWithNeighborZ[Se]===C.canonical.z||(Re=A.findDEMTileFor(He),!Re||!Re.dem))continue;if(!De){const xt=A.findDEMTileFor(g);if(!xt||!xt.dem)return;De=xt}const ut=lt.borders[Se];let ct=0;const yt=lt.borderDoneWithNeighborZ[Se]!==C.canonical.z;if(C.canonical.z===lt.canonical.z){for(let xt=0;xt<Ue.length;xt++){const Bt=C.featuresOnBorder[Ue[xt]],Qt=Bt.borders[te];let Nt;for(;ct<ut.length&&(Nt=lt.featuresOnBorder[ut[ct]],!(Nt.borders[Se][1]>Qt[0]+3));)yt&&lt.encodeCentroid(void 0,Nt,!1),ct++;if(Nt&&ct<ut.length){const Jt=ct;let Pt=0;for(;!(Nt.borders[Se][0]>Qt[1]-3)&&(Pt++,++ct!==ut.length);)Nt=lt.featuresOnBorder[ut[ct]];if(Nt=lt.featuresOnBorder[ut[Jt]],Bt.intersectsCount()>1||Nt.intersectsCount()>1||1!==Pt){1!==Pt&&(ct=Jt),C.encodeCentroid(void 0,Bt,!1),yt&&lt.encodeCentroid(void 0,Nt,!1);continue}const mn=ee[te](Bt,Nt),Ft=te%2?p.EXTENT-1:0;ge.x=Le(mn[0],Math.min(p.EXTENT-1,mn[1]),Ft,te<2,mn[2]),ge.y=0,C.encodeCentroid(ge,Bt,!1),yt&&lt.encodeCentroid(ge,Nt,!1)}else C.encodeCentroid(void 0,Bt,!1)}C.borderDoneWithNeighborZ[te]=lt.canonical.z,C.needsCentroidUpdate=!0,yt&&(lt.borderDoneWithNeighborZ[Se]=C.canonical.z,lt.needsCentroidUpdate=!0)}else{for(const xt of Ue)C.encodeCentroid(void 0,C.featuresOnBorder[xt],!1);if(yt){for(const xt of ut)lt.encodeCentroid(void 0,lt.featuresOnBorder[xt],!1);lt.borderDoneWithNeighborZ[Se]=C.canonical.z,lt.needsCentroidUpdate=!0}C.borderDoneWithNeighborZ[te]=lt.canonical.z,C.needsCentroidUpdate=!0}}(C.needsCentroidUpdate||!C.centroidVertexBuffer&&0!==C.centroidVertexArray.length)&&C.uploadCentroid(x)}const gl=new p.Color(1,0,0,1),sa=new p.Color(0,1,0,1),Zl=new p.Color(0,0,1,1),Bi=new p.Color(1,0,1,1),tp=new p.Color(0,1,1,1);function lc(x,c,g){const C=x.context,T=x.transform,A=C.gl,L="globe"===T.projection.name,F=L?["PROJECTION_GLOBE_VIEW"]:null;let V=g.projMatrix;if(L&&p.globeToMercatorTransition(T.zoom)>0){const Bt=p.transitionTileAABBinECEF(g.canonical,T),Qt=p.globeDenormalizeECEF(Bt);V=p.multiply(new Float32Array(16),T.globeMatrix,Qt),p.multiply(V,T.projMatrix,V)}const H=x.useProgram("debug",null,F),$=c.getTileByID(g.key);x.terrain&&x.terrain.setupElevationDraw($,H);const ee=p.DepthMode.disabled,ge=p.StencilMode.disabled,De=x.colorModeForRenderPass();C.activeTexture.set(A.TEXTURE0),x.emptyTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),L?$._makeGlobeTileDebugBuffers(x.context,T):$._makeDebugTileBoundsBuffers(x.context,T.projection);const Ce=$._tileDebugBuffer||x.debugBuffer,Le=$._tileDebugIndexBuffer||x.debugIndexBuffer,te=$._tileDebugSegments||x.debugSegments;H.draw(C,A.LINE_STRIP,ee,ge,De,p.CullFaceMode.disabled,Wo(V,p.Color.red),"$debug",Ce,Le,te,null,null,null,[$._globeTileDebugBorderBuffer]);const Se=$.latestRawTileData,Ue=Math.floor((Se&&Se.byteLength||0)/1024),He=c.getTile(g).tileSize,lt=512/Math.min(He,512)*(g.overscaledZ/T.zoom)*.5;let ut=g.canonical.toString();g.overscaledZ!==g.canonical.z&&(ut+=` => ${g.overscaledZ}`),ut+=` ${Ue}kb`,function(Bt,Qt){Bt.initDebugOverlayCanvas();const Nt=Bt.debugOverlayCanvas,Jt=Bt.context.gl,Pt=Bt.debugOverlayCanvas.getContext("2d");Pt.clearRect(0,0,Nt.width,Nt.height),Pt.shadowColor="white",Pt.shadowBlur=2,Pt.lineWidth=1.5,Pt.strokeStyle="white",Pt.textBaseline="top",Pt.font="bold 36px Open Sans, sans-serif",Pt.fillText(Qt,5,5),Pt.strokeText(Qt,5,5),Bt.debugOverlayTexture.update(Nt),Bt.debugOverlayTexture.bind(Jt.LINEAR,Jt.CLAMP_TO_EDGE)}(x,ut);const ct=$._tileDebugTextBuffer||x.debugBuffer,yt=$._tileDebugTextIndexBuffer||x.quadTriangleIndexBuffer,xt=$._tileDebugTextSegments||x.debugSegments;H.draw(C,A.TRIANGLES,ee,ge,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,Wo(V,p.Color.transparent,lt),"$debug",ct,yt,xt,null,null,null,[$._globeTileDebugTextBuffer])}function Mc(x,c,g,C){Cs(x,0,c+g/2,x.transform.width,g,C)}function Or(x,c,g,C){Cs(x,c-g/2,0,g,x.transform.height,C)}function Cs(x,c,g,C,T,A){const L=x.context,F=L.gl;F.enable(F.SCISSOR_TEST),F.scissor(c*p.exported.devicePixelRatio,g*p.exported.devicePixelRatio,C*p.exported.devicePixelRatio,T*p.exported.devicePixelRatio),L.clear({color:A}),F.disable(F.SCISSOR_TEST)}const Ml=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Mn}=Ml;function Ss(x,c,g,C){x.emplaceBack(c,g,C)}class gi{constructor(c){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,Ss(this.vertexArray,-1,-1,1),Ss(this.vertexArray,1,-1,1),Ss(this.vertexArray,-1,1,1),Ss(this.vertexArray,1,1,1),Ss(this.vertexArray,-1,-1,-1),Ss(this.vertexArray,1,-1,-1),Ss(this.vertexArray,-1,1,-1),Ss(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,Mn),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function Oi(x,c,g,C,T,A){const L=x.gl,F=c.paint.get("sky-atmosphere-color"),V=c.paint.get("sky-atmosphere-halo-color"),H=c.paint.get("sky-atmosphere-sun-intensity"),$={u_matrix_3f:p.fromMat4(p.create$1(),C),u_sun_direction:T,u_sun_intensity:H,u_color_tint_r:[(Re=F).r,Re.g,Re.b,Re.a],u_color_tint_m:[(Ce=V).r,Ce.g,Ce.b,Ce.a],u_luminance:5e-5};var Re,Ce;L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_CUBE_MAP_POSITIVE_X+A,c.skyboxTexture,0),g.draw(x,L.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,$,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const Ui=p.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class uc{constructor(c){const g=new p.StructArrayLayout5f20;g.emplaceBack(-1,1,1,0,0),g.emplaceBack(1,1,1,1,0),g.emplaceBack(1,-1,1,1,1),g.emplaceBack(-1,-1,1,0,1);const C=new p.StructArrayLayout3ui6;C.emplaceBack(0,1,2),C.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(g,Ui.members),this.indexBuffer=c.createIndexBuffer(C),this.segments=p.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Si={symbol:function(x,c,g,C,T){if("translucent"!==x.renderPass)return;const A=p.StencilMode.disabled,L=x.colorModeForRenderPass();g.layout.get("text-variable-anchor")&&function(F,V,H,$,ee,ge,De){const Re=V.transform,Ce="map"===ee,Le="map"===ge;for(const te of F){const Se=$.getTile(te),Ue=Se.getBucket(H);if(!Ue||!Ue.text||!Ue.text.segments.get().length)continue;const He=p.evaluateSizeForZoom(Ue.textSizeData,Re.zoom),lt=Io(te,Ue.getProjection(),Re),ut=Re.calculatePixelsToTileUnitsMatrix(Se),ct=Wt(lt,Se.tileID.canonical,Le,Ce,Re,Ue.getProjection(),ut),yt="none"!==H.layout.get("icon-text-fit")&&Ue.hasIconData();if(He){const xt=Math.pow(2,Re.zoom-Se.tileID.overscaledZ);Dh(Ue,Ce,Le,De,p.symbolSize,Re,ct,te,xt,He,yt)}}}(C,x,g,c,g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),T),0!==g.paint.get("icon-opacity").constantOr(1)&&pu(x,c,g,C,!1,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),g.layout.get("icon-rotation-alignment"),g.layout.get("icon-pitch-alignment"),g.layout.get("icon-keep-upright"),A,L),0!==g.paint.get("text-opacity").constantOr(1)&&pu(x,c,g,C,!0,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),g.layout.get("text-keep-upright"),A,L),c.map.showCollisionBoxes&&(Mu(x,c,g,C,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),!0),Mu(x,c,g,C,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),!1))},circle:function(x,c,g,C){if("translucent"!==x.renderPass)return;const T=g.paint.get("circle-opacity"),A=g.paint.get("circle-stroke-width"),L=g.paint.get("circle-stroke-opacity"),F=void 0!==g.layout.get("circle-sort-key").constantOr(1);if(0===T.constantOr(1)&&(0===A.constantOr(1)||0===L.constantOr(1)))return;const V=x.context,H=V.gl,$=x.transform,ee=x.depthModeForSublayer(0,p.DepthMode.ReadOnly),ge=p.StencilMode.disabled,De=x.colorModeForRenderPass(),Re="globe"===$.projection.name,Ce=[p.mercatorXfromLng($.center.lng),p.mercatorYfromLat($.center.lat)],Le=[];for(let Se=0;Se<C.length;Se++){const Ue=C[Se],He=c.getTile(Ue),lt=He.getBucket(g);if(!lt||lt.projection.name!==$.projection.name)continue;const ut=lt.programConfigurations.get(g.id),ct=Ra(g);Re&&ct.push("PROJECTION_GLOBE_VIEW");const yt=x.useProgram("circle",ut,ct),xt=lt.layoutVertexBuffer,Bt=lt.globeExtVertexBuffer,Qt=lt.indexBuffer,Nt=$.projection.createInversionMatrix($,Ue.canonical),Jt={programConfiguration:ut,program:yt,layoutVertexBuffer:xt,globeExtVertexBuffer:Bt,indexBuffer:Qt,uniformValues:_a(x,Ue,He,Nt,Ce,g),tile:He};if(F){const Pt=lt.segments.get();for(const mn of Pt)Le.push({segments:new p.SegmentVector([mn]),sortKey:mn.sortKey,state:Jt})}else Le.push({segments:lt.segments,sortKey:0,state:Jt})}F&&Le.sort((Se,Ue)=>Se.sortKey-Ue.sortKey);const te={useDepthForOcclusion:!Re};for(const Se of Le){const{programConfiguration:Ue,program:He,layoutVertexBuffer:lt,globeExtVertexBuffer:ut,indexBuffer:ct,uniformValues:yt,tile:xt}=Se.state,Bt=Se.segments;x.terrain&&x.terrain.setupElevationDraw(xt,He,te),x.prepareDrawProgram(V,He,xt.tileID.toUnwrapped()),He.draw(V,H.TRIANGLES,ee,ge,De,p.CullFaceMode.disabled,yt,g.id,lt,ct,Bt,g.paint,$.zoom,Ue,[ut])}},heatmap:function(x,c,g,C){if(0!==g.paint.get("heatmap-opacity"))if("offscreen"===x.renderPass){const T=x.context,A=T.gl,L=p.StencilMode.disabled,F=new p.ColorMode([A.ONE,A.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(De,Re,Ce,Le){const te=De.gl,Se=Re.width*Le,Ue=Re.height*Le;De.activeTexture.set(te.TEXTURE1),De.viewport.set([0,0,Se,Ue]);let He=Ce.heatmapFbo;if(!He||He&&(He.width!==Se||He.height!==Ue)){He&&He.destroy();const lt=te.createTexture();te.bindTexture(te.TEXTURE_2D,lt),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MAG_FILTER,te.LINEAR),He=Ce.heatmapFbo=De.createFramebuffer(Se,Ue,!1),function(ut,ct,yt,xt,Bt,Qt){const Nt=ut.gl;Nt.texImage2D(Nt.TEXTURE_2D,0,ut.isWebGL2&&ut.extRenderToTextureHalfFloat?Nt.RGBA16F:Nt.RGBA,Bt,Qt,0,Nt.RGBA,ut.extRenderToTextureHalfFloat?ut.isWebGL2?Nt.HALF_FLOAT:ut.extTextureHalfFloat.HALF_FLOAT_OES:Nt.UNSIGNED_BYTE,null),xt.colorAttachment.set(yt)}(De,0,lt,He,Se,Ue)}else te.bindTexture(te.TEXTURE_2D,He.colorAttachment.get()),De.bindFramebuffer.set(He.framebuffer)})(T,x,g,"globe"===x.transform.projection.name?.5:.25),T.clear({color:p.Color.transparent});const V=x.transform,H="globe"===V.projection.name,$=H?["PROJECTION_GLOBE_VIEW"]:null,ee=H?p.CullFaceMode.frontCCW:p.CullFaceMode.disabled,ge=[p.mercatorXfromLng(V.center.lng),p.mercatorYfromLat(V.center.lat)];for(let De=0;De<C.length;De++){const Re=C[De];if(c.hasRenderableParent(Re))continue;const Ce=c.getTile(Re),Le=Ce.getBucket(g);if(!Le||Le.projection.name!==V.projection.name)continue;const te=Le.programConfigurations.get(g.id),Se=x.useProgram("heatmap",te,$),{zoom:Ue}=x.transform;x.terrain&&x.terrain.setupElevationDraw(Ce,Se),x.prepareDrawProgram(T,Se,Re.toUnwrapped());const He=V.projection.createInversionMatrix(V,Re.canonical);Se.draw(T,A.TRIANGLES,p.DepthMode.disabled,L,F,ee,pl(x,Re,Ce,He,ge,Ue,g.paint.get("heatmap-intensity")),g.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,g.paint,x.transform.zoom,te,H?[Le.globeExtVertexBuffer]:null)}T.viewport.set([0,0,x.width,x.height])}else"translucent"===x.renderPass&&(x.context.setColorMode(x.colorModeForRenderPass()),function(T,A){const L=T.context,F=L.gl,V=A.heatmapFbo;if(!V)return;L.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,V.colorAttachment.get()),L.activeTexture.set(F.TEXTURE1);let H=A.colorRampTexture;H||(H=A.colorRampTexture=new p.Texture(L,A.colorRamp,F.RGBA)),H.bind(F.LINEAR,F.CLAMP_TO_EDGE),T.useProgram("heatmapTexture").draw(L,F.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,T.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:A.paint.get("heatmap-opacity")},A.id,T.viewportBuffer,T.quadTriangleIndexBuffer,T.viewportSegments,A.paint,T.transform.zoom)}(x,g))},line:function(x,c,g,C){if("translucent"!==x.renderPass)return;const T=g.paint.get("line-opacity"),A=g.paint.get("line-width");if(0===T.constantOr(1)||0===A.constantOr(1))return;const L=x.depthModeForSublayer(0,p.DepthMode.ReadOnly),F=x.colorModeForRenderPass(),V=x.terrain&&x.terrain.renderingToTexture?1:p.exported.devicePixelRatio,H=g.paint.get("line-dasharray"),$=H.constantOr(1),ee=g.layout.get("line-cap"),ge=g.paint.get("line-pattern"),De=ge.constantOr(1),Re=g.paint.get("line-gradient"),Ce=De?"linePattern":"line",Le=x.context,te=Le.gl,Se=(He=>{const lt=[];du(He)&&lt.push("RENDER_LINE_DASH"),He.paint.get("line-gradient")&&lt.push("RENDER_LINE_GRADIENT");const ut=He.paint.get("line-trim-offset");0===ut[0]&&0===ut[1]||lt.push("RENDER_LINE_TRIM_OFFSET");const ct=He.paint.get("line-pattern").constantOr(1),yt=1!==He.paint.get("line-opacity").constantOr(1);return!ct&&yt&&lt.push("RENDER_LINE_ALPHA_DISCARD"),lt})(g);let Ue=Se.includes("RENDER_LINE_ALPHA_DISCARD");x.terrain&&x.terrain.clipOrMaskOverlapStencilType()&&(Ue=!1);for(const He of C){const lt=c.getTile(He);if(De&&!lt.patternsLoaded())continue;const ut=lt.getBucket(g);if(!ut)continue;x.prepareDrawTile();const ct=ut.programConfigurations.get(g.id),yt=x.useProgram(Ce,ct,Se),xt=ge.constantOr(null);if(xt&&lt.imageAtlas){const Yt=lt.imageAtlas.patternPositions[xt.toString()];Yt&&ct.setConstantPatternPositions(Yt)}const Bt=H.constantOr(null),Qt=ee.constantOr(null);if(!De&&Bt&&Qt&&lt.lineAtlas){const Yt=lt.lineAtlas.getDash(Bt,Qt);Yt&&ct.setConstantPatternPositions(Yt)}let[Nt,Jt]=g.paint.get("line-trim-offset");("round"===Qt||"square"===Qt)&&Nt!==Jt&&(0===Nt&&(Nt-=1),1===Jt&&(Jt+=1));const Pt=x.terrain?He.projMatrix:null,mn=De?il(x,lt,g,Pt,V):ju(x,lt,g,Pt,ut.lineClipsArray.length,V,[Nt,Jt]);if(Re){const Yt=ut.gradients[g.id];let an=Yt.texture;if(g.gradientVersion!==Yt.version){let ln=256;if(g.stepInterpolant){const xn=c.getSource().maxzoom,cr=He.canonical.z===xn?Math.ceil(1<<x.transform.maxZoom-He.canonical.z):1;ln=p.clamp(p.nextPowerOfTwo(ut.maxLineLength/p.EXTENT*1024*cr),256,Le.maxTextureSize)}Yt.gradient=p.renderColorRamp({expression:g.gradientExpression(),evaluationKey:"lineProgress",resolution:ln,image:Yt.gradient||void 0,clips:ut.lineClipsArray}),Yt.texture?Yt.texture.update(Yt.gradient):Yt.texture=new p.Texture(Le,Yt.gradient,te.RGBA),Yt.version=g.gradientVersion,an=Yt.texture}Le.activeTexture.set(te.TEXTURE1),an.bind(g.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}$&&(Le.activeTexture.set(te.TEXTURE0),lt.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),ct.updatePaintBuffers()),De&&(Le.activeTexture.set(te.TEXTURE0),lt.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),ct.updatePaintBuffers()),x.prepareDrawProgram(Le,yt,He.toUnwrapped());const Ft=Yt=>{yt.draw(Le,te.TRIANGLES,L,Yt,F,p.CullFaceMode.disabled,mn,g.id,ut.layoutVertexBuffer,ut.indexBuffer,ut.segments,g.paint,x.transform.zoom,ct,[ut.layoutVertexBuffer2])};if(Ue){const Yt=x.stencilModeForClipping(He).ref;0===Yt&&x.terrain&&Le.clear({stencil:0});const an={func:te.EQUAL,mask:255};mn.u_alpha_discard_threshold=.8,Ft(new p.StencilMode(an,Yt,255,te.KEEP,te.KEEP,te.INVERT)),mn.u_alpha_discard_threshold=0,Ft(new p.StencilMode(an,Yt,255,te.KEEP,te.KEEP,te.KEEP))}else Ft(x.stencilModeForClipping(He))}Ue&&(x.resetStencilClippingMasks(),x.terrain&&Le.clear({stencil:0}))},fill:function(x,c,g,C){const T=g.paint.get("fill-color"),A=g.paint.get("fill-opacity");if(0===A.constantOr(1))return;const L=x.colorModeForRenderPass(),F=g.paint.get("fill-pattern"),V=x.opaquePassEnabledForLayer()&&!F.constantOr(1)&&1===T.constantOr(p.Color.transparent).a&&1===A.constantOr(0)?"opaque":"translucent";if(x.renderPass===V){const H=x.depthModeForSublayer(1,"opaque"===x.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);Bd(x,c,g,C,H,L,!1)}if("translucent"===x.renderPass&&g.paint.get("fill-antialias")){const H=x.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);Bd(x,c,g,C,H,L,!0)}},"fill-extrusion":function(x,c,g,C){const T=g.paint.get("fill-extrusion-opacity");if(0!==T&&"translucent"===x.renderPass){const A=new p.DepthMode(x.context.gl.LEQUAL,p.DepthMode.ReadWrite,x.depthRangeFor3D);if(1!==T||g.paint.get("fill-extrusion-pattern").constantOr(1))Gu(x,c,g,C,A,p.StencilMode.disabled,p.ColorMode.disabled),Gu(x,c,g,C,A,x.stencilModeFor3D(),x.colorModeForRenderPass()),x.resetStencilClippingMasks();else{const L=x.colorModeForRenderPass();Gu(x,c,g,C,A,p.StencilMode.disabled,L)}}},hillshade:function(x,c,g,C){if("offscreen"!==x.renderPass&&"translucent"!==x.renderPass)return;const T=x.context,A=x.depthModeForSublayer(0,p.DepthMode.ReadOnly),L=x.colorModeForRenderPass(),F=x.terrain&&x.terrain.renderingToTexture,[V,H]="translucent"!==x.renderPass||F?[{},C]:x.stencilConfigForOverlap(C);for(const $ of H){const ee=c.getTile($);if(ee.needsHillshadePrepare&&"offscreen"===x.renderPass)Qh(x,ee,g,A,p.StencilMode.disabled,L);else if("translucent"===x.renderPass){const ge=F&&x.terrain?x.terrain.stencilModeForRTTOverlap($):V[$.overscaledZ];ns(x,$,ee,g,A,ge,L)}}T.viewport.set([0,0,x.width,x.height]),x.resetStencilClippingMasks()},raster:function(x,c,g,C,T,A){if("translucent"!==x.renderPass||0===g.paint.get("raster-opacity")||!C.length)return;const L=x.context,F=L.gl,V=c.getSource(),H=x.useProgram("raster"),$=x.colorModeForRenderPass(),ee=x.terrain&&x.terrain.renderingToTexture,[ge,De]=V instanceof Kr||ee?[{},C]:x.stencilConfigForOverlap(C),Re=De[De.length-1].overscaledZ,Ce=!x.options.moving;for(const Le of De){const te=ee?p.DepthMode.disabled:x.depthModeForSublayer(Le.overscaledZ-Re,1===g.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,F.LESS),Se=Le.toUnwrapped(),Ue=c.getTile(Le);if(ee&&(!Ue||!Ue.hasData()))continue;const He=ee?Le.projMatrix:x.transform.calculateProjMatrix(Se,Ce),lt=x.terrain&&ee?x.terrain.stencilModeForRTTOverlap(Le):ge[Le.overscaledZ],ut=A?0:g.paint.get("raster-fade-duration");Ue.registerFadeDuration(ut);const ct=c.findLoadedParent(Le,0),yt=ac(Ue,ct,c,x.transform,ut);let xt,Bt;x.terrain&&x.terrain.prepareDrawTile();const Qt="nearest"===g.paint.get("raster-resampling")?F.NEAREST:F.LINEAR;L.activeTexture.set(F.TEXTURE0),Ue.texture.bind(Qt,F.CLAMP_TO_EDGE),L.activeTexture.set(F.TEXTURE1),ct?(ct.texture.bind(Qt,F.CLAMP_TO_EDGE),xt=Math.pow(2,ct.tileID.overscaledZ-Ue.tileID.overscaledZ),Bt=[Ue.tileID.canonical.x*xt%1,Ue.tileID.canonical.y*xt%1]):Ue.texture.bind(Qt,F.CLAMP_TO_EDGE),Ue.texture.useMipmap&&L.extTextureFilterAnisotropic&&x.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const Nt=Ks(He,Bt||[0,0],xt||1,yt,g,V instanceof Kr?V.perspectiveTransform:[0,0]);if(x.prepareDrawProgram(L,H,Se),V instanceof Kr)V.boundsBuffer&&V.boundsSegments&&H.draw(L,F.TRIANGLES,te,p.StencilMode.disabled,$,p.CullFaceMode.disabled,Nt,g.id,V.boundsBuffer,x.quadTriangleIndexBuffer,V.boundsSegments);else{const{tileBoundsBuffer:Jt,tileBoundsIndexBuffer:Pt,tileBoundsSegments:mn}=x.getTileBoundsBuffers(Ue);H.draw(L,F.TRIANGLES,te,lt,$,p.CullFaceMode.disabled,Nt,g.id,Jt,Pt,mn)}}x.resetStencilClippingMasks()},background:function(x,c,g,C){const T=g.paint.get("background-color"),A=g.paint.get("background-opacity");if(0===A)return;const L=x.context,F=L.gl,V=x.transform,H=V.tileSize,$=g.paint.get("background-pattern");if(x.isPatternMissing($))return;const ee=!$&&1===T.a&&1===A&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==ee)return;const ge=p.StencilMode.disabled,De=x.depthModeForSublayer(0,"opaque"===ee?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),Re=x.colorModeForRenderPass(),Ce=x.useProgram($?"backgroundPattern":"background");let Le,te=C;te||(Le=x.getBackgroundTiles(),te=Object.values(Le).map(Se=>Se.tileID)),$&&(L.activeTexture.set(F.TEXTURE0),x.imageManager.bind(x.context));for(const Se of te){const Ue=Se.toUnwrapped(),He=C?Se.projMatrix:x.transform.calculateProjMatrix(Ue);x.prepareDrawTile();const lt=c?c.getTile(Se):Le?Le[Se.key]:new p.Tile(Se,H,V.zoom,x),ut=$?th(He,A,x,$,{tileID:Se,tileSize:H}):Ic(He,A,T);x.prepareDrawProgram(L,Ce,Ue);const{tileBoundsBuffer:ct,tileBoundsIndexBuffer:yt,tileBoundsSegments:xt}=x.getTileBoundsBuffers(lt);Ce.draw(L,F.TRIANGLES,De,ge,Re,p.CullFaceMode.disabled,ut,g.id,ct,yt,xt)}},sky:function(x,c,g){const C=x.transform,T="mercator"===C.projection.name||"globe"===C.projection.name?1:p.smoothstep(7,8,C.zoom),A=g.paint.get("sky-opacity")*T;if(0===A)return;const L=x.context,F=g.paint.get("sky-type"),V=new p.DepthMode(L.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),H=x.frameCounter/1e3%1;"atmosphere"===F?"offscreen"===x.renderPass?g.needsSkyboxCapture(x)&&(function($,ee,ge,De){const Re=$.context,Ce=Re.gl;let Le=ee.skyboxFbo;if(!Le){Le=ee.skyboxFbo=Re.createFramebuffer(32,32,!1),ee.skyboxGeometry=new gi(Re),ee.skyboxTexture=Re.gl.createTexture(),Ce.bindTexture(Ce.TEXTURE_CUBE_MAP,ee.skyboxTexture),Ce.texParameteri(Ce.TEXTURE_CUBE_MAP,Ce.TEXTURE_WRAP_S,Ce.CLAMP_TO_EDGE),Ce.texParameteri(Ce.TEXTURE_CUBE_MAP,Ce.TEXTURE_WRAP_T,Ce.CLAMP_TO_EDGE),Ce.texParameteri(Ce.TEXTURE_CUBE_MAP,Ce.TEXTURE_MIN_FILTER,Ce.LINEAR),Ce.texParameteri(Ce.TEXTURE_CUBE_MAP,Ce.TEXTURE_MAG_FILTER,Ce.LINEAR);for(let He=0;He<6;++He)Ce.texImage2D(Ce.TEXTURE_CUBE_MAP_POSITIVE_X+He,0,Ce.RGBA,32,32,0,Ce.RGBA,Ce.UNSIGNED_BYTE,null)}Re.bindFramebuffer.set(Le.framebuffer),Re.viewport.set([0,0,32,32]);const te=ee.getCenter($,!0),Se=$.useProgram("skyboxCapture"),Ue=new Float64Array(16);p.identity(Ue),p.rotateY(Ue,Ue,.5*-Math.PI),Oi(Re,ee,Se,Ue,te,0),p.identity(Ue),p.rotateY(Ue,Ue,.5*Math.PI),Oi(Re,ee,Se,Ue,te,1),p.identity(Ue),p.rotateX(Ue,Ue,.5*-Math.PI),Oi(Re,ee,Se,Ue,te,2),p.identity(Ue),p.rotateX(Ue,Ue,.5*Math.PI),Oi(Re,ee,Se,Ue,te,3),p.identity(Ue),Oi(Re,ee,Se,Ue,te,4),p.identity(Ue),p.rotateY(Ue,Ue,Math.PI),Oi(Re,ee,Se,Ue,te,5),Re.viewport.set([0,0,$.width,$.height])}(x,g),g.markSkyboxValid(x)):"sky"===x.renderPass&&function($,ee,ge,De,Re){const Ce=$.context,Le=Ce.gl,te=$.transform,Se=$.useProgram("skybox");Ce.activeTexture.set(Le.TEXTURE0),Le.bindTexture(Le.TEXTURE_CUBE_MAP,ee.skyboxTexture);const Ue={u_matrix:te.skyboxMatrix,u_sun_direction:ee.getCenter($,!1),u_cubemap:0,u_opacity:De,u_temporal_offset:Re};$.prepareDrawProgram(Ce,Se),Se.draw(Ce,Le.TRIANGLES,ge,p.StencilMode.disabled,$.colorModeForRenderPass(),p.CullFaceMode.backCW,Ue,"skybox",ee.skyboxGeometry.vertexBuffer,ee.skyboxGeometry.indexBuffer,ee.skyboxGeometry.segment)}(x,g,V,A,H):"gradient"===F&&"sky"===x.renderPass&&function($,ee,ge,De,Re){const Ce=$.context,Le=Ce.gl,te=$.transform,Se=$.useProgram("skyboxGradient");ee.skyboxGeometry||(ee.skyboxGeometry=new gi(Ce)),Ce.activeTexture.set(Le.TEXTURE0);let Ue=ee.colorRampTexture;Ue||(Ue=ee.colorRampTexture=new p.Texture(Ce,ee.colorRamp,Le.RGBA)),Ue.bind(Le.LINEAR,Le.CLAMP_TO_EDGE);const He=(lt=te.skyboxMatrix,ut=ee.getCenter($,!1),ct=ee.paint.get("sky-gradient-radius"),yt=De,xt=Re,{u_matrix:lt,u_color_ramp:0,u_center_direction:ut,u_radius:p.degToRad(ct),u_opacity:yt,u_temporal_offset:xt});var lt,ut,ct,yt,xt;$.prepareDrawProgram(Ce,Se),Se.draw(Ce,Le.TRIANGLES,ge,p.StencilMode.disabled,$.colorModeForRenderPass(),p.CullFaceMode.backCW,He,"skyboxGradient",ee.skyboxGeometry.vertexBuffer,ee.skyboxGeometry.indexBuffer,ee.skyboxGeometry.segment)}(x,g,V,A,H)},debug:function(x,c,g){for(let C=0;C<g.length;C++)lc(x,c,g[C])},custom:function(x,c,g,C){const T=x.context,A=g.implementation;if(!x.transform.projection.unsupportedLayers||!x.transform.projection.unsupportedLayers.includes("custom")||x.terrain&&(x.terrain.renderingToTexture||"offscreen"===x.renderPass)&&g.isLayerDraped()){if("offscreen"===x.renderPass){const L=A.prerender;if(L){if(x.setCustomLayerDefaults(),T.setColorMode(x.colorModeForRenderPass()),"globe"===x.transform.projection.name){const F=x.transform.pointMerc;L.call(A,T.gl,x.transform.customLayerMatrix(),x.transform.getProjection(),x.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(x.transform.zoom),[F.x,F.y],x.transform.pixelsPerMeterRatio)}else L.call(A,T.gl,x.transform.customLayerMatrix());T.setDirty(),x.setBaseState()}}else if("translucent"===x.renderPass){if(x.terrain&&x.terrain.renderingToTexture){const F=A.renderToTile;if(F){const V=C[0].canonical,H=new p.MercatorCoordinate(V.x+C[0].wrap*(1<<V.z),V.y,V.z);T.setDepthMode(p.DepthMode.disabled),T.setStencilMode(p.StencilMode.disabled),T.setColorMode(x.colorModeForRenderPass()),x.setCustomLayerDefaults(),F.call(A,T.gl,H),T.setDirty(),x.setBaseState()}return}x.setCustomLayerDefaults(),T.setColorMode(x.colorModeForRenderPass()),T.setStencilMode(p.StencilMode.disabled);const L="3d"===A.renderingMode?new p.DepthMode(x.context.gl.LEQUAL,p.DepthMode.ReadWrite,x.depthRangeFor3D):x.depthModeForSublayer(0,p.DepthMode.ReadOnly);if(T.setDepthMode(L),"globe"===x.transform.projection.name){const F=x.transform.pointMerc;A.render(T.gl,x.transform.customLayerMatrix(),x.transform.getProjection(),x.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(x.transform.zoom),[F.x,F.y],x.transform.pixelsPerMeterRatio)}else A.render(T.gl,x.transform.customLayerMatrix());T.setDirty(),x.setBaseState(),T.bindFramebuffer.set(null)}}else p.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class cc{constructor(c,g,C=!1){this.context=new fn(c,C),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(c,g){const C=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(C||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new rl(this,c));const T=this._terrain;this.transform.elevation=C?T:null,T.update(c,this.transform,g)}_updateFog(c){const g=c.fog;if(!g||"globe"===this.transform.projection.name||g.getOpacity(this.transform.pitch)<1||g.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[C,T]=g.getFovAdjustedRange(this.transform._fov);if(C>T)return void(this.transform.fogCullDistSq=null);const A=C+.78*(T-C);this.transform.fogCullDistSq=A*A}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(c,g){if(this.width=c*p.exported.devicePixelRatio,this.height=g*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const C of this.style.order)this.style._layers[C].resize()}setup(){const c=this.context,g=new p.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(p.EXTENT,0),g.emplaceBack(0,p.EXTENT),g.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(g,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const C=new p.StructArrayLayout2i4;C.emplaceBack(0,0),C.emplaceBack(p.EXTENT,0),C.emplaceBack(0,p.EXTENT),C.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=c.createVertexBuffer(C,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const T=new p.StructArrayLayout2i4;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(-1,1),T.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(T,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const A=new p.StructArrayLayout4i8;A.emplaceBack(0,0,0,0),A.emplaceBack(p.EXTENT,0,p.EXTENT,0),A.emplaceBack(0,p.EXTENT,0,p.EXTENT),A.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=c.createVertexBuffer(A,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const L=new p.StructArrayLayout3ui6;L.emplaceBack(0,1,2),L.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(L);const F=new p.StructArrayLayout1ui2;for(const H of[0,1,3,2,0])F.emplaceBack(H);this.debugIndexBuffer=c.createIndexBuffer(F),this.emptyTexture=new p.Texture(c,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=p.create();const V=this.context.gl;this.stencilClearMode=new p.StencilMode({func:V.ALWAYS,mask:0},0,255,V.ZERO,V.ZERO,V.ZERO),this.loadTimeStamps.push(p.window.performance.now()),this.atmosphereBuffer=new uc(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context,g=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(c,g.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,ni(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,g,C){if(!g||this.currentStencilSource===g.id||!c.isTileClipped()||!C||0===C.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let F=!1;for(const V of C)if(void 0===this._tileClippingMaskIDs[V.key]){F=!0;break}if(!F)return}this.currentStencilSource=g.id;const T=this.context,A=T.gl;this.nextStencilID+C.length>256&&this.clearStencil(),T.setColorMode(p.ColorMode.disabled),T.setDepthMode(p.DepthMode.disabled);const L=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const F of C){const V=g.getTile(F),H=this._tileClippingMaskIDs[F.key]=this.nextStencilID++,{tileBoundsBuffer:$,tileBoundsIndexBuffer:ee,tileBoundsSegments:ge}=this.getTileBoundsBuffers(V);L.draw(T,A.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:A.ALWAYS,mask:0},H,255,A.KEEP,A.KEEP,A.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,ni(F.projMatrix),"$clipping",$,ee,ge)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,g=this.context.gl;return new p.StencilMode({func:g.NOTEQUAL,mask:255},c,255,g.KEEP,g.KEEP,g.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const g=this.context.gl;return new p.StencilMode({func:g.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,g.KEEP,g.KEEP,g.REPLACE)}stencilConfigForOverlap(c){const g=this.context.gl,C=c.sort((L,F)=>F.overscaledZ-L.overscaledZ),T=C[C.length-1].overscaledZ,A=C[0].overscaledZ-T+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();const L={};for(let F=0;F<A;F++)L[F+T]=new p.StencilMode({func:g.GEQUAL,mask:255},F+this.nextStencilID,255,g.KEEP,g.KEEP,g.REPLACE);return this.nextStencilID+=A,[L,C]}return[{[T]:p.StencilMode.disabled},C]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([c.CONSTANT_COLOR,c.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(c,g,C){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const T=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new p.DepthMode(C||this.context.gl.LEQUAL,g,[T,T])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,g){this.style=c,this.options=g,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const C=this.style.order,T=this.style._sourceCaches;for(const H in T){const $=T[H];$.used&&$.prepare(this.context)}const A={},L={},F={};for(const H in T){const $=T[H];A[H]=$.getVisibleCoordinates(),L[H]=A[H].slice().reverse(),F[H]=$.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let H=0;H<C.length;H++)if(this.style._layers[C[H]].is3D()){this.opaquePassCutoff=H;break}if(this.terrain&&(this.terrain.updateTileBinding(F),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const H of C){const $=this.style._layers[H],ee=c._getLayerSourceCache($);if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;const ge=ee?L[ee.id]:void 0;("custom"===$.type||$.isSky()||ge&&ge.length)&&this.renderLayer(this,ee,$,ge)}this.depthRangeFor3D=[0,1-(c.order.length+2)*this.numSublayers*this.depthEpsilon];const V=this.terrain;if(V&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&V.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:g.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=g.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){const H=this.style._layers[C[this.currentLayer]],$=c._getLayerSourceCache(H);if(H.isSky())continue;const ee=$?L[$.id]:void 0;this._renderTileClippingMasks(H,$,ee),this.renderLayer(this,$,H,ee)}if(this.style.fog&&this.transform.projection.supportsFog&&function(H,$){const ee=H.context,ge=ee.gl,De=H.transform,Re=new p.DepthMode(ge.LEQUAL,p.DepthMode.ReadOnly,[0,1]),Ce=H.useProgram("globeAtmosphere",null,"globe"===De.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Le=p.globeToMercatorTransition(De.zoom),te=$.properties.get("color").toArray01(),Se=$.properties.get("high-color").toArray01(),Ue=$.properties.get("space-color").toArray01PremultipliedAlpha(),He=p.identity$1([]);p.rotateY$1(He,He,-p.degToRad(De._center.lng)),p.rotateX$1(He,He,p.degToRad(De._center.lat)),p.rotateZ$1(He,He,De.angle),p.rotateX$1(He,He,-De._pitch);const lt=p.fromQuat(new Float32Array(16),He),ut=p.mapValue($.properties.get("star-intensity"),0,1,0,.25),yt=p.mapValue($.properties.get("horizon-blend"),0,1,5e-4,.25),xt=p.globeUseCustomAntiAliasing(H,ee,De)&&5e-4===yt?De.worldSize/(2*Math.PI*1.025)-1:De.globeRadius,Bt=H.frameCounter/1e3%1,Qt=p.length(De.globeCenterInViewSpace),Nt=Math.sqrt(Math.pow(Qt,2)-Math.pow(xt,2)),Jt=Math.acos(Nt/Qt),Pt={u_frustum_tl:De.frustumCorners.TL,u_frustum_tr:De.frustumCorners.TR,u_frustum_br:De.frustumCorners.BR,u_frustum_bl:De.frustumCorners.BL,u_horizon:De.frustumCorners.horizon,u_transition:Le,u_fadeout_range:yt,u_color:te,u_high_color:Se,u_space_color:Ue,u_star_intensity:ut,u_star_size:5*p.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Bt,u_horizon_angle:Jt,u_rotation_matrix:lt};H.prepareDrawProgram(ee,Ce);const mn=H.atmosphereBuffer;mn&&Ce.draw(ee,ge.TRIANGLES,Re,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,Pt,"skybox",mn.vertexBuffer,mn.indexBuffer,mn.segments)}(this,this.style.fog),this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const H=this.style._layers[C[this.currentLayer]],$=c._getLayerSourceCache(H);H.isSky()&&this.renderLayer(this,$,H,$?L[$.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<C.length;){const H=this.style._layers[C[this.currentLayer]],$=c._getLayerSourceCache(H);if(H.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(H)){if(H.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const ee=$?("symbol"===H.type?F:L)[$.id]:void 0;this._renderTileClippingMasks(H,$,$?A[$.id]:void 0),this.renderLayer(this,$,H,ee),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let H=null;p.values(this.style._layers).forEach($=>{const ee=c._getLayerSourceCache($);ee&&!$.isHidden(this.transform.zoom)&&(!H||H.getSource().maxzoom<ee.getSource().maxzoom)&&(H=ee)}),H&&this.options.showTileBoundaries&&Si.debug(this,H,H.getVisibleCoordinates())}this.options.showPadding&&function(H){const $=H.transform.padding;Mc(H,H.transform.height-($.top||0),3,gl),Mc(H,$.bottom||0,3,sa),Or(H,$.left||0,3,Zl),Or(H,H.transform.width-($.right||0),3,Bi);const ee=H.transform.centerPoint;var ge,De,Re,Ce;Cs(ge=H,(De=ee.x)-1,(Re=H.transform.height-ee.y)-10,2,20,Ce=tp),Cs(ge,De-10,Re-1,20,2,Ce)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(c,g,C,T){C.isHidden(this.transform.zoom)||("background"===C.type||"sky"===C.type||"custom"===C.type||T&&T.length)&&(this.id=C.id,this.gpuTimingStart(C),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(C.type)||c.terrain&&"custom"===C.type)&&Si[C.type](c,g,C,T,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const g=this.context.extTimerQuery;let C=this.gpuTimers[c.id];C||(C=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:g.createQueryEXT()}),C.calls++,g.beginQueryEXT(g.TIME_ELAPSED_EXT,C.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,g=c.createQueryEXT();this.deferredRenderGpuTimeQueries.push(g),c.beginQueryEXT(c.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const g={};for(const C in c){const T=c[C],A=this.context.extTimerQuery,L=A.getQueryObjectEXT(T.query,A.QUERY_RESULT_EXT)/1e6;A.deleteQueryEXT(T.query),g[C]=L}return g}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const g=this.context.extTimerQuery;let C=0;for(const T of c)C+=g.getQueryObjectEXT(T,g.QUERY_RESULT_EXT)/1e6,g.deleteQueryEXT(T);return C}translatePosMatrix(c,g,C,T,A){if(!C[0]&&!C[1])return c;const L=A?"map"===T?this.transform.angle:0:"viewport"===T?-this.transform.angle:0;if(L){const H=Math.sin(L),$=Math.cos(L);C=[C[0]*$-C[1]*H,C[0]*H+C[1]*$]}const F=[A?C[0]:it(g,C[0],this.transform.zoom),A?C[1]:it(g,C[1],this.transform.zoom),0],V=new Float32Array(16);return p.translate(V,c,F),V}saveTileTexture(c){const g=this._tileTextures[c.size[0]];g?g.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const g=this._tileTextures[c];return g&&g.length>0?g.pop():null}isPatternMissing(c){return null===c||void 0!==c&&!this.imageManager.getPattern(c.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const c=this.terrain&&this.terrain.renderingToTexture,g=this.terrain&&0===this.terrain.exaggeration(),C=this.style&&this.style.fog,T=[];return this.terrainRenderModeElevated()&&T.push("TERRAIN"),"globe"===this.transform.projection.name&&T.push("GLOBE"),g&&T.push("ZERO_EXAGGERATION"),C&&!c&&0!==C.getOpacity(this.transform.pitch)&&T.push("FOG"),c&&T.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&T.push("OVERDRAW_INSPECTOR"),T}useProgram(c,g,C){this.cache=this.cache||{};const T=C||[],A=this.currentGlobalDefines().concat(T),L=Ci.cacheKey(jo[c],c,A,g);return this.cache[L]||(this.cache[L]=new Ci(this.context,c,jo[c],g,Fd[c],A)),this.cache[L]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(c,g,C){if(this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const A=T.getOpacity(this.transform.pitch),L=((F,V,H,$,ee,ge,De,Re,Ce,Le,te)=>{const Se=F.transform,Ue=V.properties.get("color").toArray01();Ue[3]=$;const He=F.frameCounter/1e3%1;return{u_fog_matrix:H?Se.calculateFogTileMatrix(H):F.identityMat,u_fog_range:V.getFovAdjustedRange(Se._fov),u_fog_color:Ue,u_fog_horizon_blend:V.properties.get("horizon-blend"),u_fog_temporal_offset:He,u_frustum_tl:ee,u_frustum_tr:ge,u_frustum_br:De,u_frustum_bl:Re,u_globe_pos:Ce,u_globe_radius:Le,u_viewport:te,u_globe_transition:p.globeToMercatorTransition(Se.zoom),u_is_globe:+("globe"===Se.projection.name)}})(this,T,C,A,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.exported.devicePixelRatio,this.transform.height*p.exported.devicePixelRatio]);g.setFogUniformValues(c,L)}}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,g=c.createTexture();return c.bindTexture(c.TEXTURE_2D,g),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),g}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&0!==c.getOpacity(this.transform.pitch)}getBackgroundTiles(){const c=this._backgroundTiles,g=this._backgroundTiles={},C=this.transform.coveringTiles({tileSize:512});for(const T of C)g[T.key]=c[T.key]||new p.Tile(T,512,this.transform.tileZoom,this);return g}clearBackgroundTiles(){this._backgroundTiles={}}}class ol{constructor(c=0,g=0,C=0,T=0){if(isNaN(c)||c<0||isNaN(g)||g<0||isNaN(C)||C<0||isNaN(T)||T<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=g,this.left=C,this.right=T}interpolate(c,g,C){return null!=g.top&&null!=c.top&&(this.top=p.number(c.top,g.top,C)),null!=g.bottom&&null!=c.bottom&&(this.bottom=p.number(c.bottom,g.bottom,C)),null!=g.left&&null!=c.left&&(this.left=p.number(c.left,g.left,C)),null!=g.right&&null!=c.right&&(this.right=p.number(c.right,g.right,C)),this}getCenter(c,g){const C=p.clamp((this.left+c-this.right)/2,0,c),T=p.clamp((this.top+g-this.bottom)/2,0,g);return new p.Point(C,T)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new ol(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Zo(x,c){const g=p.getColumn(x,3);p.fromQuat(x,c),p.setColumn(x,3,g)}function Gr(x,c){const g=p.identity$1([]);return p.rotateZ$1(g,g,-c),p.rotateX$1(g,g,-x),g}function mu(x,c){const g=[x[0],x[1],0],C=[c[0],c[1],0];if(p.length(g)>=1e-15){const L=p.normalize([],g);p.scale$2(C,L,p.dot(C,L)),c[0]=C[0],c[1]=C[1]}const T=p.cross([],c,x);if(p.len(T)<1e-15)return null;const A=Math.atan2(-T[1],T[0]);return Gr(Math.atan2(Math.sqrt(x[0]*x[0]+x[1]*x[1]),-x[2]),A)}class is{constructor(c,g){this.position=c,this.orientation=g}get position(){return this._position}set position(c){if(c){const g=c instanceof p.MercatorCoordinate?c:new p.MercatorCoordinate(c[0],c[1],c[2]);this._renderWorldCopies&&(g.x=p.wrap(g.x,0,1)),this._position=g}else this._position=null}lookAtPoint(c,g){if(this.orientation=null,!this.position)return;const C=this.position,T=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(c)):0,A=p.MercatorCoordinate.fromLngLat(c,T),L=[A.x-C.x,A.y-C.y,A.z-C.z];g||(g=[0,0,1]),g[2]=Math.abs(g[2]),this.orientation=mu(L,g)}setPitchBearing(c,g){this.orientation=Gr(p.degToRad(c),p.degToRad(-g))}}class Bn{constructor(c,g){this._transform=p.identity([]),this.orientation=g,this.position=c}get mercatorPosition(){const c=this.position;return new p.MercatorCoordinate(c[0],c[1],c[2])}get position(){const c=p.getColumn(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var g;c&&p.setColumn(this._transform,3,[(g=c)[0],g[1],g[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||p.identity$1([]),c&&Zo(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),g=this.right();return{bearing:Math.atan2(-g[1],g[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,g){this._orientation=Gr(c,g),Zo(this._transform,this._orientation)}forward(){const c=p.getColumn(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=p.getColumn(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=p.getColumn(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,g){const C=new Float64Array(16);return p.invert(C,this.getWorldToCamera(c,g)),C}getWorldToCameraPosition(c,g,C){const T=this.position;p.scale$2(T,T,-c);const A=new Float64Array(16);return p.fromScaling(A,[C,C,C]),p.translate(A,A,T),A[10]*=g,A}getWorldToCamera(c,g){const C=new Float64Array(16),T=new Float64Array(4),A=this.position;return p.conjugate(T,this._orientation),p.scale$2(A,A,-c),p.fromQuat(C,T),p.translate(C,C,A),C[1]*=-1,C[5]*=-1,C[9]*=-1,C[13]*=-1,C[8]*=g,C[9]*=g,C[10]*=g,C[11]*=g,C}getCameraToClipPerspective(c,g,C,T){const A=new Float64Array(16);return p.perspective(A,c,g,C,T),A}getDistanceToElevation(c,g=!1){const C=0===c?0:p.mercatorZfromAltitude(c,g?p.latFromMercatorY(this.position[1]):this.position[1]),T=this.forward();return(C-this.position[2])/T[2]}clone(){return new Bn([...this.position],[...this.orientation])}}function Ar(x,c){const g=Ds(x.projection,x.zoom,x.width,x.height),C=function(A,L,F,V,H){const $=new p.LngLat(F.lng-180*Ii,F.lat),ee=new p.LngLat(F.lng+180*Ii,F.lat),ge=A.project($.lng,$.lat),De=A.project(ee.lng,ee.lat),Re=-Math.atan2(De.y-ge.y,De.x-ge.x),Ce=p.MercatorCoordinate.fromLngLat(F);Ce.y=p.clamp(Ce.y,-1+Ii,1-Ii);const Le=Ce.toLngLat(),te=A.project(Le.lng,Le.lat),Se=p.MercatorCoordinate.fromLngLat(Le);Se.x+=Ii;const Ue=Se.toLngLat(),He=A.project(Ue.lng,Ue.lat),lt=$u(He.x-te.x,He.y-te.y,Re),ut=p.MercatorCoordinate.fromLngLat(Le);ut.y+=Ii;const ct=ut.toLngLat(),yt=A.project(ct.lng,ct.lat),xt=$u(yt.x-te.x,yt.y-te.y,Re),Bt=Math.abs(lt.x)/Math.abs(xt.y),Qt=p.identity([]);p.rotateZ(Qt,Qt,-Re*(1-(H?0:V)));const Nt=p.identity([]);return p.scale(Nt,Nt,[1,1-(1-Bt)*V,1]),Nt[4]=-xt.x/xt.y*V,p.rotateZ(Nt,Nt,Re),p.multiply(Nt,Qt,Nt),Nt}(x.projection,0,x.center,g,c),T=mi(x);return p.scale(C,C,[T,T,1]),C}function mi(x){const c=x.projection,g=Ds(x.projection,x.zoom,x.width,x.height),C=Oa(c,x.center),T=Oa(c,p.LngLat.convert(c.center));return Math.pow(2,C*g+(1-g)*T)}function Ds(x,c,g,C,T=1/0){const A=x.range;if(!A)return 0;const L=Math.min(T,Math.max(g,C)),F=Math.log(L/1024)/Math.LN2;return p.smoothstep(A[0]+F,A[1]+F,c)}const Ii=1/4e4;function Oa(x,c){const g=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),C=new p.LngLat(c.lng-180*Ii,g),T=new p.LngLat(c.lng+180*Ii,g),A=x.project(C.lng,g),L=x.project(T.lng,g),F=p.MercatorCoordinate.fromLngLat(C),V=p.MercatorCoordinate.fromLngLat(T),H=L.x-A.x,$=L.y-A.y,ee=V.x-F.x,ge=V.y-F.y,De=Math.sqrt((ee*ee+ge*ge)/(H*H+$*$));return Math.log(De)/Math.LN2}function $u(x,c,g){const C=Math.cos(g),T=Math.sin(g);return{x:x*C-c*T,y:x*T+c*C}}class ai{constructor(c,g,C,T,A,L,F){this.tileSize=512,this._renderWorldCopies=void 0===A||A,this._minZoom=c||0,this._maxZoom=g||22,this._minPitch=C??0,this._maxPitch=T??60,this.setProjection(L),this.setMaxBounds(F),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ol,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Bn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const c=new ai(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(c,g=!1){const C=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||C)&&this._updateCameraOnTerrain(),(c||C)&&this._constrainCamera(g),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const g=this.projection?this.getProjection():void 0;this.projection=p.getProjection(this.projectionOptions);const C=!be(g,this.getProjection());return C&&this._calcMatrices(),this.mercatorFromTransition=!1,C}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.getProjection({name:"mercator"});const g=c!==this.projection.name;return g&&this._calcMatrices(),g}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(c){void 0===c?c=!0:null===c&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.Point(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const g=-c*Math.PI/180;var C,T,A,L,F,V,H,$,ee,ge;this.angle!==g&&(this._unmodified=!1,this.angle=g,this._calcMatrices(),this.rotationMatrix=(C=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(C[1]=0,C[2]=0),C[0]=1,C[3]=1,C),T=this.rotationMatrix,L=this.angle,F=(A=this.rotationMatrix)[0],V=A[1],H=A[2],$=A[3],ee=Math.sin(L),ge=Math.cos(L),T[0]=F*ge+H*ee,T[1]=V*ge+$*ee,T[2]=F*-ee+H*ge,T[3]=V*-ee+$*ge)}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const g=p.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==g&&(this._unmodified=!1,this._pitch=g,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=p.degToRad(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const g=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==g&&(this._unmodified=!1,this._setZoom(g),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;this._centerAltitude=c.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=c.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,g=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],C=this.horizonLineFromTop();let T=0,A=0;for(let L=0;L<g.length;L++){const F=new p.Point(g[L][0]*this.width,C+g[L][1]*(this.height-C)),V=c.pointCoordinate(F);if(!V)continue;const H=1/Math.hypot(V[0]-this._camera.position[0],V[1]-this._camera.position[1]);T+=V[3]*H,A+=H}return 0===A?NaN:T/A}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const c=this._seaLevelZoom,g=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),C=this.pixelsPerMeter/this.worldSize*g,T=this._mercatorZfromZoom(c),A=this._mercatorZfromZoom(this._maxZoom),L=Math.max(T-C,A);this._setZoom(this._zoomFromMercatorZ(L))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const g=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let C;C=c.z<this._camera.position[2]?[g.x,g.y,g.z]:[c.x,c.y,c.z];const T=p.length(p.sub([],this._camera.position,C));return p.clamp(this._zoomFromMercatorZ(T),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let g=!1;if(c.orientation&&!p.exactEquals(c.orientation,this._camera.orientation)&&(g=this._setCameraOrientation(c.orientation)),c.position){const C=[c.position.x,c.position.y,c.position.z];p.exactEquals$1(C,this._camera.position)||(this._setCameraPosition(C),g=!0)}g&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,g=new is;return g.position=new p.MercatorCoordinate(c[0],c[1],c[2]),g.orientation=this._camera.orientation,g._elevation=this.elevation,g._renderWorldCopies=this.renderWorldCopies,g}_setCameraOrientation(c){if(!p.length$1(c))return!1;p.normalize$1(c,c);const g=p.transformQuat([],[0,0,-1],c),C=p.transformQuat([],[0,-1,0],c);if(C[2]<0)return!1;const T=mu(g,C);return!!T&&(this._camera.orientation=T,!0)}_setCameraPosition(c){const g=this.zoomScale(this.minZoom)*this.tileSize,C=this.zoomScale(this.maxZoom)*this.tileSize,T=this.cameraToCenterDistance;c[2]=p.clamp(c[2],T/C,T/g),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,g,C){this._unmodified=!1,this._edgeInsets.interpolate(c,g,C),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const g=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,g)}getVisibleUnwrappedCoordinates(c){const g=[new p.UnwrappedTileID(0,c)];if(this.renderWorldCopies){const C=this.pointCoordinate(new p.Point(0,0)),T=this.pointCoordinate(new p.Point(this.width,0)),A=this.pointCoordinate(new p.Point(this.width,this.height)),L=this.pointCoordinate(new p.Point(0,this.height)),F=Math.floor(Math.min(C.x,T.x,A.x,L.x)),V=Math.floor(Math.max(C.x,T.x,A.x,L.x)),H=1;for(let $=F-H;$<=V+H;$++)0!==$&&g.push(new p.UnwrappedTileID($,c))}return g}coveringTiles(c){let g=this.coveringZoomLevel(c);const C=g,T=this.elevation&&!c.isTerrainDEM,A="mercator"===this.projection.name;if(void 0!==c.minzoom&&g<c.minzoom)return[];void 0!==c.maxzoom&&g>c.maxzoom&&(g=c.maxzoom);const L=this.locationCoordinate(this.center),F=this.center.lat,V=1<<g,H=[V*L.x,V*L.y,0],$="globe"===this.projection.name,ee=!$,ge=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g,ee),De=$?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Re=V*p.mercatorZfromAltitude(1,this.center.lat),Ce=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),Le=[V*De.x,V*De.y,Ce*(ee?1:Re)],te=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),Se=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?g:0,Ue=c.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,He=c.isTerrainDEM?-Ue:this._elevation?this._elevation.getMinElevationBelowMSL():0,lt=this.projection.isReprojectedInTileSpace?mi(this):1,ut=Ft=>{const an=new p.MercatorCoordinate(Ft.x+25e-6,Ft.y,Ft.z),ln=new p.MercatorCoordinate(Ft.x,Ft.y+25e-6,Ft.z),xn=Ft.toLngLat(),cr=an.toLngLat(),br=ln.toLngLat(),Hn=this.locationCoordinate(xn),vr=this.locationCoordinate(cr),ci=this.locationCoordinate(br),li=Math.hypot(vr.x-Hn.x,vr.y-Hn.y),nr=Math.hypot(ci.x-Hn.x,ci.y-Hn.y);return Math.sqrt(li*nr)*lt/25e-6},ct=Ft=>{const Yt=Ue,an=He;return{aabb:p.tileAABB(this,V,0,0,0,Ft,an,Yt,this.projection),zoom:0,x:0,y:0,minZ:an,maxZ:Yt,wrap:Ft,fullyVisible:!1}},yt=[];let xt=[];const Bt=g,Qt=c.reparseOverscaled?C:g,Nt=Ft=>Ft*Ft,Jt=Nt((Ce-this._centerAltitude)*Re),Pt=Ft=>{if(!this._elevation||!Ft.tileID||!A)return;const Yt=this._elevation.getMinMaxForTile(Ft.tileID),an=Ft.aabb;Yt?(an.min[2]=Yt.min,an.max[2]=Yt.max,an.center[2]=(an.min[2]+an.max[2])/2):(Ft.shouldSplit=mn(Ft),Ft.shouldSplit||(an.min[2]=an.max[2]=an.center[2]=this._centerAltitude))},mn=Ft=>{if(Ft.zoom<Se)return!0;if(Ft.zoom===Bt)return!1;if(null!=Ft.shouldSplit)return Ft.shouldSplit;const Yt=Ft.aabb.distanceX(Le),an=Ft.aabb.distanceY(Le);let ln=Jt,xn=1;if($){ln=Nt(Ft.aabb.distanceZ(Le));const Hn=Math.pow(2,Ft.zoom),vr=p.latFromMercatorY((Ft.y+1)/Hn),ci=p.latFromMercatorY(Ft.y/Hn),li=Math.min(Math.max(F,vr),ci),nr=p.circumferenceAtLatitude(li)/p.circumferenceAtLatitude(F);if(xn=li===F?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,nr/this._mercatorScaleRatio),this.zoom<=p.GLOBE_ZOOM_THRESHOLD_MIN&&Ft.zoom===Bt-1&&nr>=.9)return!0}else if(T&&(ln=Nt(Ft.aabb.distanceZ(Le)*Re)),this.projection.isReprojectedInTileSpace&&C<=5){const Hn=Math.pow(2,Ft.zoom),vr=ut(new p.MercatorCoordinate((Ft.x+.5)/Hn,(Ft.y+.5)/Hn));xn=vr>.85?1:vr}const cr=Yt*Yt+an*an+ln;return cr<Nt((1<<Bt-Ft.zoom)*te*xn*((Hn,vr)=>{if(vr*Nt(.707)<Hn)return 1;const ci=Math.sqrt(vr/Hn);return ci/(1.4144271570014144+(Math.pow(1.1,ci-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ln,Jt),cr))};if(this.renderWorldCopies)for(let Ft=1;Ft<=3;Ft++)yt.push(ct(-Ft)),yt.push(ct(Ft));for(yt.push(ct(0));yt.length>0;){const Ft=yt.pop(),Yt=Ft.x,an=Ft.y;let ln=Ft.fullyVisible;if(!ln){const xn=Ft.aabb.intersects(ge);if(0===xn)continue;ln=2===xn}if(Ft.zoom!==Bt&&mn(Ft))for(let xn=0;xn<4;xn++){const cr=(Yt<<1)+xn%2,br=(an<<1)+(xn>>1),Hn={aabb:A?Ft.aabb.quadrant(xn):p.tileAABB(this,V,Ft.zoom+1,cr,br,Ft.wrap,Ft.minZ,Ft.maxZ,this.projection),zoom:Ft.zoom+1,x:cr,y:br,wrap:Ft.wrap,fullyVisible:ln,tileID:void 0,shouldSplit:void 0,minZ:Ft.minZ,maxZ:Ft.maxZ};T&&!$&&(Hn.tileID=new p.OverscaledTileID(Ft.zoom+1===Bt?Qt:Ft.zoom+1,Ft.wrap,Ft.zoom+1,cr,br),Pt(Hn)),yt.push(Hn)}else{const xn=Ft.zoom===Bt?Qt:Ft.zoom;if(c.minzoom&&c.minzoom>xn)continue;const cr=H[0]-(.5+Yt+(Ft.wrap<<Ft.zoom))*(1<<g-Ft.zoom),br=H[1]-.5-an,Hn=Ft.tileID?Ft.tileID:new p.OverscaledTileID(xn,Ft.wrap,Ft.zoom,Yt,an);xt.push({tileID:Hn,distanceSq:cr*cr+br*br})}}if(this.fogCullDistSq){const Ft=this.fogCullDistSq,Yt=this.horizonLineFromTop();xt=xt.filter(an=>{const ln=[0,0,0,1],xn=[p.EXTENT,p.EXTENT,0,1],cr=this.calculateFogTileMatrix(an.tileID.toUnwrapped());p.transformMat4$1(ln,ln,cr),p.transformMat4$1(xn,xn,cr);const br=p.getAABBPointSquareDist(ln,xn);if(0===br)return!0;let Hn=!1;const vr=this._elevation;if(vr&&br>Ft&&0!==Yt){const ci=this.calculateProjMatrix(an.tileID.toUnwrapped());let li;c.isTerrainDEM||(li=vr.getMinMaxForTile(an.tileID)),li||(li={min:He,max:Ue});const nr=p.furthestTileCorner(this.rotation),So=[nr[0]*p.EXTENT,nr[1]*p.EXTENT,li.max];p.transformMat4(So,So,ci),Hn=(1-So[1])*this.height*.5<Yt}return br<Ft||Hn})}return xt.sort((Ft,Yt)=>Ft.distanceSq-Yt.distanceSq).map(Ft=>Ft.tileID)}resize(c,g){this.width=c,this.height=g,this.pixelsToGLUnits=[2/c,-2/g],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const g=p.clamp(c.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),C=this.projection.project(c.lng,g);return new p.Point(C.x*this.worldSize,C.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/p.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,g){let C,T;const A=this.centerPoint;if("globe"===this.projection.name){const F=this.worldSize;C=(g.x-A.x)/F,T=(g.y-A.y)/F}else{const F=this.pointCoordinate(g),V=this.pointCoordinate(A);C=F.x-V.x,T=F.y-V.y}const L=this.locationCoordinate(c);this.setLocation(new p.MercatorCoordinate(L.x-C,L.y-T))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,g){const C=g?p.mercatorZfromAltitude(g,c.lat):void 0,T=this.projection.project(c.lng,c.lat);return new p.MercatorCoordinate(T.x,T.y,C)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,g){const C=g??this._centerAltitude,T=[c.x,c.y,0,1],A=[c.x,c.y,1,1];p.transformMat4$1(T,T,this.pixelMatrixInverse),p.transformMat4$1(A,A,this.pixelMatrixInverse);const L=A[3];p.scale$1(T,T,1/T[3]),p.scale$1(A,A,1/L);const F=T[2],V=A[2];return{p0:T,p1:A,t:F===V?0:(C-F)/(V-F)}}screenPointToMercatorRay(c){const g=[c.x,c.y,0,1],C=[c.x,c.y,1,1];return p.transformMat4$1(g,g,this.pixelMatrixInverse),p.transformMat4$1(C,C,this.pixelMatrixInverse),p.scale$1(g,g,1/g[3]),p.scale$1(C,C,1/C[3]),g[2]=p.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,C[2]=p.mercatorZfromAltitude(C[2],this._center.lat)*this.worldSize,p.scale$1(g,g,1/this.worldSize),p.scale$1(C,C,1/this.worldSize),new p.Ray([g[0],g[1],g[2]],p.normalize([],p.sub([],C,g)))}rayIntersectionCoordinate(c){const{p0:g,p1:C,t:T}=c,A=p.mercatorZfromAltitude(g[2],this._center.lat),L=p.mercatorZfromAltitude(C[2],this._center.lat);return new p.MercatorCoordinate(p.number(g[0],C[0],T)/this.worldSize,p.number(g[1],C[1],T)/this.worldSize,p.number(A,L,T))}pointCoordinate(c,g=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,g)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let g=this.projection.pointCoordinate3D(this,c.x,c.y);if(g)return new p.MercatorCoordinate(g[0],g[1],g[2]);let C=0,T=this.horizonLineFromTop();if(c.y>T)return this.pointCoordinate(c);const A=.02*T,L=c.clone();for(let F=0;F<10&&T-C>A;F++){L.y=p.number(C,T,.66);const V=this.projection.pointCoordinate3D(this,L.x,L.y);V?(T=L.y,g=V):C=L.y}return g?new p.MercatorCoordinate(g[0],g[1],g[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}isPointOnSurface(c){if(c.y<0||c.y>this.height||c.x<0||c.x>this.width)return!1;if(this.elevation||this.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(c);const g=this.pointCoordinate(c);return g.y>=0&&g.y<=1}_coordinatePoint(c,g){const C=g&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,T=[c.x*this.worldSize,c.y*this.worldSize,C+c.toAltitude(),1];return p.transformMat4$1(T,T,this.pixelMatrix),T[3]>0?new p.Point(T[0]/T[3],T[1]/T[3]):new p.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:g}=this._edgeInsets,C=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,A=this.pointLocation3D(new p.Point(g,c)),L=this.pointLocation3D(new p.Point(T,c)),F=this.pointLocation3D(new p.Point(T,C)),V=this.pointLocation3D(new p.Point(g,C));let H=Math.min(A.lng,L.lng,F.lng,V.lng),$=Math.max(A.lng,L.lng,F.lng,V.lng),ee=Math.min(A.lat,L.lat,F.lat,V.lat),ge=Math.max(A.lat,L.lat,F.lat,V.lat);const De=Math.pow(2,-this.zoom)/16*270,Re="globe"===this.projection.name?1:4,Ce=(Le,te,Se,Ue,He)=>{const lt=(Le+Se)/2,ut=(te+Ue)/2,ct=new p.Point(lt,ut),{lng:yt,lat:xt}=this.pointLocation3D(ct),Bt=Math.max(0,H-yt,ee-xt,yt-$,xt-ge);H=Math.min(H,yt),$=Math.max($,yt),ee=Math.min(ee,xt),ge=Math.max(ge,xt),(He<Re||Bt>De)&&(Ce(Le,te,lt,ut,He+1),Ce(lt,ut,Se,Ue,He+1))};if(Ce(g,c,T,c,1),Ce(T,c,T,C,1),Ce(T,C,g,C,1),Ce(g,C,g,c,1),"globe"===this.projection.name){const[Le,te]=p.polesInViewport(this);Le?(ge=90,$=180,H=-180):te&&(ee=-90,$=180,H=-180)}return new p.LngLatBounds(new p.LngLat(H,ee),new p.LngLat($,ge))}_getBoundsRectangular(c,g){const{top:C,left:T}=this._edgeInsets,A=this.height-this._edgeInsets.bottom,L=this.width-this._edgeInsets.right,F=new p.Point(T,C),V=new p.Point(L,C),H=new p.Point(L,A),$=new p.Point(T,A);let ee=this.pointCoordinate(F,c),ge=this.pointCoordinate(V,c);const De=this.pointCoordinate(H,g),Re=this.pointCoordinate($,g),Ce=(Le,te)=>(te.y-Le.y)/(te.x-Le.x);return ee.y>1&&ge.y>=0?ee=new p.MercatorCoordinate((1-Re.y)/Ce(Re,ee)+Re.x,1):ee.y<0&&ge.y<=1&&(ee=new p.MercatorCoordinate(-Re.y/Ce(Re,ee)+Re.x,0)),ge.y>1&&ee.y>=0?ge=new p.MercatorCoordinate((1-De.y)/Ce(De,ge)+De.x,1):ge.y<0&&ee.y<=1&&(ge=new p.MercatorCoordinate(-De.y/Ce(De,ge)+De.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(ge)).extend(this.coordinateLocation(Re)).extend(this.coordinateLocation(De))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const g=c.visibleDemTiles.reduce((C,T)=>{if(T.dem){const A=T.dem.tree;C.min=Math.min(C.min,A.minimums[0]),C.max=Math.max(C.max,A.maximums[0])}return C},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(g.min*c.exaggeration(),g.max*c.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const g=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,C=this.height/2-g*(1-this._horizonShift);return c?Math.max(0,C):C}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,g){return this.projection.createTileMatrix(this,g,c)}calculateDistanceTileData(c){const g=c.key,C=this._distanceTileDataCache;if(C[g])return C[g];const T=c.canonical,A=1/this.height,L=this.cameraWorldSize,F=L/this.zoomScale(T.z),V=(T.x+Math.pow(2,T.z)*c.wrap)*F,H=T.y*F,$=this.point;$.x*=L/this.worldSize,$.y*=L/this.worldSize;const ee=this.angle,ge=Math.sin(-ee),De=-Math.cos(-ee);return C[g]={bearing:[ge,De],center:[($.x-V)*A,($.y-H)*A],scale:F/p.EXTENT*A},C[g]}calculateFogTileMatrix(c){const g=c.key,C=this._fogTileMatrixCache;if(C[g])return C[g];const T=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return p.multiply(T,this.worldToFogMatrix,T),C[g]=new Float32Array(T),C[g]}calculateProjMatrix(c,g=!1){const C=c.key,T=g?this._alignedProjMatrixCache:this._projMatrixCache;if(T[C])return T[C];const A=this.calculatePosMatrix(c,this.worldSize);return p.multiply(A,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.alignedProjMatrix:this.projMatrix,A),T[C]=new Float32Array(A),T[C]}calculatePixelsToTileUnitsMatrix(c){const g=c.tileID.key,C=this._pixelsToTileUnitsCache;if(C[g])return C[g];const T=function(A,L){const{scale:F}=A.tileTransform,V=F*p.EXTENT/(A.tileSize*Math.pow(2,L.zoom-A.tileID.overscaledZ+A.tileID.canonical.z));return H=new Float32Array(4),ge=($=L.inverseAdjustmentMatrix)[1],De=$[2],Re=$[3],Le=(ee=[V,V])[1],H[0]=$[0]*(Ce=ee[0]),H[1]=ge*Ce,H[2]=De*Le,H[3]=Re*Le,H;var H,$,ee,ge,De,Re,Ce,Le}(c,this);return C[g]=T,C[g]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const c=1/this.worldSize,g=p.fromScaling([],[c,c,c]);return p.multiply(g,g,this.globeMatrix),g}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const c=this._elevation;this._updateCameraState();const g=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,C=this._computeCameraPosition(g),T=this._camera.forward(),A=p.mercatorZfromAltitude(1,this._center.lat);C[2]/=A,T[2]/=A,p.normalize(T,T);const L=c.raycast(C,T,c.exaggeration());if(L){const F=p.scaleAndAdd([],C,T,L),V=new p.MercatorCoordinate(F[0],F[1],p.mercatorZfromAltitude(F[2],p.latFromMercatorY(F[1]))),H=(V.z+p.length([V.x-C[0],V.y-C[1],V.z-C[2]*A]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(H),this._centerAltitude=V.toAltitude(),this._center=this.coordinateLocation(V),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const g=this._elevation,C=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,T=this._computeCameraPosition(C),A=g.getAtPointOrZero(new p.MercatorCoordinate(...T)),L=this.pixelsPerMeter/this.worldSize*A,F=this._minimumHeightOverTerrain(),V=T[2]-L;if(V<=F)if(V<0||c){const H=this.locationCoordinate(this._center,this._centerAltitude),$=[T[0],T[1],H.z-T[2]],ee=p.length($);$[2]-=(F-V)/this._pixelsPerMercatorPixel;const ge=p.length($);if(0===ge)return;p.scale$2($,$,ee/ge*this._pixelsPerMercatorPixel),this._camera.position=[T[0],T[1],H.z*this._pixelsPerMercatorPixel-$[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const ge=this.center;return ge.lat=p.clamp(ge.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(ge.lng=p.clamp(ge.lng,this.minLng,this.maxLng)),this.center=ge,void(this._constraining=!1)}const g=this._unmodified,{x:C,y:T}=this.point;let A=0,L=C,F=T;const V=this.width/2,H=this.height/2,$=this.worldMinY*this.scale,ee=this.worldMaxY*this.scale;if(T-H<$&&(F=$+H),T+H>ee&&(F=ee-H),ee-$<this.height&&(A=Math.max(A,this.height/(ee-$)),F=(ee+$)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ge=this.worldMinX*this.scale,De=this.worldMaxX*this.scale,Re=this.worldSize/2-(ge+De)/2;L=(C+Re+this.worldSize)%this.worldSize-Re,L-V<ge&&(L=ge+V),L+V>De&&(L=De-V),De-ge<this.width&&(A=Math.max(A,this.width/(De-ge)),L=(De+ge)/2)}L===C&&F===T||(this.center=this.unproject(new p.Point(L,F))),A&&(this.zoom+=this.scaleZoom(A)),this._constrainCamera(),this._unmodified=g,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,g=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.mercatorZfromAltitude(1,this.center.lat)/p.mercatorZfromAltitude(1,p.GLOBE_SCALE_MATCH_LATITUDE));const C=Ds(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,C),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const T="meters"===this.projection.zAxisUnit?g:1,A=this._camera.getWorldToCamera(this.worldSize,T),L=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);L[8]=2*-c.x/this.width,L[9]=2*c.y/this.height;let F=p.mul([],L,A);if(this.projection.isReprojectedInTileSpace){const ut=this.locationCoordinate(this.center),ct=p.identity([]);p.translate(ct,ct,[ut.x*this.worldSize,ut.y*this.worldSize,0]),p.multiply(ct,ct,Ar(this)),p.translate(ct,ct,[-ut.x*this.worldSize,-ut.y*this.worldSize,0]),p.multiply(F,F,ct),this.inverseAdjustmentMatrix=function(yt){const xt=Ar(yt,!0);return ne([],[xt[0],xt[1],xt[4],xt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],F,[this.worldSize,this.worldSize,this.worldSize/T,1]),this.projMatrix=F,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const V=p.invert([],L);this.frustumCorners=p.FrustumCorners.fromInvProjectionMatrix(V,this.horizonLineFromTop(),this.height);const H=new Float32Array(16);p.identity(H),p.scale(H,H,[1,-1,1]),p.rotateX(H,H,this._pitch),p.rotateZ(H,H,this.angle);const $=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),ee=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;$[8]=2*-c.x/this.width,$[9]=2*(c.y+ee)/this.height,this.skyboxMatrix=p.multiply(H,$,H);const ge=this.point,De=ge.x,Re=ge.y,Ce=this.width%2/2,Le=this.height%2/2,te=Math.cos(this.angle),Se=Math.sin(this.angle),Ue=De-Math.round(De)+te*Ce+Se*Le,He=Re-Math.round(Re)+te*Le+Se*Ce,lt=new Float64Array(F);if(p.translate(lt,lt,[Ue>.5?Ue-1:Ue,He>.5?He-1:He,0]),this.alignedProjMatrix=lt,F=p.create(),p.scale(F,F,[this.width/2,-this.height/2,1]),p.translate(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=p.create(),p.scale(F,F,[1,-1,1]),p.translate(F,F,[-1,-1,0]),p.scale(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},F=p.invert(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.calculateGlobeMatrix(this);const ut=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.transformMat4(ut,ut,A),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,g=this.cameraPixelsPerMeter,C=this._camera.position,T=1/this.height/this._pixelsPerMercatorPixel,A=[c,c,g];p.scale$2(A,A,T),p.scale$2(C,C,-1),p.multiply$2(C,C,A);const L=p.create();p.translate(L,L,C),p.scale(L,L,A),this.mercatorFogMatrix=L,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,g,T)}_computeCameraPosition(c){const g=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,C=this._camera.forward(),T=this.point,A=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*g-c/this.worldSize*this._centerAltitude;return[T.x/this.worldSize-C[0]*A,T.y/this.worldSize-C[1]*A,c/this.worldSize*this._centerAltitude-C[2]*A]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const g=this._maxCameraBoundsDistance()*Math.cos(this._pitch),C=this._camera.position[2],T=c[2];let A=1;this.projection.wrap&&(this.center=this.center.wrap()),T>0&&(A=Math.min((g-C)/T,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,c,A),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,g=this._camera.forward(),{pitch:C,bearing:T}=this._camera.getPitchBearing(),A=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,L=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),F=Math.max((c[2]-A)/Math.cos(C),L),V=this._zoomFromMercatorZ(F);p.scaleAndAdd(c,c,g,F),this._pitch=p.clamp(C,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(T,-Math.PI,Math.PI),this._setZoom(p.clamp(V,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let g=0,C=p.GLOBE_ZOOM_THRESHOLD_MAX,T=0,A=1/0;for(;C-g>1e-6&&C>g;){const L=g+.5*(C-g),F=this.tileSize*Math.pow(2,L),V=this.getCameraToCenterDistance(this.projection,L,F),H=this.scaleZoom(V/(c*this.tileSize)),$=Math.abs(L-H);$<A&&(A=$,T=L),L<H?g=L:C=L}return T}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,g){const C=Math.min(c.x,g.x),T=Math.max(c.x,g.x),A=Math.min(c.y,g.y),L=Math.max(c.y,g.y);if(A<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const F=[new p.Point(C,A),new p.Point(T,L),new p.Point(C,L),new p.Point(T,A)],V=this.renderWorldCopies?-3:0,H=this.renderWorldCopies?4:1;for(const $ of F){const ee=this.pointRayIntersection($);if(ee.t<0)return!0;const ge=this.rayIntersectionCoordinate(ee);if(ge.x<V||ge.y<0||ge.x>H||ge.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.Point(0,0),new p.Point(this.width,this.height))}zoomDeltaToMovement(c,g){const C=p.length(p.sub([],this._camera.position,c)),T=this._zoomFromMercatorZ(C)+g;return C-this._mercatorZfromZoom(T)}getCameraPoint(){if("globe"===this.projection.name){const c=function([g,C,T],A){const L=[g,C,T,1];p.transformMat4$1(L,L,A);const F=L[3]=Math.max(L[3],1e-6);return L[0]/=F,L[1]/=F,L[2]/=F,L}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.Point(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,c))}}getCameraToCenterDistance(c,g=this.zoom,C=this.worldSize){const T=Ds(c,g,this.width,this.height,1024),A=c.pixelSpaceConversion(this.center.lat,C,T);return.5/Math.tan(.5*this._fov)*this.height*A}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.multiply(c,c,this.globeMatrix),c}}function va(x,c){let g=!1,C=null;const T=()=>{C=null,g&&(x(),C=setTimeout(T,c),g=!1)};return()=>(g=!0,C||T(),C)}class Nu{constructor(c){this._hashName=c&&encodeURIComponent(c),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=va(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,p.window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const g=Pr(c);if(this._hashName){const C=this._hashName;let T=!1;const A=p.window.location.hash.slice(1).split("&").map(L=>{const F=L.split("=")[0];return F===C?(T=!0,`${F}=${g}`):L}).filter(L=>L);return T||A.push(`${C}=${g}`),`#${A.join("&")}`}return`#${g}`}_getCurrentHash(){const c=p.window.location.hash.replace("#","");if(this._hashName){let g;return c.split("&").map(C=>C.split("=")).forEach(C=>{C[0]===this._hashName&&(g=C)}),(g&&g[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const g=this._getCurrentHash();if(g.length>=3&&!g.some(C=>isNaN(C))){const C=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(g[3]||0):c.getBearing();return c.jumpTo({center:[+g[2],+g[1]],zoom:+g[0],bearing:C,pitch:+(g[4]||0)}),!0}return!1}_updateHashUnthrottled(){const c=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,c)}}function Pr(x,c){const g=x.getCenter(),C=Math.round(100*x.getZoom())/100,T=Math.ceil((C*Math.LN2+Math.log(512/360/.5))/Math.LN10),A=Math.pow(10,T),L=Math.round(g.lng*A)/A,F=Math.round(g.lat*A)/A,V=x.getBearing(),H=x.getPitch();let $=c?`/${L}/${F}/${C}`:`${C}/${F}/${L}`;return(V||H)&&($+="/"+Math.round(10*V)/10),H&&($+=`/${Math.round(H)}`),$}const Wa={linearity:.3,easing:p.bezier(0,0,.3,1)},_s=p.extend({deceleration:2500,maxSpeed:1400},Wa),os=p.extend({deceleration:20,maxSpeed:1400},Wa),vn=p.extend({deceleration:1e3,maxSpeed:360},Wa),Mo=p.extend({deceleration:1e3,maxSpeed:90},Wa);class hc{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,g=p.exported.now();for(;c.length>0&&g-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const g={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:A}of this._inertiaBuffer)g.zoom+=A.zoomDelta||0,g.bearing+=A.bearingDelta||0,g.pitch+=A.pitchDelta||0,A.panDelta&&g.pan._add(A.panDelta),A.around&&(g.around=A.around),A.pinchAround&&(g.pinchAround=A.pinchAround);const C=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(g.pan.mag()){const A=Go(g.pan.mag(),C,p.extend({},_s,c||{}));T.offset=g.pan.mult(A.amount/g.pan.mag()),T.center=this._map.transform.center,Za(T,A)}if(g.zoom){const A=Go(g.zoom,C,os);T.zoom=this._map.transform.zoom+A.amount,Za(T,A)}if(g.bearing){const A=Go(g.bearing,C,vn);T.bearing=this._map.transform.bearing+p.clamp(A.amount,-179,179),Za(T,A)}if(g.pitch){const A=Go(g.pitch,C,Mo);T.pitch=this._map.transform.pitch+A.amount,Za(T,A)}if(T.zoom||T.bearing){const A=void 0===g.pinchAround?g.around:g.pinchAround;T.around=A?this._map.unproject(A):this._map.getCenter()}return this.clear(),T.noMoveStart=!0,T}}function Za(x,c){(!x.duration||x.duration<c.duration)&&(x.duration=c.duration,x.easing=c.easing)}function Go(x,c,g){const{maxSpeed:C,linearity:T,deceleration:A}=g,L=p.clamp(x*T/(c/1e3),-C,C),F=Math.abs(L)/(A*T);return{easing:g.easing,duration:1e3*F,amount:L*(F/2)}}class xa extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,g,C,T={}){const A=fe(g.getCanvasContainer(),C),L=g.unproject(A);super(c,p.extend({point:A,lngLat:L,originalEvent:C},T)),this._defaultPrevented=!1,this.target=g}}class Us extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,g,C){const T="touchend"===c?C.changedTouches:C.touches,A=he(g.getCanvasContainer(),T),L=A.map(V=>g.unproject(V)),F=A.reduce((V,H,$,ee)=>V.add(H.div(ee.length)),new p.Point(0,0));super(c,{points:A,point:F,lngLats:L,lngLat:g.unproject(F),originalEvent:C}),this._defaultPrevented=!1}}class Xl extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,g,C){super(c,{originalEvent:C}),this._defaultPrevented=!1}}class Hu{constructor(c,g){this._map=c,this._clickTolerance=g.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new Xl(c.type,this._map,c))}mousedown(c,g){return this._mousedownPos=g,this._firePreventable(new xa(c.type,this._map,c))}mouseup(c){this._map.fire(new xa(c.type,this._map,c))}preclick(c){const g=p.extend({},c);g.type="preclick",this._map.fire(new xa(g.type,this._map,g))}click(c,g){this._mousedownPos&&this._mousedownPos.dist(g)>=this._clickTolerance||(this.preclick(c),this._map.fire(new xa(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new xa(c.type,this._map,c))}mouseover(c){this._map.fire(new xa(c.type,this._map,c))}mouseout(c){this._map.fire(new xa(c.type,this._map,c))}touchstart(c){return this._firePreventable(new Us(c.type,this._map,c))}touchmove(c){this._map.fire(new Us(c.type,this._map,c))}touchend(c){this._map.fire(new Us(c.type,this._map,c))}touchcancel(c){this._map.fire(new Us(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class nh{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new xa(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new xa(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Di{constructor(c,g){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=g.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,g){this.isEnabled()&&c.shiftKey&&0===c.button&&(hn(),this._startPos=this._lastPos=g,this._active=!0)}mousemoveWindow(c,g){if(!this._active)return;const C=g,T=this._startPos,A=this._lastPos;if(!T||!A||A.equals(C)||!this._box&&C.dist(T)<this._clickTolerance)return;this._lastPos=C,this._box||(this._box=Et("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const L=Math.min(T.x,C.x),F=Math.max(T.x,C.x),V=Math.min(T.y,C.y),H=Math.max(T.y,C.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${L}px,${V}px)`,this._box.style.width=F-L+"px",this._box.style.height=H-V+"px")})}mouseupWindow(c,g){if(!this._active)return;const C=this._startPos,T=g;if(C&&0===c.button){if(this.reset(),ue(),C.x!==T.x||C.y!==T.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:A=>A.fitScreenCoordinates(C,T,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&27===c.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),de(),delete this._startPos,delete this._lastPos}_fireEvent(c,g){return this._map.fire(new p.Event(c,{originalEvent:g}))}}function Yl(x,c){const g={};for(let C=0;C<x.length;C++)g[x[C].identifier]=c[C];return g}class Kl{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,g,C){(this.centroid||C.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=c.timeStamp),C.length===this.numTouches&&(this.centroid=function(T){const A=new p.Point(0,0);for(const L of T)A._add(L);return A.div(T.length)}(g),this.touches=Yl(C,g)))}touchmove(c,g,C){if(this.aborted||!this.centroid)return;const T=Yl(C,g);for(const A in this.touches){const L=T[A];(!L||L.dist(this.touches[A])>30)&&(this.aborted=!0)}}touchend(c,g,C){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),0===C.length){const T=!this.aborted&&this.centroid;if(this.reset(),T)return T}}}class dc{constructor(c){this.singleTap=new Kl(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,g,C){this.singleTap.touchstart(c,g,C)}touchmove(c,g,C){this.singleTap.touchmove(c,g,C)}touchend(c,g,C){const T=this.singleTap.touchend(c,g,C);if(T){const A=c.timeStamp-this.lastTime<500,L=!this.lastTap||this.lastTap.dist(T)<30;if(A&&L||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=T,this.count===this.numTaps)return this.reset(),T}}}class _u{constructor(){this._zoomIn=new dc({numTouches:1,numTaps:2}),this._zoomOut=new dc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,g,C){this._zoomIn.touchstart(c,g,C),this._zoomOut.touchstart(c,g,C)}touchmove(c,g,C){this._zoomIn.touchmove(c,g,C),this._zoomOut.touchmove(c,g,C)}touchend(c,g,C){const T=this._zoomIn.touchend(c,g,C),A=this._zoomOut.touchend(c,g,C);return T?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:L=>L.easeTo({duration:300,zoom:L.getZoom()+1,around:L.unproject(T)},{originalEvent:c})}):A?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:L=>L.easeTo({duration:300,zoom:L.getZoom()-1,around:L.unproject(A)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const qu={0:1,2:2};class La{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,g){return!1}_move(c,g){return{}}mousedown(c,g){if(this._lastPoint)return;const C=Fe(c);this._correctButton(c,C)&&(this._lastPoint=g,this._eventButton=C)}mousemoveWindow(c,g){const C=this._lastPoint;if(C)if(c.preventDefault(),null!=this._eventButton&&function(T,A){const L=qu[A];return void 0===T.buttons||(T.buttons&L)!==L}(c,this._eventButton))this.reset();else if(this._moved||!(g.dist(C)<this._clickTolerance))return this._moved=!0,this._lastPoint=g,this._move(C,g)}mouseupWindow(c){this._lastPoint&&Fe(c)===this._eventButton&&(this._moved&&ue(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pu extends La{mousedown(c,g){super.mousedown(c,g),this._lastPoint&&(this._active=!0)}_correctButton(c,g){return 0===g&&!c.ctrlKey}_move(c,g){return{around:g,panDelta:g.sub(c)}}}class Ls extends La{_correctButton(c,g){return 0===g&&c.ctrlKey||2===g}_move(c,g){const C=.8*(g.x-c.x);if(C)return this._active=!0,{bearingDelta:C}}contextmenu(c){c.preventDefault()}}class fc extends La{_correctButton(c,g){return 0===g&&c.ctrlKey||2===g}_move(c,g){const C=-.5*(g.y-c.y);if(C)return this._active=!0,{pitchDelta:C}}contextmenu(c){c.preventDefault()}}class sr{constructor(c,g){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=g.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)}touchstart(c,g,C){return this._calculateTransform(c,g,C)}touchmove(c,g,C){if(this._active&&!(C.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===C.length&&!p.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,g,C)}}touchend(c,g,C){this._calculateTransform(c,g,C),this._active&&C.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,g,C){C.length>0&&(this._active=!0);const T=Yl(C,g),A=new p.Point(0,0),L=new p.Point(0,0);let F=0;for(const H in T){const $=T[H],ee=this._touches[H];ee&&(A._add($),L._add($.sub(ee)),F++,T[H]=$)}if(this._touches=T,F<this._minTouches||!L.mag())return;const V=L.div(F);return this._sum._add(V),this._sum.mag()<this._clickTolerance?void 0:{around:A.div(F),panDelta:V}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Et("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ss{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,g,C){return{}}touchstart(c,g,C){this._firstTwoTouches||C.length<2||(this._firstTwoTouches=[C[0].identifier,C[1].identifier],this._start([g[0],g[1]]))}touchmove(c,g,C){const T=this._firstTwoTouches;if(!T)return;c.preventDefault();const[A,L]=T,F=yu(C,g,A),V=yu(C,g,L);if(!F||!V)return;const H=this._aroundCenter?null:F.add(V).div(2);return this._move([F,V],H,c)}touchend(c,g,C){if(!this._firstTwoTouches)return;const[T,A]=this._firstTwoTouches,L=yu(C,g,T),F=yu(C,g,A);L&&F||(this._active&&ue(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function yu(x,c,g){for(let C=0;C<x.length;C++)if(x[C].identifier===g)return c[C]}function sl(x,c){return Math.log(x/c)/Math.LN2}class ba extends ss{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,g){const C=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(sl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:sl(this._distance,C),pinchAround:g}}}function Al(x,c){return 180*x.angleWith(c)/Math.PI}class ka extends ss{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,g){const C=this._vector;if(this._vector=c[0].sub(c[1]),C&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Al(this._vector,C),pinchAround:g}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const g=25/(Math.PI*this._minDiameter)*360,C=this._startVector;if(!C)return!1;const T=Al(c,C);return Math.abs(T)<g}}function Co(x){return Math.abs(x.y)>Math.abs(x.x)}class yf extends ss{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,Co(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,g,C){const T=this._lastPoints;if(!T)return;const A=c[0].sub(T[0]),L=c[1].sub(T[1]);return this._map._cooperativeGestures&&!p.isFullscreen()&&C.touches.length<3||(this._valid=this.gestureBeginsVertically(A,L,C.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(A.y+L.y)/2*-.5})}gestureBeginsVertically(c,g,C){if(void 0!==this._valid)return this._valid;const T=c.mag()>=2,A=g.mag()>=2;if(!T&&!A)return;if(!T||!A)return null==this._firstMove&&(this._firstMove=C),C-this._firstMove<100&&void 0;const L=c.y>0==g.y>0;return Co(c)&&Co(g)&&L}}const td={panStep:100,bearingStep:15,pitchStep:10};class l{constructor(){const c=td;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let g=0,C=0,T=0,A=0,L=0;switch(c.keyCode){case 61:case 107:case 171:case 187:g=1;break;case 189:case 109:case 173:g=-1;break;case 37:c.shiftKey?C=-1:(c.preventDefault(),A=-1);break;case 39:c.shiftKey?C=1:(c.preventDefault(),A=1);break;case 38:c.shiftKey?T=1:(c.preventDefault(),L=-1);break;case 40:c.shiftKey?T=-1:(c.preventDefault(),L=1);break;default:return}return this._rotationDisabled&&(C=0,T=0),{cameraAnimation:F=>{const V=F.getZoom();F.easeTo({duration:300,easeId:"keyboardHandler",easing:h,zoom:g?Math.round(V)+g*(c.shiftKey?2:1):V,bearing:F.getBearing()+C*this._bearingStep,pitch:F.getPitch()+T*this._pitchStep,offset:[-A*this._panStep,-L*this._panStep],center:F.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function h(x){return x*(2-x)}const y=4.000244140625;class b{constructor(c,g){this._map=c,this._el=c.getCanvasContainer(),this._handler=g,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&"center"===c.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||p.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let g=c.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const C=p.exported.now(),T=C-(this._lastWheelEventTime||0);this._lastWheelEventTime=C,0!==g&&g%y==0?this._type="wheel":0!==g&&Math.abs(g)<4?this._type="trackpad":T>400?(this._type=null,this._lastValue=g,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(T*g)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,g+=this._lastValue)),c.shiftKey&&g&&(g/=4),this._type&&(this._lastWheelEvent=c,this._delta-=g,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const g=fe(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:g,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;"wheel"===this._type&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const g=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(0!==this._delta){const V="wheel"===this._type&&Math.abs(this._delta)>y?this._wheelZoomRate:this._defaultZoomRate;let H=2/(1+Math.exp(-Math.abs(this._delta*V)));this._delta<0&&0!==H&&(H=1/H);const $=g(),ee=Math.pow(2,$),ge="number"==typeof this._targetZoom?c.zoomScale(this._targetZoom):ee;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(ge*H))),"wheel"===this._type&&(this._startZoom=$,this._easing=this._smoothOutEasing(200)),this._delta=0}const C="number"==typeof this._targetZoom?this._targetZoom:g(),T=this._startZoom,A=this._easing;let L,F=!1;if("wheel"===this._type&&T&&A){const V=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),H=A(V);L=p.number(T,C,H),V<1?this._frameId||(this._frameId=!0):F=!0}else L=C,F=!0;return this._active=!0,F&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!F,zoomDelta:L-g(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let g=p.ease;if(this._prevEase){const C=this._prevEase,T=(p.exported.now()-C.start)/C.duration,A=C.easing(T+.01)-C.easing(T),L=.27/Math.sqrt(A*A+1e-4)*.01,F=Math.sqrt(.0729-L*L);g=p.bezier(L,F,.25,1)}return this._prevEase={start:p.exported.now(),duration:c,easing:g},g}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Et("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class I{constructor(c,g){this._clickZoom=c,this._tapZoom=g}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class B{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,g){return c.preventDefault(),{cameraAnimation:C=>{C.easeTo({duration:300,zoom:C.getZoom()+(c.shiftKey?-1:1),around:C.unproject(g)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class j{constructor(){this._tap=new dc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,g,C){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?C.length>0&&(this._swipePoint=g[0],this._swipeTouch=C[0].identifier):this._tap.touchstart(c,g,C))}touchmove(c,g,C){if(this._tapTime){if(this._swipePoint){if(C[0].identifier!==this._swipeTouch)return;const T=g[0],A=T.y-this._swipePoint.y;return this._swipePoint=T,c.preventDefault(),this._active=!0,{zoomDelta:A/128}}}else this._tap.touchmove(c,g,C)}touchend(c,g,C){this._tapTime?this._swipePoint&&0===C.length&&this.reset():this._tap.touchend(c,g,C)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oe{constructor(c,g,C){this._el=c,this._mousePan=g,this._touchPan=C}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Pe{constructor(c,g,C){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=g,this._mousePitch=C}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class st{constructor(c,g,C,T){this._el=c,this._touchZoom=g,this._touchRotate=C,this._tapDragZoom=T,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const kt=x=>x.zoom||x.drag||x.pitch||x.rotate;class qt extends p.Event{}class Pn{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,g){const C=p.sub([],g,c);this.radius=p.length(C[2]<0?p.div([],C,this.constants):[C[0],C[1],0])}projectRay(c){p.div(c,c,this.constants),p.normalize(c,c),p.mul$1(c,c,this.constants);const g=p.scale$2([],c,this.radius);if(g[2]>0){const C=p.scale$2([],[0,0,1],p.dot(g,[0,0,1])),T=p.scale$2([],p.normalize([],[g[0],g[1],0]),this.radius),A=p.add([],g,p.scale$2([],p.sub([],p.add([],T,C),g),2));g[0]=A[0],g[1]=A[1]}return g}}function In(x){return x.panDelta&&x.panDelta.mag()||x.zoomDelta||x.bearingDelta||x.pitchDelta}class zn{constructor(c,g){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hc(c),this._bearingSnap=g.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Pn,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(g),p.bindAll(["handleEvent","handleWindowEvent"],this);const C=this._el;this._listeners=[[C,"touchstart",{passive:!0}],[C,"touchmove",{passive:!1}],[C,"touchend",void 0],[C,"touchcancel",void 0],[C,"mousedown",void 0],[C,"mousemove",void 0],[C,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[C,"mouseover",void 0],[C,"mouseout",void 0],[C,"dblclick",void 0],[C,"click",void 0],[C,"keydown",{capture:!1}],[C,"keyup",void 0],[C,"wheel",{passive:!1}],[C,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[T,A,L]of this._listeners)T.addEventListener(A,T===p.window.document?this.handleWindowEvent:this.handleEvent,L)}destroy(){for(const[c,g,C]of this._listeners)c.removeEventListener(g,c===p.window.document?this.handleWindowEvent:this.handleEvent,C)}_addDefaultHandlers(c){const g=this._map,C=g.getCanvasContainer();this._add("mapEvent",new Hu(g,c));const T=g.boxZoom=new Di(g,c);this._add("boxZoom",T);const A=new _u,L=new B;g.doubleClickZoom=new I(L,A),this._add("tapZoom",A),this._add("clickZoom",L);const F=new j;this._add("tapDragZoom",F);const V=g.touchPitch=new yf(g);this._add("touchPitch",V);const H=new Ls(c),$=new fc(c);g.dragRotate=new Pe(c,H,$),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",$,["mouseRotate"]);const ee=new Pu(c),ge=new sr(g,c);g.dragPan=new oe(C,ee,ge),this._add("mousePan",ee),this._add("touchPan",ge,["touchZoom","touchRotate"]);const De=new ka,Re=new ba;g.touchZoomRotate=new st(C,Re,De,F),this._add("touchRotate",De,["touchPan","touchZoom"]),this._add("touchZoom",Re,["touchPan","touchRotate"]),this._add("blockableMapEvent",new nh(g));const Ce=g.scrollZoom=new b(g,this);this._add("scrollZoom",Ce,["mousePan"]);const Le=g.keyboard=new l;this._add("keyboard",Le);for(const te of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[te]&&g[te].enable(c[te])}_add(c,g,C){this._handlers.push({handlerName:c,handler:g,allowed:C}),this._handlersById[c]=g}stop(c){if(!this._updatingCamera){for(const{handler:g}of this._handlers)g.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!kt(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,g,C){for(const T in c)if(T!==C&&(!g||g.indexOf(T)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const g=[];for(const C of c)this._el.contains(C.target)&&g.push(C);return g}handleEvent(c,g){this._updatingCamera=!0;const C="renderFrame"===c.type,T=C?void 0:c,A={needsRenderFrame:!1},L={},F={},V=c.touches?this._getMapTouches(c.touches):void 0,H=V?he(this._el,V):C?void 0:fe(this._el,c);for(const{handlerName:ge,handler:De,allowed:Re}of this._handlers){if(!De.isEnabled())continue;let Ce;this._blockedByActive(F,Re,ge)?De.reset():De[g||c.type]&&(Ce=De[g||c.type](c,H,V),this.mergeHandlerResult(A,L,Ce,ge,T),Ce&&Ce.needsRenderFrame&&this._triggerRenderFrame()),(Ce||De.isActive())&&(F[ge]=De)}const $={};for(const ge in this._previousActiveHandlers)F[ge]||($[ge]=T);this._previousActiveHandlers=F,(Object.keys($).length||In(A))&&(this._changes.push([A,L,$]),this._triggerRenderFrame()),(Object.keys(F).length||In(A))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ee}=A;ee&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ee(this._map))}mergeHandlerResult(c,g,C,T,A){if(!C)return;p.extend(c,C);const L={handlerName:T,originalEvent:C.originalEvent||A};void 0!==C.zoomDelta&&(g.zoom=L),void 0!==C.panDelta&&(g.drag=L),void 0!==C.pitchDelta&&(g.pitch=L),void 0!==C.bearingDelta&&(g.rotate=L)}_applyChanges(){const c={},g={},C={};for(const[T,A,L]of this._changes)T.panDelta&&(c.panDelta=(c.panDelta||new p.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+T.pitchDelta),void 0!==T.around&&(c.around=T.around),void 0!==T.aroundCoord&&(c.aroundCoord=T.aroundCoord),void 0!==T.pinchAround&&(c.pinchAround=T.pinchAround),T.noInertia&&(c.noInertia=T.noInertia),p.extend(g,A),p.extend(C,L);this._updateMapTransform(c,g,C),this._changes=[]}_updateMapTransform(c,g,C){const T=this._map,A=T.transform,L=Se=>[Se.x,Se.y,Se.z];if((Se=>{const Ue=this._eventsInProgress.drag;return Ue&&!this._handlersById[Ue.handlerName].isActive()})()&&!In(c)){const Se=A.zoom;A.cameraElevationReference="sea",A.recenterOnTerrain(),A.cameraElevationReference="ground",Se!==A.zoom&&this._map._update(!0)}if(A._isCameraConstrained&&T._stop(!0),!In(c))return void this._fireEvents(g,C,!0);let{panDelta:F,zoomDelta:V,bearingDelta:H,pitchDelta:$,around:ee,aroundCoord:ge,pinchAround:De}=c;A._isCameraConstrained&&(V>0&&(V=0),A._isCameraConstrained=!1),void 0!==De&&(ee=De),(V||(Se=>g.drag&&!this._eventsInProgress.drag)())&&ee&&(this._dragOrigin=L(A.pointCoordinate3D(ee)),this._trackingEllipsoid.setup(A._camera.position,this._dragOrigin)),A.cameraElevationReference="sea",T._stop(!0),ee=ee||T.transform.centerPoint,H&&(A.bearing+=H),$&&(A.pitch+=$),A._updateCameraState();const Re=[0,0,0];if(F)if("mercator"===A.projection.name){const Se=this._trackingEllipsoid.projectRay(A.screenPointToMercatorRay(ee).dir),Ue=this._trackingEllipsoid.projectRay(A.screenPointToMercatorRay(ee.sub(F)).dir);Re[0]=Ue[0]-Se[0],Re[1]=Ue[1]-Se[1]}else{const Se=A.pointCoordinate(ee);if("globe"===A.projection.name){F=F.rotate(-A.angle);const Ue=A._pixelsPerMercatorPixel/A.worldSize;Re[0]=-F.x*p.mercatorScale(p.latFromMercatorY(Se.y))*Ue,Re[1]=-F.y*p.mercatorScale(A.center.lat)*Ue}else{const Ue=A.pointCoordinate(ee.sub(F));Se&&Ue&&(Re[0]=Ue.x-Se.x,Re[1]=Ue.y-Se.y)}}const Ce=A.zoom,Le=[0,0,0];if(V){const Se=L(ge||A.pointCoordinate3D(ee)),Ue={dir:p.normalize([],p.sub([],Se,A._camera.position))};if(Ue.dir[2]<0){const He=A.zoomDeltaToMovement(Se,V);p.scale$2(Le,Ue.dir,He)}}const te=p.add(Re,Re,Le);A._translateCameraConstrained(te),V&&Math.abs(A.zoom-Ce)>1e-4&&A.recenterOnTerrain(),A.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(g,C,!0)}_fireEvents(c,g,C){const T=kt(this._eventsInProgress),A=kt(c),L={};for(const $ in c){const{originalEvent:ee}=c[$];this._eventsInProgress[$]||(L[`${$}start`]=ee),this._eventsInProgress[$]=c[$]}!T&&A&&this._fireEvent("movestart",A.originalEvent);for(const $ in L)this._fireEvent($,L[$]);A&&this._fireEvent("move",A.originalEvent);for(const $ in c){const{originalEvent:ee}=c[$];this._fireEvent($,ee)}const F={};let V;for(const $ in this._eventsInProgress){const{handlerName:ee,originalEvent:ge}=this._eventsInProgress[$];this._handlersById[ee].isActive()||(delete this._eventsInProgress[$],V=g[ee]||ge,F[`${$}end`]=V)}for(const $ in F)this._fireEvent($,F[$]);const H=kt(this._eventsInProgress);if(C&&(T||A)&&!H){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ee=ge=>0!==ge&&-this._bearingSnap<ge&&ge<this._bearingSnap;$?(ee($.bearing||this._map.getBearing())&&($.bearing=0),this._map.easeTo($,{originalEvent:V})):(this._map.fire(new p.Event("moveend",{originalEvent:V})),ee(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,g){this._map.fire(new p.Event(c,g?{originalEvent:g}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new qt("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const tr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Mi extends p.Evented{constructor(c,g){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=g.bearingSnap,this._respectPrefersReducedMotion=!1!==g.respectPrefersReducedMotion,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(c,g){return this.jumpTo({center:c},g)}panBy(c,g,C){return c=p.Point.convert(c).mult(-1),this.panTo(this.transform.center,p.extend({offset:c},g),C)}panTo(c,g,C){return this.easeTo(p.extend({center:c},g),C)}getZoom(){return this.transform.zoom}setZoom(c,g){return this.jumpTo({zoom:c},g),this}zoomTo(c,g,C){return this.easeTo(p.extend({zoom:c},g),C)}zoomIn(c,g){return this.zoomTo(this.getZoom()+1,c,g),this}zoomOut(c,g){return this.zoomTo(this.getZoom()-1,c,g),this}getBearing(){return this.transform.bearing}setBearing(c,g){return this.jumpTo({bearing:c},g),this}getPadding(){return this.transform.padding}setPadding(c,g){return this.jumpTo({padding:c},g),this}rotateTo(c,g,C){return this.easeTo(p.extend({bearing:c},g),C)}resetNorth(c,g){return this.rotateTo(0,p.extend({duration:1e3},c),g),this}resetNorthPitch(c,g){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},c),g),this}snapToNorth(c,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,g):this}getPitch(){return this.transform.pitch}setPitch(c,g){return this.jumpTo({pitch:c},g),this}cameraForBounds(c,g){c=p.LngLatBounds.convert(c);const C=g&&g.bearing||0,T=g&&g.pitch||0,A=c.getNorthWest(),L=c.getSouthEast();return this._cameraForBounds(this.transform,A,L,C,T,g)}_extendCameraOptions(c){const g={top:0,bottom:0,right:0,left:0};if("number"==typeof(c=p.extend({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding){const C=c.padding;c.padding={top:C,bottom:C,right:C,left:C}}return c.padding=p.extend(g,c.padding),c}_minimumAABBFrustumDistance(c,g){const C=g.max[0]-g.min[0],T=g.max[1]-g.min[1];return C/T>c.aspect?C/(2*Math.tan(.5*c.fovX)*c.aspect):T/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,g,C,T,A,L){const F=c.clone(),V=this._extendCameraOptions(L);F.bearing=T,F.pitch=A;const H=p.LngLat.convert(g),$=p.LngLat.convert(C),ee=.5*(H.lat+$.lat),ge=.5*(H.lng+$.lng),De=p.latLngToECEF(ee,ge),Re=p.normalize([],De),Ce=p.normalize([],p.cross([],Re,[0,1,0])),Le=p.cross([],Ce,Re),te=[Ce[0],Ce[1],Ce[2],0,Le[0],Le[1],Le[2],0,Re[0],Re[1],Re[2],0,0,0,0,1],Se=[De,p.latLngToECEF(H.lat,H.lng),p.latLngToECEF($.lat,H.lng),p.latLngToECEF($.lat,$.lng),p.latLngToECEF(H.lat,$.lng),p.latLngToECEF(ee,H.lng),p.latLngToECEF(ee,$.lng),p.latLngToECEF(H.lat,ge),p.latLngToECEF($.lat,ge)];let Ue=p.Aabb.fromPoints(Se.map(ln=>[p.dot(Ce,ln),p.dot(Le,ln),p.dot(Re,ln)]));const He=p.transformMat4([],Ue.center,te);0===p.squaredLength(He)&&p.set(He,0,0,1),p.normalize(He,He),p.scale$2(He,He,p.GLOBE_RADIUS),F.center=p.ecefToLatLng(He);const lt=F.getWorldToCameraMatrix(),ut=p.invert(new Float64Array(16),lt);Ue=p.Aabb.applyTransform(Ue,p.multiply([],lt,te)),p.transformMat4(He,He,lt);const ct=.5*(Ue.max[2]-Ue.min[2]),yt=this._minimumAABBFrustumDistance(F,Ue),xt=p.scale$2([],[0,0,1],ct),Bt=p.add(xt,He,xt),Qt=yt+(0===F.pitch?0:p.distance(He,Bt)),Nt=F.globeCenterInViewSpace,Jt=p.sub([],He,[Nt[0],Nt[1],Nt[2]]);p.normalize(Jt,Jt),p.scale$2(Jt,Jt,Qt);const Pt=p.add([],He,Jt);p.transformMat4(Pt,Pt,ut);const mn=p.earthRadius/p.GLOBE_RADIUS,Ft=p.length(Pt),Yt=p.mercatorZfromAltitude(Math.max(Ft*mn-p.earthRadius,Number.EPSILON),0),an=Math.min(F.zoomFromMercatorZAdjusted(Yt),V.maxZoom);return an>.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(F.setProjection({name:"mercator"}),F.zoom=an,this._cameraForBounds(F,g,C,T,A,L)):{center:F.center,zoom:an,bearing:T,pitch:A}}queryTerrainElevation(c,g){const C=this.transform.elevation;return C?(g=p.extend({},{exaggerated:!0},g),C.getAtPoint(p.MercatorCoordinate.fromLngLat(c),null,g.exaggerated)):null}_cameraForBounds(c,g,C,T,A,L){if("globe"===c.projection.name)return this._cameraForBoundsOnGlobe(c,g,C,T,A,L);const F=c.clone(),V=this._extendCameraOptions(L),H=F.padding;F.bearing=T,F.pitch=A;const $=p.LngLat.convert(g),ee=p.LngLat.convert(C),ge=new p.LngLat($.lng,ee.lat),De=new p.LngLat(ee.lng,$.lat),Re=F.project($),Ce=F.project(ee),Le=this.queryTerrainElevation($),te=this.queryTerrainElevation(ee),Se=this.queryTerrainElevation(ge),Ue=this.queryTerrainElevation(De),He=[[Re.x,Re.y,Math.min(Le||0,te||0,Se||0,Ue||0)],[Ce.x,Ce.y,Math.max(Le||0,te||0,Se||0,Ue||0)]];let lt=p.Aabb.fromPoints(He);const ut=F.getWorldToCameraMatrix(),ct=p.invert(new Float64Array(16),ut);lt=p.Aabb.applyTransform(lt,ut);const yt=p.sub([],lt.max,lt.min),xt=H.left||0,Bt=H.right||0,Qt=H.bottom||0,Nt=H.top||0,{left:Jt,right:Pt,top:mn,bottom:Ft}=V.padding,Yt=.5*(xt+Bt),an=.5*(Nt+Qt),ln=Math.min(F.scaleZoom(F.scale*Math.min((F.width-(xt+Bt+Jt+Pt))/yt[0],(F.height-(Qt+Nt+Ft+mn))/yt[1])),V.maxZoom),xn=F.scale/F.zoomScale(ln);lt=new p.Aabb([lt.min[0]-(Jt+Yt)*xn,lt.min[1]-(Ft+an)*xn,lt.min[2]],[lt.max[0]+(Pt+Yt)*xn,lt.max[1]+(mn+an)*xn,lt.max[2]]);const cr=.5*yt[2],br=this._minimumAABBFrustumDistance(F,lt),Hn=[0,0,1,0];p.transformMat4$1(Hn,Hn,ut),p.normalize$2(Hn,Hn);const vr=p.scale$2([],Hn,br+cr),ci=p.add([],lt.center,vr),li=("number"==typeof V.offset.x&&"number"==typeof V.offset.y?new p.Point(V.offset.x,V.offset.y):p.Point.convert(V.offset)).rotate(-p.degToRad(T));lt.center[0]-=li.x*xn,lt.center[1]+=li.y*xn,p.transformMat4(lt.center,lt.center,ct),p.transformMat4(ci,ci,ct);const nr=[lt.center[0],lt.center[1],ci[2]*F.pixelsPerMeter];p.scale$2(nr,nr,1/F.worldSize);const So=p.lngFromMercatorX(nr[0]),qn=p.latFromMercatorY(nr[1]),Lo=Math.min(F._zoomFromMercatorZ(nr[2]),V.maxZoom),Xo=new p.LngLat(So,qn);return F.mercatorFromTransition&&Lo<.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(F.setProjection({name:"globe"}),F.zoom=Lo,this._cameraForBounds(F,g,C,T,A,L)):{center:Xo,zoom:Lo,bearing:T,pitch:A}}fitBounds(c,g,C){const T=this.cameraForBounds(c,g);return this._fitInternal(T,g,C)}fitScreenCoordinates(c,g,C,T,A){const L=p.Point.convert(c),F=p.Point.convert(g),V=new p.Point(Math.min(L.x,F.x),Math.min(L.y,F.y)),H=new p.Point(Math.max(L.x,F.x),Math.max(L.y,F.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(L,F))return this;const $=this.transform.pointLocation3D(V),ee=this.transform.pointLocation3D(H),ge=this.transform.pointLocation3D(new p.Point(V.x,H.y)),De=this.transform.pointLocation3D(new p.Point(H.x,V.y)),Re=[Math.min($.lng,ee.lng,ge.lng,De.lng),Math.min($.lat,ee.lat,ge.lat,De.lat)],Ce=[Math.max($.lng,ee.lng,ge.lng,De.lng),Math.max($.lat,ee.lat,ge.lat,De.lat)],Le=T&&T.pitch?T.pitch:this.getPitch(),te=this._cameraForBounds(this.transform,Re,Ce,C,Le,T);return this._fitInternal(te,T,A)}_fitInternal(c,g,C){return c?(delete(g=p.extend(c,g)).padding,g.linear?this.easeTo(g,C):this.flyTo(g,C)):this}jumpTo(c,g){this.stop();const C=c.preloadOnly?this.transform.clone():this.transform;let T=!1,A=!1,L=!1;return"zoom"in c&&C.zoom!==+c.zoom&&(T=!0,C.zoom=+c.zoom),void 0!==c.center&&(C.center=p.LngLat.convert(c.center)),"bearing"in c&&C.bearing!==+c.bearing&&(A=!0,C.bearing=+c.bearing),"pitch"in c&&C.pitch!==+c.pitch&&(L=!0,C.pitch=+c.pitch),null==c.padding||C.isPaddingEqual(c.padding)||(C.padding=c.padding),c.preloadOnly?(this._preloadTiles(C),this):(this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),T&&this.fire(new p.Event("zoomstart",g)).fire(new p.Event("zoom",g)).fire(new p.Event("zoomend",g)),A&&this.fire(new p.Event("rotatestart",g)).fire(new p.Event("rotate",g)).fire(new p.Event("rotateend",g)),L&&this.fire(new p.Event("pitchstart",g)).fire(new p.Event("pitch",g)).fire(new p.Event("pitchend",g)),this.fire(new p.Event("moveend",g)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(tr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,g){const C=this.transform;if(!C.projection.supportsFreeCamera)return p.warnOnce(tr),this;this.stop();const T=C.zoom,A=C.pitch,L=C.bearing;C.setFreeCameraOptions(c);const F=T!==C.zoom,V=A!==C.pitch,H=L!==C.bearing;return this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),F&&this.fire(new p.Event("zoomstart",g)).fire(new p.Event("zoom",g)).fire(new p.Event("zoomend",g)),H&&this.fire(new p.Event("rotatestart",g)).fire(new p.Event("rotate",g)).fire(new p.Event("rotateend",g)),V&&this.fire(new p.Event("pitchstart",g)).fire(new p.Event("pitch",g)).fire(new p.Event("pitchend",g)),this.fire(new p.Event("moveend",g)),this}easeTo(c,g){this._stop(!1,c.easeId),(!1===(c=p.extend({offset:[0,0],duration:500,easing:p.ease},c)).animate||this._prefersReducedMotion(c))&&(c.duration=0);const C=this.transform,T=this.getZoom(),A=this.getBearing(),L=this.getPitch(),F=this.getPadding(),V="zoom"in c?+c.zoom:T,H="bearing"in c?this._normalizeBearing(c.bearing,A):A,$="pitch"in c?+c.pitch:L,ee="padding"in c?c.padding:C.padding,ge=p.Point.convert(c.offset);let De,Re,Ce;if("globe"===C.projection.name){const xt=p.MercatorCoordinate.fromLngLat(C.center),Bt=ge.rotate(-C.angle);xt.x+=Bt.x/C.worldSize,xt.y+=Bt.y/C.worldSize;const Qt=xt.toLngLat(),Nt=p.LngLat.convert(c.center||Qt);this._normalizeCenter(Nt),De=C.centerPoint.add(Bt),Re=new p.Point(xt.x,xt.y).mult(C.worldSize),Ce=new p.Point(p.mercatorXfromLng(Nt.lng),p.mercatorYfromLat(Nt.lat)).mult(C.worldSize).sub(Re)}else{De=C.centerPoint.add(ge);const xt=C.pointLocation(De),Bt=p.LngLat.convert(c.center||xt);this._normalizeCenter(Bt),Re=C.project(xt),Ce=C.project(Bt).sub(Re)}const Le=C.zoomScale(V-T);let te,Se;c.around&&(te=p.LngLat.convert(c.around),Se=C.locationPoint(te));const Ue=this._zooming||V!==T,He=this._rotating||A!==H,lt=this._pitching||$!==L,ut=!C.isPaddingEqual(ee),ct=xt=>Bt=>{if(Ue&&(xt.zoom=p.number(T,V,Bt)),He&&(xt.bearing=p.number(A,H,Bt)),lt&&(xt.pitch=p.number(L,$,Bt)),ut&&(xt.interpolatePadding(F,ee,Bt),De=xt.centerPoint.add(ge)),te)xt.setLocationAtPoint(te,Se);else{const Qt=xt.zoomScale(xt.zoom-T),Nt=V>T?Math.min(2,Le):Math.max(.5,Le),Jt=Math.pow(Nt,1-Bt),Pt=xt.unproject(Re.add(Ce.mult(Bt*Jt)).mult(Qt));xt.setLocationAtPoint(xt.renderWorldCopies?Pt.wrap():Pt,De)}return c.preloadOnly||this._fireMoveEvents(g),xt};if(c.preloadOnly){const xt=this._emulate(ct,c.duration,C);return this._preloadTiles(xt),this}const yt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ue,this._rotating=He,this._pitching=lt,this._padding=ut,this._easeId=c.easeId,this._prepareEase(g,c.noMoveStart,yt),this._ease(ct(C),xt=>{C.recenterOnTerrain(),this._afterEase(g,xt)},c),this}_prepareEase(c,g,C={}){this._moving=!0,this.transform.cameraElevationReference="sea",g||C.moving||this.fire(new p.Event("movestart",c)),this._zooming&&!C.zooming&&this.fire(new p.Event("zoomstart",c)),this._rotating&&!C.rotating&&this.fire(new p.Event("rotatestart",c)),this._pitching&&!C.pitching&&this.fire(new p.Event("pitchstart",c))}_fireMoveEvents(c){this.fire(new p.Event("move",c)),this._zooming&&this.fire(new p.Event("zoom",c)),this._rotating&&this.fire(new p.Event("rotate",c)),this._pitching&&this.fire(new p.Event("pitch",c))}_afterEase(c,g){if(this._easeId&&g&&this._easeId===g)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const C=this._zooming,T=this._rotating,A=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,C&&this.fire(new p.Event("zoomend",c)),T&&this.fire(new p.Event("rotateend",c)),A&&this.fire(new p.Event("pitchend",c)),this.fire(new p.Event("moveend",c))}flyTo(c,g){if(this._prefersReducedMotion(c)){const ln=p.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ln,g)}this.stop(),c=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},c);const C=this.transform,T=this.getZoom(),A=this.getBearing(),L=this.getPitch(),F=this.getPadding(),V="zoom"in c?p.clamp(+c.zoom,C.minZoom,C.maxZoom):T,H="bearing"in c?this._normalizeBearing(c.bearing,A):A,$="pitch"in c?+c.pitch:L,ee="padding"in c?c.padding:C.padding,ge=C.zoomScale(V-T),De=p.Point.convert(c.offset);let Re=C.centerPoint.add(De);const Ce=C.pointLocation(Re),Le=p.LngLat.convert(c.center||Ce);this._normalizeCenter(Le);const te=C.project(Ce),Se=C.project(Le).sub(te);let Ue=c.curve;const He=Math.max(C.width,C.height),lt=He/ge,ut=Se.mag();if("minZoom"in c){const ln=p.clamp(Math.min(c.minZoom,T,V),C.minZoom,C.maxZoom),xn=He/C.zoomScale(ln-T);Ue=Math.sqrt(xn/ut*2)}const ct=Ue*Ue;function yt(ln){const xn=(lt*lt-He*He+(ln?-1:1)*ct*ct*ut*ut)/(2*(ln?lt:He)*ct*ut);return Math.log(Math.sqrt(xn*xn+1)-xn)}function xt(ln){return(Math.exp(ln)-Math.exp(-ln))/2}function Bt(ln){return(Math.exp(ln)+Math.exp(-ln))/2}const Qt=yt(0);let Nt=function(ln){return Bt(Qt)/Bt(Qt+Ue*ln)},Jt=function(ln){return He*((Bt(Qt)*(xt(xn=Qt+Ue*ln)/Bt(xn))-xt(Qt))/ct)/ut;var xn},Pt=(yt(1)-Qt)/Ue;if(Math.abs(ut)<1e-6||!isFinite(Pt)){if(Math.abs(He-lt)<1e-6)return this.easeTo(c,g);const ln=lt<He?-1:1;Pt=Math.abs(Math.log(lt/He))/Ue,Jt=function(){return 0},Nt=function(xn){return Math.exp(ln*Ue*xn)}}c.duration="duration"in c?+c.duration:1e3*Pt/("screenSpeed"in c?+c.screenSpeed/Ue:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const mn=A!==H,Ft=$!==L,Yt=!C.isPaddingEqual(ee),an=ln=>xn=>{const cr=xn*Pt,br=1/Nt(cr);ln.zoom=1===xn?V:T+ln.scaleZoom(br),mn&&(ln.bearing=p.number(A,H,xn)),Ft&&(ln.pitch=p.number(L,$,xn)),Yt&&(ln.interpolatePadding(F,ee,xn),Re=ln.centerPoint.add(De));const Hn=1===xn?Le:ln.unproject(te.add(Se.mult(Jt(cr))).mult(br));return ln.setLocationAtPoint(ln.renderWorldCopies?Hn.wrap():Hn,Re),ln._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(g),ln};if(c.preloadOnly){const ln=this._emulate(an,c.duration,C);return this._preloadTiles(ln),this}return this._zooming=!0,this._rotating=mn,this._pitching=Ft,this._padding=Yt,this._prepareEase(g,!1),this._ease(an(C),()=>this._afterEase(g),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const C=this._onEaseEnd;this._onEaseEnd=void 0,C.call(this,g)}if(!c){const C=this.handlers;C&&C.stop(!1)}return this}_ease(c,g,C){!1===C.animate||0===C.duration?(c(1),g()):(this._easeStart=p.exported.now(),this._easeOptions=C,this._onEaseFrame=c,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),g=this._onEaseFrame;g&&g(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,g){c=p.wrap(c,-180,180);const C=Math.abs(c-g);return Math.abs(c-360-g)<C&&(c-=360),Math.abs(c+360-g)<C&&(c+=360),c}_normalizeCenter(c){const g=this.transform;if(!g.renderWorldCopies||g.maxBounds)return;const C=c.lng-g.center.lng;c.lng+=C>180?-360:C<-180?360:0}_prefersReducedMotion(c){return this._respectPrefersReducedMotion&&p.exported.prefersReducedMotion&&!(c&&c.essential)}_emulate(c,g,C){const T=Math.ceil(15*g/1e3),A=[],L=c(C.clone());for(let F=0;F<=T;F++){const V=L(F/T);A.push(V.clone())}return A}}class Tn{constructor(c={}){this.options=c,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const g=this.options&&this.options.compact;return this._map=c,this._container=Et("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Et("button","mapboxgl-ctrl-attrib-button",this._container),Et("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Et("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),g&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===g&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,g){const C=this._map._getUIString(`AttributionControl.${g}`);c.setAttribute("aria-label",C),c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",C)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const g=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(c){const C=g.reduce((T,A,L)=>(A.value&&(T+=`${A.key}=${A.value}${L<g.length-1?"&":""}`),T),"?");c.href=`${p.config.FEEDBACK_URL}/${C}#${Pr(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||"metadata"!==c.sourceDataType&&"visibility"!==c.sourceDataType&&"style"!==c.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const T=this._map.style.stylesheet;this.styleOwner=T.owner,this.styleId=T.id}const g=this._map.style._sourceCaches;for(const T in g){const A=g[T];if(A.used){const L=A.getSource();L.attribution&&c.indexOf(L.attribution)<0&&c.push(L.attribution)}}c.sort((T,A)=>T.length-A.length),c=c.filter((T,A)=>{for(let L=A+1;L<c.length;L++)if(c[L].indexOf(T)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const C=c.join(" | ");C!==this._attribHTML&&(this._attribHTML=C,c.length?(this._innerContainer.innerHTML=C,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class wa{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=Et("div","mapboxgl-ctrl");const g=Et("a","mapboxgl-ctrl-logo");return g.target="_blank",g.rel="noopener nofollow",g.href="https://www.mapbox.com/",g.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),g.setAttribute("rel","noopener nofollow"),this._container.appendChild(g),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&"metadata"!==c.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(0===Object.entries(c).length)return!0;for(const g in c){const C=c[g].getSource();if(C.hasOwnProperty("mapbox_logo")&&!C.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const g=c[0];this._map.getCanvasContainer().offsetWidth<250?g.classList.add("mapboxgl-compact"):g.classList.remove("mapboxgl-compact")}}}class Ea{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const g=++this._id;return this._queue.push({callback:c,id:g,cancelled:!1}),g}remove(c){const g=this._currentlyRunning,C=g?this._queue.concat(g):this._queue;for(const T of C)if(T.id===c)return void(T.cancelled=!0)}run(c=0){const g=this._currentlyRunning=this._queue;this._queue=[];for(const C of g)if(!C.cancelled&&(C.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ml(x,c,g){if(x=new p.LngLat(x.lng,x.lat),c){const C=new p.LngLat(x.lng-360,x.lat),T=new p.LngLat(x.lng+360,x.lat),A=360*Math.ceil(Math.abs(x.lng-g.center.lng)/360),L=g.locationPoint(x).distSqr(c),F=c.x<0||c.y<0||c.x>g.width||c.y>g.height;g.locationPoint(C).distSqr(c)<L&&(F||Math.abs(C.lng-g.center.lng)<A)?x=C:g.locationPoint(T).distSqr(c)<L&&(F||Math.abs(T.lng-g.center.lng)<A)&&(x=T)}for(;Math.abs(x.lng-g.center.lng)>180;){const C=g.locationPoint(x);if(C.x>=0&&C.y>=0&&C.x<=g.width&&C.y<=g.height)break;x.lng>g.center.lng?x.lng-=360:x.lng+=360}return x}const Ac={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ln extends p.Evented{constructor(c,g){if(super(),(c instanceof p.window.HTMLElement||g)&&(c=p.extend({element:c},g)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=p.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=Et("div");const T=41,A=27,L=rn("svg",{display:"block",height:T*this._scale+"px",width:A*this._scale+"px",viewBox:`0 0 ${A} ${T}`},this._element),F=rn("radialGradient",{id:"shadowGradient"},rn("defs",{},L));rn("stop",{offset:"10%","stop-opacity":.4},F),rn("stop",{offset:"100%","stop-opacity":.05},F),rn("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},L),rn("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},L),rn("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},L),rn("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},L),this._offset=p.Point.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",T=>{T.preventDefault()}),this._element.addEventListener("mousedown",T=>{T.preventDefault()});const C=this._element.classList;for(const T in Ac)C.remove(`mapboxgl-marker-anchor-${T}`);C.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=p.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const T=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[T,-1*(24.6+T)],"bottom-right":[-T,-1*(24.6+T)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const g=c.code,C=c.charCode||c.keyCode;"Space"!==g&&"Enter"!==g&&32!==C&&13!==C||this.togglePopup()}_onMapClick(c){const g=c.originalEvent.target,C=this._element;this._popup&&(g===C||C.contains(g))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,g=this._pos;if(!c||!g)return!1;const C=c.unproject(g),T=c.getFreeCameraOptions();if(!T.position)return!1;const A=T.position.toLngLat();return A.distanceTo(C)<.9*A.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const g=this._pos;if(!g||g.x<0||g.x>c.transform.width||g.y<0||g.y>c.transform.height)return void this._clearFadeTimer();const C=c.unproject(g);let T;c._showingGlobe()&&p.isLngLatBehindGlobe(c.transform,this._lngLat)?T=0:(T=1-c._queryFogOpacity(C),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(T*=this._occludedOpacity)),this._element.style.opacity=`${T}`,this._element.style.pointerEvents=T>0?"auto":"none",this._popup&&this._popup._setOpacity(T),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const g=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${c.x}px,${c.y}px)\n            ${Ac[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${g.x}px,${g.y}px)\n        `}_calculateXYTransform(){const c=this._pos,g=this._map,C=this.getPitchAlignment();if(!g||!c||"map"!==C)return"";if(!g._showingGlobe()){const V=g.getPitch();return V?`rotateX(${V}deg)`:""}const T=p.radToDeg(p.globeTiltAtLngLat(g.transform,this._lngLat)),A=c.sub(p.globeCenterToScreenPoint(g.transform)),L=Math.abs(A.x)+Math.abs(A.y);if(0===L)return"";const F=T/L;return`rotateX(${-A.y*F}deg) rotateY(${A.x*F}deg)`}_calculateZTransform(){const c=this._pos,g=this._map;if(!g||!c)return"";let C=0;const T=this.getRotationAlignment();if("map"===T)if(g._showingGlobe()){const A=g.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),L=g.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(A);C=p.radToDeg(Math.atan2(L.y,L.x))-90}else C=-g.getBearing();else if("horizon"===T){const A=p.smoothstep(4,6,g.getZoom()),L=p.globeCenterToScreenPoint(g.transform);L.y+=A*g.transform.height;const F=c.sub(L),V=p.radToDeg(Math.atan2(F.y,F.x));C=(V>90?V-270:V+90)*(1-A)}return C+=this._rotation,C?`rotateZ(${C}deg)`:""}_update(c){p.window.cancelAnimationFrame(this._updateFrameId);const g=this._map;g&&(g.transform.renderWorldCopies&&(this._lngLat=ml(this._lngLat,this._pos,g.transform)),this._pos=g.project(this._lngLat),!0===c?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),g._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(g._showingGlobe()||g.getTerrain()||g.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=p.Point.convert(c),this._update(),this}_onMove(c){const g=this._map;if(!g)return;const C=this._pointerdownPos,T=this._positionDelta;if(C&&T){if(!this._isDragging){const A=this._clickTolerance||g._clickTolerance;if(c.point.dist(C)<A)return;this._isDragging=!0}this._pos=c.point.sub(T),this._lngLat=g.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(c){const g=this._map,C=this._pos;g&&C&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(C),this._pointerdownPos=c.point,this._state="pending",g.on("mousemove",this._onMove),g.on("touchmove",this._onMove),g.once("mouseup",this._onUp),g.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const g=this._map;return g&&(c?(g.on("mousedown",this._addDragHandler),g.on("touchstart",this._addDragHandler)):(g.off("mousedown",this._addDragHandler),g.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const np={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},dy=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function xm(x=new p.Point(0,0),c="bottom"){if("number"==typeof x){const g=Math.round(Math.sqrt(.5*Math.pow(x,2)));switch(c){case"top":return new p.Point(0,x);case"top-left":return new p.Point(g,g);case"top-right":return new p.Point(-g,g);case"bottom":return new p.Point(0,-x);case"bottom-left":return new p.Point(g,-g);case"bottom-right":return new p.Point(-g,-g);case"left":return new p.Point(x,0);case"right":return new p.Point(-x,0)}return new p.Point(0,0)}return x instanceof p.Point||Array.isArray(x)?p.Point.convert(x):p.Point.convert(x[c]||[0,0])}class sg{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const g=p.easeCubicInOut((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-g)+this._end*g}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,g,C){this._start=this.getValue(g),this._end=c,this._startTime=g,this._endTime=g+C}}const fy={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},bm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Nc={showCompass:!0,showZoom:!0,visualizePitch:!1};class rp{constructor(c,g,C=!1){this._clickTolerance=10,this.element=g,this.mouseRotate=new Ls({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,C&&(this.mousePitch=new fc({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),g.addEventListener("mousedown",this.mousedown),g.addEventListener("touchstart",this.touchstart,{passive:!1}),g.addEventListener("touchmove",this.touchmove),g.addEventListener("touchend",this.touchend),g.addEventListener("touchcancel",this.reset)}down(c,g){this.mouseRotate.mousedown(c,g),this.mousePitch&&this.mousePitch.mousedown(c,g),hn()}move(c,g){const C=this.map,T=this.mouseRotate.mousemoveWindow(c,g),A=T&&T.bearingDelta;if(A&&C.setBearing(C.getBearing()+A),this.mousePitch){const L=this.mousePitch.mousemoveWindow(c,g),F=L&&L.pitchDelta;F&&C.setPitch(C.getPitch()+F)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){de(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(p.extend({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),fe(this.element,c)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,fe(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){1!==c.targetTouches.length?this.reset():(this._startPos=this._lastPos=he(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){1!==c.targetTouches.length?this.reset():(this._lastPos=he(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){0===c.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Fa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ip={maxWidth:100,unit:"metric"},wm={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Th={version:p.version,supported:Xe,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends Mi{constructor(x){if(p.LivePerformanceUtils.mark(p.PerformanceMarkers.create),null!=(x=p.extend({},bm,x)).minZoom&&null!=x.maxZoom&&x.minZoom>x.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=x.minPitch&&null!=x.maxPitch&&x.minPitch>x.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=x.minPitch&&x.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=x.maxPitch&&x.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(x.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(x.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ai(x.minZoom,x.maxZoom,x.minPitch,x.maxPitch,x.renderWorldCopies),x),this._interactive=x.interactive,this._minTileCacheSize=x.minTileCacheSize,this._maxTileCacheSize=x.maxTileCacheSize,this._failIfMajorPerformanceCaveat=x.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=x.preserveDrawingBuffer,this._antialias=x.antialias,this._useWebGL2=x.useWebGL2,this._trackResize=x.trackResize,this._bearingSnap=x.bearingSnap,this._refreshExpiredTiles=x.refreshExpiredTiles,this._fadeDuration=x.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=x.crossSourceCollisions,this._collectResourceTiming=x.collectResourceTiming,this._optimizeForTerrain=x.optimizeForTerrain,this._language=this._parseLanguage(x.language),this._worldview=x.worldview,this._renderTaskQueue=new Ea,this._domRenderTaskQueue=new Ea,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.uniqueId(),this._locale=p.extend({},fy,x.locale),this._clickTolerance=x.clickTolerance,this._cooperativeGestures=x.cooperativeGestures,this._performanceMetricsCollection=x.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new sg(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new p.RequestManager(x.transformRequest,x.accessToken,x.testMode),this._silenceAuthErrors=!!x.testMode,"string"==typeof x.container){if(this._container=p.window.document.getElementById(x.container),!this._container)throw new Error(`Container '${x.container}' not found.`)}else{if(!(x.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=x.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),x.maxBounds&&this.setMaxBounds(x.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new zn(this,x),this._localFontFamily=x.localFontFamily,this._localIdeographFontFamily=x.localIdeographFontFamily,x.style&&this.setStyle(x.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),x.projection&&this.setProjection(x.projection),this._hash=x.hash&&new Nu("string"==typeof x.hash&&x.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch}),x.bounds&&(this.resize(),this.fitBounds(x.bounds,p.extend({},x.fitBoundsOptions,{duration:0})))),this.resize(),x.attributionControl&&this.addControl(new Tn({customAttribution:x.customAttribution})),this._logoControl=new wa,this.addControl(this._logoControl,x.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update("style"===c.dataType),this.fire(new p.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new p.Event(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(x,c){if(void 0===c&&(c=x.getDefaultPosition?x.getDefaultPosition():"top-right"),!x||!x.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const g=x.onAdd(this);this._controls.push(x);const C=this._controlPositions[c];return-1!==c.indexOf("bottom")?C.insertBefore(g,C.firstChild):C.appendChild(g),this}removeControl(x){if(!x||!x.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(x);return c>-1&&this._controls.splice(c,1),x.onRemove(this),this}hasControl(x){return this._controls.indexOf(x)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(x){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new p.Event("movestart",x)).fire(new p.Event("move",x)),this.fire(new p.Event("resize",x)),c&&this.fire(new p.Event("moveend",x)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(x){return this.transform.setMaxBounds(p.LngLatBounds.convert(x)),this._update()}setMinZoom(x){if((x=x??-2)>=-2&&x<=this.transform.maxZoom)return this.transform.minZoom=x,this._update(),this.getZoom()<x?this.setZoom(x):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(x){if((x=x??22)>=this.transform.minZoom)return this.transform.maxZoom=x,this._update(),this.getZoom()>x?this.setZoom(x):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(x){if((x=x??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(x>=0&&x<=this.transform.maxPitch)return this.transform.minPitch=x,this._update(),this.getPitch()<x?this.setPitch(x):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(x){if((x=x??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(x>=this.transform.minPitch)return this.transform.maxPitch=x,this._update(),this.getPitch()>x?this.setPitch(x):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(x){return this.transform.renderWorldCopies=x,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(x){return"auto"===x?p.window.navigator.language:Array.isArray(x)?0===x.length?void 0:x.map(c=>"auto"===c?p.window.navigator.language:c):x}setLanguage(x){const c=this._parseLanguage(x);if(!this.style||c===this._language)return this;this._language=c,this.style._reloadSources();for(const g of this._controls)g._setLanguage&&g._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(x){return this.style&&x!==this._worldview?(this._worldview=x,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(x){return this._lazyInitEmptyStyle(),x?"string"==typeof x&&(x={name:x}):x=null,this._useExplicitProjection=!!x,this._prioritizeAndUpdateProjection(x,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const x=this.transform,c=x.projection.name;let g;"globe"===c&&x.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?(x.setMercatorFromTransition(),g=!0):"mercator"===c&&x.zoom<p.GLOBE_ZOOM_THRESHOLD_MAX&&(x.setProjection({name:"globe"}),g=!0),g&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(x,c){return this._updateProjection(x||c||{name:"mercator"})}_updateProjection(x){let c;if(c="globe"===x.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(x),this.style.applyProjectionUpdate(),c){this.painter.clearBackgroundTiles();for(const g in this.style._sourceCaches)this.style._sourceCaches[g].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(x){return this.transform.locationPoint3D(p.LngLat.convert(x))}unproject(x){return this.transform.pointLocation3D(p.Point.convert(x))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(x,c,g){if("mouseenter"===x||"mouseover"===x){let C=!1;const T=L=>{const F=c.filter(H=>this.getLayer(H)),V=F.length?this.queryRenderedFeatures(L.point,{layers:F}):[];V.length?C||(C=!0,g.call(this,new xa(x,this,L.originalEvent,{features:V}))):C=!1},A=()=>{C=!1};return{layers:new Set(c),listener:g,delegates:{mousemove:T,mouseout:A}}}if("mouseleave"===x||"mouseout"===x){let C=!1;const T=L=>{const F=c.filter(V=>this.getLayer(V));(F.length?this.queryRenderedFeatures(L.point,{layers:F}):[]).length?C=!0:C&&(C=!1,g.call(this,new xa(x,this,L.originalEvent)))},A=L=>{C&&(C=!1,g.call(this,new xa(x,this,L.originalEvent)))};return{layers:new Set(c),listener:g,delegates:{mousemove:T,mouseout:A}}}{const C=T=>{const A=c.filter(F=>this.getLayer(F)),L=A.length?this.queryRenderedFeatures(T.point,{layers:A}):[];L.length&&(T.features=L,g.call(this,T),delete T.features)};return{layers:new Set(c),listener:g,delegates:{[x]:C}}}}on(x,c,g){if(void 0===g)return super.on(x,c);Array.isArray(c)||(c=[c]);const C=this._createDelegatedListener(x,c,g);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[x]=this._delegatedListeners[x]||[],this._delegatedListeners[x].push(C);for(const T in C.delegates)this.on(T,C.delegates[T]);return this}once(x,c,g){if(void 0===g)return super.once(x,c);Array.isArray(c)||(c=[c]);const C=this._createDelegatedListener(x,c,g);for(const T in C.delegates)this.once(T,C.delegates[T]);return this}off(x,c,g){if(void 0===g)return super.off(x,c);c=new Set(Array.isArray(c)?c:[c]);const C=(A,L)=>{if(A.size!==L.size)return!1;for(const F of A)if(!L.has(F))return!1;return!0},T=this._delegatedListeners?this._delegatedListeners[x]:void 0;return T&&(A=>{for(let L=0;L<A.length;L++){const F=A[L];if(F.listener===g&&C(F.layers,c)){for(const V in F.delegates)this.off(V,F.delegates[V]);return A.splice(L,1),this}}})(T),this}queryRenderedFeatures(x,c){return this.style?(void 0!==c||void 0===x||x instanceof p.Point||Array.isArray(x)||(c=x,x=void 0),this.style.queryRenderedFeatures(x=x||[[0,0],[this.transform.width,this.transform.height]],c=c||{},this.transform)):[]}querySourceFeatures(x,c){return this.style.querySourceFeatures(x,c)}isPointOnSurface(x){const{name:c}=this.transform.projection;return"globe"!==c&&"mercator"!==c&&p.warnOnce(`${c} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(p.Point.convert(x))}setStyle(x,c){return!1!==(c=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&x?(this._diffStyle(x,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(x,c))}_getUIString(x){const c=this._locale[x];if(null==c)throw new Error(`Missing UI string '${x}'`);return c}_updateStyle(x,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),x&&(this.style=new Oo(this,c||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof x?this.style.loadURL(x):this.style.loadJSON(x)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Oo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(x,c){if("string"==typeof x){const g=this._requestManager.normalizeStyleURL(x),C=this._requestManager.transformRequest(g,p.ResourceType.Style);p.getJSON(C,(T,A)=>{T?this.fire(new p.ErrorEvent(T)):A&&this._updateDiff(A,c)})}else"object"==typeof x&&this._updateDiff(x,c)}_updateDiff(x,c){try{this.style.setState(x)&&this._update(!0)}catch(g){p.warnOnce(`Unable to perform style diff: ${g.message||g.error||g}.  Rebuilding the style from scratch.`),this._updateStyle(x,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(x,c){return this._lazyInitEmptyStyle(),this.style.addSource(x,c),this._update(!0)}isSourceLoaded(x){return!!this.style&&this.style._isSourceCacheLoaded(x)}areTilesLoaded(){const x=this.style&&this.style._sourceCaches;for(const c in x){const g=x[c]._tiles;for(const C in g){const T=g[C];if("loaded"!==T.state&&"errored"!==T.state)return!1}}return!0}addSourceType(x,c,g){this._lazyInitEmptyStyle(),this.style.addSourceType(x,c,g)}removeSource(x){return this.style.removeSource(x),this._updateTerrain(),this._update(!0)}getSource(x){return this.style.getSource(x)}addImage(x,c,{pixelRatio:g=1,sdf:C=!1,stretchX:T,stretchY:A,content:L}={}){if(this._lazyInitEmptyStyle(),c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap){const{width:F,height:V,data:H}=p.exported.getImageData(c);this.style.addImage(x,{data:new p.RGBAImage({width:F,height:V},H),pixelRatio:g,stretchX:T,stretchY:A,content:L,sdf:C,version:0})}else if(void 0===c.width||void 0===c.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:F,height:V}=c,H=c;this.style.addImage(x,{data:new p.RGBAImage({width:F,height:V},new Uint8Array(H.data)),pixelRatio:g,stretchX:T,stretchY:A,content:L,sdf:C,version:0,userImage:H}),H.onAdd&&H.onAdd(this,x)}}updateImage(x,c){const g=this.style.getImage(x);if(!g)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const C=c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap?p.exported.getImageData(c):c,{width:T,height:A}=C;void 0!==T&&void 0!==A?T===g.data.width&&A===g.data.height?(g.data.replace(C.data,!(c instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&c instanceof p.window.ImageBitmap)),this.style.updateImage(x,g)):this.fire(new p.ErrorEvent(new Error(`The width and height of the updated image (${T}, ${A})\n                must be that same as the previous version of the image\n                (${g.data.width}, ${g.data.height})`))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(x){return x?!!this.style.getImage(x):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(x){this.style.removeImage(x)}loadImage(x,c){p.getImage(this._requestManager.transformRequest(x,p.ResourceType.Image),(g,C)=>{c(g,C instanceof p.window.HTMLImageElement?p.exported.getImageData(C):C)})}listImages(){return this.style.listImages()}addLayer(x,c){return this._lazyInitEmptyStyle(),this.style.addLayer(x,c),this._update(!0)}moveLayer(x,c){return this.style.moveLayer(x,c),this._update(!0)}removeLayer(x){return this.style.removeLayer(x),this._update(!0)}getLayer(x){return this.style.getLayer(x)}setLayerZoomRange(x,c,g){return this.style.setLayerZoomRange(x,c,g),this._update(!0)}setFilter(x,c,g={}){return this.style.setFilter(x,c,g),this._update(!0)}getFilter(x){return this.style.getFilter(x)}setPaintProperty(x,c,g,C={}){return this.style.setPaintProperty(x,c,g,C),this._update(!0)}getPaintProperty(x,c){return this.style.getPaintProperty(x,c)}setLayoutProperty(x,c,g,C={}){return this.style.setLayoutProperty(x,c,g,C),this._update(!0)}getLayoutProperty(x,c){return this.style.getLayoutProperty(x,c)}setLight(x,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(x,c),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(x){return this._lazyInitEmptyStyle(),!x&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(x),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(x){return this._lazyInitEmptyStyle(),this.style.setFog(x),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(x){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(x),this.transform):0}setFeatureState(x,c){return this.style.setFeatureState(x,c),this._update()}removeFeatureState(x,c){return this.style.removeFeatureState(x,c),this._update()}getFeatureState(x){return this.style.getFeatureState(x)}_updateContainerDimensions(){if(!this._container)return;const x=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let g,C,T,A=this._container;for(;A&&(!C||!T);){const L=p.window.getComputedStyle(A).transform;L&&"none"!==L&&(g=L.match(/matrix.*\((.+)\)/)[1].split(", "),g[0]&&"0"!==g[0]&&"1"!==g[0]&&(C=g[0]),g[3]&&"0"!==g[3]&&"1"!==g[3]&&(T=g[3])),A=A.parentElement}this._containerWidth=C?Math.abs(x/C):x,this._containerHeight=T?Math.abs(c/T):c}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const x=this._container;x.classList.add("mapboxgl-map"),(this._missingCSSCanary=Et("div","mapboxgl-canary",x)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=Et("div","mapboxgl-canvas-container",x);this._interactive&&c.classList.add("mapboxgl-interactive"),this._canvas=Et("canvas","mapboxgl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const g=this._controlContainer=Et("div","mapboxgl-control-container",x),C=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(T=>{C[T]=Et("div",`mapboxgl-ctrl-${T}`,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(x,c){const g=p.exported.devicePixelRatio||1;this._canvas.width=g*Math.ceil(x),this._canvas.height=g*Math.ceil(c),this._canvas.style.width=`${x}px`,this._canvas.style.height=`${c}px`}_addMarker(x){this._markers.push(x)}_removeMarker(x){const c=this._markers.indexOf(x);-1!==c&&this._markers.splice(c,1)}_addPopup(x){this._popups.push(x)}_removePopup(x){const c=this._popups.indexOf(x);-1!==c&&this._popups.splice(c,1)}_setupPainter(){const x=p.extend({},Xe.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._useWebGL2&&this._canvas.getContext("webgl2",x),g=c||this._canvas.getContext("webgl",x)||this._canvas.getContext("experimental-webgl",x);g?(this._useWebGL2&&!c&&p.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),p.storeAuthState(g,!0),this.painter=new cc(g,this.transform,!!c),this.on("data",C=>{"source"===C.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(g)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(x){x.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:x}))}_contextRestored(x){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:x}))}_onMapScroll(x){if(x.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(x){return this.style?(this._styleDirty=this._styleDirty||x,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(x){return this._update(),this._renderTaskQueue.add(x)}_cancelRenderFrame(x){this._renderTaskQueue.remove(x)}_requestDomTask(x){!this.loaded()||this.loaded()&&!this.isMoving()?x():this._domRenderTaskQueue.add(x)}_render(x){let c;const g=this.painter.context.extTimerQuery,C=p.exported.now();if(this.listens("gpu-timing-frame")&&(c=g.createQueryEXT(),g.beginQueryEXT(g.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],p.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],p.window.performance.now())),this._renderTaskQueue.run(x),this._domRenderTaskQueue.run(x),this._removed)return;this._updateProjectionTransition();const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const F=this.transform.zoom,V=this.transform.pitch,H=p.exported.now(),$=new p.EvaluationParameters(F,{now:H,fadeDuration:T,pitch:V,transition:this.style.getTransition()});this.style.update($)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let A=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),A=this._updateAverageElevation(C),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):A=this._updateAverageElevation(C),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const F=p.exported.now()-C;g.endQueryEXT(g.TIME_ELAPSED_EXT,c),setTimeout(()=>{const V=g.getQueryObjectEXT(c,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(c),this.fire(new p.Event("gpu-timing-frame",{cpuTime:F,gpuTime:V})),p.window.performance.mark("frame-gpu",{startTime:C,detail:{gpuTime:V}})},50)}if(this.listens("gpu-timing-layer")){const F=this.painter.collectGpuTimers();setTimeout(()=>{const V=this.painter.queryGpuTimers(F);this.fire(new p.Event("gpu-timing-layer",{layerTimes:V}))},50)}if(this.listens("gpu-timing-deferred-render")){const F=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const V=this.painter.queryGpuTimeDeferredRender(F);this.fire(new p.Event("gpu-timing-deferred-render",{gpuTime:V}))},50)}const L=this._sourcesDirty||this._styleDirty||this._placementDirty||A;if(L||this._repaint)this.triggerRepaint();else{const F=!this.isMoving()&&this.loaded();if(F&&(A=this._updateAverageElevation(C,!0)),A)this.triggerRepaint();else if(this._triggerFrame(!1),F&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const V=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:V})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||L||(this._fullyLoaded=!0,p.LivePerformanceUtils.mark(p.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&p.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(x){for(const c of this._markers)x&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!x||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(x,c=!1){const g=C=>(this.transform.averageElevation=C,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&g(0);if((c||x-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(x)){const C=this.transform.averageElevation;let T=this.transform.sampleAverageElevation(),A=!1;this.transform.elevation&&(A=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(T)?T=0:this._averageElevationLastSampledAt=x;const L=Math.abs(C-T);if(L>1){if(this._isInitialLoad||A)return this._averageElevation.jumpTo(T),g(T);this._averageElevation.easeTo(T,x,300)}else if(L>1e-4)return this._averageElevation.jumpTo(T),g(T)}return!!this._averageElevation.isEasing(x)&&g(this._averageElevation.getValue(x))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,x=>{if(x&&(x.message===p.AUTH_ERR_MSG||401===x.status)){const c=this.painter.context.gl;p.storeAuthState(c,!1),this._logoControl instanceof wa&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const x=this._isDragging();this.painter.updateTerrain(this.style,x)}_calculateSpeedIndex(){const x=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const g=this.painter.context.gl,C=g.createFramebuffer();function T(A){g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,A,0);const L=new Uint8Array(g.drawingBufferWidth*g.drawingBufferHeight*4);return g.readPixels(0,0,g.drawingBufferWidth,g.drawingBufferHeight,g.RGBA,g.UNSIGNED_BYTE,L),L}return g.bindFramebuffer(g.FRAMEBUFFER,C),this._canvasPixelComparison(T(x),c.canvasCopies.map(T),c.timeStamps)}_canvasPixelComparison(x,c,g){let C=g[1]-g[0];const T=x.length/4;for(let A=0;A<c.length;A++){const L=c[A];let F=0;for(let V=0;V<L.length;V+=4)L[V]===x[V]&&L[V+1]===x[V+1]&&L[V+2]===x[V+2]&&L[V+3]===x[V+3]&&(F+=1);C+=(g[A+2]-g[A+1])*(1-F/T)}return C}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1),p.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const x=this.painter.context.gl.getExtension("WEBGL_lose_context");x&&x.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(x){this._renderNextFrame=this._renderNextFrame||x,this.style&&!this._frame&&(this._frame=p.exported.frame(c=>{const g=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,g&&this._render(c)}))}_preloadTiles(x){const c=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(c,(g,C)=>g._preloadTiles(x,C),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(x){this._trackResize&&this.resize({originalEvent:x})._update()}_onVisibilityChange(){"hidden"===p.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(x){this._showTileBoundaries!==x&&(this._showTileBoundaries=x,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(x){this._showTerrainWireframe!==x&&(this._showTerrainWireframe=x,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(x){this._speedIndexTiming!==x&&(this._speedIndexTiming=x,this._update())}get showPadding(){return!!this._showPadding}set showPadding(x){this._showPadding!==x&&(this._showPadding=x,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(x){this._showCollisionBoxes!==x&&(this._showCollisionBoxes=x,x?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(x){this._showOverdrawInspector!==x&&(this._showOverdrawInspector=x,this._update())}get repaint(){return!!this._repaint}set repaint(x){this._repaint!==x&&(this._repaint=x,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(x){this._vertices=x,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(x){this._showTileAABBs!==x&&(this._showTileAABBs=x,x&&this._update())}_setCacheLimits(x,c){p.setCacheLimits(x,c)}get version(){return p.version}},NavigationControl:class{constructor(x){this.options=p.extend({},Nc,x),this._container=Et("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),Et("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),Et("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const g=this._map;g&&(this.options.visualizePitch?g.resetNorthPitch({},{originalEvent:c}):g.resetNorth({},{originalEvent:c}))}),this._compassIcon=Et("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const x=this._map;if(!x)return;const c=x.getZoom(),g=c===x.getMaxZoom(),C=c===x.getMinZoom();this._zoomInButton.disabled=g,this._zoomOutButton.disabled=C,this._zoomInButton.setAttribute("aria-disabled",g.toString()),this._zoomOutButton.setAttribute("aria-disabled",C.toString())}_rotateCompassArrow(){const x=this._map;if(!x)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(x.transform.pitch*(Math.PI/180)),.5)}) rotateX(${x.transform.pitch}deg) rotateZ(${x.transform.angle*(180/Math.PI)}deg)`:`rotate(${x.transform.angle*(180/Math.PI)}deg)`;x._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(x){return this._map=x,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),x.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&x.on("pitch",this._rotateCompassArrow),x.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new rp(x,this._compass,this.options.visualizePitch)),this._container}onRemove(){const x=this._map;x&&(this._container.remove(),this.options.showZoom&&x.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&x.off("pitch",this._rotateCompassArrow),x.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(x,c){const g=Et("button",x,this._container);return g.type="button",g.addEventListener("click",c),g}_setButtonTitle(x,c){if(!this._map)return;const g=this._map._getUIString(`NavigationControl.${c}`);x.setAttribute("aria-label",g),x.firstElementChild&&x.firstElementChild.setAttribute("title",g)}},GeolocateControl:class extends p.Evented{constructor(x){super(),this.options=p.extend({geolocation:p.window.navigator.geolocation},Fa,x),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=va(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(x){return this._map=x,this._container=Et("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(x){const c=(g=!!this.options.geolocation)=>{this._supportsGeolocation=g,x(g)};void 0!==this._supportsGeolocation?x(this._supportsGeolocation):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(g=>c("denied"!==g.state)).catch(()=>c()):c()}_isOutOfMapMaxBounds(x){const c=this._map.getMaxBounds(),g=x.coords;return!!c&&(g.longitude<c.getWest()||g.longitude>c.getEast()||g.latitude<c.getSouth()||g.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(x){if(this._map){if(this._isOutOfMapMaxBounds(x))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",x)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=x,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(x),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(x),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",x)),this._finish()}}_updateCamera(x){const c=new p.LngLat(x.coords.longitude,x.coords.latitude),g=x.coords.accuracy,C=this._map.getBearing(),T=p.extend({bearing:C},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(g),T,{geolocateSource:!0})}_updateMarker(x){if(x){const c=new p.LngLat(x.coords.longitude,x.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=x.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const x=this._map.transform,c=p.mercatorZfromAltitude(1,x._center.lat)*x.worldSize,g=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(x){if(this._map){if(this.options.trackUserLocation)if(1===x.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===x.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",x)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(x){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=Et("button","mapboxgl-ctrl-geolocate",this._container),Et("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===x){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Et("div","mapboxgl-user-location"),this._dotElement.appendChild(Et("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Et("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ln({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Et("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ln({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||"ACTIVE_LOCK"!==this._watchState||c.originalEvent&&"resize"===c.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}}_onDeviceOrientation(x){this._userLocationDotMarker&&(x.webkitCompassHeading?this._heading=x.webkitCompassHeading:!0===x.absolute&&(this._heading=-1*x.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let x;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(x={maximumAge:6e5,timeout:0},this._noTimeout=!0):(x=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,x),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const x=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(c=>{"granted"===c&&x()}).catch(console.error):x()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Tn,ScaleControl:class{constructor(x){this.options=p.extend({},ip,x),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),p.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const x=this.options.maxWidth||100,c=this._map,g=c._containerHeight/2,C=c._containerWidth/2-x/2,T=c.unproject([C,g]),A=c.unproject([C+x,g]),L=T.distanceTo(A);if("imperial"===this.options.unit){const F=3.2808*L;F>5280?this._setScale(x,F/5280,"mile"):this._setScale(x,F,"foot")}else"nautical"===this.options.unit?this._setScale(x,L/1852,"nautical-mile"):L>=1e3?this._setScale(x,L/1e3,"kilometer"):this._setScale(x,L,"meter")}_setScale(x,c,g){this._map._requestDomTask(()=>{const C=function(A){const L=Math.pow(10,`${Math.floor(A)}`.length-1);let F=A/L;return F=F>=10?10:F>=5?5:F>=3?3:F>=2?2:F>=1?1:function(V){const H=Math.pow(10,Math.ceil(-Math.log(V)/Math.LN10));return Math.round(V*H)/H}(F),L*F}(c),T=C/c;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==g?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:g}).format(C):`${C}&nbsp;${wm[g]}`,this._container.style.width=x*T+"px"})}onAdd(x){return this._map=x,this._language=x.getLanguage(),this._container=Et("div","mapboxgl-ctrl mapboxgl-ctrl-scale",x.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(x){this._language=x,this._update()}setUnit(x){this.options.unit=x,this._update()}},FullscreenControl:class{constructor(x){this._fullscreen=!1,x&&x.container&&(x.container instanceof p.window.HTMLElement?this._container=x.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(x){return this._map=x,this._container||(this._container=this._map.getContainer()),this._controlContainer=Et("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const x=this._fullscreenButton=Et("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Et("span","mapboxgl-ctrl-icon",x).setAttribute("aria-hidden","true"),x.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const x=this._getTitle();this._fullscreenButton.setAttribute("aria-label",x),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",x)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(x){super(),this.options=p.extend(Object.create(np),x),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(x&&x.className?x.className.trim().split(/\s+/):[])}addTo(x){return this._map&&this.remove(),this._map=x,this.options.closeOnClick&&x.on("preclick",this._onClose),this.options.closeOnMove&&x.on("move",this._onClose),x.on("remove",this.remove),this._update(),x._addPopup(this),this._focusFirstElement(),this._trackPointer?(x.on("mousemove",this._onMouseEvent),x.on("mouseup",this._onMouseEvent),x._canvasContainer.classList.add("mapboxgl-track-pointer")):x.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const x=this._map;return x&&(x.off("move",this._update),x.off("move",this._onClose),x.off("preclick",this._onClose),x.off("click",this._onClose),x.off("remove",this.remove),x.off("mousemove",this._onMouseEvent),x.off("mouseup",this._onMouseEvent),x.off("drag",this._onMouseEvent),x._canvasContainer&&x._canvasContainer.classList.remove("mapboxgl-track-pointer"),x._removePopup(this),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(x){this._lngLat=p.LngLat.convert(x),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const x=this._map;return x&&(x.off("move",this._update),x.on("mousemove",this._onMouseEvent),x.on("drag",this._onMouseEvent),x._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(x){return this.setDOMContent(p.window.document.createTextNode(x))}setHTML(x){const c=p.window.document.createDocumentFragment(),g=p.window.document.createElement("body");let C;for(g.innerHTML=x;C=g.firstChild,C;)c.appendChild(C);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(x){return this.options.maxWidth=x,this._update(),this}setDOMContent(x){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=Et("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(x),this.options.closeButton){const g=this._closeButton=Et("button","mapboxgl-popup-close-button",c);g.type="button",g.setAttribute("aria-label","Close popup"),g.setAttribute("aria-hidden","true"),g.innerHTML="&#215;",g.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(x){return this._classList.add(x),this._updateClassList(),this}removeClassName(x){return this._classList.delete(x),this._updateClassList(),this}setOffset(x){return this.options.offset=x,this._update(),this}toggleClassName(x){let c;return this._classList.delete(x)?c=!1:(this._classList.add(x),c=!0),this._updateClassList(),c}_onMouseEvent(x){this._update(x.point)}_getAnchor(x){if(this.options.anchor)return this.options.anchor;const c=this._map,g=this._container,C=this._pos;if(!c||!g||!C)return"bottom";const T=g.offsetWidth,A=g.offsetHeight,L=C.x<T/2,F=C.x>c.transform.width-T/2;if(C.y+x<A)return L?"top-left":F?"top-right":"top";if(C.y>c.transform.height-A){if(L)return"bottom-left";if(F)return"bottom-right"}return L?"left":F?"right":"bottom"}_updateClassList(){const x=this._container;if(!x)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),x.className=c.join(" ")}_update(x){const c=this._map,g=this._content;if(!c||!this._lngLat&&!this._trackPointer||!g)return;let C=this._container;if(C||(C=this._container=Et("div","mapboxgl-popup",c.getContainer()),this._tip=Et("div","mapboxgl-popup-tip",C),C.appendChild(g)),this.options.maxWidth&&C.style.maxWidth!==this.options.maxWidth&&(C.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ml(this._lngLat,this._pos,c.transform)),!this._trackPointer||x){const T=this._pos=this._trackPointer&&x?x:c.project(this._lngLat),A=xm(this.options.offset),L=this._anchor=this._getAnchor(A.y),F=xm(this.options.offset,L),V=T.add(F).round();c._requestDomTask(()=>{this._container&&L&&(this._container.style.transform=`${Ac[L]} translate(${V.x}px,${V.y}px)`)})}if(!this._marker&&c._showingGlobe()){const T=p.isLngLatBehindGlobe(c.transform,this._lngLat)?0:1;this._setOpacity(T)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const x=this._container.querySelector(dy);x&&x.focus()}_onClose(){this.remove()}_setOpacity(x){this._container&&(this._container.style.opacity=`${x}`),this._content&&(this._content.style.pointerEvents=x?"auto":"none")}},Marker:Ln,Style:Oo,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:is,Evented:p.Evented,config:p.config,prewarm:function(){Bl().acquire($s)},clearPrewarmedResources:function(){const x=Vi;x&&(x.isPreloaded()&&1===x.numActive()?(x.release($s),Vi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(x){p.config.ACCESS_TOKEN=x},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(x){p.config.API_URL=x},get workerCount(){return To.workerCount},set workerCount(x){To.workerCount=x},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(x){p.config.MAX_PARALLEL_IMAGE_REQUESTS=x},clearStorage(x){p.clearTileCache(x)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return Th}),Ee}()},4772:sn=>{"use strict";var vt=Object.getOwnPropertySymbols,qe=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;sn.exports=function ht(){try{if(!Object.assign)return!1;var p=new String("abc");if(p[5]="de","5"===Object.getOwnPropertyNames(p)[0])return!1;for(var be={},Xe=0;Xe<10;Xe++)be["_"+String.fromCharCode(Xe)]=Xe;if("0123456789"!==Object.getOwnPropertyNames(be).map(function(Et){return be[Et]}).join(""))return!1;var ft={};return"abcdefghijklmnopqrst".split("").forEach(function(Et){ft[Et]=Et}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},ft)).join("")}catch{return!1}}()?Object.assign:function(p,be){for(var Xe,ft,dt=function ze(p){if(null==p)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(p)}(p),Et=1;Et<arguments.length;Et++){for(var rn in Xe=Object(arguments[Et]))qe.call(Xe,rn)&&(dt[rn]=Xe[rn]);if(vt){ft=vt(Xe);for(var Dt=0;Dt<ft.length;Dt++)Ee.call(Xe,ft[Dt])&&(dt[ft[Dt]]=Xe[ft[Dt]])}}return dt}},4246:sn=>{"use strict";var vt=function(qe){return qe!=qe};sn.exports=function(Ee,ze){return 0===Ee&&0===ze?1/Ee==1/ze:!!(Ee===ze||vt(Ee)&&vt(ze))}},314:(sn,vt,qe)=>{"use strict";var Ee=qe(1648),ze=qe(5436),ht=qe(4246),p=qe(1353),be=qe(3090),Xe=ze(p(),Object);Ee(Xe,{getPolyfill:p,implementation:ht,shim:be}),sn.exports=Xe},1353:(sn,vt,qe)=>{"use strict";var Ee=qe(4246);sn.exports=function(){return"function"==typeof Object.is?Object.is:Ee}},3090:(sn,vt,qe)=>{"use strict";var Ee=qe(1353),ze=qe(1648);sn.exports=function(){var p=Ee();return ze(Object,{is:p},{is:function(){return Object.is!==p}}),p}},7972:(sn,vt,qe)=>{"use strict";var Ee;if(!Object.keys){var ze=Object.prototype.hasOwnProperty,ht=Object.prototype.toString,p=qe(9637),be=Object.prototype.propertyIsEnumerable,Xe=!be.call({toString:null},"toString"),dt=be.call(function(){},"prototype"),ft=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Et=function(Vt){var hn=Vt.constructor;return hn&&hn.prototype===Vt},rn={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},Dt=function(){if(typeof window>"u")return!1;for(var Vt in window)try{if(!rn["$"+Vt]&&ze.call(window,Vt)&&null!==window[Vt]&&"object"==typeof window[Vt])try{Et(window[Vt])}catch{return!0}}catch{return!0}return!1}();Ee=function(hn){var de=null!==hn&&"object"==typeof hn,Ne="[object Function]"===ht.call(hn),ue=p(hn),fe=de&&"[object String]"===ht.call(hn),he=[];if(!de&&!Ne&&!ue)throw new TypeError("Object.keys called on a non-object");var Fe=dt&&Ne;if(fe&&hn.length>0&&!ze.call(hn,0))for(var ce=0;ce<hn.length;++ce)he.push(String(ce));if(ue&&hn.length>0)for(var ne=0;ne<hn.length;++ne)he.push(String(ne));else for(var Me in hn)(!Fe||"prototype"!==Me)&&ze.call(hn,Me)&&he.push(String(Me));if(Xe)for(var ie=function(Vt){if(typeof window>"u"||!Dt)return Et(Vt);try{return Et(Vt)}catch{return!1}}(hn),rt=0;rt<ft.length;++rt)(!ie||"constructor"!==ft[rt])&&ze.call(hn,ft[rt])&&he.push(ft[rt]);return he}}sn.exports=Ee},7809:(sn,vt,qe)=>{"use strict";var Ee=Array.prototype.slice,ze=qe(9637),ht=Object.keys,p=ht?function(dt){return ht(dt)}:qe(7972),be=Object.keys;p.shim=function(){if(Object.keys){var dt=function(){var ft=Object.keys(arguments);return ft&&ft.length===arguments.length}(1,2);dt||(Object.keys=function(Et){return ze(Et)?be(Ee.call(Et)):be(Et)})}else Object.keys=p;return Object.keys||p},sn.exports=p},9637:sn=>{"use strict";var vt=Object.prototype.toString;sn.exports=function(Ee){var ze=vt.call(Ee),ht="[object Arguments]"===ze;return ht||(ht="[object Array]"!==ze&&null!==Ee&&"object"==typeof Ee&&"number"==typeof Ee.length&&Ee.length>=0&&"[object Function]"===vt.call(Ee.callee)),ht}},4018:sn=>{sn.exports=function(qe,Ee,ze,ht){var p=qe[0],be=qe[1],Xe=!1;void 0===ze&&(ze=0),void 0===ht&&(ht=Ee.length);for(var dt=(ht-ze)/2,ft=0,Et=dt-1;ft<dt;Et=ft++){var rn=Ee[ze+2*ft+0],Dt=Ee[ze+2*ft+1],Vt=Ee[ze+2*Et+1];Dt>be!=Vt>be&&p<(Ee[ze+2*Et+0]-rn)*(be-Dt)/(Vt-Dt)+rn&&(Xe=!Xe)}return Xe}},4179:(sn,vt,qe)=>{var Ee=qe(4018),ze=qe(8875);sn.exports=function(p,be,Xe,dt){return be.length>0&&Array.isArray(be[0])?ze(p,be,Xe,dt):Ee(p,be,Xe,dt)},sn.exports.nested=ze,sn.exports.flat=Ee},8875:sn=>{sn.exports=function(qe,Ee,ze,ht){var p=qe[0],be=qe[1],Xe=!1;void 0===ze&&(ze=0),void 0===ht&&(ht=Ee.length);for(var dt=ht-ze,ft=0,Et=dt-1;ft<dt;Et=ft++){var rn=Ee[ft+ze][0],Dt=Ee[ft+ze][1],Vt=Ee[Et+ze][1];Dt>be!=Vt>be&&p<(Ee[Et+ze][0]-rn)*(be-Dt)/(Vt-Dt)+rn&&(Xe=!Xe)}return Xe}},8464:function(sn){sn.exports=function(){"use strict";function vt(ye,Z){if(!(ye instanceof Z))throw new TypeError("Cannot call a class as a function")}function qe(ye,Z){for(var Y=0;Y<Z.length;Y++){var J=Z[Y];J.enumerable=J.enumerable||!1,J.configurable=!0,"value"in J&&(J.writable=!0),Object.defineProperty(ye,J.key,J)}}function Ee(ye,Z,Y){return Z&&qe(ye.prototype,Z),Y&&qe(ye,Y),ye}var ze=function ye(Z,Y){this.next=null,this.key=Z,this.data=Y,this.left=null,this.right=null};function ht(ye,Z){return ye>Z?1:ye<Z?-1:0}function p(ye,Z,Y){for(var J=new ze(null,null),xe=J,We=J;;){var Tt=Y(ye,Z.key);if(Tt<0){if(null===Z.left)break;if(Y(ye,Z.left.key)<0&&(Z.left=(Ht=Z.left).right,Ht.right=Z,null===(Z=Ht).left))break;We.left=Z,We=Z,Z=Z.left}else{if(!(Tt>0))break;if(null===Z.right)break;var Ht;if(Y(ye,Z.right.key)>0&&(Z.right=(Ht=Z.right).left,Ht.left=Z,null===(Z=Ht).right))break;xe.right=Z,xe=Z,Z=Z.right}}return xe.right=Z.left,We.left=Z.right,Z.left=J.right,Z.right=J.left,Z}function be(ye,Z,Y,J){var xe=new ze(ye,Z);if(null===Y)return xe.left=xe.right=null,xe;var We=J(ye,(Y=p(ye,Y,J)).key);return We<0?(xe.left=Y.left,xe.right=Y,Y.left=null):We>=0&&(xe.right=Y.right,xe.left=Y,Y.right=null),xe}function Xe(ye,Z,Y){var J=null,xe=null;if(Z){var We=Y((Z=p(ye,Z,Y)).key,ye);0===We?(J=Z.left,xe=Z.right):We<0?(xe=Z.right,Z.right=null,J=Z):(J=Z.left,Z.left=null,xe=Z)}return{left:J,right:xe}}function ft(ye,Z,Y,J,xe){if(ye){J(Z+(Y?"\u2514\u2500\u2500 ":"\u251c\u2500\u2500 ")+xe(ye)+"\n");var We=Z+(Y?"    ":"\u2502   ");ye.left&&ft(ye.left,We,!1,J,xe),ye.right&&ft(ye.right,We,!0,J,xe)}}var Et=function(){function ye(Z){void 0===Z&&(Z=ht),this._root=null,this._size=0,this._comparator=Z}return ye.prototype.insert=function(Z,Y){return this._size++,this._root=be(Z,Y,this._root,this._comparator)},ye.prototype.add=function(Z,Y){var J=new ze(Z,Y);null===this._root&&(J.left=J.right=null,this._size++,this._root=J);var xe=this._comparator,We=p(Z,this._root,xe),Tt=xe(Z,We.key);return 0===Tt?this._root=We:(Tt<0?(J.left=We.left,J.right=We,We.left=null):Tt>0&&(J.right=We.right,J.left=We,We.right=null),this._size++,this._root=J),this._root},ye.prototype.remove=function(Z){this._root=this._remove(Z,this._root,this._comparator)},ye.prototype._remove=function(Z,Y,J){var xe;return null===Y?null:0===J(Z,(Y=p(Z,Y,J)).key)?(null===Y.left?xe=Y.right:(xe=p(Z,Y.left,J)).right=Y.right,this._size--,xe):Y},ye.prototype.pop=function(){var Z=this._root;if(Z){for(;Z.left;)Z=Z.left;return this._root=p(Z.key,this._root,this._comparator),this._root=this._remove(Z.key,this._root,this._comparator),{key:Z.key,data:Z.data}}return null},ye.prototype.findStatic=function(Z){for(var Y=this._root,J=this._comparator;Y;){var xe=J(Z,Y.key);if(0===xe)return Y;Y=xe<0?Y.left:Y.right}return null},ye.prototype.find=function(Z){return this._root&&(this._root=p(Z,this._root,this._comparator),0!==this._comparator(Z,this._root.key))?null:this._root},ye.prototype.contains=function(Z){for(var Y=this._root,J=this._comparator;Y;){var xe=J(Z,Y.key);if(0===xe)return!0;Y=xe<0?Y.left:Y.right}return!1},ye.prototype.forEach=function(Z,Y){for(var J=this._root,xe=[],We=!1;!We;)null!==J?(xe.push(J),J=J.left):0!==xe.length?(J=xe.pop(),Z.call(Y,J),J=J.right):We=!0;return this},ye.prototype.range=function(Z,Y,J,xe){for(var We=[],Tt=this._comparator,Ht=this._root;0!==We.length||Ht;)if(Ht)We.push(Ht),Ht=Ht.left;else{if(Tt((Ht=We.pop()).key,Y)>0)break;if(Tt(Ht.key,Z)>=0&&J.call(xe,Ht))return this;Ht=Ht.right}return this},ye.prototype.keys=function(){var Z=[];return this.forEach(function(Y){return Z.push(Y.key)}),Z},ye.prototype.values=function(){var Z=[];return this.forEach(function(Y){return Z.push(Y.data)}),Z},ye.prototype.min=function(){return this._root?this.minNode(this._root).key:null},ye.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},ye.prototype.minNode=function(Z){if(void 0===Z&&(Z=this._root),Z)for(;Z.left;)Z=Z.left;return Z},ye.prototype.maxNode=function(Z){if(void 0===Z&&(Z=this._root),Z)for(;Z.right;)Z=Z.right;return Z},ye.prototype.at=function(Z){for(var Y=this._root,J=!1,xe=0,We=[];!J;)if(Y)We.push(Y),Y=Y.left;else if(We.length>0){if(Y=We.pop(),xe===Z)return Y;xe++,Y=Y.right}else J=!0;return null},ye.prototype.next=function(Z){var Y=this._root,J=null;if(Z.right){for(J=Z.right;J.left;)J=J.left;return J}for(var xe=this._comparator;Y;){var We=xe(Z.key,Y.key);if(0===We)break;We<0?(J=Y,Y=Y.left):Y=Y.right}return J},ye.prototype.prev=function(Z){var Y=this._root,J=null;if(null!==Z.left){for(J=Z.left;J.right;)J=J.right;return J}for(var xe=this._comparator;Y;){var We=xe(Z.key,Y.key);if(0===We)break;We<0?Y=Y.left:(J=Y,Y=Y.right)}return J},ye.prototype.clear=function(){return this._root=null,this._size=0,this},ye.prototype.toList=function(){return function mt(ye){for(var Z=ye,Y=[],J=!1,xe=new ze(null,null),We=xe;!J;)Z?(Y.push(Z),Z=Z.left):Y.length>0?Z=(Z=We=We.next=Y.pop()).right:J=!0;return We.next=null,xe.next}(this._root)},ye.prototype.load=function(Z,Y,J){void 0===Y&&(Y=[]),void 0===J&&(J=!1);var xe=Z.length,We=this._comparator;if(J&&de(Z,Y,0,xe-1,We),null===this._root)this._root=rn(Z,Y,0,xe),this._size=xe;else{var Tt=function hn(ye,Z,Y){for(var J=new ze(null,null),xe=J,We=ye,Tt=Z;null!==We&&null!==Tt;)Y(We.key,Tt.key)<0?(xe.next=We,We=We.next):(xe.next=Tt,Tt=Tt.next),xe=xe.next;return null!==We?xe.next=We:null!==Tt&&(xe.next=Tt),J.next}(this.toList(),function Dt(ye,Z){for(var Y=new ze(null,null),J=Y,xe=0;xe<ye.length;xe++)J=J.next=new ze(ye[xe],Z[xe]);return J.next=null,Y.next}(Z,Y),We);this._root=Vt({head:Tt},0,xe=this._size+xe)}return this},ye.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(ye.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(ye.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),ye.prototype.toString=function(Z){void 0===Z&&(Z=function(xe){return String(xe.key)});var Y=[];return ft(this._root,"",!0,function(J){return Y.push(J)},Z),Y.join("")},ye.prototype.update=function(Z,Y,J){var xe=this._comparator,We=Xe(Z,this._root,xe),Tt=We.left,Ht=We.right;xe(Z,Y)<0?Ht=be(Y,J,Ht,xe):Tt=be(Y,J,Tt,xe),this._root=function dt(ye,Z,Y){return null===Z?ye:(null===ye||((Z=p(ye.key,Z,Y)).left=ye),Z)}(Tt,Ht,xe)},ye.prototype.split=function(Z){return Xe(Z,this._root,this._comparator)},ye}();function rn(ye,Z,Y,J){var xe=J-Y;if(xe>0){var We=Y+Math.floor(xe/2),Gt=new ze(ye[We],Z[We]);return Gt.left=rn(ye,Z,Y,We),Gt.right=rn(ye,Z,We+1,J),Gt}return null}function Vt(ye,Z,Y){var J=Y-Z;if(J>0){var xe=Z+Math.floor(J/2),We=Vt(ye,Z,xe),Tt=ye.head;return Tt.left=We,ye.head=ye.head.next,Tt.right=Vt(ye,xe+1,Y),Tt}return null}function de(ye,Z,Y,J,xe){if(!(Y>=J)){for(var We=ye[Y+J>>1],Tt=Y-1,Ht=J+1;;){do{Tt++}while(xe(ye[Tt],We)<0);do{Ht--}while(xe(ye[Ht],We)>0);if(Tt>=Ht)break;var Gt=ye[Tt];ye[Tt]=ye[Ht],ye[Ht]=Gt,Gt=Z[Tt],Z[Tt]=Z[Ht],Z[Ht]=Gt}de(ye,Z,Y,Ht,xe),de(ye,Z,Ht+1,J,xe)}}var Ne=function(Z,Y){return Z.ll.x<=Y.x&&Y.x<=Z.ur.x&&Z.ll.y<=Y.y&&Y.y<=Z.ur.y},ue=function(Z,Y){return Y.ur.x<Z.ll.x||Z.ur.x<Y.ll.x||Y.ur.y<Z.ll.y||Z.ur.y<Y.ll.y?null:{ll:{x:Z.ll.x<Y.ll.x?Y.ll.x:Z.ll.x,y:Z.ll.y<Y.ll.y?Y.ll.y:Z.ll.y},ur:{x:Z.ur.x<Y.ur.x?Z.ur.x:Y.ur.x,y:Z.ur.y<Y.ur.y?Z.ur.y:Y.ur.y}}},fe=Number.EPSILON;void 0===fe&&(fe=Math.pow(2,-52));var he=fe*fe,Fe=function(Z,Y){if(-fe<Z&&Z<fe&&-fe<Y&&Y<fe)return 0;var J=Z-Y;return J*J<he*Z*Y?0:Z<Y?-1:1},ce=function(){function ye(){vt(this,ye),this.reset()}return Ee(ye,[{key:"reset",value:function(){this.xRounder=new ne,this.yRounder=new ne}},{key:"round",value:function(Y,J){return{x:this.xRounder.round(Y),y:this.yRounder.round(J)}}}]),ye}(),ne=function(){function ye(){vt(this,ye),this.tree=new Et,this.round(0)}return Ee(ye,[{key:"round",value:function(Y){var J=this.tree.add(Y),xe=this.tree.prev(J);if(null!==xe&&0===Fe(J.key,xe.key))return this.tree.remove(Y),xe.key;var We=this.tree.next(J);return null!==We&&0===Fe(J.key,We.key)?(this.tree.remove(Y),We.key):Y}}]),ye}(),Me=new ce,ie=function(Z,Y){return Z.x*Y.y-Z.y*Y.x},rt=function(Z,Y){return Z.x*Y.x+Z.y*Y.y},Ve=function(Z,Y,J){var Tt=ie({x:Y.x-Z.x,y:Y.y-Z.y},{x:J.x-Z.x,y:J.y-Z.y});return Fe(Tt,0)},Ke=function(Z){return Math.sqrt(rt(Z,Z))},Te=function(Z,Y,J){var xe={x:Y.x-Z.x,y:Y.y-Z.y},We={x:J.x-Z.x,y:J.y-Z.y};return ie(We,xe)/Ke(We)/Ke(xe)},Kt=function(Z,Y,J){var xe={x:Y.x-Z.x,y:Y.y-Z.y},We={x:J.x-Z.x,y:J.y-Z.y};return rt(We,xe)/Ke(We)/Ke(xe)},At=function(Z,Y,J){return 0===Y.y?null:{x:Z.x+Y.x/Y.y*(J-Z.y),y:J}},we=function(Z,Y,J){return 0===Y.x?null:{x:J,y:Z.y+Y.y/Y.x*(J-Z.x)}},Ae=function(){function ye(Z,Y){vt(this,ye),void 0===Z.events?Z.events=[this]:Z.events.push(this),this.point=Z,this.isLeft=Y}return Ee(ye,null,[{key:"compare",value:function(Y,J){var xe=ye.comparePoints(Y.point,J.point);return 0!==xe?xe:(Y.point!==J.point&&Y.link(J),Y.isLeft!==J.isLeft?Y.isLeft?1:-1:pt.compare(Y.segment,J.segment))}},{key:"comparePoints",value:function(Y,J){return Y.x<J.x?-1:Y.x>J.x?1:Y.y<J.y?-1:Y.y>J.y?1:0}}]),Ee(ye,[{key:"link",value:function(Y){if(Y.point===this.point)throw new Error("Tried to link already linked events");for(var J=Y.point.events,xe=0,We=J.length;xe<We;xe++){var Tt=J[xe];this.point.events.push(Tt),Tt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var Y=this.point.events.length,J=0;J<Y;J++){var xe=this.point.events[J];if(void 0===xe.segment.consumedBy)for(var We=J+1;We<Y;We++){var Tt=this.point.events[We];void 0===Tt.consumedBy&&xe.otherSE.point.events===Tt.otherSE.point.events&&xe.segment.consume(Tt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var Y=[],J=0,xe=this.point.events.length;J<xe;J++){var We=this.point.events[J];We!==this&&!We.segment.ringOut&&We.segment.isInResult()&&Y.push(We)}return Y}},{key:"getLeftmostComparator",value:function(Y){var J=this,xe=new Map,We=function(Ht){var Gt=Ht.otherSE;xe.set(Ht,{sine:Te(J.point,Y.point,Gt.point),cosine:Kt(J.point,Y.point,Gt.point)})};return function(Tt,Ht){xe.has(Tt)||We(Tt),xe.has(Ht)||We(Ht);var Gt=xe.get(Tt),Ot=Gt.sine,or=Gt.cosine,_r=xe.get(Ht),Sn=_r.sine,Cr=_r.cosine;return Ot>=0&&Sn>=0?or<Cr?1:or>Cr?-1:0:Ot<0&&Sn<0?or<Cr?-1:or>Cr?1:0:Sn<Ot?-1:Sn>Ot?1:0}}}]),ye}(),it=0,pt=function(){function ye(Z,Y,J,xe){vt(this,ye),this.id=++it,this.leftSE=Z,Z.segment=this,Z.otherSE=Y,this.rightSE=Y,Y.segment=this,Y.otherSE=Z,this.rings=J,this.windings=xe}return Ee(ye,null,[{key:"compare",value:function(Y,J){var xe=Y.leftSE.point.x,We=J.leftSE.point.x,Tt=Y.rightSE.point.x,Ht=J.rightSE.point.x;if(Ht<xe)return 1;if(Tt<We)return-1;var Gt=Y.leftSE.point.y,Ot=J.leftSE.point.y,or=Y.rightSE.point.y,_r=J.rightSE.point.y;if(xe<We){if(Ot<Gt&&Ot<or)return 1;if(Ot>Gt&&Ot>or)return-1;var Sn=Y.comparePoint(J.leftSE.point);if(Sn<0)return 1;if(Sn>0)return-1;var Cr=J.comparePoint(Y.rightSE.point);return 0!==Cr?Cr:-1}if(xe>We){if(Gt<Ot&&Gt<_r)return-1;if(Gt>Ot&&Gt>_r)return 1;var kr=J.comparePoint(Y.leftSE.point);if(0!==kr)return kr;var Fr=Y.comparePoint(J.rightSE.point);return Fr<0?1:Fr>0?-1:1}if(Gt<Ot)return-1;if(Gt>Ot)return 1;if(Tt<Ht){var mr=J.comparePoint(Y.rightSE.point);if(0!==mr)return mr}if(Tt>Ht){var yi=Y.comparePoint(J.rightSE.point);if(yi<0)return 1;if(yi>0)return-1}if(Tt!==Ht){var Po=or-Gt,bs=Tt-xe,Ge=_r-Ot,se=Ht-We;if(Po>bs&&Ge<se)return 1;if(Po<bs&&Ge>se)return-1}return Tt>Ht?1:Tt<Ht||or<_r?-1:or>_r?1:Y.id<J.id?-1:Y.id>J.id?1:0}}]),Ee(ye,[{key:"replaceRightSE",value:function(Y){this.rightSE=Y,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var Y=this.leftSE.point.y,J=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:Y<J?Y:J},ur:{x:this.rightSE.point.x,y:Y>J?Y:J}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(Y){return Y.x===this.leftSE.point.x&&Y.y===this.leftSE.point.y||Y.x===this.rightSE.point.x&&Y.y===this.rightSE.point.y}},{key:"comparePoint",value:function(Y){if(this.isAnEndpoint(Y))return 0;var J=this.leftSE.point,xe=this.rightSE.point,We=this.vector();if(J.x===xe.x)return Y.x===J.x?0:Y.x<J.x?1:-1;if(Y.x===J.x+(Y.y-J.y)/We.y*We.x)return 0;var Ot=J.y+(Y.x-J.x)/We.x*We.y;return Y.y===Ot?0:Y.y<Ot?-1:1}},{key:"getIntersection",value:function(Y){var J=this.bbox(),xe=Y.bbox(),We=ue(J,xe);if(null===We)return null;var Tt=this.leftSE.point,Ht=this.rightSE.point,Gt=Y.leftSE.point,Ot=Y.rightSE.point,or=Ne(J,Gt)&&0===this.comparePoint(Gt),_r=Ne(xe,Tt)&&0===Y.comparePoint(Tt),Sn=Ne(J,Ot)&&0===this.comparePoint(Ot),Cr=Ne(xe,Ht)&&0===Y.comparePoint(Ht);if(_r&&or)return Cr&&!Sn?Ht:!Cr&&Sn?Ot:null;if(_r)return Sn&&Tt.x===Ot.x&&Tt.y===Ot.y?null:Tt;if(or)return Cr&&Ht.x===Gt.x&&Ht.y===Gt.y?null:Gt;if(Cr&&Sn)return null;if(Cr)return Ht;if(Sn)return Ot;var kr=function(Z,Y,J,xe){if(0===Y.x)return we(J,xe,Z.x);if(0===xe.x)return we(Z,Y,J.x);if(0===Y.y)return At(J,xe,Z.y);if(0===xe.y)return At(Z,Y,J.y);var We=ie(Y,xe);if(0==We)return null;var Tt={x:J.x-Z.x,y:J.y-Z.y},Ht=ie(Tt,Y)/We,Gt=ie(Tt,xe)/We;return{x:(Z.x+Gt*Y.x+(J.x+Ht*xe.x))/2,y:(Z.y+Gt*Y.y+(J.y+Ht*xe.y))/2}}(Tt,this.vector(),Gt,Y.vector());return null!==kr&&Ne(We,kr)?Me.round(kr.x,kr.y):null}},{key:"split",value:function(Y){var J=[],xe=void 0!==Y.events,We=new Ae(Y,!0),Tt=new Ae(Y,!1),Ht=this.rightSE;this.replaceRightSE(Tt),J.push(Tt),J.push(We);var Gt=new ye(We,Ht,this.rings.slice(),this.windings.slice());return Ae.comparePoints(Gt.leftSE.point,Gt.rightSE.point)>0&&Gt.swapEvents(),Ae.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),xe&&(We.checkForConsuming(),Tt.checkForConsuming()),J}},{key:"swapEvents",value:function(){var Y=this.rightSE;this.rightSE=this.leftSE,this.leftSE=Y,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var J=0,xe=this.windings.length;J<xe;J++)this.windings[J]*=-1}},{key:"consume",value:function(Y){for(var J=this,xe=Y;J.consumedBy;)J=J.consumedBy;for(;xe.consumedBy;)xe=xe.consumedBy;var We=ye.compare(J,xe);if(0!==We){if(We>0){var Tt=J;J=xe,xe=Tt}if(J.prev===xe){var Ht=J;J=xe,xe=Ht}for(var Gt=0,Ot=xe.rings.length;Gt<Ot;Gt++){var or=xe.rings[Gt],_r=xe.windings[Gt],Sn=J.rings.indexOf(or);-1===Sn?(J.rings.push(or),J.windings.push(_r)):J.windings[Sn]+=_r}xe.rings=null,xe.windings=null,xe.consumedBy=J,xe.leftSE.consumedBy=J.leftSE,xe.rightSE.consumedBy=J.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this._prevInResult=this.prev?this.prev.isInResult()?this.prev:this.prev.prevInResult():null),this._prevInResult}},{key:"beforeState",value:function(){return void 0!==this._beforeState||(this._beforeState=this.prev?(this.prev.consumedBy||this.prev).afterState():{rings:[],windings:[],multiPolys:[]}),this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var Y=this.beforeState();this._afterState={rings:Y.rings.slice(0),windings:Y.windings.slice(0),multiPolys:[]};for(var J=this._afterState.rings,xe=this._afterState.windings,We=this._afterState.multiPolys,Tt=0,Ht=this.rings.length;Tt<Ht;Tt++){var Gt=this.rings[Tt],Ot=this.windings[Tt],or=J.indexOf(Gt);-1===or?(J.push(Gt),xe.push(Ot)):xe[or]+=Ot}for(var _r=[],Sn=[],Cr=0,kr=J.length;Cr<kr;Cr++)if(0!==xe[Cr]){var Fr=J[Cr],mr=Fr.poly;if(-1===Sn.indexOf(mr))if(Fr.isExterior)_r.push(mr);else{-1===Sn.indexOf(mr)&&Sn.push(mr);var yi=_r.indexOf(Fr.poly);-1!==yi&&_r.splice(yi,1)}}for(var Po=0,bs=_r.length;Po<bs;Po++){var Ge=_r[Po].multiPoly;-1===We.indexOf(Ge)&&We.push(Ge)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var Y=this.beforeState().multiPolys,J=this.afterState().multiPolys;switch(un.type){case"union":this._isInResult=0===Y.length!=(0===J.length);break;case"intersection":var Tt,Ht;Y.length<J.length?(Tt=Y.length,Ht=J.length):(Tt=J.length,Ht=Y.length),this._isInResult=Ht===un.numMultiPolys&&Tt<Ht;break;case"xor":var Gt=Math.abs(Y.length-J.length);this._isInResult=Gt%2==1;break;case"difference":var Ot=function(_r){return 1===_r.length&&_r[0].isSubject};this._isInResult=Ot(Y)!==Ot(J);break;default:throw new Error("Unrecognized operation type found ".concat(un.type))}return this._isInResult}}],[{key:"fromRing",value:function(Y,J,xe){var We,Tt,Ht,Gt=Ae.comparePoints(Y,J);if(Gt<0)We=Y,Tt=J,Ht=1;else{if(!(Gt>0))throw new Error("Tried to create degenerate segment at [".concat(Y.x,", ").concat(Y.y,"]"));We=J,Tt=Y,Ht=-1}return new ye(new Ae(We,!0),new Ae(Tt,!1),[xe],[Ht])}}]),ye}(),Ie=function(){function ye(Z,Y,J){if(vt(this,ye),!Array.isArray(Z)||0===Z.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=Y,this.isExterior=J,this.segments=[],"number"!=typeof Z[0][0]||"number"!=typeof Z[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var xe=Me.round(Z[0][0],Z[0][1]);this.bbox={ll:{x:xe.x,y:xe.y},ur:{x:xe.x,y:xe.y}};for(var We=xe,Tt=1,Ht=Z.length;Tt<Ht;Tt++){if("number"!=typeof Z[Tt][0]||"number"!=typeof Z[Tt][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Gt=Me.round(Z[Tt][0],Z[Tt][1]);Gt.x===We.x&&Gt.y===We.y||(this.segments.push(pt.fromRing(We,Gt,this)),Gt.x<this.bbox.ll.x&&(this.bbox.ll.x=Gt.x),Gt.y<this.bbox.ll.y&&(this.bbox.ll.y=Gt.y),Gt.x>this.bbox.ur.x&&(this.bbox.ur.x=Gt.x),Gt.y>this.bbox.ur.y&&(this.bbox.ur.y=Gt.y),We=Gt)}(xe.x!==We.x||xe.y!==We.y)&&this.segments.push(pt.fromRing(We,xe,this))}return Ee(ye,[{key:"getSweepEvents",value:function(){for(var Y=[],J=0,xe=this.segments.length;J<xe;J++){var We=this.segments[J];Y.push(We.leftSE),Y.push(We.rightSE)}return Y}}]),ye}(),Ut=function(){function ye(Z,Y){if(vt(this,ye),!Array.isArray(Z))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ie(Z[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var J=1,xe=Z.length;J<xe;J++){var We=new Ie(Z[J],this,!1);We.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=We.bbox.ll.x),We.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=We.bbox.ll.y),We.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=We.bbox.ur.x),We.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=We.bbox.ur.y),this.interiorRings.push(We)}this.multiPoly=Y}return Ee(ye,[{key:"getSweepEvents",value:function(){for(var Y=this.exteriorRing.getSweepEvents(),J=0,xe=this.interiorRings.length;J<xe;J++)for(var We=this.interiorRings[J].getSweepEvents(),Tt=0,Ht=We.length;Tt<Ht;Tt++)Y.push(We[Tt]);return Y}}]),ye}(),It=function(){function ye(Z,Y){if(vt(this,ye),!Array.isArray(Z))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof Z[0][0][0]&&(Z=[Z])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var J=0,xe=Z.length;J<xe;J++){var We=new Ut(Z[J],this);We.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=We.bbox.ll.x),We.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=We.bbox.ll.y),We.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=We.bbox.ur.x),We.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=We.bbox.ur.y),this.polys.push(We)}this.isSubject=Y}return Ee(ye,[{key:"getSweepEvents",value:function(){for(var Y=[],J=0,xe=this.polys.length;J<xe;J++)for(var We=this.polys[J].getSweepEvents(),Tt=0,Ht=We.length;Tt<Ht;Tt++)Y.push(We[Tt]);return Y}}]),ye}(),yn=function(){function ye(Z){vt(this,ye),this.events=Z;for(var Y=0,J=Z.length;Y<J;Y++)Z[Y].segment.ringOut=this;this.poly=null}return Ee(ye,null,[{key:"factory",value:function(Y){for(var J=[],xe=0,We=Y.length;xe<We;xe++){var Tt=Y[xe];if(Tt.isInResult()&&!Tt.ringOut){for(var Ht=null,Gt=Tt.leftSE,Ot=Tt.rightSE,or=[Gt],_r=Gt.point,Sn=[];Ht=Gt,or.push(Gt=Ot),Gt.point!==_r;)for(;;){var Cr=Gt.getAvailableLinkedEvents();if(0===Cr.length){var kr=or[0].point,Fr=or[or.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(kr.x,",")+" ".concat(kr.y,"]. Last matching segment found ends at")+" [".concat(Fr.x,", ").concat(Fr.y,"]."))}if(1===Cr.length){Ot=Cr[0].otherSE;break}for(var mr=null,yi=0,Po=Sn.length;yi<Po;yi++)if(Sn[yi].point===Gt.point){mr=yi;break}if(null===mr){Sn.push({index:or.length,point:Gt.point});var se=Gt.getLeftmostComparator(Ht);Ot=Cr.sort(se)[0].otherSE;break}var bs=Sn.splice(mr)[0],Ge=or.splice(bs.index);Ge.unshift(Ge[0].otherSE),J.push(new ye(Ge.reverse()))}J.push(new ye(or))}}return J}}]),Ee(ye,[{key:"getGeom",value:function(){for(var Y=this.events[0].point,J=[Y],xe=1,We=this.events.length-1;xe<We;xe++){var Tt=this.events[xe].point;0!==Ve(Tt,Y,this.events[xe+1].point)&&(J.push(Tt),Y=Tt)}if(1===J.length)return null;0===Ve(J[0],Y,J[1])&&J.shift(),J.push(J[0]);for(var or=this.isExteriorRing()?1:-1,_r=this.isExteriorRing()?0:J.length-1,Sn=this.isExteriorRing()?J.length:-1,Cr=[],kr=_r;kr!=Sn;kr+=or)Cr.push([J[kr].x,J[kr].y]);return Cr}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var Y=this.enclosingRing();this._isExteriorRing=!Y||!Y.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var Y=this.events[0],J=1,xe=this.events.length;J<xe;J++){var We=this.events[J];Ae.compare(Y,We)>0&&(Y=We)}for(var Tt=Y.segment.prevInResult(),Ht=Tt?Tt.prevInResult():null;;){if(!Tt)return null;if(!Ht)return Tt.ringOut;if(Ht.ringOut!==Tt.ringOut)return Ht.ringOut.enclosingRing()!==Tt.ringOut?Tt.ringOut:Tt.ringOut.enclosingRing();Tt=Ht.prevInResult(),Ht=Tt?Tt.prevInResult():null}}}]),ye}(),Mt=function(){function ye(Z){vt(this,ye),this.exteriorRing=Z,Z.poly=this,this.interiorRings=[]}return Ee(ye,[{key:"addInterior",value:function(Y){this.interiorRings.push(Y),Y.poly=this}},{key:"getGeom",value:function(){var Y=[this.exteriorRing.getGeom()];if(null===Y[0])return null;for(var J=0,xe=this.interiorRings.length;J<xe;J++){var We=this.interiorRings[J].getGeom();null!==We&&Y.push(We)}return Y}}]),ye}(),$n=function(){function ye(Z){vt(this,ye),this.rings=Z,this.polys=this._composePolys(Z)}return Ee(ye,[{key:"getGeom",value:function(){for(var Y=[],J=0,xe=this.polys.length;J<xe;J++){var We=this.polys[J].getGeom();null!==We&&Y.push(We)}return Y}},{key:"_composePolys",value:function(Y){for(var J=[],xe=0,We=Y.length;xe<We;xe++){var Tt=Y[xe];if(!Tt.poly)if(Tt.isExteriorRing())J.push(new Mt(Tt));else{var Ht=Tt.enclosingRing();Ht.poly||J.push(new Mt(Ht)),Ht.poly.addInterior(Tt)}}return J}}]),ye}(),Nn=function(){function ye(Z){var Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pt.compare;vt(this,ye),this.queue=Z,this.tree=new Et(Y),this.segments=[]}return Ee(ye,[{key:"process",value:function(Y){var J=Y.segment,xe=[];if(Y.consumedBy)return Y.isLeft?this.queue.remove(Y.otherSE):this.tree.remove(J),xe;var We=Y.isLeft?this.tree.insert(J):this.tree.find(J);if(!We)throw new Error("Unable to find segment #".concat(J.id," ")+"[".concat(J.leftSE.point.x,", ").concat(J.leftSE.point.y,"] -> ")+"[".concat(J.rightSE.point.x,", ").concat(J.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var Tt=We,Ht=We,Gt=void 0,Ot=void 0;void 0===Gt;)null===(Tt=this.tree.prev(Tt))?Gt=null:void 0===Tt.key.consumedBy&&(Gt=Tt.key);for(;void 0===Ot;)null===(Ht=this.tree.next(Ht))?Ot=null:void 0===Ht.key.consumedBy&&(Ot=Ht.key);if(Y.isLeft){var or=null;if(Gt){var _r=Gt.getIntersection(J);if(null!==_r&&(J.isAnEndpoint(_r)||(or=_r),!Gt.isAnEndpoint(_r)))for(var Sn=this._splitSafely(Gt,_r),Cr=0,kr=Sn.length;Cr<kr;Cr++)xe.push(Sn[Cr])}var Fr=null;if(Ot){var mr=Ot.getIntersection(J);if(null!==mr&&(J.isAnEndpoint(mr)||(Fr=mr),!Ot.isAnEndpoint(mr)))for(var yi=this._splitSafely(Ot,mr),Po=0,bs=yi.length;Po<bs;Po++)xe.push(yi[Po])}if(null!==or||null!==Fr){var Ge;Ge=null===or?Fr:null===Fr||Ae.comparePoints(or,Fr)<=0?or:Fr,this.queue.remove(J.rightSE),xe.push(J.rightSE);for(var ae=J.split(Ge),je=0,tt=ae.length;je<tt;je++)xe.push(ae[je])}xe.length>0?(this.tree.remove(J),xe.push(Y)):(this.segments.push(J),J.prev=Gt)}else{if(Gt&&Ot){var Oe=Gt.getIntersection(Ot);if(null!==Oe){if(!Gt.isAnEndpoint(Oe))for(var Ct=this._splitSafely(Gt,Oe),bt=0,Qe=Ct.length;bt<Qe;bt++)xe.push(Ct[bt]);if(!Ot.isAnEndpoint(Oe))for(var Lt=this._splitSafely(Ot,Oe),fn=0,En=Lt.length;fn<En;fn++)xe.push(Lt[fn])}}this.tree.remove(J)}return xe}},{key:"_splitSafely",value:function(Y,J){this.tree.remove(Y);var xe=Y.rightSE;this.queue.remove(xe);var We=Y.split(J);return We.push(xe),void 0===Y.consumedBy&&this.tree.insert(Y),We}}]),ye}(),Dn=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,gn=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,un=new(function(){function ye(){vt(this,ye)}return Ee(ye,[{key:"run",value:function(Y,J,xe){un.type=Y,Me.reset();for(var We=[new It(J,!0)],Tt=0,Ht=xe.length;Tt<Ht;Tt++)We.push(new It(xe[Tt],!1));if(un.numMultiPolys=We.length,"difference"===un.type)for(var Gt=We[0],Ot=1;Ot<We.length;)null!==ue(We[Ot].bbox,Gt.bbox)?Ot++:We.splice(Ot,1);if("intersection"===un.type)for(var or=0,_r=We.length;or<_r;or++)for(var Sn=We[or],Cr=or+1,kr=We.length;Cr<kr;Cr++)if(null===ue(Sn.bbox,We[Cr].bbox))return[];for(var Fr=new Et(Ae.compare),mr=0,yi=We.length;mr<yi;mr++)for(var Po=We[mr].getSweepEvents(),bs=0,Ge=Po.length;bs<Ge;bs++)if(Fr.insert(Po[bs]),Fr.size>Dn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var se=new Nn(Fr),ae=Fr.size,je=Fr.pop();je;){var tt=je.key;if(Fr.size===ae){var Oe=tt.segment;throw new Error("Unable to pop() ".concat(tt.isLeft?"left":"right"," SweepEvent ")+"[".concat(tt.point.x,", ").concat(tt.point.y,"] from segment #").concat(Oe.id," ")+"[".concat(Oe.leftSE.point.x,", ").concat(Oe.leftSE.point.y,"] -> ")+"[".concat(Oe.rightSE.point.x,", ").concat(Oe.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(Fr.size>Dn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(se.segments.length>gn)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var Ct=se.process(tt),bt=0,Qe=Ct.length;bt<Qe;bt++){var Lt=Ct[bt];void 0===Lt.consumedBy&&Fr.insert(Lt)}ae=Fr.size,je=Fr.pop()}Me.reset();var fn=yn.factory(se.segments);return new $n(fn).getGeom()}}]),ye}());return{union:function(Z){for(var Y=arguments.length,J=new Array(Y>1?Y-1:0),xe=1;xe<Y;xe++)J[xe-1]=arguments[xe];return un.run("union",Z,J)},intersection:function(Z){for(var Y=arguments.length,J=new Array(Y>1?Y-1:0),xe=1;xe<Y;xe++)J[xe-1]=arguments[xe];return un.run("intersection",Z,J)},xor:function(Z){for(var Y=arguments.length,J=new Array(Y>1?Y-1:0),xe=1;xe<Y;xe++)J[xe-1]=arguments[xe];return un.run("xor",Z,J)},difference:function(Z){for(var Y=arguments.length,J=new Array(Y>1?Y-1:0),xe=1;xe<Y;xe++)J[xe-1]=arguments[xe];return un.run("difference",Z,J)}}}()},7861:(sn,vt,qe)=>{"use strict";sn.exports=ze,sn.exports.default=ze;var Ee=qe(2136);function ze(ue,fe){if(!(this instanceof ze))return new ze(ue,fe);this._maxEntries=Math.max(4,ue||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),fe&&this._initFormat(fe),this.clear()}function ht(ue,fe,he){if(!he)return fe.indexOf(ue);for(var Fe=0;Fe<fe.length;Fe++)if(he(ue,fe[Fe]))return Fe;return-1}function p(ue,fe){be(ue,0,ue.children.length,fe,ue)}function be(ue,fe,he,Fe,ce){ce||(ce=de(null)),ce.minX=1/0,ce.minY=1/0,ce.maxX=-1/0,ce.maxY=-1/0;for(var Me,ne=fe;ne<he;ne++)Me=ue.children[ne],Xe(ce,ue.leaf?Fe(Me):Me);return ce}function Xe(ue,fe){return ue.minX=Math.min(ue.minX,fe.minX),ue.minY=Math.min(ue.minY,fe.minY),ue.maxX=Math.max(ue.maxX,fe.maxX),ue.maxY=Math.max(ue.maxY,fe.maxY),ue}function dt(ue,fe){return ue.minX-fe.minX}function ft(ue,fe){return ue.minY-fe.minY}function Et(ue){return(ue.maxX-ue.minX)*(ue.maxY-ue.minY)}function rn(ue){return ue.maxX-ue.minX+(ue.maxY-ue.minY)}function Dt(ue,fe){return(Math.max(fe.maxX,ue.maxX)-Math.min(fe.minX,ue.minX))*(Math.max(fe.maxY,ue.maxY)-Math.min(fe.minY,ue.minY))}function mt(ue,fe){var he=Math.max(ue.minX,fe.minX),Fe=Math.max(ue.minY,fe.minY),ce=Math.min(ue.maxX,fe.maxX),ne=Math.min(ue.maxY,fe.maxY);return Math.max(0,ce-he)*Math.max(0,ne-Fe)}function Vt(ue,fe){return ue.minX<=fe.minX&&ue.minY<=fe.minY&&fe.maxX<=ue.maxX&&fe.maxY<=ue.maxY}function hn(ue,fe){return fe.minX<=ue.maxX&&fe.minY<=ue.maxY&&fe.maxX>=ue.minX&&fe.maxY>=ue.minY}function de(ue){return{children:ue,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ne(ue,fe,he,Fe,ce){for(var Me,ne=[fe,he];ne.length;)!((he=ne.pop())-(fe=ne.pop())<=Fe)&&(Me=fe+Math.ceil((he-fe)/Fe/2)*Fe,Ee(ue,Me,fe,he,ce),ne.push(fe,Me,Me,he))}ze.prototype={all:function(){return this._all(this.data,[])},search:function(ue){var fe=this.data,he=[],Fe=this.toBBox;if(!hn(ue,fe))return he;for(var ne,Me,ie,rt,ce=[];fe;){for(ne=0,Me=fe.children.length;ne<Me;ne++)ie=fe.children[ne],hn(ue,rt=fe.leaf?Fe(ie):ie)&&(fe.leaf?he.push(ie):Vt(ue,rt)?this._all(ie,he):ce.push(ie));fe=ce.pop()}return he},collides:function(ue){var fe=this.data,he=this.toBBox;if(!hn(ue,fe))return!1;for(var ce,ne,Me,ie,Fe=[];fe;){for(ce=0,ne=fe.children.length;ce<ne;ce++)if(Me=fe.children[ce],hn(ue,ie=fe.leaf?he(Me):Me)){if(fe.leaf||Vt(ue,ie))return!0;Fe.push(Me)}fe=Fe.pop()}return!1},load:function(ue){if(!ue||!ue.length)return this;if(ue.length<this._minEntries){for(var fe=0,he=ue.length;fe<he;fe++)this.insert(ue[fe]);return this}var Fe=this._build(ue.slice(),0,ue.length-1,0);if(this.data.children.length)if(this.data.height===Fe.height)this._splitRoot(this.data,Fe);else{if(this.data.height<Fe.height){var ce=this.data;this.data=Fe,Fe=ce}this._insert(Fe,this.data.height-Fe.height-1,!0)}else this.data=Fe;return this},insert:function(ue){return ue&&this._insert(ue,this.data.height-1),this},clear:function(){return this.data=de([]),this},remove:function(ue,fe){if(!ue)return this;for(var Me,ie,rt,Ve,he=this.data,Fe=this.toBBox(ue),ce=[],ne=[];he||ce.length;){if(he||(he=ce.pop(),ie=ce[ce.length-1],Me=ne.pop(),Ve=!0),he.leaf&&-1!==(rt=ht(ue,he.children,fe)))return he.children.splice(rt,1),ce.push(he),this._condense(ce),this;Ve||he.leaf||!Vt(he,Fe)?ie?(Me++,he=ie.children[Me],Ve=!1):he=null:(ce.push(he),ne.push(Me),Me=0,ie=he,he=he.children[0])}return this},toBBox:function(ue){return ue},compareMinX:dt,compareMinY:ft,toJSON:function(){return this.data},fromJSON:function(ue){return this.data=ue,this},_all:function(ue,fe){for(var he=[];ue;)ue.leaf?fe.push.apply(fe,ue.children):he.push.apply(he,ue.children),ue=he.pop();return fe},_build:function(ue,fe,he,Fe){var Me,ce=he-fe+1,ne=this._maxEntries;if(ce<=ne)return p(Me=de(ue.slice(fe,he+1)),this.toBBox),Me;Fe||(Fe=Math.ceil(Math.log(ce)/Math.log(ne)),ne=Math.ceil(ce/Math.pow(ne,Fe-1))),(Me=de([])).leaf=!1,Me.height=Fe;var Ve,Ke,Te,Kt,ie=Math.ceil(ce/ne),rt=ie*Math.ceil(Math.sqrt(ne));for(Ne(ue,fe,he,rt,this.compareMinX),Ve=fe;Ve<=he;Ve+=rt)for(Ne(ue,Ve,Te=Math.min(Ve+rt-1,he),ie,this.compareMinY),Ke=Ve;Ke<=Te;Ke+=ie)Kt=Math.min(Ke+ie-1,Te),Me.children.push(this._build(ue,Ke,Kt,Fe-1));return p(Me,this.toBBox),Me},_chooseSubtree:function(ue,fe,he,Fe){for(var ce,ne,Me,ie,rt,Ve,Ke,Te;Fe.push(fe),!fe.leaf&&Fe.length-1!==he;){for(Ke=Te=1/0,ce=0,ne=fe.children.length;ce<ne;ce++)rt=Et(Me=fe.children[ce]),(Ve=Dt(ue,Me)-rt)<Te?(Te=Ve,Ke=rt<Ke?rt:Ke,ie=Me):Ve===Te&&rt<Ke&&(Ke=rt,ie=Me);fe=ie||fe.children[0]}return fe},_insert:function(ue,fe,he){var ce=he?ue:(0,this.toBBox)(ue),ne=[],Me=this._chooseSubtree(ce,this.data,fe,ne);for(Me.children.push(ue),Xe(Me,ce);fe>=0&&ne[fe].children.length>this._maxEntries;)this._split(ne,fe),fe--;this._adjustParentBBoxes(ce,ne,fe)},_split:function(ue,fe){var he=ue[fe],Fe=he.children.length,ce=this._minEntries;this._chooseSplitAxis(he,ce,Fe);var ne=this._chooseSplitIndex(he,ce,Fe),Me=de(he.children.splice(ne,he.children.length-ne));Me.height=he.height,Me.leaf=he.leaf,p(he,this.toBBox),p(Me,this.toBBox),fe?ue[fe-1].children.push(Me):this._splitRoot(he,Me)},_splitRoot:function(ue,fe){this.data=de([ue,fe]),this.data.height=ue.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},_chooseSplitIndex:function(ue,fe,he){var Fe,ce,ne,Me,ie,rt,Ve,Ke;for(rt=Ve=1/0,Fe=fe;Fe<=he-fe;Fe++)Me=mt(ce=be(ue,0,Fe,this.toBBox),ne=be(ue,Fe,he,this.toBBox)),ie=Et(ce)+Et(ne),Me<rt?(rt=Me,Ke=Fe,Ve=ie<Ve?ie:Ve):Me===rt&&ie<Ve&&(Ve=ie,Ke=Fe);return Ke},_chooseSplitAxis:function(ue,fe,he){var Fe=ue.leaf?this.compareMinX:dt,ce=ue.leaf?this.compareMinY:ft;this._allDistMargin(ue,fe,he,Fe)<this._allDistMargin(ue,fe,he,ce)&&ue.children.sort(Fe)},_allDistMargin:function(ue,fe,he,Fe){ue.children.sort(Fe);var rt,Ve,ce=this.toBBox,ne=be(ue,0,fe,ce),Me=be(ue,he-fe,he,ce),ie=rn(ne)+rn(Me);for(rt=fe;rt<he-fe;rt++)Ve=ue.children[rt],Xe(ne,ue.leaf?ce(Ve):Ve),ie+=rn(ne);for(rt=he-fe-1;rt>=fe;rt--)Ve=ue.children[rt],Xe(Me,ue.leaf?ce(Ve):Ve),ie+=rn(Me);return ie},_adjustParentBBoxes:function(ue,fe,he){for(var Fe=he;Fe>=0;Fe--)Xe(fe[Fe],ue)},_condense:function(ue){for(var he,fe=ue.length-1;fe>=0;fe--)0===ue[fe].children.length?fe>0?(he=ue[fe-1].children).splice(he.indexOf(ue[fe]),1):this.clear():p(ue[fe],this.toBBox)},_initFormat:function(ue){var fe=["return a"," - b",";"];this.compareMinX=new Function("a","b",fe.join(ue[0])),this.compareMinY=new Function("a","b",fe.join(ue[1])),this.toBBox=new Function("a","return {minX: a"+ue[0]+", minY: a"+ue[1]+", maxX: a"+ue[2]+", maxY: a"+ue[3]+"};")}}},2136:function(sn){sn.exports=function(){"use strict";function qe(ht,p,be,Xe,dt){for(;Xe>be;){if(Xe-be>600){var ft=Xe-be+1,Et=p-be+1,rn=Math.log(ft),Dt=.5*Math.exp(2*rn/3),mt=.5*Math.sqrt(rn*Dt*(ft-Dt)/ft)*(Et-ft/2<0?-1:1);qe(ht,p,Math.max(be,Math.floor(p-Et*Dt/ft+mt)),Math.min(Xe,Math.floor(p+(ft-Et)*Dt/ft+mt)),dt)}var de=ht[p],Ne=be,ue=Xe;for(Ee(ht,be,p),dt(ht[Xe],de)>0&&Ee(ht,be,Xe);Ne<ue;){for(Ee(ht,Ne,ue),Ne++,ue--;dt(ht[Ne],de)<0;)Ne++;for(;dt(ht[ue],de)>0;)ue--}0===dt(ht[be],de)?Ee(ht,be,ue):Ee(ht,++ue,Xe),ue<=p&&(be=ue+1),p<=ue&&(Xe=ue-1)}}function Ee(ht,p,be){var Xe=ht[p];ht[p]=ht[be],ht[be]=Xe}function ze(ht,p){return ht<p?-1:ht>p?1:0}return function vt(ht,p,be,Xe,dt){qe(ht,p,be||0,Xe||ht.length-1,dt||ze)}}()},3817:(sn,vt,qe)=>{"use strict";var Ee=qe(1552).functionsHaveConfigurableNames(),ze=Object,ht=TypeError;sn.exports=function(){if(null!=this&&this!==ze(this))throw new ht("RegExp.prototype.flags getter called on non-object");var be="";return this.hasIndices&&(be+="d"),this.global&&(be+="g"),this.ignoreCase&&(be+="i"),this.multiline&&(be+="m"),this.dotAll&&(be+="s"),this.unicode&&(be+="u"),this.unicodeSets&&(be+="v"),this.sticky&&(be+="y"),be},Ee&&Object.defineProperty&&Object.defineProperty(sn.exports,"name",{value:"get flags"})},1139:(sn,vt,qe)=>{"use strict";var Ee=qe(1648),ze=qe(5436),ht=qe(3817),p=qe(4861),be=qe(6002),Xe=ze(p());Ee(Xe,{getPolyfill:p,implementation:ht,shim:be}),sn.exports=Xe},4861:(sn,vt,qe)=>{"use strict";var Ee=qe(3817),ze=qe(1648).supportsDescriptors,ht=Object.getOwnPropertyDescriptor;sn.exports=function(){if(ze&&"gim"===/a/gim.flags){var be=ht(RegExp.prototype,"flags");if(be&&"function"==typeof be.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var Xe="",dt={};if(Object.defineProperty(dt,"hasIndices",{get:function(){Xe+="d"}}),Object.defineProperty(dt,"sticky",{get:function(){Xe+="y"}}),"dy"===Xe)return be.get}}return Ee}},6002:(sn,vt,qe)=>{"use strict";var Ee=qe(1648).supportsDescriptors,ze=qe(4861),ht=Object.getOwnPropertyDescriptor,p=Object.defineProperty,be=TypeError,Xe=Object.getPrototypeOf,dt=/a/;sn.exports=function(){if(!Ee||!Xe)throw new be("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var Et=ze(),rn=Xe(dt),Dt=ht(rn,"flags");return(!Dt||Dt.get!==Et)&&p(rn,"flags",{configurable:!0,enumerable:!1,get:Et}),Et}},6138:function(sn,vt){!function(qe){"use strict";function ht(Vt,hn,de,Ne,ue){let fe,he,Fe,ce,ne=hn[0],Me=Ne[0],ie=0,rt=0;Me>ne==Me>-ne?(fe=ne,ne=hn[++ie]):(fe=Me,Me=Ne[++rt]);let Ve=0;if(ie<Vt&&rt<de)for(Me>ne==Me>-ne?(Fe=fe-((he=ne+fe)-ne),ne=hn[++ie]):(Fe=fe-((he=Me+fe)-Me),Me=Ne[++rt]),fe=he,0!==Fe&&(ue[Ve++]=Fe);ie<Vt&&rt<de;)Me>ne==Me>-ne?(Fe=fe-((he=fe+ne)-(ce=he-fe))+(ne-ce),ne=hn[++ie]):(Fe=fe-((he=fe+Me)-(ce=he-fe))+(Me-ce),Me=Ne[++rt]),fe=he,0!==Fe&&(ue[Ve++]=Fe);for(;ie<Vt;)Fe=fe-((he=fe+ne)-(ce=he-fe))+(ne-ce),ne=hn[++ie],fe=he,0!==Fe&&(ue[Ve++]=Fe);for(;rt<de;)Fe=fe-((he=fe+Me)-(ce=he-fe))+(Me-ce),Me=Ne[++rt],fe=he,0!==Fe&&(ue[Ve++]=Fe);return 0===fe&&0!==Ve||(ue[Ve++]=fe),Ve}function p(Vt){return new Float64Array(Vt)}const ft=p(4),Et=p(8),rn=p(12),Dt=p(16),mt=p(4);qe.orient2d=function(Vt,hn,de,Ne,ue,fe){const he=(hn-fe)*(de-ue),Fe=(Vt-ue)*(Ne-fe),ce=he-Fe;if(0===he||0===Fe||he>0!=Fe>0)return ce;const ne=Math.abs(he+Fe);return Math.abs(ce)>=33306690738754716e-32*ne?ce:-function(Me,ie,rt,Ve,Ke,Te,Kt){let At,we,at,Ae,it,pt,Ie,Ut,It,yn,Mt,$n,Nn,Dn,gn,bn,un,Ai;const gr=Me-Ke,ii=rt-Ke,ir=ie-Te,lr=Ve-Te;it=(gn=(Ut=gr-(Ie=(pt=134217729*gr)-(pt-gr)))*(yn=lr-(It=(pt=134217729*lr)-(pt-lr)))-((Dn=gr*lr)-Ie*It-Ut*It-Ie*yn))-(Mt=gn-(un=(Ut=ir-(Ie=(pt=134217729*ir)-(pt-ir)))*(yn=ii-(It=(pt=134217729*ii)-(pt-ii)))-((bn=ir*ii)-Ie*It-Ut*It-Ie*yn))),ft[0]=gn-(Mt+it)+(it-un),it=(Nn=Dn-(($n=Dn+Mt)-(it=$n-Dn))+(Mt-it))-(Mt=Nn-bn),ft[1]=Nn-(Mt+it)+(it-bn),it=(Ai=$n+Mt)-$n,ft[2]=$n-(Ai-it)+(Mt-it),ft[3]=Ai;let ye=function(We,Tt){let Ht=Tt[0];for(let Gt=1;Gt<4;Gt++)Ht+=Tt[Gt];return Ht}(0,ft),Z=22204460492503146e-32*Kt;if(ye>=Z||-ye>=Z||(At=Me-(gr+(it=Me-gr))+(it-Ke),at=rt-(ii+(it=rt-ii))+(it-Ke),we=ie-(ir+(it=ie-ir))+(it-Te),Ae=Ve-(lr+(it=Ve-lr))+(it-Te),0===At&&0===we&&0===at&&0===Ae)||(Z=11093356479670487e-47*Kt+33306690738754706e-32*Math.abs(ye),(ye+=gr*Ae+lr*At-(ir*at+ii*we))>=Z||-ye>=Z))return ye;it=(gn=(Ut=At-(Ie=(pt=134217729*At)-(pt-At)))*(yn=lr-(It=(pt=134217729*lr)-(pt-lr)))-((Dn=At*lr)-Ie*It-Ut*It-Ie*yn))-(Mt=gn-(un=(Ut=we-(Ie=(pt=134217729*we)-(pt-we)))*(yn=ii-(It=(pt=134217729*ii)-(pt-ii)))-((bn=we*ii)-Ie*It-Ut*It-Ie*yn))),mt[0]=gn-(Mt+it)+(it-un),it=(Nn=Dn-(($n=Dn+Mt)-(it=$n-Dn))+(Mt-it))-(Mt=Nn-bn),mt[1]=Nn-(Mt+it)+(it-bn),it=(Ai=$n+Mt)-$n,mt[2]=$n-(Ai-it)+(Mt-it),mt[3]=Ai;const Y=ht(4,ft,4,mt,Et);it=(gn=(Ut=gr-(Ie=(pt=134217729*gr)-(pt-gr)))*(yn=Ae-(It=(pt=134217729*Ae)-(pt-Ae)))-((Dn=gr*Ae)-Ie*It-Ut*It-Ie*yn))-(Mt=gn-(un=(Ut=ir-(Ie=(pt=134217729*ir)-(pt-ir)))*(yn=at-(It=(pt=134217729*at)-(pt-at)))-((bn=ir*at)-Ie*It-Ut*It-Ie*yn))),mt[0]=gn-(Mt+it)+(it-un),it=(Nn=Dn-(($n=Dn+Mt)-(it=$n-Dn))+(Mt-it))-(Mt=Nn-bn),mt[1]=Nn-(Mt+it)+(it-bn),it=(Ai=$n+Mt)-$n,mt[2]=$n-(Ai-it)+(Mt-it),mt[3]=Ai;const J=ht(Y,Et,4,mt,rn);it=(gn=(Ut=At-(Ie=(pt=134217729*At)-(pt-At)))*(yn=Ae-(It=(pt=134217729*Ae)-(pt-Ae)))-((Dn=At*Ae)-Ie*It-Ut*It-Ie*yn))-(Mt=gn-(un=(Ut=we-(Ie=(pt=134217729*we)-(pt-we)))*(yn=at-(It=(pt=134217729*at)-(pt-at)))-((bn=we*at)-Ie*It-Ut*It-Ie*yn))),mt[0]=gn-(Mt+it)+(it-un),it=(Nn=Dn-(($n=Dn+Mt)-(it=$n-Dn))+(Mt-it))-(Mt=Nn-bn),mt[1]=Nn-(Mt+it)+(it-bn),it=(Ai=$n+Mt)-$n,mt[2]=$n-(Ai-it)+(Mt-it),mt[3]=Ai;const xe=ht(J,rn,4,mt,Dt);return Dt[xe-1]}(Vt,hn,de,Ne,ue,fe,ne)},qe.orient2dfast=function(Vt,hn,de,Ne,ue,fe){return(hn-fe)*(de-ue)-(Vt-ue)*(Ne-fe)},Object.defineProperty(qe,"__esModule",{value:!0})}(vt)},9579:sn=>{"use strict";sn.exports={eudist:function(qe,Ee,ze){for(var ht=qe.length,p=0,be=0;be<ht;be++){var Xe=(qe[be]||0)-(Ee[be]||0);p+=Xe*Xe}return ze?Math.sqrt(p):p},mandist:function(qe,Ee,ze){for(var ht=qe.length,p=0,be=0;be<ht;be++)p+=Math.abs((qe[be]||0)-(Ee[be]||0));return ze?Math.sqrt(p):p},dist:function(qe,Ee,ze){var ht=Math.abs(qe-Ee);return ze?ht:ht*ht}}},7180:(sn,vt,qe)=>{"use strict";var Ee=qe(9579),ze=Ee.eudist,ht=Ee.dist;sn.exports={kmrand:function(be,Xe){for(var dt={},ft=[],Et=Xe<<2,rn=be.length,Dt=be[0].length>0;ft.length<Xe&&Et-- >0;){var mt=be[Math.floor(Math.random()*rn)],Vt=Dt?mt.join("_"):""+mt;dt[Vt]||(dt[Vt]=!0,ft.push(mt))}if(ft.length<Xe)throw new Error("Error initializating clusters");return ft},kmpp:function(be,Xe){var dt=be[0].length?ze:ht,ft=[],Et=be.length,rn=be[0].length>0,mt=be[Math.floor(Math.random()*Et)];for(rn&&mt.join("_"),ft.push(mt);ft.length<Xe;){for(var hn=[],de=ft.length,Ne=0,ue=[],fe=0;fe<Et;fe++){for(var he=1/0,Fe=0;Fe<de;Fe++){var ce=dt(be[fe],ft[Fe]);ce<=he&&(he=ce)}hn[fe]=he}for(var ne=0;ne<Et;ne++)Ne+=hn[ne];for(var Me=0;Me<Et;Me++)ue[Me]={i:Me,v:be[Me],pr:hn[Me]/Ne,cs:0};ue.sort(function(Ke,Te){return Ke.pr-Te.pr}),ue[0].cs=ue[0].pr;for(var ie=1;ie<Et;ie++)ue[ie].cs=ue[ie-1].cs+ue[ie].pr;for(var rt=Math.random(),Ve=0;Ve<Et-1&&ue[Ve++].cs<rt;);ft.push(ue[Ve-1].v)}return ft}}},3282:(sn,vt,qe)=>{"use strict";var Ee=qe(9579),ze=qe(7180),ht=Ee.eudist,Xe=ze.kmrand,dt=ze.kmpp;function Et(Dt,mt,Vt){Vt=Vt||[];for(var hn=0;hn<Dt;hn++)Vt[hn]=mt;return Vt}sn.exports=function rn(Dt,mt,Vt,hn){var de=[],Ne=[],ue=[],fe=[],he=!1,Fe=hn||1e4,ce=Dt.length,ne=Dt[0].length,Me=ne>0,ie=[];if(Vt)de="kmrand"==Vt?Xe(Dt,mt):"kmpp"==Vt?dt(Dt,mt):Vt;else for(var rt={};de.length<mt;){var Ve=Math.floor(Math.random()*ce);rt[Ve]||(rt[Ve]=!0,de.push(Dt[Ve]))}do{Et(mt,0,ie);for(var Ke=0;Ke<ce;Ke++){for(var Te=1/0,Kt=0,At=0;At<mt;At++)(fe=Me?ht(Dt[Ke],de[At]):Math.abs(Dt[Ke]-de[At]))<=Te&&(Te=fe,Kt=At);ue[Ke]=Kt,ie[Kt]++}for(var we=[],Ae=(Ne=[],0);Ae<mt;Ae++)we[Ae]=Me?Et(ne,0,we[Ae]):0,Ne[Ae]=de[Ae];if(Me){for(var it=0;it<mt;it++)de[it]=[];for(var pt=0;pt<ce;pt++)for(var Ut=we[ue[pt]],It=Dt[pt],yn=0;yn<ne;yn++)Ut[yn]+=It[yn];he=!0;for(var Mt=0;Mt<mt;Mt++){for(var $n=de[Mt],Nn=we[Mt],Dn=Ne[Mt],gn=ie[Mt],bn=0;bn<ne;bn++)$n[bn]=Nn[bn]/gn||0;if(he)for(var un=0;un<ne;un++)if(Dn[un]!=$n[un]){he=!1;break}}}else{for(var Ai=0;Ai<ce;Ai++)we[ue[Ai]]+=Dt[Ai];for(var ii=0;ii<mt;ii++)de[ii]=we[ii]/ie[ii]||0;he=!0;for(var ir=0;ir<mt;ir++)if(Ne[ir]!=de[ir]){he=!1;break}}he=he||--Fe<=0}while(!he);return{it:1e4-Fe,k:mt,idxs:ue,centroids:de}}},7935:(sn,vt,qe)=>{"use strict";qe.r(vt),qe.d(vt,{default:()=>Ee});class Ee{constructor(p=[],be=ze){if(this.data=p,this.length=this.data.length,this.compare=be,this.length>0)for(let Xe=(this.length>>1)-1;Xe>=0;Xe--)this._down(Xe)}push(p){this.data.push(p),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const p=this.data[0],be=this.data.pop();return this.length--,this.length>0&&(this.data[0]=be,this._down(0)),p}peek(){return this.data[0]}_up(p){const{data:be,compare:Xe}=this,dt=be[p];for(;p>0;){const ft=p-1>>1,Et=be[ft];if(Xe(dt,Et)>=0)break;be[p]=Et,p=ft}be[p]=dt}_down(p){const{data:be,compare:Xe}=this,dt=this.length>>1,ft=be[p];for(;p<dt;){let Et=1+(p<<1),rn=be[Et];const Dt=Et+1;if(Dt<this.length&&Xe(be[Dt],rn)<0&&(Et=Dt,rn=be[Dt]),Xe(rn,ft)>=0)break;be[p]=rn,p=Et}be[p]=ft}}function ze(ht,p){return ht<p?-1:ht>p?1:0}},4855:function(sn,vt){!function(qe){"use strict";function Ee(){}function ze(l){this.message=l||""}function ht(l){this.message=l||""}function p(l){this.message=l||""}function be(){}function Xe(l){return null===l?Nr:l.color}function dt(l){return null===l?null:l.parent}function ft(l,h){null!==l&&(l.color=h)}function Et(l){return null===l?null:l.left}function rn(l){return null===l?null:l.right}function Dt(){this.root_=null,this.size_=0}function mt(){}function Vt(){this.array_=[],arguments[0]instanceof ae&&this.addAll(arguments[0])}function hn(){}function de(l){this.message=l||""}function Ne(){this.array_=[]}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(l){if(null==this)throw new TypeError(this+" is not an object");var h=Object(this),y=Math.max(Math.min(h.length,9007199254740991),0)||0,b=1 in arguments&&parseInt(Number(arguments[1]),10)||0;b=b<0?Math.max(y+b,0):Math.min(b,y);var I=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:y;for(I=I<0?Math.max(y+arguments[2],0):Math.min(I,y);b<I;)h[b]=l,++b;return h},writable:!0}),Number.isFinite=Number.isFinite||function(l){return"number"==typeof l&&isFinite(l)},Number.isInteger=Number.isInteger||function(l){return"number"==typeof l&&isFinite(l)&&Math.floor(l)===l},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(l){return l!=l},Math.trunc=Math.trunc||function(l){return l<0?Math.ceil(l):Math.floor(l)};var ue=function(){};ue.prototype.interfaces_=function(){return[]},ue.prototype.getClass=function(){return ue},ue.prototype.equalsWithTolerance=function(l,h,y){return Math.abs(l-h)<=y};var fe=function(l){function h(y){l.call(this,y),this.name="IllegalArgumentException",this.message=y,this.stack=(new l).stack}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h}(Error),he=function(){},Fe={MAX_VALUE:{configurable:!0}};he.isNaN=function(l){return Number.isNaN(l)},he.doubleToLongBits=function(l){return l},he.longBitsToDouble=function(l){return l},he.isInfinite=function(l){return!Number.isFinite(l)},Fe.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(he,Fe);var ce=function(){},ne=function(){},Me=function(){},ie=function l(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=l.NULL_ORDINATE;else if(1===arguments.length){var h=arguments[0];this.x=h.x,this.y=h.y,this.z=h.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=l.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},rt={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};ie.prototype.setOrdinate=function(l,h){switch(l){case ie.X:this.x=h;break;case ie.Y:this.y=h;break;case ie.Z:this.z=h;break;default:throw new fe("Invalid ordinate index: "+l)}},ie.prototype.equals2D=function(){if(1===arguments.length){var l=arguments[0];return this.x===l.x&&this.y===l.y}if(2===arguments.length){var h=arguments[0],y=arguments[1];return!!ue.equalsWithTolerance(this.x,h.x,y)&&!!ue.equalsWithTolerance(this.y,h.y,y)}},ie.prototype.getOrdinate=function(l){switch(l){case ie.X:return this.x;case ie.Y:return this.y;case ie.Z:return this.z}throw new fe("Invalid ordinate index: "+l)},ie.prototype.equals3D=function(l){return this.x===l.x&&this.y===l.y&&(this.z===l.z||he.isNaN(this.z))&&he.isNaN(l.z)},ie.prototype.equals=function(l){return l instanceof ie&&this.equals2D(l)},ie.prototype.equalInZ=function(l,h){return ue.equalsWithTolerance(this.z,l.z,h)},ie.prototype.compareTo=function(l){return this.x<l.x?-1:this.x>l.x?1:this.y<l.y?-1:this.y>l.y?1:0},ie.prototype.clone=function(){},ie.prototype.copy=function(){return new ie(this)},ie.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},ie.prototype.distance3D=function(l){var h=this.x-l.x,y=this.y-l.y,b=this.z-l.z;return Math.sqrt(h*h+y*y+b*b)},ie.prototype.distance=function(l){var h=this.x-l.x,y=this.y-l.y;return Math.sqrt(h*h+y*y)},ie.prototype.hashCode=function(){var l=17;return 37*(l=37*l+ie.hashCode(this.x))+ie.hashCode(this.y)},ie.prototype.setCoordinate=function(l){this.x=l.x,this.y=l.y,this.z=l.z},ie.prototype.interfaces_=function(){return[ce,ne,Ee]},ie.prototype.getClass=function(){return ie},ie.hashCode=function(){if(1===arguments.length){var h=he.doubleToLongBits(arguments[0]);return Math.trunc((h^h)>>>32)}},rt.DimensionalComparator.get=function(){return Ve},rt.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},rt.NULL_ORDINATE.get=function(){return he.NaN},rt.X.get=function(){return 0},rt.Y.get=function(){return 1},rt.Z.get=function(){return 2},Object.defineProperties(ie,rt);var Ve=function(l){if(this._dimensionsToTest=2,0!==arguments.length&&1===arguments.length){var h=arguments[0];if(2!==h&&3!==h)throw new fe("only 2 or 3 dimensions may be specified");this._dimensionsToTest=h}};Ve.prototype.compare=function(l,h){var y=l,b=h,I=Ve.compare(y.x,b.x);if(0!==I)return I;var B=Ve.compare(y.y,b.y);return 0!==B?B:this._dimensionsToTest<=2?0:Ve.compare(y.z,b.z)},Ve.prototype.interfaces_=function(){return[Me]},Ve.prototype.getClass=function(){return Ve},Ve.compare=function(l,h){return l<h?-1:l>h?1:he.isNaN(l)?he.isNaN(h)?0:-1:he.isNaN(h)?1:0};var Ke=function(){};Ke.prototype.create=function(){},Ke.prototype.interfaces_=function(){return[]},Ke.prototype.getClass=function(){return Ke};var Te=function(){},Kt={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Te.prototype.interfaces_=function(){return[]},Te.prototype.getClass=function(){return Te},Te.toLocationSymbol=function(l){switch(l){case Te.EXTERIOR:return"e";case Te.BOUNDARY:return"b";case Te.INTERIOR:return"i";case Te.NONE:return"-"}throw new fe("Unknown location value: "+l)},Kt.INTERIOR.get=function(){return 0},Kt.BOUNDARY.get=function(){return 1},Kt.EXTERIOR.get=function(){return 2},Kt.NONE.get=function(){return-1},Object.defineProperties(Te,Kt);var At=function(l,h){return l.interfaces_&&l.interfaces_().indexOf(h)>-1},we=function(){},at={LOG_10:{configurable:!0}};we.prototype.interfaces_=function(){return[]},we.prototype.getClass=function(){return we},we.log10=function(l){var h=Math.log(l);return he.isInfinite(h)||he.isNaN(h)?h:h/we.LOG_10},we.min=function(l,h,y,b){var I=l;return h<I&&(I=h),y<I&&(I=y),b<I&&(I=b),I},we.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var l=arguments[0],h=arguments[1],y=arguments[2];return l<h?h:l>y?y:l}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var b=arguments[0],I=arguments[1],B=arguments[2];return b<I?I:b>B?B:b}},we.wrap=function(l,h){return l<0?h- -l%h:l%h},we.max=function(){if(3===arguments.length){var h=arguments[1],y=arguments[2],b=arguments[0];return h>b&&(b=h),y>b&&(b=y),b}if(4===arguments.length){var B=arguments[1],j=arguments[2],oe=arguments[3],Pe=arguments[0];return B>Pe&&(Pe=B),j>Pe&&(Pe=j),oe>Pe&&(Pe=oe),Pe}},we.average=function(l,h){return(l+h)/2},at.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(we,at);var Ae=function(l){this.str=l};Ae.prototype.append=function(l){this.str+=l},Ae.prototype.setCharAt=function(l,h){this.str=this.str.substr(0,l)+h+this.str.substr(l+1)},Ae.prototype.toString=function(l){return this.str};var it=function(l){this.value=l};it.prototype.intValue=function(){return this.value},it.prototype.compareTo=function(l){return this.value<l?-1:this.value>l?1:0},it.isNaN=function(l){return Number.isNaN(l)};var pt=function(){};pt.isWhitespace=function(l){return l<=32&&l>=0||127===l},pt.toUpperCase=function(l){return l.toUpperCase()};var Ie=function l(){this._hi=0,this._lo=0,0===arguments.length?this.init(0):1===arguments.length?"number"==typeof arguments[0]||arguments[0]instanceof l?this.init(arguments[0]):"string"==typeof arguments[0]&&l.call(this,l.parse(arguments[0])):2===arguments.length&&this.init(arguments[0],arguments[1])},Ut={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Ie.prototype.le=function(l){return(this._hi<l._hi||this._hi===l._hi)&&this._lo<=l._lo},Ie.prototype.extractSignificantDigits=function(l,h){var y=this.abs(),b=Ie.magnitude(y._hi),I=Ie.TEN.pow(b);(y=y.divide(I)).gt(Ie.TEN)?(y=y.divide(Ie.TEN),b+=1):y.lt(Ie.ONE)&&(y=y.multiply(Ie.TEN),b-=1);for(var B=b+1,j=new Ae,oe=Ie.MAX_PRINT_DIGITS-1,Pe=0;Pe<=oe;Pe++){l&&Pe===B&&j.append(".");var st=Math.trunc(y._hi);if(st<0)break;var kt=!1,qt=0;st>9?(kt=!0,qt="9"):qt="0"+st,j.append(qt),y=y.subtract(Ie.valueOf(st)).multiply(Ie.TEN),kt&&y.selfAdd(Ie.TEN);var Pn=!0,In=Ie.magnitude(y._hi);if(In<0&&Math.abs(In)>=oe-Pe&&(Pn=!1),!Pn)break}return h[0]=b,j.toString()},Ie.prototype.sqr=function(){return this.multiply(this)},Ie.prototype.doubleValue=function(){return this._hi+this._lo},Ie.prototype.subtract=function(){return arguments[0]instanceof Ie?this.add(arguments[0].negate()):"number"==typeof arguments[0]?this.add(-arguments[0]):void 0},Ie.prototype.equals=function(){if(1===arguments.length){var l=arguments[0];return this._hi===l._hi&&this._lo===l._lo}},Ie.prototype.isZero=function(){return 0===this._hi&&0===this._lo},Ie.prototype.selfSubtract=function(){if(arguments[0]instanceof Ie){var l=arguments[0];return this.isNaN()?this:this.selfAdd(-l._hi,-l._lo)}if("number"==typeof arguments[0]){var h=arguments[0];return this.isNaN()?this:this.selfAdd(-h,0)}},Ie.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},Ie.prototype.min=function(l){return this.le(l)?this:l},Ie.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof Ie){var l=arguments[0];return this.selfDivide(l._hi,l._lo)}if("number"==typeof arguments[0])return this.selfDivide(arguments[0],0)}else if(2===arguments.length){var B,oe,Pe,kt,y=arguments[0],I=null,j=null,st=null,qt=null;return this._hi=qt=(Pe=this._hi/y)+(st=(this._hi-(kt=Pe*y)-(qt=(I=(st=Ie.SPLIT*Pe)-(I=st-Pe))*(j=(qt=Ie.SPLIT*y)-(j=qt-y))-kt+I*(oe=y-j)+(B=Pe-I)*j+B*oe)+this._lo-Pe*arguments[1])/y),this._lo=Pe-qt+st,this}},Ie.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},Ie.prototype.divide=function(){if(arguments[0]instanceof Ie){var y,I,B,oe,l=arguments[0],h=null,b=null,j=null,Pe=null;return y=(B=this._hi/l._hi)-(h=(j=Ie.SPLIT*B)-(h=j-B)),Pe=h*(b=(Pe=Ie.SPLIT*l._hi)-(b=Pe-l._hi))-(oe=B*l._hi)+h*(I=l._hi-b)+y*b+y*I,new Ie(Pe=B+(j=(this._hi-oe-Pe+this._lo-B*l._lo)/l._hi),B-Pe+j)}if("number"==typeof arguments[0]){var st=arguments[0];return he.isNaN(st)?Ie.createNaN():Ie.copy(this).selfDivide(st,0)}},Ie.prototype.ge=function(l){return(this._hi>l._hi||this._hi===l._hi)&&this._lo>=l._lo},Ie.prototype.pow=function(l){if(0===l)return Ie.valueOf(1);var h=new Ie(this),y=Ie.valueOf(1),b=Math.abs(l);if(b>1)for(;b>0;)b%2==1&&y.selfMultiply(h),(b/=2)>0&&(h=h.sqr());else y=h;return l<0?y.reciprocal():y},Ie.prototype.ceil=function(){if(this.isNaN())return Ie.NaN;var l=Math.ceil(this._hi),h=0;return l===this._hi&&(h=Math.ceil(this._lo)),new Ie(l,h)},Ie.prototype.compareTo=function(l){return this._hi<l._hi?-1:this._hi>l._hi?1:this._lo<l._lo?-1:this._lo>l._lo?1:0},Ie.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},Ie.prototype.setValue=function(){return arguments[0]instanceof Ie||"number"==typeof arguments[0]?(this.init(arguments[0]),this):void 0},Ie.prototype.max=function(l){return this.ge(l)?this:l},Ie.prototype.sqrt=function(){if(this.isZero())return Ie.valueOf(0);if(this.isNegative())return Ie.NaN;var l=1/Math.sqrt(this._hi),y=Ie.valueOf(this._hi*l),b=this.subtract(y.sqr())._hi*(.5*l);return y.add(b)},Ie.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof Ie){var l=arguments[0];return this.selfAdd(l._hi,l._lo)}if("number"==typeof arguments[0]){var y,b,I,j,oe,h=arguments[0];return this._hi=(y=(I=this._hi+h)+(oe=h-(j=I-this._hi)+(this._hi-(I-j))+this._lo))+(b=oe+(I-y)),this._lo=b+(y-this._hi),this}}else if(2===arguments.length){var kt,qt,In,Mi,Pe=arguments[0],st=arguments[1],Pn=null,zn=null,tr=null;zn=(In=this._hi+Pe)-(tr=In-this._hi),Pn=(qt=this._lo+st)-(Mi=qt-this._lo);var Tn=(kt=In+(tr=(zn=Pe-tr+(this._hi-zn))+qt))+(tr=(Pn=st-Mi+(this._lo-Pn))+(tr+(In-kt))),wa=tr+(kt-Tn);return this._hi=Tn,this._lo=wa,this}},Ie.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof Ie){var l=arguments[0];return this.selfMultiply(l._hi,l._lo)}if("number"==typeof arguments[0])return this.selfMultiply(arguments[0],0)}else if(2===arguments.length){var B,oe,y=arguments[0],I=null,j=null,Pe=null,st=null;I=(Pe=Ie.SPLIT*this._hi)-this._hi,I=Pe-I;var kt=(Pe=this._hi*y)+(st=I*(j=(st=Ie.SPLIT*y)-(j=st-y))-Pe+I*(oe=y-j)+(B=this._hi-I)*j+B*oe+(this._hi*arguments[1]+this._lo*y)),qt=st+(I=Pe-kt);return this._hi=kt,this._lo=qt,this}},Ie.prototype.selfSqr=function(){return this.selfMultiply(this)},Ie.prototype.floor=function(){if(this.isNaN())return Ie.NaN;var l=Math.floor(this._hi),h=0;return l===this._hi&&(h=Math.floor(this._lo)),new Ie(l,h)},Ie.prototype.negate=function(){return this.isNaN()?this:new Ie(-this._hi,-this._lo)},Ie.prototype.clone=function(){},Ie.prototype.multiply=function(){if(arguments[0]instanceof Ie){var l=arguments[0];return l.isNaN()?Ie.createNaN():Ie.copy(this).selfMultiply(l)}if("number"==typeof arguments[0]){var h=arguments[0];return he.isNaN(h)?Ie.createNaN():Ie.copy(this).selfMultiply(h,0)}},Ie.prototype.isNaN=function(){return he.isNaN(this._hi)},Ie.prototype.intValue=function(){return Math.trunc(this._hi)},Ie.prototype.toString=function(){var l=Ie.magnitude(this._hi);return l>=-3&&l<=20?this.toStandardNotation():this.toSciNotation()},Ie.prototype.toStandardNotation=function(){var l=this.getSpecialNumberString();if(null!==l)return l;var h=new Array(1).fill(null),y=this.extractSignificantDigits(!0,h),b=h[0]+1,I=y;return"."===y.charAt(0)?I="0"+y:b<0?I="0."+Ie.stringOfChar("0",-b)+y:-1===y.indexOf(".")&&(I=y+Ie.stringOfChar("0",b-y.length)+".0"),this.isNegative()?"-"+I:I},Ie.prototype.reciprocal=function(){var h,b,I,j,l=null,y=null,B=null,oe=null;h=(I=1/this._hi)-(l=(B=Ie.SPLIT*I)-(l=B-I)),y=(oe=Ie.SPLIT*this._hi)-this._hi;var Pe=I+(B=(1-(j=I*this._hi)-(oe=l*(y=oe-y)-j+l*(b=this._hi-y)+h*y+h*b)-I*this._lo)/this._hi);return new Ie(Pe,I-Pe+B)},Ie.prototype.toSciNotation=function(){if(this.isZero())return Ie.SCI_NOT_ZERO;var l=this.getSpecialNumberString();if(null!==l)return l;var h=new Array(1).fill(null),y=this.extractSignificantDigits(!1,h),b=Ie.SCI_NOT_EXPONENT_CHAR+h[0];if("0"===y.charAt(0))throw new Error("Found leading zero: "+y);var I="";y.length>1&&(I=y.substring(1));var B=y.charAt(0)+"."+I;return this.isNegative()?"-"+B+b:B+b},Ie.prototype.abs=function(){return this.isNaN()?Ie.NaN:this.isNegative()?this.negate():new Ie(this)},Ie.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},Ie.prototype.lt=function(l){return(this._hi<l._hi||this._hi===l._hi)&&this._lo<l._lo},Ie.prototype.add=function(){if(arguments[0]instanceof Ie){var l=arguments[0];return Ie.copy(this).selfAdd(l)}if("number"==typeof arguments[0]){var h=arguments[0];return Ie.copy(this).selfAdd(h)}},Ie.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0])this._hi=arguments[0],this._lo=0;else if(arguments[0]instanceof Ie){var h=arguments[0];this._hi=h._hi,this._lo=h._lo}}else if(2===arguments.length){var b=arguments[1];this._hi=arguments[0],this._lo=b}},Ie.prototype.gt=function(l){return(this._hi>l._hi||this._hi===l._hi)&&this._lo>l._lo},Ie.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},Ie.prototype.trunc=function(){return this.isNaN()?Ie.NaN:this.isPositive()?this.floor():this.ceil()},Ie.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},Ie.prototype.interfaces_=function(){return[Ee,ce,ne]},Ie.prototype.getClass=function(){return Ie},Ie.sqr=function(l){return Ie.valueOf(l).selfMultiply(l)},Ie.valueOf=function(){return"string"==typeof arguments[0]?Ie.parse(arguments[0]):"number"==typeof arguments[0]?new Ie(arguments[0]):void 0},Ie.sqrt=function(l){return Ie.valueOf(l).sqrt()},Ie.parse=function(l){for(var h=0,y=l.length;pt.isWhitespace(l.charAt(h));)h++;var b=!1;if(h<y){var I=l.charAt(h);"-"!==I&&"+"!==I||(h++,"-"===I&&(b=!0))}for(var B=new Ie,j=0,oe=0,Pe=0;!(h>=y);){var st=l.charAt(h);if(h++,pt.isDigit(st)){var kt=st-"0";B.selfMultiply(Ie.TEN),B.selfAdd(kt),j++}else{if("."!==st){if("e"===st||"E"===st){var qt=l.substring(h);try{Pe=it.parseInt(qt)}catch(Mi){throw Mi instanceof Error?new Error("Invalid exponent "+qt+" in string "+l):Mi}break}throw new Error("Unexpected character '"+st+"' at position "+h+" in string "+l)}oe=j}}var Pn=B,In=j-oe-Pe;if(0===In)Pn=B;else if(In>0){var zn=Ie.TEN.pow(In);Pn=B.divide(zn)}else if(In<0){var tr=Ie.TEN.pow(-In);Pn=B.multiply(tr)}return b?Pn.negate():Pn},Ie.createNaN=function(){return new Ie(he.NaN,he.NaN)},Ie.copy=function(l){return new Ie(l)},Ie.magnitude=function(l){var h=Math.abs(l),y=Math.log(h)/Math.log(10),b=Math.trunc(Math.floor(y));return 10*Math.pow(10,b)<=h&&(b+=1),b},Ie.stringOfChar=function(l,h){for(var y=new Ae,b=0;b<h;b++)y.append(l);return y.toString()},Ut.PI.get=function(){return new Ie(3.141592653589793,12246467991473532e-32)},Ut.TWO_PI.get=function(){return new Ie(6.283185307179586,24492935982947064e-32)},Ut.PI_2.get=function(){return new Ie(1.5707963267948966,6123233995736766e-32)},Ut.E.get=function(){return new Ie(2.718281828459045,14456468917292502e-32)},Ut.NaN.get=function(){return new Ie(he.NaN,he.NaN)},Ut.EPS.get=function(){return 123259516440783e-46},Ut.SPLIT.get=function(){return 134217729},Ut.MAX_PRINT_DIGITS.get=function(){return 32},Ut.TEN.get=function(){return Ie.valueOf(10)},Ut.ONE.get=function(){return Ie.valueOf(1)},Ut.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},Ut.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(Ie,Ut);var It=function(){},yn={DP_SAFE_EPSILON:{configurable:!0}};It.prototype.interfaces_=function(){return[]},It.prototype.getClass=function(){return It},It.orientationIndex=function(l,h,y){var b=It.orientationIndexFilter(l,h,y);if(b<=1)return b;var I=Ie.valueOf(h.x).selfAdd(-l.x),B=Ie.valueOf(h.y).selfAdd(-l.y),j=Ie.valueOf(y.x).selfAdd(-h.x),oe=Ie.valueOf(y.y).selfAdd(-h.y);return I.selfMultiply(oe).selfSubtract(B.selfMultiply(j)).signum()},It.signOfDet2x2=function(l,h,y,b){return l.multiply(b).selfSubtract(h.multiply(y)).signum()},It.intersection=function(l,h,y,b){var I=Ie.valueOf(b.y).selfSubtract(y.y).selfMultiply(Ie.valueOf(h.x).selfSubtract(l.x)),B=Ie.valueOf(b.x).selfSubtract(y.x).selfMultiply(Ie.valueOf(h.y).selfSubtract(l.y)),j=I.subtract(B),oe=Ie.valueOf(b.x).selfSubtract(y.x).selfMultiply(Ie.valueOf(l.y).selfSubtract(y.y)),Pe=Ie.valueOf(b.y).selfSubtract(y.y).selfMultiply(Ie.valueOf(l.x).selfSubtract(y.x)),st=oe.subtract(Pe).selfDivide(j).doubleValue(),kt=Ie.valueOf(l.x).selfAdd(Ie.valueOf(h.x).selfSubtract(l.x).selfMultiply(st)).doubleValue(),qt=Ie.valueOf(h.x).selfSubtract(l.x).selfMultiply(Ie.valueOf(l.y).selfSubtract(y.y)),Pn=Ie.valueOf(h.y).selfSubtract(l.y).selfMultiply(Ie.valueOf(l.x).selfSubtract(y.x)),In=qt.subtract(Pn).selfDivide(j).doubleValue(),zn=Ie.valueOf(y.y).selfAdd(Ie.valueOf(b.y).selfSubtract(y.y).selfMultiply(In)).doubleValue();return new ie(kt,zn)},It.orientationIndexFilter=function(l,h,y){var b=null,I=(l.x-y.x)*(h.y-y.y),B=(l.y-y.y)*(h.x-y.x),j=I-B;if(I>0){if(B<=0)return It.signum(j);b=I+B}else{if(!(I<0)||B>=0)return It.signum(j);b=-I-B}var oe=It.DP_SAFE_EPSILON*b;return j>=oe||-j>=oe?It.signum(j):2},It.signum=function(l){return l>0?1:l<0?-1:0},yn.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(It,yn);var Mt=function(){},$n={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};$n.X.get=function(){return 0},$n.Y.get=function(){return 1},$n.Z.get=function(){return 2},$n.M.get=function(){return 3},Mt.prototype.setOrdinate=function(l,h,y){},Mt.prototype.size=function(){},Mt.prototype.getOrdinate=function(l,h){},Mt.prototype.getCoordinate=function(){},Mt.prototype.getCoordinateCopy=function(l){},Mt.prototype.getDimension=function(){},Mt.prototype.getX=function(l){},Mt.prototype.clone=function(){},Mt.prototype.expandEnvelope=function(l){},Mt.prototype.copy=function(){},Mt.prototype.getY=function(l){},Mt.prototype.toCoordinateArray=function(){},Mt.prototype.interfaces_=function(){return[ne]},Mt.prototype.getClass=function(){return Mt},Object.defineProperties(Mt,$n);var Nn=function(){},Dn=function(l){function h(){l.call(this,"Projective point not representable on the Cartesian plane.")}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Nn),gn=function(){};gn.arraycopy=function(l,h,y,b,I){for(var B=0,j=h;j<h+I;j++)y[b+B]=l[j],B++},gn.getProperty=function(l){return{"line.separator":"\n"}[l]};var bn=function l(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var h=arguments[0];this.x=h.x,this.y=h.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var b=arguments[1];this.x=arguments[0],this.y=b,this.w=1}else if(arguments[0]instanceof l&&arguments[1]instanceof l){var I=arguments[0],B=arguments[1];this.x=I.y*B.w-B.y*I.w,this.y=B.x*I.w-I.x*B.w,this.w=I.x*B.y-B.x*I.y}else if(arguments[0]instanceof ie&&arguments[1]instanceof ie){var j=arguments[0],oe=arguments[1];this.x=j.y-oe.y,this.y=oe.x-j.x,this.w=j.x*oe.y-oe.x*j.y}}else if(3===arguments.length){var st=arguments[1],kt=arguments[2];this.x=arguments[0],this.y=st,this.w=kt}else if(4===arguments.length){var qt=arguments[0],Pn=arguments[1],In=arguments[2],zn=arguments[3],tr=qt.y-Pn.y,Mi=Pn.x-qt.x,Tn=qt.x*Pn.y-Pn.x*qt.y,wa=In.y-zn.y,Ea=zn.x-In.x,ml=In.x*zn.y-zn.x*In.y;this.x=Mi*ml-Ea*Tn,this.y=wa*Tn-tr*ml,this.w=tr*Ea-wa*Mi}};bn.prototype.getY=function(){var l=this.y/this.w;if(he.isNaN(l)||he.isInfinite(l))throw new Dn;return l},bn.prototype.getX=function(){var l=this.x/this.w;if(he.isNaN(l)||he.isInfinite(l))throw new Dn;return l},bn.prototype.getCoordinate=function(){var l=new ie;return l.x=this.getX(),l.y=this.getY(),l},bn.prototype.interfaces_=function(){return[]},bn.prototype.getClass=function(){return bn},bn.intersection=function(l,h,y,b){var I=l.y-h.y,B=h.x-l.x,j=l.x*h.y-h.x*l.y,oe=y.y-b.y,Pe=b.x-y.x,st=y.x*b.y-b.x*y.y,kt=I*Pe-oe*B,qt=(B*st-Pe*j)/kt,Pn=(oe*j-I*st)/kt;if(he.isNaN(qt)||he.isInfinite(qt)||he.isNaN(Pn)||he.isInfinite(Pn))throw new Dn;return new ie(qt,Pn)};var un=function l(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length)if(arguments[0]instanceof ie){var h=arguments[0];this.init(h.x,h.x,h.y,h.y)}else arguments[0]instanceof l&&this.init(arguments[0]);else if(2===arguments.length){var b=arguments[0],I=arguments[1];this.init(b.x,I.x,b.y,I.y)}else 4===arguments.length&&this.init(arguments[0],arguments[1],arguments[2],arguments[3])},Ai={serialVersionUID:{configurable:!0}};un.prototype.getArea=function(){return this.getWidth()*this.getHeight()},un.prototype.equals=function(l){if(!(l instanceof un))return!1;var h=l;return this.isNull()?h.isNull():this._maxx===h.getMaxX()&&this._maxy===h.getMaxY()&&this._minx===h.getMinX()&&this._miny===h.getMinY()},un.prototype.intersection=function(l){return this.isNull()||l.isNull()||!this.intersects(l)?new un:new un(this._minx>l._minx?this._minx:l._minx,this._maxx<l._maxx?this._maxx:l._maxx,this._miny>l._miny?this._miny:l._miny,this._maxy<l._maxy?this._maxy:l._maxy)},un.prototype.isNull=function(){return this._maxx<this._minx},un.prototype.getMaxX=function(){return this._maxx},un.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof ie){var l=arguments[0];return this.covers(l.x,l.y)}if(arguments[0]instanceof un){var h=arguments[0];return!this.isNull()&&!h.isNull()&&h.getMinX()>=this._minx&&h.getMaxX()<=this._maxx&&h.getMinY()>=this._miny&&h.getMaxY()<=this._maxy}}else if(2===arguments.length){var y=arguments[0],b=arguments[1];return!this.isNull()&&y>=this._minx&&y<=this._maxx&&b>=this._miny&&b<=this._maxy}},un.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof un){var l=arguments[0];return!this.isNull()&&!l.isNull()&&!(l._minx>this._maxx||l._maxx<this._minx||l._miny>this._maxy||l._maxy<this._miny)}if(arguments[0]instanceof ie){var h=arguments[0];return this.intersects(h.x,h.y)}}else if(2===arguments.length){var y=arguments[0],b=arguments[1];return!this.isNull()&&!(y>this._maxx||y<this._minx||b>this._maxy||b<this._miny)}},un.prototype.getMinY=function(){return this._miny},un.prototype.getMinX=function(){return this._minx},un.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof ie){var l=arguments[0];this.expandToInclude(l.x,l.y)}else if(arguments[0]instanceof un){var h=arguments[0];if(h.isNull())return null;this.isNull()?(this._minx=h.getMinX(),this._maxx=h.getMaxX(),this._miny=h.getMinY(),this._maxy=h.getMaxY()):(h._minx<this._minx&&(this._minx=h._minx),h._maxx>this._maxx&&(this._maxx=h._maxx),h._miny<this._miny&&(this._miny=h._miny),h._maxy>this._maxy&&(this._maxy=h._maxy))}}else if(2===arguments.length){var y=arguments[0],b=arguments[1];this.isNull()?(this._minx=y,this._maxx=y,this._miny=b,this._maxy=b):(y<this._minx&&(this._minx=y),y>this._maxx&&(this._maxx=y),b<this._miny&&(this._miny=b),b>this._maxy&&(this._maxy=b))}},un.prototype.minExtent=function(){if(this.isNull())return 0;var l=this.getWidth(),h=this.getHeight();return l<h?l:h},un.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},un.prototype.compareTo=function(l){var h=l;return this.isNull()?h.isNull()?0:-1:h.isNull()?1:this._minx<h._minx?-1:this._minx>h._minx?1:this._miny<h._miny?-1:this._miny>h._miny?1:this._maxx<h._maxx?-1:this._maxx>h._maxx?1:this._maxy<h._maxy?-1:this._maxy>h._maxy?1:0},un.prototype.translate=function(l,h){if(this.isNull())return null;this.init(this.getMinX()+l,this.getMaxX()+l,this.getMinY()+h,this.getMaxY()+h)},un.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},un.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},un.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},un.prototype.maxExtent=function(){if(this.isNull())return 0;var l=this.getWidth(),h=this.getHeight();return l>h?l:h},un.prototype.expandBy=function(){if(1===arguments.length){var l=arguments[0];this.expandBy(l,l)}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this.isNull())return null;this._minx-=h,this._maxx+=h,this._miny-=y,this._maxy+=y,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},un.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof un)return this.covers(arguments[0]);if(arguments[0]instanceof ie)return this.covers(arguments[0])}else if(2===arguments.length)return this.covers(arguments[0],arguments[1])},un.prototype.centre=function(){return this.isNull()?null:new ie((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},un.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof ie){var l=arguments[0];this.init(l.x,l.x,l.y,l.y)}else if(arguments[0]instanceof un){var h=arguments[0];this._minx=h._minx,this._maxx=h._maxx,this._miny=h._miny,this._maxy=h._maxy}}else if(2===arguments.length){var y=arguments[0],b=arguments[1];this.init(y.x,b.x,y.y,b.y)}else if(4===arguments.length){var I=arguments[0],B=arguments[1],j=arguments[2],oe=arguments[3];I<B?(this._minx=I,this._maxx=B):(this._minx=B,this._maxx=I),j<oe?(this._miny=j,this._maxy=oe):(this._miny=oe,this._maxy=j)}},un.prototype.getMaxY=function(){return this._maxy},un.prototype.distance=function(l){if(this.intersects(l))return 0;var h=0;this._maxx<l._minx?h=l._minx-this._maxx:this._minx>l._maxx&&(h=this._minx-l._maxx);var y=0;return this._maxy<l._miny?y=l._miny-this._maxy:this._miny>l._maxy&&(y=this._miny-l._maxy),0===h?y:0===y?h:Math.sqrt(h*h+y*y)},un.prototype.hashCode=function(){var l=17;return 37*(l=37*(l=37*(l=37*l+ie.hashCode(this._minx))+ie.hashCode(this._maxx))+ie.hashCode(this._miny))+ie.hashCode(this._maxy)},un.prototype.interfaces_=function(){return[ce,Ee]},un.prototype.getClass=function(){return un},un.intersects=function(){if(3===arguments.length){var l=arguments[0],h=arguments[1],y=arguments[2];return y.x>=(l.x<h.x?l.x:h.x)&&y.x<=(l.x>h.x?l.x:h.x)&&y.y>=(l.y<h.y?l.y:h.y)&&y.y<=(l.y>h.y?l.y:h.y)}if(4===arguments.length){var b=arguments[0],I=arguments[1],B=arguments[2],j=arguments[3],oe=Math.min(B.x,j.x),Pe=Math.max(B.x,j.x),st=Math.min(b.x,I.x),kt=Math.max(b.x,I.x);return!(st>Pe||kt<oe||(oe=Math.min(B.y,j.y),Pe=Math.max(B.y,j.y),st=Math.min(b.y,I.y),kt=Math.max(b.y,I.y),st>Pe||kt<oe))}},Ai.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(un,Ai);var gr={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},ii=function(l){this.geometryFactory=l||new ur};ii.prototype.read=function(l){var h,y;l=l.replace(/[\n\r]/g," ");var I=gr.typeStr.exec(l);if(-1!==l.search("EMPTY")&&((I=gr.emptyTypeStr.exec(l))[2]=void 0),I&&(y=I[1].toLowerCase(),lr[y]&&(h=lr[y].apply(this,[I[2]]))),void 0===h)throw new Error("Could not parse WKT "+l);return h},ii.prototype.write=function(l){return this.extractGeometry(l)},ii.prototype.extractGeometry=function(l){var h=l.getGeometryType().toLowerCase();if(!ir[h])return null;var y=h.toUpperCase();return l.isEmpty()?y+" EMPTY":y+"("+ir[h].apply(this,[l])+")"};var ir={coordinate:function(l){return l.x+" "+l.y},point:function(l){return ir.coordinate.call(this,l._coordinates._coordinates[0])},multipoint:function(l){for(var h=[],y=0,b=l._geometries.length;y<b;++y)h.push("("+ir.point.apply(this,[l._geometries[y]])+")");return h.join(",")},linestring:function(l){for(var h=[],y=0,b=l._points._coordinates.length;y<b;++y)h.push(ir.coordinate.apply(this,[l._points._coordinates[y]]));return h.join(",")},linearring:function(l){for(var h=[],y=0,b=l._points._coordinates.length;y<b;++y)h.push(ir.coordinate.apply(this,[l._points._coordinates[y]]));return h.join(",")},multilinestring:function(l){for(var h=[],y=0,b=l._geometries.length;y<b;++y)h.push("("+ir.linestring.apply(this,[l._geometries[y]])+")");return h.join(",")},polygon:function(l){var h=[];h.push("("+ir.linestring.apply(this,[l._shell])+")");for(var y=0,b=l._holes.length;y<b;++y)h.push("("+ir.linestring.apply(this,[l._holes[y]])+")");return h.join(",")},multipolygon:function(l){for(var h=[],y=0,b=l._geometries.length;y<b;++y)h.push("("+ir.polygon.apply(this,[l._geometries[y]])+")");return h.join(",")},geometrycollection:function(l){for(var h=[],y=0,b=l._geometries.length;y<b;++y)h.push(this.extractGeometry(l._geometries[y]));return h.join(",")}},lr={point:function(l){if(void 0===l)return this.geometryFactory.createPoint();var h=l.trim().split(gr.spaces);return this.geometryFactory.createPoint(new ie(Number.parseFloat(h[0]),Number.parseFloat(h[1])))},multipoint:function(l){if(void 0===l)return this.geometryFactory.createMultiPoint();for(var h,y=l.trim().split(","),b=[],I=0,B=y.length;I<B;++I)h=y[I].replace(gr.trimParens,"$1"),b.push(lr.point.apply(this,[h]));return this.geometryFactory.createMultiPoint(b)},linestring:function(l){if(void 0===l)return this.geometryFactory.createLineString();for(var h,y=l.trim().split(","),b=[],I=0,B=y.length;I<B;++I)h=y[I].trim().split(gr.spaces),b.push(new ie(Number.parseFloat(h[0]),Number.parseFloat(h[1])));return this.geometryFactory.createLineString(b)},linearring:function(l){if(void 0===l)return this.geometryFactory.createLinearRing();for(var h,y=l.trim().split(","),b=[],I=0,B=y.length;I<B;++I)h=y[I].trim().split(gr.spaces),b.push(new ie(Number.parseFloat(h[0]),Number.parseFloat(h[1])));return this.geometryFactory.createLinearRing(b)},multilinestring:function(l){if(void 0===l)return this.geometryFactory.createMultiLineString();for(var h,y=l.trim().split(gr.parenComma),b=[],I=0,B=y.length;I<B;++I)h=y[I].replace(gr.trimParens,"$1"),b.push(lr.linestring.apply(this,[h]));return this.geometryFactory.createMultiLineString(b)},polygon:function(l){if(void 0===l)return this.geometryFactory.createPolygon();for(var h,y,b,I,B=l.trim().split(gr.parenComma),j=[],oe=0,Pe=B.length;oe<Pe;++oe)h=B[oe].replace(gr.trimParens,"$1"),y=lr.linestring.apply(this,[h]),b=this.geometryFactory.createLinearRing(y._points),0===oe?I=b:j.push(b);return this.geometryFactory.createPolygon(I,j)},multipolygon:function(l){if(void 0===l)return this.geometryFactory.createMultiPolygon();for(var h,y=l.trim().split(gr.doubleParenComma),b=[],I=0,B=y.length;I<B;++I)h=y[I].replace(gr.trimParens,"$1"),b.push(lr.polygon.apply(this,[h]));return this.geometryFactory.createMultiPolygon(b)},geometrycollection:function(l){if(void 0===l)return this.geometryFactory.createGeometryCollection();for(var h=(l=l.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),y=[],b=0,I=h.length;b<I;++b)y.push(this.read(h[b]));return this.geometryFactory.createGeometryCollection(y)}},ye=function(l){this.parser=new ii(l)};ye.prototype.write=function(l){return this.parser.write(l)},ye.toLineString=function(l,h){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+l.x+" "+l.y+", "+h.x+" "+h.y+" )"};var Z=function(l){function h(y){l.call(this,y),this.name="RuntimeException",this.message=y,this.stack=(new l).stack}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h}(Error),Y=function(l){function h(){l.call(this),0===arguments.length?l.call(this):1===arguments.length&&l.call(this,arguments[0])}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Z),J=function(){};J.prototype.interfaces_=function(){return[]},J.prototype.getClass=function(){return J},J.shouldNeverReachHere=function(){if(0===arguments.length)J.shouldNeverReachHere(null);else if(1===arguments.length){var l=arguments[0];throw new Y("Should never reach here"+(null!==l?": "+l:""))}},J.isTrue=function(){var h;if(1===arguments.length)J.isTrue(arguments[0],null);else if(2===arguments.length&&(h=arguments[1],!arguments[0]))throw null===h?new Y:new Y(h)},J.equals=function(){var l,h,y;if(2===arguments.length)J.equals(l=arguments[0],h=arguments[1],null);else if(3===arguments.length&&(y=arguments[2],!(h=arguments[1]).equals(l=arguments[0])))throw new Y("Expected "+l+" but encountered "+h+(null!==y?": "+y:""))};var xe=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new ie,this._intPt[1]=new ie,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},We={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};xe.prototype.getIndexAlongSegment=function(l,h){return this.computeIntLineIndex(),this._intLineIndex[l][h]},xe.prototype.getTopologySummary=function(){var l=new Ae;return this.isEndPoint()&&l.append(" endpoint"),this._isProper&&l.append(" proper"),this.isCollinear()&&l.append(" collinear"),l.toString()},xe.prototype.computeIntersection=function(l,h,y,b){this._inputLines[0][0]=l,this._inputLines[0][1]=h,this._inputLines[1][0]=y,this._inputLines[1][1]=b,this._result=this.computeIntersect(l,h,y,b)},xe.prototype.getIntersectionNum=function(){return this._result},xe.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var l=arguments[0];this.getEdgeDistance(l,0)>this.getEdgeDistance(l,1)?(this._intLineIndex[l][0]=0,this._intLineIndex[l][1]=1):(this._intLineIndex[l][0]=1,this._intLineIndex[l][1]=0)}},xe.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},xe.prototype.setPrecisionModel=function(l){this._precisionModel=l},xe.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var l=arguments[0],h=0;h<this._result;h++)if(!this._intPt[h].equals2D(this._inputLines[l][0])&&!this._intPt[h].equals2D(this._inputLines[l][1]))return!0;return!1}},xe.prototype.getIntersection=function(l){return this._intPt[l]},xe.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},xe.prototype.hasIntersection=function(){return this._result!==xe.NO_INTERSECTION},xe.prototype.getEdgeDistance=function(l,h){return xe.computeEdgeDistance(this._intPt[h],this._inputLines[l][0],this._inputLines[l][1])},xe.prototype.isCollinear=function(){return this._result===xe.COLLINEAR_INTERSECTION},xe.prototype.toString=function(){return ye.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+ye.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},xe.prototype.getEndpoint=function(l,h){return this._inputLines[l][h]},xe.prototype.isIntersection=function(l){for(var h=0;h<this._result;h++)if(this._intPt[h].equals2D(l))return!0;return!1},xe.prototype.getIntersectionAlongSegment=function(l,h){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[l][h]]},xe.prototype.interfaces_=function(){return[]},xe.prototype.getClass=function(){return xe},xe.computeEdgeDistance=function(l,h,y){var b=Math.abs(y.x-h.x),I=Math.abs(y.y-h.y),B=-1;if(l.equals(h))B=0;else if(l.equals(y))B=b>I?b:I;else{var j=Math.abs(l.x-h.x),oe=Math.abs(l.y-h.y);0!==(B=b>I?j:oe)||l.equals(h)||(B=Math.max(j,oe))}return J.isTrue(!(0===B&&!l.equals(h)),"Bad distance calculation"),B},xe.nonRobustComputeEdgeDistance=function(l,h,y){var b=l.x-h.x,I=l.y-h.y,B=Math.sqrt(b*b+I*I);return J.isTrue(!(0===B&&!l.equals(h)),"Invalid distance calculation"),B},We.DONT_INTERSECT.get=function(){return 0},We.DO_INTERSECT.get=function(){return 1},We.COLLINEAR.get=function(){return 2},We.NO_INTERSECTION.get=function(){return 0},We.POINT_INTERSECTION.get=function(){return 1},We.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(xe,We);var Tt=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.isInSegmentEnvelopes=function(y){var b=new un(this._inputLines[0][0],this._inputLines[0][1]),I=new un(this._inputLines[1][0],this._inputLines[1][1]);return b.contains(y)&&I.contains(y)},h.prototype.computeIntersection=function(){if(3!==arguments.length)return l.prototype.computeIntersection.apply(this,arguments);var y=arguments[0],b=arguments[1],I=arguments[2];if(this._isProper=!1,un.intersects(b,I,y)&&0===Ot.orientationIndex(b,I,y)&&0===Ot.orientationIndex(I,b,y))return this._isProper=!0,(y.equals(b)||y.equals(I))&&(this._isProper=!1),this._result=l.POINT_INTERSECTION,null;this._result=l.NO_INTERSECTION},h.prototype.normalizeToMinimum=function(y,b,I,B,j){j.x=this.smallestInAbsValue(y.x,b.x,I.x,B.x),j.y=this.smallestInAbsValue(y.y,b.y,I.y,B.y),y.x-=j.x,y.y-=j.y,b.x-=j.x,b.y-=j.y,I.x-=j.x,I.y-=j.y,B.x-=j.x,B.y-=j.y},h.prototype.safeHCoordinateIntersection=function(y,b,I,B){var j=null;try{j=bn.intersection(y,b,I,B)}catch(oe){if(!(oe instanceof Dn))throw oe;j=h.nearestEndpoint(y,b,I,B)}return j},h.prototype.intersection=function(y,b,I,B){var j=this.intersectionWithNormalization(y,b,I,B);return this.isInSegmentEnvelopes(j)||(j=new ie(h.nearestEndpoint(y,b,I,B))),null!==this._precisionModel&&this._precisionModel.makePrecise(j),j},h.prototype.smallestInAbsValue=function(y,b,I,B){var j=y,oe=Math.abs(j);return Math.abs(b)<oe&&(j=b,oe=Math.abs(b)),Math.abs(I)<oe&&(j=I,oe=Math.abs(I)),Math.abs(B)<oe&&(j=B),j},h.prototype.checkDD=function(y,b,I,B,j){var oe=It.intersection(y,b,I,B),Pe=this.isInSegmentEnvelopes(oe);gn.out.println("DD in env = "+Pe+"  --------------------- "+oe),j.distance(oe)>1e-4&&gn.out.println("Distance = "+j.distance(oe))},h.prototype.intersectionWithNormalization=function(y,b,I,B){var j=new ie(y),oe=new ie(b),Pe=new ie(I),st=new ie(B),kt=new ie;this.normalizeToEnvCentre(j,oe,Pe,st,kt);var qt=this.safeHCoordinateIntersection(j,oe,Pe,st);return qt.x+=kt.x,qt.y+=kt.y,qt},h.prototype.computeCollinearIntersection=function(y,b,I,B){var j=un.intersects(y,b,I),oe=un.intersects(y,b,B),Pe=un.intersects(I,B,y),st=un.intersects(I,B,b);return j&&oe?(this._intPt[0]=I,this._intPt[1]=B,l.COLLINEAR_INTERSECTION):Pe&&st?(this._intPt[0]=y,this._intPt[1]=b,l.COLLINEAR_INTERSECTION):j&&Pe?(this._intPt[0]=I,this._intPt[1]=y,!I.equals(y)||oe||st?l.COLLINEAR_INTERSECTION:l.POINT_INTERSECTION):j&&st?(this._intPt[0]=I,this._intPt[1]=b,!I.equals(b)||oe||Pe?l.COLLINEAR_INTERSECTION:l.POINT_INTERSECTION):oe&&Pe?(this._intPt[0]=B,this._intPt[1]=y,!B.equals(y)||j||st?l.COLLINEAR_INTERSECTION:l.POINT_INTERSECTION):oe&&st?(this._intPt[0]=B,this._intPt[1]=b,!B.equals(b)||j||Pe?l.COLLINEAR_INTERSECTION:l.POINT_INTERSECTION):l.NO_INTERSECTION},h.prototype.normalizeToEnvCentre=function(y,b,I,B,j){var oe=y.x<b.x?y.x:b.x,Pe=y.y<b.y?y.y:b.y,st=y.x>b.x?y.x:b.x,kt=y.y>b.y?y.y:b.y,qt=I.x<B.x?I.x:B.x,Pn=I.y<B.y?I.y:B.y,In=I.x>B.x?I.x:B.x,zn=I.y>B.y?I.y:B.y,Mi=((Pe>Pn?Pe:Pn)+(kt<zn?kt:zn))/2;j.x=((oe>qt?oe:qt)+(st<In?st:In))/2,j.y=Mi,y.x-=j.x,y.y-=j.y,b.x-=j.x,b.y-=j.y,I.x-=j.x,I.y-=j.y,B.x-=j.x,B.y-=j.y},h.prototype.computeIntersect=function(y,b,I,B){if(this._isProper=!1,!un.intersects(y,b,I,B))return l.NO_INTERSECTION;var j=Ot.orientationIndex(y,b,I),oe=Ot.orientationIndex(y,b,B);if(j>0&&oe>0||j<0&&oe<0)return l.NO_INTERSECTION;var Pe=Ot.orientationIndex(I,B,y),st=Ot.orientationIndex(I,B,b);return Pe>0&&st>0||Pe<0&&st<0?l.NO_INTERSECTION:0===j&&0===oe&&0===Pe&&0===st?this.computeCollinearIntersection(y,b,I,B):(0===j||0===oe||0===Pe||0===st?(this._isProper=!1,y.equals2D(I)||y.equals2D(B)?this._intPt[0]=y:b.equals2D(I)||b.equals2D(B)?this._intPt[0]=b:0===j?this._intPt[0]=new ie(I):0===oe?this._intPt[0]=new ie(B):0===Pe?this._intPt[0]=new ie(y):0===st&&(this._intPt[0]=new ie(b))):(this._isProper=!0,this._intPt[0]=this.intersection(y,b,I,B)),l.POINT_INTERSECTION)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.nearestEndpoint=function(y,b,I,B){var j=y,oe=Ot.distancePointLine(y,I,B),Pe=Ot.distancePointLine(b,I,B);return Pe<oe&&(oe=Pe,j=b),(Pe=Ot.distancePointLine(I,y,b))<oe&&(oe=Pe,j=I),(Pe=Ot.distancePointLine(B,y,b))<oe&&(oe=Pe,j=B),j},h}(xe),Ht=function(){};Ht.prototype.interfaces_=function(){return[]},Ht.prototype.getClass=function(){return Ht},Ht.orientationIndex=function(l,h,y){return Ht.signOfDet2x2(h.x-l.x,h.y-l.y,y.x-h.x,y.y-h.y)},Ht.signOfDet2x2=function(l,h,y,b){var I=null,B=null,j=null;if(I=1,0===l||0===b)return 0===h||0===y?0:h>0?y>0?-I:I:y>0?I:-I;if(0===h||0===y)return b>0?l>0?I:-I:l>0?-I:I;if(h>0?b>0?h<=b||(I=-I,B=l,l=y,y=B,B=h,h=b,b=B):h<=-b?(I=-I,y=-y,b=-b):(B=l,l=-y,y=B,B=h,h=-b,b=B):b>0?-h<=b?(I=-I,l=-l,h=-h):(B=-l,l=y,y=B,B=-h,h=b,b=B):h>=b?(l=-l,h=-h,y=-y,b=-b):(I=-I,B=-l,l=-y,y=B,B=-h,h=-b,b=B),l>0){if(!(y>0&&l<=y))return I}else{if(y>0||!(l>=y))return-I;I=-I,l=-l,y=-y}for(;;){if((b-=(j=Math.floor(y/l))*h)<0)return-I;if(b>h)return I;if(l>(y-=j*l)+y){if(h<b+b)return I}else{if(h>b+b)return-I;y=l-y,b=h-b,I=-I}if(0===b)return 0===y?0:-I;if(0===y||(l-=(j=Math.floor(l/y))*y,(h-=j*b)<0))return I;if(h>b)return-I;if(y>l+l){if(b<h+h)return-I}else{if(b>h+h)return I;l=y-l,h=b-h,I=-I}if(0===h)return 0===l?0:I;if(0===l)return-I}};var Gt=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1,this._p=arguments[0]};Gt.prototype.countSegment=function(l,h){if(l.x<this._p.x&&h.x<this._p.x)return null;if(this._p.x===h.x&&this._p.y===h.y)return this._isPointOnSegment=!0,null;if(l.y===this._p.y&&h.y===this._p.y){var y=l.x,b=h.x;return y>b&&(y=h.x,b=l.x),this._p.x>=y&&this._p.x<=b&&(this._isPointOnSegment=!0),null}if(l.y>this._p.y&&h.y<=this._p.y||h.y>this._p.y&&l.y<=this._p.y){var B=l.y-this._p.y,oe=h.y-this._p.y,Pe=Ht.signOfDet2x2(l.x-this._p.x,B,h.x-this._p.x,oe);if(0===Pe)return this._isPointOnSegment=!0,null;oe<B&&(Pe=-Pe),Pe>0&&this._crossingCount++}},Gt.prototype.isPointInPolygon=function(){return this.getLocation()!==Te.EXTERIOR},Gt.prototype.getLocation=function(){return this._isPointOnSegment?Te.BOUNDARY:this._crossingCount%2==1?Te.INTERIOR:Te.EXTERIOR},Gt.prototype.isOnSegment=function(){return this._isPointOnSegment},Gt.prototype.interfaces_=function(){return[]},Gt.prototype.getClass=function(){return Gt},Gt.locatePointInRing=function(){if(arguments[0]instanceof ie&&At(arguments[1],Mt)){for(var h=arguments[1],y=new Gt(arguments[0]),b=new ie,I=new ie,B=1;B<h.size();B++)if(h.getCoordinate(B,b),h.getCoordinate(B-1,I),y.countSegment(b,I),y.isOnSegment())return y.getLocation();return y.getLocation()}if(arguments[0]instanceof ie&&arguments[1]instanceof Array){for(var oe=arguments[1],Pe=new Gt(arguments[0]),st=1;st<oe.length;st++)if(Pe.countSegment(oe[st],oe[st-1]),Pe.isOnSegment())return Pe.getLocation();return Pe.getLocation()}};var Ot=function(){},or={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};Ot.prototype.interfaces_=function(){return[]},Ot.prototype.getClass=function(){return Ot},Ot.orientationIndex=function(l,h,y){return It.orientationIndex(l,h,y)},Ot.signedArea=function(){if(arguments[0]instanceof Array){var l=arguments[0];if(l.length<3)return 0;for(var h=0,y=l[0].x,b=1;b<l.length-1;b++)h+=(l[b].x-y)*(l[b-1].y-l[b+1].y);return h/2}if(At(arguments[0],Mt)){var j=arguments[0],oe=j.size();if(oe<3)return 0;var Pe=new ie,st=new ie,kt=new ie;j.getCoordinate(0,st),j.getCoordinate(1,kt);var qt=st.x;kt.x-=qt;for(var Pn=0,In=1;In<oe-1;In++)Pe.y=st.y,st.x=kt.x,st.y=kt.y,j.getCoordinate(In+1,kt),kt.x-=qt,Pn+=st.x*(Pe.y-kt.y);return Pn/2}},Ot.distanceLineLine=function(l,h,y,b){if(l.equals(h))return Ot.distancePointLine(l,y,b);if(y.equals(b))return Ot.distancePointLine(b,l,h);var I=!1;if(un.intersects(l,h,y,b)){var B=(h.x-l.x)*(b.y-y.y)-(h.y-l.y)*(b.x-y.x);if(0===B)I=!0;else{var oe=((l.y-y.y)*(h.x-l.x)-(l.x-y.x)*(h.y-l.y))/B,Pe=((l.y-y.y)*(b.x-y.x)-(l.x-y.x)*(b.y-y.y))/B;(Pe<0||Pe>1||oe<0||oe>1)&&(I=!0)}}else I=!0;return I?we.min(Ot.distancePointLine(l,y,b),Ot.distancePointLine(h,y,b),Ot.distancePointLine(y,l,h),Ot.distancePointLine(b,l,h)):0},Ot.isPointInRing=function(l,h){return Ot.locatePointInRing(l,h)!==Te.EXTERIOR},Ot.computeLength=function(l){var h=l.size();if(h<=1)return 0;var y=0,b=new ie;l.getCoordinate(0,b);for(var I=b.x,B=b.y,j=1;j<h;j++){l.getCoordinate(j,b);var oe=b.x,Pe=b.y,st=oe-I,kt=Pe-B;y+=Math.sqrt(st*st+kt*kt),I=oe,B=Pe}return y},Ot.isCCW=function(l){var h=l.length-1;if(h<3)throw new fe("Ring has fewer than 4 points, so orientation cannot be determined");for(var y=l[0],b=0,I=1;I<=h;I++){var B=l[I];B.y>y.y&&(y=B,b=I)}var j=b;do{(j-=1)<0&&(j=h)}while(l[j].equals2D(y)&&j!==b);var oe=b;do{oe=(oe+1)%h}while(l[oe].equals2D(y)&&oe!==b);var Pe=l[j],st=l[oe];if(Pe.equals2D(y)||st.equals2D(y)||Pe.equals2D(st))return!1;var kt=Ot.computeOrientation(Pe,y,st);return 0===kt?Pe.x>st.x:kt>0},Ot.locatePointInRing=function(l,h){return Gt.locatePointInRing(l,h)},Ot.distancePointLinePerpendicular=function(l,h,y){var b=(y.x-h.x)*(y.x-h.x)+(y.y-h.y)*(y.y-h.y);return Math.abs(((h.y-l.y)*(y.x-h.x)-(h.x-l.x)*(y.y-h.y))/b)*Math.sqrt(b)},Ot.computeOrientation=function(l,h,y){return Ot.orientationIndex(l,h,y)},Ot.distancePointLine=function(){if(2===arguments.length){var l=arguments[0],h=arguments[1];if(0===h.length)throw new fe("Line array must contain at least one vertex");for(var y=l.distance(h[0]),b=0;b<h.length-1;b++){var I=Ot.distancePointLine(l,h[b],h[b+1]);I<y&&(y=I)}return y}if(3===arguments.length){var B=arguments[0],j=arguments[1],oe=arguments[2];if(j.x===oe.x&&j.y===oe.y)return B.distance(j);var Pe=(oe.x-j.x)*(oe.x-j.x)+(oe.y-j.y)*(oe.y-j.y),st=((B.x-j.x)*(oe.x-j.x)+(B.y-j.y)*(oe.y-j.y))/Pe;return st<=0?B.distance(j):st>=1?B.distance(oe):Math.abs(((j.y-B.y)*(oe.x-j.x)-(j.x-B.x)*(oe.y-j.y))/Pe)*Math.sqrt(Pe)}},Ot.isOnLine=function(l,h){for(var y=new Tt,b=1;b<h.length;b++)if(y.computeIntersection(l,h[b-1],h[b]),y.hasIntersection())return!0;return!1},or.CLOCKWISE.get=function(){return-1},or.RIGHT.get=function(){return Ot.CLOCKWISE},or.COUNTERCLOCKWISE.get=function(){return 1},or.LEFT.get=function(){return Ot.COUNTERCLOCKWISE},or.COLLINEAR.get=function(){return 0},or.STRAIGHT.get=function(){return Ot.COLLINEAR},Object.defineProperties(Ot,or);var _r=function(){};_r.prototype.filter=function(l){},_r.prototype.interfaces_=function(){return[]},_r.prototype.getClass=function(){return _r};var Sn=function(){var l=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=l,this._SRID=l.getSRID()},Cr={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Sn.prototype.isGeometryCollection=function(){return this.getSortIndex()===Sn.SORTINDEX_GEOMETRYCOLLECTION},Sn.prototype.getFactory=function(){return this._factory},Sn.prototype.getGeometryN=function(l){return this},Sn.prototype.getArea=function(){return 0},Sn.prototype.isRectangle=function(){return!1},Sn.prototype.equals=function(){if(arguments[0]instanceof Sn){var l=arguments[0];return null!==l&&this.equalsTopo(l)}if(arguments[0]instanceof Object){var h=arguments[0];return h instanceof Sn&&this.equalsExact(h)}},Sn.prototype.equalsExact=function(l){return this===l||this.equalsExact(l,0)},Sn.prototype.geometryChanged=function(){this.apply(Sn.geometryChangedFilter)},Sn.prototype.geometryChangedAction=function(){this._envelope=null},Sn.prototype.equalsNorm=function(l){return null!==l&&this.norm().equalsExact(l.norm())},Sn.prototype.getLength=function(){return 0},Sn.prototype.getNumGeometries=function(){return 1},Sn.prototype.compareTo=function(){if(1===arguments.length){var l=arguments[0],h=l;return this.getSortIndex()!==h.getSortIndex()?this.getSortIndex()-h.getSortIndex():this.isEmpty()&&h.isEmpty()?0:this.isEmpty()?-1:h.isEmpty()?1:this.compareToSameClass(l)}if(2===arguments.length){var y=arguments[0],b=arguments[1];return this.getSortIndex()!==y.getSortIndex()?this.getSortIndex()-y.getSortIndex():this.isEmpty()&&y.isEmpty()?0:this.isEmpty()?-1:y.isEmpty()?1:this.compareToSameClass(y,b)}},Sn.prototype.getUserData=function(){return this._userData},Sn.prototype.getSRID=function(){return this._SRID},Sn.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},Sn.prototype.checkNotGeometryCollection=function(l){if(l.getSortIndex()===Sn.SORTINDEX_GEOMETRYCOLLECTION)throw new fe("This method does not support GeometryCollection arguments")},Sn.prototype.equal=function(l,h,y){return 0===y?l.equals(h):l.distance(h)<=y},Sn.prototype.norm=function(){var l=this.copy();return l.normalize(),l},Sn.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},Sn.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new un(this._envelope)},Sn.prototype.setSRID=function(l){this._SRID=l},Sn.prototype.setUserData=function(l){this._userData=l},Sn.prototype.compare=function(l,h){for(var y=l.iterator(),b=h.iterator();y.hasNext()&&b.hasNext();){var I=y.next(),B=b.next(),j=I.compareTo(B);if(0!==j)return j}return y.hasNext()?1:b.hasNext()?-1:0},Sn.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},Sn.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Sn.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Sn.SORTINDEX_MULTIPOINT||this.getSortIndex()===Sn.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Sn.SORTINDEX_MULTIPOLYGON},Sn.prototype.interfaces_=function(){return[ne,ce,Ee]},Sn.prototype.getClass=function(){return Sn},Sn.hasNonEmptyElements=function(l){for(var h=0;h<l.length;h++)if(!l[h].isEmpty())return!0;return!1},Sn.hasNullElements=function(l){for(var h=0;h<l.length;h++)if(null===l[h])return!0;return!1},Cr.serialVersionUID.get=function(){return 0x799ea46522854c00},Cr.SORTINDEX_POINT.get=function(){return 0},Cr.SORTINDEX_MULTIPOINT.get=function(){return 1},Cr.SORTINDEX_LINESTRING.get=function(){return 2},Cr.SORTINDEX_LINEARRING.get=function(){return 3},Cr.SORTINDEX_MULTILINESTRING.get=function(){return 4},Cr.SORTINDEX_POLYGON.get=function(){return 5},Cr.SORTINDEX_MULTIPOLYGON.get=function(){return 6},Cr.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},Cr.geometryChangedFilter.get=function(){return kr},Object.defineProperties(Sn,Cr);var kr=function(){};kr.interfaces_=function(){return[_r]},kr.filter=function(l){l.geometryChangedAction()};var Fr=function(){};Fr.prototype.filter=function(l){},Fr.prototype.interfaces_=function(){return[]},Fr.prototype.getClass=function(){return Fr};var mr=function(){},yi={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};mr.prototype.isInBoundary=function(l){},mr.prototype.interfaces_=function(){return[]},mr.prototype.getClass=function(){return mr},yi.Mod2BoundaryNodeRule.get=function(){return Po},yi.EndPointBoundaryNodeRule.get=function(){return bs},yi.MultiValentEndPointBoundaryNodeRule.get=function(){return Ge},yi.MonoValentEndPointBoundaryNodeRule.get=function(){return se},yi.MOD2_BOUNDARY_RULE.get=function(){return new Po},yi.ENDPOINT_BOUNDARY_RULE.get=function(){return new bs},yi.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Ge},yi.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new se},yi.OGC_SFS_BOUNDARY_RULE.get=function(){return mr.MOD2_BOUNDARY_RULE},Object.defineProperties(mr,yi);var Po=function(){};Po.prototype.isInBoundary=function(l){return l%2==1},Po.prototype.interfaces_=function(){return[mr]},Po.prototype.getClass=function(){return Po};var bs=function(){};bs.prototype.isInBoundary=function(l){return l>0},bs.prototype.interfaces_=function(){return[mr]},bs.prototype.getClass=function(){return bs};var Ge=function(){};Ge.prototype.isInBoundary=function(l){return l>1},Ge.prototype.interfaces_=function(){return[mr]},Ge.prototype.getClass=function(){return Ge};var se=function(){};se.prototype.isInBoundary=function(l){return 1===l},se.prototype.interfaces_=function(){return[mr]},se.prototype.getClass=function(){return se};var ae=function(){};ae.prototype.add=function(){},ae.prototype.addAll=function(){},ae.prototype.isEmpty=function(){},ae.prototype.iterator=function(){},ae.prototype.size=function(){},ae.prototype.toArray=function(){},ae.prototype.remove=function(){},(ze.prototype=new Error).name="IndexOutOfBoundsException";var je=function(){};je.prototype.hasNext=function(){},je.prototype.next=function(){},je.prototype.remove=function(){};var tt=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.get=function(){},h.prototype.set=function(){},h.prototype.isEmpty=function(){},h}(ae);(ht.prototype=new Error).name="NoSuchElementException";var Oe=function(l){function h(){l.call(this),this.array_=[],arguments[0]instanceof ae&&this.addAll(arguments[0])}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.ensureCapacity=function(){},h.prototype.interfaces_=function(){return[l,ae]},h.prototype.add=function(y){return 1===arguments.length?this.array_.push(y):this.array_.splice(arguments[0],arguments[1]),!0},h.prototype.clear=function(){this.array_=[]},h.prototype.addAll=function(y){for(var b=y.iterator();b.hasNext();)this.add(b.next());return!0},h.prototype.set=function(y,b){var I=this.array_[y];return this.array_[y]=b,I},h.prototype.iterator=function(){return new Ct(this)},h.prototype.get=function(y){if(y<0||y>=this.size())throw new ze;return this.array_[y]},h.prototype.isEmpty=function(){return 0===this.array_.length},h.prototype.size=function(){return this.array_.length},h.prototype.toArray=function(){for(var y=[],b=0,I=this.array_.length;b<I;b++)y.push(this.array_[b]);return y},h.prototype.remove=function(y){for(var b=!1,I=0,B=this.array_.length;I<B;I++)if(this.array_[I]===y){this.array_.splice(I,1),b=!0;break}return b},h}(tt),Ct=function(l){function h(y){l.call(this),this.arrayList_=y,this.position_=0}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new ht;return this.arrayList_.get(this.position_++)},h.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},h.prototype.set=function(y){return this.arrayList_.set(this.position_-1,y)},h.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},h}(je),bt=function(l){function h(){if(l.call(this),0!==arguments.length)if(1===arguments.length){var b=arguments[0];this.ensureCapacity(b.length),this.add(b,!0)}else if(2===arguments.length){var I=arguments[0],B=arguments[1];this.ensureCapacity(I.length),this.add(I,B)}}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var y={coordArrayType:{configurable:!0}};return y.coordArrayType.get=function(){return new Array(0).fill(null)},h.prototype.getCoordinate=function(b){return this.get(b)},h.prototype.addAll=function(){if(2===arguments.length){for(var I=arguments[1],B=!1,j=arguments[0].iterator();j.hasNext();)this.add(j.next(),I),B=!0;return B}return l.prototype.addAll.apply(this,arguments)},h.prototype.clone=function(){for(var b=l.prototype.clone.call(this),I=0;I<this.size();I++)b.add(I,this.get(I).copy());return b},h.prototype.toCoordinateArray=function(){return this.toArray(h.coordArrayType)},h.prototype.add=function(){if(1===arguments.length)l.prototype.add.call(this,arguments[0]);else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1],!0),!0;if(arguments[0]instanceof ie&&"boolean"==typeof arguments[1]){var j=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(j))return null;l.prototype.add.call(this,j)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1]),!0}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var st=arguments[0],kt=arguments[1];if(arguments[2])for(var qt=0;qt<st.length;qt++)this.add(st[qt],kt);else for(var Pn=st.length-1;Pn>=0;Pn--)this.add(st[Pn],kt);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof ie){var In=arguments[0],zn=arguments[1];if(!arguments[2]){var tr=this.size();if(tr>0&&(In>0&&this.get(In-1).equals2D(zn)||In<tr&&this.get(In).equals2D(zn)))return null}l.prototype.add.call(this,In,zn)}}else if(4===arguments.length){var Mi=arguments[0],Tn=arguments[1],wa=arguments[2],Ea=arguments[3],ml=1;wa>Ea&&(ml=-1);for(var Ac=wa;Ac!==Ea;Ac+=ml)this.add(Mi[Ac],Tn);return!0}},h.prototype.closeRing=function(){this.size()>0&&this.add(new ie(this.get(0)),!1)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},Object.defineProperties(h,y),h}(Oe),Qe=function(){},Lt={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Lt.ForwardComparator.get=function(){return fn},Lt.BidirectionalComparator.get=function(){return En},Lt.coordArrayType.get=function(){return new Array(0).fill(null)},Qe.prototype.interfaces_=function(){return[]},Qe.prototype.getClass=function(){return Qe},Qe.isRing=function(l){return!(l.length<4||!l[0].equals2D(l[l.length-1]))},Qe.ptNotInList=function(l,h){for(var y=0;y<l.length;y++){var b=l[y];if(Qe.indexOf(b,h)<0)return b}return null},Qe.scroll=function(l,h){var y=Qe.indexOf(h,l);if(y<0)return null;var b=new Array(l.length).fill(null);gn.arraycopy(l,y,b,0,l.length-y),gn.arraycopy(l,0,b,l.length-y,y),gn.arraycopy(b,0,l,0,l.length)},Qe.equals=function(){if(2===arguments.length){var l=arguments[0],h=arguments[1];if(l===h)return!0;if(null===l||null===h||l.length!==h.length)return!1;for(var y=0;y<l.length;y++)if(!l[y].equals(h[y]))return!1;return!0}if(3===arguments.length){var b=arguments[0],I=arguments[1],B=arguments[2];if(b===I)return!0;if(null===b||null===I||b.length!==I.length)return!1;for(var j=0;j<b.length;j++)if(0!==B.compare(b[j],I[j]))return!1;return!0}},Qe.intersection=function(l,h){for(var y=new bt,b=0;b<l.length;b++)h.intersects(l[b])&&y.add(l[b],!0);return y.toCoordinateArray()},Qe.hasRepeatedPoints=function(l){for(var h=1;h<l.length;h++)if(l[h-1].equals(l[h]))return!0;return!1},Qe.removeRepeatedPoints=function(l){return Qe.hasRepeatedPoints(l)?new bt(l,!1).toCoordinateArray():l},Qe.reverse=function(l){for(var h=l.length-1,y=Math.trunc(h/2),b=0;b<=y;b++){var I=l[b];l[b]=l[h-b],l[h-b]=I}},Qe.removeNull=function(l){for(var h=0,y=0;y<l.length;y++)null!==l[y]&&h++;var b=new Array(h).fill(null);if(0===h)return b;for(var I=0,B=0;B<l.length;B++)null!==l[B]&&(b[I++]=l[B]);return b},Qe.copyDeep=function(){if(1===arguments.length){for(var l=arguments[0],h=new Array(l.length).fill(null),y=0;y<l.length;y++)h[y]=new ie(l[y]);return h}if(5===arguments.length)for(var b=arguments[0],I=arguments[1],B=arguments[2],j=arguments[3],oe=arguments[4],Pe=0;Pe<oe;Pe++)B[j+Pe]=new ie(b[I+Pe])},Qe.isEqualReversed=function(l,h){for(var y=0;y<l.length;y++)if(0!==l[y].compareTo(h[l.length-y-1]))return!1;return!0},Qe.envelope=function(l){for(var h=new un,y=0;y<l.length;y++)h.expandToInclude(l[y]);return h},Qe.toCoordinateArray=function(l){return l.toArray(Qe.coordArrayType)},Qe.atLeastNCoordinatesOrNothing=function(l,h){return h.length>=l?h:[]},Qe.indexOf=function(l,h){for(var y=0;y<h.length;y++)if(l.equals(h[y]))return y;return-1},Qe.increasingDirection=function(l){for(var h=0;h<Math.trunc(l.length/2);h++){var b=l[h].compareTo(l[l.length-1-h]);if(0!==b)return b}return 1},Qe.compare=function(l,h){for(var y=0;y<l.length&&y<h.length;){var b=l[y].compareTo(h[y]);if(0!==b)return b;y++}return y<h.length?-1:y<l.length?1:0},Qe.minCoordinate=function(l){for(var h=null,y=0;y<l.length;y++)(null===h||h.compareTo(l[y])>0)&&(h=l[y]);return h},Qe.extract=function(l,h,y){h=we.clamp(h,0,l.length);var b=(y=we.clamp(y,-1,l.length))-h+1;y<0&&(b=0),h>=l.length&&(b=0),y<h&&(b=0);var I=new Array(b).fill(null);if(0===b)return I;for(var B=0,j=h;j<=y;j++)I[B++]=l[j];return I},Object.defineProperties(Qe,Lt);var fn=function(){};fn.prototype.compare=function(l,h){return Qe.compare(l,h)},fn.prototype.interfaces_=function(){return[Me]},fn.prototype.getClass=function(){return fn};var En=function(){};En.prototype.compare=function(l,h){var y=l,b=h;if(y.length<b.length)return-1;if(y.length>b.length)return 1;if(0===y.length)return 0;var I=Qe.compare(y,b);return Qe.isEqualReversed(y,b)?0:I},En.prototype.OLDcompare=function(l,h){var y=l,b=h;if(y.length<b.length)return-1;if(y.length>b.length)return 1;if(0===y.length)return 0;for(var I=Qe.increasingDirection(y),B=Qe.increasingDirection(b),j=I>0?0:y.length-1,oe=B>0?0:y.length-1,Pe=0;Pe<y.length;Pe++){var st=y[j].compareTo(b[oe]);if(0!==st)return st;j+=I,oe+=B}return 0},En.prototype.interfaces_=function(){return[Me]},En.prototype.getClass=function(){return En};var pn=function(){};pn.prototype.get=function(){},pn.prototype.put=function(){},pn.prototype.size=function(){},pn.prototype.values=function(){},pn.prototype.entrySet=function(){};var Vr=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h}(pn);(p.prototype=new Error).name="OperationNotSupported",(be.prototype=new ae).contains=function(){};var Kr=function(l){function h(){l.call(this),this.array_=[],arguments[0]instanceof ae&&this.addAll(arguments[0])}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.contains=function(y){for(var b=0,I=this.array_.length;b<I;b++)if(this.array_[b]===y)return!0;return!1},h.prototype.add=function(y){return!this.contains(y)&&(this.array_.push(y),!0)},h.prototype.addAll=function(y){for(var b=y.iterator();b.hasNext();)this.add(b.next());return!0},h.prototype.remove=function(y){throw new Error},h.prototype.size=function(){return this.array_.length},h.prototype.isEmpty=function(){return 0===this.array_.length},h.prototype.toArray=function(){for(var y=[],b=0,I=this.array_.length;b<I;b++)y.push(this.array_[b]);return y},h.prototype.iterator=function(){return new Ur(this)},h}(be),Ur=function(l){function h(y){l.call(this),this.hashSet_=y,this.position_=0}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new ht;return this.hashSet_.array_[this.position_++]},h.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},h.prototype.remove=function(){throw new p},h}(je),Nr=0;(Dt.prototype=new Vr).get=function(l){for(var h=this.root_;null!==h;){var y=l.compareTo(h.key);if(y<0)h=h.left;else{if(!(y>0))return h.value;h=h.right}}return null},Dt.prototype.put=function(l,h){if(null===this.root_)return this.root_={key:l,value:h,left:null,right:null,parent:null,color:Nr,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var y,b,I=this.root_;do{if(y=I,(b=l.compareTo(I.key))<0)I=I.left;else{if(!(b>0)){var B=I.value;return I.value=h,B}I=I.right}}while(null!==I);var j={key:l,left:null,right:null,value:h,parent:y,color:Nr,getValue:function(){return this.value},getKey:function(){return this.key}};return b<0?y.left=j:y.right=j,this.fixAfterInsertion(j),this.size_++,null},Dt.prototype.fixAfterInsertion=function(l){for(l.color=1;null!=l&&l!==this.root_&&1===l.parent.color;)if(dt(l)===Et(dt(dt(l)))){var h=rn(dt(dt(l)));1===Xe(h)?(ft(dt(l),Nr),ft(h,Nr),ft(dt(dt(l)),1),l=dt(dt(l))):(l===rn(dt(l))&&(l=dt(l),this.rotateLeft(l)),ft(dt(l),Nr),ft(dt(dt(l)),1),this.rotateRight(dt(dt(l))))}else{var y=Et(dt(dt(l)));1===Xe(y)?(ft(dt(l),Nr),ft(y,Nr),ft(dt(dt(l)),1),l=dt(dt(l))):(l===Et(dt(l))&&(l=dt(l),this.rotateRight(l)),ft(dt(l),Nr),ft(dt(dt(l)),1),this.rotateLeft(dt(dt(l))))}this.root_.color=Nr},Dt.prototype.values=function(){var l=new Oe,h=this.getFirstEntry();if(null!==h)for(l.add(h.value);null!==(h=Dt.successor(h));)l.add(h.value);return l},Dt.prototype.entrySet=function(){var l=new Kr,h=this.getFirstEntry();if(null!==h)for(l.add(h);null!==(h=Dt.successor(h));)l.add(h);return l},Dt.prototype.rotateLeft=function(l){if(null!=l){var h=l.right;l.right=h.left,null!=h.left&&(h.left.parent=l),h.parent=l.parent,null===l.parent?this.root_=h:l.parent.left===l?l.parent.left=h:l.parent.right=h,h.left=l,l.parent=h}},Dt.prototype.rotateRight=function(l){if(null!=l){var h=l.left;l.left=h.right,null!=h.right&&(h.right.parent=l),h.parent=l.parent,null===l.parent?this.root_=h:l.parent.right===l?l.parent.right=h:l.parent.left=h,h.right=l,l.parent=h}},Dt.prototype.getFirstEntry=function(){var l=this.root_;if(null!=l)for(;null!=l.left;)l=l.left;return l},Dt.successor=function(l){if(null===l)return null;if(null!==l.right){for(var h=l.right;null!==h.left;)h=h.left;return h}for(var y=l.parent,b=l;null!==y&&b===y.right;)b=y,y=y.parent;return y},Dt.prototype.size=function(){return this.size_};var Qr=function(){};Qr.prototype.interfaces_=function(){return[]},Qr.prototype.getClass=function(){return Qr},mt.prototype=new be,(Vt.prototype=new mt).contains=function(l){for(var h=0,y=this.array_.length;h<y;h++)if(0===this.array_[h].compareTo(l))return!0;return!1},Vt.prototype.add=function(l){if(this.contains(l))return!1;for(var h=0,y=this.array_.length;h<y;h++)if(1===this.array_[h].compareTo(l))return this.array_.splice(h,0,l),!0;return this.array_.push(l),!0},Vt.prototype.addAll=function(l){for(var h=l.iterator();h.hasNext();)this.add(h.next());return!0},Vt.prototype.remove=function(l){throw new p},Vt.prototype.size=function(){return this.array_.length},Vt.prototype.isEmpty=function(){return 0===this.array_.length},Vt.prototype.toArray=function(){for(var l=[],h=0,y=this.array_.length;h<y;h++)l.push(this.array_[h]);return l},Vt.prototype.iterator=function(){return new Ro(this)};var Ro=function(l){this.treeSet_=l,this.position_=0};Ro.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new ht;return this.treeSet_.array_[this.position_++]},Ro.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Ro.prototype.remove=function(){throw new p};var Jr=function(){};Jr.sort=function(){var l,h,y,I=arguments[0];if(1===arguments.length)I.sort(function(j,oe){return j.compareTo(oe)});else if(2===arguments.length)y=arguments[1],I.sort(function(j,oe){return y.compare(j,oe)});else if(3===arguments.length){(h=I.slice(arguments[1],arguments[2])).sort();var B=I.slice(0,arguments[1]).concat(h,I.slice(arguments[2],I.length));for(I.splice(0,I.length),l=0;l<B.length;l++)I.push(B[l])}else if(4===arguments.length)for(h=I.slice(arguments[1],arguments[2]),y=arguments[3],h.sort(function(j,oe){return y.compare(j,oe)}),B=I.slice(0,arguments[1]).concat(h,I.slice(arguments[2],I.length)),I.splice(0,I.length),l=0;l<B.length;l++)I.push(B[l])},Jr.asList=function(l){for(var h=new Oe,y=0,b=l.length;y<b;y++)h.add(l[y]);return h};var Br=function(){},_o={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};_o.P.get=function(){return 0},_o.L.get=function(){return 1},_o.A.get=function(){return 2},_o.FALSE.get=function(){return-1},_o.TRUE.get=function(){return-2},_o.DONTCARE.get=function(){return-3},_o.SYM_FALSE.get=function(){return"F"},_o.SYM_TRUE.get=function(){return"T"},_o.SYM_DONTCARE.get=function(){return"*"},_o.SYM_P.get=function(){return"0"},_o.SYM_L.get=function(){return"1"},_o.SYM_A.get=function(){return"2"},Br.prototype.interfaces_=function(){return[]},Br.prototype.getClass=function(){return Br},Br.toDimensionSymbol=function(l){switch(l){case Br.FALSE:return Br.SYM_FALSE;case Br.TRUE:return Br.SYM_TRUE;case Br.DONTCARE:return Br.SYM_DONTCARE;case Br.P:return Br.SYM_P;case Br.L:return Br.SYM_L;case Br.A:return Br.SYM_A}throw new fe("Unknown dimension value: "+l)},Br.toDimensionValue=function(l){switch(pt.toUpperCase(l)){case Br.SYM_FALSE:return Br.FALSE;case Br.SYM_TRUE:return Br.TRUE;case Br.SYM_DONTCARE:return Br.DONTCARE;case Br.SYM_P:return Br.P;case Br.SYM_L:return Br.L;case Br.SYM_A:return Br.A}throw new fe("Unknown dimension symbol: "+l)},Object.defineProperties(Br,_o);var $s=function(){};$s.prototype.filter=function(l){},$s.prototype.interfaces_=function(){return[]},$s.prototype.getClass=function(){return $s};var To=function(){};To.prototype.filter=function(l,h){},To.prototype.isDone=function(){},To.prototype.isGeometryChanged=function(){},To.prototype.interfaces_=function(){return[]},To.prototype.getClass=function(){return To};var Vi=function(l){function h(b,I){if(l.call(this,I),this._geometries=b||[],l.hasNullElements(this._geometries))throw new fe("geometries must not contain null elements")}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){for(var b=new un,I=0;I<this._geometries.length;I++)b.expandToInclude(this._geometries[I].getEnvelopeInternal());return b},h.prototype.getGeometryN=function(b){return this._geometries[b]},h.prototype.getSortIndex=function(){return l.SORTINDEX_GEOMETRYCOLLECTION},h.prototype.getCoordinates=function(){for(var b=new Array(this.getNumPoints()).fill(null),I=-1,B=0;B<this._geometries.length;B++)for(var j=this._geometries[B].getCoordinates(),oe=0;oe<j.length;oe++)b[++I]=j[oe];return b},h.prototype.getArea=function(){for(var b=0,I=0;I<this._geometries.length;I++)b+=this._geometries[I].getArea();return b},h.prototype.equalsExact=function(){if(2===arguments.length){var b=arguments[0],I=arguments[1];if(!this.isEquivalentClass(b))return!1;var B=b;if(this._geometries.length!==B._geometries.length)return!1;for(var j=0;j<this._geometries.length;j++)if(!this._geometries[j].equalsExact(B._geometries[j],I))return!1;return!0}return l.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){for(var b=0;b<this._geometries.length;b++)this._geometries[b].normalize();Jr.sort(this._geometries)},h.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},h.prototype.getBoundaryDimension=function(){for(var b=Br.FALSE,I=0;I<this._geometries.length;I++)b=Math.max(b,this._geometries[I].getBoundaryDimension());return b},h.prototype.getDimension=function(){for(var b=Br.FALSE,I=0;I<this._geometries.length;I++)b=Math.max(b,this._geometries[I].getDimension());return b},h.prototype.getLength=function(){for(var b=0,I=0;I<this._geometries.length;I++)b+=this._geometries[I].getLength();return b},h.prototype.getNumPoints=function(){for(var b=0,I=0;I<this._geometries.length;I++)b+=this._geometries[I].getNumPoints();return b},h.prototype.getNumGeometries=function(){return this._geometries.length},h.prototype.reverse=function(){for(var I=new Array(this._geometries.length).fill(null),B=0;B<this._geometries.length;B++)I[B]=this._geometries[B].reverse();return this.getFactory().createGeometryCollection(I)},h.prototype.compareToSameClass=function(){if(1===arguments.length){var b=arguments[0],I=new Vt(Jr.asList(this._geometries)),B=new Vt(Jr.asList(b._geometries));return this.compare(I,B)}if(2===arguments.length){for(var oe=arguments[1],Pe=arguments[0],st=this.getNumGeometries(),kt=Pe.getNumGeometries(),qt=0;qt<st&&qt<kt;){var Pn=this.getGeometryN(qt),In=Pe.getGeometryN(qt),zn=Pn.compareToSameClass(In,oe);if(0!==zn)return zn;qt++}return qt<st?1:qt<kt?-1:0}},h.prototype.apply=function(){if(At(arguments[0],Fr))for(var b=arguments[0],I=0;I<this._geometries.length;I++)this._geometries[I].apply(b);else if(At(arguments[0],To)){var B=arguments[0];if(0===this._geometries.length)return null;for(var j=0;j<this._geometries.length&&(this._geometries[j].apply(B),!B.isDone());j++);B.isGeometryChanged()&&this.geometryChanged()}else if(At(arguments[0],$s)){var oe=arguments[0];oe.filter(this);for(var Pe=0;Pe<this._geometries.length;Pe++)this._geometries[Pe].apply(oe)}else if(At(arguments[0],_r)){var st=arguments[0];st.filter(this);for(var kt=0;kt<this._geometries.length;kt++)this._geometries[kt].apply(st)}},h.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),J.shouldNeverReachHere(),null},h.prototype.clone=function(){var b=l.prototype.clone.call(this);b._geometries=new Array(this._geometries.length).fill(null);for(var I=0;I<this._geometries.length;I++)b._geometries[I]=this._geometries[I].clone();return b},h.prototype.getGeometryType=function(){return"GeometryCollection"},h.prototype.copy=function(){for(var b=new Array(this._geometries.length).fill(null),I=0;I<b.length;I++)b[I]=this._geometries[I].copy();return new h(b,this._factory)},h.prototype.isEmpty=function(){for(var b=0;b<this._geometries.length;b++)if(!this._geometries[b].isEmpty())return!1;return!0},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(h,y),h}(Sn),Bl=function(l){function h(){l.apply(this,arguments)}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return Sn.SORTINDEX_MULTILINESTRING},h.prototype.equalsExact=function(){if(2===arguments.length){var b=arguments[0],I=arguments[1];return!!this.isEquivalentClass(b)&&l.prototype.equalsExact.call(this,b,I)}return l.prototype.equalsExact.apply(this,arguments)},h.prototype.getBoundaryDimension=function(){return this.isClosed()?Br.FALSE:0},h.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var b=0;b<this._geometries.length;b++)if(!this._geometries[b].isClosed())return!1;return!0},h.prototype.getDimension=function(){return 1},h.prototype.reverse=function(){for(var b=this._geometries.length,I=new Array(b).fill(null),B=0;B<this._geometries.length;B++)I[b-1-B]=this._geometries[B].reverse();return this.getFactory().createMultiLineString(I)},h.prototype.getBoundary=function(){return new Cl(this).getBoundary()},h.prototype.getGeometryType=function(){return"MultiLineString"},h.prototype.copy=function(){for(var b=new Array(this._geometries.length).fill(null),I=0;I<b.length;I++)b[I]=this._geometries[I].copy();return new h(b,this._factory)},h.prototype.interfaces_=function(){return[Qr]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(h,y),h}(Vi),Cl=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var l=arguments[0],h=mr.MOD2_BOUNDARY_RULE;this._geom=l,this._geomFact=l.getFactory(),this._bnRule=h}else if(2===arguments.length){var y=arguments[0],b=arguments[1];this._geom=y,this._geomFact=y.getFactory(),this._bnRule=b}};Cl.prototype.boundaryMultiLineString=function(l){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var h=this.computeBoundaryCoordinates(l);return 1===h.length?this._geomFact.createPoint(h[0]):this._geomFact.createMultiPointFromCoords(h)},Cl.prototype.getBoundary=function(){return this._geom instanceof vi?this.boundaryLineString(this._geom):this._geom instanceof Bl?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},Cl.prototype.boundaryLineString=function(l){return this._geom.isEmpty()?this.getEmptyMultiPoint():l.isClosed()?this._bnRule.isInBoundary(2)?l.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([l.getStartPoint(),l.getEndPoint()])},Cl.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},Cl.prototype.computeBoundaryCoordinates=function(l){var h=new Oe;this._endpointMap=new Dt;for(var y=0;y<l.getNumGeometries();y++){var b=l.getGeometryN(y);0!==b.getNumPoints()&&(this.addEndpoint(b.getCoordinateN(0)),this.addEndpoint(b.getCoordinateN(b.getNumPoints()-1)))}for(var I=this._endpointMap.entrySet().iterator();I.hasNext();){var B=I.next(),j=B.getValue().count;this._bnRule.isInBoundary(j)&&h.add(B.getKey())}return Qe.toCoordinateArray(h)},Cl.prototype.addEndpoint=function(l){var h=this._endpointMap.get(l);null===h&&(h=new zl,this._endpointMap.put(l,h)),h.count++},Cl.prototype.interfaces_=function(){return[]},Cl.prototype.getClass=function(){return Cl},Cl.getBoundary=function(){return 1===arguments.length?new Cl(arguments[0]).getBoundary():2===arguments.length?new Cl(arguments[0],arguments[1]).getBoundary():void 0};var zl=function(){this.count=null};zl.prototype.interfaces_=function(){return[]},zl.prototype.getClass=function(){return zl};var Hr=function(){},Ps={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Hr.prototype.interfaces_=function(){return[]},Hr.prototype.getClass=function(){return Hr},Hr.chars=function(l,h){for(var y=new Array(h).fill(null),b=0;b<h;b++)y[b]=l;return String(y)},Hr.getStackTrace=function(){if(1===arguments.length){var l=arguments[0],h=new function(){},y=new function(){}(h);return l.printStackTrace(y),h.toString()}if(2===arguments.length){for(var I=arguments[1],B="",j=new function(){}(new function(){}(Hr.getStackTrace(arguments[0]))),oe=0;oe<I;oe++)try{B+=j.readLine()+Hr.NEWLINE}catch(Pe){if(!(Pe instanceof hn))throw Pe;J.shouldNeverReachHere()}return B}},Hr.split=function(l,h){for(var y=h.length,b=new Oe,I=""+l,B=I.indexOf(h);B>=0;){var j=I.substring(0,B);b.add(j),B=(I=I.substring(B+y)).indexOf(h)}I.length>0&&b.add(I);for(var oe=new Array(b.size()).fill(null),Pe=0;Pe<oe.length;Pe++)oe[Pe]=b.get(Pe);return oe},Hr.toString=function(){if(1===arguments.length)return Hr.SIMPLE_ORDINATE_FORMAT.format(arguments[0])},Hr.spaces=function(l){return Hr.chars(" ",l)},Ps.NEWLINE.get=function(){return gn.getProperty("line.separator")},Ps.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}("0.#")},Object.defineProperties(Hr,Ps);var Fi=function(){};Fi.prototype.interfaces_=function(){return[]},Fi.prototype.getClass=function(){return Fi},Fi.copyCoord=function(l,h,y,b){for(var I=Math.min(l.getDimension(),y.getDimension()),B=0;B<I;B++)y.setOrdinate(b,B,l.getOrdinate(h,B))},Fi.isRing=function(l){var h=l.size();return 0===h||!(h<=3)&&l.getOrdinate(0,Mt.X)===l.getOrdinate(h-1,Mt.X)&&l.getOrdinate(0,Mt.Y)===l.getOrdinate(h-1,Mt.Y)},Fi.isEqual=function(l,h){var y=l.size();if(y!==h.size())return!1;for(var b=Math.min(l.getDimension(),h.getDimension()),I=0;I<y;I++)for(var B=0;B<b;B++){var j=l.getOrdinate(I,B),oe=h.getOrdinate(I,B);if(!(l.getOrdinate(I,B)===h.getOrdinate(I,B)||he.isNaN(j)&&he.isNaN(oe)))return!1}return!0},Fi.extend=function(l,h,y){var b=l.create(y,h.getDimension()),I=h.size();if(Fi.copy(h,0,b,0,I),I>0)for(var B=I;B<y;B++)Fi.copy(h,I-1,b,B,1);return b},Fi.reverse=function(l){for(var h=l.size()-1,y=Math.trunc(h/2),b=0;b<=y;b++)Fi.swap(l,b,h-b)},Fi.swap=function(l,h,y){if(h===y)return null;for(var b=0;b<l.getDimension();b++){var I=l.getOrdinate(h,b);l.setOrdinate(h,b,l.getOrdinate(y,b)),l.setOrdinate(y,b,I)}},Fi.copy=function(l,h,y,b,I){for(var B=0;B<I;B++)Fi.copyCoord(l,h+B,y,b+B)},Fi.toString=function(){if(1===arguments.length){var l=arguments[0],h=l.size();if(0===h)return"()";var y=l.getDimension(),b=new Ae;b.append("(");for(var I=0;I<h;I++){I>0&&b.append(" ");for(var B=0;B<y;B++)B>0&&b.append(","),b.append(Hr.toString(l.getOrdinate(I,B)))}return b.append(")"),b.toString()}},Fi.ensureValidRing=function(l,h){var y=h.size();return 0===y?h:y<=3?Fi.createClosedRing(l,h,4):h.getOrdinate(0,Mt.X)===h.getOrdinate(y-1,Mt.X)&&h.getOrdinate(0,Mt.Y)===h.getOrdinate(y-1,Mt.Y)?h:Fi.createClosedRing(l,h,y+1)},Fi.createClosedRing=function(l,h,y){var b=l.create(y,h.getDimension()),I=h.size();Fi.copy(h,0,b,0,I);for(var B=I;B<y;B++)Fi.copy(h,0,b,B,1);return b};var vi=function(l){function h(b,I){l.call(this,I),this._points=null,this.init(b)}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new un:this._points.expandEnvelope(new un)},h.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},h.prototype.getSortIndex=function(){return l.SORTINDEX_LINESTRING},h.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},h.prototype.equalsExact=function(){if(2===arguments.length){var b=arguments[0],I=arguments[1];if(!this.isEquivalentClass(b))return!1;var B=b;if(this._points.size()!==B._points.size())return!1;for(var j=0;j<this._points.size();j++)if(!this.equal(this._points.getCoordinate(j),B._points.getCoordinate(j),I))return!1;return!0}return l.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){for(var b=0;b<Math.trunc(this._points.size()/2);b++){var I=this._points.size()-1-b;if(!this._points.getCoordinate(b).equals(this._points.getCoordinate(I)))return this._points.getCoordinate(b).compareTo(this._points.getCoordinate(I))>0&&Fi.reverse(this._points),null}},h.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},h.prototype.getBoundaryDimension=function(){return this.isClosed()?Br.FALSE:0},h.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},h.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},h.prototype.getDimension=function(){return 1},h.prototype.getLength=function(){return Ot.computeLength(this._points)},h.prototype.getNumPoints=function(){return this._points.size()},h.prototype.reverse=function(){var b=this._points.copy();return Fi.reverse(b),this.getFactory().createLineString(b)},h.prototype.compareToSameClass=function(){if(1===arguments.length){for(var b=arguments[0],I=0,B=0;I<this._points.size()&&B<b._points.size();){var j=this._points.getCoordinate(I).compareTo(b._points.getCoordinate(B));if(0!==j)return j;I++,B++}return I<this._points.size()?1:B<b._points.size()?-1:0}if(2===arguments.length)return arguments[1].compare(this._points,arguments[0]._points)},h.prototype.apply=function(){if(At(arguments[0],Fr))for(var b=arguments[0],I=0;I<this._points.size();I++)b.filter(this._points.getCoordinate(I));else if(At(arguments[0],To)){var B=arguments[0];if(0===this._points.size())return null;for(var j=0;j<this._points.size()&&(B.filter(this._points,j),!B.isDone());j++);B.isGeometryChanged()&&this.geometryChanged()}else(At(arguments[0],$s)||At(arguments[0],_r))&&arguments[0].filter(this)},h.prototype.getBoundary=function(){return new Cl(this).getBoundary()},h.prototype.isEquivalentClass=function(b){return b instanceof h},h.prototype.clone=function(){var b=l.prototype.clone.call(this);return b._points=this._points.clone(),b},h.prototype.getCoordinateN=function(b){return this._points.getCoordinate(b)},h.prototype.getGeometryType=function(){return"LineString"},h.prototype.copy=function(){return new h(this._points.copy(),this._factory)},h.prototype.getCoordinateSequence=function(){return this._points},h.prototype.isEmpty=function(){return 0===this._points.size()},h.prototype.init=function(b){if(null===b&&(b=this.getFactory().getCoordinateSequenceFactory().create([])),1===b.size())throw new fe("Invalid number of points in LineString (found "+b.size()+" - must be 0 or >= 2)");this._points=b},h.prototype.isCoordinate=function(b){for(var I=0;I<this._points.size();I++)if(this._points.getCoordinate(I).equals(b))return!0;return!1},h.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},h.prototype.getPointN=function(b){return this.getFactory().createPoint(this._points.getCoordinate(b))},h.prototype.interfaces_=function(){return[Qr]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(h,y),h}(Sn),Jc=function(){};Jc.prototype.interfaces_=function(){return[]},Jc.prototype.getClass=function(){return Jc};var ps=function(l){function h(b,I){l.call(this,I),this._coordinates=b||null,this.init(this._coordinates)}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new un;var b=new un;return b.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),b},h.prototype.getSortIndex=function(){return l.SORTINDEX_POINT},h.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},h.prototype.equalsExact=function(){if(2===arguments.length){var b=arguments[0],I=arguments[1];return!!this.isEquivalentClass(b)&&(!(!this.isEmpty()||!b.isEmpty())||this.isEmpty()===b.isEmpty()&&this.equal(b.getCoordinate(),this.getCoordinate(),I))}return l.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){},h.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},h.prototype.getBoundaryDimension=function(){return Br.FALSE},h.prototype.getDimension=function(){return 0},h.prototype.getNumPoints=function(){return this.isEmpty()?0:1},h.prototype.reverse=function(){return this.copy()},h.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},h.prototype.compareToSameClass=function(){if(1===arguments.length){var b=arguments[0];return this.getCoordinate().compareTo(b.getCoordinate())}if(2===arguments.length)return arguments[1].compare(this._coordinates,arguments[0]._coordinates)},h.prototype.apply=function(){if(At(arguments[0],Fr)){var b=arguments[0];if(this.isEmpty())return null;b.filter(this.getCoordinate())}else if(At(arguments[0],To)){var I=arguments[0];if(this.isEmpty())return null;I.filter(this._coordinates,0),I.isGeometryChanged()&&this.geometryChanged()}else(At(arguments[0],$s)||At(arguments[0],_r))&&arguments[0].filter(this)},h.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},h.prototype.clone=function(){var b=l.prototype.clone.call(this);return b._coordinates=this._coordinates.clone(),b},h.prototype.getGeometryType=function(){return"Point"},h.prototype.copy=function(){return new h(this._coordinates.copy(),this._factory)},h.prototype.getCoordinateSequence=function(){return this._coordinates},h.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},h.prototype.isEmpty=function(){return 0===this._coordinates.size()},h.prototype.init=function(b){null===b&&(b=this.getFactory().getCoordinateSequenceFactory().create([])),J.isTrue(b.size()<=1),this._coordinates=b},h.prototype.isSimple=function(){return!0},h.prototype.interfaces_=function(){return[Jc]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(h,y),h}(Sn),Na=function(){};Na.prototype.interfaces_=function(){return[]},Na.prototype.getClass=function(){return Na};var qo=function(l){function h(b,I,B){if(l.call(this,B),this._shell=null,this._holes=null,null===b&&(b=this.getFactory().createLinearRing()),null===I&&(I=[]),l.hasNullElements(I))throw new fe("holes must not contain null elements");if(b.isEmpty()&&l.hasNonEmptyElements(I))throw new fe("shell is empty but holes are not");this._shell=b,this._holes=I}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},h.prototype.getSortIndex=function(){return l.SORTINDEX_POLYGON},h.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var b=new Array(this.getNumPoints()).fill(null),I=-1,B=this._shell.getCoordinates(),j=0;j<B.length;j++)b[++I]=B[j];for(var oe=0;oe<this._holes.length;oe++)for(var Pe=this._holes[oe].getCoordinates(),st=0;st<Pe.length;st++)b[++I]=Pe[st];return b},h.prototype.getArea=function(){var b=0;b+=Math.abs(Ot.signedArea(this._shell.getCoordinateSequence()));for(var I=0;I<this._holes.length;I++)b-=Math.abs(Ot.signedArea(this._holes[I].getCoordinateSequence()));return b},h.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing()||null===this._shell||5!==this._shell.getNumPoints())return!1;for(var b=this._shell.getCoordinateSequence(),I=this.getEnvelopeInternal(),B=0;B<5;B++){var j=b.getX(B);if(j!==I.getMinX()&&j!==I.getMaxX())return!1;var oe=b.getY(B);if(oe!==I.getMinY()&&oe!==I.getMaxY())return!1}for(var Pe=b.getX(0),st=b.getY(0),kt=1;kt<=4;kt++){var qt=b.getX(kt),Pn=b.getY(kt);if(qt!==Pe==(Pn!==st))return!1;Pe=qt,st=Pn}return!0},h.prototype.equalsExact=function(){if(2===arguments.length){var b=arguments[0],I=arguments[1];if(!this.isEquivalentClass(b))return!1;var B=b;if(!this._shell.equalsExact(B._shell,I)||this._holes.length!==B._holes.length)return!1;for(var Pe=0;Pe<this._holes.length;Pe++)if(!this._holes[Pe].equalsExact(B._holes[Pe],I))return!1;return!0}return l.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var b=0;b<this._holes.length;b++)this.normalize(this._holes[b],!1);Jr.sort(this._holes)}else if(2===arguments.length){var I=arguments[0],B=arguments[1];if(I.isEmpty())return null;var j=new Array(I.getCoordinates().length-1).fill(null);gn.arraycopy(I.getCoordinates(),0,j,0,j.length);var oe=Qe.minCoordinate(I.getCoordinates());Qe.scroll(j,oe),gn.arraycopy(j,0,I.getCoordinates(),0,j.length),I.getCoordinates()[j.length]=j[0],Ot.isCCW(I.getCoordinates())===B&&Qe.reverse(I.getCoordinates())}},h.prototype.getCoordinate=function(){return this._shell.getCoordinate()},h.prototype.getNumInteriorRing=function(){return this._holes.length},h.prototype.getBoundaryDimension=function(){return 1},h.prototype.getDimension=function(){return 2},h.prototype.getLength=function(){var b=0;b+=this._shell.getLength();for(var I=0;I<this._holes.length;I++)b+=this._holes[I].getLength();return b},h.prototype.getNumPoints=function(){for(var b=this._shell.getNumPoints(),I=0;I<this._holes.length;I++)b+=this._holes[I].getNumPoints();return b},h.prototype.reverse=function(){var b=this.copy();b._shell=this._shell.copy().reverse(),b._holes=new Array(this._holes.length).fill(null);for(var I=0;I<this._holes.length;I++)b._holes[I]=this._holes[I].copy().reverse();return b},h.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},h.prototype.compareToSameClass=function(){if(1===arguments.length)return this._shell.compareToSameClass(arguments[0]._shell);if(2===arguments.length){var oe=arguments[1],Pe=arguments[0],qt=this._shell.compareToSameClass(Pe._shell,oe);if(0!==qt)return qt;for(var Pn=this.getNumInteriorRing(),In=Pe.getNumInteriorRing(),zn=0;zn<Pn&&zn<In;){var tr=this.getInteriorRingN(zn),Mi=Pe.getInteriorRingN(zn),Tn=tr.compareToSameClass(Mi,oe);if(0!==Tn)return Tn;zn++}return zn<Pn?1:zn<In?-1:0}},h.prototype.apply=function(b){if(At(b,Fr)){this._shell.apply(b);for(var I=0;I<this._holes.length;I++)this._holes[I].apply(b)}else if(At(b,To)){if(this._shell.apply(b),!b.isDone())for(var B=0;B<this._holes.length&&(this._holes[B].apply(b),!b.isDone());B++);b.isGeometryChanged()&&this.geometryChanged()}else if(At(b,$s))b.filter(this);else if(At(b,_r)){b.filter(this),this._shell.apply(b);for(var j=0;j<this._holes.length;j++)this._holes[j].apply(b)}},h.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var b=new Array(this._holes.length+1).fill(null);b[0]=this._shell;for(var I=0;I<this._holes.length;I++)b[I+1]=this._holes[I];return b.length<=1?this.getFactory().createLinearRing(b[0].getCoordinateSequence()):this.getFactory().createMultiLineString(b)},h.prototype.clone=function(){var b=l.prototype.clone.call(this);b._shell=this._shell.clone(),b._holes=new Array(this._holes.length).fill(null);for(var I=0;I<this._holes.length;I++)b._holes[I]=this._holes[I].clone();return b},h.prototype.getGeometryType=function(){return"Polygon"},h.prototype.copy=function(){for(var b=this._shell.copy(),I=new Array(this._holes.length).fill(null),B=0;B<I.length;B++)I[B]=this._holes[B].copy();return new h(b,I,this._factory)},h.prototype.getExteriorRing=function(){return this._shell},h.prototype.isEmpty=function(){return this._shell.isEmpty()},h.prototype.getInteriorRingN=function(b){return this._holes[b]},h.prototype.interfaces_=function(){return[Na]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(h,y),h}(Sn),Tu=function(l){function h(){l.apply(this,arguments)}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return Sn.SORTINDEX_MULTIPOINT},h.prototype.isValid=function(){return!0},h.prototype.equalsExact=function(){if(2===arguments.length){var b=arguments[0],I=arguments[1];return!!this.isEquivalentClass(b)&&l.prototype.equalsExact.call(this,b,I)}return l.prototype.equalsExact.apply(this,arguments)},h.prototype.getCoordinate=function(){return 1===arguments.length?this._geometries[arguments[0]].getCoordinate():l.prototype.getCoordinate.apply(this,arguments)},h.prototype.getBoundaryDimension=function(){return Br.FALSE},h.prototype.getDimension=function(){return 0},h.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},h.prototype.getGeometryType=function(){return"MultiPoint"},h.prototype.copy=function(){for(var b=new Array(this._geometries.length).fill(null),I=0;I<b.length;I++)b[I]=this._geometries[I].copy();return new h(b,this._factory)},h.prototype.interfaces_=function(){return[Jc]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(h,y),h}(Vi),Hs=function(l){function h(b,I){b instanceof ie&&I instanceof ur&&(b=I.getCoordinateSequenceFactory().create(b)),l.call(this,b,I),this.validateConstruction()}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var y={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return Sn.SORTINDEX_LINEARRING},h.prototype.getBoundaryDimension=function(){return Br.FALSE},h.prototype.isClosed=function(){return!!this.isEmpty()||l.prototype.isClosed.call(this)},h.prototype.reverse=function(){var b=this._points.copy();return Fi.reverse(b),this.getFactory().createLinearRing(b)},h.prototype.validateConstruction=function(){if(!this.isEmpty()&&!l.prototype.isClosed.call(this))throw new fe("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<h.MINIMUM_VALID_SIZE)throw new fe("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},h.prototype.getGeometryType=function(){return"LinearRing"},h.prototype.copy=function(){return new h(this._points.copy(),this._factory)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},y.MINIMUM_VALID_SIZE.get=function(){return 4},y.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(h,y),h}(vi),da=function(l){function h(){l.apply(this,arguments)}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return Sn.SORTINDEX_MULTIPOLYGON},h.prototype.equalsExact=function(){if(2===arguments.length){var b=arguments[0],I=arguments[1];return!!this.isEquivalentClass(b)&&l.prototype.equalsExact.call(this,b,I)}return l.prototype.equalsExact.apply(this,arguments)},h.prototype.getBoundaryDimension=function(){return 1},h.prototype.getDimension=function(){return 2},h.prototype.reverse=function(){for(var I=new Array(this._geometries.length).fill(null),B=0;B<this._geometries.length;B++)I[B]=this._geometries[B].reverse();return this.getFactory().createMultiPolygon(I)},h.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var b=new Oe,I=0;I<this._geometries.length;I++)for(var B=this._geometries[I].getBoundary(),j=0;j<B.getNumGeometries();j++)b.add(B.getGeometryN(j));var oe=new Array(b.size()).fill(null);return this.getFactory().createMultiLineString(b.toArray(oe))},h.prototype.getGeometryType=function(){return"MultiPolygon"},h.prototype.copy=function(){for(var b=new Array(this._geometries.length).fill(null),I=0;I<b.length;I++)b[I]=this._geometries[I].copy();return new h(b,this._factory)},h.prototype.interfaces_=function(){return[Na]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(h,y),h}(Vi),fa=function(l){this._factory=l||null,this._isUserDataCopied=!1},Wt={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};fa.prototype.setCopyUserData=function(l){this._isUserDataCopied=l},fa.prototype.edit=function(l,h){if(null===l)return null;var y=this.editInternal(l,h);return this._isUserDataCopied&&y.setUserData(l.getUserData()),y},fa.prototype.editInternal=function(l,h){return null===this._factory&&(this._factory=l.getFactory()),l instanceof Vi?this.editGeometryCollection(l,h):l instanceof qo?this.editPolygon(l,h):l instanceof ps||l instanceof vi?h.edit(l,this._factory):(J.shouldNeverReachHere("Unsupported Geometry class: "+l.getClass().getName()),null)},fa.prototype.editGeometryCollection=function(l,h){for(var y=h.edit(l,this._factory),b=new Oe,I=0;I<y.getNumGeometries();I++){var B=this.edit(y.getGeometryN(I),h);null===B||B.isEmpty()||b.add(B)}return y.getClass()===Tu?this._factory.createMultiPoint(b.toArray([])):y.getClass()===Bl?this._factory.createMultiLineString(b.toArray([])):y.getClass()===da?this._factory.createMultiPolygon(b.toArray([])):this._factory.createGeometryCollection(b.toArray([]))},fa.prototype.editPolygon=function(l,h){var y=h.edit(l,this._factory);if(null===y&&(y=this._factory.createPolygon(null)),y.isEmpty())return y;var b=this.edit(y.getExteriorRing(),h);if(null===b||b.isEmpty())return this._factory.createPolygon();for(var I=new Oe,B=0;B<y.getNumInteriorRing();B++){var j=this.edit(y.getInteriorRingN(B),h);null===j||j.isEmpty()||I.add(j)}return this._factory.createPolygon(b,I.toArray([]))},fa.prototype.interfaces_=function(){return[]},fa.prototype.getClass=function(){return fa},fa.GeometryEditorOperation=function(){},Wt.NoOpGeometryOperation.get=function(){return Vl},Wt.CoordinateOperation.get=function(){return gs},Wt.CoordinateSequenceOperation.get=function(){return Bs},Object.defineProperties(fa,Wt);var Vl=function(){};Vl.prototype.edit=function(l,h){return l},Vl.prototype.interfaces_=function(){return[fa.GeometryEditorOperation]},Vl.prototype.getClass=function(){return Vl};var gs=function(){};gs.prototype.edit=function(l,h){var y=this.editCoordinates(l.getCoordinates(),l);return null===y?l:l instanceof Hs?h.createLinearRing(y):l instanceof vi?h.createLineString(y):l instanceof ps?y.length>0?h.createPoint(y[0]):h.createPoint():l},gs.prototype.interfaces_=function(){return[fa.GeometryEditorOperation]},gs.prototype.getClass=function(){return gs};var Bs=function(){};Bs.prototype.edit=function(l,h){return l instanceof Hs?h.createLinearRing(this.edit(l.getCoordinateSequence(),l)):l instanceof vi?h.createLineString(this.edit(l.getCoordinateSequence(),l)):l instanceof ps?h.createPoint(this.edit(l.getCoordinateSequence(),l)):l},Bs.prototype.interfaces_=function(){return[fa.GeometryEditorOperation]},Bs.prototype.getClass=function(){return Bs};var ts=function(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var l=arguments[0];this._coordinates=new Array(l).fill(null);for(var h=0;h<l;h++)this._coordinates[h]=new ie}else if(At(arguments[0],Mt)){var y=arguments[0];if(null===y)return this._coordinates=new Array(0).fill(null),null;this._dimension=y.getDimension(),this._coordinates=new Array(y.size()).fill(null);for(var b=0;b<this._coordinates.length;b++)this._coordinates[b]=y.getCoordinateCopy(b)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var I=arguments[0],B=arguments[1];this._coordinates=I,this._dimension=B,null===I&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var j=arguments[0],oe=arguments[1];this._coordinates=new Array(j).fill(null),this._dimension=oe;for(var Pe=0;Pe<j;Pe++)this._coordinates[Pe]=new ie}},uu={serialVersionUID:{configurable:!0}};ts.prototype.setOrdinate=function(l,h,y){switch(h){case Mt.X:this._coordinates[l].x=y;break;case Mt.Y:this._coordinates[l].y=y;break;case Mt.Z:this._coordinates[l].z=y;break;default:throw new fe("invalid ordinateIndex")}},ts.prototype.size=function(){return this._coordinates.length},ts.prototype.getOrdinate=function(l,h){switch(h){case Mt.X:return this._coordinates[l].x;case Mt.Y:return this._coordinates[l].y;case Mt.Z:return this._coordinates[l].z}return he.NaN},ts.prototype.getCoordinate=function(){if(1===arguments.length)return this._coordinates[arguments[0]];if(2===arguments.length){var h=arguments[0],y=arguments[1];y.x=this._coordinates[h].x,y.y=this._coordinates[h].y,y.z=this._coordinates[h].z}},ts.prototype.getCoordinateCopy=function(l){return new ie(this._coordinates[l])},ts.prototype.getDimension=function(){return this._dimension},ts.prototype.getX=function(l){return this._coordinates[l].x},ts.prototype.clone=function(){for(var l=new Array(this.size()).fill(null),h=0;h<this._coordinates.length;h++)l[h]=this._coordinates[h].clone();return new ts(l,this._dimension)},ts.prototype.expandEnvelope=function(l){for(var h=0;h<this._coordinates.length;h++)l.expandToInclude(this._coordinates[h]);return l},ts.prototype.copy=function(){for(var l=new Array(this.size()).fill(null),h=0;h<this._coordinates.length;h++)l[h]=this._coordinates[h].copy();return new ts(l,this._dimension)},ts.prototype.toString=function(){if(this._coordinates.length>0){var l=new Ae(17*this._coordinates.length);l.append("("),l.append(this._coordinates[0]);for(var h=1;h<this._coordinates.length;h++)l.append(", "),l.append(this._coordinates[h]);return l.append(")"),l.toString()}return"()"},ts.prototype.getY=function(l){return this._coordinates[l].y},ts.prototype.toCoordinateArray=function(){return this._coordinates},ts.prototype.interfaces_=function(){return[Mt,Ee]},ts.prototype.getClass=function(){return ts},uu.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(ts,uu);var Ul=function(){},Ld={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Ul.prototype.readResolve=function(){return Ul.instance()},Ul.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new ts(arguments[0]);if(At(arguments[0],Mt))return new ts(arguments[0])}else if(2===arguments.length){var y=arguments[0],b=arguments[1];return b>3&&(b=3),b<2?new ts(y):new ts(y,b)}},Ul.prototype.interfaces_=function(){return[Ke,Ee]},Ul.prototype.getClass=function(){return Ul},Ul.instance=function(){return Ul.instanceObject},Ld.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},Ld.instanceObject.get=function(){return new Ul},Object.defineProperties(Ul,Ld);var ws=function(l){function h(){l.call(this),this.map_=new Map}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.get=function(y){return this.map_.get(y)||null},h.prototype.put=function(y,b){return this.map_.set(y,b),b},h.prototype.values=function(){for(var y=new Oe,b=this.map_.values(),I=b.next();!I.done;)y.add(I.value),I=b.next();return y},h.prototype.entrySet=function(){var y=new Kr;return this.map_.entries().forEach(function(b){return y.add(b)}),y},h.prototype.size=function(){return this.map_.size()},h}(pn),on=function l(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=l.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof Mr){var h=arguments[0];this._modelType=h,h===l.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var y=arguments[0];this._modelType=l.FIXED,this.setScale(y)}else if(arguments[0]instanceof l){var b=arguments[0];this._modelType=b._modelType,this._scale=b._scale}},Rn={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};on.prototype.equals=function(l){return l instanceof on&&this._modelType===l._modelType&&this._scale===l._scale},on.prototype.compareTo=function(l){var h=l,y=this.getMaximumSignificantDigits(),b=h.getMaximumSignificantDigits();return new it(y).compareTo(new it(b))},on.prototype.getScale=function(){return this._scale},on.prototype.isFloating=function(){return this._modelType===on.FLOATING||this._modelType===on.FLOATING_SINGLE},on.prototype.getType=function(){return this._modelType},on.prototype.toString=function(){var l="UNKNOWN";return this._modelType===on.FLOATING?l="Floating":this._modelType===on.FLOATING_SINGLE?l="Floating-Single":this._modelType===on.FIXED&&(l="Fixed (Scale="+this.getScale()+")"),l},on.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var l=arguments[0];return he.isNaN(l)||this._modelType===on.FLOATING_SINGLE?l:this._modelType===on.FIXED?Math.round(l*this._scale)/this._scale:l}if(arguments[0]instanceof ie){var h=arguments[0];if(this._modelType===on.FLOATING)return null;h.x=this.makePrecise(h.x),h.y=this.makePrecise(h.y)}},on.prototype.getMaximumSignificantDigits=function(){var l=16;return this._modelType===on.FLOATING?l=16:this._modelType===on.FLOATING_SINGLE?l=6:this._modelType===on.FIXED&&(l=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),l},on.prototype.setScale=function(l){this._scale=Math.abs(l)},on.prototype.interfaces_=function(){return[Ee,ce]},on.prototype.getClass=function(){return on},on.mostPrecise=function(l,h){return l.compareTo(h)>=0?l:h},Rn.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},Rn.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(on,Rn);var Mr=function l(h){this._name=h||null,l.nameToTypeMap.put(h,this)},$a={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};Mr.prototype.readResolve=function(){return Mr.nameToTypeMap.get(this._name)},Mr.prototype.toString=function(){return this._name},Mr.prototype.interfaces_=function(){return[Ee]},Mr.prototype.getClass=function(){return Mr},$a.serialVersionUID.get=function(){return-552860263173159e4},$a.nameToTypeMap.get=function(){return new ws},Object.defineProperties(Mr,$a),on.Type=Mr,on.FIXED=new Mr("FIXED"),on.FLOATING=new Mr("FLOATING"),on.FLOATING_SINGLE=new Mr("FLOATING SINGLE");var ur=function l(){this._precisionModel=new on,this._SRID=0,this._coordinateSequenceFactory=l.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?At(arguments[0],Ke)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof on&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},ei={serialVersionUID:{configurable:!0}};ur.prototype.toGeometry=function(l){return l.isNull()?this.createPoint(null):l.getMinX()===l.getMaxX()&&l.getMinY()===l.getMaxY()?this.createPoint(new ie(l.getMinX(),l.getMinY())):l.getMinX()===l.getMaxX()||l.getMinY()===l.getMaxY()?this.createLineString([new ie(l.getMinX(),l.getMinY()),new ie(l.getMaxX(),l.getMaxY())]):this.createPolygon(this.createLinearRing([new ie(l.getMinX(),l.getMinY()),new ie(l.getMinX(),l.getMaxY()),new ie(l.getMaxX(),l.getMaxY()),new ie(l.getMaxX(),l.getMinY()),new ie(l.getMinX(),l.getMinY())]),null)},ur.prototype.createLineString=function(l){return l?l instanceof Array?new vi(this.getCoordinateSequenceFactory().create(l),this):At(l,Mt)?new vi(l,this):void 0:new vi(this.getCoordinateSequenceFactory().create([]),this)},ur.prototype.createMultiLineString=function(){return 0===arguments.length?new Bl(null,this):1===arguments.length?new Bl(arguments[0],this):void 0},ur.prototype.buildGeometry=function(l){for(var h=null,y=!1,b=!1,I=l.iterator();I.hasNext();){var B=I.next(),j=B.getClass();null===h&&(h=j),j!==h&&(y=!0),B.isGeometryCollectionOrDerived()&&(b=!0)}if(null===h)return this.createGeometryCollection();if(y||b)return this.createGeometryCollection(ur.toGeometryArray(l));var oe=l.iterator().next();if(l.size()>1){if(oe instanceof qo)return this.createMultiPolygon(ur.toPolygonArray(l));if(oe instanceof vi)return this.createMultiLineString(ur.toLineStringArray(l));if(oe instanceof ps)return this.createMultiPoint(ur.toPointArray(l));J.shouldNeverReachHere("Unhandled class: "+oe.getClass().getName())}return oe},ur.prototype.createMultiPointFromCoords=function(l){return this.createMultiPoint(null!==l?this.getCoordinateSequenceFactory().create(l):null)},ur.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof ie){var l=arguments[0];return this.createPoint(null!==l?this.getCoordinateSequenceFactory().create([l]):null)}if(At(arguments[0],Mt))return new ps(arguments[0],this)}},ur.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},ur.prototype.createPolygon=function(){if(0===arguments.length)return new qo(null,null,this);if(1===arguments.length){if(At(arguments[0],Mt))return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof Array)return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof Hs)return this.createPolygon(arguments[0],null)}else if(2===arguments.length)return new qo(arguments[0],arguments[1],this)},ur.prototype.getSRID=function(){return this._SRID},ur.prototype.createGeometryCollection=function(){return 0===arguments.length?new Vi(null,this):1===arguments.length?new Vi(arguments[0],this):void 0},ur.prototype.createGeometry=function(l){return new fa(this).edit(l,{edit:function(){if(2===arguments.length)return this._coordinateSequenceFactory.create(arguments[0])}})},ur.prototype.getPrecisionModel=function(){return this._precisionModel},ur.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var l=arguments[0];return this.createLinearRing(null!==l?this.getCoordinateSequenceFactory().create(l):null)}if(At(arguments[0],Mt))return new Hs(arguments[0],this)}},ur.prototype.createMultiPolygon=function(){return 0===arguments.length?new da(null,this):1===arguments.length?new da(arguments[0],this):void 0},ur.prototype.createMultiPoint=function(){if(0===arguments.length)return new Tu(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new Tu(arguments[0],this);if(arguments[0]instanceof Array){var h=arguments[0];return this.createMultiPoint(null!==h?this.getCoordinateSequenceFactory().create(h):null)}if(At(arguments[0],Mt)){var y=arguments[0];if(null===y)return this.createMultiPoint(new Array(0).fill(null));for(var b=new Array(y.size()).fill(null),I=0;I<y.size();I++){var B=this.getCoordinateSequenceFactory().create(1,y.getDimension());Fi.copy(y,I,B,0,1),b[I]=this.createPoint(B)}return this.createMultiPoint(b)}}},ur.prototype.interfaces_=function(){return[Ee]},ur.prototype.getClass=function(){return ur},ur.toMultiPolygonArray=function(l){var h=new Array(l.size()).fill(null);return l.toArray(h)},ur.toGeometryArray=function(l){if(null===l)return null;var h=new Array(l.size()).fill(null);return l.toArray(h)},ur.getDefaultCoordinateSequenceFactory=function(){return Ul.instance()},ur.toMultiLineStringArray=function(l){var h=new Array(l.size()).fill(null);return l.toArray(h)},ur.toLineStringArray=function(l){var h=new Array(l.size()).fill(null);return l.toArray(h)},ur.toMultiPointArray=function(l){var h=new Array(l.size()).fill(null);return l.toArray(h)},ur.toLinearRingArray=function(l){var h=new Array(l.size()).fill(null);return l.toArray(h)},ur.toPointArray=function(l){var h=new Array(l.size()).fill(null);return l.toArray(h)},ur.toPolygonArray=function(l){var h=new Array(l.size()).fill(null);return l.toArray(h)},ur.createPointFromInternalCoord=function(l,h){return h.getPrecisionModel().makePrecise(l),h.getFactory().createPoint(l)},ei.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(ur,ei);var jl=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Ni=function(l){this.geometryFactory=l||new ur};Ni.prototype.read=function(l){var h,y=(h="string"==typeof l?JSON.parse(l):l).type;if(!qs[y])throw new Error("Unknown GeoJSON type: "+h.type);return-1!==jl.indexOf(y)?qs[y].apply(this,[h.coordinates]):qs[y].apply(this,"GeometryCollection"===y?[h.geometries]:[h])},Ni.prototype.write=function(l){var h=l.getGeometryType();if(!xi[h])throw new Error("Geometry is not supported");return xi[h].apply(this,[l])};var qs={Feature:function(l){var h={};for(var y in l)h[y]=l[y];if(l.geometry){if(!qs[l.geometry.type])throw new Error("Unknown GeoJSON type: "+l.type);h.geometry=this.read(l.geometry)}return l.bbox&&(h.bbox=qs.bbox.apply(this,[l.bbox])),h},FeatureCollection:function(l){var h={};if(l.features){h.features=[];for(var y=0;y<l.features.length;++y)h.features.push(this.read(l.features[y]))}return l.bbox&&(h.bbox=this.parse.bbox.apply(this,[l.bbox])),h},coordinates:function(l){for(var h=[],y=0;y<l.length;++y){var b=l[y];h.push(new ie(b[0],b[1]))}return h},bbox:function(l){return this.geometryFactory.createLinearRing([new ie(l[0],l[1]),new ie(l[2],l[1]),new ie(l[2],l[3]),new ie(l[0],l[3]),new ie(l[0],l[1])])},Point:function(l){var h=new ie(l[0],l[1]);return this.geometryFactory.createPoint(h)},MultiPoint:function(l){for(var h=[],y=0;y<l.length;++y)h.push(qs.Point.apply(this,[l[y]]));return this.geometryFactory.createMultiPoint(h)},LineString:function(l){var h=qs.coordinates.apply(this,[l]);return this.geometryFactory.createLineString(h)},MultiLineString:function(l){for(var h=[],y=0;y<l.length;++y)h.push(qs.LineString.apply(this,[l[y]]));return this.geometryFactory.createMultiLineString(h)},Polygon:function(l){for(var h=qs.coordinates.apply(this,[l[0]]),y=this.geometryFactory.createLinearRing(h),b=[],I=1;I<l.length;++I){var j=qs.coordinates.apply(this,[l[I]]),oe=this.geometryFactory.createLinearRing(j);b.push(oe)}return this.geometryFactory.createPolygon(y,b)},MultiPolygon:function(l){for(var h=[],y=0;y<l.length;++y)h.push(qs.Polygon.apply(this,[l[y]]));return this.geometryFactory.createMultiPolygon(h)},GeometryCollection:function(l){for(var h=[],y=0;y<l.length;++y)h.push(this.read(l[y]));return this.geometryFactory.createGeometryCollection(h)}},xi={coordinate:function(l){return[l.x,l.y]},Point:function(l){return{type:"Point",coordinates:xi.coordinate.apply(this,[l.getCoordinate()])}},MultiPoint:function(l){for(var h=[],y=0;y<l._geometries.length;++y){var I=xi.Point.apply(this,[l._geometries[y]]);h.push(I.coordinates)}return{type:"MultiPoint",coordinates:h}},LineString:function(l){for(var h=[],y=l.getCoordinates(),b=0;b<y.length;++b)h.push(xi.coordinate.apply(this,[y[b]]));return{type:"LineString",coordinates:h}},MultiLineString:function(l){for(var h=[],y=0;y<l._geometries.length;++y){var I=xi.LineString.apply(this,[l._geometries[y]]);h.push(I.coordinates)}return{type:"MultiLineString",coordinates:h}},Polygon:function(l){var h=[],y=xi.LineString.apply(this,[l._shell]);h.push(y.coordinates);for(var b=0;b<l._holes.length;++b){var B=xi.LineString.apply(this,[l._holes[b]]);h.push(B.coordinates)}return{type:"Polygon",coordinates:h}},MultiPolygon:function(l){for(var h=[],y=0;y<l._geometries.length;++y){var I=xi.Polygon.apply(this,[l._geometries[y]]);h.push(I.coordinates)}return{type:"MultiPolygon",coordinates:h}},GeometryCollection:function(l){for(var h=[],y=0;y<l._geometries.length;++y){var b=l._geometries[y],I=b.getGeometryType();h.push(xi[I].apply(this,[b]))}return{type:"GeometryCollection",geometries:h}}},Io=function(l){this.geometryFactory=l||new ur,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new Ni(this.geometryFactory)};Io.prototype.read=function(l){var h=this.parser.read(l);return this.precisionModel.getType()===on.FIXED&&this.reducePrecision(h),h},Io.prototype.reducePrecision=function(l){var h,y;if(l.coordinate)this.precisionModel.makePrecise(l.coordinate);else if(l.points)for(h=0,y=l.points.length;h<y;h++)this.precisionModel.makePrecise(l.points[h]);else if(l.geometries)for(h=0,y=l.geometries.length;h<y;h++)this.reducePrecision(l.geometries[h])};var mf=function(){this.parser=new Ni(this.geometryFactory)};mf.prototype.write=function(l){return this.parser.write(l)};var $t=function(){},Rr={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};$t.prototype.interfaces_=function(){return[]},$t.prototype.getClass=function(){return $t},$t.opposite=function(l){return l===$t.LEFT?$t.RIGHT:l===$t.RIGHT?$t.LEFT:l},Rr.ON.get=function(){return 0},Rr.LEFT.get=function(){return 1},Rr.RIGHT.get=function(){return 2},Object.defineProperties($t,Rr),(de.prototype=new Error).name="EmptyStackException",(Ne.prototype=new tt).add=function(l){return this.array_.push(l),!0},Ne.prototype.get=function(l){if(l<0||l>=this.size())throw new Error;return this.array_[l]},Ne.prototype.push=function(l){return this.array_.push(l),l},Ne.prototype.pop=function(l){if(0===this.array_.length)throw new de;return this.array_.pop()},Ne.prototype.peek=function(){if(0===this.array_.length)throw new de;return this.array_[this.array_.length-1]},Ne.prototype.empty=function(){return 0===this.array_.length},Ne.prototype.isEmpty=function(){return this.empty()},Ne.prototype.search=function(l){return this.array_.indexOf(l)},Ne.prototype.size=function(){return this.array_.length},Ne.prototype.toArray=function(){for(var l=[],h=0,y=this.array_.length;h<y;h++)l.push(this.array_[h]);return l};var Pa=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Pa.prototype.getCoordinate=function(){return this._minCoord},Pa.prototype.getRightmostSide=function(l,h){var y=this.getRightmostSideOfSegment(l,h);return y<0&&(y=this.getRightmostSideOfSegment(l,h-1)),y<0&&(this._minCoord=null,this.checkForRightmostCoordinate(l)),y},Pa.prototype.findRightmostEdgeAtVertex=function(){var l=this._minDe.getEdge().getCoordinates();J.isTrue(this._minIndex>0&&this._minIndex<l.length,"rightmost point expected to be interior vertex of edge");var h=l[this._minIndex-1],y=l[this._minIndex+1],b=Ot.computeOrientation(this._minCoord,y,h),I=!1;(h.y<this._minCoord.y&&y.y<this._minCoord.y&&b===Ot.COUNTERCLOCKWISE||h.y>this._minCoord.y&&y.y>this._minCoord.y&&b===Ot.CLOCKWISE)&&(I=!0),I&&(this._minIndex=this._minIndex-1)},Pa.prototype.getRightmostSideOfSegment=function(l,h){var y=l.getEdge().getCoordinates();if(h<0||h+1>=y.length||y[h].y===y[h+1].y)return-1;var b=$t.LEFT;return y[h].y<y[h+1].y&&(b=$t.RIGHT),b},Pa.prototype.getEdge=function(){return this._orientedDe},Pa.prototype.checkForRightmostCoordinate=function(l){for(var h=l.getEdge().getCoordinates(),y=0;y<h.length-1;y++)(null===this._minCoord||h[y].x>this._minCoord.x)&&(this._minDe=l,this._minIndex=y,this._minCoord=h[y])},Pa.prototype.findRightmostEdgeAtNode=function(){var l=this._minDe.getNode().getEdges();this._minDe=l.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},Pa.prototype.findEdge=function(l){for(var h=l.iterator();h.hasNext();){var y=h.next();y.isForward()&&this.checkForRightmostCoordinate(y)}J.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===$t.LEFT&&(this._orientedDe=this._minDe.getSym())},Pa.prototype.interfaces_=function(){return[]},Pa.prototype.getClass=function(){return Pa};var Sl=function(l){function h(y,b){l.call(this,h.msgWithCoord(y,b)),this.pt=b?new ie(b):null,this.name="TopologyException"}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getCoordinate=function(){return this.pt},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.msgWithCoord=function(y,b){return b?y:y+" [ "+b+" ]"},h}(Z),kd=function(){this.array_=[]};kd.prototype.addLast=function(l){this.array_.push(l)},kd.prototype.removeFirst=function(){return this.array_.shift()},kd.prototype.isEmpty=function(){return 0===this.array_.length};var Rs=function(){this._finder=null,this._dirEdgeList=new Oe,this._nodes=new Oe,this._rightMostCoord=null,this._env=null,this._finder=new Pa};Rs.prototype.clearVisitedEdges=function(){for(var l=this._dirEdgeList.iterator();l.hasNext();)l.next().setVisited(!1)},Rs.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},Rs.prototype.computeNodeDepth=function(l){for(var h=null,y=l.getEdges().iterator();y.hasNext();){var b=y.next();if(b.isVisited()||b.getSym().isVisited()){h=b;break}}if(null===h)throw new Sl("unable to find edge to compute depths at "+l.getCoordinate());l.getEdges().computeDepths(h);for(var I=l.getEdges().iterator();I.hasNext();){var B=I.next();B.setVisited(!0),this.copySymDepths(B)}},Rs.prototype.computeDepth=function(l){this.clearVisitedEdges();var h=this._finder.getEdge();h.setEdgeDepths($t.RIGHT,l),this.copySymDepths(h),this.computeDepths(h)},Rs.prototype.create=function(l){this.addReachable(l),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},Rs.prototype.findResultEdges=function(){for(var l=this._dirEdgeList.iterator();l.hasNext();){var h=l.next();h.getDepth($t.RIGHT)>=1&&h.getDepth($t.LEFT)<=0&&!h.isInteriorAreaEdge()&&h.setInResult(!0)}},Rs.prototype.computeDepths=function(l){var h=new Kr,y=new kd,b=l.getNode();for(y.addLast(b),h.add(b),l.setVisited(!0);!y.isEmpty();){var I=y.removeFirst();h.add(I),this.computeNodeDepth(I);for(var B=I.getEdges().iterator();B.hasNext();){var j=B.next().getSym();if(!j.isVisited()){var oe=j.getNode();h.contains(oe)||(y.addLast(oe),h.add(oe))}}}},Rs.prototype.compareTo=function(l){return this._rightMostCoord.x<l._rightMostCoord.x?-1:this._rightMostCoord.x>l._rightMostCoord.x?1:0},Rs.prototype.getEnvelope=function(){if(null===this._env){for(var l=new un,h=this._dirEdgeList.iterator();h.hasNext();)for(var y=h.next().getEdge().getCoordinates(),b=0;b<y.length-1;b++)l.expandToInclude(y[b]);this._env=l}return this._env},Rs.prototype.addReachable=function(l){var h=new Ne;for(h.add(l);!h.empty();){var y=h.pop();this.add(y,h)}},Rs.prototype.copySymDepths=function(l){var h=l.getSym();h.setDepth($t.LEFT,l.getDepth($t.RIGHT)),h.setDepth($t.RIGHT,l.getDepth($t.LEFT))},Rs.prototype.add=function(l,h){l.setVisited(!0),this._nodes.add(l);for(var y=l.getEdges().iterator();y.hasNext();){var b=y.next();this._dirEdgeList.add(b);var I=b.getSym().getNode();I.isVisited()||h.push(I)}},Rs.prototype.getNodes=function(){return this._nodes},Rs.prototype.getDirectedEdges=function(){return this._dirEdgeList},Rs.prototype.interfaces_=function(){return[ce]},Rs.prototype.getClass=function(){return Rs};var en=function l(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array)this.init(arguments[0].length);else if(Number.isInteger(arguments[0])){var y=arguments[0];this.init(1),this.location[$t.ON]=y}else if(arguments[0]instanceof l){var b=arguments[0];if(this.init(b.location.length),null!==b)for(var I=0;I<this.location.length;I++)this.location[I]=b.location[I]}}else if(3===arguments.length){var B=arguments[0],j=arguments[1],oe=arguments[2];this.init(3),this.location[$t.ON]=B,this.location[$t.LEFT]=j,this.location[$t.RIGHT]=oe}};en.prototype.setAllLocations=function(l){for(var h=0;h<this.location.length;h++)this.location[h]=l},en.prototype.isNull=function(){for(var l=0;l<this.location.length;l++)if(this.location[l]!==Te.NONE)return!1;return!0},en.prototype.setAllLocationsIfNull=function(l){for(var h=0;h<this.location.length;h++)this.location[h]===Te.NONE&&(this.location[h]=l)},en.prototype.isLine=function(){return 1===this.location.length},en.prototype.merge=function(l){if(l.location.length>this.location.length){var h=new Array(3).fill(null);h[$t.ON]=this.location[$t.ON],h[$t.LEFT]=Te.NONE,h[$t.RIGHT]=Te.NONE,this.location=h}for(var y=0;y<this.location.length;y++)this.location[y]===Te.NONE&&y<l.location.length&&(this.location[y]=l.location[y])},en.prototype.getLocations=function(){return this.location},en.prototype.flip=function(){if(this.location.length<=1)return null;var l=this.location[$t.LEFT];this.location[$t.LEFT]=this.location[$t.RIGHT],this.location[$t.RIGHT]=l},en.prototype.toString=function(){var l=new Ae;return this.location.length>1&&l.append(Te.toLocationSymbol(this.location[$t.LEFT])),l.append(Te.toLocationSymbol(this.location[$t.ON])),this.location.length>1&&l.append(Te.toLocationSymbol(this.location[$t.RIGHT])),l.toString()},en.prototype.setLocations=function(l,h,y){this.location[$t.ON]=l,this.location[$t.LEFT]=h,this.location[$t.RIGHT]=y},en.prototype.get=function(l){return l<this.location.length?this.location[l]:Te.NONE},en.prototype.isArea=function(){return this.location.length>1},en.prototype.isAnyNull=function(){for(var l=0;l<this.location.length;l++)if(this.location[l]===Te.NONE)return!0;return!1},en.prototype.setLocation=function(){1===arguments.length?this.setLocation($t.ON,arguments[0]):2===arguments.length&&(this.location[arguments[0]]=arguments[1])},en.prototype.init=function(l){this.location=new Array(l).fill(null),this.setAllLocations(Te.NONE)},en.prototype.isEqualOnSide=function(l,h){return this.location[h]===l.location[h]},en.prototype.allPositionsEqual=function(l){for(var h=0;h<this.location.length;h++)if(this.location[h]!==l)return!1;return!0},en.prototype.interfaces_=function(){return[]},en.prototype.getClass=function(){return en};var di=function l(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var h=arguments[0];this.elt[0]=new en(h),this.elt[1]=new en(h)}else if(arguments[0]instanceof l){var y=arguments[0];this.elt[0]=new en(y.elt[0]),this.elt[1]=new en(y.elt[1])}}else if(2===arguments.length){var b=arguments[0],I=arguments[1];this.elt[0]=new en(Te.NONE),this.elt[1]=new en(Te.NONE),this.elt[b].setLocation(I)}else if(3===arguments.length){var B=arguments[0],j=arguments[1],oe=arguments[2];this.elt[0]=new en(B,j,oe),this.elt[1]=new en(B,j,oe)}else if(4===arguments.length){var Pe=arguments[0],st=arguments[1],kt=arguments[2],qt=arguments[3];this.elt[0]=new en(Te.NONE,Te.NONE,Te.NONE),this.elt[1]=new en(Te.NONE,Te.NONE,Te.NONE),this.elt[Pe].setLocations(st,kt,qt)}};di.prototype.getGeometryCount=function(){var l=0;return this.elt[0].isNull()||l++,this.elt[1].isNull()||l++,l},di.prototype.setAllLocations=function(l,h){this.elt[l].setAllLocations(h)},di.prototype.isNull=function(l){return this.elt[l].isNull()},di.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var l=arguments[0];this.setAllLocationsIfNull(0,l),this.setAllLocationsIfNull(1,l)}else 2===arguments.length&&this.elt[arguments[0]].setAllLocationsIfNull(arguments[1])},di.prototype.isLine=function(l){return this.elt[l].isLine()},di.prototype.merge=function(l){for(var h=0;h<2;h++)null===this.elt[h]&&null!==l.elt[h]?this.elt[h]=new en(l.elt[h]):this.elt[h].merge(l.elt[h])},di.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},di.prototype.getLocation=function(){return 1===arguments.length?this.elt[arguments[0]].get($t.ON):2===arguments.length?this.elt[arguments[0]].get(arguments[1]):void 0},di.prototype.toString=function(){var l=new Ae;return null!==this.elt[0]&&(l.append("A:"),l.append(this.elt[0].toString())),null!==this.elt[1]&&(l.append(" B:"),l.append(this.elt[1].toString())),l.toString()},di.prototype.isArea=function(){return 0===arguments.length?this.elt[0].isArea()||this.elt[1].isArea():1===arguments.length?this.elt[arguments[0]].isArea():void 0},di.prototype.isAnyNull=function(l){return this.elt[l].isAnyNull()},di.prototype.setLocation=function(){2===arguments.length?this.elt[arguments[0]].setLocation($t.ON,arguments[1]):3===arguments.length&&this.elt[arguments[0]].setLocation(arguments[1],arguments[2])},di.prototype.isEqualOnSide=function(l,h){return this.elt[0].isEqualOnSide(l.elt[0],h)&&this.elt[1].isEqualOnSide(l.elt[1],h)},di.prototype.allPositionsEqual=function(l,h){return this.elt[l].allPositionsEqual(h)},di.prototype.toLine=function(l){this.elt[l].isArea()&&(this.elt[l]=new en(this.elt[l].location[0]))},di.prototype.interfaces_=function(){return[]},di.prototype.getClass=function(){return di},di.toLineLabel=function(l){for(var h=new di(Te.NONE),y=0;y<2;y++)h.setLocation(y,l.getLocation(y));return h};var Yn=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new Oe,this._pts=new Oe,this._label=new di(Te.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Oe,this._geometryFactory=null;var l=arguments[0];this._geometryFactory=arguments[1],this.computePoints(l),this.computeRing()};Yn.prototype.computeRing=function(){if(null!==this._ring)return null;for(var l=new Array(this._pts.size()).fill(null),h=0;h<this._pts.size();h++)l[h]=this._pts.get(h);this._ring=this._geometryFactory.createLinearRing(l),this._isHole=Ot.isCCW(this._ring.getCoordinates())},Yn.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},Yn.prototype.computePoints=function(l){this._startDe=l;var h=l,y=!0;do{if(null===h)throw new Sl("Found null DirectedEdge");if(h.getEdgeRing()===this)throw new Sl("Directed Edge visited twice during ring-building at "+h.getCoordinate());this._edges.add(h);var b=h.getLabel();J.isTrue(b.isArea()),this.mergeLabel(b),this.addPoints(h.getEdge(),h.isForward(),y),y=!1,this.setEdgeRing(h,this),h=this.getNext(h)}while(h!==this._startDe)},Yn.prototype.getLinearRing=function(){return this._ring},Yn.prototype.getCoordinate=function(l){return this._pts.get(l)},Yn.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var l=this._startDe;do{var h=l.getNode().getEdges().getOutgoingDegree(this);h>this._maxNodeDegree&&(this._maxNodeDegree=h),l=this.getNext(l)}while(l!==this._startDe);this._maxNodeDegree*=2},Yn.prototype.addPoints=function(l,h,y){var b=l.getCoordinates();if(h){var I=1;y&&(I=0);for(var B=I;B<b.length;B++)this._pts.add(b[B])}else{var j=b.length-2;y&&(j=b.length-1);for(var oe=j;oe>=0;oe--)this._pts.add(b[oe])}},Yn.prototype.isHole=function(){return this._isHole},Yn.prototype.setInResult=function(){var l=this._startDe;do{l.getEdge().setInResult(!0),l=l.getNext()}while(l!==this._startDe)},Yn.prototype.containsPoint=function(l){var h=this.getLinearRing();if(!h.getEnvelopeInternal().contains(l)||!Ot.isPointInRing(l,h.getCoordinates()))return!1;for(var y=this._holes.iterator();y.hasNext();)if(y.next().containsPoint(l))return!1;return!0},Yn.prototype.addHole=function(l){this._holes.add(l)},Yn.prototype.isShell=function(){return null===this._shell},Yn.prototype.getLabel=function(){return this._label},Yn.prototype.getEdges=function(){return this._edges},Yn.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},Yn.prototype.getShell=function(){return this._shell},Yn.prototype.mergeLabel=function(){if(1===arguments.length){var l=arguments[0];this.mergeLabel(l,0),this.mergeLabel(l,1)}else if(2===arguments.length){var y=arguments[1],b=arguments[0].getLocation(y,$t.RIGHT);if(b===Te.NONE)return null;if(this._label.getLocation(y)===Te.NONE)return this._label.setLocation(y,b),null}},Yn.prototype.setShell=function(l){this._shell=l,null!==l&&l.addHole(this)},Yn.prototype.toPolygon=function(l){for(var h=new Array(this._holes.size()).fill(null),y=0;y<this._holes.size();y++)h[y]=this._holes.get(y).getLinearRing();return l.createPolygon(this.getLinearRing(),h)},Yn.prototype.interfaces_=function(){return[]},Yn.prototype.getClass=function(){return Yn};var si=function(l){function h(){l.call(this,arguments[0],arguments[1])}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.setEdgeRing=function(y,b){y.setMinEdgeRing(b)},h.prototype.getNext=function(y){return y.getNextMin()},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Yn),zs=function(l){function h(){l.call(this,arguments[0],arguments[1])}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.buildMinimalRings=function(){var y=new Oe,b=this._startDe;do{if(null===b.getMinEdgeRing()){var I=new si(b,this._geometryFactory);y.add(I)}b=b.getNext()}while(b!==this._startDe);return y},h.prototype.setEdgeRing=function(y,b){y.setEdgeRing(b)},h.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var y=this._startDe;do{y.getNode().getEdges().linkMinimalDirectedEdges(this),y=y.getNext()}while(y!==this._startDe)},h.prototype.getNext=function(y){return y.getNext()},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Yn),el=function(){this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0!==arguments.length&&1===arguments.length&&(this._label=arguments[0])};el.prototype.setVisited=function(l){this._isVisited=l},el.prototype.setInResult=function(l){this._isInResult=l},el.prototype.isCovered=function(){return this._isCovered},el.prototype.isCoveredSet=function(){return this._isCoveredSet},el.prototype.setLabel=function(l){this._label=l},el.prototype.getLabel=function(){return this._label},el.prototype.setCovered=function(l){this._isCovered=l,this._isCoveredSet=!0},el.prototype.updateIM=function(l){J.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(l)},el.prototype.isInResult=function(){return this._isInResult},el.prototype.isVisited=function(){return this._isVisited},el.prototype.interfaces_=function(){return[]},el.prototype.getClass=function(){return el};var Eh=function(l){function h(){l.call(this),this._coord=null,this._edges=null;var b=arguments[1];this._coord=arguments[0],this._edges=b,this._label=new di(0,Te.NONE)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.isIncidentEdgeInResult=function(){for(var y=this.getEdges().getEdges().iterator();y.hasNext();)if(y.next().getEdge().isInResult())return!0;return!1},h.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},h.prototype.getCoordinate=function(){return this._coord},h.prototype.print=function(y){y.println("node "+this._coord+" lbl: "+this._label)},h.prototype.computeIM=function(y){},h.prototype.computeMergedLocation=function(y,b){var I=Te.NONE;if(I=this._label.getLocation(b),!y.isNull(b)){var B=y.getLocation(b);I!==Te.BOUNDARY&&(I=B)}return I},h.prototype.setLabel=function(){if(2!==arguments.length)return l.prototype.setLabel.apply(this,arguments);var y=arguments[0],b=arguments[1];null===this._label?this._label=new di(y,b):this._label.setLocation(y,b)},h.prototype.getEdges=function(){return this._edges},h.prototype.mergeLabel=function(){if(arguments[0]instanceof h)this.mergeLabel(arguments[0]._label);else if(arguments[0]instanceof di)for(var b=arguments[0],I=0;I<2;I++){var B=this.computeMergedLocation(b,I);this._label.getLocation(I)===Te.NONE&&this._label.setLocation(I,B)}},h.prototype.add=function(y){this._edges.insert(y),y.setNode(this)},h.prototype.setLabelBoundary=function(y){if(null===this._label)return null;var b=Te.NONE;null!==this._label&&(b=this._label.getLocation(y)),this._label.setLocation(y,b===Te.BOUNDARY?Te.INTERIOR:Te.BOUNDARY)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(el),zo=function(){this.nodeMap=new Dt,this.nodeFact=null,this.nodeFact=arguments[0]};zo.prototype.find=function(l){return this.nodeMap.get(l)},zo.prototype.addNode=function(){if(arguments[0]instanceof ie){var l=arguments[0],h=this.nodeMap.get(l);return null===h&&(h=this.nodeFact.createNode(l),this.nodeMap.put(l,h)),h}if(arguments[0]instanceof Eh){var y=arguments[0],b=this.nodeMap.get(y.getCoordinate());return null===b?(this.nodeMap.put(y.getCoordinate(),y),y):(b.mergeLabel(y),b)}},zo.prototype.print=function(l){for(var h=this.iterator();h.hasNext();)h.next().print(l)},zo.prototype.iterator=function(){return this.nodeMap.values().iterator()},zo.prototype.values=function(){return this.nodeMap.values()},zo.prototype.getBoundaryNodes=function(l){for(var h=new Oe,y=this.iterator();y.hasNext();){var b=y.next();b.getLabel().getLocation(l)===Te.BOUNDARY&&h.add(b)}return h},zo.prototype.add=function(l){var h=l.getCoordinate();this.addNode(h).add(l)},zo.prototype.interfaces_=function(){return[]},zo.prototype.getClass=function(){return zo};var Sr=function(){},Kh={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Sr.prototype.interfaces_=function(){return[]},Sr.prototype.getClass=function(){return Sr},Sr.isNorthern=function(l){return l===Sr.NE||l===Sr.NW},Sr.isOpposite=function(l,h){return l!==h&&(l-h+4)%4==2},Sr.commonHalfPlane=function(l,h){if(l===h)return l;if((l-h+4)%4==2)return-1;var y=l<h?l:h;return 0===y&&3===(l>h?l:h)?3:y},Sr.isInHalfPlane=function(l,h){return h===Sr.SE?l===Sr.SE||l===Sr.SW:l===h||l===h+1},Sr.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var l=arguments[0],h=arguments[1];if(0===l&&0===h)throw new fe("Cannot compute the quadrant for point ( "+l+", "+h+" )");return l>=0?h>=0?Sr.NE:Sr.SE:h>=0?Sr.NW:Sr.SW}if(arguments[0]instanceof ie&&arguments[1]instanceof ie){var y=arguments[0],b=arguments[1];if(b.x===y.x&&b.y===y.y)throw new fe("Cannot compute the quadrant for two identical points "+y);return b.x>=y.x?b.y>=y.y?Sr.NE:Sr.SE:b.y>=y.y?Sr.NW:Sr.SW}},Kh.NE.get=function(){return 0},Kh.NW.get=function(){return 1},Kh.SW.get=function(){return 2},Kh.SE.get=function(){return 3},Object.defineProperties(Sr,Kh);var Os=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length)this._edge=arguments[0];else if(3===arguments.length){var y=arguments[1],b=arguments[2];this._edge=arguments[0],this.init(y,b),this._label=null}else if(4===arguments.length){var B=arguments[1],j=arguments[2],oe=arguments[3];this._edge=arguments[0],this.init(B,j),this._label=oe}};Os.prototype.compareDirection=function(l){return this._dx===l._dx&&this._dy===l._dy?0:this._quadrant>l._quadrant?1:this._quadrant<l._quadrant?-1:Ot.computeOrientation(l._p0,l._p1,this._p1)},Os.prototype.getDy=function(){return this._dy},Os.prototype.getCoordinate=function(){return this._p0},Os.prototype.setNode=function(l){this._node=l},Os.prototype.print=function(l){var h=Math.atan2(this._dy,this._dx),y=this.getClass().getName(),b=y.lastIndexOf("."),I=y.substring(b+1);l.print("  "+I+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+h+"   "+this._label)},Os.prototype.compareTo=function(l){return this.compareDirection(l)},Os.prototype.getDirectedCoordinate=function(){return this._p1},Os.prototype.getDx=function(){return this._dx},Os.prototype.getLabel=function(){return this._label},Os.prototype.getEdge=function(){return this._edge},Os.prototype.getQuadrant=function(){return this._quadrant},Os.prototype.getNode=function(){return this._node},Os.prototype.toString=function(){var l=Math.atan2(this._dy,this._dx),h=this.getClass().getName(),y=h.lastIndexOf(".");return"  "+h.substring(y+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+l+"   "+this._label},Os.prototype.computeLabel=function(l){},Os.prototype.init=function(l,h){this._p0=l,this._p1=h,this._dx=h.x-l.x,this._dy=h.y-l.y,this._quadrant=Sr.quadrant(this._dx,this._dy),J.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},Os.prototype.interfaces_=function(){return[ce]},Os.prototype.getClass=function(){return Os};var Es=function(l){function h(){var y=arguments[0],b=arguments[1];if(l.call(this,y),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=b,b)this.init(y.getCoordinate(0),y.getCoordinate(1));else{var I=y.getNumPoints()-1;this.init(y.getCoordinate(I),y.getCoordinate(I-1))}this.computeDirectedLabel()}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getNextMin=function(){return this._nextMin},h.prototype.getDepth=function(y){return this._depth[y]},h.prototype.setVisited=function(y){this._isVisited=y},h.prototype.computeDirectedLabel=function(){this._label=new di(this._edge.getLabel()),this._isForward||this._label.flip()},h.prototype.getNext=function(){return this._next},h.prototype.setDepth=function(y,b){if(-999!==this._depth[y]&&this._depth[y]!==b)throw new Sl("assigned depths do not match",this.getCoordinate());this._depth[y]=b},h.prototype.isInteriorAreaEdge=function(){for(var y=!0,b=0;b<2;b++)this._label.isArea(b)&&this._label.getLocation(b,$t.LEFT)===Te.INTERIOR&&this._label.getLocation(b,$t.RIGHT)===Te.INTERIOR||(y=!1);return y},h.prototype.setNextMin=function(y){this._nextMin=y},h.prototype.print=function(y){l.prototype.print.call(this,y),y.print(" "+this._depth[$t.LEFT]+"/"+this._depth[$t.RIGHT]),y.print(" ("+this.getDepthDelta()+")"),this._isInResult&&y.print(" inResult")},h.prototype.setMinEdgeRing=function(y){this._minEdgeRing=y},h.prototype.isLineEdge=function(){var y=this._label.isLine(0)||this._label.isLine(1),b=!this._label.isArea(0)||this._label.allPositionsEqual(0,Te.EXTERIOR),I=!this._label.isArea(1)||this._label.allPositionsEqual(1,Te.EXTERIOR);return y&&b&&I},h.prototype.setEdgeRing=function(y){this._edgeRing=y},h.prototype.getMinEdgeRing=function(){return this._minEdgeRing},h.prototype.getDepthDelta=function(){var y=this._edge.getDepthDelta();return this._isForward||(y=-y),y},h.prototype.setInResult=function(y){this._isInResult=y},h.prototype.getSym=function(){return this._sym},h.prototype.isForward=function(){return this._isForward},h.prototype.getEdge=function(){return this._edge},h.prototype.printEdge=function(y){this.print(y),y.print(" "),this._isForward?this._edge.print(y):this._edge.printReverse(y)},h.prototype.setSym=function(y){this._sym=y},h.prototype.setVisitedEdge=function(y){this.setVisited(y),this._sym.setVisited(y)},h.prototype.setEdgeDepths=function(y,b){var I=this.getEdge().getDepthDelta();this._isForward||(I=-I);var B=1;y===$t.LEFT&&(B=-1);var j=$t.opposite(y),oe=b+I*B;this.setDepth(y,b),this.setDepth(j,oe)},h.prototype.getEdgeRing=function(){return this._edgeRing},h.prototype.isInResult=function(){return this._isInResult},h.prototype.setNext=function(y){this._next=y},h.prototype.isVisited=function(){return this._isVisited},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.depthFactor=function(y,b){return y===Te.EXTERIOR&&b===Te.INTERIOR?1:y===Te.INTERIOR&&b===Te.EXTERIOR?-1:0},h}(Os),tl=function(){};tl.prototype.createNode=function(l){return new Eh(l,null)},tl.prototype.interfaces_=function(){return[]},tl.prototype.getClass=function(){return tl};var Vo=function(){this._edges=new Oe,this._nodes=null,this._edgeEndList=new Oe,0===arguments.length?this._nodes=new zo(new tl):1===arguments.length&&(this._nodes=new zo(arguments[0]))};Vo.prototype.printEdges=function(l){l.println("Edges:");for(var h=0;h<this._edges.size();h++){l.println("edge "+h+":");var y=this._edges.get(h);y.print(l),y.eiList.print(l)}},Vo.prototype.find=function(l){return this._nodes.find(l)},Vo.prototype.addNode=function(){return arguments[0]instanceof Eh||arguments[0]instanceof ie?this._nodes.addNode(arguments[0]):void 0},Vo.prototype.getNodeIterator=function(){return this._nodes.iterator()},Vo.prototype.linkResultDirectedEdges=function(){for(var l=this._nodes.iterator();l.hasNext();)l.next().getEdges().linkResultDirectedEdges()},Vo.prototype.debugPrintln=function(l){gn.out.println(l)},Vo.prototype.isBoundaryNode=function(l,h){var y=this._nodes.find(h);if(null===y)return!1;var b=y.getLabel();return null!==b&&b.getLocation(l)===Te.BOUNDARY},Vo.prototype.linkAllDirectedEdges=function(){for(var l=this._nodes.iterator();l.hasNext();)l.next().getEdges().linkAllDirectedEdges()},Vo.prototype.matchInSameDirection=function(l,h,y,b){return!!l.equals(y)&&Ot.computeOrientation(l,h,b)===Ot.COLLINEAR&&Sr.quadrant(l,h)===Sr.quadrant(y,b)},Vo.prototype.getEdgeEnds=function(){return this._edgeEndList},Vo.prototype.debugPrint=function(l){gn.out.print(l)},Vo.prototype.getEdgeIterator=function(){return this._edges.iterator()},Vo.prototype.findEdgeInSameDirection=function(l,h){for(var y=0;y<this._edges.size();y++){var b=this._edges.get(y),I=b.getCoordinates();if(this.matchInSameDirection(l,h,I[0],I[1])||this.matchInSameDirection(l,h,I[I.length-1],I[I.length-2]))return b}return null},Vo.prototype.insertEdge=function(l){this._edges.add(l)},Vo.prototype.findEdgeEnd=function(l){for(var h=this.getEdgeEnds().iterator();h.hasNext();){var y=h.next();if(y.getEdge()===l)return y}return null},Vo.prototype.addEdges=function(l){for(var h=l.iterator();h.hasNext();){var y=h.next();this._edges.add(y);var b=new Es(y,!0),I=new Es(y,!1);b.setSym(I),I.setSym(b),this.add(b),this.add(I)}},Vo.prototype.add=function(l){this._nodes.add(l),this._edgeEndList.add(l)},Vo.prototype.getNodes=function(){return this._nodes.values()},Vo.prototype.findEdge=function(l,h){for(var y=0;y<this._edges.size();y++){var b=this._edges.get(y),I=b.getCoordinates();if(l.equals(I[0])&&h.equals(I[1]))return b}return null},Vo.prototype.interfaces_=function(){return[]},Vo.prototype.getClass=function(){return Vo},Vo.linkResultDirectedEdges=function(l){for(var h=l.iterator();h.hasNext();)h.next().getEdges().linkResultDirectedEdges()};var Ws=function(){this._geometryFactory=null,this._shellList=new Oe,this._geometryFactory=arguments[0]};Ws.prototype.sortShellsAndHoles=function(l,h,y){for(var b=l.iterator();b.hasNext();){var I=b.next();I.isHole()?y.add(I):h.add(I)}},Ws.prototype.computePolygons=function(l){for(var h=new Oe,y=l.iterator();y.hasNext();){var b=y.next().toPolygon(this._geometryFactory);h.add(b)}return h},Ws.prototype.placeFreeHoles=function(l,h){for(var y=h.iterator();y.hasNext();){var b=y.next();if(null===b.getShell()){var I=this.findEdgeRingContaining(b,l);if(null===I)throw new Sl("unable to assign hole to a shell",b.getCoordinate(0));b.setShell(I)}}},Ws.prototype.buildMinimalEdgeRings=function(l,h,y){for(var b=new Oe,I=l.iterator();I.hasNext();){var B=I.next();if(B.getMaxNodeDegree()>2){B.linkDirectedEdgesForMinimalEdgeRings();var j=B.buildMinimalRings(),oe=this.findShell(j);null!==oe?(this.placePolygonHoles(oe,j),h.add(oe)):y.addAll(j)}else b.add(B)}return b},Ws.prototype.containsPoint=function(l){for(var h=this._shellList.iterator();h.hasNext();)if(h.next().containsPoint(l))return!0;return!1},Ws.prototype.buildMaximalEdgeRings=function(l){for(var h=new Oe,y=l.iterator();y.hasNext();){var b=y.next();if(b.isInResult()&&b.getLabel().isArea()&&null===b.getEdgeRing()){var I=new zs(b,this._geometryFactory);h.add(I),I.setInResult()}}return h},Ws.prototype.placePolygonHoles=function(l,h){for(var y=h.iterator();y.hasNext();){var b=y.next();b.isHole()&&b.setShell(l)}},Ws.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},Ws.prototype.findEdgeRingContaining=function(l,h){for(var y=l.getLinearRing(),b=y.getEnvelopeInternal(),I=y.getCoordinateN(0),B=null,j=null,oe=h.iterator();oe.hasNext();){var Pe=oe.next(),st=Pe.getLinearRing(),kt=st.getEnvelopeInternal();null!==B&&(j=B.getLinearRing().getEnvelopeInternal());var qt=!1;kt.contains(b)&&Ot.isPointInRing(I,st.getCoordinates())&&(qt=!0),qt&&(null===B||j.contains(kt))&&(B=Pe)}return B},Ws.prototype.findShell=function(l){for(var h=0,y=null,b=l.iterator();b.hasNext();){var I=b.next();I.isHole()||(y=I,h++)}return J.isTrue(h<=1,"found two shells in MinimalEdgeRing list"),y},Ws.prototype.add=function(){if(1===arguments.length){var l=arguments[0];this.add(l.getEdgeEnds(),l.getNodes())}else if(2===arguments.length){var h=arguments[0];Vo.linkResultDirectedEdges(arguments[1]);var b=this.buildMaximalEdgeRings(h),I=new Oe,B=this.buildMinimalEdgeRings(b,this._shellList,I);this.sortShellsAndHoles(B,this._shellList,I),this.placeFreeHoles(this._shellList,I)}},Ws.prototype.interfaces_=function(){return[]},Ws.prototype.getClass=function(){return Ws};var Zs=function(){};Zs.prototype.getBounds=function(){},Zs.prototype.interfaces_=function(){return[]},Zs.prototype.getClass=function(){return Zs};var Dl=function(){this._bounds=null,this._item=null;var h=arguments[1];this._bounds=arguments[0],this._item=h};Dl.prototype.getItem=function(){return this._item},Dl.prototype.getBounds=function(){return this._bounds},Dl.prototype.interfaces_=function(){return[Zs,Ee]},Dl.prototype.getClass=function(){return Dl};var cu=function(){this._size=null,this._items=null,this._size=0,this._items=new Oe,this._items.add(null)};cu.prototype.poll=function(){if(this.isEmpty())return null;var l=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),l},cu.prototype.size=function(){return this._size},cu.prototype.reorder=function(l){for(var h=null,y=this._items.get(l);2*l<=this._size&&((h=2*l)!==this._size&&this._items.get(h+1).compareTo(this._items.get(h))<0&&h++,this._items.get(h).compareTo(y)<0);l=h)this._items.set(l,this._items.get(h));this._items.set(l,y)},cu.prototype.clear=function(){this._size=0,this._items.clear()},cu.prototype.isEmpty=function(){return 0===this._size},cu.prototype.add=function(l){this._items.add(null),this._size+=1;var h=this._size;for(this._items.set(0,l);l.compareTo(this._items.get(Math.trunc(h/2)))<0;h/=2)this._items.set(h,this._items.get(Math.trunc(h/2)));this._items.set(h,l)},cu.prototype.interfaces_=function(){return[]},cu.prototype.getClass=function(){return cu};var nl=function(){};nl.prototype.visitItem=function(l){},nl.prototype.interfaces_=function(){return[]},nl.prototype.getClass=function(){return nl};var Tl=function(){};Tl.prototype.insert=function(l,h){},Tl.prototype.remove=function(l,h){},Tl.prototype.query=function(){},Tl.prototype.interfaces_=function(){return[]},Tl.prototype.getClass=function(){return Tl};var ms=function(){this._childBoundables=new Oe,this._bounds=null,this._level=null,0!==arguments.length&&1===arguments.length&&(this._level=arguments[0])},Gl={serialVersionUID:{configurable:!0}};ms.prototype.getLevel=function(){return this._level},ms.prototype.size=function(){return this._childBoundables.size()},ms.prototype.getChildBoundables=function(){return this._childBoundables},ms.prototype.addChildBoundable=function(l){J.isTrue(null===this._bounds),this._childBoundables.add(l)},ms.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},ms.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},ms.prototype.interfaces_=function(){return[Zs,Ee]},ms.prototype.getClass=function(){return ms},Gl.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(ms,Gl);var ti=function(){};ti.reverseOrder=function(){return{compare:function(l,h){return h.compareTo(l)}}},ti.min=function(l){return ti.sort(l),l.get(0)},ti.sort=function(l,h){var y=l.toArray();h?Jr.sort(y,h):Jr.sort(y);for(var b=l.iterator(),I=0,B=y.length;I<B;I++)b.next(),b.set(y[I])},ti.singletonList=function(l){var h=new Oe;return h.add(l),h};var Uo=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var h=arguments[1],y=arguments[2];this._boundable1=arguments[0],this._boundable2=h,this._itemDistance=y,this._distance=this.distance()};Uo.prototype.expandToQueue=function(l,h){var y=Uo.isComposite(this._boundable1),b=Uo.isComposite(this._boundable2);if(y&&b)return Uo.area(this._boundable1)>Uo.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,l,h),null):(this.expand(this._boundable2,this._boundable1,l,h),null);if(y)return this.expand(this._boundable1,this._boundable2,l,h),null;if(b)return this.expand(this._boundable2,this._boundable1,l,h),null;throw new fe("neither boundable is composite")},Uo.prototype.isLeaves=function(){return!(Uo.isComposite(this._boundable1)||Uo.isComposite(this._boundable2))},Uo.prototype.compareTo=function(l){return this._distance<l._distance?-1:this._distance>l._distance?1:0},Uo.prototype.expand=function(l,h,y,b){for(var I=l.getChildBoundables().iterator();I.hasNext();){var B=I.next(),j=new Uo(B,h,this._itemDistance);j.getDistance()<b&&y.add(j)}},Uo.prototype.getBoundable=function(l){return 0===l?this._boundable1:this._boundable2},Uo.prototype.getDistance=function(){return this._distance},Uo.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},Uo.prototype.interfaces_=function(){return[ce]},Uo.prototype.getClass=function(){return Uo},Uo.area=function(l){return l.getBounds().getArea()},Uo.isComposite=function(l){return l instanceof ms};var Oo=function l(){if(this._root=null,this._built=!1,this._itemBoundables=new Oe,this._nodeCapacity=null,0===arguments.length)this._nodeCapacity=l.DEFAULT_NODE_CAPACITY;else if(1===arguments.length){var y=arguments[0];J.isTrue(y>1,"Node capacity must be greater than 1"),this._nodeCapacity=y}},Jh={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Oo.prototype.getNodeCapacity=function(){return this._nodeCapacity},Oo.prototype.lastNode=function(l){return l.get(l.size()-1)},Oo.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var l=0,h=arguments[0].getChildBoundables().iterator();h.hasNext();){var y=h.next();y instanceof ms?l+=this.size(y):y instanceof Dl&&(l+=1)}return l}},Oo.prototype.removeItem=function(l,h){for(var y=null,b=l.getChildBoundables().iterator();b.hasNext();){var I=b.next();I instanceof Dl&&I.getItem()===h&&(y=I)}return null!==y&&(l.getChildBoundables().remove(y),!0)},Oo.prototype.itemsTree=function(){if(0===arguments.length){this.build();var l=this.itemsTree(this._root);return null===l?new Oe:l}if(1===arguments.length){for(var h=arguments[0],y=new Oe,b=h.getChildBoundables().iterator();b.hasNext();){var I=b.next();if(I instanceof ms){var B=this.itemsTree(I);null!==B&&y.add(B)}else I instanceof Dl?y.add(I.getItem()):J.shouldNeverReachHere()}return y.size()<=0?null:y}},Oo.prototype.insert=function(l,h){J.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Dl(l,h))},Oo.prototype.boundablesAtLevel=function(){if(1===arguments.length){var l=arguments[0],h=new Oe;return this.boundablesAtLevel(l,this._root,h),h}if(3===arguments.length){var y=arguments[0],b=arguments[1],I=arguments[2];if(J.isTrue(y>-2),b.getLevel()===y)return I.add(b),null;for(var B=b.getChildBoundables().iterator();B.hasNext();){var j=B.next();j instanceof ms?this.boundablesAtLevel(y,j,I):(J.isTrue(j instanceof Dl),-1===y&&I.add(j))}return null}},Oo.prototype.query=function(){if(1===arguments.length){var l=arguments[0];this.build();var h=new Oe;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),l)&&this.query(l,this._root,h),h}if(2===arguments.length){var y=arguments[0],b=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),y)&&this.query(y,this._root,b)}else if(3===arguments.length)if(At(arguments[2],nl)&&arguments[0]instanceof Object&&arguments[1]instanceof ms)for(var I=arguments[0],j=arguments[2],oe=arguments[1].getChildBoundables(),Pe=0;Pe<oe.size();Pe++){var st=oe.get(Pe);this.getIntersectsOp().intersects(st.getBounds(),I)&&(st instanceof ms?this.query(I,st,j):st instanceof Dl?j.visitItem(st.getItem()):J.shouldNeverReachHere())}else if(At(arguments[2],tt)&&arguments[0]instanceof Object&&arguments[1]instanceof ms)for(var kt=arguments[0],Pn=arguments[2],In=arguments[1].getChildBoundables(),zn=0;zn<In.size();zn++){var tr=In.get(zn);this.getIntersectsOp().intersects(tr.getBounds(),kt)&&(tr instanceof ms?this.query(kt,tr,Pn):tr instanceof Dl?Pn.add(tr.getItem()):J.shouldNeverReachHere())}},Oo.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},Oo.prototype.getRoot=function(){return this.build(),this._root},Oo.prototype.remove=function(){if(2===arguments.length){var l=arguments[0],h=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),l)&&this.remove(l,this._root,h)}if(3===arguments.length){var y=arguments[0],b=arguments[1],I=arguments[2],B=this.removeItem(b,I);if(B)return!0;for(var j=null,oe=b.getChildBoundables().iterator();oe.hasNext();){var Pe=oe.next();if(this.getIntersectsOp().intersects(Pe.getBounds(),y)&&Pe instanceof ms&&(B=this.remove(y,Pe,I))){j=Pe;break}}return null!==j&&j.getChildBoundables().isEmpty()&&b.getChildBoundables().remove(j),B}},Oo.prototype.createHigherLevels=function(l,h){J.isTrue(!l.isEmpty());var y=this.createParentBoundables(l,h+1);return 1===y.size()?y.get(0):this.createHigherLevels(y,h+1)},Oo.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var l=0,h=arguments[0].getChildBoundables().iterator();h.hasNext();){var y=h.next();if(y instanceof ms){var b=this.depth(y);b>l&&(l=b)}}return l+1}},Oo.prototype.createParentBoundables=function(l,h){J.isTrue(!l.isEmpty());var y=new Oe;y.add(this.createNode(h));var b=new Oe(l);ti.sort(b,this.getComparator());for(var I=b.iterator();I.hasNext();){var B=I.next();this.lastNode(y).getChildBoundables().size()===this.getNodeCapacity()&&y.add(this.createNode(h)),this.lastNode(y).addChildBoundable(B)}return y},Oo.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},Oo.prototype.interfaces_=function(){return[Ee]},Oo.prototype.getClass=function(){return Oo},Oo.compareDoubles=function(l,h){return l>h?1:l<h?-1:0},Jh.IntersectsOp.get=function(){return Gn},Jh.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},Jh.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(Oo,Jh);var Gn=function(){},$l=function(){};$l.prototype.distance=function(l,h){},$l.prototype.interfaces_=function(){return[]},$l.prototype.getClass=function(){return $l};var Ti=function(l){function h(b){l.call(this,b=b||h.DEFAULT_NODE_CAPACITY)}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var y={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return h.prototype.createParentBoundablesFromVerticalSlices=function(b,I){J.isTrue(b.length>0);for(var B=new Oe,j=0;j<b.length;j++)B.addAll(this.createParentBoundablesFromVerticalSlice(b[j],I));return B},h.prototype.createNode=function(b){return new Hl(b)},h.prototype.size=function(){return 0===arguments.length?l.prototype.size.call(this):l.prototype.size.apply(this,arguments)},h.prototype.insert=function(){if(2!==arguments.length)return l.prototype.insert.apply(this,arguments);var b=arguments[0],I=arguments[1];if(b.isNull())return null;l.prototype.insert.call(this,b,I)},h.prototype.getIntersectsOp=function(){return h.intersectsOp},h.prototype.verticalSlices=function(b,I){for(var B=Math.trunc(Math.ceil(b.size()/I)),j=new Array(I).fill(null),oe=b.iterator(),Pe=0;Pe<I;Pe++){j[Pe]=new Oe;for(var st=0;oe.hasNext()&&st<B;){var kt=oe.next();j[Pe].add(kt),st++}}return j},h.prototype.query=function(){if(1===arguments.length)return l.prototype.query.call(this,arguments[0]);2===arguments.length?l.prototype.query.call(this,arguments[0],arguments[1]):3===arguments.length&&(At(arguments[2],nl)&&arguments[0]instanceof Object&&arguments[1]instanceof ms||At(arguments[2],tt)&&arguments[0]instanceof Object&&arguments[1]instanceof ms)&&l.prototype.query.call(this,arguments[0],arguments[1],arguments[2])},h.prototype.getComparator=function(){return h.yComparator},h.prototype.createParentBoundablesFromVerticalSlice=function(b,I){return l.prototype.createParentBoundables.call(this,b,I)},h.prototype.remove=function(){return 2===arguments.length?l.prototype.remove.call(this,arguments[0],arguments[1]):l.prototype.remove.apply(this,arguments)},h.prototype.depth=function(){return 0===arguments.length?l.prototype.depth.call(this):l.prototype.depth.apply(this,arguments)},h.prototype.createParentBoundables=function(b,I){J.isTrue(!b.isEmpty());var B=Math.trunc(Math.ceil(b.size()/this.getNodeCapacity())),j=new Oe(b);ti.sort(j,h.xComparator);var oe=this.verticalSlices(j,Math.trunc(Math.ceil(Math.sqrt(B))));return this.createParentBoundablesFromVerticalSlices(oe,I)},h.prototype.nearestNeighbour=function(){if(1===arguments.length){if(At(arguments[0],$l)){var b=arguments[0],I=new Uo(this.getRoot(),this.getRoot(),b);return this.nearestNeighbour(I)}if(arguments[0]instanceof Uo)return this.nearestNeighbour(arguments[0],he.POSITIVE_INFINITY)}else if(2===arguments.length){if(arguments[0]instanceof h&&At(arguments[1],$l)){var j=arguments[0],oe=arguments[1],Pe=new Uo(this.getRoot(),j.getRoot(),oe);return this.nearestNeighbour(Pe)}if(arguments[0]instanceof Uo&&"number"==typeof arguments[1]){var st=arguments[0],kt=arguments[1],qt=null,Pn=new cu;for(Pn.add(st);!Pn.isEmpty()&&kt>0;){var In=Pn.poll(),zn=In.getDistance();if(zn>=kt)break;In.isLeaves()?(kt=zn,qt=In):In.expandToQueue(Pn,kt)}return[qt.getBoundable(0).getItem(),qt.getBoundable(1).getItem()]}}else if(3===arguments.length){var Tn=arguments[2],wa=new Dl(arguments[0],arguments[1]),Ea=new Uo(this.getRoot(),wa,Tn);return this.nearestNeighbour(Ea)[0]}},h.prototype.interfaces_=function(){return[Tl,Ee]},h.prototype.getClass=function(){return h},h.centreX=function(b){return h.avg(b.getMinX(),b.getMaxX())},h.avg=function(b,I){return(b+I)/2},h.centreY=function(b){return h.avg(b.getMinY(),b.getMaxY())},y.STRtreeNode.get=function(){return Hl},y.serialVersionUID.get=function(){return 0x39920f7d5f261e0},y.xComparator.get=function(){return{interfaces_:function(){return[Me]},compare:function(b,I){return l.compareDoubles(h.centreX(b.getBounds()),h.centreX(I.getBounds()))}}},y.yComparator.get=function(){return{interfaces_:function(){return[Me]},compare:function(b,I){return l.compareDoubles(h.centreY(b.getBounds()),h.centreY(I.getBounds()))}}},y.intersectsOp.get=function(){return{interfaces_:function(){return[l.IntersectsOp]},intersects:function(b,I){return b.intersects(I)}}},y.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(h,y),h}(Oo),Hl=function(l){function h(){l.call(this,arguments[0])}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.computeBounds=function(){for(var y=null,b=this.getChildBoundables().iterator();b.hasNext();){var I=b.next();null===y?y=new un(I.getBounds()):y.expandToInclude(I.getBounds())}return y},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(ms),ra=function(){};ra.prototype.interfaces_=function(){return[]},ra.prototype.getClass=function(){return ra},ra.relativeSign=function(l,h){return l<h?-1:l>h?1:0},ra.compare=function(l,h,y){if(h.equals2D(y))return 0;var b=ra.relativeSign(h.x,y.x),I=ra.relativeSign(h.y,y.y);switch(l){case 0:return ra.compareValue(b,I);case 1:return ra.compareValue(I,b);case 2:return ra.compareValue(I,-b);case 3:return ra.compareValue(-b,I);case 4:return ra.compareValue(-b,-I);case 5:return ra.compareValue(-I,-b);case 6:return ra.compareValue(-I,b);case 7:return ra.compareValue(b,-I)}return J.shouldNeverReachHere("invalid octant value"),0},ra.compareValue=function(l,h){return l<0?-1:l>0?1:h<0?-1:h>0?1:0};var fl=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var l=arguments[0],h=arguments[1],y=arguments[2],b=arguments[3];this._segString=l,this.coord=new ie(h),this.segmentIndex=y,this._segmentOctant=b,this._isInterior=!h.equals2D(l.getCoordinate(y))};fl.prototype.getCoordinate=function(){return this.coord},fl.prototype.print=function(l){l.print(this.coord),l.print(" seg # = "+this.segmentIndex)},fl.prototype.compareTo=function(l){var h=l;return this.segmentIndex<h.segmentIndex?-1:this.segmentIndex>h.segmentIndex?1:this.coord.equals2D(h.coord)?0:ra.compare(this._segmentOctant,this.coord,h.coord)},fl.prototype.isEndPoint=function(l){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===l},fl.prototype.isInterior=function(){return this._isInterior},fl.prototype.interfaces_=function(){return[ce]},fl.prototype.getClass=function(){return fl};var Vs=function(){this._nodeMap=new Dt,this._edge=null,this._edge=arguments[0]};Vs.prototype.getSplitCoordinates=function(){var l=new bt;this.addEndpoints();for(var h=this.iterator(),y=h.next();h.hasNext();){var b=h.next();this.addEdgeCoordinates(y,b,l),y=b}return l.toCoordinateArray()},Vs.prototype.addCollapsedNodes=function(){var l=new Oe;this.findCollapsesFromInsertedNodes(l),this.findCollapsesFromExistingVertices(l);for(var h=l.iterator();h.hasNext();){var y=h.next().intValue();this.add(this._edge.getCoordinate(y),y)}},Vs.prototype.print=function(l){l.println("Intersections:");for(var h=this.iterator();h.hasNext();)h.next().print(l)},Vs.prototype.findCollapsesFromExistingVertices=function(l){for(var h=0;h<this._edge.size()-2;h++){var y=this._edge.getCoordinate(h),b=this._edge.getCoordinate(h+2);y.equals2D(b)&&l.add(new it(h+1))}},Vs.prototype.addEdgeCoordinates=function(l,h,y){var b=this._edge.getCoordinate(h.segmentIndex),I=h.isInterior()||!h.coord.equals2D(b);y.add(new ie(l.coord),!1);for(var B=l.segmentIndex+1;B<=h.segmentIndex;B++)y.add(this._edge.getCoordinate(B));I&&y.add(new ie(h.coord))},Vs.prototype.iterator=function(){return this._nodeMap.values().iterator()},Vs.prototype.addSplitEdges=function(l){this.addEndpoints(),this.addCollapsedNodes();for(var h=this.iterator(),y=h.next();h.hasNext();){var b=h.next(),I=this.createSplitEdge(y,b);l.add(I),y=b}},Vs.prototype.findCollapseIndex=function(l,h,y){if(!l.coord.equals2D(h.coord))return!1;var b=h.segmentIndex-l.segmentIndex;return h.isInterior()||b--,1===b&&(y[0]=l.segmentIndex+1,!0)},Vs.prototype.findCollapsesFromInsertedNodes=function(l){for(var h=new Array(1).fill(null),y=this.iterator(),b=y.next();y.hasNext();){var I=y.next();this.findCollapseIndex(b,I,h)&&l.add(new it(h[0])),b=I}},Vs.prototype.getEdge=function(){return this._edge},Vs.prototype.addEndpoints=function(){var l=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(l),l)},Vs.prototype.createSplitEdge=function(l,h){var y=h.segmentIndex-l.segmentIndex+2,b=this._edge.getCoordinate(h.segmentIndex),I=h.isInterior()||!h.coord.equals2D(b);I||y--;var B=new Array(y).fill(null),j=0;B[j++]=new ie(l.coord);for(var oe=l.segmentIndex+1;oe<=h.segmentIndex;oe++)B[j++]=this._edge.getCoordinate(oe);return I&&(B[j]=new ie(h.coord)),new jo(B,this._edge.getData())},Vs.prototype.add=function(l,h){var y=new fl(this._edge,l,h,this._edge.getSegmentOctant(h)),b=this._nodeMap.get(y);return null!==b?(J.isTrue(b.coord.equals2D(l),"Found equal nodes with different coordinates"),b):(this._nodeMap.put(y,y),y)},Vs.prototype.checkSplitEdgesCorrectness=function(l){var h=this._edge.getCoordinates(),y=l.get(0).getCoordinate(0);if(!y.equals2D(h[0]))throw new Z("bad split edge start point at "+y);var b=l.get(l.size()-1).getCoordinates(),I=b[b.length-1];if(!I.equals2D(h[h.length-1]))throw new Z("bad split edge end point at "+I)},Vs.prototype.interfaces_=function(){return[]},Vs.prototype.getClass=function(){return Vs};var oc=function(){};oc.prototype.interfaces_=function(){return[]},oc.prototype.getClass=function(){return oc},oc.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var l=arguments[0],h=arguments[1];if(0===l&&0===h)throw new fe("Cannot compute the octant for point ( "+l+", "+h+" )");var y=Math.abs(l),b=Math.abs(h);return l>=0?h>=0?y>=b?0:1:y>=b?7:6:h>=0?y>=b?3:2:y>=b?4:5}if(arguments[0]instanceof ie&&arguments[1]instanceof ie){var I=arguments[0],B=arguments[1],j=B.x-I.x,oe=B.y-I.y;if(0===j&&0===oe)throw new fe("Cannot compute the octant for two identical points "+I);return oc.octant(j,oe)}};var Ha=function(){};Ha.prototype.getCoordinates=function(){},Ha.prototype.size=function(){},Ha.prototype.getCoordinate=function(l){},Ha.prototype.isClosed=function(){},Ha.prototype.setData=function(l){},Ha.prototype.getData=function(){},Ha.prototype.interfaces_=function(){return[]},Ha.prototype.getClass=function(){return Ha};var sc=function(){};sc.prototype.addIntersection=function(l,h){},sc.prototype.interfaces_=function(){return[Ha]},sc.prototype.getClass=function(){return sc};var jo=function(){this._nodeList=new Vs(this),this._pts=null,this._data=null;var h=arguments[1];this._pts=arguments[0],this._data=h};jo.prototype.getCoordinates=function(){return this._pts},jo.prototype.size=function(){return this._pts.length},jo.prototype.getCoordinate=function(l){return this._pts[l]},jo.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},jo.prototype.getSegmentOctant=function(l){return l===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(l),this.getCoordinate(l+1))},jo.prototype.setData=function(l){this._data=l},jo.prototype.safeOctant=function(l,h){return l.equals2D(h)?0:oc.octant(l,h)},jo.prototype.getData=function(){return this._data},jo.prototype.addIntersection=function(){if(2===arguments.length)this.addIntersectionNode(arguments[0],arguments[1]);else if(4===arguments.length){var b=arguments[1],B=new ie(arguments[0].getIntersection(arguments[3]));this.addIntersection(B,b)}},jo.prototype.toString=function(){return ye.toLineString(new ts(this._pts))},jo.prototype.getNodeList=function(){return this._nodeList},jo.prototype.addIntersectionNode=function(l,h){var y=h,b=y+1;return b<this._pts.length&&l.equals2D(this._pts[b])&&(y=b),this._nodeList.add(l,y)},jo.prototype.addIntersections=function(l,h,y){for(var b=0;b<l.getIntersectionNum();b++)this.addIntersection(l,h,y,b)},jo.prototype.interfaces_=function(){return[sc]},jo.prototype.getClass=function(){return jo},jo.getNodedSubstrings=function(){if(1===arguments.length){var l=arguments[0],h=new Oe;return jo.getNodedSubstrings(l,h),h}if(2===arguments.length)for(var b=arguments[1],I=arguments[0].iterator();I.hasNext();)I.next().getNodeList().addSplitEdges(b)};var er=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new ie,this.p1=new ie;else if(1===arguments.length){var l=arguments[0];this.p0=new ie(l.p0),this.p1=new ie(l.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var b=arguments[2],I=arguments[3];this.p0=new ie(arguments[0],arguments[1]),this.p1=new ie(b,I)}},Kn={serialVersionUID:{configurable:!0}};er.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},er.prototype.orientationIndex=function(){if(arguments[0]instanceof er){var l=arguments[0],h=Ot.orientationIndex(this.p0,this.p1,l.p0),y=Ot.orientationIndex(this.p0,this.p1,l.p1);return h>=0&&y>=0||h<=0&&y<=0?Math.max(h,y):0}if(arguments[0]instanceof ie)return Ot.orientationIndex(this.p0,this.p1,arguments[0])},er.prototype.toGeometry=function(l){return l.createLineString([this.p0,this.p1])},er.prototype.isVertical=function(){return this.p0.x===this.p1.x},er.prototype.equals=function(l){if(!(l instanceof er))return!1;var h=l;return this.p0.equals(h.p0)&&this.p1.equals(h.p1)},er.prototype.intersection=function(l){var h=new Tt;return h.computeIntersection(this.p0,this.p1,l.p0,l.p1),h.hasIntersection()?h.getIntersection(0):null},er.prototype.project=function(){if(arguments[0]instanceof ie){var l=arguments[0];if(l.equals(this.p0)||l.equals(this.p1))return new ie(l);var h=this.projectionFactor(l),y=new ie;return y.x=this.p0.x+h*(this.p1.x-this.p0.x),y.y=this.p0.y+h*(this.p1.y-this.p0.y),y}if(arguments[0]instanceof er){var b=arguments[0],I=this.projectionFactor(b.p0),B=this.projectionFactor(b.p1);if(I>=1&&B>=1||I<=0&&B<=0)return null;var j=this.project(b.p0);I<0&&(j=this.p0),I>1&&(j=this.p1);var oe=this.project(b.p1);return B<0&&(oe=this.p0),B>1&&(oe=this.p1),new er(j,oe)}},er.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},er.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},er.prototype.getCoordinate=function(l){return 0===l?this.p0:this.p1},er.prototype.distancePerpendicular=function(l){return Ot.distancePointLinePerpendicular(l,this.p0,this.p1)},er.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},er.prototype.midPoint=function(){return er.midPoint(this.p0,this.p1)},er.prototype.projectionFactor=function(l){if(l.equals(this.p0))return 0;if(l.equals(this.p1))return 1;var h=this.p1.x-this.p0.x,y=this.p1.y-this.p0.y,b=h*h+y*y;return b<=0?he.NaN:((l.x-this.p0.x)*h+(l.y-this.p0.y)*y)/b},er.prototype.closestPoints=function(l){var h=this.intersection(l);if(null!==h)return[h,h];var y=new Array(2).fill(null),b=he.MAX_VALUE,I=null,B=this.closestPoint(l.p0);b=B.distance(l.p0),y[0]=B,y[1]=l.p0;var j=this.closestPoint(l.p1);(I=j.distance(l.p1))<b&&(b=I,y[0]=j,y[1]=l.p1);var oe=l.closestPoint(this.p0);(I=oe.distance(this.p0))<b&&(b=I,y[0]=this.p0,y[1]=oe);var Pe=l.closestPoint(this.p1);return(I=Pe.distance(this.p1))<b&&(b=I,y[0]=this.p1,y[1]=Pe),y},er.prototype.closestPoint=function(l){var h=this.projectionFactor(l);return h>0&&h<1?this.project(l):this.p0.distance(l)<this.p1.distance(l)?this.p0:this.p1},er.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},er.prototype.getLength=function(){return this.p0.distance(this.p1)},er.prototype.compareTo=function(l){var h=l,y=this.p0.compareTo(h.p0);return 0!==y?y:this.p1.compareTo(h.p1)},er.prototype.reverse=function(){var l=this.p0;this.p0=this.p1,this.p1=l},er.prototype.equalsTopo=function(l){return this.p0.equals(l.p0)&&(this.p1.equals(l.p1)||this.p0.equals(l.p1))&&this.p1.equals(l.p0)},er.prototype.lineIntersection=function(l){try{return bn.intersection(this.p0,this.p1,l.p0,l.p1)}catch(h){if(!(h instanceof Dn))throw h}return null},er.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},er.prototype.pointAlongOffset=function(l,h){var y=this.p0.x+l*(this.p1.x-this.p0.x),b=this.p0.y+l*(this.p1.y-this.p0.y),I=this.p1.x-this.p0.x,B=this.p1.y-this.p0.y,j=Math.sqrt(I*I+B*B),oe=0,Pe=0;if(0!==h){if(j<=0)throw new Error("Cannot compute offset from zero-length line segment");oe=h*I/j,Pe=h*B/j}return new ie(y-Pe,b+oe)},er.prototype.setCoordinates=function(){if(1===arguments.length){var l=arguments[0];this.setCoordinates(l.p0,l.p1)}else if(2===arguments.length){var h=arguments[0],y=arguments[1];this.p0.x=h.x,this.p0.y=h.y,this.p1.x=y.x,this.p1.y=y.y}},er.prototype.segmentFraction=function(l){var h=this.projectionFactor(l);return h<0?h=0:(h>1||he.isNaN(h))&&(h=1),h},er.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},er.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},er.prototype.distance=function(){if(arguments[0]instanceof er){var l=arguments[0];return Ot.distanceLineLine(this.p0,this.p1,l.p0,l.p1)}if(arguments[0]instanceof ie)return Ot.distancePointLine(arguments[0],this.p0,this.p1)},er.prototype.pointAlong=function(l){var h=new ie;return h.x=this.p0.x+l*(this.p1.x-this.p0.x),h.y=this.p0.y+l*(this.p1.y-this.p0.y),h},er.prototype.hashCode=function(){var l=he.doubleToLongBits(this.p0.x);l^=31*he.doubleToLongBits(this.p0.y);var h=Math.trunc(l)^Math.trunc(l>>32),y=he.doubleToLongBits(this.p1.x);return y^=31*he.doubleToLongBits(this.p1.y),h^Math.trunc(y)^Math.trunc(y>>32)},er.prototype.interfaces_=function(){return[ce,Ee]},er.prototype.getClass=function(){return er},er.midPoint=function(l,h){return new ie((l.x+h.x)/2,(l.y+h.y)/2)},Kn.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(er,Kn);var Qc=function(){this.tempEnv1=new un,this.tempEnv2=new un,this._overlapSeg1=new er,this._overlapSeg2=new er};Qc.prototype.overlap=function(){if(2!==arguments.length&&4===arguments.length){var y=arguments[2],b=arguments[3];arguments[0].getLineSegment(arguments[1],this._overlapSeg1),y.getLineSegment(b,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},Qc.prototype.interfaces_=function(){return[]},Qc.prototype.getClass=function(){return Qc};var pa=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var h=arguments[1],y=arguments[2],b=arguments[3];this._pts=arguments[0],this._start=h,this._end=y,this._context=b};pa.prototype.getLineSegment=function(l,h){h.p0=this._pts[l],h.p1=this._pts[l+1]},pa.prototype.computeSelect=function(l,h,y,b){if(b.tempEnv1.init(this._pts[h],this._pts[y]),y-h==1)return b.select(this,h),null;if(!l.intersects(b.tempEnv1))return null;var j=Math.trunc((h+y)/2);h<j&&this.computeSelect(l,h,j,b),j<y&&this.computeSelect(l,j,y,b)},pa.prototype.getCoordinates=function(){for(var l=new Array(this._end-this._start+1).fill(null),h=0,y=this._start;y<=this._end;y++)l[h++]=this._pts[y];return l},pa.prototype.computeOverlaps=function(l,h){this.computeOverlapsInternal(this._start,this._end,l,l._start,l._end,h)},pa.prototype.setId=function(l){this._id=l},pa.prototype.select=function(l,h){this.computeSelect(l,this._start,this._end,h)},pa.prototype.getEnvelope=function(){return null===this._env&&(this._env=new un(this._pts[this._start],this._pts[this._end])),this._env},pa.prototype.getEndIndex=function(){return this._end},pa.prototype.getStartIndex=function(){return this._start},pa.prototype.getContext=function(){return this._context},pa.prototype.getId=function(){return this._id},pa.prototype.computeOverlapsInternal=function(l,h,y,b,I,B){var j=this._pts[l],oe=this._pts[h],Pe=y._pts[b],st=y._pts[I];if(h-l==1&&I-b==1)return B.overlap(this,l,y,b),null;if(B.tempEnv1.init(j,oe),B.tempEnv2.init(Pe,st),!B.tempEnv1.intersects(B.tempEnv2))return null;var kt=Math.trunc((l+h)/2),qt=Math.trunc((b+I)/2);l<kt&&(b<qt&&this.computeOverlapsInternal(l,kt,y,b,qt,B),qt<I&&this.computeOverlapsInternal(l,kt,y,qt,I,B)),kt<h&&(b<qt&&this.computeOverlapsInternal(kt,h,y,b,qt,B),qt<I&&this.computeOverlapsInternal(kt,h,y,qt,I,B))},pa.prototype.interfaces_=function(){return[]},pa.prototype.getClass=function(){return pa};var ns=function(){};ns.prototype.interfaces_=function(){return[]},ns.prototype.getClass=function(){return ns},ns.getChainStartIndices=function(l){var h=0,y=new Oe;y.add(new it(h));do{var b=ns.findChainEnd(l,h);y.add(new it(b)),h=b}while(h<l.length-1);return ns.toIntArray(y)},ns.findChainEnd=function(l,h){for(var y=h;y<l.length-1&&l[y].equals2D(l[y+1]);)y++;if(y>=l.length-1)return l.length-1;for(var b=Sr.quadrant(l[y],l[y+1]),I=h+1;I<l.length&&(l[I-1].equals2D(l[I])||Sr.quadrant(l[I-1],l[I])===b);)I++;return I-1},ns.getChains=function(){if(1===arguments.length)return ns.getChains(arguments[0],null);if(2===arguments.length){for(var h=arguments[0],y=arguments[1],b=new Oe,I=ns.getChainStartIndices(h),B=0;B<I.length-1;B++){var j=new pa(h,I[B],I[B+1],y);b.add(j)}return b}},ns.toIntArray=function(l){for(var h=new Array(l.size()).fill(null),y=0;y<h.length;y++)h[y]=l.get(y).intValue();return h};var Iu=function(){};Iu.prototype.computeNodes=function(l){},Iu.prototype.getNodedSubstrings=function(){},Iu.prototype.interfaces_=function(){return[]},Iu.prototype.getClass=function(){return Iu};var Qh=function(){this._segInt=null,0!==arguments.length&&1===arguments.length&&this.setSegmentIntersector(arguments[0])};Qh.prototype.setSegmentIntersector=function(l){this._segInt=l},Qh.prototype.interfaces_=function(){return[Iu]},Qh.prototype.getClass=function(){return Qh};var Eo=function(l){function h(b){b?l.call(this,b):l.call(this),this._monoChains=new Oe,this._index=new Ti,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var y={SegmentOverlapAction:{configurable:!0}};return h.prototype.getMonotoneChains=function(){return this._monoChains},h.prototype.getNodedSubstrings=function(){return jo.getNodedSubstrings(this._nodedSegStrings)},h.prototype.getIndex=function(){return this._index},h.prototype.add=function(b){for(var I=ns.getChains(b.getCoordinates(),b).iterator();I.hasNext();){var B=I.next();B.setId(this._idCounter++),this._index.insert(B.getEnvelope(),B),this._monoChains.add(B)}},h.prototype.computeNodes=function(b){this._nodedSegStrings=b;for(var I=b.iterator();I.hasNext();)this.add(I.next());this.intersectChains()},h.prototype.intersectChains=function(){for(var b=new Ch(this._segInt),I=this._monoChains.iterator();I.hasNext();)for(var B=I.next(),j=this._index.query(B.getEnvelope()).iterator();j.hasNext();){var oe=j.next();if(oe.getId()>B.getId()&&(B.computeOverlaps(oe,b),this._nOverlaps++),this._segInt.isDone())return null}},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},y.SegmentOverlapAction.get=function(){return Ch},Object.defineProperties(h,y),h}(Qh),Ch=function(l){function h(){l.call(this),this._si=null,this._si=arguments[0]}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.overlap=function(){if(4!==arguments.length)return l.prototype.overlap.apply(this,arguments);var b=arguments[1],I=arguments[2],B=arguments[3],j=arguments[0].getContext(),oe=I.getContext();this._si.processIntersections(j,b,oe,B)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Qc),bi=function l(){if(this._quadrantSegments=l.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=l.CAP_ROUND,this._joinStyle=l.JOIN_ROUND,this._mitreLimit=l.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=l.DEFAULT_SIMPLIFY_FACTOR,0!==arguments.length)if(1===arguments.length)this.setQuadrantSegments(arguments[0]);else if(2===arguments.length){var b=arguments[1];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(b)}else if(4===arguments.length){var B=arguments[1],j=arguments[2],oe=arguments[3];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(B),this.setJoinStyle(j),this.setMitreLimit(oe)}},Il={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};bi.prototype.getEndCapStyle=function(){return this._endCapStyle},bi.prototype.isSingleSided=function(){return this._isSingleSided},bi.prototype.setQuadrantSegments=function(l){this._quadrantSegments=l,0===this._quadrantSegments&&(this._joinStyle=bi.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=bi.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),l<=0&&(this._quadrantSegments=1),this._joinStyle!==bi.JOIN_ROUND&&(this._quadrantSegments=bi.DEFAULT_QUADRANT_SEGMENTS)},bi.prototype.getJoinStyle=function(){return this._joinStyle},bi.prototype.setJoinStyle=function(l){this._joinStyle=l},bi.prototype.setSimplifyFactor=function(l){this._simplifyFactor=l<0?0:l},bi.prototype.getSimplifyFactor=function(){return this._simplifyFactor},bi.prototype.getQuadrantSegments=function(){return this._quadrantSegments},bi.prototype.setEndCapStyle=function(l){this._endCapStyle=l},bi.prototype.getMitreLimit=function(){return this._mitreLimit},bi.prototype.setMitreLimit=function(l){this._mitreLimit=l},bi.prototype.setSingleSided=function(l){this._isSingleSided=l},bi.prototype.interfaces_=function(){return[]},bi.prototype.getClass=function(){return bi},bi.bufferDistanceError=function(l){var h=Math.PI/2/l;return 1-Math.cos(h/2)},Il.CAP_ROUND.get=function(){return 1},Il.CAP_FLAT.get=function(){return 2},Il.CAP_SQUARE.get=function(){return 3},Il.JOIN_ROUND.get=function(){return 1},Il.JOIN_MITRE.get=function(){return 2},Il.JOIN_BEVEL.get=function(){return 3},Il.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Il.DEFAULT_MITRE_LIMIT.get=function(){return 5},Il.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(bi,Il);var Ei=function(l){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Ot.COUNTERCLOCKWISE,this._inputLine=l||null},ql={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Ei.prototype.isDeletable=function(l,h,y,b){var I=this._inputLine[l],B=this._inputLine[h],j=this._inputLine[y];return!!this.isConcave(I,B,j)&&!!this.isShallow(I,B,j,b)&&this.isShallowSampled(I,B,l,y,b)},Ei.prototype.deleteShallowConcavities=function(){for(var l=1,h=this.findNextNonDeletedIndex(l),y=this.findNextNonDeletedIndex(h),b=!1;y<this._inputLine.length;){var I=!1;this.isDeletable(l,h,y,this._distanceTol)&&(this._isDeleted[h]=Ei.DELETE,I=!0,b=!0),h=this.findNextNonDeletedIndex(l=I?y:h),y=this.findNextNonDeletedIndex(h)}return b},Ei.prototype.isShallowConcavity=function(l,h,y,b){return Ot.computeOrientation(l,h,y)===this._angleOrientation&&Ot.distancePointLine(h,l,y)<b},Ei.prototype.isShallowSampled=function(l,h,y,b,I){var B=Math.trunc((b-y)/Ei.NUM_PTS_TO_CHECK);B<=0&&(B=1);for(var j=y;j<b;j+=B)if(!this.isShallow(l,h,this._inputLine[j],I))return!1;return!0},Ei.prototype.isConcave=function(l,h,y){return Ot.computeOrientation(l,h,y)===this._angleOrientation},Ei.prototype.simplify=function(l){this._distanceTol=Math.abs(l),l<0&&(this._angleOrientation=Ot.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var h=!1;do{h=this.deleteShallowConcavities()}while(h);return this.collapseLine()},Ei.prototype.findNextNonDeletedIndex=function(l){for(var h=l+1;h<this._inputLine.length&&this._isDeleted[h]===Ei.DELETE;)h++;return h},Ei.prototype.isShallow=function(l,h,y,b){return Ot.distancePointLine(h,l,y)<b},Ei.prototype.collapseLine=function(){for(var l=new bt,h=0;h<this._inputLine.length;h++)this._isDeleted[h]!==Ei.DELETE&&l.add(this._inputLine[h]);return l.toCoordinateArray()},Ei.prototype.interfaces_=function(){return[]},Ei.prototype.getClass=function(){return Ei},Ei.simplify=function(l,h){return new Ei(l).simplify(h)},ql.INIT.get=function(){return 0},ql.DELETE.get=function(){return 1},ql.KEEP.get=function(){return 1},ql.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Ei,ql);var Xs=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Oe},_f={COORDINATE_ARRAY_TYPE:{configurable:!0}};Xs.prototype.getCoordinates=function(){return this._ptList.toArray(Xs.COORDINATE_ARRAY_TYPE)},Xs.prototype.setPrecisionModel=function(l){this._precisionModel=l},Xs.prototype.addPt=function(l){var h=new ie(l);if(this._precisionModel.makePrecise(h),this.isRedundant(h))return null;this._ptList.add(h)},Xs.prototype.revere=function(){},Xs.prototype.addPts=function(l,h){if(h)for(var y=0;y<l.length;y++)this.addPt(l[y]);else for(var b=l.length-1;b>=0;b--)this.addPt(l[b])},Xs.prototype.isRedundant=function(l){if(this._ptList.size()<1)return!1;var h=this._ptList.get(this._ptList.size()-1);return l.distance(h)<this._minimimVertexDistance},Xs.prototype.toString=function(){return(new ur).createLineString(this.getCoordinates()).toString()},Xs.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var l=new ie(this._ptList.get(0)),h=this._ptList.get(this._ptList.size()-1);if(l.equals(h))return null;this._ptList.add(l)},Xs.prototype.setMinimumVertexDistance=function(l){this._minimimVertexDistance=l},Xs.prototype.interfaces_=function(){return[]},Xs.prototype.getClass=function(){return Xs},_f.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Xs,_f);var ni=function(){},ac={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};ni.prototype.interfaces_=function(){return[]},ni.prototype.getClass=function(){return ni},ni.toDegrees=function(l){return 180*l/Math.PI},ni.normalize=function(l){for(;l>Math.PI;)l-=ni.PI_TIMES_2;for(;l<=-Math.PI;)l+=ni.PI_TIMES_2;return l},ni.angle=function(){if(1===arguments.length){var l=arguments[0];return Math.atan2(l.y,l.x)}if(2===arguments.length){var h=arguments[0],y=arguments[1];return Math.atan2(y.y-h.y,y.x-h.x)}},ni.isAcute=function(l,h,y){return(l.x-h.x)*(y.x-h.x)+(l.y-h.y)*(y.y-h.y)>0},ni.isObtuse=function(l,h,y){return(l.x-h.x)*(y.x-h.x)+(l.y-h.y)*(y.y-h.y)<0},ni.interiorAngle=function(l,h,y){var b=ni.angle(h,l),I=ni.angle(h,y);return Math.abs(I-b)},ni.normalizePositive=function(l){if(l<0){for(;l<0;)l+=ni.PI_TIMES_2;l>=ni.PI_TIMES_2&&(l=0)}else{for(;l>=ni.PI_TIMES_2;)l-=ni.PI_TIMES_2;l<0&&(l=0)}return l},ni.angleBetween=function(l,h,y){var b=ni.angle(h,l),I=ni.angle(h,y);return ni.diff(b,I)},ni.diff=function(l,h){var y=null;return(y=l<h?h-l:l-h)>Math.PI&&(y=2*Math.PI-y),y},ni.toRadians=function(l){return l*Math.PI/180},ni.getTurn=function(l,h){var y=Math.sin(h-l);return y>0?ni.COUNTERCLOCKWISE:y<0?ni.CLOCKWISE:ni.NONE},ni.angleBetweenOriented=function(l,h,y){var b=ni.angle(h,l),I=ni.angle(h,y)-b;return I<=-Math.PI?I+ni.PI_TIMES_2:I>Math.PI?I-ni.PI_TIMES_2:I},ac.PI_TIMES_2.get=function(){return 2*Math.PI},ac.PI_OVER_2.get=function(){return Math.PI/2},ac.PI_OVER_4.get=function(){return Math.PI/4},ac.COUNTERCLOCKWISE.get=function(){return Ot.COUNTERCLOCKWISE},ac.CLOCKWISE.get=function(){return Ot.CLOCKWISE},ac.NONE.get=function(){return Ot.COLLINEAR},Object.defineProperties(ni,ac);var yo=function l(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new er,this._seg1=new er,this._offset0=new er,this._offset1=new er,this._side=0,this._hasNarrowConcaveAngle=!1;var y=arguments[1],b=arguments[2];this._precisionModel=arguments[0],this._bufParams=y,this._li=new Tt,this._filletAngleQuantum=Math.PI/2/y.getQuadrantSegments(),y.getQuadrantSegments()>=8&&y.getJoinStyle()===bi.JOIN_ROUND&&(this._closingSegLengthFactor=l.MAX_CLOSING_SEG_LEN_FACTOR),this.init(b)},Wl={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};yo.prototype.addNextSegment=function(l,h){if(this._s0=this._s1,this._s1=this._s2,this._s2=l,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var y=Ot.computeOrientation(this._s0,this._s1,this._s2),b=y===Ot.CLOCKWISE&&this._side===$t.LEFT||y===Ot.COUNTERCLOCKWISE&&this._side===$t.RIGHT;0===y?this.addCollinear(h):b?this.addOutsideTurn(y,h):this.addInsideTurn(y,h)},yo.prototype.addLineEndCap=function(l,h){var y=new er(l,h),b=new er;this.computeOffsetSegment(y,$t.LEFT,this._distance,b);var I=new er;this.computeOffsetSegment(y,$t.RIGHT,this._distance,I);var oe=Math.atan2(h.y-l.y,h.x-l.x);switch(this._bufParams.getEndCapStyle()){case bi.CAP_ROUND:this._segList.addPt(b.p1),this.addFilletArc(h,oe+Math.PI/2,oe-Math.PI/2,Ot.CLOCKWISE,this._distance),this._segList.addPt(I.p1);break;case bi.CAP_FLAT:this._segList.addPt(b.p1),this._segList.addPt(I.p1);break;case bi.CAP_SQUARE:var Pe=new ie;Pe.x=Math.abs(this._distance)*Math.cos(oe),Pe.y=Math.abs(this._distance)*Math.sin(oe);var st=new ie(b.p1.x+Pe.x,b.p1.y+Pe.y),kt=new ie(I.p1.x+Pe.x,I.p1.y+Pe.y);this._segList.addPt(st),this._segList.addPt(kt)}},yo.prototype.getCoordinates=function(){return this._segList.getCoordinates()},yo.prototype.addMitreJoin=function(l,h,y,b){var I=!0,B=null;try{B=bn.intersection(h.p0,h.p1,y.p0,y.p1),(b<=0?1:B.distance(l)/Math.abs(b))>this._bufParams.getMitreLimit()&&(I=!1)}catch(j){if(!(j instanceof Dn))throw j;B=new ie(0,0),I=!1}I?this._segList.addPt(B):this.addLimitedMitreJoin(h,y,b,this._bufParams.getMitreLimit())},yo.prototype.addFilletCorner=function(l,h,y,b,I){var oe=Math.atan2(h.y-l.y,h.x-l.x),kt=Math.atan2(y.y-l.y,y.x-l.x);b===Ot.CLOCKWISE?oe<=kt&&(oe+=2*Math.PI):oe>=kt&&(oe-=2*Math.PI),this._segList.addPt(h),this.addFilletArc(l,oe,kt,b,I),this._segList.addPt(y)},yo.prototype.addOutsideTurn=function(l,h){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*yo.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===bi.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===bi.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(h&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,l,this._distance),this._segList.addPt(this._offset1.p0))},yo.prototype.createSquare=function(l){this._segList.addPt(new ie(l.x+this._distance,l.y+this._distance)),this._segList.addPt(new ie(l.x+this._distance,l.y-this._distance)),this._segList.addPt(new ie(l.x-this._distance,l.y-this._distance)),this._segList.addPt(new ie(l.x-this._distance,l.y+this._distance)),this._segList.closeRing()},yo.prototype.addSegments=function(l,h){this._segList.addPts(l,h)},yo.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},yo.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},yo.prototype.initSideSegments=function(l,h,y){this._s1=l,this._s2=h,this._side=y,this._seg1.setCoordinates(l,h),this.computeOffsetSegment(this._seg1,y,this._distance,this._offset1)},yo.prototype.addLimitedMitreJoin=function(l,h,y,b){var I=this._seg0.p1,B=ni.angle(I,this._seg0.p0),j=ni.angleBetweenOriented(this._seg0.p0,I,this._seg1.p1)/2,oe=ni.normalize(B+j),Pe=ni.normalize(oe+Math.PI),st=b*y,kt=y-st*Math.abs(Math.sin(j)),qt=I.x+st*Math.cos(Pe),Pn=I.y+st*Math.sin(Pe),In=new ie(qt,Pn),zn=new er(I,In),tr=zn.pointAlongOffset(1,kt),Mi=zn.pointAlongOffset(1,-kt);this._side===$t.LEFT?(this._segList.addPt(tr),this._segList.addPt(Mi)):(this._segList.addPt(Mi),this._segList.addPt(tr))},yo.prototype.computeOffsetSegment=function(l,h,y,b){var I=h===$t.LEFT?1:-1,B=l.p1.x-l.p0.x,j=l.p1.y-l.p0.y,oe=Math.sqrt(B*B+j*j),Pe=I*y*B/oe,st=I*y*j/oe;b.p0.x=l.p0.x-st,b.p0.y=l.p0.y+Pe,b.p1.x=l.p1.x-st,b.p1.y=l.p1.y+Pe},yo.prototype.addFilletArc=function(l,h,y,b,I){var B=b===Ot.CLOCKWISE?-1:1,j=Math.abs(h-y),oe=Math.trunc(j/this._filletAngleQuantum+.5);if(oe<1)return null;for(var Pe=j/oe,st=0,kt=new ie;st<j;){var qt=h+B*st;kt.x=l.x+I*Math.cos(qt),kt.y=l.y+I*Math.sin(qt),this._segList.addPt(kt),st+=Pe}},yo.prototype.addInsideTurn=function(l,h){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*yo.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var y=new ie((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(y);var b=new ie((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(b)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},yo.prototype.createCircle=function(l){var h=new ie(l.x+this._distance,l.y);this._segList.addPt(h),this.addFilletArc(l,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},yo.prototype.addBevelJoin=function(l,h){this._segList.addPt(l.p1),this._segList.addPt(h.p0)},yo.prototype.init=function(l){this._distance=l,this._maxCurveSegmentError=l*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Xs,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(l*yo.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},yo.prototype.addCollinear=function(l){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===bi.JOIN_BEVEL||this._bufParams.getJoinStyle()===bi.JOIN_MITRE?(l&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,Ot.CLOCKWISE,this._distance))},yo.prototype.closeRing=function(){this._segList.closeRing()},yo.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},yo.prototype.interfaces_=function(){return[]},yo.prototype.getClass=function(){return yo},Wl.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Wl.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Wl.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Wl.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(yo,Wl);var ia=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var h=arguments[1];this._precisionModel=arguments[0],this._bufParams=h};ia.prototype.getOffsetCurve=function(l,h){if(this._distance=h,0===h)return null;var y=h<0,b=Math.abs(h),I=this.getSegGen(b);l.length<=1?this.computePointCurve(l[0],I):this.computeOffsetCurve(l,y,I);var B=I.getCoordinates();return y&&Qe.reverse(B),B},ia.prototype.computeSingleSidedBufferCurve=function(l,h,y){var b=this.simplifyTolerance(this._distance);if(h){y.addSegments(l,!0);var I=Ei.simplify(l,-b),B=I.length-1;y.initSideSegments(I[B],I[B-1],$t.LEFT),y.addFirstSegment();for(var j=B-2;j>=0;j--)y.addNextSegment(I[j],!0)}else{y.addSegments(l,!1);var oe=Ei.simplify(l,b),Pe=oe.length-1;y.initSideSegments(oe[0],oe[1],$t.LEFT),y.addFirstSegment();for(var st=2;st<=Pe;st++)y.addNextSegment(oe[st],!0)}y.addLastSegment(),y.closeRing()},ia.prototype.computeRingBufferCurve=function(l,h,y){var b=this.simplifyTolerance(this._distance);h===$t.RIGHT&&(b=-b);var I=Ei.simplify(l,b),B=I.length-1;y.initSideSegments(I[B-1],I[0],h);for(var j=1;j<=B;j++)y.addNextSegment(I[j],1!==j);y.closeRing()},ia.prototype.computeLineBufferCurve=function(l,h){var y=this.simplifyTolerance(this._distance),b=Ei.simplify(l,y),I=b.length-1;h.initSideSegments(b[0],b[1],$t.LEFT);for(var B=2;B<=I;B++)h.addNextSegment(b[B],!0);h.addLastSegment(),h.addLineEndCap(b[I-1],b[I]);var j=Ei.simplify(l,-y),oe=j.length-1;h.initSideSegments(j[oe],j[oe-1],$t.LEFT);for(var Pe=oe-2;Pe>=0;Pe--)h.addNextSegment(j[Pe],!0);h.addLastSegment(),h.addLineEndCap(j[1],j[0]),h.closeRing()},ia.prototype.computePointCurve=function(l,h){switch(this._bufParams.getEndCapStyle()){case bi.CAP_ROUND:h.createCircle(l);break;case bi.CAP_SQUARE:h.createSquare(l)}},ia.prototype.getLineCurve=function(l,h){if(this._distance=h,h<0&&!this._bufParams.isSingleSided()||0===h)return null;var y=Math.abs(h),b=this.getSegGen(y);return l.length<=1?this.computePointCurve(l[0],b):this._bufParams.isSingleSided()?this.computeSingleSidedBufferCurve(l,h<0,b):this.computeLineBufferCurve(l,b),b.getCoordinates()},ia.prototype.getBufferParameters=function(){return this._bufParams},ia.prototype.simplifyTolerance=function(l){return l*this._bufParams.getSimplifyFactor()},ia.prototype.getRingCurve=function(l,h,y){if(this._distance=y,l.length<=2)return this.getLineCurve(l,y);if(0===y)return ia.copyCoordinates(l);var b=this.getSegGen(y);return this.computeRingBufferCurve(l,h,b),b.getCoordinates()},ia.prototype.computeOffsetCurve=function(l,h,y){var b=this.simplifyTolerance(this._distance);if(h){var I=Ei.simplify(l,-b),B=I.length-1;y.initSideSegments(I[B],I[B-1],$t.LEFT),y.addFirstSegment();for(var j=B-2;j>=0;j--)y.addNextSegment(I[j],!0)}else{var oe=Ei.simplify(l,b),Pe=oe.length-1;y.initSideSegments(oe[0],oe[1],$t.LEFT),y.addFirstSegment();for(var st=2;st<=Pe;st++)y.addNextSegment(oe[st],!0)}y.addLastSegment()},ia.prototype.getSegGen=function(l){return new yo(this._precisionModel,this._bufParams,l)},ia.prototype.interfaces_=function(){return[]},ia.prototype.getClass=function(){return ia},ia.copyCoordinates=function(l){for(var h=new Array(l.length).fill(null),y=0;y<h.length;y++)h[y]=new ie(l[y]);return h};var rl=function(){this._subgraphs=null,this._seg=new er,this._cga=new Ot,this._subgraphs=arguments[0]},Ci={DepthSegment:{configurable:!0}};rl.prototype.findStabbedSegments=function(){if(1===arguments.length){for(var l=arguments[0],h=new Oe,y=this._subgraphs.iterator();y.hasNext();){var b=y.next(),I=b.getEnvelope();l.y<I.getMinY()||l.y>I.getMaxY()||this.findStabbedSegments(l,b.getDirectedEdges(),h)}return h}if(3===arguments.length)if(At(arguments[2],tt)&&arguments[0]instanceof ie&&arguments[1]instanceof Es){for(var B=arguments[0],j=arguments[1],oe=arguments[2],Pe=j.getEdge().getCoordinates(),st=0;st<Pe.length-1;st++)if(this._seg.p0=Pe[st],this._seg.p1=Pe[st+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<B.x||this._seg.isHorizontal()||B.y<this._seg.p0.y||B.y>this._seg.p1.y||Ot.computeOrientation(this._seg.p0,this._seg.p1,B)===Ot.RIGHT)){var kt=j.getDepth($t.LEFT);this._seg.p0.equals(Pe[st])||(kt=j.getDepth($t.RIGHT));var qt=new jn(this._seg,kt);oe.add(qt)}}else if(At(arguments[2],tt)&&arguments[0]instanceof ie&&At(arguments[1],tt))for(var Pn=arguments[0],zn=arguments[2],tr=arguments[1].iterator();tr.hasNext();){var Mi=tr.next();Mi.isForward()&&this.findStabbedSegments(Pn,Mi,zn)}},rl.prototype.getDepth=function(l){var h=this.findStabbedSegments(l);return 0===h.size()?0:ti.min(h)._leftDepth},rl.prototype.interfaces_=function(){return[]},rl.prototype.getClass=function(){return rl},Ci.DepthSegment.get=function(){return jn},Object.defineProperties(rl,Ci);var jn=function(){this._upwardSeg=null,this._leftDepth=null;var h=arguments[1];this._upwardSeg=new er(arguments[0]),this._leftDepth=h};jn.prototype.compareTo=function(l){var h=l;if(this._upwardSeg.minX()>=h._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=h._upwardSeg.minX())return-1;var y=this._upwardSeg.orientationIndex(h._upwardSeg);return 0!==y||0!=(y=-1*h._upwardSeg.orientationIndex(this._upwardSeg))?y:this._upwardSeg.compareTo(h._upwardSeg)},jn.prototype.compareX=function(l,h){var y=l.p0.compareTo(h.p0);return 0!==y?y:l.p1.compareTo(h.p1)},jn.prototype.toString=function(){return this._upwardSeg.toString()},jn.prototype.interfaces_=function(){return[ce]},jn.prototype.getClass=function(){return jn};var wi=function(l,h,y){this.p0=l||null,this.p1=h||null,this.p2=y||null};wi.prototype.area=function(){return wi.area(this.p0,this.p1,this.p2)},wi.prototype.signedArea=function(){return wi.signedArea(this.p0,this.p1,this.p2)},wi.prototype.interpolateZ=function(l){if(null===l)throw new fe("Supplied point is null.");return wi.interpolateZ(l,this.p0,this.p1,this.p2)},wi.prototype.longestSideLength=function(){return wi.longestSideLength(this.p0,this.p1,this.p2)},wi.prototype.isAcute=function(){return wi.isAcute(this.p0,this.p1,this.p2)},wi.prototype.circumcentre=function(){return wi.circumcentre(this.p0,this.p1,this.p2)},wi.prototype.area3D=function(){return wi.area3D(this.p0,this.p1,this.p2)},wi.prototype.centroid=function(){return wi.centroid(this.p0,this.p1,this.p2)},wi.prototype.inCentre=function(){return wi.inCentre(this.p0,this.p1,this.p2)},wi.prototype.interfaces_=function(){return[]},wi.prototype.getClass=function(){return wi},wi.area=function(l,h,y){return Math.abs(((y.x-l.x)*(h.y-l.y)-(h.x-l.x)*(y.y-l.y))/2)},wi.signedArea=function(l,h,y){return((y.x-l.x)*(h.y-l.y)-(h.x-l.x)*(y.y-l.y))/2},wi.det=function(l,h,y,b){return l*b-h*y},wi.interpolateZ=function(l,h,y,b){var I=h.x,B=h.y,j=y.x-I,oe=b.x-I,Pe=y.y-B,st=b.y-B,kt=j*st-oe*Pe,qt=l.x-I,Pn=l.y-B;return h.z+(st*qt-oe*Pn)/kt*(y.z-h.z)+(-Pe*qt+j*Pn)/kt*(b.z-h.z)},wi.longestSideLength=function(l,h,y){var b=l.distance(h),I=h.distance(y),B=y.distance(l),j=b;return I>j&&(j=I),B>j&&(j=B),j},wi.isAcute=function(l,h,y){return!!ni.isAcute(l,h,y)&&!!ni.isAcute(h,y,l)&&!!ni.isAcute(y,l,h)},wi.circumcentre=function(l,h,y){var b=y.x,I=y.y,B=l.x-b,j=l.y-I,oe=h.x-b,Pe=h.y-I,st=2*wi.det(B,j,oe,Pe),kt=wi.det(j,B*B+j*j,Pe,oe*oe+Pe*Pe),qt=wi.det(B,B*B+j*j,oe,oe*oe+Pe*Pe);return new ie(b-kt/st,I+qt/st)},wi.perpendicularBisector=function(l,h){var y=h.x-l.x,b=h.y-l.y,I=new bn(l.x+y/2,l.y+b/2,1),B=new bn(l.x-b+y/2,l.y+y+b/2,1);return new bn(I,B)},wi.angleBisector=function(l,h,y){var b=h.distance(l),I=b/(b+h.distance(y));return new ie(l.x+I*(y.x-l.x),l.y+I*(y.y-l.y))},wi.area3D=function(l,h,y){var b=h.x-l.x,I=h.y-l.y,B=h.z-l.z,j=y.x-l.x,oe=y.y-l.y,Pe=y.z-l.z,st=I*Pe-B*oe,kt=B*j-b*Pe,qt=b*oe-I*j;return Math.sqrt(st*st+kt*kt+qt*qt)/2},wi.centroid=function(l,h,y){return new ie((l.x+h.x+y.x)/3,(l.y+h.y+y.y)/3)},wi.inCentre=function(l,h,y){var b=h.distance(y),I=l.distance(y),B=l.distance(h),j=b+I+B;return new ie((b*l.x+I*h.x+B*y.x)/j,(b*l.y+I*h.y+B*y.y)/j)};var Vn=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Oe;var h=arguments[1],y=arguments[2];this._inputGeom=arguments[0],this._distance=h,this._curveBuilder=y};Vn.prototype.addPoint=function(l){if(this._distance<=0)return null;var h=l.getCoordinates(),y=this._curveBuilder.getLineCurve(h,this._distance);this.addCurve(y,Te.EXTERIOR,Te.INTERIOR)},Vn.prototype.addPolygon=function(l){var h=this._distance,y=$t.LEFT;this._distance<0&&(h=-this._distance,y=$t.RIGHT);var b=l.getExteriorRing(),I=Qe.removeRepeatedPoints(b.getCoordinates());if(this._distance<0&&this.isErodedCompletely(b,this._distance)||this._distance<=0&&I.length<3)return null;this.addPolygonRing(I,h,y,Te.EXTERIOR,Te.INTERIOR);for(var B=0;B<l.getNumInteriorRing();B++){var j=l.getInteriorRingN(B),oe=Qe.removeRepeatedPoints(j.getCoordinates());this._distance>0&&this.isErodedCompletely(j,-this._distance)||this.addPolygonRing(oe,h,$t.opposite(y),Te.INTERIOR,Te.EXTERIOR)}},Vn.prototype.isTriangleErodedCompletely=function(l,h){var y=new wi(l[0],l[1],l[2]),b=y.inCentre();return Ot.distancePointLine(b,y.p0,y.p1)<Math.abs(h)},Vn.prototype.addLineString=function(l){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var h=Qe.removeRepeatedPoints(l.getCoordinates()),y=this._curveBuilder.getLineCurve(h,this._distance);this.addCurve(y,Te.EXTERIOR,Te.INTERIOR)},Vn.prototype.addCurve=function(l,h,y){if(null===l||l.length<2)return null;var b=new jo(l,new di(0,Te.BOUNDARY,h,y));this._curveList.add(b)},Vn.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},Vn.prototype.addPolygonRing=function(l,h,y,b,I){if(0===h&&l.length<Hs.MINIMUM_VALID_SIZE)return null;var B=b,j=I;l.length>=Hs.MINIMUM_VALID_SIZE&&Ot.isCCW(l)&&(B=I,j=b,y=$t.opposite(y));var oe=this._curveBuilder.getRingCurve(l,y,h);this.addCurve(oe,B,j)},Vn.prototype.add=function(l){if(l.isEmpty())return null;l instanceof qo?this.addPolygon(l):l instanceof vi?this.addLineString(l):l instanceof ps?this.addPoint(l):(l instanceof Tu||l instanceof Bl||l instanceof da||l instanceof Vi)&&this.addCollection(l)},Vn.prototype.isErodedCompletely=function(l,h){var y=l.getCoordinates();if(y.length<4)return h<0;if(4===y.length)return this.isTriangleErodedCompletely(y,h);var b=l.getEnvelopeInternal(),I=Math.min(b.getHeight(),b.getWidth());return h<0&&2*Math.abs(h)>I},Vn.prototype.addCollection=function(l){for(var h=0;h<l.getNumGeometries();h++){var y=l.getGeometryN(h);this.add(y)}},Vn.prototype.interfaces_=function(){return[]},Vn.prototype.getClass=function(){return Vn};var Uu=function(){};Uu.prototype.locate=function(l){},Uu.prototype.interfaces_=function(){return[]},Uu.prototype.getClass=function(){return Uu};var ga=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var l=arguments[0];this._parent=l,this._atStart=!0,this._index=0,this._max=l.getNumGeometries()};ga.prototype.next=function(){if(this._atStart)return this._atStart=!1,ga.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new ht;var l=this._parent.getGeometryN(this._index++);return l instanceof Vi?(this._subcollectionIterator=new ga(l),this._subcollectionIterator.next()):l},ga.prototype.remove=function(){throw new Error(this.getClass().getName())},ga.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},ga.prototype.interfaces_=function(){return[je]},ga.prototype.getClass=function(){return ga},ga.isAtomic=function(l){return!(l instanceof Vi)};var Ys=function(){this._geom=null,this._geom=arguments[0]};Ys.prototype.locate=function(l){return Ys.locate(l,this._geom)},Ys.prototype.interfaces_=function(){return[Uu]},Ys.prototype.getClass=function(){return Ys},Ys.isPointInRing=function(l,h){return!!h.getEnvelopeInternal().intersects(l)&&Ot.isPointInRing(l,h.getCoordinates())},Ys.containsPointInPolygon=function(l,h){if(h.isEmpty())return!1;var y=h.getExteriorRing();if(!Ys.isPointInRing(l,y))return!1;for(var b=0;b<h.getNumInteriorRing();b++){var I=h.getInteriorRingN(b);if(Ys.isPointInRing(l,I))return!1}return!0},Ys.containsPoint=function(l,h){if(h instanceof qo)return Ys.containsPointInPolygon(l,h);if(h instanceof Vi)for(var y=new ga(h);y.hasNext();){var b=y.next();if(b!==h&&Ys.containsPoint(l,b))return!0}return!1},Ys.locate=function(l,h){return h.isEmpty()?Te.EXTERIOR:Ys.containsPoint(l,h)?Te.INTERIOR:Te.EXTERIOR};var ma=function(){this._edgeMap=new Dt,this._edgeList=null,this._ptInAreaLocation=[Te.NONE,Te.NONE]};ma.prototype.getNextCW=function(l){this.getEdges();var h=this._edgeList.indexOf(l),y=h-1;return 0===h&&(y=this._edgeList.size()-1),this._edgeList.get(y)},ma.prototype.propagateSideLabels=function(l){for(var h=Te.NONE,y=this.iterator();y.hasNext();){var b=y.next().getLabel();b.isArea(l)&&b.getLocation(l,$t.LEFT)!==Te.NONE&&(h=b.getLocation(l,$t.LEFT))}if(h===Te.NONE)return null;for(var I=h,B=this.iterator();B.hasNext();){var j=B.next(),oe=j.getLabel();if(oe.getLocation(l,$t.ON)===Te.NONE&&oe.setLocation(l,$t.ON,I),oe.isArea(l)){var Pe=oe.getLocation(l,$t.LEFT),st=oe.getLocation(l,$t.RIGHT);if(st!==Te.NONE){if(st!==I)throw new Sl("side location conflict",j.getCoordinate());Pe===Te.NONE&&J.shouldNeverReachHere("found single null side (at "+j.getCoordinate()+")"),I=Pe}else J.isTrue(oe.getLocation(l,$t.LEFT)===Te.NONE,"found single null side"),oe.setLocation(l,$t.RIGHT,I),oe.setLocation(l,$t.LEFT,I)}}},ma.prototype.getCoordinate=function(){var l=this.iterator();return l.hasNext()?l.next().getCoordinate():null},ma.prototype.print=function(l){gn.out.println("EdgeEndStar:   "+this.getCoordinate());for(var h=this.iterator();h.hasNext();)h.next().print(l)},ma.prototype.isAreaLabelsConsistent=function(l){return this.computeEdgeEndLabels(l.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},ma.prototype.checkAreaLabelsConsistent=function(l){var h=this.getEdges();if(h.size()<=0)return!0;var y=h.size()-1,b=h.get(y).getLabel().getLocation(l,$t.LEFT);J.isTrue(b!==Te.NONE,"Found unlabelled area edge");for(var I=b,B=this.iterator();B.hasNext();){var j=B.next().getLabel();J.isTrue(j.isArea(l),"Found non-area edge");var oe=j.getLocation(l,$t.LEFT),Pe=j.getLocation(l,$t.RIGHT);if(oe===Pe||Pe!==I)return!1;I=oe}return!0},ma.prototype.findIndex=function(l){this.iterator();for(var h=0;h<this._edgeList.size();h++)if(this._edgeList.get(h)===l)return h;return-1},ma.prototype.iterator=function(){return this.getEdges().iterator()},ma.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new Oe(this._edgeMap.values())),this._edgeList},ma.prototype.getLocation=function(l,h,y){return this._ptInAreaLocation[l]===Te.NONE&&(this._ptInAreaLocation[l]=Ys.locate(h,y[l].getGeometry())),this._ptInAreaLocation[l]},ma.prototype.toString=function(){var l=new Ae;l.append("EdgeEndStar:   "+this.getCoordinate()),l.append("\n");for(var h=this.iterator();h.hasNext();){var y=h.next();l.append(y),l.append("\n")}return l.toString()},ma.prototype.computeEdgeEndLabels=function(l){for(var h=this.iterator();h.hasNext();)h.next().computeLabel(l)},ma.prototype.computeLabelling=function(l){this.computeEdgeEndLabels(l[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var h=[!1,!1],y=this.iterator();y.hasNext();)for(var b=y.next().getLabel(),I=0;I<2;I++)b.isLine(I)&&b.getLocation(I)===Te.BOUNDARY&&(h[I]=!0);for(var B=this.iterator();B.hasNext();)for(var j=B.next(),oe=j.getLabel(),Pe=0;Pe<2;Pe++)if(oe.isAnyNull(Pe)){var st=Te.NONE;if(h[Pe])st=Te.EXTERIOR;else{var kt=j.getCoordinate();st=this.getLocation(Pe,kt,l)}oe.setAllLocationsIfNull(Pe,st)}},ma.prototype.getDegree=function(){return this._edgeMap.size()},ma.prototype.insertEdgeEnd=function(l,h){this._edgeMap.put(l,h),this._edgeList=null},ma.prototype.interfaces_=function(){return[]},ma.prototype.getClass=function(){return ma};var og=function(l){function h(){l.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var y=null,b=null,I=this._SCANNING_FOR_INCOMING,B=0;B<this._resultAreaEdgeList.size();B++){var j=this._resultAreaEdgeList.get(B),oe=j.getSym();if(j.getLabel().isArea())switch(null===y&&j.isInResult()&&(y=j),I){case this._SCANNING_FOR_INCOMING:if(!oe.isInResult())continue;b=oe,I=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!j.isInResult())continue;b.setNext(j),I=this._SCANNING_FOR_INCOMING}}if(I===this._LINKING_TO_OUTGOING){if(null===y)throw new Sl("no outgoing dirEdge found",this.getCoordinate());J.isTrue(y.isInResult(),"unable to link last incoming dirEdge"),b.setNext(y)}},h.prototype.insert=function(y){this.insertEdgeEnd(y,y)},h.prototype.getRightmostEdge=function(){var y=this.getEdges(),b=y.size();if(b<1)return null;var I=y.get(0);if(1===b)return I;var B=y.get(b-1),j=I.getQuadrant(),oe=B.getQuadrant();return Sr.isNorthern(j)&&Sr.isNorthern(oe)?I:Sr.isNorthern(j)||Sr.isNorthern(oe)?0!==I.getDy()?I:0!==B.getDy()?B:(J.shouldNeverReachHere("found two horizontal edges incident on node"),null):B},h.prototype.print=function(y){gn.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var b=this.iterator();b.hasNext();){var I=b.next();y.print("out "),I.print(y),y.println(),y.print("in "),I.getSym().print(y),y.println()}},h.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Oe;for(var y=this.iterator();y.hasNext();){var b=y.next();(b.isInResult()||b.getSym().isInResult())&&this._resultAreaEdgeList.add(b)}return this._resultAreaEdgeList},h.prototype.updateLabelling=function(y){for(var b=this.iterator();b.hasNext();){var I=b.next().getLabel();I.setAllLocationsIfNull(0,y.getLocation(0)),I.setAllLocationsIfNull(1,y.getLocation(1))}},h.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var y=null,b=null,I=this._edgeList.size()-1;I>=0;I--){var B=this._edgeList.get(I),j=B.getSym();null===b&&(b=j),null!==y&&j.setNext(y),y=B}b.setNext(y)},h.prototype.computeDepths=function(){if(1===arguments.length){var y=arguments[0],b=this.findIndex(y),I=y.getDepth($t.LEFT),B=y.getDepth($t.RIGHT),j=this.computeDepths(b+1,this._edgeList.size(),I);if(this.computeDepths(0,b,j)!==B)throw new Sl("depth mismatch at "+y.getCoordinate())}else if(3===arguments.length){for(var Pe=arguments[1],st=arguments[2],kt=arguments[0];kt<Pe;kt++){var qt=this._edgeList.get(kt);qt.setEdgeDepths($t.RIGHT,st),st=qt.getDepth($t.LEFT)}return st}},h.prototype.mergeSymLabels=function(){for(var y=this.iterator();y.hasNext();){var b=y.next();b.getLabel().merge(b.getSym().getLabel())}},h.prototype.linkMinimalDirectedEdges=function(y){for(var b=null,I=null,B=this._SCANNING_FOR_INCOMING,j=this._resultAreaEdgeList.size()-1;j>=0;j--){var oe=this._resultAreaEdgeList.get(j),Pe=oe.getSym();switch(null===b&&oe.getEdgeRing()===y&&(b=oe),B){case this._SCANNING_FOR_INCOMING:if(Pe.getEdgeRing()!==y)continue;I=Pe,B=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(oe.getEdgeRing()!==y)continue;I.setNextMin(oe),B=this._SCANNING_FOR_INCOMING}}B===this._LINKING_TO_OUTGOING&&(J.isTrue(null!==b,"found null for first outgoing dirEdge"),J.isTrue(b.getEdgeRing()===y,"unable to link last incoming dirEdge"),I.setNextMin(b))},h.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var y=0,b=this.iterator();b.hasNext();)b.next().isInResult()&&y++;return y}if(1===arguments.length){for(var I=arguments[0],B=0,j=this.iterator();j.hasNext();)j.next().getEdgeRing()===I&&B++;return B}},h.prototype.getLabel=function(){return this._label},h.prototype.findCoveredLineEdges=function(){for(var y=Te.NONE,b=this.iterator();b.hasNext();){var I=b.next(),B=I.getSym();if(!I.isLineEdge()){if(I.isInResult()){y=Te.INTERIOR;break}if(B.isInResult()){y=Te.EXTERIOR;break}}}if(y===Te.NONE)return null;for(var j=y,oe=this.iterator();oe.hasNext();){var Pe=oe.next(),st=Pe.getSym();Pe.isLineEdge()?Pe.getEdge().setCovered(j===Te.INTERIOR):(Pe.isInResult()&&(j=Te.EXTERIOR),st.isInResult()&&(j=Te.INTERIOR))}},h.prototype.computeLabelling=function(y){l.prototype.computeLabelling.call(this,y),this._label=new di(Te.NONE);for(var b=this.iterator();b.hasNext();)for(var I=b.next().getEdge().getLabel(),B=0;B<2;B++){var j=I.getLocation(B);j!==Te.INTERIOR&&j!==Te.BOUNDARY||this._label.setLocation(B,Te.INTERIOR)}},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(ma),ep=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.createNode=function(y){return new Eh(y,new og)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(tl),_a=function l(){this._pts=null,this._orientation=null;var h=arguments[0];this._pts=h,this._orientation=l.orientation(h)};_a.prototype.compareTo=function(l){return _a.compareOriented(this._pts,this._orientation,l._pts,l._orientation)},_a.prototype.interfaces_=function(){return[ce]},_a.prototype.getClass=function(){return _a},_a.orientation=function(l){return 1===Qe.increasingDirection(l)},_a.compareOriented=function(l,h,y,b){for(var I=h?1:-1,B=b?1:-1,j=h?l.length:-1,oe=b?y.length:-1,Pe=h?0:l.length-1,st=b?0:y.length-1;;){var kt=l[Pe].compareTo(y[st]);if(0!==kt)return kt;var qt=(Pe+=I)===j,Pn=(st+=B)===oe;if(qt&&!Pn)return-1;if(!qt&&Pn)return 1;if(qt&&Pn)return 0}};var Ra=function(){this._edges=new Oe,this._ocaMap=new Dt};Ra.prototype.print=function(l){l.print("MULTILINESTRING ( ");for(var h=0;h<this._edges.size();h++){var y=this._edges.get(h);h>0&&l.print(","),l.print("(");for(var b=y.getCoordinates(),I=0;I<b.length;I++)I>0&&l.print(","),l.print(b[I].x+" "+b[I].y);l.println(")")}l.print(")  ")},Ra.prototype.addAll=function(l){for(var h=l.iterator();h.hasNext();)this.add(h.next())},Ra.prototype.findEdgeIndex=function(l){for(var h=0;h<this._edges.size();h++)if(this._edges.get(h).equals(l))return h;return-1},Ra.prototype.iterator=function(){return this._edges.iterator()},Ra.prototype.getEdges=function(){return this._edges},Ra.prototype.get=function(l){return this._edges.get(l)},Ra.prototype.findEqualEdge=function(l){var h=new _a(l.getCoordinates());return this._ocaMap.get(h)},Ra.prototype.add=function(l){this._edges.add(l);var h=new _a(l.getCoordinates());this._ocaMap.put(h,l)},Ra.prototype.interfaces_=function(){return[]},Ra.prototype.getClass=function(){return Ra};var oa=function(){};oa.prototype.processIntersections=function(l,h,y,b){},oa.prototype.isDone=function(){},oa.prototype.interfaces_=function(){return[]},oa.prototype.getClass=function(){return oa};var Wo=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0,this._li=arguments[0]};Wo.prototype.isTrivialIntersection=function(l,h,y,b){if(l===y&&1===this._li.getIntersectionNum()){if(Wo.isAdjacentSegments(h,b))return!0;if(l.isClosed()){var I=l.size()-1;if(0===h&&b===I||0===b&&h===I)return!0}}return!1},Wo.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Wo.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Wo.prototype.getLineIntersector=function(){return this._li},Wo.prototype.hasProperIntersection=function(){return this._hasProper},Wo.prototype.processIntersections=function(l,h,y,b){if(l===y&&h===b)return null;this.numTests++;var I=l.getCoordinates()[h],B=l.getCoordinates()[h+1],j=y.getCoordinates()[b],oe=y.getCoordinates()[b+1];this._li.computeIntersection(I,B,j,oe),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(l,h,y,b)||(this._hasIntersection=!0,l.addIntersections(this._li,h,0),y.addIntersections(this._li,b,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Wo.prototype.hasIntersection=function(){return this._hasIntersection},Wo.prototype.isDone=function(){return!1},Wo.prototype.hasInteriorIntersection=function(){return this._hasInterior},Wo.prototype.interfaces_=function(){return[oa]},Wo.prototype.getClass=function(){return Wo},Wo.isAdjacentSegments=function(l,h){return 1===Math.abs(l-h)};var oi=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var h=arguments[1],y=arguments[2];this.coord=new ie(arguments[0]),this.segmentIndex=h,this.dist=y};oi.prototype.getSegmentIndex=function(){return this.segmentIndex},oi.prototype.getCoordinate=function(){return this.coord},oi.prototype.print=function(l){l.print(this.coord),l.print(" seg # = "+this.segmentIndex),l.println(" dist = "+this.dist)},oi.prototype.compareTo=function(l){return this.compare(l.segmentIndex,l.dist)},oi.prototype.isEndPoint=function(l){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===l},oi.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},oi.prototype.getDistance=function(){return this.dist},oi.prototype.compare=function(l,h){return this.segmentIndex<l?-1:this.segmentIndex>l?1:this.dist<h?-1:this.dist>h?1:0},oi.prototype.interfaces_=function(){return[ce]},oi.prototype.getClass=function(){return oi};var pl=function(){this._nodeMap=new Dt,this.edge=null,this.edge=arguments[0]};pl.prototype.print=function(l){l.println("Intersections:");for(var h=this.iterator();h.hasNext();)h.next().print(l)},pl.prototype.iterator=function(){return this._nodeMap.values().iterator()},pl.prototype.addSplitEdges=function(l){this.addEndpoints();for(var h=this.iterator(),y=h.next();h.hasNext();){var b=h.next(),I=this.createSplitEdge(y,b);l.add(I),y=b}},pl.prototype.addEndpoints=function(){var l=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[l],l,0)},pl.prototype.createSplitEdge=function(l,h){var y=h.segmentIndex-l.segmentIndex+2,I=h.dist>0||!h.coord.equals2D(this.edge.pts[h.segmentIndex]);I||y--;var B=new Array(y).fill(null),j=0;B[j++]=new ie(l.coord);for(var oe=l.segmentIndex+1;oe<=h.segmentIndex;oe++)B[j++]=this.edge.pts[oe];return I&&(B[j]=h.coord),new du(B,new di(this.edge._label))},pl.prototype.add=function(l,h,y){var b=new oi(l,h,y),I=this._nodeMap.get(b);return null!==I?I:(this._nodeMap.put(b,b),b)},pl.prototype.isIntersection=function(l){for(var h=this.iterator();h.hasNext();)if(h.next().coord.equals(l))return!0;return!1},pl.prototype.interfaces_=function(){return[]},pl.prototype.getClass=function(){return pl};var ju=function(){};ju.prototype.getChainStartIndices=function(l){var h=0,y=new Oe;y.add(new it(h));do{var b=this.findChainEnd(l,h);y.add(new it(b)),h=b}while(h<l.length-1);return ju.toIntArray(y)},ju.prototype.findChainEnd=function(l,h){for(var y=Sr.quadrant(l[h],l[h+1]),b=h+1;b<l.length&&Sr.quadrant(l[b-1],l[b])===y;)b++;return b-1},ju.prototype.interfaces_=function(){return[]},ju.prototype.getClass=function(){return ju},ju.toIntArray=function(l){for(var h=new Array(l.size()).fill(null),y=0;y<h.length;y++)h[y]=l.get(y).intValue();return h};var il=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new un,this.env2=new un;var l=arguments[0];this.e=l,this.pts=l.getCoordinates();var h=new ju;this.startIndex=h.getChainStartIndices(this.pts)};il.prototype.getCoordinates=function(){return this.pts},il.prototype.getMaxX=function(l){var h=this.pts[this.startIndex[l]].x,y=this.pts[this.startIndex[l+1]].x;return h>y?h:y},il.prototype.getMinX=function(l){var h=this.pts[this.startIndex[l]].x,y=this.pts[this.startIndex[l+1]].x;return h<y?h:y},il.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var l=arguments[0],h=arguments[1],y=arguments[2];this.computeIntersectsForChain(this.startIndex[l],this.startIndex[l+1],h,h.startIndex[y],h.startIndex[y+1],arguments[3])}else if(6===arguments.length){var I=arguments[0],B=arguments[1],j=arguments[2],oe=arguments[3],Pe=arguments[4],st=arguments[5],kt=this.pts[I],qt=this.pts[B],Pn=j.pts[oe],In=j.pts[Pe];if(B-I==1&&Pe-oe==1)return st.addIntersections(this.e,I,j.e,oe),null;if(this.env1.init(kt,qt),this.env2.init(Pn,In),!this.env1.intersects(this.env2))return null;var zn=Math.trunc((I+B)/2),tr=Math.trunc((oe+Pe)/2);I<zn&&(oe<tr&&this.computeIntersectsForChain(I,zn,j,oe,tr,st),tr<Pe&&this.computeIntersectsForChain(I,zn,j,tr,Pe,st)),zn<B&&(oe<tr&&this.computeIntersectsForChain(zn,B,j,oe,tr,st),tr<Pe&&this.computeIntersectsForChain(zn,B,j,tr,Pe,st))}},il.prototype.getStartIndexes=function(){return this.startIndex},il.prototype.computeIntersects=function(l,h){for(var y=0;y<this.startIndex.length-1;y++)for(var b=0;b<l.startIndex.length-1;b++)this.computeIntersectsForChain(y,l,b,h)},il.prototype.interfaces_=function(){return[]},il.prototype.getClass=function(){return il};var rs=function l(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var h=0;h<2;h++)for(var y=0;y<3;y++)this._depth[h][y]=l.NULL_VALUE},hu={NULL_VALUE:{configurable:!0}};rs.prototype.getDepth=function(l,h){return this._depth[l][h]},rs.prototype.setDepth=function(l,h,y){this._depth[l][h]=y},rs.prototype.isNull=function(){if(0===arguments.length){for(var l=0;l<2;l++)for(var h=0;h<3;h++)if(this._depth[l][h]!==rs.NULL_VALUE)return!1;return!0}return 1===arguments.length?this._depth[arguments[0]][1]===rs.NULL_VALUE:2===arguments.length?this._depth[arguments[0]][arguments[1]]===rs.NULL_VALUE:void 0},rs.prototype.normalize=function(){for(var l=0;l<2;l++)if(!this.isNull(l)){var h=this._depth[l][1];this._depth[l][2]<h&&(h=this._depth[l][2]),h<0&&(h=0);for(var y=1;y<3;y++){var b=0;this._depth[l][y]>h&&(b=1),this._depth[l][y]=b}}},rs.prototype.getDelta=function(l){return this._depth[l][$t.RIGHT]-this._depth[l][$t.LEFT]},rs.prototype.getLocation=function(l,h){return this._depth[l][h]<=0?Te.EXTERIOR:Te.INTERIOR},rs.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},rs.prototype.add=function(){if(1===arguments.length)for(var l=arguments[0],h=0;h<2;h++)for(var y=1;y<3;y++){var b=l.getLocation(h,y);b!==Te.EXTERIOR&&b!==Te.INTERIOR||(this.isNull(h,y)?this._depth[h][y]=rs.depthAtLocation(b):this._depth[h][y]+=rs.depthAtLocation(b))}else 3===arguments.length&&arguments[2]===Te.INTERIOR&&this._depth[arguments[0]][arguments[1]]++},rs.prototype.interfaces_=function(){return[]},rs.prototype.getClass=function(){return rs},rs.depthAtLocation=function(l){return l===Te.EXTERIOR?0:l===Te.INTERIOR?1:rs.NULL_VALUE},hu.NULL_VALUE.get=function(){return-1},Object.defineProperties(rs,hu);var du=function(l){function h(){if(l.call(this),this.pts=null,this._env=null,this.eiList=new pl(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new rs,this._depthDelta=0,1===arguments.length)h.call(this,arguments[0],null);else if(2===arguments.length){var I=arguments[1];this.pts=arguments[0],this._label=I}}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDepth=function(){return this._depth},h.prototype.getCollapsedEdge=function(){var y=new Array(2).fill(null);return y[0]=this.pts[0],y[1]=this.pts[1],new h(y,di.toLineLabel(this._label))},h.prototype.isIsolated=function(){return this._isIsolated},h.prototype.getCoordinates=function(){return this.pts},h.prototype.setIsolated=function(y){this._isIsolated=y},h.prototype.setName=function(y){this._name=y},h.prototype.equals=function(y){if(!(y instanceof h))return!1;var b=y;if(this.pts.length!==b.pts.length)return!1;for(var I=!0,B=!0,j=this.pts.length,oe=0;oe<this.pts.length;oe++)if(this.pts[oe].equals2D(b.pts[oe])||(I=!1),this.pts[oe].equals2D(b.pts[--j])||(B=!1),!I&&!B)return!1;return!0},h.prototype.getCoordinate=function(){return 0===arguments.length?this.pts.length>0?this.pts[0]:null:1===arguments.length?this.pts[arguments[0]]:void 0},h.prototype.print=function(y){y.print("edge "+this._name+": "),y.print("LINESTRING (");for(var b=0;b<this.pts.length;b++)b>0&&y.print(","),y.print(this.pts[b].x+" "+this.pts[b].y);y.print(")  "+this._label+" "+this._depthDelta)},h.prototype.computeIM=function(y){h.updateIM(this._label,y)},h.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},h.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},h.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},h.prototype.getDepthDelta=function(){return this._depthDelta},h.prototype.getNumPoints=function(){return this.pts.length},h.prototype.printReverse=function(y){y.print("edge "+this._name+": ");for(var b=this.pts.length-1;b>=0;b--)y.print(this.pts[b]+" ");y.println("")},h.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new il(this)),this._mce},h.prototype.getEnvelope=function(){if(null===this._env){this._env=new un;for(var y=0;y<this.pts.length;y++)this._env.expandToInclude(this.pts[y])}return this._env},h.prototype.addIntersection=function(y,b,I,B){var j=new ie(y.getIntersection(B)),oe=b,Pe=y.getEdgeDistance(I,B),st=oe+1;st<this.pts.length&&j.equals2D(this.pts[st])&&(oe=st,Pe=0),this.eiList.add(j,oe,Pe)},h.prototype.toString=function(){var y=new Ae;y.append("edge "+this._name+": "),y.append("LINESTRING (");for(var b=0;b<this.pts.length;b++)b>0&&y.append(","),y.append(this.pts[b].x+" "+this.pts[b].y);return y.append(")  "+this._label+" "+this._depthDelta),y.toString()},h.prototype.isPointwiseEqual=function(y){if(this.pts.length!==y.pts.length)return!1;for(var b=0;b<this.pts.length;b++)if(!this.pts[b].equals2D(y.pts[b]))return!1;return!0},h.prototype.setDepthDelta=function(y){this._depthDelta=y},h.prototype.getEdgeIntersectionList=function(){return this.eiList},h.prototype.addIntersections=function(y,b,I){for(var B=0;B<y.getIntersectionNum();B++)this.addIntersection(y,b,I,B)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.updateIM=function(){if(2!==arguments.length)return l.prototype.updateIM.apply(this,arguments);var y=arguments[0],b=arguments[1];b.setAtLeastIfValid(y.getLocation(0,$t.ON),y.getLocation(1,$t.ON),1),y.isArea()&&(b.setAtLeastIfValid(y.getLocation(0,$t.LEFT),y.getLocation(1,$t.LEFT),2),b.setAtLeastIfValid(y.getLocation(0,$t.RIGHT),y.getLocation(1,$t.RIGHT),2))},h}(el),Ks=function(l){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Ra,this._bufParams=l||null};Ks.prototype.setWorkingPrecisionModel=function(l){this._workingPrecisionModel=l},Ks.prototype.insertUniqueEdge=function(l){var h=this._edgeList.findEqualEdge(l);if(null!==h){var y=h.getLabel(),b=l.getLabel();h.isPointwiseEqual(l)||(b=new di(l.getLabel())).flip(),y.merge(b);var I=Ks.depthDelta(b),B=h.getDepthDelta()+I;h.setDepthDelta(B)}else this._edgeList.add(l),l.setDepthDelta(Ks.depthDelta(l.getLabel()))},Ks.prototype.buildSubgraphs=function(l,h){for(var y=new Oe,b=l.iterator();b.hasNext();){var I=b.next(),B=I.getRightmostCoordinate(),j=new rl(y).getDepth(B);I.computeDepth(j),I.findResultEdges(),y.add(I),h.add(I.getDirectedEdges(),I.getNodes())}},Ks.prototype.createSubgraphs=function(l){for(var h=new Oe,y=l.getNodes().iterator();y.hasNext();){var b=y.next();if(!b.isVisited()){var I=new Rs;I.create(b),h.add(I)}}return ti.sort(h,ti.reverseOrder()),h},Ks.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},Ks.prototype.getNoder=function(l){if(null!==this._workingNoder)return this._workingNoder;var h=new Eo,y=new Tt;return y.setPrecisionModel(l),h.setSegmentIntersector(new Wo(y)),h},Ks.prototype.buffer=function(l,h){var y=this._workingPrecisionModel;null===y&&(y=l.getPrecisionModel()),this._geomFact=l.getFactory();var b=new ia(y,this._bufParams),I=new Vn(l,h,b).getCurves();if(I.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(I,y),this._graph=new Vo(new ep),this._graph.addEdges(this._edgeList.getEdges());var B=this.createSubgraphs(this._graph),j=new Ws(this._geomFact);this.buildSubgraphs(B,j);var oe=j.getPolygons();return oe.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(oe)},Ks.prototype.computeNodedEdges=function(l,h){var y=this.getNoder(h);y.computeNodes(l);for(var b=y.getNodedSubstrings().iterator();b.hasNext();){var I=b.next(),B=I.getCoordinates();if(2!==B.length||!B[0].equals2D(B[1])){var j=I.getData(),oe=new du(I.getCoordinates(),new di(j));this.insertUniqueEdge(oe)}}},Ks.prototype.setNoder=function(l){this._workingNoder=l},Ks.prototype.interfaces_=function(){return[]},Ks.prototype.getClass=function(){return Ks},Ks.depthDelta=function(l){var h=l.getLocation(0,$t.LEFT),y=l.getLocation(0,$t.RIGHT);return h===Te.INTERIOR&&y===Te.EXTERIOR?1:h===Te.EXTERIOR&&y===Te.INTERIOR?-1:0},Ks.convertSegStrings=function(l){for(var h=new ur,y=new Oe;l.hasNext();){var b=l.next(),I=h.createLineString(b.getCoordinates());y.add(I)}return h.buildGeometry(y)};var ya=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var h=arguments[1];this._noder=arguments[0],this._scaleFactor=h,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var b=arguments[1],I=arguments[2],B=arguments[3];this._noder=arguments[0],this._scaleFactor=b,this._offsetX=I,this._offsetY=B,this._isScaled=!this.isIntegerPrecision()}};ya.prototype.rescale=function(){if(At(arguments[0],ae))for(var l=arguments[0].iterator();l.hasNext();){var h=l.next();this.rescale(h.getCoordinates())}else if(arguments[0]instanceof Array){for(var y=arguments[0],b=0;b<y.length;b++)y[b].x=y[b].x/this._scaleFactor+this._offsetX,y[b].y=y[b].y/this._scaleFactor+this._offsetY;2===y.length&&y[0].equals2D(y[1])&&gn.out.println(y)}},ya.prototype.scale=function(){if(At(arguments[0],ae)){for(var l=arguments[0],h=new Oe,y=l.iterator();y.hasNext();){var b=y.next();h.add(new jo(this.scale(b.getCoordinates()),b.getData()))}return h}if(arguments[0]instanceof Array){for(var I=arguments[0],B=new Array(I.length).fill(null),j=0;j<I.length;j++)B[j]=new ie(Math.round((I[j].x-this._offsetX)*this._scaleFactor),Math.round((I[j].y-this._offsetY)*this._scaleFactor),I[j].z);return Qe.removeRepeatedPoints(B)}},ya.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},ya.prototype.getNodedSubstrings=function(){var l=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(l),l},ya.prototype.computeNodes=function(l){var h=l;this._isScaled&&(h=this.scale(l)),this._noder.computeNodes(h)},ya.prototype.interfaces_=function(){return[Iu]},ya.prototype.getClass=function(){return ya};var qa=function(){this._li=new Tt,this._segStrings=null,this._segStrings=arguments[0]},ed={fact:{configurable:!0}};qa.prototype.checkEndPtVertexIntersections=function(){if(0===arguments.length)for(var l=this._segStrings.iterator();l.hasNext();){var h=l.next().getCoordinates();this.checkEndPtVertexIntersections(h[0],this._segStrings),this.checkEndPtVertexIntersections(h[h.length-1],this._segStrings)}else if(2===arguments.length)for(var y=arguments[0],b=arguments[1].iterator();b.hasNext();)for(var I=b.next().getCoordinates(),B=1;B<I.length-1;B++)if(I[B].equals(y))throw new Z("found endpt/interior pt intersection at index "+B+" :pt "+y)},qa.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var l=this._segStrings.iterator();l.hasNext();)for(var h=l.next(),y=this._segStrings.iterator();y.hasNext();){var b=y.next();this.checkInteriorIntersections(h,b)}else if(2===arguments.length)for(var I=arguments[0],B=arguments[1],j=I.getCoordinates(),oe=B.getCoordinates(),Pe=0;Pe<j.length-1;Pe++)for(var st=0;st<oe.length-1;st++)this.checkInteriorIntersections(I,Pe,B,st);else if(4===arguments.length){var kt=arguments[0],qt=arguments[1],Pn=arguments[2],In=arguments[3];if(kt===Pn&&qt===In)return null;var zn=kt.getCoordinates()[qt],tr=kt.getCoordinates()[qt+1],Mi=Pn.getCoordinates()[In],Tn=Pn.getCoordinates()[In+1];if(this._li.computeIntersection(zn,tr,Mi,Tn),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,zn,tr)||this.hasInteriorIntersection(this._li,Mi,Tn)))throw new Z("found non-noded intersection at "+zn+"-"+tr+" and "+Mi+"-"+Tn)}},qa.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},qa.prototype.checkCollapses=function(){if(0===arguments.length)for(var l=this._segStrings.iterator();l.hasNext();){var h=l.next();this.checkCollapses(h)}else if(1===arguments.length)for(var y=arguments[0].getCoordinates(),b=0;b<y.length-2;b++)this.checkCollapse(y[b],y[b+1],y[b+2])},qa.prototype.hasInteriorIntersection=function(l,h,y){for(var b=0;b<l.getIntersectionNum();b++){var I=l.getIntersection(b);if(!I.equals(h)&&!I.equals(y))return!0}return!1},qa.prototype.checkCollapse=function(l,h,y){if(l.equals(y))throw new Z("found non-noded collapse at "+qa.fact.createLineString([l,h,y]))},qa.prototype.interfaces_=function(){return[]},qa.prototype.getClass=function(){return qa},ed.fact.get=function(){return new ur},Object.defineProperties(qa,ed);var Js=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var l=arguments[0],h=arguments[1],y=arguments[2];if(this._originalPt=l,this._pt=l,this._scaleFactor=h,this._li=y,h<=0)throw new fe("Scale factor must be non-zero");1!==h&&(this._pt=new ie(this.scale(l.x),this.scale(l.y)),this._p0Scaled=new ie,this._p1Scaled=new ie),this.initCorners(this._pt)},eh={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};Js.prototype.intersectsScaled=function(l,h){var y=Math.min(l.x,h.x),b=Math.max(l.x,h.x),I=Math.min(l.y,h.y),B=Math.max(l.y,h.y),j=this._maxx<y||this._minx>b||this._maxy<I||this._miny>B;if(j)return!1;var oe=this.intersectsToleranceSquare(l,h);return J.isTrue(!(j&&oe),"Found bad envelope test"),oe},Js.prototype.initCorners=function(l){this._minx=l.x-.5,this._maxx=l.x+.5,this._miny=l.y-.5,this._maxy=l.y+.5,this._corner[0]=new ie(this._maxx,this._maxy),this._corner[1]=new ie(this._minx,this._maxy),this._corner[2]=new ie(this._minx,this._miny),this._corner[3]=new ie(this._maxx,this._miny)},Js.prototype.intersects=function(l,h){return 1===this._scaleFactor?this.intersectsScaled(l,h):(this.copyScaled(l,this._p0Scaled),this.copyScaled(h,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},Js.prototype.scale=function(l){return Math.round(l*this._scaleFactor)},Js.prototype.getCoordinate=function(){return this._originalPt},Js.prototype.copyScaled=function(l,h){h.x=this.scale(l.x),h.y=this.scale(l.y)},Js.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var l=Js.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new un(this._originalPt.x-l,this._originalPt.x+l,this._originalPt.y-l,this._originalPt.y+l)}return this._safeEnv},Js.prototype.intersectsPixelClosure=function(l,h){return this._li.computeIntersection(l,h,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(l,h,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(l,h,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(l,h,this._corner[3],this._corner[0]),this._li.hasIntersection()))))},Js.prototype.intersectsToleranceSquare=function(l,h){var y=!1,b=!1;return this._li.computeIntersection(l,h,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(l,h,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(y=!0),this._li.computeIntersection(l,h,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(b=!0),this._li.computeIntersection(l,h,this._corner[3],this._corner[0]),this._li.isProper()||y&&b||l.equals(this._pt)||h.equals(this._pt)))))},Js.prototype.addSnappedNode=function(l,h){var y=l.getCoordinate(h),b=l.getCoordinate(h+1);return!!this.intersects(y,b)&&(l.addIntersection(this.getCoordinate(),h),!0)},Js.prototype.interfaces_=function(){return[]},Js.prototype.getClass=function(){return Js},eh.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(Js,eh);var Ic=function(){this.tempEnv1=new un,this.selectedSegment=new er};Ic.prototype.select=function(){1!==arguments.length&&2===arguments.length&&(arguments[0].getLineSegment(arguments[1],this.selectedSegment),this.select(this.selectedSegment))},Ic.prototype.interfaces_=function(){return[]},Ic.prototype.getClass=function(){return Ic};var th=function(){this._index=null,this._index=arguments[0]},Fd={HotPixelSnapAction:{configurable:!0}};th.prototype.snap=function(){if(1===arguments.length)return this.snap(arguments[0],null,-1);if(3===arguments.length){var h=arguments[0],y=arguments[1],b=arguments[2],I=h.getSafeEnvelope(),B=new Sh(h,y,b);return this._index.query(I,{interfaces_:function(){return[nl]},visitItem:function(j){j.select(I,B)}}),B.isNodeAdded()}},th.prototype.interfaces_=function(){return[]},th.prototype.getClass=function(){return th},Fd.HotPixelSnapAction.get=function(){return Sh},Object.defineProperties(th,Fd);var Sh=function(l){function h(){l.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var b=arguments[1],I=arguments[2];this._hotPixel=arguments[0],this._parentEdge=b,this._hotPixelVertexIndex=I}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.isNodeAdded=function(){return this._isNodeAdded},h.prototype.select=function(){if(2!==arguments.length)return l.prototype.select.apply(this,arguments);var b=arguments[1],I=arguments[0].getContext();if(null!==this._parentEdge&&I===this._parentEdge&&b===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(I,b)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Ic),Mu=function(){this._li=null,this._interiorIntersections=null,this._li=arguments[0],this._interiorIntersections=new Oe};Mu.prototype.processIntersections=function(l,h,y,b){if(l===y&&h===b)return null;var I=l.getCoordinates()[h],B=l.getCoordinates()[h+1],j=y.getCoordinates()[b],oe=y.getCoordinates()[b+1];if(this._li.computeIntersection(I,B,j,oe),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var Pe=0;Pe<this._li.getIntersectionNum();Pe++)this._interiorIntersections.add(this._li.getIntersection(Pe));l.addIntersections(this._li,h,0),y.addIntersections(this._li,b,1)}},Mu.prototype.isDone=function(){return!1},Mu.prototype.getInteriorIntersections=function(){return this._interiorIntersections},Mu.prototype.interfaces_=function(){return[oa]},Mu.prototype.getClass=function(){return Mu};var fu=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var l=arguments[0];this._pm=l,this._li=new Tt,this._li.setPrecisionModel(l),this._scaleFactor=l.getScale()};fu.prototype.checkCorrectness=function(l){var h=jo.getNodedSubstrings(l),y=new qa(h);try{y.checkValid()}catch(b){if(!(b instanceof Nn))throw b;b.printStackTrace()}},fu.prototype.getNodedSubstrings=function(){return jo.getNodedSubstrings(this._nodedSegStrings)},fu.prototype.snapRound=function(l,h){var y=this.findInteriorIntersections(l,h);this.computeIntersectionSnaps(y),this.computeVertexSnaps(l)},fu.prototype.findInteriorIntersections=function(l,h){var y=new Mu(h);return this._noder.setSegmentIntersector(y),this._noder.computeNodes(l),y.getInteriorIntersections()},fu.prototype.computeVertexSnaps=function(){if(At(arguments[0],ae))for(var l=arguments[0].iterator();l.hasNext();){var h=l.next();this.computeVertexSnaps(h)}else if(arguments[0]instanceof jo)for(var y=arguments[0],b=y.getCoordinates(),I=0;I<b.length;I++){var B=new Js(b[I],this._scaleFactor,this._li);this._pointSnapper.snap(B,y,I)&&y.addIntersection(b[I],I)}},fu.prototype.computeNodes=function(l){this._nodedSegStrings=l,this._noder=new Eo,this._pointSnapper=new th(this._noder.getIndex()),this.snapRound(l,this._li)},fu.prototype.computeIntersectionSnaps=function(l){for(var h=l.iterator();h.hasNext();){var y=h.next(),b=new Js(y,this._scaleFactor,this._li);this._pointSnapper.snap(b)}},fu.prototype.interfaces_=function(){return[Iu]},fu.prototype.getClass=function(){return fu};var vo=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new bi,this._resultGeometry=null,this._saveException=null,1===arguments.length)this._argGeom=arguments[0];else if(2===arguments.length){var y=arguments[1];this._argGeom=arguments[0],this._bufParams=y}},Dh={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};vo.prototype.bufferFixedPrecision=function(l){var h=new ya(new fu(new on(1)),l.getScale()),y=new Ks(this._bufParams);y.setWorkingPrecisionModel(l),y.setNoder(h),this._resultGeometry=y.buffer(this._argGeom,this._distance)},vo.prototype.bufferReducedPrecision=function(){var l=this;if(0===arguments.length){for(var h=vo.MAX_PRECISION_DIGITS;h>=0;h--){try{l.bufferReducedPrecision(h)}catch(B){if(!(B instanceof Sl))throw B;l._saveException=B}if(null!==l._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var b=vo.precisionScaleFactor(this._argGeom,this._distance,arguments[0]),I=new on(b);this.bufferFixedPrecision(I)}},vo.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var l=this._argGeom.getFactory().getPrecisionModel();l.getType()===on.FIXED?this.bufferFixedPrecision(l):this.bufferReducedPrecision()},vo.prototype.setQuadrantSegments=function(l){this._bufParams.setQuadrantSegments(l)},vo.prototype.bufferOriginalPrecision=function(){try{var l=new Ks(this._bufParams);this._resultGeometry=l.buffer(this._argGeom,this._distance)}catch(h){if(!(h instanceof Z))throw h;this._saveException=h}},vo.prototype.getResultGeometry=function(l){return this._distance=l,this.computeGeometry(),this._resultGeometry},vo.prototype.setEndCapStyle=function(l){this._bufParams.setEndCapStyle(l)},vo.prototype.interfaces_=function(){return[]},vo.prototype.getClass=function(){return vo},vo.bufferOp=function(){if(2===arguments.length){var h=arguments[1];return new vo(arguments[0]).getResultGeometry(h)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Sn&&"number"==typeof arguments[1]){var b=arguments[1],I=arguments[2],B=new vo(arguments[0]);return B.setQuadrantSegments(I),B.getResultGeometry(b)}if(arguments[2]instanceof bi&&arguments[0]instanceof Sn&&"number"==typeof arguments[1]){var oe=arguments[1];return new vo(arguments[0],arguments[2]).getResultGeometry(oe)}}else if(4===arguments.length){var kt=arguments[1],qt=arguments[2],Pn=arguments[3],In=new vo(arguments[0]);return In.setQuadrantSegments(qt),In.setEndCapStyle(Pn),In.getResultGeometry(kt)}},vo.precisionScaleFactor=function(l,h,y){var b=l.getEnvelopeInternal(),I=we.max(Math.abs(b.getMaxX()),Math.abs(b.getMaxY()),Math.abs(b.getMinX()),Math.abs(b.getMinY()))+2*(h>0?h:0),B=y-Math.trunc(Math.log(I)/Math.log(10)+1);return Math.pow(10,B)},Dh.CAP_ROUND.get=function(){return bi.CAP_ROUND},Dh.CAP_BUTT.get=function(){return bi.CAP_FLAT},Dh.CAP_FLAT.get=function(){return bi.CAP_FLAT},Dh.CAP_SQUARE.get=function(){return bi.CAP_SQUARE},Dh.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(vo,Dh);var Qs=function(){this._pt=[new ie,new ie],this._distance=he.NaN,this._isNull=!0};Qs.prototype.getCoordinates=function(){return this._pt},Qs.prototype.getCoordinate=function(l){return this._pt[l]},Qs.prototype.setMinimum=function(){if(1===arguments.length){var l=arguments[0];this.setMinimum(l._pt[0],l._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var b=h.distance(y);b<this._distance&&this.initialize(h,y,b)}},Qs.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var l=arguments[0],h=arguments[1];this._pt[0].setCoordinate(l),this._pt[1].setCoordinate(h),this._distance=l.distance(h),this._isNull=!1}else if(3===arguments.length){var b=arguments[1],I=arguments[2];this._pt[0].setCoordinate(arguments[0]),this._pt[1].setCoordinate(b),this._distance=I,this._isNull=!1}},Qs.prototype.getDistance=function(){return this._distance},Qs.prototype.setMaximum=function(){if(1===arguments.length){var l=arguments[0];this.setMaximum(l._pt[0],l._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var b=h.distance(y);b>this._distance&&this.initialize(h,y,b)}},Qs.prototype.interfaces_=function(){return[]},Qs.prototype.getClass=function(){return Qs};var pu=function(){};pu.prototype.interfaces_=function(){return[]},pu.prototype.getClass=function(){return pu},pu.computeDistance=function(){if(arguments[2]instanceof Qs&&arguments[0]instanceof vi&&arguments[1]instanceof ie)for(var h=arguments[1],y=arguments[2],b=arguments[0].getCoordinates(),I=new er,B=0;B<b.length-1;B++){I.setCoordinates(b[B],b[B+1]);var j=I.closestPoint(h);y.setMinimum(j,h)}else if(arguments[2]instanceof Qs&&arguments[0]instanceof qo&&arguments[1]instanceof ie){var oe=arguments[0],Pe=arguments[1],st=arguments[2];pu.computeDistance(oe.getExteriorRing(),Pe,st);for(var kt=0;kt<oe.getNumInteriorRing();kt++)pu.computeDistance(oe.getInteriorRingN(kt),Pe,st)}else if(arguments[2]instanceof Qs&&arguments[0]instanceof Sn&&arguments[1]instanceof ie){var qt=arguments[0],Pn=arguments[1],In=arguments[2];if(qt instanceof vi)pu.computeDistance(qt,Pn,In);else if(qt instanceof qo)pu.computeDistance(qt,Pn,In);else if(qt instanceof Vi)for(var zn=qt,tr=0;tr<zn.getNumGeometries();tr++){var Mi=zn.getGeometryN(tr);pu.computeDistance(Mi,Pn,In)}else In.setMinimum(qt.getCoordinate(),Pn)}else if(arguments[2]instanceof Qs&&arguments[0]instanceof er&&arguments[1]instanceof ie){var wa=arguments[1],Ea=arguments[2],ml=arguments[0].closestPoint(wa);Ea.setMinimum(ml,wa)}};var gu=function(l){this._maxPtDist=new Qs,this._inputGeom=l||null},Bd={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};gu.prototype.computeMaxMidpointDistance=function(l){var h=new Au(this._inputGeom);l.apply(h),this._maxPtDist.setMaximum(h.getMaxPointDistance())},gu.prototype.computeMaxVertexDistance=function(l){var h=new Gu(this._inputGeom);l.apply(h),this._maxPtDist.setMaximum(h.getMaxPointDistance())},gu.prototype.findDistance=function(l){return this.computeMaxVertexDistance(l),this.computeMaxMidpointDistance(l),this._maxPtDist.getDistance()},gu.prototype.getDistancePoints=function(){return this._maxPtDist},gu.prototype.interfaces_=function(){return[]},gu.prototype.getClass=function(){return gu},Bd.MaxPointDistanceFilter.get=function(){return Gu},Bd.MaxMidpointDistanceFilter.get=function(){return Au},Object.defineProperties(gu,Bd);var Gu=function(l){this._maxPtDist=new Qs,this._minPtDist=new Qs,this._geom=l||null};Gu.prototype.filter=function(l){this._minPtDist.initialize(),pu.computeDistance(this._geom,l,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Gu.prototype.getMaxPointDistance=function(){return this._maxPtDist},Gu.prototype.interfaces_=function(){return[Fr]},Gu.prototype.getClass=function(){return Gu};var Au=function(l){this._maxPtDist=new Qs,this._minPtDist=new Qs,this._geom=l||null};Au.prototype.filter=function(l,h){if(0===h)return null;var y=l.getCoordinate(h-1),b=l.getCoordinate(h),I=new ie((y.x+b.x)/2,(y.y+b.y)/2);this._minPtDist.initialize(),pu.computeDistance(this._geom,I,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Au.prototype.isDone=function(){return!1},Au.prototype.isGeometryChanged=function(){return!1},Au.prototype.getMaxPointDistance=function(){return this._maxPtDist},Au.prototype.interfaces_=function(){return[To]},Au.prototype.getClass=function(){return Au};var gl=function(l){this._comps=l||null};gl.prototype.filter=function(l){l instanceof qo&&this._comps.add(l)},gl.prototype.interfaces_=function(){return[$s]},gl.prototype.getClass=function(){return gl},gl.getPolygons=function(){if(1===arguments.length)return gl.getPolygons(arguments[0],new Oe);if(2===arguments.length){var h=arguments[0],y=arguments[1];return h instanceof qo?y.add(h):h instanceof Vi&&h.apply(new gl(y)),y}};var sa=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length)this._lines=arguments[0];else if(2===arguments.length){var y=arguments[1];this._lines=arguments[0],this._isForcedToLineString=y}};sa.prototype.filter=function(l){if(this._isForcedToLineString&&l instanceof Hs){var h=l.getFactory().createLineString(l.getCoordinateSequence());return this._lines.add(h),null}l instanceof vi&&this._lines.add(l)},sa.prototype.setForceToLineString=function(l){this._isForcedToLineString=l},sa.prototype.interfaces_=function(){return[_r]},sa.prototype.getClass=function(){return sa},sa.getGeometry=function(){if(1===arguments.length){var l=arguments[0];return l.getFactory().buildGeometry(sa.getLines(l))}if(2===arguments.length){var h=arguments[0],y=arguments[1];return h.getFactory().buildGeometry(sa.getLines(h,y))}},sa.getLines=function(){if(1===arguments.length)return sa.getLines(arguments[0],!1);if(2===arguments.length){if(At(arguments[0],ae)&&At(arguments[1],ae)){for(var y=arguments[1],b=arguments[0].iterator();b.hasNext();){var I=b.next();sa.getLines(I,y)}return y}if(arguments[0]instanceof Sn&&"boolean"==typeof arguments[1]){var B=arguments[0],j=arguments[1],oe=new Oe;return B.apply(new sa(oe,j)),oe}if(arguments[0]instanceof Sn&&At(arguments[1],ae)){var Pe=arguments[0],st=arguments[1];return Pe instanceof vi?st.add(Pe):Pe.apply(new sa(st)),st}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&At(arguments[0],ae)&&At(arguments[1],ae)){for(var qt=arguments[1],Pn=arguments[2],In=arguments[0].iterator();In.hasNext();){var zn=In.next();sa.getLines(zn,qt,Pn)}return qt}if("boolean"==typeof arguments[2]&&arguments[0]instanceof Sn&&At(arguments[1],ae)){var Mi=arguments[1];return arguments[0].apply(new sa(Mi,arguments[2])),Mi}}};var Zl=function(){if(this._boundaryRule=mr.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0!==arguments.length&&1===arguments.length){var l=arguments[0];if(null===l)throw new fe("Rule must be non-null");this._boundaryRule=l}};Zl.prototype.locateInternal=function(){if(arguments[0]instanceof ie&&arguments[1]instanceof qo){var l=arguments[0],h=arguments[1];if(h.isEmpty())return Te.EXTERIOR;var y=h.getExteriorRing(),b=this.locateInPolygonRing(l,y);if(b===Te.EXTERIOR)return Te.EXTERIOR;if(b===Te.BOUNDARY)return Te.BOUNDARY;for(var I=0;I<h.getNumInteriorRing();I++){var B=h.getInteriorRingN(I),j=this.locateInPolygonRing(l,B);if(j===Te.INTERIOR)return Te.EXTERIOR;if(j===Te.BOUNDARY)return Te.BOUNDARY}return Te.INTERIOR}if(arguments[0]instanceof ie&&arguments[1]instanceof vi){var oe=arguments[0],Pe=arguments[1];if(!Pe.getEnvelopeInternal().intersects(oe))return Te.EXTERIOR;var st=Pe.getCoordinates();return Pe.isClosed()||!oe.equals(st[0])&&!oe.equals(st[st.length-1])?Ot.isOnLine(oe,st)?Te.INTERIOR:Te.EXTERIOR:Te.BOUNDARY}if(arguments[0]instanceof ie&&arguments[1]instanceof ps){var kt=arguments[0];return arguments[1].getCoordinate().equals2D(kt)?Te.INTERIOR:Te.EXTERIOR}},Zl.prototype.locateInPolygonRing=function(l,h){return h.getEnvelopeInternal().intersects(l)?Ot.locatePointInRing(l,h.getCoordinates()):Te.EXTERIOR},Zl.prototype.intersects=function(l,h){return this.locate(l,h)!==Te.EXTERIOR},Zl.prototype.updateLocationInfo=function(l){l===Te.INTERIOR&&(this._isIn=!0),l===Te.BOUNDARY&&this._numBoundaries++},Zl.prototype.computeLocation=function(l,h){if(h instanceof ps&&this.updateLocationInfo(this.locateInternal(l,h)),h instanceof vi)this.updateLocationInfo(this.locateInternal(l,h));else if(h instanceof qo)this.updateLocationInfo(this.locateInternal(l,h));else if(h instanceof Bl)for(var y=h,b=0;b<y.getNumGeometries();b++){var I=y.getGeometryN(b);this.updateLocationInfo(this.locateInternal(l,I))}else if(h instanceof da)for(var B=h,j=0;j<B.getNumGeometries();j++){var oe=B.getGeometryN(j);this.updateLocationInfo(this.locateInternal(l,oe))}else if(h instanceof Vi)for(var Pe=new ga(h);Pe.hasNext();){var st=Pe.next();st!==h&&this.computeLocation(l,st)}},Zl.prototype.locate=function(l,h){return h.isEmpty()?Te.EXTERIOR:h instanceof vi||h instanceof qo?this.locateInternal(l,h):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(l,h),this._boundaryRule.isInBoundary(this._numBoundaries)?Te.BOUNDARY:this._numBoundaries>0||this._isIn?Te.INTERIOR:Te.EXTERIOR)},Zl.prototype.interfaces_=function(){return[]},Zl.prototype.getClass=function(){return Zl};var Bi=function l(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length)l.call(this,arguments[0],l.INSIDE_AREA,arguments[1]);else if(3===arguments.length){var I=arguments[1],B=arguments[2];this._component=arguments[0],this._segIndex=I,this._pt=B}},tp={INSIDE_AREA:{configurable:!0}};Bi.prototype.isInsideArea=function(){return this._segIndex===Bi.INSIDE_AREA},Bi.prototype.getCoordinate=function(){return this._pt},Bi.prototype.getGeometryComponent=function(){return this._component},Bi.prototype.getSegmentIndex=function(){return this._segIndex},Bi.prototype.interfaces_=function(){return[]},Bi.prototype.getClass=function(){return Bi},tp.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Bi,tp);var lc=function(l){this._pts=l||null};lc.prototype.filter=function(l){l instanceof ps&&this._pts.add(l)},lc.prototype.interfaces_=function(){return[$s]},lc.prototype.getClass=function(){return lc},lc.getPoints=function(){if(1===arguments.length){var l=arguments[0];return l instanceof ps?ti.singletonList(l):lc.getPoints(l,new Oe)}if(2===arguments.length){var h=arguments[0],y=arguments[1];return h instanceof ps?y.add(h):h instanceof Vi&&h.apply(new lc(y)),y}};var Mc=function(){this._locations=null,this._locations=arguments[0]};Mc.prototype.filter=function(l){(l instanceof ps||l instanceof vi||l instanceof qo)&&this._locations.add(new Bi(l,0,l.getCoordinate()))},Mc.prototype.interfaces_=function(){return[$s]},Mc.prototype.getClass=function(){return Mc},Mc.getLocations=function(l){var h=new Oe;return l.apply(new Mc(h)),h};var Or=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Zl,this._minDistanceLocation=null,this._minDistance=he.MAX_VALUE,2===arguments.length)this._geom=[arguments[0],arguments[1]],this._terminateDistance=0;else if(3===arguments.length){var y=arguments[0],b=arguments[1],I=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=y,this._geom[1]=b,this._terminateDistance=I}};Or.prototype.computeContainmentDistance=function(){if(0===arguments.length){var l=new Array(2).fill(null);if(this.computeContainmentDistance(0,l),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,l)}else if(2===arguments.length){var h=arguments[0],y=arguments[1],b=1-h,I=gl.getPolygons(this._geom[h]);if(I.size()>0){var B=Mc.getLocations(this._geom[b]);if(this.computeContainmentDistance(B,I,y),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[b]=y[0],this._minDistanceLocation[h]=y[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&At(arguments[0],tt)&&At(arguments[1],tt)){for(var j=arguments[0],oe=arguments[1],Pe=arguments[2],st=0;st<j.size();st++)for(var kt=j.get(st),qt=0;qt<oe.size();qt++)if(this.computeContainmentDistance(kt,oe.get(qt),Pe),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Bi&&arguments[1]instanceof qo){var Pn=arguments[0],In=arguments[1],zn=arguments[2],tr=Pn.getCoordinate();if(Te.EXTERIOR!==this._ptLocator.locate(tr,In))return this._minDistance=0,zn[0]=Pn,zn[1]=new Bi(In,tr),null}},Or.prototype.computeMinDistanceLinesPoints=function(l,h,y){for(var b=0;b<l.size();b++)for(var I=l.get(b),B=0;B<h.size();B++){var j=h.get(B);if(this.computeMinDistance(I,j,y),this._minDistance<=this._terminateDistance)return null}},Or.prototype.computeFacetDistance=function(){var l=new Array(2).fill(null),h=sa.getLines(this._geom[0]),y=sa.getLines(this._geom[1]),b=lc.getPoints(this._geom[0]),I=lc.getPoints(this._geom[1]);return this.computeMinDistanceLines(h,y,l),this.updateMinDistance(l,!1),this._minDistance<=this._terminateDistance?null:(l[0]=null,l[1]=null,this.computeMinDistanceLinesPoints(h,I,l),this.updateMinDistance(l,!1),this._minDistance<=this._terminateDistance?null:(l[0]=null,l[1]=null,this.computeMinDistanceLinesPoints(y,b,l),this.updateMinDistance(l,!0),this._minDistance<=this._terminateDistance?null:(l[0]=null,l[1]=null,this.computeMinDistancePoints(b,I,l),void this.updateMinDistance(l,!1))))},Or.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},Or.prototype.updateMinDistance=function(l,h){if(null===l[0])return null;h?(this._minDistanceLocation[0]=l[1],this._minDistanceLocation[1]=l[0]):(this._minDistanceLocation[0]=l[0],this._minDistanceLocation[1]=l[1])},Or.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},Or.prototype.computeMinDistance=function(){if(0===arguments.length){if(null!==this._minDistanceLocation||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof vi&&arguments[1]instanceof ps){var l=arguments[0],h=arguments[1],y=arguments[2];if(l.getEnvelopeInternal().distance(h.getEnvelopeInternal())>this._minDistance)return null;for(var b=l.getCoordinates(),I=h.getCoordinate(),B=0;B<b.length-1;B++){var j=Ot.distancePointLine(I,b[B],b[B+1]);if(j<this._minDistance){this._minDistance=j;var oe=new er(b[B],b[B+1]).closestPoint(I);y[0]=new Bi(l,B,oe),y[1]=new Bi(h,0,I)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof vi&&arguments[1]instanceof vi){var Pe=arguments[0],st=arguments[1],kt=arguments[2];if(Pe.getEnvelopeInternal().distance(st.getEnvelopeInternal())>this._minDistance)return null;for(var qt=Pe.getCoordinates(),Pn=st.getCoordinates(),In=0;In<qt.length-1;In++)for(var zn=0;zn<Pn.length-1;zn++){var tr=Ot.distanceLineLine(qt[In],qt[In+1],Pn[zn],Pn[zn+1]);if(tr<this._minDistance){this._minDistance=tr;var Mi=new er(qt[In],qt[In+1]),Tn=new er(Pn[zn],Pn[zn+1]),wa=Mi.closestPoints(Tn);kt[0]=new Bi(Pe,In,wa[0]),kt[1]=new Bi(st,zn,wa[1])}if(this._minDistance<=this._terminateDistance)return null}}},Or.prototype.computeMinDistancePoints=function(l,h,y){for(var b=0;b<l.size();b++)for(var I=l.get(b),B=0;B<h.size();B++){var j=h.get(B),oe=I.getCoordinate().distance(j.getCoordinate());if(oe<this._minDistance&&(this._minDistance=oe,y[0]=new Bi(I,0,I.getCoordinate()),y[1]=new Bi(j,0,j.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},Or.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new fe("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},Or.prototype.computeMinDistanceLines=function(l,h,y){for(var b=0;b<l.size();b++)for(var I=l.get(b),B=0;B<h.size();B++){var j=h.get(B);if(this.computeMinDistance(I,j,y),this._minDistance<=this._terminateDistance)return null}},Or.prototype.interfaces_=function(){return[]},Or.prototype.getClass=function(){return Or},Or.distance=function(l,h){return new Or(l,h).distance()},Or.isWithinDistance=function(l,h,y){return new Or(l,h,y).distance()<=y},Or.nearestPoints=function(l,h){return new Or(l,h).nearestPoints()};var Cs=function(){this._pt=[new ie,new ie],this._distance=he.NaN,this._isNull=!0};Cs.prototype.getCoordinates=function(){return this._pt},Cs.prototype.getCoordinate=function(l){return this._pt[l]},Cs.prototype.setMinimum=function(){if(1===arguments.length){var l=arguments[0];this.setMinimum(l._pt[0],l._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var b=h.distance(y);b<this._distance&&this.initialize(h,y,b)}},Cs.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var l=arguments[0],h=arguments[1];this._pt[0].setCoordinate(l),this._pt[1].setCoordinate(h),this._distance=l.distance(h),this._isNull=!1}else if(3===arguments.length){var b=arguments[1],I=arguments[2];this._pt[0].setCoordinate(arguments[0]),this._pt[1].setCoordinate(b),this._distance=I,this._isNull=!1}},Cs.prototype.toString=function(){return ye.toLineString(this._pt[0],this._pt[1])},Cs.prototype.getDistance=function(){return this._distance},Cs.prototype.setMaximum=function(){if(1===arguments.length){var l=arguments[0];this.setMaximum(l._pt[0],l._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var b=h.distance(y);b>this._distance&&this.initialize(h,y,b)}},Cs.prototype.interfaces_=function(){return[]},Cs.prototype.getClass=function(){return Cs};var Ml=function(){};Ml.prototype.interfaces_=function(){return[]},Ml.prototype.getClass=function(){return Ml},Ml.computeDistance=function(){if(arguments[2]instanceof Cs&&arguments[0]instanceof vi&&arguments[1]instanceof ie)for(var l=arguments[0],h=arguments[1],y=arguments[2],b=new er,I=l.getCoordinates(),B=0;B<I.length-1;B++){b.setCoordinates(I[B],I[B+1]);var j=b.closestPoint(h);y.setMinimum(j,h)}else if(arguments[2]instanceof Cs&&arguments[0]instanceof qo&&arguments[1]instanceof ie){var oe=arguments[0],Pe=arguments[1],st=arguments[2];Ml.computeDistance(oe.getExteriorRing(),Pe,st);for(var kt=0;kt<oe.getNumInteriorRing();kt++)Ml.computeDistance(oe.getInteriorRingN(kt),Pe,st)}else if(arguments[2]instanceof Cs&&arguments[0]instanceof Sn&&arguments[1]instanceof ie){var qt=arguments[0],Pn=arguments[1],In=arguments[2];if(qt instanceof vi)Ml.computeDistance(qt,Pn,In);else if(qt instanceof qo)Ml.computeDistance(qt,Pn,In);else if(qt instanceof Vi)for(var zn=qt,tr=0;tr<zn.getNumGeometries();tr++){var Mi=zn.getGeometryN(tr);Ml.computeDistance(Mi,Pn,In)}else In.setMinimum(qt.getCoordinate(),Pn)}else if(arguments[2]instanceof Cs&&arguments[0]instanceof er&&arguments[1]instanceof ie){var wa=arguments[1],Ea=arguments[2],ml=arguments[0].closestPoint(wa);Ea.setMinimum(ml,wa)}};var Mn=function(){this._g0=null,this._g1=null,this._ptDist=new Cs,this._densifyFrac=0;var h=arguments[1];this._g0=arguments[0],this._g1=h},Ss={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};Mn.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},Mn.prototype.setDensifyFraction=function(l){if(l>1||l<=0)throw new fe("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=l},Mn.prototype.compute=function(l,h){this.computeOrientedDistance(l,h,this._ptDist),this.computeOrientedDistance(h,l,this._ptDist)},Mn.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},Mn.prototype.computeOrientedDistance=function(l,h,y){var b=new gi(h);if(l.apply(b),y.setMaximum(b.getMaxPointDistance()),this._densifyFrac>0){var I=new Oi(h,this._densifyFrac);l.apply(I),y.setMaximum(I.getMaxPointDistance())}},Mn.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},Mn.prototype.interfaces_=function(){return[]},Mn.prototype.getClass=function(){return Mn},Mn.distance=function(){if(2===arguments.length)return new Mn(arguments[0],arguments[1]).distance();if(3===arguments.length){var I=arguments[2],B=new Mn(arguments[0],arguments[1]);return B.setDensifyFraction(I),B.distance()}},Ss.MaxPointDistanceFilter.get=function(){return gi},Ss.MaxDensifiedByFractionDistanceFilter.get=function(){return Oi},Object.defineProperties(Mn,Ss);var gi=function(){this._maxPtDist=new Cs,this._minPtDist=new Cs,this._euclideanDist=new Ml,this._geom=null,this._geom=arguments[0]};gi.prototype.filter=function(l){this._minPtDist.initialize(),Ml.computeDistance(this._geom,l,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},gi.prototype.getMaxPointDistance=function(){return this._maxPtDist},gi.prototype.interfaces_=function(){return[Fr]},gi.prototype.getClass=function(){return gi};var Oi=function(){this._maxPtDist=new Cs,this._minPtDist=new Cs,this._geom=null,this._numSubSegs=0;var h=arguments[1];this._geom=arguments[0],this._numSubSegs=Math.trunc(Math.round(1/h))};Oi.prototype.filter=function(l,h){if(0===h)return null;for(var y=l.getCoordinate(h-1),b=l.getCoordinate(h),I=(b.x-y.x)/this._numSubSegs,B=(b.y-y.y)/this._numSubSegs,j=0;j<this._numSubSegs;j++){var st=new ie(y.x+j*I,y.y+j*B);this._minPtDist.initialize(),Ml.computeDistance(this._geom,st,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},Oi.prototype.isDone=function(){return!1},Oi.prototype.isGeometryChanged=function(){return!1},Oi.prototype.getMaxPointDistance=function(){return this._maxPtDist},Oi.prototype.interfaces_=function(){return[To]},Oi.prototype.getClass=function(){return Oi};var Ui=function(l,h,y){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=l||null,this._bufDistance=h||null,this._result=y||null},uc={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Ui.prototype.checkMaximumDistance=function(l,h,y){var b=new Mn(h,l);if(b.setDensifyFraction(.25),this._maxDistanceFound=b.orientedDistance(),this._maxDistanceFound>y){this._isValid=!1;var I=b.getCoordinates();this._errorLocation=I[1],this._errorIndicator=l.getFactory().createLineString(I),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+ye.toLineString(I[0],I[1])+")"}},Ui.prototype.isValid=function(){var l=Math.abs(this._bufDistance),h=Ui.MAX_DISTANCE_DIFF_FRAC*l;return this._minValidDistance=l-h,this._maxValidDistance=l+h,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Ui.VERBOSE&&gn.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},Ui.prototype.checkNegativeValid=function(){if(!(this._input instanceof qo||this._input instanceof da||this._input instanceof Vi))return null;var l=this.getPolygonLines(this._input);if(this.checkMinimumDistance(l,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(l,this._result,this._maxValidDistance)},Ui.prototype.getErrorIndicator=function(){return this._errorIndicator},Ui.prototype.checkMinimumDistance=function(l,h,y){var b=new Or(l,h,y);if(this._minDistanceFound=b.distance(),this._minDistanceFound<y){this._isValid=!1;var I=b.nearestPoints();this._errorLocation=b.nearestPoints()[1],this._errorIndicator=l.getFactory().createLineString(I),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+ye.toLineString(I[0],I[1])+" )"}},Ui.prototype.checkPositiveValid=function(){var l=this._result.getBoundary();if(this.checkMinimumDistance(this._input,l,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,l,this._maxValidDistance)},Ui.prototype.getErrorLocation=function(){return this._errorLocation},Ui.prototype.getPolygonLines=function(l){for(var h=new Oe,y=new sa(h),b=gl.getPolygons(l).iterator();b.hasNext();)b.next().apply(y);return l.getFactory().buildGeometry(h)},Ui.prototype.getErrorMessage=function(){return this._errMsg},Ui.prototype.interfaces_=function(){return[]},Ui.prototype.getClass=function(){return Ui},uc.VERBOSE.get=function(){return!1},uc.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Ui,uc);var Si=function(l,h,y){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=l||null,this._distance=h||null,this._result=y||null},cc={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Si.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},Si.prototype.checkEnvelope=function(){if(this._distance<0)return null;var l=this._distance*Si.MAX_ENV_DIFF_FRAC;0===l&&(l=.001);var h=new un(this._input.getEnvelopeInternal());h.expandBy(this._distance);var y=new un(this._result.getEnvelopeInternal());y.expandBy(l),y.contains(h)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(y)),this.report("Envelope")},Si.prototype.checkDistance=function(){var l=new Ui(this._input,this._distance,this._result);l.isValid()||(this._isValid=!1,this._errorMsg=l.getErrorMessage(),this._errorLocation=l.getErrorLocation(),this._errorIndicator=l.getErrorIndicator()),this.report("Distance")},Si.prototype.checkArea=function(){var l=this._input.getArea(),h=this._result.getArea();this._distance>0&&l>h&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&l<h&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},Si.prototype.checkPolygonal=function(){this._result instanceof qo||this._result instanceof da||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},Si.prototype.getErrorIndicator=function(){return this._errorIndicator},Si.prototype.getErrorLocation=function(){return this._errorLocation},Si.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},Si.prototype.report=function(l){if(!Si.VERBOSE)return null;gn.out.println("Check "+l+": "+(this._isValid?"passed":"FAILED"))},Si.prototype.getErrorMessage=function(){return this._errorMsg},Si.prototype.interfaces_=function(){return[]},Si.prototype.getClass=function(){return Si},Si.isValidMsg=function(l,h,y){var b=new Si(l,h,y);return b.isValid()?null:b.getErrorMessage()},Si.isValid=function(l,h,y){return!!new Si(l,h,y).isValid()},cc.VERBOSE.get=function(){return!1},cc.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Si,cc);var ol=function(){this._pts=null,this._data=null;var h=arguments[1];this._pts=arguments[0],this._data=h};ol.prototype.getCoordinates=function(){return this._pts},ol.prototype.size=function(){return this._pts.length},ol.prototype.getCoordinate=function(l){return this._pts[l]},ol.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},ol.prototype.getSegmentOctant=function(l){return l===this._pts.length-1?-1:oc.octant(this.getCoordinate(l),this.getCoordinate(l+1))},ol.prototype.setData=function(l){this._data=l},ol.prototype.getData=function(){return this._data},ol.prototype.toString=function(){return ye.toLineString(new ts(this._pts))},ol.prototype.interfaces_=function(){return[Ha]},ol.prototype.getClass=function(){return ol};var Zo=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new Oe,this._intersectionCount=0,this._keepIntersections=!0,this._li=arguments[0],this._interiorIntersection=null};Zo.prototype.getInteriorIntersection=function(){return this._interiorIntersection},Zo.prototype.setCheckEndSegmentsOnly=function(l){this._isCheckEndSegmentsOnly=l},Zo.prototype.getIntersectionSegments=function(){return this._intSegments},Zo.prototype.count=function(){return this._intersectionCount},Zo.prototype.getIntersections=function(){return this._intersections},Zo.prototype.setFindAllIntersections=function(l){this._findAllIntersections=l},Zo.prototype.setKeepIntersections=function(l){this._keepIntersections=l},Zo.prototype.processIntersections=function(l,h,y,b){if(!this._findAllIntersections&&this.hasIntersection()||l===y&&h===b||this._isCheckEndSegmentsOnly&&!this.isEndSegment(l,h)&&!this.isEndSegment(y,b))return null;var I=l.getCoordinates()[h],B=l.getCoordinates()[h+1],j=y.getCoordinates()[b],oe=y.getCoordinates()[b+1];this._li.computeIntersection(I,B,j,oe),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=I,this._intSegments[1]=B,this._intSegments[2]=j,this._intSegments[3]=oe,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},Zo.prototype.isEndSegment=function(l,h){return 0===h||h>=l.size()-2},Zo.prototype.hasIntersection=function(){return null!==this._interiorIntersection},Zo.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},Zo.prototype.interfaces_=function(){return[oa]},Zo.prototype.getClass=function(){return Zo},Zo.createAllIntersectionsFinder=function(l){var h=new Zo(l);return h.setFindAllIntersections(!0),h},Zo.createAnyIntersectionFinder=function(l){return new Zo(l)},Zo.createIntersectionCounter=function(l){var h=new Zo(l);return h.setFindAllIntersections(!0),h.setKeepIntersections(!1),h};var Gr=function(){this._li=new Tt,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0,this._segStrings=arguments[0]};Gr.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},Gr.prototype.getIntersections=function(){return this._segInt.getIntersections()},Gr.prototype.isValid=function(){return this.execute(),this._isValid},Gr.prototype.setFindAllIntersections=function(l){this._findAllIntersections=l},Gr.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Zo(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var l=new Eo;if(l.setSegmentIntersector(this._segInt),l.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},Gr.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Sl(this.getErrorMessage(),this._segInt.getInteriorIntersection())},Gr.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var l=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+ye.toLineString(l[0],l[1])+" and "+ye.toLineString(l[2],l[3])},Gr.prototype.interfaces_=function(){return[]},Gr.prototype.getClass=function(){return Gr},Gr.computeIntersections=function(l){var h=new Gr(l);return h.setFindAllIntersections(!0),h.isValid(),h.getIntersections()};var mu=function l(){this._nv=null,this._nv=new Gr(l.toSegmentStrings(arguments[0]))};mu.prototype.checkValid=function(){this._nv.checkValid()},mu.prototype.interfaces_=function(){return[]},mu.prototype.getClass=function(){return mu},mu.toSegmentStrings=function(l){for(var h=new Oe,y=l.iterator();y.hasNext();){var b=y.next();h.add(new ol(b.getCoordinates(),b))}return h},mu.checkValid=function(l){new mu(l).checkValid()};var is=function(l){this._mapOp=l};is.prototype.map=function(l){for(var h=new Oe,y=0;y<l.getNumGeometries();y++){var b=this._mapOp.map(l.getGeometryN(y));b.isEmpty()||h.add(b)}return l.getFactory().createGeometryCollection(ur.toGeometryArray(h))},is.prototype.interfaces_=function(){return[]},is.prototype.getClass=function(){return is},is.map=function(l,h){return new is(h).map(l)};var Bn=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new Oe,this._resultLineList=new Oe;var h=arguments[1],y=arguments[2];this._op=arguments[0],this._geometryFactory=h,this._ptLocator=y};Bn.prototype.collectLines=function(l){for(var h=this._op.getGraph().getEdgeEnds().iterator();h.hasNext();){var y=h.next();this.collectLineEdge(y,l,this._lineEdgesList),this.collectBoundaryTouchEdge(y,l,this._lineEdgesList)}},Bn.prototype.labelIsolatedLine=function(l,h){var y=this._ptLocator.locate(l.getCoordinate(),this._op.getArgGeometry(h));l.getLabel().setLocation(h,y)},Bn.prototype.build=function(l){return this.findCoveredLineEdges(),this.collectLines(l),this.buildLines(l),this._resultLineList},Bn.prototype.collectLineEdge=function(l,h,y){var b=l.getLabel(),I=l.getEdge();l.isLineEdge()&&(l.isVisited()||!sr.isResultOfOp(b,h)||I.isCovered()||(y.add(I),l.setVisitedEdge(!0)))},Bn.prototype.findCoveredLineEdges=function(){for(var l=this._op.getGraph().getNodes().iterator();l.hasNext();)l.next().getEdges().findCoveredLineEdges();for(var h=this._op.getGraph().getEdgeEnds().iterator();h.hasNext();){var y=h.next(),b=y.getEdge();if(y.isLineEdge()&&!b.isCoveredSet()){var I=this._op.isCoveredByA(y.getCoordinate());b.setCovered(I)}}},Bn.prototype.labelIsolatedLines=function(l){for(var h=l.iterator();h.hasNext();){var y=h.next(),b=y.getLabel();y.isIsolated()&&(b.isNull(0)?this.labelIsolatedLine(y,0):this.labelIsolatedLine(y,1))}},Bn.prototype.buildLines=function(l){for(var h=this._lineEdgesList.iterator();h.hasNext();){var y=h.next(),b=this._geometryFactory.createLineString(y.getCoordinates());this._resultLineList.add(b),y.setInResult(!0)}},Bn.prototype.collectBoundaryTouchEdge=function(l,h,y){var b=l.getLabel();return l.isLineEdge()||l.isVisited()||l.isInteriorAreaEdge()||l.getEdge().isInResult()?null:(J.isTrue(!(l.isInResult()||l.getSym().isInResult())||!l.getEdge().isInResult()),void(sr.isResultOfOp(b,h)&&h===sr.INTERSECTION&&(y.add(l.getEdge()),l.setVisitedEdge(!0))))},Bn.prototype.interfaces_=function(){return[]},Bn.prototype.getClass=function(){return Bn};var Ar=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new Oe;var h=arguments[1];this._op=arguments[0],this._geometryFactory=h};Ar.prototype.filterCoveredNodeToPoint=function(l){var h=l.getCoordinate();if(!this._op.isCoveredByLA(h)){var y=this._geometryFactory.createPoint(h);this._resultPointList.add(y)}},Ar.prototype.extractNonCoveredResultNodes=function(l){for(var h=this._op.getGraph().getNodes().iterator();h.hasNext();){var y=h.next();if(!(y.isInResult()||y.isIncidentEdgeInResult()||0!==y.getEdges().getDegree()&&l!==sr.INTERSECTION)){var b=y.getLabel();sr.isResultOfOp(b,l)&&this.filterCoveredNodeToPoint(y)}}},Ar.prototype.build=function(l){return this.extractNonCoveredResultNodes(l),this._resultPointList},Ar.prototype.interfaces_=function(){return[]},Ar.prototype.getClass=function(){return Ar};var mi=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};mi.prototype.transformPoint=function(l,h){return this._factory.createPoint(this.transformCoordinates(l.getCoordinateSequence(),l))},mi.prototype.transformPolygon=function(l,h){var y=!0,b=this.transformLinearRing(l.getExteriorRing(),l);null!==b&&b instanceof Hs&&!b.isEmpty()||(y=!1);for(var I=new Oe,B=0;B<l.getNumInteriorRing();B++){var j=this.transformLinearRing(l.getInteriorRingN(B),l);null===j||j.isEmpty()||(j instanceof Hs||(y=!1),I.add(j))}if(y)return this._factory.createPolygon(b,I.toArray([]));var oe=new Oe;return null!==b&&oe.add(b),oe.addAll(I),this._factory.buildGeometry(oe)},mi.prototype.createCoordinateSequence=function(l){return this._factory.getCoordinateSequenceFactory().create(l)},mi.prototype.getInputGeometry=function(){return this._inputGeom},mi.prototype.transformMultiLineString=function(l,h){for(var y=new Oe,b=0;b<l.getNumGeometries();b++){var I=this.transformLineString(l.getGeometryN(b),l);null!==I&&(I.isEmpty()||y.add(I))}return this._factory.buildGeometry(y)},mi.prototype.transformCoordinates=function(l,h){return this.copy(l)},mi.prototype.transformLineString=function(l,h){return this._factory.createLineString(this.transformCoordinates(l.getCoordinateSequence(),l))},mi.prototype.transformMultiPoint=function(l,h){for(var y=new Oe,b=0;b<l.getNumGeometries();b++){var I=this.transformPoint(l.getGeometryN(b),l);null!==I&&(I.isEmpty()||y.add(I))}return this._factory.buildGeometry(y)},mi.prototype.transformMultiPolygon=function(l,h){for(var y=new Oe,b=0;b<l.getNumGeometries();b++){var I=this.transformPolygon(l.getGeometryN(b),l);null!==I&&(I.isEmpty()||y.add(I))}return this._factory.buildGeometry(y)},mi.prototype.copy=function(l){return l.copy()},mi.prototype.transformGeometryCollection=function(l,h){for(var y=new Oe,b=0;b<l.getNumGeometries();b++){var I=this.transform(l.getGeometryN(b));null!==I&&(this._pruneEmptyGeometry&&I.isEmpty()||y.add(I))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(ur.toGeometryArray(y)):this._factory.buildGeometry(y)},mi.prototype.transform=function(l){if(this._inputGeom=l,this._factory=l.getFactory(),l instanceof ps)return this.transformPoint(l,null);if(l instanceof Tu)return this.transformMultiPoint(l,null);if(l instanceof Hs)return this.transformLinearRing(l,null);if(l instanceof vi)return this.transformLineString(l,null);if(l instanceof Bl)return this.transformMultiLineString(l,null);if(l instanceof qo)return this.transformPolygon(l,null);if(l instanceof da)return this.transformMultiPolygon(l,null);if(l instanceof Vi)return this.transformGeometryCollection(l,null);throw new fe("Unknown Geometry subtype: "+l.getClass().getName())},mi.prototype.transformLinearRing=function(l,h){var y=this.transformCoordinates(l.getCoordinateSequence(),l);if(null===y)return this._factory.createLinearRing(null);var b=y.size();return b>0&&b<4&&!this._preserveType?this._factory.createLineString(y):this._factory.createLinearRing(y)},mi.prototype.interfaces_=function(){return[]},mi.prototype.getClass=function(){return mi};var Ds=function l(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new er,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof vi&&"number"==typeof arguments[1]){var y=arguments[1];l.call(this,arguments[0].getCoordinates(),y)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var b=arguments[0],I=arguments[1];this._srcPts=b,this._isClosed=l.isClosed(b),this._snapTolerance=I}};Ds.prototype.snapVertices=function(l,h){for(var y=this._isClosed?l.size()-1:l.size(),b=0;b<y;b++){var I=l.get(b),B=this.findSnapForVertex(I,h);null!==B&&(l.set(b,new ie(B)),0===b&&this._isClosed&&l.set(l.size()-1,new ie(B)))}},Ds.prototype.findSnapForVertex=function(l,h){for(var y=0;y<h.length;y++){if(l.equals2D(h[y]))return null;if(l.distance(h[y])<this._snapTolerance)return h[y]}return null},Ds.prototype.snapTo=function(l){var h=new bt(this._srcPts);return this.snapVertices(h,l),this.snapSegments(h,l),h.toCoordinateArray()},Ds.prototype.snapSegments=function(l,h){if(0===h.length)return null;var y=h.length;h[0].equals2D(h[h.length-1])&&(y=h.length-1);for(var b=0;b<y;b++){var I=h[b],B=this.findSegmentIndexToSnap(I,l);B>=0&&l.add(B+1,new ie(I),!1)}},Ds.prototype.findSegmentIndexToSnap=function(l,h){for(var y=he.MAX_VALUE,b=-1,I=0;I<h.size()-1;I++){if(this._seg.p0=h.get(I),this._seg.p1=h.get(I+1),this._seg.p0.equals2D(l)||this._seg.p1.equals2D(l)){if(this._allowSnappingToSourceVertices)continue;return-1}var B=this._seg.distance(l);B<this._snapTolerance&&B<y&&(y=B,b=I)}return b},Ds.prototype.setAllowSnappingToSourceVertices=function(l){this._allowSnappingToSourceVertices=l},Ds.prototype.interfaces_=function(){return[]},Ds.prototype.getClass=function(){return Ds},Ds.isClosed=function(l){return!(l.length<=1)&&l[0].equals2D(l[l.length-1])};var Ii=function(l){this._srcGeom=l||null},Oa={SNAP_PRECISION_FACTOR:{configurable:!0}};Ii.prototype.snapTo=function(l,h){var y=this.extractTargetCoordinates(l);return new $u(h,y).transform(this._srcGeom)},Ii.prototype.snapToSelf=function(l,h){var y=this.extractTargetCoordinates(this._srcGeom),b=new $u(l,y,!0).transform(this._srcGeom),I=b;return h&&At(I,Na)&&(I=b.buffer(0)),I},Ii.prototype.computeSnapTolerance=function(l){return this.computeMinimumSegmentLength(l)/10},Ii.prototype.extractTargetCoordinates=function(l){for(var h=new Vt,y=l.getCoordinates(),b=0;b<y.length;b++)h.add(y[b]);return h.toArray(new Array(0).fill(null))},Ii.prototype.computeMinimumSegmentLength=function(l){for(var h=he.MAX_VALUE,y=0;y<l.length-1;y++){var b=l[y].distance(l[y+1]);b<h&&(h=b)}return h},Ii.prototype.interfaces_=function(){return[]},Ii.prototype.getClass=function(){return Ii},Ii.snap=function(l,h,y){var b=new Array(2).fill(null),I=new Ii(l);b[0]=I.snapTo(h,y);var B=new Ii(h);return b[1]=B.snapTo(b[0],y),b},Ii.computeOverlaySnapTolerance=function(){if(1===arguments.length){var l=arguments[0],h=Ii.computeSizeBasedSnapTolerance(l),y=l.getPrecisionModel();if(y.getType()===on.FIXED){var b=1/y.getScale()*2/1.415;b>h&&(h=b)}return h}if(2===arguments.length){var B=arguments[1];return Math.min(Ii.computeOverlaySnapTolerance(arguments[0]),Ii.computeOverlaySnapTolerance(B))}},Ii.computeSizeBasedSnapTolerance=function(l){var h=l.getEnvelopeInternal();return Math.min(h.getHeight(),h.getWidth())*Ii.SNAP_PRECISION_FACTOR},Ii.snapToSelf=function(l,h,y){return new Ii(l).snapToSelf(h,y)},Oa.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(Ii,Oa);var $u=function(l){function h(y,b,I){l.call(this),this._snapTolerance=y||null,this._snapPts=b||null,this._isSelfSnap=void 0!==I&&I}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.snapLine=function(y,b){var I=new Ds(y,this._snapTolerance);return I.setAllowSnappingToSourceVertices(this._isSelfSnap),I.snapTo(b)},h.prototype.transformCoordinates=function(y,b){var I=y.toCoordinateArray(),B=this.snapLine(I,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(B)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(mi),ai=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};ai.prototype.getCommon=function(){return he.longBitsToDouble(this._commonBits)},ai.prototype.add=function(l){var h=he.doubleToLongBits(l);return this._isFirst?(this._commonBits=h,this._commonSignExp=ai.signExpBits(this._commonBits),this._isFirst=!1,null):ai.signExpBits(h)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=ai.numCommonMostSigMantissaBits(this._commonBits,h),void(this._commonBits=ai.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},ai.prototype.toString=function(){if(1===arguments.length){var l=arguments[0],h=he.longBitsToDouble(l),y="0000000000000000000000000000000000000000000000000000000000000000"+he.toBinaryString(l),b=y.substring(y.length-64);return b.substring(0,1)+"  "+b.substring(1,12)+"(exp) "+b.substring(12)+" [ "+h+" ]"}},ai.prototype.interfaces_=function(){return[]},ai.prototype.getClass=function(){return ai},ai.getBit=function(l,h){return l&1<<h?1:0},ai.signExpBits=function(l){return l>>52},ai.zeroLowerBits=function(l,h){return l&~((1<<h)-1)},ai.numCommonMostSigMantissaBits=function(l,h){for(var y=0,b=52;b>=0;b--){if(ai.getBit(l,b)!==ai.getBit(h,b))return y;y++}return 52};var va=function(){this._commonCoord=null,this._ccFilter=new Pr},Nu={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};va.prototype.addCommonBits=function(l){var h=new Wa(this._commonCoord);l.apply(h),l.geometryChanged()},va.prototype.removeCommonBits=function(l){if(0===this._commonCoord.x&&0===this._commonCoord.y)return l;var h=new ie(this._commonCoord);h.x=-h.x,h.y=-h.y;var y=new Wa(h);return l.apply(y),l.geometryChanged(),l},va.prototype.getCommonCoordinate=function(){return this._commonCoord},va.prototype.add=function(l){l.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},va.prototype.interfaces_=function(){return[]},va.prototype.getClass=function(){return va},Nu.CommonCoordinateFilter.get=function(){return Pr},Nu.Translater.get=function(){return Wa},Object.defineProperties(va,Nu);var Pr=function(){this._commonBitsX=new ai,this._commonBitsY=new ai};Pr.prototype.filter=function(l){this._commonBitsX.add(l.x),this._commonBitsY.add(l.y)},Pr.prototype.getCommonCoordinate=function(){return new ie(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},Pr.prototype.interfaces_=function(){return[Fr]},Pr.prototype.getClass=function(){return Pr};var Wa=function(){this.trans=null,this.trans=arguments[0]};Wa.prototype.filter=function(l,h){var y=l.getOrdinate(h,0)+this.trans.x,b=l.getOrdinate(h,1)+this.trans.y;l.setOrdinate(h,0,y),l.setOrdinate(h,1,b)},Wa.prototype.isDone=function(){return!1},Wa.prototype.isGeometryChanged=function(){return!0},Wa.prototype.interfaces_=function(){return[To]},Wa.prototype.getClass=function(){return Wa};var _s=function(l,h){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=l,this._geom[1]=h,this.computeSnapTolerance()};_s.prototype.selfSnap=function(l){return new Ii(l).snapTo(l,this._snapTolerance)},_s.prototype.removeCommonBits=function(l){this._cbr=new va,this._cbr.add(l[0]),this._cbr.add(l[1]);var h=new Array(2).fill(null);return h[0]=this._cbr.removeCommonBits(l[0].copy()),h[1]=this._cbr.removeCommonBits(l[1].copy()),h},_s.prototype.prepareResult=function(l){return this._cbr.addCommonBits(l),l},_s.prototype.getResultGeometry=function(l){var h=this.snap(this._geom),y=sr.overlayOp(h[0],h[1],l);return this.prepareResult(y)},_s.prototype.checkValid=function(l){l.isValid()||gn.out.println("Snapped geometry is invalid")},_s.prototype.computeSnapTolerance=function(){this._snapTolerance=Ii.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},_s.prototype.snap=function(l){var h=this.removeCommonBits(l);return Ii.snap(h[0],h[1],this._snapTolerance)},_s.prototype.interfaces_=function(){return[]},_s.prototype.getClass=function(){return _s},_s.overlayOp=function(l,h,y){return new _s(l,h).getResultGeometry(y)},_s.union=function(l,h){return _s.overlayOp(l,h,sr.UNION)},_s.intersection=function(l,h){return _s.overlayOp(l,h,sr.INTERSECTION)},_s.symDifference=function(l,h){return _s.overlayOp(l,h,sr.SYMDIFFERENCE)},_s.difference=function(l,h){return _s.overlayOp(l,h,sr.DIFFERENCE)};var os=function(l,h){this._geom=new Array(2).fill(null),this._geom[0]=l,this._geom[1]=h};os.prototype.getResultGeometry=function(l){var h=null,y=!1,b=null;try{h=sr.overlayOp(this._geom[0],this._geom[1],l),y=!0}catch(I){if(!(I instanceof Z))throw I;b=I}if(!y)try{h=_s.overlayOp(this._geom[0],this._geom[1],l)}catch(I){throw I instanceof Z?b:I}return h},os.prototype.interfaces_=function(){return[]},os.prototype.getClass=function(){return os},os.overlayOp=function(l,h,y){return new os(l,h).getResultGeometry(y)},os.union=function(l,h){return os.overlayOp(l,h,sr.UNION)},os.intersection=function(l,h){return os.overlayOp(l,h,sr.INTERSECTION)},os.symDifference=function(l,h){return os.overlayOp(l,h,sr.SYMDIFFERENCE)},os.difference=function(l,h){return os.overlayOp(l,h,sr.DIFFERENCE)};var vn=function(){this.mce=null,this.chainIndex=null;var h=arguments[1];this.mce=arguments[0],this.chainIndex=h};vn.prototype.computeIntersections=function(l,h){this.mce.computeIntersectsForChain(this.chainIndex,l.mce,l.chainIndex,h)},vn.prototype.interfaces_=function(){return[]},vn.prototype.getClass=function(){return vn};var Mo=function l(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var h=arguments[0],y=arguments[1];this._eventType=l.DELETE,this._xValue=h,this._insertEvent=y}else if(3===arguments.length){var b=arguments[0],I=arguments[1],B=arguments[2];this._eventType=l.INSERT,this._label=b,this._xValue=I,this._obj=B}},hc={INSERT:{configurable:!0},DELETE:{configurable:!0}};Mo.prototype.isDelete=function(){return this._eventType===Mo.DELETE},Mo.prototype.setDeleteEventIndex=function(l){this._deleteEventIndex=l},Mo.prototype.getObject=function(){return this._obj},Mo.prototype.compareTo=function(l){return this._xValue<l._xValue?-1:this._xValue>l._xValue?1:this._eventType<l._eventType?-1:this._eventType>l._eventType?1:0},Mo.prototype.getInsertEvent=function(){return this._insertEvent},Mo.prototype.isInsert=function(){return this._eventType===Mo.INSERT},Mo.prototype.isSameLabel=function(l){return null!==this._label&&this._label===l._label},Mo.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},Mo.prototype.interfaces_=function(){return[ce]},Mo.prototype.getClass=function(){return Mo},hc.INSERT.get=function(){return 1},hc.DELETE.get=function(){return 2},Object.defineProperties(Mo,hc);var Za=function(){};Za.prototype.interfaces_=function(){return[]},Za.prototype.getClass=function(){return Za};var Go=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var h=arguments[1],y=arguments[2];this._li=arguments[0],this._includeProper=h,this._recordIsolated=y};Go.prototype.isTrivialIntersection=function(l,h,y,b){if(l===y&&1===this._li.getIntersectionNum()){if(Go.isAdjacentSegments(h,b))return!0;if(l.isClosed()){var I=l.getNumPoints()-1;if(0===h&&b===I||0===b&&h===I)return!0}}return!1},Go.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Go.prototype.setIsDoneIfProperInt=function(l){this._isDoneWhenProperInt=l},Go.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Go.prototype.isBoundaryPointInternal=function(l,h){for(var y=h.iterator();y.hasNext();){var b=y.next().getCoordinate();if(l.isIntersection(b))return!0}return!1},Go.prototype.hasProperIntersection=function(){return this._hasProper},Go.prototype.hasIntersection=function(){return this._hasIntersection},Go.prototype.isDone=function(){return this._isDone},Go.prototype.isBoundaryPoint=function(l,h){return!(null===h||!this.isBoundaryPointInternal(l,h[0])&&!this.isBoundaryPointInternal(l,h[1]))},Go.prototype.setBoundaryNodes=function(l,h){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=l,this._bdyNodes[1]=h},Go.prototype.addIntersections=function(l,h,y,b){if(l===y&&h===b)return null;this.numTests++;var I=l.getCoordinates()[h],B=l.getCoordinates()[h+1],j=y.getCoordinates()[b],oe=y.getCoordinates()[b+1];this._li.computeIntersection(I,B,j,oe),this._li.hasIntersection()&&(this._recordIsolated&&(l.setIsolated(!1),y.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(l,h,y,b)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(l.addIntersections(this._li,h,0),y.addIntersections(this._li,b,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},Go.prototype.interfaces_=function(){return[]},Go.prototype.getClass=function(){return Go},Go.isAdjacentSegments=function(l,h){return 1===Math.abs(l-h)};var xa=function(l){function h(){l.call(this),this.events=new Oe,this.nOverlaps=null}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.prepareEvents=function(){ti.sort(this.events);for(var y=0;y<this.events.size();y++){var b=this.events.get(y);b.isDelete()&&b.getInsertEvent().setDeleteEventIndex(y)}},h.prototype.computeIntersections=function(){if(1===arguments.length){var y=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var b=0;b<this.events.size();b++){var I=this.events.get(b);if(I.isInsert()&&this.processOverlaps(b,I.getDeleteEventIndex(),I,y),y.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof Go&&At(arguments[0],tt)&&At(arguments[1],tt)){var B=arguments[0],j=arguments[1],oe=arguments[2];this.addEdges(B,B),this.addEdges(j,j),this.computeIntersections(oe)}else if("boolean"==typeof arguments[2]&&At(arguments[0],tt)&&arguments[1]instanceof Go){var Pe=arguments[0],st=arguments[1];arguments[2]?this.addEdges(Pe,null):this.addEdges(Pe),this.computeIntersections(st)}},h.prototype.addEdge=function(y,b){for(var I=y.getMonotoneChainEdge(),B=I.getStartIndexes(),j=0;j<B.length-1;j++){var oe=new vn(I,j),Pe=new Mo(b,I.getMinX(j),oe);this.events.add(Pe),this.events.add(new Mo(I.getMaxX(j),Pe))}},h.prototype.processOverlaps=function(y,b,I,B){for(var j=I.getObject(),oe=y;oe<b;oe++){var Pe=this.events.get(oe);if(Pe.isInsert()){var st=Pe.getObject();I.isSameLabel(Pe)||(j.computeIntersections(st,B),this.nOverlaps++)}}},h.prototype.addEdges=function(){if(1===arguments.length)for(var y=arguments[0].iterator();y.hasNext();){var b=y.next();this.addEdge(b,b)}else if(2===arguments.length)for(var B=arguments[1],j=arguments[0].iterator();j.hasNext();){var oe=j.next();this.addEdge(oe,B)}},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Za),Us=function(){this._min=he.POSITIVE_INFINITY,this._max=he.NEGATIVE_INFINITY},Xl={NodeComparator:{configurable:!0}};Us.prototype.getMin=function(){return this._min},Us.prototype.intersects=function(l,h){return!(this._min>h||this._max<l)},Us.prototype.getMax=function(){return this._max},Us.prototype.toString=function(){return ye.toLineString(new ie(this._min,0),new ie(this._max,0))},Us.prototype.interfaces_=function(){return[]},Us.prototype.getClass=function(){return Us},Xl.NodeComparator.get=function(){return Hu},Object.defineProperties(Us,Xl);var Hu=function(){};Hu.prototype.compare=function(l,h){var I=(l._min+l._max)/2,B=(h._min+h._max)/2;return I<B?-1:I>B?1:0},Hu.prototype.interfaces_=function(){return[Me]},Hu.prototype.getClass=function(){return Hu};var nh=function(l){function h(){l.call(this),this._item=null;var b=arguments[1],I=arguments[2];this._min=arguments[0],this._max=b,this._item=I}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.query=function(y,b,I){if(!this.intersects(y,b))return null;I.visitItem(this._item)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Us),Di=function(l){function h(){l.call(this),this._node1=null,this._node2=null;var b=arguments[1];this._node1=arguments[0],this._node2=b,this.buildExtent(this._node1,this._node2)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.buildExtent=function(y,b){this._min=Math.min(y._min,b._min),this._max=Math.max(y._max,b._max)},h.prototype.query=function(y,b,I){if(!this.intersects(y,b))return null;null!==this._node1&&this._node1.query(y,b,I),null!==this._node2&&this._node2.query(y,b,I)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Us),Yl=function(){this._leaves=new Oe,this._root=null,this._level=0};Yl.prototype.buildTree=function(){ti.sort(this._leaves,new Us.NodeComparator);for(var l=this._leaves,h=null,y=new Oe;;){if(this.buildLevel(l,y),1===y.size())return y.get(0);h=l,l=y,y=h}},Yl.prototype.insert=function(l,h,y){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new nh(l,h,y))},Yl.prototype.query=function(l,h,y){this.init(),this._root.query(l,h,y)},Yl.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},Yl.prototype.printNode=function(l){gn.out.println(ye.toLineString(new ie(l._min,this._level),new ie(l._max,this._level)))},Yl.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},Yl.prototype.buildLevel=function(l,h){this._level++,h.clear();for(var y=0;y<l.size();y+=2){var b=l.get(y);if(null===(y+1<l.size()?l.get(y):null))h.add(b);else{var I=new Di(l.get(y),l.get(y+1));h.add(I)}}},Yl.prototype.interfaces_=function(){return[]},Yl.prototype.getClass=function(){return Yl};var Kl=function(){this._items=new Oe};Kl.prototype.visitItem=function(l){this._items.add(l)},Kl.prototype.getItems=function(){return this._items},Kl.prototype.interfaces_=function(){return[nl]},Kl.prototype.getClass=function(){return Kl};var dc=function(){this._index=null;var l=arguments[0];if(!At(l,Na))throw new fe("Argument must be Polygonal");this._index=new La(l)},_u={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};dc.prototype.locate=function(l){var h=new Gt(l),y=new qu(h);return this._index.query(l.y,l.y,y),h.getLocation()},dc.prototype.interfaces_=function(){return[Uu]},dc.prototype.getClass=function(){return dc},_u.SegmentVisitor.get=function(){return qu},_u.IntervalIndexedGeometry.get=function(){return La},Object.defineProperties(dc,_u);var qu=function(){this._counter=null,this._counter=arguments[0]};qu.prototype.visitItem=function(l){var h=l;this._counter.countSegment(h.getCoordinate(0),h.getCoordinate(1))},qu.prototype.interfaces_=function(){return[nl]},qu.prototype.getClass=function(){return qu};var La=function(){this._index=new Yl,this.init(arguments[0])};La.prototype.init=function(l){for(var h=sa.getLines(l).iterator();h.hasNext();){var y=h.next().getCoordinates();this.addLine(y)}},La.prototype.addLine=function(l){for(var h=1;h<l.length;h++){var y=new er(l[h-1],l[h]),b=Math.min(y.p0.y,y.p1.y),I=Math.max(y.p0.y,y.p1.y);this._index.insert(b,I,y)}},La.prototype.query=function(){if(2===arguments.length){var l=arguments[0],h=arguments[1],y=new Kl;return this._index.query(l,h,y),y.getItems()}3===arguments.length&&this._index.query(arguments[0],arguments[1],arguments[2])},La.prototype.interfaces_=function(){return[]},La.prototype.getClass=function(){return La};var Pu=function(l){function h(){if(l.call(this),this._parentGeom=null,this._lineEdgeMap=new ws,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Zl,2===arguments.length){var b=arguments[1],I=mr.OGC_SFS_BOUNDARY_RULE;this._argIndex=arguments[0],this._parentGeom=b,this._boundaryNodeRule=I,null!==b&&this.add(b)}else if(3===arguments.length){var j=arguments[1],oe=arguments[2];this._argIndex=arguments[0],this._parentGeom=j,this._boundaryNodeRule=oe,null!==j&&this.add(j)}}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.insertBoundaryPoint=function(y,b){var I=this._nodes.addNode(b).getLabel(),B=1;I.getLocation(y,$t.ON)===Te.BOUNDARY&&B++;var j=h.determineBoundary(this._boundaryNodeRule,B);I.setLocation(y,j)},h.prototype.computeSelfNodes=function(){if(2===arguments.length)return this.computeSelfNodes(arguments[0],arguments[1],!1);if(3===arguments.length){var B=arguments[1],j=arguments[2],oe=new Go(arguments[0],!0,!1);return oe.setIsDoneIfProperInt(j),this.createEdgeSetIntersector().computeIntersections(this._edges,oe,B||!(this._parentGeom instanceof Hs||this._parentGeom instanceof qo||this._parentGeom instanceof da)),this.addSelfIntersectionNodes(this._argIndex),oe}},h.prototype.computeSplitEdges=function(y){for(var b=this._edges.iterator();b.hasNext();)b.next().eiList.addSplitEdges(y)},h.prototype.computeEdgeIntersections=function(y,b,I){var B=new Go(b,I,!0);return B.setBoundaryNodes(this.getBoundaryNodes(),y.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,y._edges,B),B},h.prototype.getGeometry=function(){return this._parentGeom},h.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},h.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},h.prototype.addPoint=function(){if(arguments[0]instanceof ps){var y=arguments[0].getCoordinate();this.insertPoint(this._argIndex,y,Te.INTERIOR)}else arguments[0]instanceof ie&&this.insertPoint(this._argIndex,arguments[0],Te.INTERIOR)},h.prototype.addPolygon=function(y){this.addPolygonRing(y.getExteriorRing(),Te.EXTERIOR,Te.INTERIOR);for(var b=0;b<y.getNumInteriorRing();b++){var I=y.getInteriorRingN(b);this.addPolygonRing(I,Te.INTERIOR,Te.EXTERIOR)}},h.prototype.addEdge=function(y){this.insertEdge(y);var b=y.getCoordinates();this.insertPoint(this._argIndex,b[0],Te.BOUNDARY),this.insertPoint(this._argIndex,b[b.length-1],Te.BOUNDARY)},h.prototype.addLineString=function(y){var b=Qe.removeRepeatedPoints(y.getCoordinates());if(b.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=b[0],null;var I=new du(b,new di(this._argIndex,Te.INTERIOR));this._lineEdgeMap.put(y,I),this.insertEdge(I),J.isTrue(b.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,b[0]),this.insertBoundaryPoint(this._argIndex,b[b.length-1])},h.prototype.getInvalidPoint=function(){return this._invalidPoint},h.prototype.getBoundaryPoints=function(){for(var y=this.getBoundaryNodes(),b=new Array(y.size()).fill(null),I=0,B=y.iterator();B.hasNext();){var j=B.next();b[I++]=j.getCoordinate().copy()}return b},h.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},h.prototype.addSelfIntersectionNode=function(y,b,I){if(this.isBoundaryNode(y,b))return null;I===Te.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(y,b):this.insertPoint(y,b,I)},h.prototype.addPolygonRing=function(y,b,I){if(y.isEmpty())return null;var B=Qe.removeRepeatedPoints(y.getCoordinates());if(B.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=B[0],null;var j=b,oe=I;Ot.isCCW(B)&&(j=I,oe=b);var Pe=new du(B,new di(this._argIndex,Te.BOUNDARY,j,oe));this._lineEdgeMap.put(y,Pe),this.insertEdge(Pe),this.insertPoint(this._argIndex,B[0],Te.BOUNDARY)},h.prototype.insertPoint=function(y,b,I){var B=this._nodes.addNode(b),j=B.getLabel();null===j?B._label=new di(y,I):j.setLocation(y,I)},h.prototype.createEdgeSetIntersector=function(){return new xa},h.prototype.addSelfIntersectionNodes=function(y){for(var b=this._edges.iterator();b.hasNext();)for(var I=b.next(),B=I.getLabel().getLocation(y),j=I.eiList.iterator();j.hasNext();){var oe=j.next();this.addSelfIntersectionNode(y,oe.coord,B)}},h.prototype.add=function(){if(1!==arguments.length)return l.prototype.add.apply(this,arguments);var y=arguments[0];if(y.isEmpty())return null;if(y instanceof da&&(this._useBoundaryDeterminationRule=!1),y instanceof qo)this.addPolygon(y);else if(y instanceof vi)this.addLineString(y);else if(y instanceof ps)this.addPoint(y);else if(y instanceof Tu)this.addCollection(y);else if(y instanceof Bl)this.addCollection(y);else if(y instanceof da)this.addCollection(y);else{if(!(y instanceof Vi))throw new Error(y.getClass().getName());this.addCollection(y)}},h.prototype.addCollection=function(y){for(var b=0;b<y.getNumGeometries();b++){var I=y.getGeometryN(b);this.add(I)}},h.prototype.locate=function(y){return At(this._parentGeom,Na)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new dc(this._parentGeom)),this._areaPtLocator.locate(y)):this._ptLocator.locate(y,this._parentGeom)},h.prototype.findEdge=function(){return 1===arguments.length?this._lineEdgeMap.get(arguments[0]):l.prototype.findEdge.apply(this,arguments)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.determineBoundary=function(y,b){return y.isInBoundary(b)?Te.BOUNDARY:Te.INTERIOR},h}(Vo),Ls=function(){if(this._li=new Tt,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var l=arguments[0];this.setComputationPrecision(l.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Pu(0,l)}else if(2===arguments.length){var h=arguments[0],y=arguments[1],b=mr.OGC_SFS_BOUNDARY_RULE;h.getPrecisionModel().compareTo(y.getPrecisionModel())>=0?this.setComputationPrecision(h.getPrecisionModel()):this.setComputationPrecision(y.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Pu(0,h,b),this._arg[1]=new Pu(1,y,b)}else if(3===arguments.length){var I=arguments[0],B=arguments[1],j=arguments[2];I.getPrecisionModel().compareTo(B.getPrecisionModel())>=0?this.setComputationPrecision(I.getPrecisionModel()):this.setComputationPrecision(B.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Pu(0,I,j),this._arg[1]=new Pu(1,B,j)}};Ls.prototype.getArgGeometry=function(l){return this._arg[l].getGeometry()},Ls.prototype.setComputationPrecision=function(l){this._resultPrecisionModel=l,this._li.setPrecisionModel(this._resultPrecisionModel)},Ls.prototype.interfaces_=function(){return[]},Ls.prototype.getClass=function(){return Ls};var fc=function(){};fc.prototype.interfaces_=function(){return[]},fc.prototype.getClass=function(){return fc},fc.map=function(){if(arguments[0]instanceof Sn&&At(arguments[1],fc.MapOp)){for(var l=arguments[0],h=arguments[1],y=new Oe,b=0;b<l.getNumGeometries();b++){var I=h.map(l.getGeometryN(b));null!==I&&y.add(I)}return l.getFactory().buildGeometry(y)}if(At(arguments[0],ae)&&At(arguments[1],fc.MapOp)){for(var B=arguments[0],j=arguments[1],oe=new Oe,Pe=B.iterator();Pe.hasNext();){var st=Pe.next(),kt=j.map(st);null!==kt&&oe.add(kt)}return oe}},fc.MapOp=function(){};var sr=function(l){function h(){var y=arguments[0];l.call(this,y,arguments[1]),this._ptLocator=new Zl,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Ra,this._resultPolyList=new Oe,this._resultLineList=new Oe,this._resultPointList=new Oe,this._graph=new Vo(new ep),this._geomFact=y.getFactory()}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.insertUniqueEdge=function(y){var b=this._edgeList.findEqualEdge(y);if(null!==b){var I=b.getLabel(),B=y.getLabel();b.isPointwiseEqual(y)||(B=new di(y.getLabel())).flip();var j=b.getDepth();j.isNull()&&j.add(I),j.add(B),I.merge(B)}else this._edgeList.add(y)},h.prototype.getGraph=function(){return this._graph},h.prototype.cancelDuplicateResultEdges=function(){for(var y=this._graph.getEdgeEnds().iterator();y.hasNext();){var b=y.next(),I=b.getSym();b.isInResult()&&I.isInResult()&&(b.setInResult(!1),I.setInResult(!1))}},h.prototype.isCoveredByLA=function(y){return!!this.isCovered(y,this._resultLineList)||!!this.isCovered(y,this._resultPolyList)},h.prototype.computeGeometry=function(y,b,I,B){var j=new Oe;return j.addAll(y),j.addAll(b),j.addAll(I),j.isEmpty()?h.createEmptyResult(B,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(j)},h.prototype.mergeSymLabels=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();)y.next().getEdges().mergeSymLabels()},h.prototype.isCovered=function(y,b){for(var I=b.iterator();I.hasNext();){var B=I.next();if(this._ptLocator.locate(y,B)!==Te.EXTERIOR)return!0}return!1},h.prototype.replaceCollapsedEdges=function(){for(var y=new Oe,b=this._edgeList.iterator();b.hasNext();){var I=b.next();I.isCollapsed()&&(b.remove(),y.add(I.getCollapsedEdge()))}this._edgeList.addAll(y)},h.prototype.updateNodeLabelling=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();){var b=y.next(),I=b.getEdges().getLabel();b.getLabel().merge(I)}},h.prototype.getResultGeometry=function(y){return this.computeOverlay(y),this._resultGeom},h.prototype.insertUniqueEdges=function(y){for(var b=y.iterator();b.hasNext();){var I=b.next();this.insertUniqueEdge(I)}},h.prototype.computeOverlay=function(y){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var b=new Oe;this._arg[0].computeSplitEdges(b),this._arg[1].computeSplitEdges(b),this.insertUniqueEdges(b),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),mu.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(y),this.cancelDuplicateResultEdges();var I=new Ws(this._geomFact);I.add(this._graph),this._resultPolyList=I.getPolygons();var B=new Bn(this,this._geomFact,this._ptLocator);this._resultLineList=B.build(y);var j=new Ar(this,this._geomFact,this._ptLocator);this._resultPointList=j.build(y),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,y)},h.prototype.labelIncompleteNode=function(y,b){var I=this._ptLocator.locate(y.getCoordinate(),this._arg[b].getGeometry());y.getLabel().setLocation(b,I)},h.prototype.copyPoints=function(y){for(var b=this._arg[y].getNodeIterator();b.hasNext();){var I=b.next();this._graph.addNode(I.getCoordinate()).setLabel(y,I.getLabel().getLocation(y))}},h.prototype.findResultAreaEdges=function(y){for(var b=this._graph.getEdgeEnds().iterator();b.hasNext();){var I=b.next(),B=I.getLabel();B.isArea()&&!I.isInteriorAreaEdge()&&h.isResultOfOp(B.getLocation(0,$t.RIGHT),B.getLocation(1,$t.RIGHT),y)&&I.setInResult(!0)}},h.prototype.computeLabelsFromDepths=function(){for(var y=this._edgeList.iterator();y.hasNext();){var b=y.next(),I=b.getLabel(),B=b.getDepth();if(!B.isNull()){B.normalize();for(var j=0;j<2;j++)I.isNull(j)||!I.isArea()||B.isNull(j)||(0===B.getDelta(j)?I.toLine(j):(J.isTrue(!B.isNull(j,$t.LEFT),"depth of LEFT side has not been initialized"),I.setLocation(j,$t.LEFT,B.getLocation(j,$t.LEFT)),J.isTrue(!B.isNull(j,$t.RIGHT),"depth of RIGHT side has not been initialized"),I.setLocation(j,$t.RIGHT,B.getLocation(j,$t.RIGHT))))}}},h.prototype.computeLabelling=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();)y.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},h.prototype.labelIncompleteNodes=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();){var b=y.next(),I=b.getLabel();b.isIsolated()&&(I.isNull(0)?this.labelIncompleteNode(b,0):this.labelIncompleteNode(b,1)),b.getEdges().updateLabelling(I)}},h.prototype.isCoveredByA=function(y){return!!this.isCovered(y,this._resultPolyList)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Ls);sr.overlayOp=function(l,h,y){return new sr(l,h).getResultGeometry(y)},sr.intersection=function(l,h){if(l.isEmpty()||h.isEmpty())return sr.createEmptyResult(sr.INTERSECTION,l,h,l.getFactory());if(l.isGeometryCollection()){var y=h;return is.map(l,{interfaces_:function(){return[fc.MapOp]},map:function(b){return b.intersection(y)}})}return l.checkNotGeometryCollection(l),l.checkNotGeometryCollection(h),os.overlayOp(l,h,sr.INTERSECTION)},sr.symDifference=function(l,h){if(l.isEmpty()||h.isEmpty()){if(l.isEmpty()&&h.isEmpty())return sr.createEmptyResult(sr.SYMDIFFERENCE,l,h,l.getFactory());if(l.isEmpty())return h.copy();if(h.isEmpty())return l.copy()}return l.checkNotGeometryCollection(l),l.checkNotGeometryCollection(h),os.overlayOp(l,h,sr.SYMDIFFERENCE)},sr.resultDimension=function(l,h,y){var b=h.getDimension(),I=y.getDimension(),B=-1;switch(l){case sr.INTERSECTION:B=Math.min(b,I);break;case sr.UNION:B=Math.max(b,I);break;case sr.DIFFERENCE:B=b;break;case sr.SYMDIFFERENCE:B=Math.max(b,I)}return B},sr.createEmptyResult=function(l,h,y,b){var I=null;switch(sr.resultDimension(l,h,y)){case-1:I=b.createGeometryCollection(new Array(0).fill(null));break;case 0:I=b.createPoint();break;case 1:I=b.createLineString();break;case 2:I=b.createPolygon()}return I},sr.difference=function(l,h){return l.isEmpty()?sr.createEmptyResult(sr.DIFFERENCE,l,h,l.getFactory()):h.isEmpty()?l.copy():(l.checkNotGeometryCollection(l),l.checkNotGeometryCollection(h),os.overlayOp(l,h,sr.DIFFERENCE))},sr.isResultOfOp=function(){if(2===arguments.length){var l=arguments[0],h=arguments[1],y=l.getLocation(0),b=l.getLocation(1);return sr.isResultOfOp(y,b,h)}if(3===arguments.length){var I=arguments[0],B=arguments[1];switch(I===Te.BOUNDARY&&(I=Te.INTERIOR),B===Te.BOUNDARY&&(B=Te.INTERIOR),arguments[2]){case sr.INTERSECTION:return I===Te.INTERIOR&&B===Te.INTERIOR;case sr.UNION:return I===Te.INTERIOR||B===Te.INTERIOR;case sr.DIFFERENCE:return I===Te.INTERIOR&&B!==Te.INTERIOR;case sr.SYMDIFFERENCE:return I===Te.INTERIOR&&B!==Te.INTERIOR||I!==Te.INTERIOR&&B===Te.INTERIOR}return!1}},sr.INTERSECTION=1,sr.UNION=2,sr.DIFFERENCE=3,sr.SYMDIFFERENCE=4;var ss=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Zl,this._seg=new er;var l=arguments[0],h=arguments[1];this._g=l,this._boundaryDistanceTolerance=h,this._linework=this.extractLinework(l)};ss.prototype.isWithinToleranceOfBoundary=function(l){for(var h=0;h<this._linework.getNumGeometries();h++)for(var y=this._linework.getGeometryN(h).getCoordinateSequence(),b=0;b<y.size()-1;b++)if(y.getCoordinate(b,this._seg.p0),y.getCoordinate(b+1,this._seg.p1),this._seg.distance(l)<=this._boundaryDistanceTolerance)return!0;return!1},ss.prototype.getLocation=function(l){return this.isWithinToleranceOfBoundary(l)?Te.BOUNDARY:this._ptLocator.locate(l,this._g)},ss.prototype.extractLinework=function(l){var h=new yu;l.apply(h);var y=h.getLinework(),b=ur.toLineStringArray(y);return l.getFactory().createMultiLineString(b)},ss.prototype.interfaces_=function(){return[]},ss.prototype.getClass=function(){return ss};var yu=function(){this._linework=null,this._linework=new Oe};yu.prototype.getLinework=function(){return this._linework},yu.prototype.filter=function(l){if(l instanceof qo){var h=l;this._linework.add(h.getExteriorRing());for(var y=0;y<h.getNumInteriorRing();y++)this._linework.add(h.getInteriorRingN(y))}},yu.prototype.interfaces_=function(){return[$s]},yu.prototype.getClass=function(){return yu};var sl=function(){this._g=null,this._doLeft=!0,this._doRight=!0,this._g=arguments[0]};sl.prototype.extractPoints=function(l,h,y){for(var b=l.getCoordinates(),I=0;I<b.length-1;I++)this.computeOffsetPoints(b[I],b[I+1],h,y)},sl.prototype.setSidesToGenerate=function(l,h){this._doLeft=l,this._doRight=h},sl.prototype.getPoints=function(l){for(var h=new Oe,y=sa.getLines(this._g).iterator();y.hasNext();){var b=y.next();this.extractPoints(b,l,h)}return h},sl.prototype.computeOffsetPoints=function(l,h,y,b){var I=h.x-l.x,B=h.y-l.y,j=Math.sqrt(I*I+B*B),oe=y*I/j,Pe=y*B/j,st=(h.x+l.x)/2,kt=(h.y+l.y)/2;if(this._doLeft){var qt=new ie(st-Pe,kt+oe);b.add(qt)}if(this._doRight){var Pn=new ie(st+Pe,kt-oe);b.add(Pn)}},sl.prototype.interfaces_=function(){return[]},sl.prototype.getClass=function(){return sl};var ba=function l(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=l.TOLERANCE,this._testCoords=new Oe;var h=arguments[0],y=arguments[1],b=arguments[2];this._boundaryDistanceTolerance=l.computeBoundaryDistanceTolerance(h,y),this._geom=[h,y,b],this._locFinder=[new ss(this._geom[0],this._boundaryDistanceTolerance),new ss(this._geom[1],this._boundaryDistanceTolerance),new ss(this._geom[2],this._boundaryDistanceTolerance)]},Al={TOLERANCE:{configurable:!0}};ba.prototype.reportResult=function(l,h,y){gn.out.println("Overlay result invalid - A:"+Te.toLocationSymbol(h[0])+" B:"+Te.toLocationSymbol(h[1])+" expected:"+(y?"i":"e")+" actual:"+Te.toLocationSymbol(h[2]))},ba.prototype.isValid=function(l){return this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]),this.checkValid(l)},ba.prototype.checkValid=function(){if(1===arguments.length){for(var l=arguments[0],h=0;h<this._testCoords.size();h++){var y=this._testCoords.get(h);if(!this.checkValid(l,y))return this._invalidLocation=y,!1}return!0}if(2===arguments.length){var b=arguments[0],I=arguments[1];return this._location[0]=this._locFinder[0].getLocation(I),this._location[1]=this._locFinder[1].getLocation(I),this._location[2]=this._locFinder[2].getLocation(I),!!ba.hasLocation(this._location,Te.BOUNDARY)||this.isValidResult(b,this._location)}},ba.prototype.addTestPts=function(l){var h=new sl(l);this._testCoords.addAll(h.getPoints(5*this._boundaryDistanceTolerance))},ba.prototype.isValidResult=function(l,h){var y=sr.isResultOfOp(h[0],h[1],l),b=!(y^h[2]===Te.INTERIOR);return b||this.reportResult(l,h,y),b},ba.prototype.getInvalidLocation=function(){return this._invalidLocation},ba.prototype.interfaces_=function(){return[]},ba.prototype.getClass=function(){return ba},ba.hasLocation=function(l,h){for(var y=0;y<3;y++)if(l[y]===h)return!0;return!1},ba.computeBoundaryDistanceTolerance=function(l,h){return Math.min(Ii.computeSizeBasedSnapTolerance(l),Ii.computeSizeBasedSnapTolerance(h))},ba.isValid=function(l,h,y,b){return new ba(l,h,b).isValid(y)},Al.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(ba,Al);var ka=function l(h){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=l.extractFactory(h),this._inputGeoms=h};ka.prototype.extractElements=function(l,h){if(null===l)return null;for(var y=0;y<l.getNumGeometries();y++){var b=l.getGeometryN(y);this._skipEmpty&&b.isEmpty()||h.add(b)}},ka.prototype.combine=function(){for(var l=new Oe,h=this._inputGeoms.iterator();h.hasNext();){var y=h.next();this.extractElements(y,l)}return 0===l.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(l)},ka.prototype.interfaces_=function(){return[]},ka.prototype.getClass=function(){return ka},ka.combine=function(){return 1===arguments.length?new ka(arguments[0]).combine():2===arguments.length?new ka(ka.createList(arguments[0],arguments[1])).combine():3===arguments.length?new ka(ka.createList(arguments[0],arguments[1],arguments[2])).combine():void 0},ka.extractFactory=function(l){return l.isEmpty()?null:l.iterator().next().getFactory()},ka.createList=function(){if(2===arguments.length){var l=arguments[0],h=arguments[1],y=new Oe;return y.add(l),y.add(h),y}if(3===arguments.length){var b=arguments[0],I=arguments[1],B=arguments[2],j=new Oe;return j.add(b),j.add(I),j.add(B),j}};var Co=function(){this._inputPolys=null,this._geomFactory=null,this._inputPolys=arguments[0],null===this._inputPolys&&(this._inputPolys=new Oe)},yf={STRTREE_NODE_CAPACITY:{configurable:!0}};Co.prototype.reduceToGeometries=function(l){for(var h=new Oe,y=l.iterator();y.hasNext();){var b=y.next(),I=null;At(b,tt)?I=this.unionTree(b):b instanceof Sn&&(I=b),h.add(I)}return h},Co.prototype.extractByEnvelope=function(l,h,y){for(var b=new Oe,I=0;I<h.getNumGeometries();I++){var B=h.getGeometryN(I);B.getEnvelopeInternal().intersects(l)?b.add(B):y.add(B)}return this._geomFactory.buildGeometry(b)},Co.prototype.unionOptimized=function(l,h){var y=l.getEnvelopeInternal(),b=h.getEnvelopeInternal();if(!y.intersects(b))return ka.combine(l,h);if(l.getNumGeometries()<=1&&h.getNumGeometries()<=1)return this.unionActual(l,h);var I=y.intersection(b);return this.unionUsingEnvelopeIntersection(l,h,I)},Co.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var l=new Ti(Co.STRTREE_NODE_CAPACITY),h=this._inputPolys.iterator();h.hasNext();){var y=h.next();l.insert(y.getEnvelopeInternal(),y)}this._inputPolys=null;var b=l.itemsTree();return this.unionTree(b)},Co.prototype.binaryUnion=function(){if(1===arguments.length){var l=arguments[0];return this.binaryUnion(l,0,l.size())}if(3===arguments.length){var h=arguments[0],y=arguments[1],b=arguments[2];if(b-y<=1){var I=Co.getGeometry(h,y);return this.unionSafe(I,null)}if(b-y==2)return this.unionSafe(Co.getGeometry(h,y),Co.getGeometry(h,y+1));var B=Math.trunc((b+y)/2),j=this.binaryUnion(h,y,B),oe=this.binaryUnion(h,B,b);return this.unionSafe(j,oe)}},Co.prototype.repeatedUnion=function(l){for(var h=null,y=l.iterator();y.hasNext();){var b=y.next();h=null===h?b.copy():h.union(b)}return h},Co.prototype.unionSafe=function(l,h){return null===l&&null===h?null:null===l?h.copy():null===h?l.copy():this.unionOptimized(l,h)},Co.prototype.unionActual=function(l,h){return Co.restrictToPolygons(l.union(h))},Co.prototype.unionTree=function(l){var h=this.reduceToGeometries(l);return this.binaryUnion(h)},Co.prototype.unionUsingEnvelopeIntersection=function(l,h,y){var b=new Oe,I=this.extractByEnvelope(y,l,b),B=this.extractByEnvelope(y,h,b),j=this.unionActual(I,B);return b.add(j),ka.combine(b)},Co.prototype.bufferUnion=function(){if(1===arguments.length){var l=arguments[0];return l.get(0).getFactory().buildGeometry(l).buffer(0)}if(2===arguments.length){var h=arguments[0],y=arguments[1];return h.getFactory().createGeometryCollection([h,y]).buffer(0)}},Co.prototype.interfaces_=function(){return[]},Co.prototype.getClass=function(){return Co},Co.restrictToPolygons=function(l){if(At(l,Na))return l;var h=gl.getPolygons(l);return 1===h.size()?h.get(0):l.getFactory().createMultiPolygon(ur.toPolygonArray(h))},Co.getGeometry=function(l,h){return h>=l.size()?null:l.get(h)},Co.union=function(l){return new Co(l).union()},yf.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Co,yf);var td=function(){};td.prototype.interfaces_=function(){return[]},td.prototype.getClass=function(){return td},td.union=function(l,h){if(l.isEmpty()||h.isEmpty()){if(l.isEmpty()&&h.isEmpty())return sr.createEmptyResult(sr.UNION,l,h,l.getFactory());if(l.isEmpty())return h.copy();if(h.isEmpty())return l.copy()}return l.checkNotGeometryCollection(l),l.checkNotGeometryCollection(h),os.overlayOp(l,h,sr.UNION)},qe.GeoJSONReader=Io,qe.GeoJSONWriter=mf,qe.OverlayOp=sr,qe.UnionOp=td,qe.BufferOp=vo,Object.defineProperty(qe,"__esModule",{value:!0})}(vt)},2614:()=>{"use strict";const sn=":";const ii=function(ye,...Z){if(ii.translate){const J=ii.translate(ye,Z);ye=J[0],Z=J[1]}let Y=lr(ye[0],ye.raw[0]);for(let J=1;J<ye.length;J++)Y+=Z[J-1]+lr(ye[J],ye.raw[J]);return Y},ir=":";function lr(ye,Z){return Z.charAt(0)===ir?ye.substring(function Ut(ye,Z){for(let Y=1,J=1;Y<ye.length;Y++,J++)if("\\"===Z[J])J++;else if(ye[Y]===sn)return Y;throw new Error(`Unterminated $localize metadata block in "${Z}".`)}(ye,Z)+1):ye}(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)().$localize=ii}},sn=>{var vt=Ee=>sn(sn.s=Ee);vt(2614),vt(5363)}]);